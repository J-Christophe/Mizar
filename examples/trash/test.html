<!doctype html>
<html>

<head>
    <title>Getting started with navigation</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <link rel="stylesheet" href="css/test.css">

    <!-- mode dev -->
    <script type="text/javascript" src="test.js"></script>
    <script type="text/javascript" data-main="../src/rconfig.js" src="../node_modules/requirejs/require.js"></script>

    <!-- mode prod -->
    <!--<script type="text/javascript" src="../Mizar.min.js"></script>-->

    <script type="text/javascript">

        var seaLevel = [ "0.0m","0.5m","1.0m","1.5m","2.0m","2.5m","3.0m"];
        var currentSeaLevel = 3;

        function updateSeaLevel() {
            document.getElementById("sl").value=seaLevel[currentSeaLevel];
            if (typeof this.palavasLayer !== "undefined") {
                this.palavasLayer.setParameter("styles",seaLevel[currentSeaLevel]);
                this.palavasLayer.options.styles = seaLevel[currentSeaLevel];
                this.mizar.reloadLayer(palavasLayer);
            }
        }
        function init() {
            document.getElementById("sl").value=seaLevel[currentSeaLevel];
        }
        
        function previousSeaLevel() {
            if (currentSeaLevel>0) {
                currentSeaLevel --;
                updateSeaLevel();
            }
        }

        function nextSeaLevel() {
            if (currentSeaLevel<(seaLevel.length-1)) {
                currentSeaLevel ++;
                updateSeaLevel();
            }
        }
    
        function loadDEMMontBlanc() {
            mizar.addLayer(demMontBlanc,function (id) {
                    var cbLayer = mizar.getLayerByID(id);
                    if (cbLayer.type === Mizar.LAYER.WCSElevation) {
                        mizar.setBaseElevation(cbLayer.name);
                    }
                    
                });
        }
        function unloadDEMMontBlanc() {
            mizar.setBaseElevation("Elevation");
        }
        function setTime() {
            mizar.setTime("2003-08-21T00:00:00.000Z");
        }

        // mode dev
        require(['Mizar'], function (Mizar) {

            div = "MizarCanvas";
            mizarDiv = (typeof div === "string") ? document.getElementById(div) : div;
            mizarConf.canvas = $(mizarDiv)[0];
            mizarConf.planetContext.coordinateSystem.geoideName = Mizar.CRS.WGS84;


            // Create Mizar
            var mizar =  new Mizar(mizarConf);
            this.mizar = mizar;
            // Layers load
            for (var i = 0; i < context.layers.length; i++) {
                var layer = context.layers[i];

                mizar.addLayer(layer,function (id) {
                    var cbLayer = mizar.getLayerByID(id);
                    if (cbLayer.type === Mizar.LAYER.WCSElevation) {
                        mizar.setBaseElevation(cbLayer.name);
                    }
                    if (cbLayer.name === "Palavas") {
                        this.palavasLayer = cbLayer;
                    }

                    if (cbLayer.isBackground() === true) {
                        //mizar.addLayer(osLayer,function (id) {});
                        /*setTimeout(function go() {
                            mizar.activatedContext.navigation.zoomTo(
                                //[4.025,43.54],
                                [116.217,29.15],
                            { "distance" : 500000,
                              "duration" : 2000 });
                        },4000);*/
                    }
                });
            }

            mizar.addLayer({
                type: Mizar.LAYER.GroundOverlay,
                image: "data/mizar.jpg",
                quad: [[-1, 45], [-2, 46], [0, 48], [1, 47]],
                opacity: 50,
                flipY: false
            });

            mizar.addLayer({
                type: Mizar.LAYER.GroundOverlay,
                image: "data/mizar.jpg",
                quad: [[10, 40], [18, 40], [15, 48], [10, 45]]
            });

        });
    </script>
</head>

<body style="margin: 0; padding: 0;" onload="init();">
    <canvas id="MizarCanvas" onclick="click" style="border: none; margin: 0; padding: 0;">
    </canvas>

</body>
</html>
