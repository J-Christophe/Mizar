/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! jQuery v3.2.1 | (c) JS Foundation and other contributors | jquery.org/license */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*******************************************************************************
 * Copyright 2017 CNES - CENTRE NATIONAL d'ETUDES SPATIALES
 *
 * This file is part of MIZAR.
 *
 * MIZAR is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * MIZAR is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with SITools2. If not, see <http://www.gnu.org/licenses/>.
 ******************************************************************************/

/***************************************
 * Copyright 2011, 2012 GlobWeb contributors.
 *
 * This file is part of GlobWeb.
 *
 * GlobWeb is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, version 3 of the License, or
 * (at your option) any later version.
 *
 * GlobWeb is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with GlobWeb. If not, see <http://www.gnu.org/licenses/>.
 ***************************************/

/**
         * AbstactLayer configuration
         * @typedef {Object} AbstractLayer.configuration
         * @property {String} [name=""] - Layer name
         * @property {String} [attribution=""] - Attribution
         * @property {String} [copyrightUrl=""] - Copyright URL
         * @property {String} [ack=""] - ack
         * @property {String} [icon=a default image] - An icon to represent the layer
         * @property {String} [description=""] - A description
         * @property {boolean} [visible=true] - A boolean flag to display the layer
         * @property {Object} [properties={}] properties
         * @property {boolean} [pickable=false] - Sets to true to make the layer pickable
         * @property {boolean} [service=[]] - List of services related to the layer
         * @property {GEOMETRY} dataType - the data type for vector layers
         * @property background
         * @property category
         * @param {Crs} coordinateSystem
         * @param {string} [format=""]
         * @param {string} [baseUrl=""]
         * @param {boolean} [deletable=""]
         * @param {Array} [color= a random color]
         * @param {float} [opacity=1.0] - An opacity value
         * @param {FeatureStyle} [style]
         * @param {Array} [availableServices=[]}
         * @param {layerCallback} callback - A callback that transfoms data.
         */

/**
         * @function getCopyrightUrl
         * @memberOf AbstractLayer#
         */

/*
 * Copyright (c) 2012 Brandon Jones, Colin MacKenzie IV
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */

/**
     * Hips data model
     * Mandatory, description, isMultiple, default value, distinctvalue, isArray
     * @namespace
     * HIPS_METADATA
     * @property {String} creator_did - Unique ID of the HiPS - Format: IVOID - Ex : ivo://CDS/P/2MASS/J
     * @property {String} [publisher_id] - Unique ID of the HiPS publisher – Format: IVOID - Ex : ivo://CDS
     * @property {String} [obs_collection] - Short name of original data set – Format: one word – Ex : 2MASS
     * @property {String} obs_title - Data set title – Format: free text, one line – Ex : HST F110W observations
     * @property {String} [obs_description] - Data set description – Format: free text, longer free text description of the dataset
     * @property {String} [obs_ack] - Acknowledgment mention"
     * @property {String} [prov_progenitor] - Provenance of the original data – Format: free text
     * @property {String} [bib_reference] - Bibliographic reference
     * @property {String} [bib_reference_url] - URL to bibliographic reference
     * @property {String} [obs_copyright] - Copyright mention – Format: free text
     * @property {String} [obs_copyright_url] - URL to a copyright mention
     * @property {GENERAL_WAVELENGTH} [obs_regime] - General wavelength
     * @property {String} [data_ucd] - UCD describing data contents
     * @property {String} hips_version="1.4" - Number of HiPS version – Format: number
     * @property {String} [hips_builder] - Name and version of the tool used for building the HiPS – Format: free text
     * @property {String} [hips_publisher] - Institute or person who built the HiPS – Format: free text – Ex : CDS (T.Boch)
     * @property {String} [hips_creation_date] - HiPS first creation date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ
     * @property {String} hips_release_date - Last HiPS update date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ
     * @property {String} [hips_service_url] - HiPS access url – Format: URL
     * @property {String} hips_status - HiPS status
     * @property {String} [hips_estsize] - HiPS size estimation – Format: positive integer – Unit : KB
     * @property {HIPS_FRAME} hips_frame - Coordinate frame reference
     * @property {int} hips_order - Deepest HiPS order – Format: positive integer
     * @property {int} [hips_tile_width=512] - Tiles width in pixels – Format: positive integer
     * @property {HIPS_TILE_FORMAT} hips_tile_format - List of available tile formats
     * @property {String} [hips_pixel_cut] - Suggested pixel display cut range (physical values) – Format: min max
     * @property {String} [hips_data_range] - Pixel data range taken into account during the HiPS generation (physical values) – Format: min max – Ex : -18.5 510.5
     * @property {SAMPLING} [hips_sampling] - Sampling applied for the HiPS generation
     * @property {PIXEL_OVERLAY} [hips_overlay] - Pixel composition method applied on the image overlay region during HiPS generation
     * @property {SKY_VAL} [hips_skyval] - Sky background subtraction method applied during HiPS generation
     * @property {String} [hips_pixel_bitpix] - Fits tile BITPIX code
     * @property {String} [data_pixel_bitpix] - Original data BITPIX code
     * @property {DATA_PRODUCT_TYPE} dataproduct_type - Type of data
     * @property {SUB_TYPE_DATA} [dataproduct_subtype] - Subtype of data
     * @property {String} [hips_progenitor_url] - URL to an associated progenitor HiPS
     * @property {int} [hips_cat_nrows] -  Number of rows of the HiPS catalog
     * @property {int} [hips_cube_depth] - Number of frames of the HiPS cube
     * @property {int} [hips_cube_firstframe=0] - Initial first index frame to display for a HiPS cube
     * @property {float} [data_cube_crpix3] - Coef for computing physical channel value
     * @property {float} [data_cube_crval3] - Coef for computing physical channel value
     * @property {float} [data_cube_cdelt3] - Coef for computing physical channel value
     * @property {String} [data_cube_bunit3] - Third axis unit
     * @property {float} [hips_initial_ra] - Default RA display position (ICRS frame) – Unit : degrees
     * @property {float} [hips_initial_dec] - Default DEC display position (ICRS frame) – Unit : degrees
     * @property {float} [hips_initial_fov] - Default display size – Unit : degrees
     * @property {float} [hips_pixel_scale] - HiPS pixel angular resolution at the highest order – Unit : degrees
     * @property {float} [s_pixel_scale] - Best pixel angular resolution of the original images – Unit : degrees
     * @property {float} [t_min] - Start time of the observations - Representation: MJD
     * @property {float} [t_max] - Stop time of the observations - Representation: MJD
     * @property {float} [em_min] - Start in spectral coordinates – Unit: meters
     * @property {float} [em_max] - Stop in spectral coordinates – Unit: meters
     * @property {String} [client_category] - / separated keywords suggesting a display hierarchy to the client – Ex : Image/InfraRed
     * @property {String} [client_sort_key] - Sort key suggesting a display order to the client inside a client_category – Sort : alphanumeric
     * @property {String} [addendum_did] - In case of “live” HiPS, creator_did of the added HiPS
     * @property {float} [moc_sky_fraction] - Fraction of the sky covers by the MOC associated to the HiPS – Format: real between 0 and 1
     */

/**
         * AbstractHipsLayer configuration
         * @typedef {AbstractLayer.configuration} AbstractHipsLayer.configuration
         * @property {Crs} [coordinateSystem = CoordinateSystemFactory.create({geoideName: Constants.MappingCrsHips2Mizar[this.hipsMetadata.hips_frame]})] - Coordinate reference system
         * @property {int} [tilePixelSize = hipsMetadata['hips_tile_width'] - Tiles width in pixels
         * @property {int} [baseLevel = 2] - min HiPS order
         * @property {HEALPixTiling} [tiling = new HEALPixTiling(options.baseLevel, {coordinateSystem: options.coordinateSystem})] - Tiling
         * @property {int} [numberOfLevels = hipsMetadata['hips_order']] - Deepest order min
         * @property {string} [name = hipsMetadata['obs_title']] - Data set title
         * @property {string} [attribution = <a href=\"" + this.hipsMetadata['obs_copyright_url'] + "\" target=\"_blank\">" + this.hipsMetadata['obs_copyright'] + "</a>"] - URL to a copyright mention
         * @property {string} [ack = hipsMetadata['obs_ack']] - Acknowledgment mention
         * @property {string} [icon = ""] - icon used as metadata representation on the map
         * @property {string} [description = hipsMetadata['obs_description']] - Data set description
         * @property {boolean} [visible = false] visibility by default on the map
         * @property {Object} properties - other metadata
         * @property {float} [properties.initialRa = undefined] - Initial RA
         * @property {float} [properties.initialDec = undefined] - Initial DEC
         * @property {float} [properties.initialFov = undefined] - Initial field of view
         * @property {float} [properties.mocCoverage = undefined] - Sky fraction coverage
         * @property {boolean} [pickable = false] - Pickable layer
         * @property {Array} [availableServices = {}] - List of services related to the layer
         * @property {Array} [format = hipsMetadata['hips_tile_format']] - List of available tile formats
         * @property {string} [baseUrl =  hipsMetadata['hips_service_url']] - Endpoint service
         * @property {string} [category = Image] - Default category
         * @property {boolean} background - Tell if the layer is set as background         
         */

/*! jQuery UI - v1.12.1 - 2016-09-14
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

/*******************************************************************************
 * Copyright 2016 - Jean-Christophe Malapert
 *
 * This file is part of JsVotable.
 *
 * JsVotable is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * JsVotable is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with JVotable.  If not, see <http://www.gnu.org/licenses/>.
 ******************************************************************************/

/***************************************
 * Copyright 2011, 2012 GlobWeb contributors.
 *
 * This file is part of GlobWeb.
 *
 * GlobWeb is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, version 3 of the License, or
 * (at your option) any later version.
 *
 * GlobWeb is distributered in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with GlobWeb. If not, see <http://www.gnu.org/licenses/>.
 ***************************************/

!function(t,e){"function"==typeof define&&define.amd?define([],e):t.libGlobalName=e()}(this,function(){var t,e,r;!function(i){function n(t,e){return x.call(t,e)}function o(t,e){var i,r,n,o,s,a,l,h,u,c,d=e&&e.split("/"),p=y.map,f=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=d.concat(t.split("/")),h=0;h<t.length;h+=1)if(c=t[h],"."===c)t.splice(h,1),h-=1;else if(".."===c){if(1===h&&(".."===t[2]||".."===t[0]))break;h>0&&(t.splice(h-1,2),h-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||f)&&p){for(i=t.split("/"),h=i.length;h>0;h-=1){if(r=i.slice(0,h).join("/"),d)for(u=d.length;u>0;u-=1)if(n=p[d.slice(0,u).join("/")],n&&(n=n[r])){o=n,s=h;break}if(o)break;!a&&f&&f[r]&&(a=f[r],l=h)}!o&&a&&(o=a,s=l),o&&(i.splice(0,s,o),t=i.join("/"))}return t}function s(t,e){return function(){return p.apply(i,C.call(arguments,0).concat([t,e]))}}function a(t){return function(e){return o(e,t)}}function l(t){return function(e){m[t]=e}}function h(t){if(n(v,t)){var e=v[t];delete v[t],b[t]=!0,d.apply(i,e)}if(!n(m,t)&&!n(b,t))throw new Error("No "+t);return m[t]}function u(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function c(t){return function(){return y&&y.config&&y.config[t]||{}}}var d,p,f,g,m={},v={},y={},b={},x=Object.prototype.hasOwnProperty,C=[].slice;f=function(t,e){var i,r=u(t),n=r[0];return t=r[1],n&&(n=o(n,e),i=h(n)),n?t=i&&i.normalize?i.normalize(t,a(e)):o(t,e):(t=o(t,e),r=u(t),n=r[0],t=r[1],n&&(i=h(n))),{f:n?n+"!"+t:t,n:t,pr:n,p:i}},g={require:function(t){return s(t)},exports:function(t){var e=m[t];return"undefined"!=typeof e?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:c(t)}}},d=function(t,e,r,o){var a,u,c,d,p,y,x=[];if(o=o||t,"function"==typeof r){for(e=!e.length&&r.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(d=f(e[p],o),u=d.f,"require"===u)x[p]=g.require(t);else if("exports"===u)x[p]=g.exports(t),y=!0;else if("module"===u)a=x[p]=g.module(t);else if(n(m,u)||n(v,u)||n(b,u))x[p]=h(u);else{if(!d.p)throw new Error(t+" missing "+u);d.p.load(d.n,s(o,!0),l(u),{}),x[p]=m[u]}c=r.apply(m[t],x),t&&(a&&a.exports!==i&&a.exports!==m[t]?m[t]=a.exports:c===i&&y||(m[t]=c))}else t&&(m[t]=r)},t=e=p=function(t,e,r,n,o){return"string"==typeof t?g[t]?g[t](e):h(f(t,e).f):(t.splice||(y=t,e.splice?(t=e,e=r,r=null):t=i),e=e||function(){},"function"==typeof r&&(r=n,n=o),n?d(i,t,e,r):setTimeout(function(){d(i,t,e,r)},4),p)},p.config=function(t){return y=t,y.deps&&p(y.deps,y.callback),p},r=function(t,e,i){e.splice||(i=e,e=[]),n(m,t)||n(v,t)||(v[t]=[t,e,i])},r.amd={jQuery:!0}}(),r("../build/almond",function(){}),!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function i(t,e){e=e||rt;var i=e.createElement("script");i.text=t,e.head.appendChild(i).parentNode.removeChild(i)}function n(t){var e=!!t&&"length"in t&&t.length,i=mt.type(t);return"function"!==i&&!mt.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function o(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}function s(t,e,i){return mt.isFunction(e)?mt.grep(t,function(t,r){return!!e.call(t,r,t)!==i}):e.nodeType?mt.grep(t,function(t){return t===e!==i}):"string"!=typeof e?mt.grep(t,function(t){return lt.call(e,t)>-1!==i}):It.test(e)?mt.filter(e,t,i):(e=mt.filter(e,t),mt.grep(t,function(t){return lt.call(e,t)>-1!==i&&1===t.nodeType}))}function a(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function l(t){var e={};return mt.each(t.match(kt)||[],function(t,i){e[i]=!0}),e}function h(t){return t}function u(t){throw t}function c(t,e,i,r){var n;try{t&&mt.isFunction(n=t.promise)?n.call(t).done(e).fail(i):t&&mt.isFunction(n=t.then)?n.call(t,e,i):e.apply(void 0,[t].slice(r))}catch(t){i.apply(void 0,[t])}}function d(){rt.removeEventListener("DOMContentLoaded",d),t.removeEventListener("load",d),mt.ready()}function p(){this.expando=mt.expando+p.uid++}function f(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:Ut.test(t)?JSON.parse(t):t)}function g(t,e,i){var r;if(void 0===i&&1===t.nodeType)if(r="data-"+e.replace(zt,"-$&").toLowerCase(),i=t.getAttribute(r),"string"==typeof i){try{i=f(i)}catch(t){}Bt.set(t,e,i)}else i=void 0;return i}function m(t,e,i,r){var n,o=1,s=20,a=r?function(){return r.cur()}:function(){return mt.css(t,e,"")},l=a(),h=i&&i[3]||(mt.cssNumber[e]?"":"px"),u=(mt.cssNumber[e]||"px"!==h&&+l)&&Gt.exec(mt.css(t,e));if(u&&u[3]!==h){h=h||u[3],i=i||[],u=+l||1;do o=o||".5",u/=o,mt.style(t,e,u+h);while(o!==(o=a()/l)&&1!==o&&--s)}return i&&(u=+u||+l||0,n=i[1]?u+(i[1]+1)*i[2]:+i[2],r&&(r.unit=h,r.start=u,r.end=n)),n}function v(t){var e,i=t.ownerDocument,r=t.nodeName,n=Vt[r];return n?n:(e=i.body.appendChild(i.createElement(r)),n=mt.css(e,"display"),e.parentNode.removeChild(e),"none"===n&&(n="block"),Vt[r]=n,n)}function y(t,e){for(var i,r,n=[],o=0,s=t.length;o<s;o++)r=t[o],r.style&&(i=r.style.display,e?("none"===i&&(n[o]=Ot.get(r,"display")||null,n[o]||(r.style.display="")),""===r.style.display&&Wt(r)&&(n[o]=v(r))):"none"!==i&&(n[o]="none",Ot.set(r,"display",i)));for(o=0;o<s;o++)null!=n[o]&&(t[o].style.display=n[o]);return t}function b(t,e){var i;return i="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e||"*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&o(t,e)?mt.merge([t],i):i}function x(t,e){for(var i=0,r=t.length;i<r;i++)Ot.set(t[i],"globalEval",!e||Ot.get(e[i],"globalEval"))}function C(t,e,i,r,n){for(var o,s,a,l,h,u,c=e.createDocumentFragment(),d=[],p=0,f=t.length;p<f;p++)if(o=t[p],o||0===o)if("object"===mt.type(o))mt.merge(d,o.nodeType?[o]:o);else if(Jt.test(o)){for(s=s||c.appendChild(e.createElement("div")),a=(Xt.exec(o)||["",""])[1].toLowerCase(),l=Kt[a]||Kt._default,s.innerHTML=l[1]+mt.htmlPrefilter(o)+l[2],u=l[0];u--;)s=s.lastChild;mt.merge(d,s.childNodes),s=c.firstChild,s.textContent=""}else d.push(e.createTextNode(o));for(c.textContent="",p=0;o=d[p++];)if(r&&mt.inArray(o,r)>-1)n&&n.push(o);else if(h=mt.contains(o.ownerDocument,o),s=b(c.appendChild(o),"script"),h&&x(s),i)for(u=0;o=s[u++];)Zt.test(o.type||"")&&i.push(o);return c}function _(){return!0}function w(){return!1}function T(){try{return rt.activeElement}catch(t){}}function A(t,e,i,r,n,o){var s,a;if("object"==typeof e){"string"!=typeof i&&(r=r||i,i=void 0);for(a in e)A(t,a,i,r,e[a],o);return t}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),n===!1)n=w;else if(!n)return t;return 1===o&&(s=n,n=function(t){return mt().off(t),s.apply(this,arguments)},n.guid=s.guid||(s.guid=mt.guid++)),t.each(function(){mt.event.add(this,e,n,r,i)})}function I(t,e){return o(t,"table")&&o(11!==e.nodeType?e:e.firstChild,"tr")?mt(">tbody",t)[0]||t:t}function M(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function S(t){var e=oe.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function P(t,e){var i,r,n,o,s,a,l,h;if(1===e.nodeType){if(Ot.hasData(t)&&(o=Ot.access(t),s=Ot.set(e,o),h=o.events)){delete s.handle,s.events={};for(n in h)for(i=0,r=h[n].length;i<r;i++)mt.event.add(e,n,h[n][i])}Bt.hasData(t)&&(a=Bt.access(t),l=mt.extend({},a),Bt.set(e,l))}}function E(t,e){var i=e.nodeName.toLowerCase();"input"===i&&qt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function R(t,e,r,n){e=st.apply([],e);var o,s,a,l,h,u,c=0,d=t.length,p=d-1,f=e[0],g=mt.isFunction(f);if(g||d>1&&"string"==typeof f&&!ft.checkClone&&ne.test(f))return t.each(function(i){var o=t.eq(i);g&&(e[0]=f.call(this,i,o.html())),R(o,e,r,n)});if(d&&(o=C(e,t[0].ownerDocument,!1,t,n),s=o.firstChild,1===o.childNodes.length&&(o=s),s||n)){for(a=mt.map(b(o,"script"),M),l=a.length;c<d;c++)h=o,c!==p&&(h=mt.clone(h,!0,!0),l&&mt.merge(a,b(h,"script"))),r.call(t[c],h,c);if(l)for(u=a[a.length-1].ownerDocument,mt.map(a,S),c=0;c<l;c++)h=a[c],Zt.test(h.type||"")&&!Ot.access(h,"globalEval")&&mt.contains(u,h)&&(h.src?mt._evalUrl&&mt._evalUrl(h.src):i(h.textContent.replace(se,""),u))}return t}function k(t,e,i){for(var r,n=e?mt.filter(e,t):t,o=0;null!=(r=n[o]);o++)i||1!==r.nodeType||mt.cleanData(b(r)),r.parentNode&&(i&&mt.contains(r.ownerDocument,r)&&x(b(r,"script")),r.parentNode.removeChild(r));return t}function D(t,e,i){var r,n,o,s,a=t.style;return i=i||he(t),i&&(s=i.getPropertyValue(e)||i[e],""!==s||mt.contains(t.ownerDocument,t)||(s=mt.style(t,e)),!ft.pixelMarginRight()&&le.test(s)&&ae.test(e)&&(r=a.width,n=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=r,a.minWidth=n,a.maxWidth=o)),void 0!==s?s+"":s}function L(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function N(t){if(t in ge)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=fe.length;i--;)if(t=fe[i]+e,t in ge)return t}function F(t){var e=mt.cssProps[t];return e||(e=mt.cssProps[t]=N(t)||t),e}function O(t,e,i){var r=Gt.exec(e);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):e}function B(t,e,i,r,n){var o,s=0;for(o=i===(r?"border":"content")?4:"width"===e?1:0;o<4;o+=2)"margin"===i&&(s+=mt.css(t,i+Ht[o],!0,n)),r?("content"===i&&(s-=mt.css(t,"padding"+Ht[o],!0,n)),"margin"!==i&&(s-=mt.css(t,"border"+Ht[o]+"Width",!0,n))):(s+=mt.css(t,"padding"+Ht[o],!0,n),"padding"!==i&&(s+=mt.css(t,"border"+Ht[o]+"Width",!0,n)));return s}function U(t,e,i){var r,n=he(t),o=D(t,e,n),s="border-box"===mt.css(t,"boxSizing",!1,n);return le.test(o)?o:(r=s&&(ft.boxSizingReliable()||o===t.style[e]),"auto"===o&&(o=t["offset"+e[0].toUpperCase()+e.slice(1)]),o=parseFloat(o)||0,o+B(t,e,i||(s?"border":"content"),r,n)+"px")}function z(t,e,i,r,n){return new z.prototype.init(t,e,i,r,n)}function j(){ve&&(rt.hidden===!1&&t.requestAnimationFrame?t.requestAnimationFrame(j):t.setTimeout(j,mt.fx.interval),mt.fx.tick())}function G(){return t.setTimeout(function(){me=void 0}),me=mt.now()}function H(t,e){var i,r=0,n={height:t};for(e=e?1:0;r<4;r+=2-e)i=Ht[r],n["margin"+i]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function W(t,e,i){for(var r,n=(q.tweeners[e]||[]).concat(q.tweeners["*"]),o=0,s=n.length;o<s;o++)if(r=n[o].call(i,e,t))return r}function Y(t,e,i){var r,n,o,s,a,l,h,u,c="width"in e||"height"in e,d=this,p={},f=t.style,g=t.nodeType&&Wt(t),m=Ot.get(t,"fxshow");i.queue||(s=mt._queueHooks(t,"fx"),null==s.unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,d.always(function(){d.always(function(){s.unqueued--,mt.queue(t,"fx").length||s.empty.fire()})}));for(r in e)if(n=e[r],ye.test(n)){if(delete e[r],o=o||"toggle"===n,n===(g?"hide":"show")){if("show"!==n||!m||void 0===m[r])continue;g=!0}p[r]=m&&m[r]||mt.style(t,r)}if(l=!mt.isEmptyObject(e),l||!mt.isEmptyObject(p)){c&&1===t.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],h=m&&m.display,null==h&&(h=Ot.get(t,"display")),u=mt.css(t,"display"),"none"===u&&(h?u=h:(y([t],!0),h=t.style.display||h,u=mt.css(t,"display"),y([t]))),("inline"===u||"inline-block"===u&&null!=h)&&"none"===mt.css(t,"float")&&(l||(d.done(function(){f.display=h}),null==h&&(u=f.display,h="none"===u?"":u)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",d.always(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]})),l=!1;for(r in p)l||(m?"hidden"in m&&(g=m.hidden):m=Ot.access(t,"fxshow",{display:h}),o&&(m.hidden=!g),g&&y([t],!0),d.done(function(){g||y([t]),Ot.remove(t,"fxshow");for(r in p)mt.style(t,r,p[r])})),l=W(g?m[r]:0,r,d),r in m||(m[r]=l.start,g&&(l.end=l.start,l.start=0))}}function V(t,e){var i,r,n,o,s;for(i in t)if(r=mt.camelCase(i),n=e[r],o=t[i],Array.isArray(o)&&(n=o[1],o=t[i]=o[0]),i!==r&&(t[r]=o,delete t[i]),s=mt.cssHooks[r],s&&"expand"in s){o=s.expand(o),delete t[r];for(i in o)i in t||(t[i]=o[i],e[i]=n)}else e[r]=n}function q(t,e,i){var r,n,o=0,s=q.prefilters.length,a=mt.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var e=me||G(),i=Math.max(0,h.startTime+h.duration-e),r=i/h.duration||0,o=1-r,s=0,l=h.tweens.length;s<l;s++)h.tweens[s].run(o);return a.notifyWith(t,[h,o,i]),o<1&&l?i:(l||a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:mt.extend({},e),opts:mt.extend(!0,{specialEasing:{},easing:mt.easing._default},i),originalProperties:e,originalOptions:i,startTime:me||G(),duration:i.duration,tweens:[],createTween:function(e,i){var r=mt.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(r),r},stop:function(e){var i=0,r=e?h.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)h.tweens[i].run(1);return e?(a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h,e])):a.rejectWith(t,[h,e]),this}}),u=h.props;for(V(u,h.opts.specialEasing);o<s;o++)if(r=q.prefilters[o].call(h,t,u,h.opts))return mt.isFunction(r.stop)&&(mt._queueHooks(h.elem,h.opts.queue).stop=mt.proxy(r.stop,r)),r;return mt.map(u,W,h),mt.isFunction(h.opts.start)&&h.opts.start.call(t,h),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always),mt.fx.timer(mt.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h}function X(t){var e=t.match(kt)||[];return e.join(" ")}function Z(t){return t.getAttribute&&t.getAttribute("class")||""}function K(t,e,i,r){var n;if(Array.isArray(e))mt.each(e,function(e,n){i||Pe.test(t)?r(t,n):K(t+"["+("object"==typeof n&&null!=n?e:"")+"]",n,i,r)});else if(i||"object"!==mt.type(e))r(t,e);else for(n in e)K(t+"["+n+"]",e[n],i,r)}function J(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var r,n=0,o=e.toLowerCase().match(kt)||[];if(mt.isFunction(i))for(;r=o[n++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(i)):(t[r]=t[r]||[]).push(i)}}function Q(t,e,i,r){function n(a){var l;return o[a]=!0,mt.each(t[a]||[],function(t,a){var h=a(e,i,r);return"string"!=typeof h||s||o[h]?s?!(l=h):void 0:(e.dataTypes.unshift(h),n(h),!1)}),l}var o={},s=t===je;return n(e.dataTypes[0])||!o["*"]&&n("*")}function $(t,e){var i,r,n=mt.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((n[i]?t:r||(r={}))[i]=e[i]);return r&&mt.extend(!0,t,r),t}function tt(t,e,i){for(var r,n,o,s,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(n in a)if(a[n]&&a[n].test(r)){l.unshift(n);break}if(l[0]in i)o=l[0];else{for(n in i){if(!l[0]||t.converters[n+" "+l[0]]){o=n;break}s||(s=n)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),i[o]}function et(t,e,i,r){var n,o,s,a,l,h={},u=t.dataTypes.slice();if(u[1])for(s in t.converters)h[s.toLowerCase()]=t.converters[s];for(o=u.shift();o;)if(t.responseFields[o]&&(i[t.responseFields[o]]=e),!l&&r&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=o,o=u.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(s=h[l+" "+o]||h["* "+o],!s)for(n in h)if(a=n.split(" "),a[1]===o&&(s=h[l+" "+a[0]]||h["* "+a[0]])){s===!0?s=h[n]:h[n]!==!0&&(o=a[0],u.unshift(a[1]));break}if(s!==!0)if(s&&t.throws)e=s(e);else try{e=s(e)}catch(t){return{state:"parsererror",error:s?t:"No conversion from "+l+" to "+o}}}return{state:"success",data:e}}var it=[],rt=t.document,nt=Object.getPrototypeOf,ot=it.slice,st=it.concat,at=it.push,lt=it.indexOf,ht={},ut=ht.toString,ct=ht.hasOwnProperty,dt=ct.toString,pt=dt.call(Object),ft={},gt="3.2.1",mt=function(t,e){return new mt.fn.init(t,e)},vt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,yt=/^-ms-/,bt=/-([a-z])/g,xt=function(t,e){return e.toUpperCase()};mt.fn=mt.prototype={jquery:gt,constructor:mt,length:0,toArray:function(){return ot.call(this)},get:function(t){return null==t?ot.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=mt.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return mt.each(this,t)},map:function(t){return this.pushStack(mt.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(ot.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:at,sort:it.sort,splice:it.splice},mt.extend=mt.fn.extend=function(){var t,e,i,r,n,o,s=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[a]||{},a++),"object"==typeof s||mt.isFunction(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)i=s[e],r=t[e],s!==r&&(h&&r&&(mt.isPlainObject(r)||(n=Array.isArray(r)))?(n?(n=!1,o=i&&Array.isArray(i)?i:[]):o=i&&mt.isPlainObject(i)?i:{},s[e]=mt.extend(h,o,r)):void 0!==r&&(s[e]=r));return s},mt.extend({expando:"jQuery"+(gt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===mt.type(t)},isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=mt.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==ut.call(t)||(e=nt(t))&&(i=ct.call(e,"constructor")&&e.constructor,"function"!=typeof i||dt.call(i)!==pt))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?ht[ut.call(t)]||"object":typeof t},globalEval:function(t){i(t)},camelCase:function(t){return t.replace(yt,"ms-").replace(bt,xt)},each:function(t,e){var i,r=0;if(n(t))for(i=t.length;r<i&&e.call(t[r],r,t[r])!==!1;r++);else for(r in t)if(e.call(t[r],r,t[r])===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(vt,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(n(Object(t))?mt.merge(i,"string"==typeof t?[t]:t):at.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:lt.call(e,t,i)},merge:function(t,e){for(var i=+e.length,r=0,n=t.length;r<i;r++)t[n++]=e[r];return t.length=n,t},grep:function(t,e,i){for(var r,n=[],o=0,s=t.length,a=!i;o<s;o++)r=!e(t[o],o),r!==a&&n.push(t[o]);return n},map:function(t,e,i){var r,o,s=0,a=[];if(n(t))for(r=t.length;s<r;s++)o=e(t[s],s,i),null!=o&&a.push(o);else for(s in t)o=e(t[s],s,i),null!=o&&a.push(o);return st.apply([],a)},guid:1,proxy:function(t,e){var i,r,n;if("string"==typeof e&&(i=t[e],e=t,t=i),mt.isFunction(t))return r=ot.call(arguments,2),n=function(){return t.apply(e||this,r.concat(ot.call(arguments)))},n.guid=t.guid=t.guid||mt.guid++,n},now:Date.now,support:ft}),"function"==typeof Symbol&&(mt.fn[Symbol.iterator]=it[Symbol.iterator]),mt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){ht["[object "+e+"]"]=e.toLowerCase()});var Ct=function(t){function e(t,e,i,r){var n,o,s,a,l,h,u,d=e&&e.ownerDocument,f=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==f&&9!==f&&11!==f)return i;if(!r&&((e?e.ownerDocument||e:j)!==D&&k(e),e=e||D,N)){if(11!==f&&(l=vt.exec(t)))if(n=l[1]){if(9===f){if(!(s=e.getElementById(n)))return i;if(s.id===n)return i.push(s),i}else if(d&&(s=d.getElementById(n))&&U(e,s)&&s.id===n)return i.push(s),i}else{if(l[2])return Q.apply(i,e.getElementsByTagName(t)),i;if((n=l[3])&&_.getElementsByClassName&&e.getElementsByClassName)return Q.apply(i,e.getElementsByClassName(n)),i}if(_.qsa&&!V[t+" "]&&(!F||!F.test(t))){if(1!==f)d=e,u=t;else if("object"!==e.nodeName.toLowerCase()){for((a=e.getAttribute("id"))?a=a.replace(Ct,_t):e.setAttribute("id",a=z),h=I(t),o=h.length;o--;)h[o]="#"+a+" "+p(h[o]);u=h.join(","),d=yt.test(t)&&c(e.parentNode)||e}if(u)try{return Q.apply(i,d.querySelectorAll(u)),i}catch(t){}finally{a===z&&e.removeAttribute("id")}}}return S(t.replace(at,"$1"),e,i,r)}function i(){function t(i,r){return e.push(i+" ")>w.cacheLength&&delete t[e.shift()],t[i+" "]=r}var e=[];return t}function r(t){return t[z]=!0,t}function n(t){var e=D.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function o(t,e){for(var i=t.split("|"),r=i.length;r--;)w.attrHandle[i[r]]=e}function s(t,e){var i=e&&t,r=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(r)return r;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function l(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function h(t){return function(e){return"form"in e?e.parentNode&&e.disabled===!1?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Tt(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function u(t){return r(function(e){return e=+e,r(function(i,r){for(var n,o=t([],i.length,e),s=o.length;s--;)i[n=o[s]]&&(i[n]=!(r[n]=i[n]))})})}function c(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function d(){}function p(t){for(var e=0,i=t.length,r="";e<i;e++)r+=t[e].value;return r}function f(t,e,i){var r=e.dir,n=e.next,o=n||r,s=i&&"parentNode"===o,a=H++;return e.first?function(e,i,n){for(;e=e[r];)if(1===e.nodeType||s)return t(e,i,n);return!1}:function(e,i,l){var h,u,c,d=[G,a];if(l){for(;e=e[r];)if((1===e.nodeType||s)&&t(e,i,l))return!0}else for(;e=e[r];)if(1===e.nodeType||s)if(c=e[z]||(e[z]={}),u=c[e.uniqueID]||(c[e.uniqueID]={}),n&&n===e.nodeName.toLowerCase())e=e[r]||e;else{if((h=u[o])&&h[0]===G&&h[1]===a)return d[2]=h[2];if(u[o]=d,d[2]=t(e,i,l))return!0}return!1}}function g(t){return t.length>1?function(e,i,r){for(var n=t.length;n--;)if(!t[n](e,i,r))return!1;return!0}:t[0]}function m(t,i,r){for(var n=0,o=i.length;n<o;n++)e(t,i[n],r);return r}function v(t,e,i,r,n){for(var o,s=[],a=0,l=t.length,h=null!=e;a<l;a++)(o=t[a])&&(i&&!i(o,r,n)||(s.push(o),h&&e.push(a)));return s}function y(t,e,i,n,o,s){return n&&!n[z]&&(n=y(n)),o&&!o[z]&&(o=y(o,s)),r(function(r,s,a,l){var h,u,c,d=[],p=[],f=s.length,g=r||m(e||"*",a.nodeType?[a]:a,[]),y=!t||!r&&e?g:v(g,d,t,a,l),b=i?o||(r?t:f||n)?[]:s:y;if(i&&i(y,b,a,l),n)for(h=v(b,p),n(h,[],a,l),u=h.length;u--;)(c=h[u])&&(b[p[u]]=!(y[p[u]]=c));if(r){if(o||t){if(o){for(h=[],u=b.length;u--;)(c=b[u])&&h.push(y[u]=c);o(null,b=[],h,l)}for(u=b.length;u--;)(c=b[u])&&(h=o?tt(r,c):d[u])>-1&&(r[h]=!(s[h]=c))}}else b=v(b===s?b.splice(f,b.length):b),o?o(null,s,b,l):Q.apply(s,b)})}function b(t){for(var e,i,r,n=t.length,o=w.relative[t[0].type],s=o||w.relative[" "],a=o?1:0,l=f(function(t){return t===e},s,!0),h=f(function(t){return tt(e,t)>-1},s,!0),u=[function(t,i,r){var n=!o&&(r||i!==P)||((e=i).nodeType?l(t,i,r):h(t,i,r));return e=null,n}];a<n;a++)if(i=w.relative[t[a].type])u=[f(g(u),i)];else{if(i=w.filter[t[a].type].apply(null,t[a].matches),i[z]){for(r=++a;r<n&&!w.relative[t[r].type];r++);return y(a>1&&g(u),a>1&&p(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(at,"$1"),i,a<r&&b(t.slice(a,r)),r<n&&b(t=t.slice(r)),r<n&&p(t))}u.push(i)}return g(u)}function x(t,i){var n=i.length>0,o=t.length>0,s=function(r,s,a,l,h){var u,c,d,p=0,f="0",g=r&&[],m=[],y=P,b=r||o&&w.find.TAG("*",h),x=G+=null==y?1:Math.random()||.1,C=b.length;for(h&&(P=s===D||s||h);f!==C&&null!=(u=b[f]);f++){if(o&&u){for(c=0,s||u.ownerDocument===D||(k(u),a=!N);d=t[c++];)if(d(u,s||D,a)){l.push(u);break}h&&(G=x)}n&&((u=!d&&u)&&p--,r&&g.push(u))}if(p+=f,n&&f!==p){for(c=0;d=i[c++];)d(g,m,s,a);if(r){if(p>0)for(;f--;)g[f]||m[f]||(m[f]=K.call(l));m=v(m)}Q.apply(l,m),h&&!r&&m.length>0&&p+i.length>1&&e.uniqueSort(l)}return h&&(G=x,P=y),g};return n?r(s):s}var C,_,w,T,A,I,M,S,P,E,R,k,D,L,N,F,O,B,U,z="sizzle"+1*new Date,j=t.document,G=0,H=0,W=i(),Y=i(),V=i(),q=function(t,e){return t===e&&(R=!0),0},X={}.hasOwnProperty,Z=[],K=Z.pop,J=Z.push,Q=Z.push,$=Z.slice,tt=function(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",rt="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",nt="\\["+it+"*("+rt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+rt+"))|)"+it+"*\\]",ot=":("+rt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+nt+")*)|.*)\\)|)",st=new RegExp(it+"+","g"),at=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),lt=new RegExp("^"+it+"*,"+it+"*"),ht=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ut=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),ct=new RegExp(ot),dt=new RegExp("^"+rt+"$"),pt={ID:new RegExp("^#("+rt+")"),CLASS:new RegExp("^\\.("+rt+")"),TAG:new RegExp("^("+rt+"|[*])"),ATTR:new RegExp("^"+nt),PSEUDO:new RegExp("^"+ot),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},ft=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,mt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yt=/[+~]/,bt=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),xt=function(t,e,i){var r="0x"+e-65536;return r!==r||i?e:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},Ct=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,_t=function(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},wt=function(){k()},Tt=f(function(t){return t.disabled===!0&&("form"in t||"label"in t)},{dir:"parentNode",next:"legend"});try{Q.apply(Z=$.call(j.childNodes),j.childNodes),Z[j.childNodes.length].nodeType}catch(t){Q={apply:Z.length?function(t,e){J.apply(t,$.call(e))}:function(t,e){for(var i=t.length,r=0;t[i++]=e[r++];);t.length=i-1}}}_=e.support={},A=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},k=e.setDocument=function(t){var e,i,r=t?t.ownerDocument||t:j;return r!==D&&9===r.nodeType&&r.documentElement?(D=r,L=D.documentElement,N=!A(D),j!==D&&(i=D.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",wt,!1):i.attachEvent&&i.attachEvent("onunload",wt)),_.attributes=n(function(t){return t.className="i",!t.getAttribute("className")}),_.getElementsByTagName=n(function(t){return t.appendChild(D.createComment("")),!t.getElementsByTagName("*").length}),_.getElementsByClassName=mt.test(D.getElementsByClassName),_.getById=n(function(t){return L.appendChild(t).id=z,!D.getElementsByName||!D.getElementsByName(z).length}),_.getById?(w.filter.ID=function(t){var e=t.replace(bt,xt);return function(t){return t.getAttribute("id")===e}},w.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&N){var i=e.getElementById(t);return i?[i]:[]}}):(w.filter.ID=function(t){var e=t.replace(bt,xt);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},w.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&N){var i,r,n,o=e.getElementById(t);if(o){if(i=o.getAttributeNode("id"),i&&i.value===t)return[o];for(n=e.getElementsByName(t),r=0;o=n[r++];)if(i=o.getAttributeNode("id"),i&&i.value===t)return[o]}return[]}}),w.find.TAG=_.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):_.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,r=[],n=0,o=e.getElementsByTagName(t);if("*"===t){for(;i=o[n++];)1===i.nodeType&&r.push(i);return r}return o},w.find.CLASS=_.getElementsByClassName&&function(t,e){if("undefined"!=typeof e.getElementsByClassName&&N)return e.getElementsByClassName(t)},O=[],F=[],(_.qsa=mt.test(D.querySelectorAll))&&(n(function(t){L.appendChild(t).innerHTML="<a id='"+z+"'></a><select id='"+z+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&F.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||F.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+z+"-]").length||F.push("~="),t.querySelectorAll(":checked").length||F.push(":checked"),t.querySelectorAll("a#"+z+"+*").length||F.push(".#.+[+~]")}),n(function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=D.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&F.push("name"+it+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&F.push(":enabled",":disabled"),L.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&F.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),F.push(",.*:")})),(_.matchesSelector=mt.test(B=L.matches||L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&n(function(t){_.disconnectedMatch=B.call(t,"*"),B.call(t,"[s!='']:x"),O.push("!=",ot)}),F=F.length&&new RegExp(F.join("|")),O=O.length&&new RegExp(O.join("|")),e=mt.test(L.compareDocumentPosition),U=e||mt.test(L.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},q=e?function(t,e){if(t===e)return R=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!_.sortDetached&&e.compareDocumentPosition(t)===i?t===D||t.ownerDocument===j&&U(j,t)?-1:e===D||e.ownerDocument===j&&U(j,e)?1:E?tt(E,t)-tt(E,e):0:4&i?-1:1)}:function(t,e){if(t===e)return R=!0,0;var i,r=0,n=t.parentNode,o=e.parentNode,a=[t],l=[e];if(!n||!o)return t===D?-1:e===D?1:n?-1:o?1:E?tt(E,t)-tt(E,e):0;if(n===o)return s(t,e);for(i=t;i=i.parentNode;)a.unshift(i);for(i=e;i=i.parentNode;)l.unshift(i);for(;a[r]===l[r];)r++;return r?s(a[r],l[r]):a[r]===j?-1:l[r]===j?1:0},D):D},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==D&&k(t),i=i.replace(ut,"='$1']"),_.matchesSelector&&N&&!V[i+" "]&&(!O||!O.test(i))&&(!F||!F.test(i)))try{var r=B.call(t,i);if(r||_.disconnectedMatch||t.document&&11!==t.document.nodeType)return r}catch(t){}return e(i,D,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==D&&k(t),U(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==D&&k(t);var i=w.attrHandle[e.toLowerCase()],r=i&&X.call(w.attrHandle,e.toLowerCase())?i(t,e,!N):void 0;return void 0!==r?r:_.attributes||!N?t.getAttribute(e):(r=t.getAttributeNode(e))&&r.specified?r.value:null},e.escape=function(t){return(t+"").replace(Ct,_t)},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],r=0,n=0;if(R=!_.detectDuplicates,E=!_.sortStable&&t.slice(0),t.sort(q),R){for(;e=t[n++];)e===t[n]&&(r=i.push(n));for(;r--;)t.splice(i[r],1)}return E=null,t},T=e.getText=function(t){var e,i="",r=0,n=t.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=T(t)}else if(3===n||4===n)return t.nodeValue}else for(;e=t[r++];)i+=T(e);return i},w=e.selectors={cacheLength:50,createPseudo:r,match:pt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(bt,xt),t[3]=(t[3]||t[4]||t[5]||"").replace(bt,xt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return pt.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&ct.test(i)&&(e=I(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(bt,xt).toLowerCase();
return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=W[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&W(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,r){return function(n){var o=e.attr(n,t);return null==o?"!="===i:!i||(o+="","="===i?o===r:"!="===i?o!==r:"^="===i?r&&0===o.indexOf(r):"*="===i?r&&o.indexOf(r)>-1:"$="===i?r&&o.slice(-r.length)===r:"~="===i?(" "+o.replace(st," ")+" ").indexOf(r)>-1:"|="===i&&(o===r||o.slice(0,r.length+1)===r+"-"))}},CHILD:function(t,e,i,r,n){var o="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===r&&0===n?function(t){return!!t.parentNode}:function(e,i,l){var h,u,c,d,p,f,g=o!==s?"nextSibling":"previousSibling",m=e.parentNode,v=a&&e.nodeName.toLowerCase(),y=!l&&!a,b=!1;if(m){if(o){for(;g;){for(d=e;d=d[g];)if(a?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[s?m.firstChild:m.lastChild],s&&y){for(d=m,c=d[z]||(d[z]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),h=u[t]||[],p=h[0]===G&&h[1],b=p&&h[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(b=p=0)||f.pop();)if(1===d.nodeType&&++b&&d===e){u[t]=[G,p,b];break}}else if(y&&(d=e,c=d[z]||(d[z]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),h=u[t]||[],p=h[0]===G&&h[1],b=p),b===!1)for(;(d=++p&&d&&d[g]||(b=p=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++b||(y&&(c=d[z]||(d[z]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),u[t]=[G,b]),d!==e)););return b-=n,b===r||b%r===0&&b/r>=0}}},PSEUDO:function(t,i){var n,o=w.pseudos[t]||w.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return o[z]?o(i):o.length>1?(n=[t,t,"",i],w.setFilters.hasOwnProperty(t.toLowerCase())?r(function(t,e){for(var r,n=o(t,i),s=n.length;s--;)r=tt(t,n[s]),t[r]=!(e[r]=n[s])}):function(t){return o(t,0,n)}):o}},pseudos:{not:r(function(t){var e=[],i=[],n=M(t.replace(at,"$1"));return n[z]?r(function(t,e,i,r){for(var o,s=n(t,null,r,[]),a=t.length;a--;)(o=s[a])&&(t[a]=!(e[a]=o))}):function(t,r,o){return e[0]=t,n(e,null,o,i),e[0]=null,!i.pop()}}),has:r(function(t){return function(i){return e(t,i).length>0}}),contains:r(function(t){return t=t.replace(bt,xt),function(e){return(e.textContent||e.innerText||T(e)).indexOf(t)>-1}}),lang:r(function(t){return dt.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(bt,xt).toLowerCase(),function(e){var i;do if(i=N?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===L},focus:function(t){return t===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:h(!1),disabled:h(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!w.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return ft.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:u(function(){return[0]}),last:u(function(t,e){return[e-1]}),eq:u(function(t,e,i){return[i<0?i+e:i]}),even:u(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:u(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:u(function(t,e,i){for(var r=i<0?i+e:i;--r>=0;)t.push(r);return t}),gt:u(function(t,e,i){for(var r=i<0?i+e:i;++r<e;)t.push(r);return t})}},w.pseudos.nth=w.pseudos.eq;for(C in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[C]=a(C);for(C in{submit:!0,reset:!0})w.pseudos[C]=l(C);return d.prototype=w.filters=w.pseudos,w.setFilters=new d,I=e.tokenize=function(t,i){var r,n,o,s,a,l,h,u=Y[t+" "];if(u)return i?0:u.slice(0);for(a=t,l=[],h=w.preFilter;a;){r&&!(n=lt.exec(a))||(n&&(a=a.slice(n[0].length)||a),l.push(o=[])),r=!1,(n=ht.exec(a))&&(r=n.shift(),o.push({value:r,type:n[0].replace(at," ")}),a=a.slice(r.length));for(s in w.filter)!(n=pt[s].exec(a))||h[s]&&!(n=h[s](n))||(r=n.shift(),o.push({value:r,type:s,matches:n}),a=a.slice(r.length));if(!r)break}return i?a.length:a?e.error(t):Y(t,l).slice(0)},M=e.compile=function(t,e){var i,r=[],n=[],o=V[t+" "];if(!o){for(e||(e=I(t)),i=e.length;i--;)o=b(e[i]),o[z]?r.push(o):n.push(o);o=V(t,x(n,r)),o.selector=t}return o},S=e.select=function(t,e,i,r){var n,o,s,a,l,h="function"==typeof t&&t,u=!r&&I(t=h.selector||t);if(i=i||[],1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&9===e.nodeType&&N&&w.relative[o[1].type]){if(e=(w.find.ID(s.matches[0].replace(bt,xt),e)||[])[0],!e)return i;h&&(e=e.parentNode),t=t.slice(o.shift().value.length)}for(n=pt.needsContext.test(t)?0:o.length;n--&&(s=o[n],!w.relative[a=s.type]);)if((l=w.find[a])&&(r=l(s.matches[0].replace(bt,xt),yt.test(o[0].type)&&c(e.parentNode)||e))){if(o.splice(n,1),t=r.length&&p(o),!t)return Q.apply(i,r),i;break}}return(h||M(t,u))(r,e,!N,i,!e||yt.test(t)&&c(e.parentNode)||e),i},_.sortStable=z.split("").sort(q).join("")===z,_.detectDuplicates=!!R,k(),_.sortDetached=n(function(t){return 1&t.compareDocumentPosition(D.createElement("fieldset"))}),n(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||o("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),_.attributes&&n(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||o("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),n(function(t){return null==t.getAttribute("disabled")})||o(et,function(t,e,i){var r;if(!i)return t[e]===!0?e.toLowerCase():(r=t.getAttributeNode(e))&&r.specified?r.value:null}),e}(t);mt.find=Ct,mt.expr=Ct.selectors,mt.expr[":"]=mt.expr.pseudos,mt.uniqueSort=mt.unique=Ct.uniqueSort,mt.text=Ct.getText,mt.isXMLDoc=Ct.isXML,mt.contains=Ct.contains,mt.escapeSelector=Ct.escape;var _t=function(t,e,i){for(var r=[],n=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(n&&mt(t).is(i))break;r.push(t)}return r},wt=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},Tt=mt.expr.match.needsContext,At=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,It=/^.[^:#\[\.,]*$/;mt.filter=function(t,e,i){var r=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===r.nodeType?mt.find.matchesSelector(r,t)?[r]:[]:mt.find.matches(t,mt.grep(e,function(t){return 1===t.nodeType}))},mt.fn.extend({find:function(t){var e,i,r=this.length,n=this;if("string"!=typeof t)return this.pushStack(mt(t).filter(function(){for(e=0;e<r;e++)if(mt.contains(n[e],this))return!0}));for(i=this.pushStack([]),e=0;e<r;e++)mt.find(t,n[e],i);return r>1?mt.uniqueSort(i):i},filter:function(t){return this.pushStack(s(this,t||[],!1))},not:function(t){return this.pushStack(s(this,t||[],!0))},is:function(t){return!!s(this,"string"==typeof t&&Tt.test(t)?mt(t):t||[],!1).length}});var Mt,St=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Pt=mt.fn.init=function(t,e,i){var r,n;if(!t)return this;if(i=i||Mt,"string"==typeof t){if(r="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:St.exec(t),!r||!r[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(r[1]){if(e=e instanceof mt?e[0]:e,mt.merge(this,mt.parseHTML(r[1],e&&e.nodeType?e.ownerDocument||e:rt,!0)),At.test(r[1])&&mt.isPlainObject(e))for(r in e)mt.isFunction(this[r])?this[r](e[r]):this.attr(r,e[r]);return this}return n=rt.getElementById(r[2]),n&&(this[0]=n,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):mt.isFunction(t)?void 0!==i.ready?i.ready(t):t(mt):mt.makeArray(t,this)};Pt.prototype=mt.fn,Mt=mt(rt);var Et=/^(?:parents|prev(?:Until|All))/,Rt={children:!0,contents:!0,next:!0,prev:!0};mt.fn.extend({has:function(t){var e=mt(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(mt.contains(this,e[t]))return!0})},closest:function(t,e){var i,r=0,n=this.length,o=[],s="string"!=typeof t&&mt(t);if(!Tt.test(t))for(;r<n;r++)for(i=this[r];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&mt.find.matchesSelector(i,t))){o.push(i);break}return this.pushStack(o.length>1?mt.uniqueSort(o):o)},index:function(t){return t?"string"==typeof t?lt.call(mt(t),this[0]):lt.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(mt.uniqueSort(mt.merge(this.get(),mt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),mt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return _t(t,"parentNode")},parentsUntil:function(t,e,i){return _t(t,"parentNode",i)},next:function(t){return a(t,"nextSibling")},prev:function(t){return a(t,"previousSibling")},nextAll:function(t){return _t(t,"nextSibling")},prevAll:function(t){return _t(t,"previousSibling")},nextUntil:function(t,e,i){return _t(t,"nextSibling",i)},prevUntil:function(t,e,i){return _t(t,"previousSibling",i)},siblings:function(t){return wt((t.parentNode||{}).firstChild,t)},children:function(t){return wt(t.firstChild)},contents:function(t){return o(t,"iframe")?t.contentDocument:(o(t,"template")&&(t=t.content||t),mt.merge([],t.childNodes))}},function(t,e){mt.fn[t]=function(i,r){var n=mt.map(this,e,i);return"Until"!==t.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=mt.filter(r,n)),this.length>1&&(Rt[t]||mt.uniqueSort(n),Et.test(t)&&n.reverse()),this.pushStack(n)}});var kt=/[^\x20\t\r\n\f]+/g;mt.Callbacks=function(t){t="string"==typeof t?l(t):mt.extend({},t);var e,i,r,n,o=[],s=[],a=-1,h=function(){for(n=n||t.once,r=e=!0;s.length;a=-1)for(i=s.shift();++a<o.length;)o[a].apply(i[0],i[1])===!1&&t.stopOnFalse&&(a=o.length,i=!1);t.memory||(i=!1),e=!1,n&&(o=i?[]:"")},u={add:function(){return o&&(i&&!e&&(a=o.length-1,s.push(i)),function e(i){mt.each(i,function(i,r){mt.isFunction(r)?t.unique&&u.has(r)||o.push(r):r&&r.length&&"string"!==mt.type(r)&&e(r)})}(arguments),i&&!e&&h()),this},remove:function(){return mt.each(arguments,function(t,e){for(var i;(i=mt.inArray(e,o,i))>-1;)o.splice(i,1),i<=a&&a--}),this},has:function(t){return t?mt.inArray(t,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return n=s=[],o=i="",this},disabled:function(){return!o},lock:function(){return n=s=[],i||e||(o=i=""),this},locked:function(){return!!n},fireWith:function(t,i){return n||(i=i||[],i=[t,i.slice?i.slice():i],s.push(i),e||h()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},mt.extend({Deferred:function(e){var i=[["notify","progress",mt.Callbacks("memory"),mt.Callbacks("memory"),2],["resolve","done",mt.Callbacks("once memory"),mt.Callbacks("once memory"),0,"resolved"],["reject","fail",mt.Callbacks("once memory"),mt.Callbacks("once memory"),1,"rejected"]],r="pending",n={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(t){return n.then(null,t)},pipe:function(){var t=arguments;return mt.Deferred(function(e){mt.each(i,function(i,r){var n=mt.isFunction(t[r[4]])&&t[r[4]];o[r[1]](function(){var t=n&&n.apply(this,arguments);t&&mt.isFunction(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[r[0]+"With"](this,n?[t]:arguments)})}),t=null}).promise()},then:function(e,r,n){function o(e,i,r,n){return function(){var a=this,l=arguments,c=function(){var t,c;if(!(e<s)){if(t=r.apply(a,l),t===i.promise())throw new TypeError("Thenable self-resolution");c=t&&("object"==typeof t||"function"==typeof t)&&t.then,mt.isFunction(c)?n?c.call(t,o(s,i,h,n),o(s,i,u,n)):(s++,c.call(t,o(s,i,h,n),o(s,i,u,n),o(s,i,h,i.notifyWith))):(r!==h&&(a=void 0,l=[t]),(n||i.resolveWith)(a,l))}},d=n?c:function(){try{c()}catch(t){mt.Deferred.exceptionHook&&mt.Deferred.exceptionHook(t,d.stackTrace),e+1>=s&&(r!==u&&(a=void 0,l=[t]),i.rejectWith(a,l))}};e?d():(mt.Deferred.getStackHook&&(d.stackTrace=mt.Deferred.getStackHook()),t.setTimeout(d))}}var s=0;return mt.Deferred(function(t){i[0][3].add(o(0,t,mt.isFunction(n)?n:h,t.notifyWith)),i[1][3].add(o(0,t,mt.isFunction(e)?e:h)),i[2][3].add(o(0,t,mt.isFunction(r)?r:u))}).promise()},promise:function(t){return null!=t?mt.extend(t,n):n}},o={};return mt.each(i,function(t,e){var s=e[2],a=e[5];n[e[1]]=s.add,a&&s.add(function(){r=a},i[3-t][2].disable,i[0][2].lock),s.add(e[3].fire),o[e[0]]=function(){return o[e[0]+"With"](this===o?void 0:this,arguments),this},o[e[0]+"With"]=s.fireWith}),n.promise(o),e&&e.call(o,o),o},when:function(t){var e=arguments.length,i=e,r=Array(i),n=ot.call(arguments),o=mt.Deferred(),s=function(t){return function(i){r[t]=this,n[t]=arguments.length>1?ot.call(arguments):i,--e||o.resolveWith(r,n)}};if(e<=1&&(c(t,o.done(s(i)).resolve,o.reject,!e),"pending"===o.state()||mt.isFunction(n[i]&&n[i].then)))return o.then();for(;i--;)c(n[i],s(i),o.reject);return o.promise()}});var Dt=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;mt.Deferred.exceptionHook=function(e,i){t.console&&t.console.warn&&e&&Dt.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,i)},mt.readyException=function(e){t.setTimeout(function(){throw e})};var Lt=mt.Deferred();mt.fn.ready=function(t){return Lt.then(t).catch(function(t){mt.readyException(t)}),this},mt.extend({isReady:!1,readyWait:1,ready:function(t){(t===!0?--mt.readyWait:mt.isReady)||(mt.isReady=!0,t!==!0&&--mt.readyWait>0||Lt.resolveWith(rt,[mt]))}}),mt.ready.then=Lt.then,"complete"===rt.readyState||"loading"!==rt.readyState&&!rt.documentElement.doScroll?t.setTimeout(mt.ready):(rt.addEventListener("DOMContentLoaded",d),t.addEventListener("load",d));var Nt=function(t,e,i,r,n,o,s){var a=0,l=t.length,h=null==i;if("object"===mt.type(i)){n=!0;for(a in i)Nt(t,e,a,i[a],!0,o,s)}else if(void 0!==r&&(n=!0,mt.isFunction(r)||(s=!0),h&&(s?(e.call(t,r),e=null):(h=e,e=function(t,e,i){return h.call(mt(t),i)})),e))for(;a<l;a++)e(t[a],i,s?r:r.call(t[a],a,e(t[a],i)));return n?t:h?e.call(t):l?e(t[0],i):o},Ft=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};p.uid=1,p.prototype={cache:function(t){var e=t[this.expando];return e||(e={},Ft(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var r,n=this.cache(t);if("string"==typeof e)n[mt.camelCase(e)]=i;else for(r in e)n[mt.camelCase(r)]=e[r];return n},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][mt.camelCase(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,r=t[this.expando];if(void 0!==r){if(void 0!==e){Array.isArray(e)?e=e.map(mt.camelCase):(e=mt.camelCase(e),e=e in r?[e]:e.match(kt)||[]),i=e.length;for(;i--;)delete r[e[i]]}(void 0===e||mt.isEmptyObject(r))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!mt.isEmptyObject(e)}};var Ot=new p,Bt=new p,Ut=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,zt=/[A-Z]/g;mt.extend({hasData:function(t){return Bt.hasData(t)||Ot.hasData(t)},data:function(t,e,i){return Bt.access(t,e,i)},removeData:function(t,e){Bt.remove(t,e)},_data:function(t,e,i){return Ot.access(t,e,i)},_removeData:function(t,e){Ot.remove(t,e)}}),mt.fn.extend({data:function(t,e){var i,r,n,o=this[0],s=o&&o.attributes;if(void 0===t){if(this.length&&(n=Bt.get(o),1===o.nodeType&&!Ot.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&(r=s[i].name,0===r.indexOf("data-")&&(r=mt.camelCase(r.slice(5)),g(o,r,n[r])));Ot.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof t?this.each(function(){Bt.set(this,t)}):Nt(this,function(e){var i;if(o&&void 0===e){if(i=Bt.get(o,t),void 0!==i)return i;if(i=g(o,t),void 0!==i)return i}else this.each(function(){Bt.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Bt.remove(this,t)})}}),mt.extend({queue:function(t,e,i){var r;if(t)return e=(e||"fx")+"queue",r=Ot.get(t,e),i&&(!r||Array.isArray(i)?r=Ot.access(t,e,mt.makeArray(i)):r.push(i)),r||[]},dequeue:function(t,e){e=e||"fx";var i=mt.queue(t,e),r=i.length,n=i.shift(),o=mt._queueHooks(t,e),s=function(){mt.dequeue(t,e)};"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===e&&i.unshift("inprogress"),delete o.stop,n.call(t,s,o)),!r&&o&&o.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Ot.get(t,i)||Ot.access(t,i,{empty:mt.Callbacks("once memory").add(function(){Ot.remove(t,[e+"queue",i])})})}}),mt.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?mt.queue(this[0],t):void 0===e?this:this.each(function(){var i=mt.queue(this,t,e);mt._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&mt.dequeue(this,t)})},dequeue:function(t){return this.each(function(){mt.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,r=1,n=mt.Deferred(),o=this,s=this.length,a=function(){--r||n.resolveWith(o,[o])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)i=Ot.get(o[s],t+"queueHooks"),i&&i.empty&&(r++,i.empty.add(a));return a(),n.promise(e)}});var jt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Gt=new RegExp("^(?:([+-])=|)("+jt+")([a-z%]*)$","i"),Ht=["Top","Right","Bottom","Left"],Wt=function(t,e){return t=e||t,"none"===t.style.display||""===t.style.display&&mt.contains(t.ownerDocument,t)&&"none"===mt.css(t,"display")},Yt=function(t,e,i,r){var n,o,s={};for(o in e)s[o]=t.style[o],t.style[o]=e[o];n=i.apply(t,r||[]);for(o in e)t.style[o]=s[o];return n},Vt={};mt.fn.extend({show:function(){return y(this,!0)},hide:function(){return y(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Wt(this)?mt(this).show():mt(this).hide()})}});var qt=/^(?:checkbox|radio)$/i,Xt=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Zt=/^$|\/(?:java|ecma)script/i,Kt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Kt.optgroup=Kt.option,Kt.tbody=Kt.tfoot=Kt.colgroup=Kt.caption=Kt.thead,Kt.th=Kt.td;var Jt=/<|&#?\w+;/;!function(){var t=rt.createDocumentFragment(),e=t.appendChild(rt.createElement("div")),i=rt.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),ft.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",ft.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var Qt=rt.documentElement,$t=/^key/,te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ee=/^([^.]*)(?:\.(.+)|)/;mt.event={global:{},add:function(t,e,i,r,n){var o,s,a,l,h,u,c,d,p,f,g,m=Ot.get(t);if(m)for(i.handler&&(o=i,i=o.handler,n=o.selector),n&&mt.find.matchesSelector(Qt,n),i.guid||(i.guid=mt.guid++),(l=m.events)||(l=m.events={}),(s=m.handle)||(s=m.handle=function(e){return"undefined"!=typeof mt&&mt.event.triggered!==e.type?mt.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(kt)||[""],h=e.length;h--;)a=ee.exec(e[h])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p&&(c=mt.event.special[p]||{},p=(n?c.delegateType:c.bindType)||p,c=mt.event.special[p]||{},u=mt.extend({type:p,origType:g,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&mt.expr.match.needsContext.test(n),namespace:f.join(".")},o),(d=l[p])||(d=l[p]=[],d.delegateCount=0,c.setup&&c.setup.call(t,r,f,s)!==!1||t.addEventListener&&t.addEventListener(p,s)),c.add&&(c.add.call(t,u),u.handler.guid||(u.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,u):d.push(u),mt.event.global[p]=!0)},remove:function(t,e,i,r,n){var o,s,a,l,h,u,c,d,p,f,g,m=Ot.hasData(t)&&Ot.get(t);if(m&&(l=m.events)){for(e=(e||"").match(kt)||[""],h=e.length;h--;)if(a=ee.exec(e[h])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p){for(c=mt.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,d=l[p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=d.length;o--;)u=d[o],!n&&g!==u.origType||i&&i.guid!==u.guid||a&&!a.test(u.namespace)||r&&r!==u.selector&&("**"!==r||!u.selector)||(d.splice(o,1),u.selector&&d.delegateCount--,c.remove&&c.remove.call(t,u));s&&!d.length&&(c.teardown&&c.teardown.call(t,f,m.handle)!==!1||mt.removeEvent(t,p,m.handle),delete l[p])}else for(p in l)mt.event.remove(t,p+e[h],i,r,!0);mt.isEmptyObject(l)&&Ot.remove(t,"handle events")}},dispatch:function(t){var e,i,r,n,o,s,a=mt.event.fix(t),l=new Array(arguments.length),h=(Ot.get(this,"events")||{})[a.type]||[],u=mt.event.special[a.type]||{};for(l[0]=a,e=1;e<arguments.length;e++)l[e]=arguments[e];if(a.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,a)!==!1){for(s=mt.event.handlers.call(this,a,h),e=0;(n=s[e++])&&!a.isPropagationStopped();)for(a.currentTarget=n.elem,i=0;(o=n.handlers[i++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(o.namespace)||(a.handleObj=o,a.data=o.data,r=((mt.event.special[o.origType]||{}).handle||o.handler).apply(n.elem,l),void 0!==r&&(a.result=r)===!1&&(a.preventDefault(),a.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,a),a.result}},handlers:function(t,e){var i,r,n,o,s,a=[],l=e.delegateCount,h=t.target;if(l&&h.nodeType&&!("click"===t.type&&t.button>=1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==t.type||h.disabled!==!0)){for(o=[],s={},i=0;i<l;i++)r=e[i],n=r.selector+" ",void 0===s[n]&&(s[n]=r.needsContext?mt(n,this).index(h)>-1:mt.find(n,this,null,[h]).length),s[n]&&o.push(r);o.length&&a.push({elem:h,handlers:o})}return h=this,l<e.length&&a.push({elem:h,handlers:e.slice(l)}),a},addProp:function(t,e){Object.defineProperty(mt.Event.prototype,t,{enumerable:!0,configurable:!0,get:mt.isFunction(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[mt.expando]?t:new mt.Event(t)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==T()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===T()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&o(this,"input"))return this.click(),!1},_default:function(t){return o(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},mt.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},mt.Event=function(t,e){return this instanceof mt.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?_:w,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&mt.extend(this,e),this.timeStamp=t&&t.timeStamp||mt.now(),void(this[mt.expando]=!0)):new mt.Event(t,e)},mt.Event.prototype={constructor:mt.Event,isDefaultPrevented:w,isPropagationStopped:w,isImmediatePropagationStopped:w,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=_,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=_,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=_,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},mt.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&$t.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&te.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},mt.event.addProp),mt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){mt.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,r=this,n=t.relatedTarget,o=t.handleObj;return n&&(n===r||mt.contains(r,n))||(t.type=o.origType,i=o.handler.apply(this,arguments),t.type=e),i}}}),mt.fn.extend({on:function(t,e,i,r){return A(this,t,e,i,r)},one:function(t,e,i,r){return A(this,t,e,i,r,1)},off:function(t,e,i){var r,n;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,mt(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(n in t)this.off(n,e,t[n]);return this}return e!==!1&&"function"!=typeof e||(i=e,e=void 0),i===!1&&(i=w),this.each(function(){mt.event.remove(this,t,i,e)})}});var ie=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,re=/<script|<style|<link/i,ne=/checked\s*(?:[^=]|=\s*.checked.)/i,oe=/^true\/(.*)/,se=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;mt.extend({htmlPrefilter:function(t){return t.replace(ie,"<$1></$2>")},clone:function(t,e,i){var r,n,o,s,a=t.cloneNode(!0),l=mt.contains(t.ownerDocument,t);if(!(ft.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||mt.isXMLDoc(t)))for(s=b(a),o=b(t),r=0,n=o.length;r<n;r++)E(o[r],s[r]);if(e)if(i)for(o=o||b(t),s=s||b(a),r=0,n=o.length;r<n;r++)P(o[r],s[r]);else P(t,a);return s=b(a,"script"),s.length>0&&x(s,!l&&b(t,"script")),a},cleanData:function(t){for(var e,i,r,n=mt.event.special,o=0;void 0!==(i=t[o]);o++)if(Ft(i)){if(e=i[Ot.expando]){if(e.events)for(r in e.events)n[r]?mt.event.remove(i,r):mt.removeEvent(i,r,e.handle);i[Ot.expando]=void 0}i[Bt.expando]&&(i[Bt.expando]=void 0)}}}),mt.fn.extend({detach:function(t){return k(this,t,!0)},remove:function(t){return k(this,t)},text:function(t){return Nt(this,function(t){return void 0===t?mt.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return R(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=I(this,t);e.appendChild(t)}})},prepend:function(){return R(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=I(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return R(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return R(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(mt.cleanData(b(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return mt.clone(this,t,e)})},html:function(t){return Nt(this,function(t){var e=this[0]||{},i=0,r=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!re.test(t)&&!Kt[(Xt.exec(t)||["",""])[1].toLowerCase()]){t=mt.htmlPrefilter(t);try{for(;i<r;i++)e=this[i]||{},1===e.nodeType&&(mt.cleanData(b(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return R(this,arguments,function(e){var i=this.parentNode;mt.inArray(this,t)<0&&(mt.cleanData(b(this)),i&&i.replaceChild(e,this))},t)}}),mt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){mt.fn[t]=function(t){for(var i,r=[],n=mt(t),o=n.length-1,s=0;s<=o;s++)i=s===o?this:this.clone(!0),mt(n[s])[e](i),at.apply(r,i.get());return this.pushStack(r)}});var ae=/^margin/,le=new RegExp("^("+jt+")(?!px)[a-z%]+$","i"),he=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)};!function(){function e(){if(a){a.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Qt.appendChild(s);var e=t.getComputedStyle(a);i="1%"!==e.top,o="2px"===e.marginLeft,r="4px"===e.width,a.style.marginRight="50%",n="4px"===e.marginRight,Qt.removeChild(s),a=null}}var i,r,n,o,s=rt.createElement("div"),a=rt.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",ft.clearCloneStyle="content-box"===a.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(a),mt.extend(ft,{pixelPosition:function(){return e(),i},boxSizingReliable:function(){return e(),r},pixelMarginRight:function(){return e(),n},reliableMarginLeft:function(){return e(),o}}))}();var ue=/^(none|table(?!-c[ea]).+)/,ce=/^--/,de={position:"absolute",visibility:"hidden",display:"block"},pe={letterSpacing:"0",fontWeight:"400"},fe=["Webkit","Moz","ms"],ge=rt.createElement("div").style;mt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=D(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(t,e,i,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var n,o,s,a=mt.camelCase(e),l=ce.test(e),h=t.style;return l||(e=F(a)),s=mt.cssHooks[e]||mt.cssHooks[a],void 0===i?s&&"get"in s&&void 0!==(n=s.get(t,!1,r))?n:h[e]:(o=typeof i,"string"===o&&(n=Gt.exec(i))&&n[1]&&(i=m(t,e,n),o="number"),void(null!=i&&i===i&&("number"===o&&(i+=n&&n[3]||(mt.cssNumber[a]?"":"px")),ft.clearCloneStyle||""!==i||0!==e.indexOf("background")||(h[e]="inherit"),s&&"set"in s&&void 0===(i=s.set(t,i,r))||(l?h.setProperty(e,i):h[e]=i))))}},css:function(t,e,i,r){var n,o,s,a=mt.camelCase(e),l=ce.test(e);return l||(e=F(a)),s=mt.cssHooks[e]||mt.cssHooks[a],s&&"get"in s&&(n=s.get(t,!0,i)),void 0===n&&(n=D(t,e,r)),"normal"===n&&e in pe&&(n=pe[e]),""===i||i?(o=parseFloat(n),i===!0||isFinite(o)?o||0:n):n}}),mt.each(["height","width"],function(t,e){mt.cssHooks[e]={get:function(t,i,r){if(i)return!ue.test(mt.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?U(t,e,r):Yt(t,de,function(){return U(t,e,r)})},set:function(t,i,r){var n,o=r&&he(t),s=r&&B(t,e,r,"border-box"===mt.css(t,"boxSizing",!1,o),o);return s&&(n=Gt.exec(i))&&"px"!==(n[3]||"px")&&(t.style[e]=i,i=mt.css(t,e)),O(t,i,s)}}}),mt.cssHooks.marginLeft=L(ft.reliableMarginLeft,function(t,e){if(e)return(parseFloat(D(t,"marginLeft"))||t.getBoundingClientRect().left-Yt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),mt.each({margin:"",padding:"",border:"Width"},function(t,e){mt.cssHooks[t+e]={expand:function(i){for(var r=0,n={},o="string"==typeof i?i.split(" "):[i];r<4;r++)n[t+Ht[r]+e]=o[r]||o[r-2]||o[0];return n}},ae.test(t)||(mt.cssHooks[t+e].set=O)}),mt.fn.extend({css:function(t,e){return Nt(this,function(t,e,i){var r,n,o={},s=0;if(Array.isArray(e)){for(r=he(t),n=e.length;s<n;s++)o[e[s]]=mt.css(t,e[s],!1,r);return o}return void 0!==i?mt.style(t,e,i):mt.css(t,e)},t,e,arguments.length>1)}}),mt.Tween=z,z.prototype={constructor:z,init:function(t,e,i,r,n,o){this.elem=t,this.prop=i,this.easing=n||mt.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=r,this.unit=o||(mt.cssNumber[i]?"":"px");
},cur:function(){var t=z.propHooks[this.prop];return t&&t.get?t.get(this):z.propHooks._default.get(this)},run:function(t){var e,i=z.propHooks[this.prop];return this.options.duration?this.pos=e=mt.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):z.propHooks._default.set(this),this}},z.prototype.init.prototype=z.prototype,z.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=mt.css(t.elem,t.prop,""),e&&"auto"!==e?e:0)},set:function(t){mt.fx.step[t.prop]?mt.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[mt.cssProps[t.prop]]&&!mt.cssHooks[t.prop]?t.elem[t.prop]=t.now:mt.style(t.elem,t.prop,t.now+t.unit)}}},z.propHooks.scrollTop=z.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},mt.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},mt.fx=z.prototype.init,mt.fx.step={};var me,ve,ye=/^(?:toggle|show|hide)$/,be=/queueHooks$/;mt.Animation=mt.extend(q,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return m(i.elem,t,Gt.exec(e),i),i}]},tweener:function(t,e){mt.isFunction(t)?(e=t,t=["*"]):t=t.match(kt);for(var i,r=0,n=t.length;r<n;r++)i=t[r],q.tweeners[i]=q.tweeners[i]||[],q.tweeners[i].unshift(e)},prefilters:[Y],prefilter:function(t,e){e?q.prefilters.unshift(t):q.prefilters.push(t)}}),mt.speed=function(t,e,i){var r=t&&"object"==typeof t?mt.extend({},t):{complete:i||!i&&e||mt.isFunction(t)&&t,duration:t,easing:i&&e||e&&!mt.isFunction(e)&&e};return mt.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in mt.fx.speeds?r.duration=mt.fx.speeds[r.duration]:r.duration=mt.fx.speeds._default),null!=r.queue&&r.queue!==!0||(r.queue="fx"),r.old=r.complete,r.complete=function(){mt.isFunction(r.old)&&r.old.call(this),r.queue&&mt.dequeue(this,r.queue)},r},mt.fn.extend({fadeTo:function(t,e,i,r){return this.filter(Wt).css("opacity",0).show().end().animate({opacity:e},t,i,r)},animate:function(t,e,i,r){var n=mt.isEmptyObject(t),o=mt.speed(e,i,r),s=function(){var e=q(this,mt.extend({},t),o);(n||Ot.get(this,"finish"))&&e.stop(!0)};return s.finish=s,n||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(t,e,i){var r=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,n=null!=t&&t+"queueHooks",o=mt.timers,s=Ot.get(this);if(n)s[n]&&s[n].stop&&r(s[n]);else for(n in s)s[n]&&s[n].stop&&be.test(n)&&r(s[n]);for(n=o.length;n--;)o[n].elem!==this||null!=t&&o[n].queue!==t||(o[n].anim.stop(i),e=!1,o.splice(n,1));!e&&i||mt.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=Ot.get(this),r=i[t+"queue"],n=i[t+"queueHooks"],o=mt.timers,s=r?r.length:0;for(i.finish=!0,mt.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===t&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;e<s;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete i.finish})}}),mt.each(["toggle","show","hide"],function(t,e){var i=mt.fn[e];mt.fn[e]=function(t,r,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(H(e,!0),t,r,n)}}),mt.each({slideDown:H("show"),slideUp:H("hide"),slideToggle:H("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){mt.fn[t]=function(t,i,r){return this.animate(e,t,i,r)}}),mt.timers=[],mt.fx.tick=function(){var t,e=0,i=mt.timers;for(me=mt.now();e<i.length;e++)t=i[e],t()||i[e]!==t||i.splice(e--,1);i.length||mt.fx.stop(),me=void 0},mt.fx.timer=function(t){mt.timers.push(t),mt.fx.start()},mt.fx.interval=13,mt.fx.start=function(){ve||(ve=!0,j())},mt.fx.stop=function(){ve=null},mt.fx.speeds={slow:600,fast:200,_default:400},mt.fn.delay=function(e,i){return e=mt.fx?mt.fx.speeds[e]||e:e,i=i||"fx",this.queue(i,function(i,r){var n=t.setTimeout(i,e);r.stop=function(){t.clearTimeout(n)}})},function(){var t=rt.createElement("input"),e=rt.createElement("select"),i=e.appendChild(rt.createElement("option"));t.type="checkbox",ft.checkOn=""!==t.value,ft.optSelected=i.selected,t=rt.createElement("input"),t.value="t",t.type="radio",ft.radioValue="t"===t.value}();var xe,Ce=mt.expr.attrHandle;mt.fn.extend({attr:function(t,e){return Nt(this,mt.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){mt.removeAttr(this,t)})}}),mt.extend({attr:function(t,e,i){var r,n,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof t.getAttribute?mt.prop(t,e,i):(1===o&&mt.isXMLDoc(t)||(n=mt.attrHooks[e.toLowerCase()]||(mt.expr.match.bool.test(e)?xe:void 0)),void 0!==i?null===i?void mt.removeAttr(t,e):n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:(t.setAttribute(e,i+""),i):n&&"get"in n&&null!==(r=n.get(t,e))?r:(r=mt.find.attr(t,e),null==r?void 0:r))},attrHooks:{type:{set:function(t,e){if(!ft.radioValue&&"radio"===e&&o(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,r=0,n=e&&e.match(kt);if(n&&1===t.nodeType)for(;i=n[r++];)t.removeAttribute(i)}}),xe={set:function(t,e,i){return e===!1?mt.removeAttr(t,i):t.setAttribute(i,i),i}},mt.each(mt.expr.match.bool.source.match(/\w+/g),function(t,e){var i=Ce[e]||mt.find.attr;Ce[e]=function(t,e,r){var n,o,s=e.toLowerCase();return r||(o=Ce[s],Ce[s]=n,n=null!=i(t,e,r)?s:null,Ce[s]=o),n}});var _e=/^(?:input|select|textarea|button)$/i,we=/^(?:a|area)$/i;mt.fn.extend({prop:function(t,e){return Nt(this,mt.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[mt.propFix[t]||t]})}}),mt.extend({prop:function(t,e,i){var r,n,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&mt.isXMLDoc(t)||(e=mt.propFix[e]||e,n=mt.propHooks[e]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:t[e]=i:n&&"get"in n&&null!==(r=n.get(t,e))?r:t[e]},propHooks:{tabIndex:{get:function(t){var e=mt.find.attr(t,"tabindex");return e?parseInt(e,10):_e.test(t.nodeName)||we.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),ft.optSelected||(mt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),mt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){mt.propFix[this.toLowerCase()]=this}),mt.fn.extend({addClass:function(t){var e,i,r,n,o,s,a,l=0;if(mt.isFunction(t))return this.each(function(e){mt(this).addClass(t.call(this,e,Z(this)))});if("string"==typeof t&&t)for(e=t.match(kt)||[];i=this[l++];)if(n=Z(i),r=1===i.nodeType&&" "+X(n)+" "){for(s=0;o=e[s++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");a=X(r),n!==a&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,r,n,o,s,a,l=0;if(mt.isFunction(t))return this.each(function(e){mt(this).removeClass(t.call(this,e,Z(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(kt)||[];i=this[l++];)if(n=Z(i),r=1===i.nodeType&&" "+X(n)+" "){for(s=0;o=e[s++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");a=X(r),n!==a&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):mt.isFunction(t)?this.each(function(i){mt(this).toggleClass(t.call(this,i,Z(this),e),e)}):this.each(function(){var e,r,n,o;if("string"===i)for(r=0,n=mt(this),o=t.match(kt)||[];e=o[r++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==t&&"boolean"!==i||(e=Z(this),e&&Ot.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||t===!1?"":Ot.get(this,"__className__")||""))})},hasClass:function(t){var e,i,r=0;for(e=" "+t+" ";i=this[r++];)if(1===i.nodeType&&(" "+X(Z(i))+" ").indexOf(e)>-1)return!0;return!1}});var Te=/\r/g;mt.fn.extend({val:function(t){var e,i,r,n=this[0];return arguments.length?(r=mt.isFunction(t),this.each(function(i){var n;1===this.nodeType&&(n=r?t.call(this,i,mt(this).val()):t,null==n?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=mt.map(n,function(t){return null==t?"":t+""})),e=mt.valHooks[this.type]||mt.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))})):n?(e=mt.valHooks[n.type]||mt.valHooks[n.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(n,"value"))?i:(i=n.value,"string"==typeof i?i.replace(Te,""):null==i?"":i)):void 0}}),mt.extend({valHooks:{option:{get:function(t){var e=mt.find.attr(t,"value");return null!=e?e:X(mt.text(t))}},select:{get:function(t){var e,i,r,n=t.options,s=t.selectedIndex,a="select-one"===t.type,l=a?null:[],h=a?s+1:n.length;for(r=s<0?h:a?s:0;r<h;r++)if(i=n[r],(i.selected||r===s)&&!i.disabled&&(!i.parentNode.disabled||!o(i.parentNode,"optgroup"))){if(e=mt(i).val(),a)return e;l.push(e)}return l},set:function(t,e){for(var i,r,n=t.options,o=mt.makeArray(e),s=n.length;s--;)r=n[s],(r.selected=mt.inArray(mt.valHooks.option.get(r),o)>-1)&&(i=!0);return i||(t.selectedIndex=-1),o}}}}),mt.each(["radio","checkbox"],function(){mt.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=mt.inArray(mt(t).val(),e)>-1}},ft.checkOn||(mt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var Ae=/^(?:focusinfocus|focusoutblur)$/;mt.extend(mt.event,{trigger:function(e,i,r,n){var o,s,a,l,h,u,c,d=[r||rt],p=ct.call(e,"type")?e.type:e,f=ct.call(e,"namespace")?e.namespace.split("."):[];if(s=a=r=r||rt,3!==r.nodeType&&8!==r.nodeType&&!Ae.test(p+mt.event.triggered)&&(p.indexOf(".")>-1&&(f=p.split("."),p=f.shift(),f.sort()),h=p.indexOf(":")<0&&"on"+p,e=e[mt.expando]?e:new mt.Event(p,"object"==typeof e&&e),e.isTrigger=n?2:3,e.namespace=f.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),i=null==i?[e]:mt.makeArray(i,[e]),c=mt.event.special[p]||{},n||!c.trigger||c.trigger.apply(r,i)!==!1)){if(!n&&!c.noBubble&&!mt.isWindow(r)){for(l=c.delegateType||p,Ae.test(l+p)||(s=s.parentNode);s;s=s.parentNode)d.push(s),a=s;a===(r.ownerDocument||rt)&&d.push(a.defaultView||a.parentWindow||t)}for(o=0;(s=d[o++])&&!e.isPropagationStopped();)e.type=o>1?l:c.bindType||p,u=(Ot.get(s,"events")||{})[e.type]&&Ot.get(s,"handle"),u&&u.apply(s,i),u=h&&s[h],u&&u.apply&&Ft(s)&&(e.result=u.apply(s,i),e.result===!1&&e.preventDefault());return e.type=p,n||e.isDefaultPrevented()||c._default&&c._default.apply(d.pop(),i)!==!1||!Ft(r)||h&&mt.isFunction(r[p])&&!mt.isWindow(r)&&(a=r[h],a&&(r[h]=null),mt.event.triggered=p,r[p](),mt.event.triggered=void 0,a&&(r[h]=a)),e.result}},simulate:function(t,e,i){var r=mt.extend(new mt.Event,i,{type:t,isSimulated:!0});mt.event.trigger(r,null,e)}}),mt.fn.extend({trigger:function(t,e){return this.each(function(){mt.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return mt.event.trigger(t,e,i,!0)}}),mt.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,e){mt.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),mt.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),ft.focusin="onfocusin"in t,ft.focusin||mt.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){mt.event.simulate(e,t.target,mt.event.fix(t))};mt.event.special[e]={setup:function(){var r=this.ownerDocument||this,n=Ot.access(r,e);n||r.addEventListener(t,i,!0),Ot.access(r,e,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=Ot.access(r,e)-1;n?Ot.access(r,e,n):(r.removeEventListener(t,i,!0),Ot.remove(r,e))}}});var Ie=t.location,Me=mt.now(),Se=/\?/;mt.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||mt.error("Invalid XML: "+e),i};var Pe=/\[\]$/,Ee=/\r?\n/g,Re=/^(?:submit|button|image|reset|file)$/i,ke=/^(?:input|select|textarea|keygen)/i;mt.param=function(t,e){var i,r=[],n=function(t,e){var i=mt.isFunction(e)?e():e;r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(Array.isArray(t)||t.jquery&&!mt.isPlainObject(t))mt.each(t,function(){n(this.name,this.value)});else for(i in t)K(i,t[i],e,n);return r.join("&")},mt.fn.extend({serialize:function(){return mt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=mt.prop(this,"elements");return t?mt.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!mt(this).is(":disabled")&&ke.test(this.nodeName)&&!Re.test(t)&&(this.checked||!qt.test(t))}).map(function(t,e){var i=mt(this).val();return null==i?null:Array.isArray(i)?mt.map(i,function(t){return{name:e.name,value:t.replace(Ee,"\r\n")}}):{name:e.name,value:i.replace(Ee,"\r\n")}}).get()}});var De=/%20/g,Le=/#.*$/,Ne=/([?&])_=[^&]*/,Fe=/^(.*?):[ \t]*([^\r\n]*)$/gm,Oe=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Be=/^(?:GET|HEAD)$/,Ue=/^\/\//,ze={},je={},Ge="*/".concat("*"),He=rt.createElement("a");He.href=Ie.href,mt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ie.href,type:"GET",isLocal:Oe.test(Ie.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ge,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":mt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?$($(t,mt.ajaxSettings),e):$(mt.ajaxSettings,t)},ajaxPrefilter:J(ze),ajaxTransport:J(je),ajax:function(e,i){function r(e,i,r,a){var h,d,p,x,C,_=i;u||(u=!0,l&&t.clearTimeout(l),n=void 0,s=a||"",w.readyState=e>0?4:0,h=e>=200&&e<300||304===e,r&&(x=tt(f,w,r)),x=et(f,x,w,h),h?(f.ifModified&&(C=w.getResponseHeader("Last-Modified"),C&&(mt.lastModified[o]=C),C=w.getResponseHeader("etag"),C&&(mt.etag[o]=C)),204===e||"HEAD"===f.type?_="nocontent":304===e?_="notmodified":(_=x.state,d=x.data,p=x.error,h=!p)):(p=_,!e&&_||(_="error",e<0&&(e=0))),w.status=e,w.statusText=(i||_)+"",h?v.resolveWith(g,[d,_,w]):v.rejectWith(g,[w,_,p]),w.statusCode(b),b=void 0,c&&m.trigger(h?"ajaxSuccess":"ajaxError",[w,f,h?d:p]),y.fireWith(g,[w,_]),c&&(m.trigger("ajaxComplete",[w,f]),--mt.active||mt.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=void 0),i=i||{};var n,o,s,a,l,h,u,c,d,p,f=mt.ajaxSetup({},i),g=f.context||f,m=f.context&&(g.nodeType||g.jquery)?mt(g):mt.event,v=mt.Deferred(),y=mt.Callbacks("once memory"),b=f.statusCode||{},x={},C={},_="canceled",w={readyState:0,getResponseHeader:function(t){var e;if(u){if(!a)for(a={};e=Fe.exec(s);)a[e[1].toLowerCase()]=e[2];e=a[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return u?s:null},setRequestHeader:function(t,e){return null==u&&(t=C[t.toLowerCase()]=C[t.toLowerCase()]||t,x[t]=e),this},overrideMimeType:function(t){return null==u&&(f.mimeType=t),this},statusCode:function(t){var e;if(t)if(u)w.always(t[w.status]);else for(e in t)b[e]=[b[e],t[e]];return this},abort:function(t){var e=t||_;return n&&n.abort(e),r(0,e),this}};if(v.promise(w),f.url=((e||f.url||Ie.href)+"").replace(Ue,Ie.protocol+"//"),f.type=i.method||i.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(kt)||[""],null==f.crossDomain){h=rt.createElement("a");try{h.href=f.url,h.href=h.href,f.crossDomain=He.protocol+"//"+He.host!=h.protocol+"//"+h.host}catch(t){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=mt.param(f.data,f.traditional)),Q(ze,f,i,w),u)return w;c=mt.event&&f.global,c&&0===mt.active++&&mt.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Be.test(f.type),o=f.url.replace(Le,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(De,"+")):(p=f.url.slice(o.length),f.data&&(o+=(Se.test(o)?"&":"?")+f.data,delete f.data),f.cache===!1&&(o=o.replace(Ne,"$1"),p=(Se.test(o)?"&":"?")+"_="+Me++ +p),f.url=o+p),f.ifModified&&(mt.lastModified[o]&&w.setRequestHeader("If-Modified-Since",mt.lastModified[o]),mt.etag[o]&&w.setRequestHeader("If-None-Match",mt.etag[o])),(f.data&&f.hasContent&&f.contentType!==!1||i.contentType)&&w.setRequestHeader("Content-Type",f.contentType),w.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Ge+"; q=0.01":""):f.accepts["*"]);for(d in f.headers)w.setRequestHeader(d,f.headers[d]);if(f.beforeSend&&(f.beforeSend.call(g,w,f)===!1||u))return w.abort();if(_="abort",y.add(f.complete),w.done(f.success),w.fail(f.error),n=Q(je,f,i,w)){if(w.readyState=1,c&&m.trigger("ajaxSend",[w,f]),u)return w;f.async&&f.timeout>0&&(l=t.setTimeout(function(){w.abort("timeout")},f.timeout));try{u=!1,n.send(x,r)}catch(t){if(u)throw t;r(-1,t)}}else r(-1,"No Transport");return w},getJSON:function(t,e,i){return mt.get(t,e,i,"json")},getScript:function(t,e){return mt.get(t,void 0,e,"script")}}),mt.each(["get","post"],function(t,e){mt[e]=function(t,i,r,n){return mt.isFunction(i)&&(n=n||r,r=i,i=void 0),mt.ajax(mt.extend({url:t,type:e,dataType:n,data:i,success:r},mt.isPlainObject(t)&&t))}}),mt._evalUrl=function(t){return mt.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},mt.fn.extend({wrapAll:function(t){var e;return this[0]&&(mt.isFunction(t)&&(t=t.call(this[0])),e=mt(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(t){return mt.isFunction(t)?this.each(function(e){mt(this).wrapInner(t.call(this,e))}):this.each(function(){var e=mt(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=mt.isFunction(t);return this.each(function(i){mt(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){mt(this).replaceWith(this.childNodes)}),this}}),mt.expr.pseudos.hidden=function(t){return!mt.expr.pseudos.visible(t)},mt.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},mt.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var We={0:200,1223:204},Ye=mt.ajaxSettings.xhr();ft.cors=!!Ye&&"withCredentials"in Ye,ft.ajax=Ye=!!Ye,mt.ajaxTransport(function(e){var i,r;if(ft.cors||Ye&&!e.crossDomain)return{send:function(n,o){var s,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(s in e.xhrFields)a[s]=e.xhrFields[s];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(s in n)a.setRequestHeader(s,n[s]);i=function(t){return function(){i&&(i=r=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?o(0,"error"):o(a.status,a.statusText):o(We[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),r=a.onerror=i("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout(function(){i&&r()})},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}}),mt.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),mt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return mt.globalEval(t),t}}}),mt.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),mt.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(r,n){e=mt("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&n("error"===t.type?404:200,t.type)}),rt.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Ve=[],qe=/(=)\?(?=&|$)|\?\?/;mt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ve.pop()||mt.expando+"_"+Me++;return this[t]=!0,t}}),mt.ajaxPrefilter("json jsonp",function(e,i,r){var n,o,s,a=e.jsonp!==!1&&(qe.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&qe.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=mt.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(qe,"$1"+n):e.jsonp!==!1&&(e.url+=(Se.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return s||mt.error(n+" was not called"),s[0]},e.dataTypes[0]="json",o=t[n],t[n]=function(){s=arguments},r.always(function(){void 0===o?mt(t).removeProp(n):t[n]=o,e[n]&&(e.jsonpCallback=i.jsonpCallback,Ve.push(n)),s&&mt.isFunction(o)&&o(s[0]),s=o=void 0}),"script"}),ft.createHTMLDocument=function(){var t=rt.implementation.createHTMLDocument("").body;return t.innerHTML="<form></form><form></form>",2===t.childNodes.length}(),mt.parseHTML=function(t,e,i){if("string"!=typeof t)return[];"boolean"==typeof e&&(i=e,e=!1);var r,n,o;return e||(ft.createHTMLDocument?(e=rt.implementation.createHTMLDocument(""),r=e.createElement("base"),r.href=rt.location.href,e.head.appendChild(r)):e=rt),n=At.exec(t),o=!i&&[],n?[e.createElement(n[1])]:(n=C([t],e,o),o&&o.length&&mt(o).remove(),mt.merge([],n.childNodes))},mt.fn.load=function(t,e,i){var r,n,o,s=this,a=t.indexOf(" ");return a>-1&&(r=X(t.slice(a)),t=t.slice(0,a)),mt.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(n="POST"),s.length>0&&mt.ajax({url:t,type:n||"GET",dataType:"html",data:e}).done(function(t){o=arguments,s.html(r?mt("<div>").append(mt.parseHTML(t)).find(r):t)}).always(i&&function(t,e){s.each(function(){i.apply(this,o||[t.responseText,e,t])})}),this},mt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){mt.fn[e]=function(t){return this.on(e,t)}}),mt.expr.pseudos.animated=function(t){return mt.grep(mt.timers,function(e){return t===e.elem}).length},mt.offset={setOffset:function(t,e,i){var r,n,o,s,a,l,h,u=mt.css(t,"position"),c=mt(t),d={};"static"===u&&(t.style.position="relative"),a=c.offset(),o=mt.css(t,"top"),l=mt.css(t,"left"),h=("absolute"===u||"fixed"===u)&&(o+l).indexOf("auto")>-1,h?(r=c.position(),s=r.top,n=r.left):(s=parseFloat(o)||0,n=parseFloat(l)||0),mt.isFunction(e)&&(e=e.call(t,i,mt.extend({},a))),null!=e.top&&(d.top=e.top-a.top+s),null!=e.left&&(d.left=e.left-a.left+n),"using"in e?e.using.call(t,d):c.css(d)}},mt.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){mt.offset.setOffset(this,t,e)});var e,i,r,n,o=this[0];return o?o.getClientRects().length?(r=o.getBoundingClientRect(),e=o.ownerDocument,i=e.documentElement,n=e.defaultView,{top:r.top+n.pageYOffset-i.clientTop,left:r.left+n.pageXOffset-i.clientLeft}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i=this[0],r={top:0,left:0};return"fixed"===mt.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),o(t[0],"html")||(r=t.offset()),r={top:r.top+mt.css(t[0],"borderTopWidth",!0),left:r.left+mt.css(t[0],"borderLeftWidth",!0)}),{top:e.top-r.top-mt.css(i,"marginTop",!0),left:e.left-r.left-mt.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===mt.css(t,"position");)t=t.offsetParent;return t||Qt})}}),mt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;mt.fn[t]=function(r){return Nt(this,function(t,r,n){var o;return mt.isWindow(t)?o=t:9===t.nodeType&&(o=t.defaultView),void 0===n?o?o[e]:t[r]:void(o?o.scrollTo(i?o.pageXOffset:n,i?n:o.pageYOffset):t[r]=n)},t,r,arguments.length)}}),mt.each(["top","left"],function(t,e){mt.cssHooks[e]=L(ft.pixelPosition,function(t,i){if(i)return i=D(t,e),le.test(i)?mt(t).position()[e]+"px":i})}),mt.each({Height:"height",Width:"width"},function(t,e){mt.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,r){mt.fn[r]=function(n,o){var s=arguments.length&&(i||"boolean"!=typeof n),a=i||(n===!0||o===!0?"margin":"border");return Nt(this,function(e,i,n){var o;return mt.isWindow(e)?0===r.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(o=e.documentElement,Math.max(e.body["scroll"+t],o["scroll"+t],e.body["offset"+t],o["offset"+t],o["client"+t])):void 0===n?mt.css(e,i,a):mt.style(e,i,n,a)},e,s?n:void 0,s)}})}),mt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,r){return this.on(e,t,i,r)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}}),mt.holdReady=function(t){t?mt.readyWait++:mt.ready(!0)},mt.isArray=Array.isArray,mt.parseJSON=JSON.parse,mt.nodeName=o,"function"==typeof r&&r.amd&&r("jquery",[],function(){return mt});var Xe=t.jQuery,Ze=t.$;return mt.noConflict=function(e){return t.$===mt&&(t.$=Ze),e&&t.jQuery===mt&&(t.jQuery=Xe),mt},e||(t.jQuery=t.$=mt),mt}),function(){function t(t){function e(e,i,r,n,o,s){for(;o>=0&&s>o;o+=t){var a=n?n[o]:o;r=i(r,e[a],a,e)}return r}return function(i,r,n,o){r=x(r,o,4);var s=!M(i)&&b.keys(i),a=(s||i).length,l=t>0?0:a-1;return arguments.length<3&&(n=i[s?s[l]:l],l+=t),e(i,r,n,s,l,a)}}function e(t){return function(e,i,r){i=C(i,r);for(var n=I(e),o=t>0?0:n-1;o>=0&&n>o;o+=t)if(i(e[o],o,e))return o;return-1}}function i(t,e,i){return function(r,n,o){var s=0,a=I(r);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(i&&o&&a)return o=i(r,n),r[o]===n?o:-1;if(n!==n)return o=e(c.call(r,s,a),b.isNaN),o>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&a>o;o+=t)if(r[o]===n)return o;return-1}}function n(t,e){var i=k.length,r=t.constructor,n=b.isFunction(r)&&r.prototype||l,o="constructor";for(b.has(t,o)&&!b.contains(e,o)&&e.push(o);i--;)o=k[i],o in t&&t[o]!==n[o]&&!b.contains(e,o)&&e.push(o)}var o=this,s=o._,a=Array.prototype,l=Object.prototype,h=Function.prototype,u=a.push,c=a.slice,d=l.toString,p=l.hasOwnProperty,f=Array.isArray,g=Object.keys,m=h.bind,v=Object.create,y=function(){},b=function(t){return t instanceof b?t:this instanceof b?void(this._wrapped=t):new b(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports._=b):o._=b,b.VERSION="1.8.3";var x=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)};case 4:return function(i,r,n,o){return t.call(e,i,r,n,o)}}return function(){return t.apply(e,arguments)}},C=function(t,e,i){return null==t?b.identity:b.isFunction(t)?x(t,e,i):b.isObject(t)?b.matcher(t):b.property(t)};b.iteratee=function(t,e){return C(t,e,1/0)};var _=function(t,e){return function(i){var r=arguments.length;if(2>r||null==i)return i;for(var n=1;r>n;n++)for(var o=arguments[n],s=t(o),a=s.length,l=0;a>l;l++){var h=s[l];e&&void 0!==i[h]||(i[h]=o[h])}return i}},w=function(t){if(!b.isObject(t))return{};if(v)return v(t);y.prototype=t;var e=new y;return y.prototype=null,e},T=function(t){return function(e){return null==e?void 0:e[t]}},A=Math.pow(2,53)-1,I=T("length"),M=function(t){var e=I(t);return"number"==typeof e&&e>=0&&A>=e};b.each=b.forEach=function(t,e,i){e=x(e,i);var r,n;if(M(t))for(r=0,n=t.length;n>r;r++)e(t[r],r,t);else{var o=b.keys(t);for(r=0,n=o.length;n>r;r++)e(t[o[r]],o[r],t)}return t},b.map=b.collect=function(t,e,i){e=C(e,i);for(var r=!M(t)&&b.keys(t),n=(r||t).length,o=Array(n),s=0;n>s;s++){var a=r?r[s]:s;o[s]=e(t[a],a,t)}return o},b.reduce=b.foldl=b.inject=t(1),b.reduceRight=b.foldr=t(-1),b.find=b.detect=function(t,e,i){var r;return r=M(t)?b.findIndex(t,e,i):b.findKey(t,e,i),void 0!==r&&r!==-1?t[r]:void 0},b.filter=b.select=function(t,e,i){var r=[];return e=C(e,i),b.each(t,function(t,i,n){e(t,i,n)&&r.push(t)}),r},b.reject=function(t,e,i){return b.filter(t,b.negate(C(e)),i)},b.every=b.all=function(t,e,i){e=C(e,i);for(var r=!M(t)&&b.keys(t),n=(r||t).length,o=0;n>o;o++){var s=r?r[o]:o;if(!e(t[s],s,t))return!1}return!0},b.some=b.any=function(t,e,i){e=C(e,i);for(var r=!M(t)&&b.keys(t),n=(r||t).length,o=0;n>o;o++){var s=r?r[o]:o;if(e(t[s],s,t))return!0}return!1},b.contains=b.includes=b.include=function(t,e,i,r){return M(t)||(t=b.values(t)),("number"!=typeof i||r)&&(i=0),b.indexOf(t,e,i)>=0},b.invoke=function(t,e){var i=c.call(arguments,2),r=b.isFunction(e);return b.map(t,function(t){var n=r?e:t[e];return null==n?n:n.apply(t,i)})},b.pluck=function(t,e){return b.map(t,b.property(e))},b.where=function(t,e){return b.filter(t,b.matcher(e))},b.findWhere=function(t,e){return b.find(t,b.matcher(e))},b.max=function(t,e,i){var r,n,o=-1/0,s=-1/0;if(null==e&&null!=t){t=M(t)?t:b.values(t);for(var a=0,l=t.length;l>a;a++)r=t[a],r>o&&(o=r)}else e=C(e,i),b.each(t,function(t,i,r){n=e(t,i,r),(n>s||n===-1/0&&o===-1/0)&&(o=t,s=n)});return o},b.min=function(t,e,i){var r,n,o=1/0,s=1/0;if(null==e&&null!=t){t=M(t)?t:b.values(t);for(var a=0,l=t.length;l>a;a++)r=t[a],o>r&&(o=r)}else e=C(e,i),b.each(t,function(t,i,r){n=e(t,i,r),(s>n||1/0===n&&1/0===o)&&(o=t,s=n)});return o},b.shuffle=function(t){for(var e,i=M(t)?t:b.values(t),r=i.length,n=Array(r),o=0;r>o;o++)e=b.random(0,o),e!==o&&(n[o]=n[e]),n[e]=i[o];return n},b.sample=function(t,e,i){return null==e||i?(M(t)||(t=b.values(t)),t[b.random(t.length-1)]):b.shuffle(t).slice(0,Math.max(0,e))},b.sortBy=function(t,e,i){return e=C(e,i),b.pluck(b.map(t,function(t,i,r){return{value:t,index:i,criteria:e(t,i,r)}}).sort(function(t,e){var i=t.criteria,r=e.criteria;if(i!==r){if(i>r||void 0===i)return 1;if(r>i||void 0===r)return-1}return t.index-e.index}),"value")};var S=function(t){return function(e,i,r){var n={};return i=C(i,r),b.each(e,function(r,o){var s=i(r,o,e);t(n,r,s)}),n}};b.groupBy=S(function(t,e,i){b.has(t,i)?t[i].push(e):t[i]=[e]}),b.indexBy=S(function(t,e,i){t[i]=e}),b.countBy=S(function(t,e,i){b.has(t,i)?t[i]++:t[i]=1}),b.toArray=function(t){return t?b.isArray(t)?c.call(t):M(t)?b.map(t,b.identity):b.values(t):[]},b.size=function(t){return null==t?0:M(t)?t.length:b.keys(t).length},b.partition=function(t,e,i){e=C(e,i);var r=[],n=[];return b.each(t,function(t,i,o){(e(t,i,o)?r:n).push(t)}),[r,n]},b.first=b.head=b.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:b.initial(t,t.length-e)},b.initial=function(t,e,i){return c.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},b.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:b.rest(t,Math.max(0,t.length-e))},b.rest=b.tail=b.drop=function(t,e,i){return c.call(t,null==e||i?1:e)},b.compact=function(t){return b.filter(t,b.identity)};var P=function(t,e,i,r){for(var n=[],o=0,s=r||0,a=I(t);a>s;s++){var l=t[s];if(M(l)&&(b.isArray(l)||b.isArguments(l))){e||(l=P(l,e,i));var h=0,u=l.length;for(n.length+=u;u>h;)n[o++]=l[h++]}else i||(n[o++]=l)}return n};b.flatten=function(t,e){return P(t,e,!1)},b.without=function(t){return b.difference(t,c.call(arguments,1))},b.uniq=b.unique=function(t,e,i,r){b.isBoolean(e)||(r=i,i=e,e=!1),null!=i&&(i=C(i,r));for(var n=[],o=[],s=0,a=I(t);a>s;s++){var l=t[s],h=i?i(l,s,t):l;e?(s&&o===h||n.push(l),o=h):i?b.contains(o,h)||(o.push(h),n.push(l)):b.contains(n,l)||n.push(l)}return n},b.union=function(){return b.uniq(P(arguments,!0,!0))},b.intersection=function(t){
for(var e=[],i=arguments.length,r=0,n=I(t);n>r;r++){var o=t[r];if(!b.contains(e,o)){for(var s=1;i>s&&b.contains(arguments[s],o);s++);s===i&&e.push(o)}}return e},b.difference=function(t){var e=P(arguments,!0,!0,1);return b.filter(t,function(t){return!b.contains(e,t)})},b.zip=function(){return b.unzip(arguments)},b.unzip=function(t){for(var e=t&&b.max(t,I).length||0,i=Array(e),r=0;e>r;r++)i[r]=b.pluck(t,r);return i},b.object=function(t,e){for(var i={},r=0,n=I(t);n>r;r++)e?i[t[r]]=e[r]:i[t[r][0]]=t[r][1];return i},b.findIndex=e(1),b.findLastIndex=e(-1),b.sortedIndex=function(t,e,i,r){i=C(i,r,1);for(var n=i(e),o=0,s=I(t);s>o;){var a=Math.floor((o+s)/2);i(t[a])<n?o=a+1:s=a}return o},b.indexOf=i(1,b.findIndex,b.sortedIndex),b.lastIndexOf=i(-1,b.findLastIndex),b.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var r=Math.max(Math.ceil((e-t)/i),0),n=Array(r),o=0;r>o;o++,t+=i)n[o]=t;return n};var E=function(t,e,i,r,n){if(!(r instanceof e))return t.apply(i,n);var o=w(t.prototype),s=t.apply(o,n);return b.isObject(s)?s:o};b.bind=function(t,e){if(m&&t.bind===m)return m.apply(t,c.call(arguments,1));if(!b.isFunction(t))throw new TypeError("Bind must be called on a function");var i=c.call(arguments,2),r=function(){return E(t,r,e,this,i.concat(c.call(arguments)))};return r},b.partial=function(t){var e=c.call(arguments,1),i=function(){for(var r=0,n=e.length,o=Array(n),s=0;n>s;s++)o[s]=e[s]===b?arguments[r++]:e[s];for(;r<arguments.length;)o.push(arguments[r++]);return E(t,i,this,this,o)};return i},b.bindAll=function(t){var e,i,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(e=1;r>e;e++)i=arguments[e],t[i]=b.bind(t[i],t);return t},b.memoize=function(t,e){var i=function(r){var n=i.cache,o=""+(e?e.apply(this,arguments):r);return b.has(n,o)||(n[o]=t.apply(this,arguments)),n[o]};return i.cache={},i},b.delay=function(t,e){var i=c.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},b.defer=b.partial(b.delay,b,1),b.throttle=function(t,e,i){var r,n,o,s=null,a=0;i||(i={});var l=function(){a=i.leading===!1?0:b.now(),s=null,o=t.apply(r,n),s||(r=n=null)};return function(){var h=b.now();a||i.leading!==!1||(a=h);var u=e-(h-a);return r=this,n=arguments,0>=u||u>e?(s&&(clearTimeout(s),s=null),a=h,o=t.apply(r,n),s||(r=n=null)):s||i.trailing===!1||(s=setTimeout(l,u)),o}},b.debounce=function(t,e,i){var r,n,o,s,a,l=function(){var h=b.now()-s;e>h&&h>=0?r=setTimeout(l,e-h):(r=null,i||(a=t.apply(o,n),r||(o=n=null)))};return function(){o=this,n=arguments,s=b.now();var h=i&&!r;return r||(r=setTimeout(l,e)),h&&(a=t.apply(o,n),o=n=null),a}},b.wrap=function(t,e){return b.partial(e,t)},b.negate=function(t){return function(){return!t.apply(this,arguments)}},b.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,r=t[e].apply(this,arguments);i--;)r=t[i].call(this,r);return r}},b.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},b.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),1>=t&&(e=null),i}},b.once=b.partial(b.before,2);var R=!{toString:null}.propertyIsEnumerable("toString"),k=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];b.keys=function(t){if(!b.isObject(t))return[];if(g)return g(t);var e=[];for(var i in t)b.has(t,i)&&e.push(i);return R&&n(t,e),e},b.allKeys=function(t){if(!b.isObject(t))return[];var e=[];for(var i in t)e.push(i);return R&&n(t,e),e},b.values=function(t){for(var e=b.keys(t),i=e.length,r=Array(i),n=0;i>n;n++)r[n]=t[e[n]];return r},b.mapObject=function(t,e,i){e=C(e,i);for(var r,n=b.keys(t),o=n.length,s={},a=0;o>a;a++)r=n[a],s[r]=e(t[r],r,t);return s},b.pairs=function(t){for(var e=b.keys(t),i=e.length,r=Array(i),n=0;i>n;n++)r[n]=[e[n],t[e[n]]];return r},b.invert=function(t){for(var e={},i=b.keys(t),r=0,n=i.length;n>r;r++)e[t[i[r]]]=i[r];return e},b.functions=b.methods=function(t){var e=[];for(var i in t)b.isFunction(t[i])&&e.push(i);return e.sort()},b.extend=_(b.allKeys),b.extendOwn=b.assign=_(b.keys),b.findKey=function(t,e,i){e=C(e,i);for(var r,n=b.keys(t),o=0,s=n.length;s>o;o++)if(r=n[o],e(t[r],r,t))return r},b.pick=function(t,e,i){var r,n,o={},s=t;if(null==s)return o;b.isFunction(e)?(n=b.allKeys(s),r=x(e,i)):(n=P(arguments,!1,!1,1),r=function(t,e,i){return e in i},s=Object(s));for(var a=0,l=n.length;l>a;a++){var h=n[a],u=s[h];r(u,h,s)&&(o[h]=u)}return o},b.omit=function(t,e,i){if(b.isFunction(e))e=b.negate(e);else{var r=b.map(P(arguments,!1,!1,1),String);e=function(t,e){return!b.contains(r,e)}}return b.pick(t,e,i)},b.defaults=_(b.allKeys,!0),b.create=function(t,e){var i=w(t);return e&&b.extendOwn(i,e),i},b.clone=function(t){return b.isObject(t)?b.isArray(t)?t.slice():b.extend({},t):t},b.tap=function(t,e){return e(t),t},b.isMatch=function(t,e){var i=b.keys(e),r=i.length;if(null==t)return!r;for(var n=Object(t),o=0;r>o;o++){var s=i[o];if(e[s]!==n[s]||!(s in n))return!1}return!0};var D=function(t,e,i,r){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof b&&(t=t._wrapped),e instanceof b&&(e=e._wrapped);var n=d.call(t);if(n!==d.call(e))return!1;switch(n){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var o="[object Array]"===n;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(b.isFunction(s)&&s instanceof s&&b.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],r=r||[];for(var l=i.length;l--;)if(i[l]===t)return r[l]===e;if(i.push(t),r.push(e),o){if(l=t.length,l!==e.length)return!1;for(;l--;)if(!D(t[l],e[l],i,r))return!1}else{var h,u=b.keys(t);if(l=u.length,b.keys(e).length!==l)return!1;for(;l--;)if(h=u[l],!b.has(e,h)||!D(t[h],e[h],i,r))return!1}return i.pop(),r.pop(),!0};b.isEqual=function(t,e){return D(t,e)},b.isEmpty=function(t){return null==t||(M(t)&&(b.isArray(t)||b.isString(t)||b.isArguments(t))?0===t.length:0===b.keys(t).length)},b.isElement=function(t){return!(!t||1!==t.nodeType)},b.isArray=f||function(t){return"[object Array]"===d.call(t)},b.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},b.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){b["is"+t]=function(e){return d.call(e)==="[object "+t+"]"}}),b.isArguments(arguments)||(b.isArguments=function(t){return b.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(b.isFunction=function(t){return"function"==typeof t||!1}),b.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},b.isNaN=function(t){return b.isNumber(t)&&t!==+t},b.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===d.call(t)},b.isNull=function(t){return null===t},b.isUndefined=function(t){return void 0===t},b.has=function(t,e){return null!=t&&p.call(t,e)},b.noConflict=function(){return o._=s,this},b.identity=function(t){return t},b.constant=function(t){return function(){return t}},b.noop=function(){},b.property=T,b.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},b.matcher=b.matches=function(t){return t=b.extendOwn({},t),function(e){return b.isMatch(e,t)}},b.times=function(t,e,i){var r=Array(Math.max(0,t));e=x(e,i,1);for(var n=0;t>n;n++)r[n]=e(n);return r},b.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},b.now=Date.now||function(){return(new Date).getTime()};var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=b.invert(L),F=function(t){var e=function(e){return t[e]},i="(?:"+b.keys(t).join("|")+")",r=RegExp(i),n=RegExp(i,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(n,e):t}};b.escape=F(L),b.unescape=F(N),b.result=function(t,e,i){var r=null==t?void 0:t[e];return void 0===r&&(r=i),b.isFunction(r)?r.call(t):r};var O=0;b.uniqueId=function(t){var e=++O+"";return t?t+e:e},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,U={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},z=/\\|'|\r|\n|\u2028|\u2029/g,j=function(t){return"\\"+U[t]};b.template=function(t,e,i){!e&&i&&(e=i),e=b.defaults({},e,b.templateSettings);var r=RegExp([(e.escape||B).source,(e.interpolate||B).source,(e.evaluate||B).source].join("|")+"|$","g"),n=0,o="__p+='";t.replace(r,function(e,i,r,s,a){return o+=t.slice(n,a).replace(z,j),n=a+e.length,i?o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}var a=function(t){return s.call(this,t,b)},l=e.variable||"obj";return a.source="function("+l+"){\n"+o+"}",a},b.chain=function(t){var e=b(t);return e._chain=!0,e};var G=function(t,e){return t._chain?b(e).chain():e};b.mixin=function(t){b.each(b.functions(t),function(e){var i=b[e]=t[e];b.prototype[e]=function(){var t=[this._wrapped];return u.apply(t,arguments),G(this,i.apply(b,t))}})},b.mixin(b),b.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];b.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],G(this,i)}}),b.each(["concat","join","slice"],function(t){var e=a[t];b.prototype[t]=function(){return G(this,e.apply(this._wrapped,arguments))}}),b.prototype.value=function(){return this._wrapped},b.prototype.valueOf=b.prototype.toJSON=b.prototype.value,b.prototype.toString=function(){return""+this._wrapped},"function"==typeof r&&r.amd&&r("underscore",[],function(){return b})}.call(this),r("underscore-min",function(t){return function(){var e,i;return i=function(){return _.noConflict()},e=i.apply(t,arguments),e||t._}}(this)),r("Utils/Constants",[],function(){var t=function(){};return t.ANIMATION={Inertia:"Inertia",Interpolated:"Interpolated",Path:"Path",Segmented:"Segmented"},t.CONTEXT={Planet:"Planet",Sky:"Sky"},t.GLOBE={Planet:"Planet",Sky:"Sky"},t.LAYER={WMS:"WMS",WMTS:"WMTS",WMSElevation:"WMSElevation",WCSElevation:"WCSElevation",GeoJSON:"GeoJSON",Vector:"Vector",Atmosphere:"Atmosphere",Bing:"Bing",GroundOverlay:"GroundOverlay",OSM:"OSM",TileWireframe:"TileWireframe",HipsGrid:"HipsGrid",CoordinateGrid:"CoordinateGrid",HipsFits:"HipsFits",Hips:"Hips",HipsCat:"HipsCat",Moc:"Moc",OpenSearch:"OpenSearch",Planet:"Planet"},t.GEOMETRY={Point:"Point",MultiPoint:"MultiPoint",LineString:"LineString",MultiLineString:"MultiLineString",Polygon:"Polygon",MultiPolygon:"MultiPolygon",GeometryCollection:"GeometryCollection"},t.PROJECTION={Aitoff:"Aitoff",August:"August",Mercator:"Mercator",Mollweide:"Mollweide",Plate:"Plate",Azimuth:"Azimuth"},t.CRS={Equatorial:"Equatorial",Galactic:"Galactic",WGS84:"EPSG:4326",Mars_2000:"IAU2000:49901",Mars_2000_old:"IAU2000:49900"},t.NAVIGATION={AstroNavigation:"AstroNavigation",PlanetNavigation:"PlanetNavigation",FlatNavigation:"FlatNavigation"},t.SERVICE={FitsVisu:"FitsVisu",Histogram:"Histogram",ImageProcessing:"ImageProcessing",MeasureToolSky:"MeasureToolSky",MeasureToolPlanet:"MeasureToolPlanet",MocBase:"MocBase",MollweideViewer:"MollweideViewer",PickingManager:"PickingManager",Samp:"Samp",SelectionTool:"SelectionTool",NameResolver:"NameResolver",ReverseNameResolver:"ReverseNameResolver"},t.HANDLER={Touch:"Touch",Keyboard:"Keyboard",Mouse:"Mouse",GoogleMouse:"GoogleMouse"},t.PROVIDER={Constellation:"Constellation",OpenSearch:"OpenSearch",Planet:"Planet",Star:"Star",Crater:"Crater"},t.MappingCrsHips2Mizar={equatorial:"Equatorial",galactic:"Galactic",ecliptic:"Ecliptic"},t.UTILITY={Fits:"Fits",Intersection:"Intersection",Numeric:"Numeric",CreateStyle:"CreateStyle",FeatureStyle:"FeatureStyle"},t.ANIMATION_STATUS={STOPPED:"STOPPED",RUNNING:"RUNNING",PAUSED:"PAUSED"},t}),r("Utils/Utils",[],function(){function t(t,e,i){var r,n,o,s=Math.floor(6*t),a=6*t-s,l=i*(1-e),h=i*(1-a*e),u=i*(1-(1-a)*e);switch(s){case 0:r=i,n=u,o=l;break;case 1:r=h,n=i,o=l;break;case 2:r=l,n=i,o=u;break;case 3:r=l,n=h,o=i;break;case 4:r=u,n=l,o=i;break;case 5:r=i,n=l,o=h;break;default:r=1,n=1,o=1}return[r,n,o]}var e={};return e.inherits=function(t,e){function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},e.generateColor=function(){var e=.618033988749895,i=Math.random();return i+=e,i%=1,t(i,.5,.95)},e}),r("Utils/Event",[],function(){var t=function(){this.callbacks={}};return t.prototype.subscribe=function(t,e){this.callbacks[t]?this.callbacks[t].push(e):this.callbacks[t]=[e]},t.prototype.unsubscribe=function(t,e){if(this.callbacks[t]){var i=this.callbacks[t].indexOf(e);i!==-1&&this.callbacks[t].splice(i,1)}},t.prototype.publish=function(t,e){if(this.callbacks[t])for(var i=this.callbacks[t],r=0;r<i.length;r++)i[r](e)},t}),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};t="undefined"!=typeof exports&&null!==exports&&this||(this.WCS={}),t.Math={},t.Math.R2D=180/Math.PI,t.Math.D2R=Math.PI/180,t.Math.WCSTRIG_TOL=1e-10,t.Math.cosd=function(e){var i;if(e%90===0)switch(i=Math.abs(Math.floor(e/90+.5))%4){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}return Math.cos(e*t.Math.D2R)},t.Math.sind=function(e){var i;if(e%90===0)switch(i=Math.abs(Math.floor(e/90-.5))%4){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}return Math.sin(e*t.Math.D2R)},t.Math.sincosd=function(e){var i,r,n,o,s;if(e%90===0){switch(r=Math.abs(Math.floor(e/90+.5))%4){case 0:n=0,i=1;break;case 1:n=null!=(o=e>0)?o:{1:-1},i=0;break;case 2:n=0,i=-1;break;case 3:n=null!=(s=e>0)?s:-{1:1},i=0}return n*i}return n=Math.sin(e*t.Math.D2R),i=Math.cos(e*t.Math.D2R),n*i},t.Math.tand=function(e){var i;return i=360&e,0===i||180===Math.abs(i)?0:45===i||225===i?1:i===-135||i===-315?-1:Math.tan(e*t.Math.D2R)},t.Math.acosd=function(e){if(e>=1){if(e-1<t.Math.WCSTRIG_TOL)return 0}else{if(0===e)return 90;if(e<=-1&&e+1>-t.Math.WCSTRIG_TOL)return 180}return Math.acos(e)*t.Math.R2D},t.Math.asind=function(e){if(e<=-1){if(e+1>-t.Math.WCSTRIG_TOL)return-90;if(0===e)return 0;if(e>=1&&e-1<t.Math.WCSTRIG_TOL)return 90}return Math.asin(e)*t.Math.R2D},t.Math.atand=function(e){return e===-1?-45:0===e?0:1===e?45:Math.atan(e)*t.Math.R2D},t.Math.atan2d=function(e,i){if(0===e){if(i>=0)return 0;if(i<0)return 180}else if(0===i){if(e>0)return 90;if(e<0)return-90}return Math.atan2(e,i)*t.Math.R2D},t.Math.toRightTriangular=function(t){var e,i,r,n,o,s,a,l,h;for(a=t.length,n=a,o=t[0].length;;){if(i=n-a,0===t[i][i])for(r=i+1;r<n;){if(0!==t[r][i]){for(e=[],l=o;;)if(h=o-l,e.push(t[i][h]+t[r][h]),!--l)break;t[i]=e;break}r+=1}if(0!==t[i][i])for(r=i+1;r<n;){for(s=t[r][i]/t[i][i],e=[],l=o;;)if(h=o-l,e.push(h<=i?0:t[r][h]-t[i][h]*s),!--l)break;t[r]=e,r+=1}if(!--a)break}return t},t.Math.determinant=function(e){var i,r,n,o,s;for(o=t.Math.toRightTriangular(e),i=o[0][0],s=o.length-1,n=s;;)if(r=n-s+1,i*=o[r][r],!--s)break;return i},t.Math.matrixInverse=function(e){var i,r,n,o,s,a,l,h;for(h=e[0].length,r=e.length,i=new Array(r),o=new Array(r),l=[],a=[],s=0;s<r;){for(a[s]=[],n=0;n<h;)a[s][n]=e[s][n],n+=1;s+=1}for(s=0;s<r;){for(i[s]=new Array(h),o[s]=new Array(h),n=0;n<h;)i[s][n]=n===s?1:0,n+=1;l[s]=a[s].concat(i[s]),s+=1}for(t.Math.gaussJordan(l),s=0;s<r;)o[s]=l[s].slice(h,2*h),s+=1;return o},t.Math.gaussJordan=function(t,e){e||(e=1e-10);var i,r,n,o,s,a,l,h;for(i=t.length,r=t[0].length,n=-1;++n<i;){for(a=n,o=n;++o<i;)Math.abs(t[o][n])>Math.abs(t[a][n])&&(a=o);if(l=t[n],t[n]=t[a],t[a]=l,Math.abs(t[n][n])<=e)return!1;for(o=n;++o<i;)for(h=t[o][n]/t[n][n],s=n-1;++s<r;)t[o][s]-=t[n][s]*h}for(n=i;--n>=0;){for(h=t[n][n],o=-1;++o<n;)for(s=r;--s>=n;)t[o][s]-=t[n][s]*t[o][n]/h;for(t[n][n]/=h,s=i-1;++s<r;)t[n][s]/=h}return!0},t.Mapper=function(){function r(t){this.coordinateToPixel=e(this.coordinateToPixel,this),this.pixelToCoordinate=e(this.pixelToCoordinate,this),this.fromCelestial=e(this.fromCelestial,this),this.toCelestial=e(this.toCelestial,this),this.fromIntermediate=e(this.fromIntermediate,this),this.toIntermediate=e(this.toIntermediate,this),this.computeCelestialParameters=e(this.computeCelestialParameters,this),this.getSipCoefficients=e(this.getSipCoefficients,this),this.setProjection=e(this.setProjection,this),this.derivePC=e(this.derivePC,this),this.checkCard=e(this.checkCard,this),this.verifyHeader=e(this.verifyHeader,this),this.wcsobj={},this.projection=void 0,this.longitudeAxis=void 0,this.latitudeAxis=void 0,this.sip=void 0,this.verifyHeader(t),this.setProjection(t)}return r.prototype.verifyHeader=function(e){var i,r,n,o,s,a,l,h,u,c,d;for(this.wcsobj.naxis=a=e.NAXIS||e.WCSAXES||2,this.wcsobj.radesys=e.RADESYS||"ICRS",l=["CRPIX","CRVAL","CTYPE"],this.wcsobj.crpix=[],this.wcsobj.crval=[],this.wcsobj.ctype=[],r=h=1;1<=a?h<=a:h>=a;r=1<=a?++h:--h)for(o=u=0,d=l.length-1;0<=d?u<=d:u>=d;o=0<=d?++u:--u){if(s=l[o]+r,!e.hasOwnProperty(s))throw"Not enough information to compute WCS, missing required keyword "+s;i=l[o].toLowerCase(),this.wcsobj[i].push(e[s])}for(this.wcsobj.cunit=[],this.wcsobj.cdelt=[],r=c=1;1<=a?c<=a:c>=a;r=1<=a?++c:--c)s="CUNIT"+r,this.wcsobj.cunit.push(e[s]||"deg"),s="CDELT"+r,this.wcsobj.cdelt.push(e[s]||1);if(this.wcsobj.lonpole=e.LONPOLE||0,this.wcsobj.latpole=e.LATPOLE||0,this.wcsobj.equinox=e.EQUINOX||2e3,n=new Date,this.wcsobj.dateObs=e.DATE_OBS||n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),this.wcsobj.dateObs=e.DATE_OBS||""+n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),this.wcsobj.pc=this.checkCard(e,"PC",a)||this.derivePC(e),this.wcsobj.pcInv=t.Math.matrixInverse(this.wcsobj.pc),this.wcsobj.cd=this.checkCard(e,"CD",a),null!=this.wcsobj.cd)return this.wcsobj.cdInv=t.Math.matrixInverse(this.wcsobj.cd)},r.prototype.checkCard=function(t,e,i){var r,n,o,s,a,l;for(s=[],n=a=1;1<=i?a<=i:a>=i;n=1<=i?++a:--a)for(s[n-1]=[],o=l=1;1<=i?l<=i:l>=i;o=1<=i?++l:--l){if(r=""+e+n+"_"+o,!t.hasOwnProperty(r))return;s[n-1].push(t[r])}return s},r.prototype.derivePC=function(t){var e,i,r,n,o,s,a,l,h,u,c;return t.hasOwnProperty("CROTA2")?(a=t.CROTA2,l=this.wcsobj.cdelt[1]/this.wcsobj.cdelt[0]):(e=this.checkCard(t,"CD",this.wcsobj.naxis),null==e?(c=[0,1],a=c[0],l=c[1]):(i=e[0][0],r=e[0][1],n=e[1][0],o=e[1][1],h=n>0?Math.atan2(n,i):0===n?0:Math.atan2(-n,-i),u=r>0?Math.atan2(r,-o):0===r?0:Math.atan2(-n,o),a=.5*(h+u),s=Math.cos(a),this.wcsobj.cdelt1=i/s,this.wcsobj.cdelt2=o/s,l=this.wcsobj.cdelt2/this.wcsobj.cdelt1)),e},r.prototype.setProjection=function(e){var r,n,o,s,a,l,h,u,c,d,p,f,g,m,v,y,b,x,C=this;if(c=["AIR","ARC","AZP","NCP","SIN","STG","SZP","TAN","TAN-SIP","ZEA","ZPN"],n=["CYP","CEA","CAR","MER","SFL","PAR","MOL","AIT"],r=["COP","COE","COD","COO"],h=["BON","PCO"],u=["TSC","CSC","QSC"],this.projection=this.wcsobj.ctype[0].slice(5),this.longitudeAxis=this.wcsobj.ctype[0].match("RA|GLON|ELON|HLON|SLON")?1:2,this.latitudeAxis=this.wcsobj.ctype[1].match("DEC|GLAT|ELAT|HLAT|SLAT")?2:1,d=this.projection,i.call(c,d)>=0)switch(this.wcsobj.phi0=0,this.wcsobj.theta0=90,this.wcsobj.alphaP=this.wcsobj.crval[0],this.wcsobj.deltaP=this.wcsobj.crval[1],this.wcsobj.lonpole=this.wcsobj.crval[1]>=this.wcsobj.theta0?0:180,this.projection){case"AIR":o="PV"+this.latitudeAxis+"_1",this.wcsobj.thetaB=e.hasOwnProperty(o)?parseFloat(e[o]):90,this.wcsobj.etaB=(90-this.wcsobj.thetaB)/2;break;case"ARC":this.toSpherical=function(e,i){var r,n,o;return n=Math.sqrt(e*e+i*i),o=C.wcsobj.theta0-n,r=t.Math.atan2d(e,-i),[r,o]},this.fromSpherical=function(e,i){var r,n,o;return r=90-i,n=r*t.Math.sind(e),o=-r*t.Math.cosd(e),[n,o]};break;case"AZP":p=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2"],s=p[0],a=p[1],this.wcsobj.mu=e.hasOwnProperty(s)?parseFloat(e[s]):0,this.wcsobj.gamma=e.hasOwnProperty(a)?parseFloat(e[a]):0,this.toSpherical=function(t,e){throw"Sorry, not yet implemented!"},this.fromSpherical=function(t,e){throw"Sorry, not yet implemented!"};break;case"NCP":this.toSpherical=function(t,e){throw"Sorry, not yet implemented!"},this.fromSpherical=function(t,e){throw"Sorry, not yet implemented!"};break;case"SIN":f=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2"],s=f[0],a=f[1],this.wcsobj.eta=e.hasOwnProperty(s)?parseFloat(e[s]):0,this.wcsobj.nu=e.hasOwnProperty(a)?parseFloat(e[a]):0,this.toSpherical=function(e,i){var r,n,o;return n=Math.sqrt(e*e+i*i),o=t.Math.acosd(Math.PI*n/180),r=t.Math.atan2d(e,-i),[r,o]},this.fromSpherical=function(e,i){var r,n,o;return r=180/Math.PI*t.Math.cosd(i),n=r*t.Math.sind(e),o=-r*t.Math.cosd(e),[n,o]};break;case"STG":this.toSpherical=function(e,i){var r,n,o;return n=Math.sqrt(e*e+i*i),o=C.wcsobj.theta0-2*t.Math.atand(Math.PI*n/360),r=t.Math.atan2d(e,-i),[r,o]},this.fromSpherical=function(e,i){var r,n,o;return r=360/Math.PI*t.Math.tand((90-i)/2),n=r*t.Math.sind(e),o=-r*t.Math.cosd(e),[n,o]};break;case"SZP":g=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2","PV"+this.latitudeAxis+"_3"],s=g[0],a=g[1],l=g[2],this.wcsobj.mu=e.hasOwnProperty(s)?parseFloat(e[s]):0,this.wcsobj.phiC=e.hasOwnProperty(a)?parseFloat(e[a]):0,this.wcsobj.thetaC=e.hasOwnProperty(l)?parseFloat(e[l]):90,this.wcsobj.xp=-this.wcsobj.mu*t.Math.cosd(this.wcsobj.thetaC)*t.Math.sind(this.wcsobj.phiC),this.wcsobj.yp=this.wcsobj.mu*t.Math.cosd(this.wcsobj.thetaC)*t.Math.cosd(this.wcsobj.phiC),this.wcsobj.zp=this.wcsobj.mu*t.Math.sind(this.wcsobj.thetaC)+1,this.toSpherical=function(t,e){throw"Sorry, not yet implemented"},this.fromSpherical=function(e,i){var r,n,o;throw"Sorry, not yet implemented";return r=C.wcsobj.zp-1+t.Math.sind(i),n=180/Math.PI*(C.wcsobj.zp*t.Math.cosd(i)*t.Math.sind(e)-C.wcsobj.xp*(1-t.Math.sind(i)))/r,o=-180/Math.PI*(C.wcsobj.zp*t.Math.cosd(i)*t.Math.cosd(e)+C.wcsobj.yp*(1-t.Math.sind(i)))/r,[n,o]};break;case"TAN":this.toSpherical=function(e,i){var r,n,o;return n=Math.sqrt(e*e+i*i),o=t.Math.atand(180/(Math.PI*n)),r=t.Math.atan2d(e,-i),[r,o]},this.fromSpherical=function(e,i){var r,n,o;return r=180/(Math.PI*t.Math.tand(i)),n=r*t.Math.sind(e),o=-r*t.Math.cosd(e),[n,o]};break;case"TAN-SIP":this.getSipCoefficients(e),this.f=function(t,e,i){var r,n,o,s,a,l;for(s=0,r=i[0].length-1,n=a=0;0<=r?a<=r:a>=r;n=0<=r?++a:--a)for(o=l=0;0<=r?l<=r:l>=r;o=0<=r?++l:--l)s+=i[n][o]*Math.pow(t,n)*Math.pow(e,o);return s},this.toIntermediate=function(t){var e,i,r,n,o,s,a,l,h,u,c;for(o=[],s=t[0]-C.wcsobj.crpix[0],a=t[1]-C.wcsobj.crpix[1],e=i=0,e=C.f(s,a,C.sip.aCoeffs),i=C.f(s,a,C.sip.bCoeffs),t[0]=t[0]+e,t[1]=t[1]+i,r=l=0,u=C.wcsobj.naxis-1;0<=u?l<=u:l>=u;r=0<=u?++l:--l)for(o[r]=0,t[r]-=C.wcsobj.crpix[r],n=h=0,c=C.wcsobj-1;0<=c?h<=c:h>=c;n=0<=c?++h:--h)o[r]+=C.wcsobj.cd[r][n]*t[n];return o},this.fromIntermediate=function(t){var e,i,r,n,o,s,a,l,h,u;for(s=[],r=a=0,h=C.wcsobj.naxis-1;0<=h?a<=h:a>=h;r=0<=h?++a:--a){for(s[r]=0,n=l=0,u=C.wcsobj.naxis-1;0<=u?l<=u:l>=u;n=0<=u?++l:--l)s[r]+=C.wcsobj.cdInv[r][n]*t[n];s[r]+=C.wcsobj.crpix[r]}return e=i=0,e=C.f(s[0],s[1],C.sip.apCoeffs),i=C.f(s[0],s[1],C.sip.bpCoeffs),o=[],o[0]=s[0]+e,o[1]=s[1]+i,o[0]+=C.wcsobj.crpix[0],o[1]+=C.wcsobj.crpix[1],o},this.toSpherical=function(e,i){var r,n,o;return n=Math.sqrt(e*e+i*i),o=t.Math.atand(180/(Math.PI*n)),r=t.Math.atan2d(e,-i),[r,o]},this.fromSpherical=function(e,i){var r,n,o;return r=180/(Math.PI*t.Math.tand(i)),n=r*t.Math.sind(e),o=-r*t.Math.cosd(e),[n,o]};break;case"ZEA":this.toSpherical=function(e,i){var r,n,o;return n=Math.sqrt(e*e+i*i),o=C.wcsobj.theta0-2*t.Math.asind(Math.PI*n/360),r=t.Math.atan2d(e,-i),[r,o]},this.fromSpherical=function(e,i){var r,n,o;return r=360/Math.PI*t.Math.sind((90-i)/2),n=r*t.Math.sind(e),o=-r*t.Math.cosd(e),[n,o]};break;case"ZPN":this.toSpherical=function(t,e){throw"Sorry, not yet implemented!"},this.fromSpherical=function(t,e){throw"Sorry, not yet implemented!"}}if(m=this.projection,i.call(n,m)>=0)switch(this.wcsobj.phi0=0,this.wcsobj.theta0=0,this.computeCelestialParameters(this.wcsobj.phi0,this.wcsobj.theta0),this.projection){case"CYP":v=["PV"+this.latitudeAxis+"_1,","PV"+this.latitudeAxis+"_2"],s=v[0],a=v[1],this.wcsobj.mu=e.hasOwnProperty(s)?parseFloat(e[s]):1,this.wcsobj.lambda=e.hasOwnProperty(a)?parseFloat(e[a]):1,this.wcsobj.mu+this.wcsobj.lambda===0&&raise("Divide by zero error"),this.toSpherical=function(e,i){var r,n,o;return r=Math.PI*i/(180*(C.wcsobj.mu+C.wcsobj.lambda)),o=t.Math.atan2d(r,1)+t.Math.asind(r*C.wcsobj.mu/Math.sqrt(r*r+1)),n=e/C.wcsobj.lambda,[n,o]},this.fromSpherical=function(e,i){var r,n;return r=C.wcsobj.lambda*e,n=180/Math.PI*((C.wcsobj.mu+C.wcsobj.lambda)/(C.wcsobj.mu+t.Math.cosd(i)))*t.Math.sind(i),[r,n]};break;case"CEA":o="PV"+this.latitudeAxis+"_1",this.wcsobj.lambda=e.hasOwnProperty(o)?parseFloat(e[o]):1,this.toSpherical=function(e,i){var r;return r=t.Math.asind(Math.PI*C.wcsobj.lambda*i/180),[e,r]},this.fromSpherical=function(e,i){var r;return r=180/Math.PI*t.Math.sind(i)/C.wcsobj.lambda,[e,r]};break;case"CAR":this.toSpherical=function(t,e){return[t,e]},this.fromSpherical=function(t,e){return[t,e]};break;case"MER":this.toSpherical=function(e,i){var r;return r=2*t.Math.atand(Math.exp(i*Math.PI/180))-90,[e,r]},this.fromSpherical=function(e,i){var r;return r=180/Math.PI*Math.log(t.Math.tand((90+i)/2)),[e,r]};break;case"SFL":this.toSpherical=function(e,i){var r;return r=e/t.Math.cosd(i),[r,i]},this.fromSpherical=function(e,i){var r;return r=e*t.Math.cosd(i),[r,i]};break;case"PAR":this.toSpherical=function(e,i){var r,n;return n=3*t.Math.asind(i/180),r=e/(1-4*Math.pow(i/180,2)),[r,n]},this.fromSpherical=function(e,i){var r,n;return r=e*(2*t.Math.cosd(2*i/3)-1),n=180*t.Math.sind(i/3),[r,n]};break;case"MOL":this.toSpherical=function(e,i){var r,n;return n=t.Math.asind(t.Math.asind(Math.PI*i/(180*Math.sqrt(2)))/90+i/180*Math.sqrt(2-Math.pow(Math.PI*i/180,2))),r=Math.PI*e/(2*Math.sqrt(2-Math.pow(Math.PI*i/180,2))),[r,n]},this.fromSpherical=function(e,i){var r,n;throw"Sorry, not yet implemented!";return r=2*Math.sqrt(2)/Math.PI*e*t.Math.cosd(gamma),n=180*Math.sqrt(2)/Math.PI*t.Math.sind(gamma),[r,n]};break;case"AIT":this.toSpherical=function(e,i){var r,n,o,s,a;return o=Math.pow(Math.PI*e/720,2),s=Math.pow(Math.PI*i/360,2),a=Math.sqrt(1-o-s),n=t.Math.asind(Math.PI*i*a/180),r=2*t.Math.atan2d(Math.PI*a*e/360,2*a*a-1),[r,n]},this.fromSpherical=function(e,i){var r,n,o;return r=180/Math.PI*Math.sqrt(2/(1+t.Math.cosd(i)*t.Math.cosd(e/2))),n=2*r*t.Math.cosd(i)*t.Math.sind(e/2),o=r*t.Math.sind(i),[n,o]}}if(y=this.projection,i.call(r,y)>=0)throw o="PV"+this.latitudeAxis+"_1",this.wcsobj.phi0=0,this.wcsobj.theta0=e.hasOwnProperty(o)?e[o]:0,"Sorry, not yet implemented!";if(b=this.projection,i.call(h,b)>=0)throw this.wcsobj.phi0=0,this.wcsobj.theta0=0,"Sorry, not yet implemented!";if(x=this.projection,i.call(u,x)>=0)throw this.wcsobj.phi0=0,this.wcsobj.theta0=0,"Sorry, not yet implemented!"},r.prototype.getSipCoefficients=function(t){var e,i,r,n,o,s,a,l,h,u,c,d,p,f,g,m,v,y,b;if(!t.hasOwnProperty("A_ORDER")&&!t.hasOwnProperty("B_ORDER"))throw"What's the polynomial order, man!";for(this.sip={},this.sip.aOrder=t.A_ORDER,this.sip.bOrder=t.B_ORDER,this.sip.apOrder=t.AP_ORDER||0,this.sip.bpOrder=t.BP_ORDER||0,this.sip.aCoeffs=[],this.sip.bCoeffs=[],this.sip.apCoeffs=[],this.sip.bpCoeffs=[],e=n=0,d=this.sip.aOrder;0<=d?n<=d:n>=d;e=0<=d?++n:--n)for(this.sip.aCoeffs[e]=[],i=o=0,p=this.sip.aOrder;0<=p?o<=p:o>=p;i=0<=p?++o:--o)r="A_"+e+"_"+i,this.sip.aCoeffs[e][i]=t[r]||0;for(e=s=0,f=this.sip.bOrder;0<=f?s<=f:s>=f;e=0<=f?++s:--s)for(this.sip.bCoeffs[e]=[],i=a=0,g=this.sip.bOrder;0<=g?a<=g:a>=g;i=0<=g?++a:--a)r="B_"+e+"_"+i,this.sip.bCoeffs[e][i]=t[r]||0;for(e=l=0,m=this.sip.apOrder;0<=m?l<=m:l>=m;e=0<=m?++l:--l)for(this.sip.apCoeffs[e]=[],i=h=0,v=this.sip.apOrder;0<=v?h<=v:h>=v;i=0<=v?++h:--h)r="AP_"+e+"_"+i,this.sip.apCoeffs[e][i]=t[r]||0;for(e=u=0,y=this.sip.bpOrder;0<=y?u<=y:u>=y;e=0<=y?++u:--u)for(this.sip.bpCoeffs[e]=[],i=c=0,b=this.sip.bpOrder;0<=b?c<=b:c>=b;i=0<=b?++c:--c)r="BP_"+e+"_"+i,this.sip.bpCoeffs[e][i]=t[r]||0;if(!this.sip.aCoeffs&&!this.sip.bCoeffs)throw"Where are the coefficients dude!"},r.prototype.computeCelestialParameters=function(e,i){var r,n,o,s,a,l,h,u,c,d,p,f;return p=this.wcsobj.crval,r=p[0],n=p[1],f=[this.wcsobj.lonpole,this.wcsobj.latpole],h=f[0],d=f[1],o=t.Math.atan2d(t.Math.sind(this.wcsobj.theta0),t.Math.cosd(this.wcsobj.theta0*t.Math.cosd(h-this.wcsobj.phi0))),s=t.Math.acosd(t.Math.sind(n)/Math.sqrt(1-Math.pow(t.Math.cosd(this.wcsobj.theta0),2)*Math.pow(t.Math.sind(h-this.wcsobj.phi0),2))),u=c=!1,o+s>=-90&&o+s<=90&&(u=!0),o-s>=-90&&o-s<=90&&(c=!0),u&&c?(a=Math.abs(o+s-d),l=Math.abs(o-s-d),this.wcsobj.deltaP=a<l?o+s:o-s):u?this.wcsobj.deltaP=o+s:c?this.wcsobj.deltaP=o-s:this.wcsobj.deltaP=d,this.wcsobj.alphaP=90===Math.abs(n)?r:r-t.Math.asind(t.Math.sind(h-this.wcsobj.phi0)*t.Math.cosd(this.wcsobj.theta0)/t.Math.cosd(n))},r.prototype.toIntermediate=function(t){var e,i,r,n,o,s,a;for(r=[],e=n=0,s=this.wcsobj.naxis-1;0<=s?n<=s:n>=s;e=0<=s?++n:--n)for(r[e]=0,t[e]-=this.wcsobj.crpix[e],i=o=0,a=this.wcsobj.naxis-1;0<=a?o<=a:o>=a;i=0<=a?++o:--o)r[e]+=this.wcsobj.cdelt[e]*this.wcsobj.pc[e][i]*t[i];return r},r.prototype.fromIntermediate=function(t){var e,i,r,n,o,s,a;for(r=[],e=n=0,s=this.wcsobj.naxis-1;0<=s?n<=s:n>=s;e=0<=s?++n:--n){for(r[e]=0,i=o=0,a=this.wcsobj.naxis-1;0<=a?o<=a:o>=a;i=0<=a?++o:--o)r[e]+=this.wcsobj.pcInv[e][i]*t[i]/this.wcsobj.cdelt[e];r[e]+=this.wcsobj.crpix[e]}return r},r.prototype.toCelestial=function(e,i){var r,n,o,s,a,l,h,u,c,d,p;return u=t.Math.sind(i),o=t.Math.cosd(i),h=t.Math.sind(e-this.wcsobj.lonpole),n=t.Math.cosd(e-this.wcsobj.lonpole),l=t.Math.sind(this.wcsobj.deltaP),r=t.Math.cosd(this.wcsobj.deltaP),c=u*r-o*l*n,d=-o*h,p=u*l+o*r*n,a=t.Math.atan2d(d,c)+this.wcsobj.alphaP,a=(a+360)%360,s=t.Math.asind(p),[a,s]},r.prototype.fromCelestial=function(e,i){var r,n,o,s,a,l,h,u,c,d;return l=t.Math.sind(i),n=t.Math.cosd(i),h=t.Math.sind(this.wcsobj.deltaP),o=t.Math.cosd(this.wcsobj.deltaP),a=t.Math.sind(e-this.wcsobj.alphaP),r=t.Math.cosd(e-this.wcsobj.alphaP),c=l*o-n*h*r,d=-n*a,s=this.wcsobj.lonpole+t.Math.atan2d(d,c),u=t.Math.asind(l*h+n*o*r),[s,u]},r.prototype.pixelToCoordinate=function(){var t;return t=this.toIntermediate(arguments[0],arguments[1]),t=this.toSpherical(t[0],t[1]),t=this.toCelestial(t[0],t[1]),{ra:t[this.longitudeAxis-1],dec:t[this.latitudeAxis-1]}},r.prototype.coordinateToPixel=function(){var t;return t=this.fromCelestial(arguments[0],arguments[1]),t=this.fromSpherical(t[0],t[1]),t=this.fromIntermediate(t),{x:t[0],y:t[1]}},r}()}.call(this),r("wcs",function(){}),r("Utils/UtilsFits",["wcs"],function(t){function e(e,i){var r=t.pixelToCoordinate([e,i]);return[r.ra,r.dec]}var i={};return i.getPolygonCoordinatesFromFits=function(i){var r=i.getHDU(),n=r.data;t=new WCS.Mapper(r.header);var o=[];return o.push(e(0,n.height)),o.push(e(n.width,n.height)),o.push(e(n.width,0)),o.push(e(0,0)),o.push(o[0]),o},i}),r("Utils/Numeric",[],function(){var t={};return t.lerp=function(t,e,i){return e+(i-e)*t},t.coserp=function(t,e,i){var r=(1-Math.cos(t*Math.PI))/2;return e+(i-e)*r},t.cubicInterpolation=function(t,e,i,r,n){var o=t*t,s=o*t,a=2*e[0]-2*r[0]+i[0]+n[0],l=2*e[1]-2*r[1]+i[1]+n[1],h=2*e[2]-2*r[2]+i[2]+n[2],u=-3*e[0]+3*r[0]-2*i[0]-n[0],c=-3*e[1]+3*r[1]-2*i[1]-n[1],d=-3*e[2]+3*r[2]-2*i[2]-n[2],p=vec3.create();return p[0]=a*s+u*o+i[0]*t+e[0],p[1]=l*s+c*o+i[1]*t+e[1],p[2]=h*s+d*o+i[2]*t+e[2],p},t.cubicInterpolationDerivative=function(t,e,i,r,n){var o=t*t,s=6*e[0]-6*r[0]+3*i[0]+3*n[0],a=6*e[1]-6*r[1]+3*i[1]+3*n[1],l=6*e[2]-6*r[2]+3*i[2]+3*n[2],h=-6*e[0]+6*r[0]-4*i[0]-2*n[0],u=-6*e[1]+6*r[1]-4*i[1]-2*n[1],c=-6*e[2]+6*r[2]-4*i[2]-2*n[2],d=vec3.create();return d[0]=s*o+h*t+i[0],d[1]=a*o+u*t+i[1],d[2]=l*o+c*t+i[2],d},t.map01=function(t,e,i){return e!==i?(t-e)/(i-e):0},t.mapLinear=function(e,i,r,n,o){return t.lerp(t.map01(e,i,r),n,o)},t.easeInQuad=function(t){return t*t},t.easeOutQuad=function(t){var e=t-1;return 1-e*e},t.easeInOutQuad=function(t){var e=t;
return e<.5?(e+=e,e=.5*(e*e)):(e=e+e-2,e=.5*(1-e*e),e=.5+e),e},t.easeOutInQuad=function(t){var e=t;return e<.5?(e=e+e-1,e=.5*(1-e*e)):(e=e+e-1,e=.5*(e*e),e=.5+e),e},t.toRadian=function(t){return t*Math.PI/180},t.toDegree=function(t){return 180*t/Math.PI},t.lineIntersection=function(t,e,i,r,n,o,s,a){var l=(a-o)*(i-t)-(s-n)*(r-e);if(0===l)return[-1,-1];var h=(s-n)*(e-o)-(a-o)*(t-n),u=(i-t)*(e-o)-(r-e)*(t-n);return h/=l,u/=l,[h,u]},t.roundNumber=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},t.roundNumber=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},t.sign=function(t){return t<0?-1:t>0?1:0},t}),r("Tiling/HEALPixTables",[],function(){var t={ctab:[0,1,256,257,2,3,258,259,512,513,768,769,514,515,770,771,4,5,260,261,6,7,262,263,516,517,772,773,518,519,774,775,1024,1025,1280,1281,1026,1027,1282,1283,1536,1537,1792,1793,1538,1539,1794,1795,1028,1029,1284,1285,1030,1031,1286,1287,1540,1541,1796,1797,1542,1543,1798,1799,8,9,264,265,10,11,266,267,520,521,776,777,522,523,778,779,12,13,268,269,14,15,270,271,524,525,780,781,526,527,782,783,1032,1033,1288,1289,1034,1035,1290,1291,1544,1545,1800,1801,1546,1547,1802,1803,1036,1037,1292,1293,1038,1039,1294,1295,1548,1549,1804,1805,1550,1551,1806,1807,2048,2049,2304,2305,2050,2051,2306,2307,2560,2561,2816,2817,2562,2563,2818,2819,2052,2053,2308,2309,2054,2055,2310,2311,2564,2565,2820,2821,2566,2567,2822,2823,3072,3073,3328,3329,3074,3075,3330,3331,3584,3585,3840,3841,3586,3587,3842,3843,3076,3077,3332,3333,3078,3079,3334,3335,3588,3589,3844,3845,3590,3591,3846,3847,2056,2057,2312,2313,2058,2059,2314,2315,2568,2569,2824,2825,2570,2571,2826,2827,2060,2061,2316,2317,2062,2063,2318,2319,2572,2573,2828,2829,2574,2575,2830,2831,3080,3081,3336,3337,3082,3083,3338,3339,3592,3593,3848,3849,3594,3595,3850,3851,3084,3085,3340,3341,3086,3087,3342,3343,3596,3597,3852,3853,3598,3599,3854,3855],utab:[0,1,4,5,16,17,20,21,64,65,68,69,80,81,84,85,256,257,260,261,272,273,276,277,320,321,324,325,336,337,340,341,1024,1025,1028,1029,1040,1041,1044,1045,1088,1089,1092,1093,1104,1105,1108,1109,1280,1281,1284,1285,1296,1297,1300,1301,1344,1345,1348,1349,1360,1361,1364,1365,4096,4097,4100,4101,4112,4113,4116,4117,4160,4161,4164,4165,4176,4177,4180,4181,4352,4353,4356,4357,4368,4369,4372,4373,4416,4417,4420,4421,4432,4433,4436,4437,5120,5121,5124,5125,5136,5137,5140,5141,5184,5185,5188,5189,5200,5201,5204,5205,5376,5377,5380,5381,5392,5393,5396,5397,5440,5441,5444,5445,5456,5457,5460,5461,16384,16385,16388,16389,16400,16401,16404,16405,16448,16449,16452,16453,16464,16465,16468,16469,16640,16641,16644,16645,16656,16657,16660,16661,16704,16705,16708,16709,16720,16721,16724,16725,17408,17409,17412,17413,17424,17425,17428,17429,17472,17473,17476,17477,17488,17489,17492,17493,17664,17665,17668,17669,17680,17681,17684,17685,17728,17729,17732,17733,17744,17745,17748,17749,20480,20481,20484,20485,20496,20497,20500,20501,20544,20545,20548,20549,20560,20561,20564,20565,20736,20737,20740,20741,20752,20753,20756,20757,20800,20801,20804,20805,20816,20817,20820,20821,21504,21505,21508,21509,21520,21521,21524,21525,21568,21569,21572,21573,21584,21585,21588,21589,21760,21761,21764,21765,21776,21777,21780,21781,21824,21825,21828,21829,21840,21841,21844,21845],jrll:[2,2,2,2,3,3,3,3,4,4,4,4],jpll:[1,3,5,7,0,2,4,6,1,3,5,7],xoffset:[-1,-1,0,1,1,1,0,-1],yoffset:[0,1,1,1,0,-1,-1,-1],facearray:[[8,9,10,11,-1,-1,-1,-1,10,11,8,9],[5,6,7,4,8,9,10,11,9,10,11,8],[-1,-1,-1,-1,5,6,7,4,-1,-1,-1,-1],[4,5,6,7,11,8,9,10,11,8,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[1,2,3,0,0,1,2,3,5,6,7,4],[-1,-1,-1,-1,7,4,5,6,-1,-1,-1,-1],[3,0,1,2,3,0,1,2,4,5,6,7],[2,3,0,1,-1,-1,-1,-1,0,1,2,3]],swaparray:[[0,0,3],[0,0,6],[0,0,0],[0,0,5],[0,0,0],[5,0,0],[0,0,0],[6,0,0],[3,0,0]],swap_cycle:[[],[0,1,8,12,16,21,40],[0,1,2,40,114],[0,4,160,263],[0,4,30,49,51,87,526,1027,1105,1387,1807,2637],[0,8,10,18,39,74,146,307,452,4737],[0,1,2,7,9,17,80,410,1526,1921,32859,33566,38931],[0,5,6,10,12,24,27,95,372,494,924,1409,3492,4248,9137,66043,103369,156899],[0,1,2,3,4,45,125,351,697,24337,102940,266194,341855,419857],[0,1,2,3,9,16,1705,2082,2126,8177,12753,15410,52642,80493,83235,88387,99444,1675361,2495125],[0,2,6,8,9,11,20,50,93,152,183,2137,13671,44794,486954,741908,4803258,5692573],[0,1,5,6,44,53,470,2847,3433,4906,13654,14710,400447,1797382,2744492,18775974,23541521],[0,4,9,10,16,33,83,117,318,451,5759,10015,128975,171834,211256,347608,1278690,2154097,2590798,3427694,5581717,21012301,27023976,72522811,95032729,139166747,171822389],[0,5,10,267,344,363,2968,3159,9083,18437,76602,147614,1246902,1593138,2035574,6529391,9511830,11340287,29565945,281666026,677946848]]};return t}),r("Utils/Long",[],function(){var t=function(t,e){this.low_=0|t,this.high_=0|e};return t.IntCache_={},t.fromInt=function(e){if(-128<=e&&e<128){var i=t.IntCache_[e];if(i)return i}var r=new t(0|e,e<0?-1:0);return-128<=e&&e<128&&(t.IntCache_[e]=r),r},t.fromNumber=function(e){return isNaN(e)||!isFinite(e)?t.ZERO:e<=-t.TWO_PWR_63_DBL_?t.MIN_VALUE:e+1>=t.TWO_PWR_63_DBL_?t.MAX_VALUE:e<0?t.fromNumber(-e).negate():new t(e%t.TWO_PWR_32_DBL_|0,e/t.TWO_PWR_32_DBL_|0)},t.fromBits=function(e,i){return new t(e,i)},t.TWO_PWR_16_DBL_=65536,t.TWO_PWR_24_DBL_=1<<24,t.TWO_PWR_32_DBL_=t.TWO_PWR_16_DBL_*t.TWO_PWR_16_DBL_,t.TWO_PWR_64_DBL_=t.TWO_PWR_32_DBL_*t.TWO_PWR_32_DBL_,t.TWO_PWR_63_DBL_=t.TWO_PWR_64_DBL_/2,t.ZERO=t.fromInt(0),t.ONE=t.fromInt(1),t.MAX_VALUE=t.fromBits(-1,2147483647),t.MIN_VALUE=t.fromBits(0,-2147483648),t.TWO_PWR_24_=t.fromInt(1<<24),t.prototype.toInt=function(){return this.low_},t.prototype.toNumber=function(){return this.high_*t.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},t.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:t.TWO_PWR_32_DBL_+this.low_},t.prototype.isZero=function(){return 0===this.high_&&0===this.low_},t.prototype.isNegative=function(){return this.high_<0},t.prototype.isOdd=function(){return 1===(1&this.low_)},t.prototype.equals=function(t){return this.high_===t.high_&&this.low_===t.low_},t.prototype.lessThan=function(t){return this.compare(t)<0},t.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},t.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.subtract(t).isNegative()?-1:1},t.prototype.negate=function(){return this.equals(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.add=function(e){var i=this.high_>>>16,r=65535&this.high_,n=this.low_>>>16,o=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,l=e.low_>>>16,h=65535&e.low_,u=0,c=0,d=0,p=0;return p+=o+h,d+=p>>>16,p&=65535,d+=n+l,c+=d>>>16,d&=65535,c+=r+a,u+=c>>>16,c&=65535,u+=i+s,u&=65535,t.fromBits(d<<16|p,u<<16|c)},t.prototype.subtract=function(t){return this.add(t.negate())},t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(e.isZero())return t.ZERO;if(this.equals(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.equals(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(t.TWO_PWR_24_)&&e.lessThan(t.TWO_PWR_24_))return t.fromNumber(this.toNumber()*e.toNumber());var i=this.high_>>>16,r=65535&this.high_,n=this.low_>>>16,o=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,l=e.low_>>>16,h=65535&e.low_,u=0,c=0,d=0,p=0;return p+=o*h,d+=p>>>16,p&=65535,d+=n*h,c+=d>>>16,d&=65535,d+=o*l,c+=d>>>16,d&=65535,c+=r*h,u+=c>>>16,c&=65535,c+=n*l,u+=c>>>16,c&=65535,c+=o*a,u+=c>>>16,c&=65535,u+=i*h+r*l+n*a+o*s,u&=65535,t.fromBits(d<<16|p,u<<16|c)},t.prototype.not=function(){return t.fromBits(~this.low_,~this.high_)},t.prototype.and=function(e){return t.fromBits(this.low_&e.low_,this.high_&e.high_)},t.prototype.or=function(e){return t.fromBits(this.low_|e.low_,this.high_|e.high_)},t.prototype.shiftRightUnsigned=function(e){if(e&=63,0===e)return this;var i=this.high_;if(e<32){var r=this.low_;return t.fromBits(r>>>e|i<<32-e,i>>>e)}return 32===e?t.fromBits(i,0):t.fromBits(i>>>e-32,0)},t}),r("Utils/CircleFinder",[],function(){var t,e,r=function(r){for(np=r.length,t=vec3.add2(r[0],r[1]),t=vec3.normalize2(t),e=vec3.dot2(r[0],t),i=2;i<np;++i)vec3.dot2(r[i],t)<e&&this.getCircle(r,i)};return r.prototype.getCircle=function(r,n,o){for(t=vec3.add2(r[n],r[o]),t=vec3.normalize2(t),e=vec3.dot2(r[n],t),i=0;i<n;++i)if(vec3.dot2(r[i],t)<e){var s=vec3.subtract2(r[n],r[i]),a=vec3.subtract2(r[o],r[i]);t=vec3.cross2(s,a),t=vec3.normalize2(t),e=vec3.dot2(r[n],t),e<0&&(t=vec3.flip(t),e=-e)}},r.prototype.getCircle=function(r,n){for(t=vec3.add2(r[0],r[n]),t=vec3.normalize2(t),e=vec3.dot2(r[0],t),i=1;i<n;++i)vec3.dot2(r[i],t)<e&&this.getCircle(r,i,n)},r.prototype.getCenter=function(){return t},r.prototype.getCosRad=function(){return e},r}),r("Tiling/HEALPixBase",["./HEALPixTables","../Utils/Long","../Utils/CircleFinder"],function(t,e,i){var r=1.570796325,n=function(t,e){t<0&&(t+=360);var i=t*Math.PI/180,r=(-e+90)*Math.PI/180;return[i,r]},o=function(t,e){if(t>=0)return t<e?t:t%e;var i=t%e+e;return i===e?0:i},s=function(e){return t.utab[255&e]|t.utab[e>>>8&255]<<16|t.utab[e>>>16&255]<<32|t.utab[e>>>24&255]<<48},a=function(t,e,i,r){return(i<<2*r)+s(t)+(s(e)<<1)},l=function(t,i,r){var n=Math.pow(2,t),s=Math.cos(r),l={phi:i,theta:r,z:s};Math.abs(s)>.9&&(l.sth=Math.sin(r),l.have_sth=!0);var h,u,c,d=2/Math.PI,p=o(i*d,4),f=Math.abs(s);if(f<=2/3){var g=n*(.5+p),m=n*(.75*s);h=e.fromNumber(g-m),u=e.fromNumber(g+m);var v,y=h.shiftRightUnsigned(t),b=u.shiftRightUnsigned(t);v=y.equals(b)?y.or(e.fromInt(4)):y.lessThan(b)?y:b.add(e.fromInt(8)),c=e.fromNumber(n-1);var x=u.and(c),C=c.subtract(h.and(c));return a(x.toInt(),C.toInt(),v.toInt(),t)}var _=parseInt(Math.min(3,parseInt(p,10)),10),w=p-_,T=f<.9||!l.have_sth?n*Math.sqrt(3*(1-f)):n*l.sth/Math.sqrt((1+f)/3);h=e.fromNumber(w*T),u=e.fromNumber((1-w)*T);var A=e.fromNumber(n);c=e.fromNumber(n-1);var I=e.fromInt(1);return h.greaterThanOrEqual(A)&&(h=c),u.greaterThanOrEqual(A)&&(u=c),s>=0?a(A.subtract(u).subtract(I).toInt(),A.subtract(h).subtract(I).toInt(),_,t):a(h.toInt(),u.toInt(),_+8,t)},h=function(t){this.p=new Array(t),this.o=new Array(t);for(var e=0;e<this.p.length;e++)this.p[e]=0,this.o[e]=0;this.s=this.m=0};h.prototype.push=function(t,e){this.p[this.s]=t,this.o[this.s]=e,++this.s},h.prototype.otop=function(){return this.o[this.s-1]},h.prototype.ptop=function(){return this.p[this.s-1]},h.prototype.pop=function(){this.s--},h.prototype.popToMark=function(){this.s=this.m},h.prototype.mark=function(){this.m=this.s},h.prototype.size=function(){return this.s};var u={init:function(t){this.order_max=29,this.bn=[],this.nside=null;try{for(var e=0;e<=this.order_max;++e)this.bn[e]=this.createBoundaries(1<<e,"NESTED")}catch(t){}},createBoundaries:function(t,e){return this.nside=t-1,this.calculateBoundaries(t,e)},compress_bits:function(i){var r=e.fromNumber(i),n=e.fromNumber(0x5555555555555),o=r.and(n),s=o.shiftRightUnsigned(15);o=o.or(s);var a=o.and(e.fromNumber(65535)).toInt(),l=o.shiftRightUnsigned(32),h=l.and(e.fromNumber(65535)).toInt();return t.ctab[255&a]|t.ctab[a>>>8]<<4|t.ctab[255&h]<<16|t.ctab[h>>>8]<<20},fxyf:function(e,i,n){var o,s,a=t.jrll[n]-e-i,l=0,h=0,u=0,c=!1;a<1?(o=a,s=o*o/3,l=1-s,l>.99&&(u=Math.sqrt(s*(2-s)),c=!0)):a>3?(o=4-a,s=o*o/3,l=s-1,l<-.99&&(u=Math.sqrt(s*(2-s)),c=!0)):(o=1,l=2*(2-a)/3),s=t.jpll[n]*o+e-i,s<0&&(s+=8),s>=8&&(s-=8),h=o<1e-15?0:.5*r*s/o;var d=c?u:Math.sqrt((1-l)*(1+l));return[d*Math.cos(h),d*Math.sin(h),l]},maxPixrad:function(t,e){var i=Math.pow(2,t),r=vec3.createZPhi(2/3,Math.PI/e),n=1-1/i;n*=n;var o=vec3.createZPhi(1-n/3,0);return vec3.angle2(r,o)},pix2vec:function(t,e){var i=this.pix2loc(t,e),r=i.have_sth?i.sth:Math.sqrt((1-i.z)*(1+i.z));return vec3.createFrom(r*Math.cos(i.phi),r*Math.sin(i.phi),i.z)},pix2loc:function(e,i){var n,o,s={phi:null,sth:0,have_sth:!1,z:null},a=this.nest2xyf(e,i.npface,i.order),l=(t.jrll[a.face]<<i.order)-a.ix-a.iy-1;return l<i.nside?(n=l,o=n*n*i.fact2,s.z=1-o,s.z>.99&&(s.sth=Math.sqrt(o*(2-o)),s.have_sth=!0)):l>i.nl3?(n=i.nl4-l,o=n*n*i.fact2,s.z=o-1,s.z<-.99&&(s.sth=Math.sqrt(o*(2-o)),s.have_sth=!0)):(n=i.nside,s.z=(i.nl2-l)*i.fact1),o=t.jpll[a.face]*n+a.ix-a.iy,o<0&&(o+=8*n),s.phi=n===i.nside?.75*r*o*i.fact1:.5*r*o/n,s},nest2xyf:function(t,e,i){var r=t&e-1,n=u.compress_bits(r),o=u.compress_bits(r>>>1),s=t>>>2*i;return{ix:n,iy:o,face:s}},nside2order:function(t){for(var e=0;t>65535;)e+=16,t>>>=16;return t>255&&(e|=8,t>>>=8),t>15&&(e|=4,t>>>=4),t>3&&(e|=2,t>>>=2),t>1&&(e|=1),e},calculateBoundaries:function(t,e){if(this.nside!==t){this.nside=t;var i=this.nside2order(t);if("NESTED"===e&&i<0)throw new Exception("Nside must be a power of 2 for NESTED scheme");var r=2*this.nside,n=3*this.nside,o=4*this.nside,s=this.nside*this.nside,a=2*this.nside*(this.nside-1),l=12*s,h=4/l,u=(this.nside<<1)*h;return{order:i,nside:this.nside,scheme:e,nl2:r,nl3:n,nl4:o,npface:s,ncap:a,npix:l,fact1:u,fact2:h}}},convertPolygonToHealpixOrder:function(t,e,i){var r=[],n=e||4,o=i||5;return _.each(t,function(t){var e=Math.PI/180,i=Math.cos(t[1]*e),n=Math.cos(t[0]*e)*i,o=Math.sin(t[0]*e)*i,s=Math.sin(t[1]*e),a=Math.atan2(Math.sqrt(n*n+o*o),s),l=Math.atan2(o,n);l<0&&(l+=2*Math.PI),l>=2*Math.PI&&(l-=2*Math.PI),r.push({theta:a,phi:l})}),this.queryPolygonInclusive(r,n,o)},queryPolygonInclusive:function(t,e,r){Math.PI=3.141592653589793;var n=Math.PI/2,o=0!==e,s=t.length,a=o?s+1:s;if(s<3)return void console.error("not enough vertices in polygon");var l,h=new Array(s);for(l=0;l<s;++l)h[l]=vec3.createPhiTheta(t[l].phi,t[l].theta);var u=new Array(a),c=0;for(l=0;l<s;++l){u[l]=vec3.cross2(h[l],h[(l+1)%s]);var d=vec3.dot2(u[l],h[(l+2)%s]);0===l&&(c=d<0?-1:1),u[l]=vec3.scale2(u[l],c/vec3.length2(u[l]))}var p=new Array(a);if(this.fill(p,n),o){var f=new i(h);u[s]=f.getCenter(),p[s]=Math.acos(f.getCosRad())}var g=this.queryMultiDisc(u,p,e,r);return console.dir(g),g},fill:function(t,e){for(var i=0,r=t.length;i<r;i++)t[i]=e},queryMultiDisc:function(t,e,i,r){var n=r,o=0!==i,s=t.length,a=[],l=0;o&&(l=this.ilog2(i));for(var c,d=n+l,p=new Array(d+1),f=0;f<d+1;f++){p[f]=new Array(s);for(var g=0;g<s;g++)p[f][g]=new Array(3)}var m={order:n};u.init(m);var v;for(v=0;v<=d;++v){c=u.bn[v];var y=u.maxPixrad(v,c.nl4);for(f=0;f<s;++f)p[v][f][0]=e[f]+y>Math.PI?-1:Math.cos(e[f]+y),p[v][f][1]=0===v?Math.cos(e[f]):p[0][f][1],p[v][f][2]=e[f]-y<0?1:Math.cos(e[f]-y)}var b=new h(12+3*d);for(f=0;f<12;f++)b.push(11-f,0);for(;b.size()>0;){var x=b.ptop();v=b.otop(),b.pop(),c=u.bn[v];var C=u.pix2vec(x,c),_=3;for(f=0;f<s&&_>0;++f)for(var w=vec3.dot2(C,t[f]),T=0;T<_;++T)w<p[v][f][T]&&(_=T);_>0&&this.check_pixel(v,d,_,a,x,b,o,r)}return a},check_pixel:function(t,e,i,r,n,o,s,a){var l,h=a;if(0!==i)if(t<h)if(i>=3){var u=2*(h-t),c=n<<u,d=n+1<<u;for(l=c;l<=d;l++)r.push(l)}else for(l=0;l<4;++l)o.push(4*n+3-l,t+1);else if(t>h)if(i>=2)r.push(n>>>2*(t-h)),o.popToMark();else if(t<e)for(l=0;l<4;++l)o.push(4*n+3-l,t+1);else r.push(n>>>2*(t-h)),o.popToMark();else if(i>=2)r.push(n);else if(s)if(h<e)for(o.mark(),l=0;l<4;++l)o.push(4*n+3-l,t+1);else r.push(n)},ilog2:function(t){for(var e=0;t>65535;)e+=16,t>>>=16;return t>255&&(e|=8,t>>>=8),t>15&&(e|=4,t>>>=4),t>3&&(e|=2,t>>>=2),t>1&&(e|=1),e},lonLat2pix:function(t,e,i){var r=n(e,i);return l(t,r[0],r[1])},getChildren:function(t){return[4*t,4*t+1,4*t+2,4*t+3]},uniq2hpix:function(t,e){null===e&&(e=[]),e[0]=u.log2(t/4)/2;var i=u.pow2(e[0]);return e[1]=t-4*i*i,e[0]=parseInt(e[0],10),e},log2:function(t){for(var e=0;t>>>++e>0;);return--e},pow2:function(t){return 1<<t},getPixRes:function(t){var e=648e3/Math.PI;return e*Math.sqrt(4*Math.PI/(12*t*t))}};return u}),r("Utils/UtilsIntersection",["./Numeric","../Tiling/HEALPixBase"],function(t,e){function i(t){var e=t[0]*Math.PI/180,i=t[1]*Math.PI/180,r=Math.cos(i)*Math.cos(e),n=Math.cos(i)*Math.sin(e),o=Math.sin(i);return[r,n,o]}function r(e,i,r,n){var o=vec3.cross(e,i,[]),s=vec3.cross(r,n,[]),a=vec3.normalize(vec3.cross(o,s,[])),l=vec3.dot(vec3.cross(e,o,[]),a),h=vec3.dot(vec3.cross(i,o,[]),a),u=vec3.dot(vec3.cross(r,s,[]),a),c=vec3.dot(vec3.cross(n,s,[]),a),d=t.sign(-l)+t.sign(h)+t.sign(-u)+t.sign(c);return 4===Math.abs(d)}var n={};return n.convertPolygonToHealpixOrder=function(t,i,r){return e.convertPolygonToHealpixOrder(t,i,r)},n.pointInLine=function(t,e,i){var r,n,o=i[0]-e[0],s=!1;return 0===o?s=t[0]===e[0]:(n=(t[0]-e[0])/o,s=n>=0&&n<=1),!!s&&(r=i[1]-e[1],0===o?t[1]===e[1]:(n=(t[1]-e[1])/r,n>=0&&n<=1))},n.pointInSphere=function(t,e,i,r){var n=[],o=[],s=t.getRenderContext().computePixelSizeVector();t.getCoordinateSystem().get3DFromWorld(e,n),t.getCoordinateSystem().get3DFromWorld(i,o);var a=r*(s[0]*o[0]+s[1]*o[1]+s[2]*o[2]+s[3]),l=[];return vec3.subtract(n,o,l),l=vec3.dot(l,l),l<a*a},n.pointInRing=function(t,e){for(var n=e.length,o=0,s=i(t),a=i([t[0],t[1]+90]),l=0;l<n-1;l++)r(i(e[l]),i(e[l+1]),s,a)&&o++;return o%2===1},n}),r("Renderer/FeatureStyle",[],function(){var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},e=/^(\w{2})(\w{2})(\w{2})$/,i=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,r=/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3},\s*(\d{1,3}))\)$/,n=function(t){if(this.strokeColor=[1,0,0,1],this.fillColor=[1,0,0,1],this.fillTextureUrl=null,this.fillTexture=null,this.fillShader=null,this.strokeWidth=1,this.iconUrl=null,this.icon=null,this.label=null,this.textColor=[1,1,1,1],this.fill=!1,this.pointMaxSize=40,this.opacity=1,this.zIndex=0,this.extrusionScale=1,t)for(var e in t)this[e]=t[e]};return n.fromStringToColor=function(n){var o,s=0,a=0,l=0,h=255;return n=n.trim(),n=n.toLowerCase(),"#"===n.charAt(0)&&(n=n.substr(1,6)),t.hasOwnProperty(n)&&(n=t[n]),o=e.exec(n),o&&(s=parseInt(o[1],16),a=parseInt(o[2],16),l=parseInt(o[3],16)),o=i.exec(n),o&&(s=parseInt(o[1],10),a=parseInt(o[2],10),l=parseInt(o[3],10)),o=r.exec(n),o&&(s=parseInt(o[1],10),a=parseInt(o[2],10),l=parseInt(o[3],10),h=parseInt(o[4],10)),s=s<0?0:s>255?255:s,a=a<0?0:a>255?255:a,l=l<0?0:l>255?255:l,h=h<0?0:h>255?255:h,[s/255,a/255,l/255,h/255]},n.fromColorToString=function(t){for(var e="#",i=0;i<3;i++){var r=parseInt(255*t[i],10).toString(16);e+=r<10?"0"+r:r}return e},n.prototype.getExtrusionScale=function(){return this.extrusionScale},n.prototype.setExtrusionScale=function(t){this.extrusionScale=t},n}),r("Utils/UtilityFactory",["./Constants","./UtilsFits","./Numeric","./UtilsIntersection","../Renderer/FeatureStyle"],function(t,e,i,r,n){return{create:function(o,s){var a;switch(o){case t.UTILITY.Fits:a=e;break;case t.UTILITY.Intersection:a=r;break;case t.UTILITY.Numeric:a=i;break;case t.UTILITY.CreateStyle:a=new n(s);break;case t.UTILITY.FeatureStyle:a=n;break;default:throw"Cannot create the utility "+o}return a}}}),r("Layer/AbstractLayer",["underscore-min","../Utils/Event","../Utils/Utils","../Utils/Constants","../Utils/UtilityFactory"],function(t,e,i,r,n){var o=function(o,s){if(e.prototype.constructor.call(this,s),this.globe=null,this.ID="URN:Mizar:Layer:"+t.uniqueId(this.constructor.name+":"),this.name=s&&s.hasOwnProperty("name")?s.name:"",this.attribution=s&&s.hasOwnProperty("attribution")?s.attribution:"",this.copyrightUrl=s&&s.hasOwnProperty("copyrightUrl")?s.copyrightUrl:"",this.ack=s&&s.hasOwnProperty("ack")?s.ack:"",this.icon=s&&s.hasOwnProperty("icon")?s.icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBQkVBRMIQtMAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAvklEQVQY012QMWpCURBFz3yfG7CIwSatpLGwsJJsQEHssr2UttapkkK0zRJEFPKLj5UYPGme8vgDt5l7uNwZKEYNdaZO1FR6VQkBT8AbMAGe1e7dTwXUB8bAFPgF9sBWPUXENbWgBTAELkCTw7bqMdR5kTQCehlogB/gE/iqcs9OVhT9I8v7EZU6UJfqh3pWa3WlvqsvakoRcVOPwCYnvQI1sM67Q0T8JYAWvAEOwDewj4jr4z0teJdf84AA/gF1uG92uhcfoAAAAABJRU5ErkJggg==",this.description=s&&s.hasOwnProperty("description")?s.description:"",this.visible=!(!s||!s.hasOwnProperty("visible"))&&s.visible,this.properties=s&&s.hasOwnProperty("properties")?s.properties:{},this.type=o,this.pickable=!(!s||!s.hasOwnProperty("pickable"))&&s.pickable,this.services=s&&s.hasOwnProperty("services")?s.services:[],this.dataType=s.dataType||"",this.background=s.background,this.category=s.background?"background":s.category,this.coordinateSystem=s.coordinateSystem,this.format=s.format||"",this.baseUrl=s.baseUrl||"",this.deletable=s.deletable||!1,this.fitsSupported=!1,s&&s.hasOwnProperty("color"))this.color=s.color instanceof Array?s.color:n.create(r.UTILITY.FeatureStyle).fromStringToColor(s.color);else{var a=i.generateColor();this.color=a.concat([1])}s&&s.hasOwnProperty("opacity")?this.opacity=s.opacity/100:this.opacity=1,s&&!s.hasOwnProperty("style")?this.style=n.create(r.UTILITY.CreateStyle,{rendererHint:"Basic",opacity:this.opacity,iconUrl:this.icon,fillColor:this.color,strokeColor:this.color,visible:this.visible}):"FeatureStyle"===s.style?this.style=s.style:this.style=n.create(r.UTILITY.CreateStyle,s.style),this.attribution&&this.attribution.search("<a")>=0&&this.attribution.search("target=")<0&&(this.attribution=this.attribution.replace(" "," target=_blank ")),s.hasOwnProperty("availableServices")?this.availableServices=s.availableServices:this.availableServices=[]};return i.inherits(e,o),o.prototype.getGlobe=function(){return this.globe},o.prototype.getID=function(){return this.ID},o.prototype.getName=function(){return this.name},o.prototype.getAttribution=function(){return this.attribution},o.prototype.getCopyrightUrl=function(){return this.copyrightUrl},o.prototype.getAck=function(){return this.ack},o.prototype.getIcon=function(){return this.icon},o.prototype.getDescription=function(){return this.description},o.prototype.isVisible=function(){return this.visible},o.prototype.setVisible=function(t){if("boolean"!=typeof t)throw new TypeError("the parameter of setVisible should be a boolean","AbstractLayer.js");this.visible!==t&&this.globe.attributionHandler&&this.globe.attributionHandler.toggleAttribution(this),this.visible=t,this.globe&&this.globe.renderContext.requestFrame(),this.publish("visibility:changed",this)},o.prototype.getOpacity=function(){return this.opacity},o.prototype.setOpacity=function(t){if(!("number"==typeof t&&t>=0&&t<=1))throw new TypeError("opacity value should be a value in [0..1]","AbstractLayer.js");this.opacity=t,this.globe&&this.globe.renderContext.requestFrame(),this.publish("opacity:changed",this)},o.prototype.getProperties=function(){return this.properties},o.prototype.getType=function(){return this.type},o.prototype.isPickable=function(){return this.pickable},o.prototype.isType=function(t){return this.type===t},o.prototype.getServices=function(){return this.services},o.prototype.getCoordinateSystem=function(){return this.coordinateSystem},o.prototype._attach=function(t){this.globe=t,this.attribution&&this.globe.attributionHandler&&this.isVisible()&&this.globe.attributionHandler.addAttribution(this)},o.prototype._detach=function(){this.attribution&&this.globe.attributionHandler&&this.globe.attributionHandler.removeAttribution(this),this.globe=null},o.prototype.getBaseURl=function(){return this.baseUrl},o.prototype.getDataType=function(){return this.dataType},o.prototype.getFormat=function(){return this.format},o.prototype.isDeletable=function(){return this.deletable},o.prototype.getColor=function(){return this.color},o.prototype.getStyle=function(){return this.style},o.prototype.getAvailableServices=function(){return this.availableServices},o.prototype.isBackground=function(){return this.background},o}),r("Renderer/Program",[],function(){var t=function(t){this.renderContext=t,this.glProgram=null,this.attributes={},this.uniforms={},this.numActiveAttribArray=0};return t.prototype.createShader=function(t,e){var i=this.renderContext.gl,r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)?r:(console.log("Shader compilation error: "+i.getShaderInfoLog(r)),console.log(e),i.deleteShader(r),null)},t.prototype.createFromSource=function(t,e){var i=this.renderContext.gl,r=this.createShader(i.VERTEX_SHADER,t),n=this.createShader(i.FRAGMENT_SHADER,e);if(null===r||null===n)return!1;var o;if(this.glProgram=i.createProgram(),i.attachShader(this.glProgram,r),i.attachShader(this.glProgram,n),i.linkProgram(this.glProgram),!i.getProgramParameter(this.glProgram,i.LINK_STATUS))return console.log("Program link error: "+i.getProgramInfoLog(this.glProgram)),i.deleteShader(r),i.deleteShader(n),i.deleteProgram(this.glProgram),this.glProgram=null,!1;var s=i.getProgramParameter(this.glProgram,i.ACTIVE_ATTRIBUTES);for(this.numActiveAttribArray=0,o=0;o<s;++o){var a=i.getActiveAttrib(this.glProgram,o),l=i.getAttribLocation(this.glProgram,a.name);this.attributes[a.name]=l,l+1>this.numActiveAttribArray&&(this.numActiveAttribArray=l+1)}var h=i.getProgramParameter(this.glProgram,i.ACTIVE_UNIFORMS);for(o=0;o<h;++o){var u=i.getActiveUniform(this.glProgram,o);this.uniforms[u.name]=i.getUniformLocation(this.glProgram,u.name)}return!0},t.prototype.loadFromFile=function(t,e){var i=new XMLHttpRequest;i.open("get",this.renderContext.shadersPath+t,!1),i.send(null);var r=i.responseText;i.open("get",this.renderContext.shadersPath+e,!1),i.send(null);var n=i.responseText;return this.createFromSource(r,n)},t.prototype.apply=function(){var t,e=this.renderContext,i=e.gl;for(i.useProgram(this.glProgram),t=e.numActiveAttribArray;t<this.numActiveAttribArray;t++)i.enableVertexAttribArray(t);for(t=this.numActiveAttribArray;t<e.numActiveAttribArray;t++)i.disableVertexAttribArray(t);e.numActiveAttribArray=this.numActiveAttribArray},t.prototype.dispose=function(){this.renderContext.gl.deleteProgram(this.glProgram)},t}),r("Renderer/BoundingBox",[],function(){var t=function(t,e){t&&(this.min=vec3.create(t)),e&&(this.max=vec3.create(e))};return t.prototype.extend=function(t,e,i){this.min?(t<this.min[0]&&(this.min[0]=t),e<this.min[1]&&(this.min[1]=e),i<this.min[2]&&(this.min[2]=i),t>this.max[0]&&(this.max[0]=t),e>this.max[1]&&(this.max[1]=e),i>this.max[2]&&(this.max[2]=i)):(this.min=vec3.create(),this.max=vec3.create(),this.min[0]=t,this.min[1]=e,this.min[2]=i,this.max[0]=t,this.max[1]=e,this.max[2]=i)},t.prototype.compute=function(t,e,i){this.min||(this.min=vec3.create(),this.max=vec3.create()),this.min[0]=t[0],this.min[1]=t[1],this.min[2]=t[2],this.max[0]=t[0],this.max[1]=t[1],this.max[2]=t[2];var r,n,o=i||3,s=e||t.length;for(r=o;r<s;r+=o)for(n=0;n<3;n++)t[r+n]<this.min[n]&&(this.min[n]=t[r+n]),t[r+n]>this.max[n]&&(this.max[n]=t[r+n])},t.prototype.getCorner=function(t){return[1&t?this.max[0]:this.min[0],2&t?this.max[1]:this.min[1],4&t?this.max[2]:this.min[2]]},t.prototype.getCenter=function(){return[.5*(this.max[0]+this.min[0]),.5*(this.max[1]+this.min[1]),.5*(this.max[2]+this.min[2])]},t.prototype.getRadius=function(){var t=vec3.create();return vec3.subtract(this.max,this.min,t),.5*vec3.length(t)},t}),r("Renderer/glMatrix",[],function(){var t=1e-6,e=Array,i={};i.create=function(t){var i=new e(3);return t?(i[0]=t[0],i[1]=t[1],i[2]=t[2]):i[0]=i[1]=i[2]=0,i},i.createFrom=function(t,i,r){var n=new e(3);return n[0]=t,n[1]=i,n[2]=r,n},i.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.equal=function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t},i.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},i.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},i.multiply=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i):(t[0]*=e[0],t[1]*=e[1],t[2]*=e[2],t)},i.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},i.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},i.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],o=Math.sqrt(i*i+r*r+n*n);return o?1===o?(e[0]=i,e[1]=r,e[2]=n,e):(o=1/o,e[0]=i*o,e[1]=r*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)},i.cross=function(t,e,i){i||(i=t);var r=t[0],n=t[1],o=t[2],s=e[0],a=e[1],l=e[2];return i[0]=n*l-o*a,i[1]=o*s-r*l,i[2]=r*a-n*s,i},i.length=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)},i.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},i.lerp=function(t,e,i,r){return r||(r=t),r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r[2]=t[2]+i*(e[2]-t[2]),r},i.dist=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)},i.angle=function(t,e){return Math.atan2(i.length(i.cross(t,e)),i.dot(t,e))},i.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},i.createZPhi=function(t,e){var r=Math.sqrt((1-t)*(1+t)),n=r*Math.cos(e),o=r*Math.sin(e);return i.createFrom(n,o,t)},i.createPhiTheta=function(t,e){var r=Math.sin(e),n=r*Math.cos(t),o=r*Math.sin(t),s=r*Math.cos(e);return i.createFrom(n,o,s)},i.add2=function(t,e){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2];return[i+o,r+s,n+a]},i.subtract2=function(t,e){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2];return[i-o,r-s,n-a]},i.flip=function(t){var e=t[0],i=t[1],r=t[2];return[e=-e,i=-i,r=-r]},i.scale2=function(t,e){var i=t.x,r=t.y,n=t.z;return{x:i*e,y:r*=e,z:n*=e}},i.normalize2=function(t){var e=t[0],i=t[1],r=t[2],n=1/Math.sqrt(e*e+i*i+r*r);return[e*=n,i*=n,r*=n]},i.cross2=function(t,e){return{x:t[1]*e[2]-e[1]*t[2],y:t[2]*e[0]-e[2]*t[0],z:t[0]*e[1]-e[0]*t[1]
}},i.length2=function(t){var e=t.x,i=t.y,r=t.z;return Math.sqrt(e*e+i*i+r*r)},i.dot2=function(t,e){var i=void 0!==t.x?t.x:t[0],r=void 0!==t.y?t.y:t[1],n=void 0!==t.z?t.z:t[2],o=void 0!==e.x?e.x:e[0],s=void 0!==e.y?e.y:e[1],a=void 0!==e.z?e.z:e[2];return i*o+r*s+n*a},i.angle2=function(t,e){return Math.atan2(i.length2(i.cross2(t,e)),i.dot2(t,e))};var r={};r.create=function(t){var i=new e(9);return t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8]),i};var n={};n.create=function(t){var i=new e(16);return t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},n.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.identity=function(t){return t||(t=n.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[3],o=t[6],s=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=o,t[11]=t[14],t[12]=n,t[13]=s,t[14]=a,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},n.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],s=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],d=t[11],p=t[12],f=t[13],g=t[14],m=t[15];return p*u*a*n-h*f*a*n-p*s*c*n+o*f*c*n+h*s*g*n-o*u*g*n-p*u*r*l+h*f*r*l+p*i*c*l-e*f*c*l-h*i*g*l+e*u*g*l+p*s*r*d-o*f*r*d-p*i*a*d+e*f*a*d+o*i*g*d-e*s*g*d-h*s*r*m+o*u*r*m+h*i*a*m-e*u*a*m-o*i*c*m+e*s*c*m},n.inverse=function(t,e){e||(e=t);var i,r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],p=t[10],f=t[11],g=t[12],m=t[13],v=t[14],y=t[15],b=r*l-n*a,x=r*h-o*a,C=r*u-s*a,_=n*h-o*l,w=n*u-s*l,T=o*u-s*h,A=c*m-d*g,I=c*v-p*g,M=c*y-f*g,S=d*v-p*m,P=d*y-f*m,E=p*y-f*v,R=b*E-x*P+C*S+_*M-w*I+T*A;return R?(i=1/R,e[0]=(l*E-h*P+u*S)*i,e[1]=(-n*E+o*P-s*S)*i,e[2]=(m*T-v*w+y*_)*i,e[3]=(-d*T+p*w-f*_)*i,e[4]=(-a*E+h*M-u*I)*i,e[5]=(r*E-o*M+s*I)*i,e[6]=(-g*T+v*C-y*x)*i,e[7]=(c*T-p*C+f*x)*i,e[8]=(a*P-l*M+u*A)*i,e[9]=(-r*P+n*M-s*A)*i,e[10]=(g*w-m*C+y*b)*i,e[11]=(-c*w+d*C-f*b)*i,e[12]=(-a*S+l*I-h*A)*i,e[13]=(r*S-n*I+o*A)*i,e[14]=(-g*_+m*x-v*b)*i,e[15]=(c*_-d*x+p*b)*i,e):null},n.toRotationMat=function(t,e){return e||(e=n.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.toMat3=function(t,e){return e||(e=r.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},n.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],p=t[10],f=t[11],g=t[12],m=t[13],v=t[14],y=t[15],b=e[0],x=e[1],C=e[2],_=e[3];return i[0]=b*r+x*a+C*c+_*g,i[1]=b*n+x*l+C*d+_*m,i[2]=b*o+x*h+C*p+_*v,i[3]=b*s+x*u+C*f+_*y,b=e[4],x=e[5],C=e[6],_=e[7],i[4]=b*r+x*a+C*c+_*g,i[5]=b*n+x*l+C*d+_*m,i[6]=b*o+x*h+C*p+_*v,i[7]=b*s+x*u+C*f+_*y,b=e[8],x=e[9],C=e[10],_=e[11],i[8]=b*r+x*a+C*c+_*g,i[9]=b*n+x*l+C*d+_*m,i[10]=b*o+x*h+C*p+_*v,i[11]=b*s+x*u+C*f+_*y,b=e[12],x=e[13],C=e[14],_=e[15],i[12]=b*r+x*a+C*c+_*g,i[13]=b*n+x*l+C*d+_*m,i[14]=b*o+x*h+C*p+_*v,i[15]=b*s+x*u+C*f+_*y,i},n.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],o=e[2];return i[0]=t[0]*r+t[4]*n+t[8]*o+t[12],i[1]=t[1]*r+t[5]*n+t[9]*o+t[13],i[2]=t[2]*r+t[6]*n+t[10]*o+t[14],i},n.multiplyVec4=function(t,e,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*o+t[12]*s,i[1]=t[1]*r+t[5]*n+t[9]*o+t[13]*s,i[2]=t[2]*r+t[6]*n+t[10]*o+t[14]*s,i[3]=t[3]*r+t[7]*n+t[11]*o+t[15]*s,i},n.project=function(t,e,i){i||(i=e),n.multiplyVec4(t,e,i);var r=1/i[3];return i[0]*=r,i[1]*=r,i[2]*=r,i},n.rotateVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],o=e[2];return i[0]=t[0]*r+t[4]*n+t[8]*o,i[1]=t[1]*r+t[5]*n+t[9]*o,i[2]=t[2]*r+t[6]*n+t[10]*o,i},n.translate=function(t,e,i){var r,n,o,s,a,l,h,u,c,d,p,f,g=e[0],m=e[1],v=e[2];return i&&t!==i?(r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],p=t[10],f=t[11],i[0]=r,i[1]=n,i[2]=o,i[3]=s,i[4]=a,i[5]=l,i[6]=h,i[7]=u,i[8]=c,i[9]=d,i[10]=p,i[11]=f,i[12]=r*g+a*m+c*v+t[12],i[13]=n*g+l*m+d*v+t[13],i[14]=o*g+h*m+p*v+t[14],i[15]=s*g+u*m+f*v+t[15],i):(t[12]=t[0]*g+t[4]*m+t[8]*v+t[12],t[13]=t[1]*g+t[5]*m+t[9]*v+t[13],t[14]=t[2]*g+t[6]*m+t[10]*v+t[14],t[15]=t[3]*g+t[7]*m+t[11]*v+t[15],t)},n.scale=function(t,e,i){var r=e[0],n=e[1],o=e[2];return i&&t!==i?(i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=t[11]*o,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=o,t[9]*=o,t[10]*=o,t[11]*=o,t)},n.rotate=function(t,e,i,r){var n,o,s,a,l,h,u,c,d,p,f,g,m,v,y,b,x,C,_,w,T,A,I,M,S=i[0],P=i[1],E=i[2],R=Math.sqrt(S*S+P*P+E*E);return R?(1!==R&&(R=1/R,S*=R,P*=R,E*=R),n=Math.sin(e),o=Math.cos(e),s=1-o,a=t[0],l=t[1],h=t[2],u=t[3],c=t[4],d=t[5],p=t[6],f=t[7],g=t[8],m=t[9],v=t[10],y=t[11],b=S*S*s+o,x=P*S*s+E*n,C=E*S*s-P*n,_=S*P*s-E*n,w=P*P*s+o,T=E*P*s+S*n,A=S*E*s+P*n,I=P*E*s-S*n,M=E*E*s+o,r?t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=a*b+c*x+g*C,r[1]=l*b+d*x+m*C,r[2]=h*b+p*x+v*C,r[3]=u*b+f*x+y*C,r[4]=a*_+c*w+g*T,r[5]=l*_+d*w+m*T,r[6]=h*_+p*w+v*T,r[7]=u*_+f*w+y*T,r[8]=a*A+c*I+g*M,r[9]=l*A+d*I+m*M,r[10]=h*A+p*I+v*M,r[11]=u*A+f*I+y*M,r):null},n.rotateX=function(t,e,i){var r=Math.sin(e),n=Math.cos(e),o=t[4],s=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],d=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=o*n+h*r,i[5]=s*n+u*r,i[6]=a*n+c*r,i[7]=l*n+d*r,i[8]=o*-r+h*n,i[9]=s*-r+u*n,i[10]=a*-r+c*n,i[11]=l*-r+d*n,i},n.rotateY=function(t,e,i){var r=Math.sin(e),n=Math.cos(e),o=t[0],s=t[1],a=t[2],l=t[3],h=t[8],u=t[9],c=t[10],d=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=o*n+h*-r,i[1]=s*n+u*-r,i[2]=a*n+c*-r,i[3]=l*n+d*-r,i[8]=o*r+h*n,i[9]=s*r+u*n,i[10]=a*r+c*n,i[11]=l*r+d*n,i},n.rotateZ=function(t,e,i){var r=Math.sin(e),n=Math.cos(e),o=t[0],s=t[1],a=t[2],l=t[3],h=t[4],u=t[5],c=t[6],d=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=o*n+h*r,i[1]=s*n+u*r,i[2]=a*n+c*r,i[3]=l*n+d*r,i[4]=o*-r+h*n,i[5]=s*-r+u*n,i[6]=a*-r+c*n,i[7]=l*-r+d*n,i},n.frustum=function(t,e,i,r,o,s,a){a||(a=n.create());var l=e-t,h=r-i,u=s-o;return a[0]=2*o/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*o/h,a[6]=0,a[7]=0,a[8]=(e+t)/l,a[9]=(r+i)/h,a[10]=-(s+o)/u,a[11]=-1,a[12]=0,a[13]=0,a[14]=-(s*o*2)/u,a[15]=0,a},n.perspective=function(t,e,i,r,o){var s=i*Math.tan(t*Math.PI/360),a=s*e;return n.frustum(-a,a,-s,s,i,r,o)},n.ortho=function(t,e,i,r,o,s,a){a||(a=n.create());var l=e-t,h=r-i,u=s-o;return a[0]=2/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/h,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/u,a[11]=0,a[12]=-(t+e)/l,a[13]=-(r+i)/h,a[14]=-(s+o)/u,a[15]=1,a},n.lookAt=function(t,e,i,r){r||(r=n.create());var o,s,a,l,h,u,c,d,p,f,g=t[0],m=t[1],v=t[2],y=i[0],b=i[1],x=i[2],C=e[0],_=e[1],w=e[2];return g===C&&m===_&&v===w?n.identity(r):(c=g-C,d=m-_,p=v-w,f=1/Math.sqrt(c*c+d*d+p*p),c*=f,d*=f,p*=f,o=b*p-x*d,s=x*c-y*p,a=y*d-b*c,f=Math.sqrt(o*o+s*s+a*a),f?(f=1/f,o*=f,s*=f,a*=f):(o=0,s=0,a=0),l=d*a-p*s,h=p*o-c*a,u=c*s-d*o,f=Math.sqrt(l*l+h*h+u*u),f?(f=1/f,l*=f,h*=f,u*=f):(l=0,h=0,u=0),r[0]=o,r[1]=l,r[2]=c,r[3]=0,r[4]=s,r[5]=h,r[6]=d,r[7]=0,r[8]=a,r[9]=u,r[10]=p,r[11]=0,r[12]=-(o*g+s*m+a*v),r[13]=-(l*g+h*m+u*v),r[14]=-(c*g+d*m+p*v),r[15]=1,r)},n.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"};var o={};return o.create=function(t){var i=new e(4);return t?(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3]):i[0]=i[1]=i[2]=i[3]=0,i},o.createFrom=function(t,i,r,n){var o=new e(4);return o[0]=t,o[1]=i,o[2]=r,o[3]=n,o},o.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.equal=function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t&&Math.abs(e[3]-i[3])<t},o.identity=function(t){return t||(t=o.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},o.calculateW=function(t,e){var i=t[0],r=t[1],n=t[2];return e&&t!==e?(e[0]=i,e[1]=r,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t)},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},o.inverse=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=i*i+r*r+n*n+o*o,a=s?1/s:0;return e&&t!==e?(e[0]=-t[0]*a,e[1]=-t[1]*a,e[2]=-t[2]*a,e[3]=t[3]*a,e):(t[0]*=-a,t[1]*=-a,t[2]*=-a,t[3]*=a,t)},o.conjugate=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},o.length=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)},o.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],o=t[3],s=Math.sqrt(i*i+r*r+n*n+o*o);return 0===s?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(s=1/s,e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=o*s,e)},o.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[3],t)},o.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],o=t[2],s=t[3],a=e[0],l=e[1],h=e[2],u=e[3];return i[0]=r*u+s*a+n*h-o*l,i[1]=n*u+s*l+o*a-r*h,i[2]=o*u+s*h+r*l-n*a,i[3]=s*u-r*a-n*l-o*h,i},o.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=t[0],a=t[1],l=t[2],h=t[3],u=h*r+a*o-l*n,c=h*n+l*r-s*o,d=h*o+s*n-a*r,p=-s*r-a*n-l*o;return i[0]=u*h+p*-s+c*-l-d*-a,i[1]=c*h+p*-a+d*-s-u*-l,i[2]=d*h+p*-l+u*-a-c*-s,i},o.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t)},o.toMat4=function(t,e){e||(e=n.create());var i=t[0],r=t[1],o=t[2],s=t[3],a=i+i,l=r+r,h=o+o,u=i*a,c=i*l,d=i*h,p=r*l,f=r*h,g=o*h,m=s*a,v=s*l,y=s*h;return e[0]=1-(p+g),e[1]=c+y,e[2]=d-v,e[3]=0,e[4]=c-y,e[5]=1-(u+g),e[6]=f+m,e[7]=0,e[8]=d+v,e[9]=f-m,e[10]=1-(u+p),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},o.slerp=function(t,e,i,r){r||(r=t);var n,o,s,a,l=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return Math.abs(l)>=1?(r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r):(n=Math.acos(l),o=Math.sqrt(1-l*l),Math.abs(o)<.001?(r[0]=.5*t[0]+.5*e[0],r[1]=.5*t[1]+.5*e[1],r[2]=.5*t[2]+.5*e[2],r[3]=.5*t[3]+.5*e[3],r):(s=Math.sin((1-i)*n)/o,a=Math.sin(i*n)/o,r[0]=t[0]*s+e[0]*a,r[1]=t[1]*s+e[1]*a,r[2]=t[2]*s+e[2]*a,r[3]=t[3]*s+e[3]*a,r))},o.fromRotationMatrix=function(t,e){e||(e=o.create());var i,r=t[0]+t[4]+t[8];if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[7]-t[5])*i,e[1]=(t[2]-t[6])*i,e[2]=(t[3]-t[1])*i;else{var n=o.fromRotationMatrix.s_iNext=o.fromRotationMatrix.s_iNext||[1,2,0],s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);var a=n[s],l=n[a];i=Math.sqrt(t[3*s+s]-t[3*a+a]-t[3*l+l]+1),e[s]=.5*i,i=.5/i,e[3]=(t[3*l+a]-t[3*a+l])*i,e[a]=(t[3*a+s]+t[3*s+a])*i,e[l]=(t[3*l+s]+t[3*s+l])*i}return e},o.identity=function(t){return t||(t=o.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},o.fromAngleAxis=function(t,e,i){i||(i=o.create());var r=.5*t,n=Math.sin(r);return i[3]=Math.cos(r),i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i},o.toAngleAxis=function(t,e){e||(e=t);var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){e[3]=2*Math.acos(t[3]);var r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}else e[3]=0,e[0]=1,e[1]=0,e[2]=0;return e},o.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},window.vec3=i,window.mat4=n,window.quat4=o,n}),r("Tiling/Tile",["../Renderer/BoundingBox","../Renderer/glMatrix"],function(t){var e=function(){this.parent=null,this.parentIndex=-1,this.children=null,this.vertices=null,this.texture=null,this.vertexBuffer=null,this.texTransform=[1,1,0,0],this.matrix=null,this.inverseMatrix=null,this.bbox=new t,this.radius=0,this.distance=0,this.closestPointToEye=[0,0,0],this.extension={},this.state=e.State.NONE,this.config=null,this.imageSize=256};return e.State={ERROR:-10,NONE:0,REQUESTED:1,LOADING:2,LOADED:3},e.prototype.computePosition=function(t,e){var i=this.config.tesselation;t=Math.min(i-1,Math.max(0,t)),e=Math.min(i-1,Math.max(0,e));for(var r=Math.floor(e),n=e-r,o=Math.floor(t),s=t-o,a=this.config.vertexSize,l=a*(r*i+o),h=[0,0,0],u=0;u<3;u++)h[u]=(1-n)*(1-s)*this.vertices[l+u]+n*(1-s)*this.vertices[l+a*i+u]+n*s*this.vertices[l+a*i+a+u]+(1-n)*s*this.vertices[l+a+u];return h},e.prototype.initFromParent=function(t,e,i){this.parent=t,this.parentIndex=2*i+e,this.matrix=t.matrix,this.inverseMatrix=t.inverseMatrix,this.texture=t.texture,this.config=t.config,this.vertexBuffer=t.vertexBuffer;for(var r=this.config.tesselation,n=(r-1)/2,o=0;o<=n;o++)for(var s=this.config.vertexSize*((o+i*n)*r+e*n),a=0;a<=n;a++)this.bbox.extend(t.vertices[s],t.vertices[s+1],t.vertices[s+2]),s+=this.config.vertexSize;this.radius=this.bbox.getRadius();for(var l in t.extension){var h=t.extension[l];h.initChild&&h.initChild(this,e,i)}},e.prototype.needsToBeRefined=function(t){if(this.distance<this.radius)return!0;var e=.25*(this.bbox.max[0]-this.bbox.min[0]+(this.bbox.max[1]-this.bbox.min[1]))/this.imageSize,i=this.matrix,r=this.closestPointToEye,n=i[0]*r[0]+i[4]*r[1]+i[8]*r[2]+i[12],o=i[1]*r[0]+i[5]*r[1]+i[9]*r[2]+i[13],s=i[2]*r[0]+i[6]*r[1]+i[10]*r[2]+i[14],a=t.pixelSizeVector,l=e/(n*a[0]+o*a[1]+s*a[2]+a[3]);return Math.abs(l)>t.tileErrorTreshold},e.prototype.isCulled=function(t){var e=this.inverseMatrix,i=t.eyePosition,r=e[0]*i[0]+e[4]*i[1]+e[8]*i[2]+e[12],n=e[1]*i[0]+e[5]*i[1]+e[9]*i[2]+e[13],o=e[2]*i[0]+e[6]*i[1]+e[10]*i[2]+e[14];if(this.distance=Math.sqrt(r*r+n*n+o*o),this.distance<this.radius)return this.distance=0,!1;var s=this.closestPointToEye;if(s[0]=Math.min(Math.max(r,this.bbox.min[0]),this.bbox.max[0]),s[1]=Math.min(Math.max(n,this.bbox.min[1]),this.bbox.max[1]),s[2]=Math.min(Math.max(o,this.bbox.min[2]),this.bbox.max[2]),o<0&&!this.config.coordinateSystem.isFlat()){var a=s[0],l=s[1],h=s[2]+this.config.coordinateSystem.geoide.radius,u=Math.sqrt(a*a+l*l+h*h);a/=u,l/=u,h/=u;var c=r-a*this.config.coordinateSystem.geoide.radius,d=n-l*this.config.coordinateSystem.geoide.radius,p=o-(h-1)*this.config.coordinateSystem.geoide.radius,f=Math.sqrt(c*c+d*d+p*p),g=(c*a+d*l+p*h)/f;if(g*=this.config.cullSign,g<-.05)return!0}var m=t.localFrustum;return m.inverseTransform(t.worldFrustum,this.matrix),!m.containsBoundingBox(this.bbox)},e.prototype.dispose=function(t,i){for(var r in this.extension)this.extension[r].dispose&&this.extension[r].dispose(t,i);this.state===e.State.LOADED&&(i.disposeGLBuffer(this.vertexBuffer),this.texture&&i.disposeGLTexture(this.texture),this.vertexBuffer=null,this.texture=null,this.parent=null,this.state=e.State.NONE)},e.prototype.deleteChildren=function(t,e){if(this.children){for(var i=0;i<4;i++)this.children[i].deleteChildren(t,e),this.children[i].dispose(t,e);this.children=null}},e.prototype.buildSkirtVertices=function(t,e,i,r){for(var n=this.vertices,o=.05*this.radius,s=this.config.tesselation,a=0;a<s;a++){var l=n[e]-t[0],h=n[e+1]-t[1],u=n[e+2]-t[2],c=o/Math.sqrt(l*l+h*h+u*u);l*=c,h*=c,u*=c,n[r]=n[e]-l,n[r+1]=n[e+1]-h,n[r+2]=n[e+2]-u;for(var d=3;d<this.config.vertexSize;d++)n[r+d]=n[e+d];r+=this.config.vertexSize,e+=i}},e.prototype.generateNormals=function(){for(var t=this.config.tesselation,e=this.config.vertexSize,i=e*t,r=0,n=0;n<t;n++)for(var o=n===t-1?0:i,s=0===n?0:-i,a=0;a<t;a++){var l=a===t-1?0:e,h=0===a?0:-e,u=[this.vertices[r+l]-this.vertices[r+h],this.vertices[r+l+1]-this.vertices[r+h+1],this.vertices[r+l+2]-this.vertices[r+h+2]],c=[this.vertices[r+o]-this.vertices[r+s],this.vertices[r+o+1]-this.vertices[r+s+1],this.vertices[r+o+2]-this.vertices[r+s+2]],d=vec3.cross(u,c,[]);vec3.normalize(d),this.vertices[r+3]=d[0],this.vertices[r+4]=d[1],this.vertices[r+5]=d[2],r+=e}},e.prototype.generate=function(t,i,r){this.vertices=this.generateVertices(r);var n=this.config.tesselation,o=this.config.vertexSize;if(this.bbox.compute(this.vertices,o*n*n,o),this.radius=this.bbox.getRadius(),this.config.normals&&this.generateNormals(),this.config.skirt){var s=[0,0,0];mat4.multiplyVec3(this.inverseMatrix,s);var a=o*(n*n);this.buildSkirtVertices(s,0,o,a),a+=o*n,this.buildSkirtVertices(s,o*(n*(n-1)),o,a),a+=o*n,this.buildSkirtVertices(s,0,o*n,a),a+=o*n,this.buildSkirtVertices(s,o*(n-1),o*n,a),a+=o*n,this.buildSkirtVertices(s,o*(n*(n-1)/2),o,a),a+=o*n,this.buildSkirtVertices(s,o*((n-1)/2),o*n,a)}null!==this.vertexBuffer&&null===this.parent&&t.disposeGLBuffer(this.vertexBuffer),this.vertexBuffer=t.createGLBuffer(this.vertices),i&&(this.texture=t.createGLTexture(i),this.imageSize=this.config.imageSize),this.state=e.State.LOADED},e}),r("Utils/ImageRequest",[],function(){var t=function(t){this.successCallback=t.successCallback,this.failCallback=t.failCallback,this.abortCallback=t.abortCallback,this.image=null};return t.prototype.send=function(t,e){this.image=new Image,this.image.crossOrigin=e,this.image.dataType="byte";var i=this;this.image.onload=function(){var t=0!==i.image.naturalWidth&&i.image.complete;t&&i.successCallback.call(i)},this.image.onerror=this.failCallback.bind(this),this.image.src=t},t.prototype.abort=function(){this.abortCallback&&this.abortCallback(this),this.image.src=""},t}),r("Renderer/RendererTileData",[],function(){var t=function(t){this.manager=t,this.renderables=[]};return t.prototype.initChild=function(e,i,r){for(var n,o=0;o<this.renderables.length;o++)if(this.renderables[o].initChild){var s=this.renderables[o].initChild(i,r,e);s&&(n||(n=e.extension.renderer=new t(this.manager)),n.renderables.push(s))}},t.prototype.traverse=function(t,e){for(var i=0;i<this.renderables.length;i++){var r=this.renderables[i],n=r.bucket;if(n.layer.isVisible()&&n.layer.opacity>0)if(r.traverse)r.traverse(this.manager,t,e);else{if(r.hasChildren&&!e)continue;this.manager.renderables.push(r)}}},t.prototype.getRenderable=function(t){for(var e=0;e<this.renderables.length;e++)if(t===this.renderables[e].bucket)return this.renderables[e];return null},t.prototype.dispose=function(t,e){for(var i=0;i<this.renderables.length;i++)this.renderables[i].dispose(t,e);this.renderables.length=0},t}),r("Renderer/RasterOverlayRenderer",["./Program","../Tiling/Tile","../Utils/ImageRequest","./RendererTileData"],function(t,e,i,r){var n=function(t){this.vertexShader="attribute vec3 vertex;\n",this.vertexShader+="attribute vec2 tcoord;\n",this.vertexShader+="uniform mat4 modelViewMatrix;\n",this.vertexShader+="uniform mat4 projectionMatrix;\n",this.vertexShader+="uniform vec4 textureTransform; \n",this.vertexShader+="varying vec2 texCoord;\n",this.vertexShader+="void main(void) \n",this.vertexShader+="{\n",this.vertexShader+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",this.vertexShader+="\ttexCoord = tcoord * textureTransform.xy + textureTransform.zw;\n",this.vertexShader+="}\n",this.fragmentShader="precision lowp float;\n",this.fragmentShader+="varying vec2 texCoord;\n",this.fragmentShader+="uniform sampler2D overlayTexture;\n",this.fragmentShader+="uniform float opacity; \n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor.rgba = texture2D(overlayTexture, texCoord.xy); \n",this.fragmentShader+="\tgl_FragColor.a *= opacity; \n",this.fragmentShader+="}\n",this.rendererManager=t.vectorRendererManager,this.tileManager=t.tileManager,this.programs=[],this.program=this.createProgram({vertexCode:this.vertexShader,fragmentCode:this.fragmentShader,updateUniforms:null}),this.buckets=[],this.imageRequests=[],this.frameNumber=0;for(var e=this,r=0;r<4;r++){var n=new i({successCallback:function(){this.renderable&&(this.renderable.bucket.layer.handleImage&&this.renderable.bucket.layer.handleImage(this),this.renderable.ownTexture=e.tileManager.tilePool.createGLTexture(this.image),this.renderable.texture=this.renderable.ownTexture,this.renderable.uvScale=1,this.renderable.uTrans=0,this.renderable.vTrans=0,this.renderable.updateChildrenTexture(),this.renderable.onRequestFinished(!0),this.renderable=null,e.tileManager.renderContext.requestFrame())},failCallback:function(){this.renderable&&(this.renderable.onRequestFinished(!0),this.renderable=null)},abortCallback:function(){this.renderable&&(this.renderable.onRequestFinished(!1),this.renderable=null)}});this.imageRequests.push(n)}},o=function(t){this.bucket=t,this.ownTexture=null,this.texture=null,this.request=null,this.requestFinished=!1,this.tile=null,this.uvScale=1,this.uTrans=0,this.vTrans=0};o.prototype.onRequestStarted=function(t){this.request=t,this.requestFinished=!1;var e=this.bucket.layer;0===e._numRequests&&e.globe.publishEvent("startLoad",e),e._numRequests++},o.prototype.onRequestFinished=function(t){this.request=null,this.requestFinished=t;var e=this.bucket.layer;e._numRequests--,e.globe&&0===e._numRequests&&e.globe.publishEvent("endLoad",e)},o.prototype.initChild=function(t,e,i){var r=this.bucket.createRenderable();return r.tile=i,this.texture&&(r.texture=this.texture,r.uvScale=this.uvScale,r.uTrans=this.uTrans,r.vTrans=this.vTrans),r},o.prototype.generateChild=function(t){var e=this.bucket.renderer;e.addOverlayToTile(t,this.bucket,this)},o.prototype.updateChildrenTexture=function(){if(this.tile.children)for(var t=0;t<4;t++){var e=this.tile.children[t].extension.renderer;if(e){var i=e.getRenderable(this.bucket);i&&!i.ownTexture&&(i.updateTextureFromParent(this),i.updateChildrenTexture())}}},o.prototype.updateTextureFromParent=function(t){this.tile.state===e.State.LOADED?(this.texture=t.texture,this.uvScale=.5*t.uvScale,this.uTrans=t.uTrans,this.vTrans=t.vTrans,this.uTrans+=1&this.tile.parentIndex?this.uvScale:0,this.vTrans+=2&this.tile.parentIndex?this.uvScale:0):(this.texture=t.texture,this.uvScale=t.uvScale,this.uTrans=t.uTrans,this.vTrans=t.vTrans)},o.prototype.traverse=function(t,i,r){r&&this.texture&&t.renderables.push(this),this.requestFinished||this.tile.state!==e.State.LOADED||this.bucket.renderer.requestOverlayTextureForTile(this)},o.prototype.dispose=function(t,e){this.ownTexture&&(e.disposeGLTexture(this.ownTexture),this.ownTexture=null)};var s=function(t){this.layer=t,this.renderer=null,this.style=t};s.prototype.createRenderable=function(){return new o(this)},n.prototype.addOverlay=function(t){t._numRequests=0;var i=new s(t);i.renderer=this,i.id=this.rendererManager.bucketId++,this.buckets.push(i),t._bucket=i;for(var r=0;r<this.tileManager.level0Tiles.length;r++){var n=this.tileManager.level0Tiles[r];n.state===e.State.LOADED&&this.addOverlayToTile(n,i)}},n.prototype.removeOverlay=function(t){var e=this.buckets.indexOf(t._bucket);this.buckets.splice(e,1);var i=this.tileManager.renderContext,r=this.tileManager.tilePool;this.tileManager.visitTiles(function(e){var n=e.extension.renderer,o=n?n.getRenderable(t._bucket):null;if(o){var s=n.renderables.indexOf(o);n.renderables.splice(s,1),o.dispose(i,r),0===n.renderables.length&&delete e.extension.renderer}})},n.prototype.addOverlayToTile=function(t,i,n){if(this.overlayIntersects(t.geoBound,i.layer)){t.extension.renderer||(t.extension.renderer=new r(this.rendererManager));var o=i.createRenderable();if(o.tile=t,t.extension.renderer.renderables.push(o),n&&n.texture&&o.updateTextureFromParent(n),t.children)for(var s=0;s<4;s++)t.children[s].state===e.State.LOADED&&this.addOverlayToTile(t.children[s],i,o)}};var a=function(t,e,i){return[e[0]+t*(i[0]-e[0]),e[1]+t*(i[1]-e[1])]};return n.prototype.clipPolygonToSide=function(t,e,i,r){for(var n,o,s=[],l=0;l<r.length;l++){var h=r[l],u=r[(l+1)%r.length],c=h[t],d=u[t],p=(c-i)*e>=0,f=(d-i)*e>=0;!p&&f?(n=(i-c)/(d-c),o=a(n,h,u),s.push(o),s.push(u)):p&&f?s.push(u):p&&!f&&(n=(i-c)/(d-c),o=a(n,h,u),s.push(o))}return s},n.prototype.overlayIntersects=function(t,e){if(e.coordinates){var i;return i=this.clipPolygonToSide(0,1,t.west,e.coordinates),i=this.clipPolygonToSide(0,-1,t.east,i),i=this.clipPolygonToSide(1,1,t.south,i),i=this.clipPolygonToSide(1,-1,t.north,i),i.length>0}return!e.geoBound||e.geoBound.intersects(t)},n.prototype.generateLevelZero=function(t){for(var e=0;e<this.buckets.length;e++)this.addOverlayToTile(t,this.buckets[e])},n.prototype.requestOverlayTextureForTile=function(t){if(t.request)t.request.frameNumber=this.frameNumber;else{for(var e,i=0;i<this.imageRequests.length;i++)if(!this.imageRequests[i].renderable){e=this.imageRequests[i];break}e&&(t.onRequestStarted(e),e.renderable=t,e.frameNumber=this.frameNumber,e.send(t.bucket.layer.getUrl(t.tile),t.bucket.layer.crossOrigin))}},n.prototype.createProgram=function(e){var i=new t(this.tileManager.renderContext);return i.createFromSource(this.vertexShader,e.fragmentCode),i.id=this.programs.length,this.programs.push({fragmentCode:e.fragmentCode,program:i}),i},n.prototype.getProgram=function(t){for(var e,i=0;i<this.programs.length;i++)this.programs[i].fragmentCode===t.fragmentCode&&(e=this.programs[i].program);return e||(e=this.createProgram(t)),e},n.prototype.render=function(t,i,r){var n=this.tileManager.renderContext,o=n.gl;o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.depthFunc(o.LEQUAL);for(var s=mat4.create(),a=null,l=null,h=i;h<r;h++){var u,c,d=t[h],p=d.bucket,f=p.layer;f.customShader?(c=this.getProgram(f.customShader),u=f.customShader.updateUniforms):c=this.getProgram({vertexCode:this.vertexShader,fragmentCode:this.fragmentShader,updateUniforms:null}),c!==l&&(l=c,c.apply(),o.uniformMatrix4fv(c.uniforms.projectionMatrix,!1,n.projectionMatrix),o.uniform1i(c.uniforms.overlayTexture,0),o.bindBuffer(o.ARRAY_BUFFER,this.tileManager.tcoordBuffer),o.vertexAttribPointer(c.attributes.tcoord,2,o.FLOAT,!1,0,0)),u&&u(o,c),o.bindBuffer(o.ARRAY_BUFFER,d.tile.vertexBuffer),o.vertexAttribPointer(c.attributes.vertex,3,o.FLOAT,!1,4*d.tile.config.vertexSize,0);var g=d.tile.state===e.State.LOADED?this.tileManager.tileIndexBuffer.getSolid():this.tileManager.tileIndexBuffer.getSubSolid(d.tile.parentIndex);a!==g&&(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,g),a=g),mat4.multiply(n.viewMatrix,d.tile.matrix,s),o.uniformMatrix4fv(c.uniforms.modelViewMatrix,!1,s),o.uniform1f(c.uniforms.opacity,f.opacity),o.uniform4f(c.uniforms.textureTransform,d.uvScale,d.uvScale,d.uTrans,d.vTrans),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,d.texture),o.drawElements(o.TRIANGLES,a.numIndices,o.UNSIGNED_SHORT,0)}o.disable(o.BLEND),o.depthFunc(o.LESS)},n.prototype.canApply=function(t,e){return!1},n}),r("Utils/Cache",[],function(){var t=function(t){this.layer=t.layer,this.cacheLevel=t.hasOwnProperty("cacheLevel")?t.cacheLevel:1,localStorage.getItem(this.layer.name)||localStorage.setItem(this.layer.name,JSON.stringify({})),this._cacheMap=JSON.parse(localStorage.getItem(this.layer.name)),this.imgCanvas=document.createElement("canvas"),this.imgCanvas.width=t.tilePixelSize||256,this.imgCanvas.height=t.tilePixelSize||256,this.imgContext=this.imgCanvas.getContext("2d")};return t.prototype.getFromCache=function(t){var e=null;if(this.cacheLevel>=t.level){var i=this.layer.getUrl(t),r=this._cacheMap[i];if(r){r.lastAccess=Date.now();var n=new Image;n.src=r.dataUrl,n.dataType="byte",e={image:n,elevations:r.elevations}}}return e},t.prototype._createDataURL=function(t){return this.imgContext.drawImage(t,0,0,t.width,t.height),this.imgCanvas.toDataURL("image/png")},t.prototype.storeInCache=function(t){var e=t.tile;if(this.cacheLevel>=e.level){var i=this.layer.getUrl(e);this._cacheMap[i]={dataUrl:this._createDataURL(t.image),elevations:t.elevations,lastAccess:Date.now()},console.log("Stored for "+t.image.src),localStorage.setItem(this.layer.name,JSON.stringify(this._cacheMap))}},t}),r("Layer/AbstractRasterLayer",["../Utils/Utils","./AbstractLayer","../Renderer/RasterOverlayRenderer","../Utils/Cache"],function(t,e,i,r){var n=function(t,i){e.prototype.constructor.call(this,t,i),this.tilePixelSize=i.tilePixelSize,this.tiling=i.tiling,this.numberOfLevels=i.numberOfLevels,this.geoBound=i.geoBound||null,this.coordinates=i.coordinates||null,this.zIndex=i.zIndex||0,this.crossOrigin=i.crossOrigin||"anonymous",this.baseUrl=i.baseUrl,i.cache&&(i.cache.layer=this,this.cache=new r(i.cache)),this._overlay=!0,this._ready=!0};return t.inherits(e,n),n.prototype._attach=function(t){if(this._overlay||(this.id=0),e.prototype._attach.call(this,t),this._overlay){if(!t.rasterOverlayRenderer){var r=new i(t);t.vectorRendererManager.renderers.push(r),t.rasterOverlayRenderer=r}t.rasterOverlayRenderer.addOverlay(this)}},n.prototype._detach=function(){this._overlay&&this.globe.rasterOverlayRenderer&&this.globe.rasterOverlayRenderer.removeOverlay(this),e.prototype._detach.call(this)},n}),r("Renderer/GeoBound",["../Utils/Constants"],function(t){function e(t,e,i){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=t[o].slice(0);n[0][0]=i.convert(t[0][0],e,i.getGeoideName()),n[0][1]=i.convert(t[0][1],e,i.getGeoideName());for(var s=1;s<t.length;s++)n[s][0]=i.convert(t[s][0],e,i.getGeoideName()),n[s][1]=i.convert(t[s][1],e,i.getGeoideName());return n}var i=function(t,e,i,r){this.south=e,this.west=t,this.north=r,this.east=i};return i.prototype.getCenter=function(){return[.5*(this.east+this.west),.5*(this.south+this.north),0]},i.prototype.getNorth=function(){return this.north},i.prototype.setNorth=function(t){this.north=t},i.prototype.getSouth=function(){return this.south},i.prototype.setSouth=function(t){this.south=t},i.prototype.getWest=function(){return this.west},i.prototype.setWest=function(t){this.west=t},i.prototype.getEast=function(){return this.east},i.prototype.setEast=function(t){this.east=t},i.prototype.computeFromCoordinates=function(t){this.west=t[0][0],this.east=t[0][0],this.south=t[0][1],this.north=t[0][1];for(var e=1;e<t.length;e++)this.west=Math.min(this.west,t[e][0]),this.east=Math.max(this.east,t[e][0]),this.south=Math.min(this.south,t[e][1]),this.north=Math.max(this.north,t[e][1])},i.prototype.computeFromCoordinatesInCrsTo=function(t,i,r){var n;return n=i===r.getGeoideName()?t:e(t,i,r),this.computeFromCoordinates(n),n},i.prototype.isPointInside=function(t){return t[0]>=this.west&&t[0]<=this.east&&t[1]>=this.south&&t[1]<=this.north},i.prototype.intersects=function(t){return!(this.west>=t.east||this.east<=t.west)&&!(this.south>=t.north||this.north<=t.south)},i.prototype.intersectsGeometry=function(e){var r,n,o=!1,s=new i,a=e.coordinates;switch(e.type){case t.GEOMETRY.LineString:s.computeFromCoordinates(a),o|=this.intersects(s);break;case t.GEOMETRY.Polygon:for(r=0;r<a.length&&!o;r++)s.computeFromCoordinates(a[r]),o|=this.intersects(s);break;case t.GEOMETRY.MultiLineString:for(r=0;r<a.length&&!o;r++)s.computeFromCoordinates(a[r]),o|=this.intersects(s);break;case t.GEOMETRY.MultiPolygon:for(r=0;r<a.length&&!o;r++)for(n=0;n<a[r].length&&!o;n++)s.computeFromCoordinates(a[r][n]),o|=this.intersects(s)}return o},i}),r("Tiling/GeoTiling",["../Utils/Utils","../Utils/Constants","./Tile","../Renderer/GeoBound","./HEALPixBase","../Renderer/glMatrix"],function(t,e,i,r,n){var o=function(t,e,r,n){i.prototype.constructor.call(this),this.bound=this.geoBound=t,this.level=e,this.x=r,this.y=n};o.prototype=new i,o.prototype.getElevation=function(t,e){var r=(t-this.geoBound.getWest())/(this.geoBound.getEast()-this.geoBound.getWest()),n=(e-this.geoBound.getNorth())/(this.geoBound.getSouth()-this.geoBound.getNorth()),o=2*(n>=1?1:Math.floor(2*n))+Math.floor(2*r);if(this.children&&this.children[o].state===i.State.LOADED)return this.children[o].getElevation(t,e);var s=this.config.tesselation,a=Math.floor(r*s),l=Math.floor(n*s),h=this.config.vertexSize*(l*s+a),u=[this.vertices[h],this.vertices[h+1],this.vertices[h+2]];mat4.multiplyVec3(this.matrix,u);var c=this.config.coordinateSystem.getWorldFrom3D(u);return c[2]},o.prototype.createChildren=function(){var t=.5*(this.geoBound.getEast()+this.geoBound.getWest()),e=.5*(this.geoBound.getNorth()+this.geoBound.getSouth()),i=this.level+1,n=new o(new r(this.geoBound.getWest(),e,t,this.geoBound.getNorth()),i,2*this.x,2*this.y),s=new o(new r(t,e,this.geoBound.getEast(),this.geoBound.getNorth()),i,2*this.x+1,2*this.y),a=new o(new r(this.geoBound.getWest(),this.geoBound.getSouth(),t,e),i,2*this.x,2*this.y+1),l=new o(new r(t,this.geoBound.getSouth(),this.geoBound.getEast(),e),i,2*this.x+1,2*this.y+1);
n.initFromParent(this,0,0),s.initFromParent(this,1,0),a.initFromParent(this,0,1),l.initFromParent(this,1,1),this.children=[n,s,a,l]},o.prototype.lonlat2tile=function(t){for(var e=this.geoBound.getEast()-this.geoBound.getWest(),i=this.geoBound.getSouth()-this.geoBound.getNorth(),r=this.config.tesselation-1,n=[],o=0;o<t.length;o++){var s=r*(t[o][0]-this.geoBound.getWest())/e,a=r*(t[o][1]-this.geoBound.getNorth())/i;n.push([s,a])}return n},o.prototype.generateVertices=function(t){this.matrix=this.config.coordinateSystem.getLHVTransform(this.geoBound.getCenter());var e=mat4.create();mat4.inverse(this.matrix,e),this.inverseMatrix=e;for(var i=this.config.vertexSize,r=this.config.tesselation,n=new Float32Array(i*r*(r+6)),o=(this.geoBound.getEast()-this.geoBound.getWest())/(r-1),s=(this.geoBound.getSouth()-this.geoBound.getNorth())/(r-1),a=(this.config.coordinateSystem.getGeoide().getRadius(),this.config.coordinateSystem.getGeoide().getHeightScale(),0),l=this.geoBound.getNorth(),h=[0,0,0],u=0;u<r;u++){for(var c=this.geoBound.getWest(),d=0;d<r;d++){var p=t?t[a]:0;this.config.coordinateSystem.get3DFromWorld([c,l,p],h);var f=h[0],g=h[1],m=h[2],v=a*i;n[v]=e[0]*f+e[4]*g+e[8]*m+e[12],n[v+1]=e[1]*f+e[5]*g+e[9]*m+e[13],n[v+2]=e[2]*f+e[6]*g+e[10]*m+e[14],a++,c+=o}l+=s}return n};var s=function(t,e){this.level0NumTilesX=t,this.level0NumTilesY=e};s.prototype.generateLevelZeroTiles=function(t){t.skirt=!t.coordinateSystem.isFlat(),t.cullSign=1,t.srs="EPSG:4326";for(var e=[],i=(t.coordinateSystem.getGeoBound().getNorth()-t.coordinateSystem.getGeoBound().getSouth())/this.level0NumTilesY,n=(t.coordinateSystem.getGeoBound().getEast()-t.coordinateSystem.getGeoBound().getWest())/this.level0NumTilesX,s=0;s<this.level0NumTilesY;s++)for(var a=0;a<this.level0NumTilesX;a++){var l=new r(t.coordinateSystem.getGeoBound().getWest()+a*n,t.coordinateSystem.getGeoBound().getNorth()-(s+1)*i,t.coordinateSystem.getGeoBound().getWest()+(a+1)*n,t.coordinateSystem.getGeoBound().getNorth()-s*i),h=new o(l,0,a,s);h.config=t,e.push(h)}return e};var a=function(t){var i,r=!0;switch(t.type){case e.GEOMETRY.Point:return i=t.coordinates,[i[0],i[1],i[0],i[1]];case e.GEOMETRY.MultiPoint:i=t.coordinates,r=!1;break;case e.GEOMETRY.Polygon:i=t.coordinates[0];break;case e.GEOMETRY.MultiPolygon:i=t.coordinates[0][0];break;case e.GEOMETRY.LineString:i=t.coordinates;break;case e.GEOMETRY.MultiLineString:i=t.coordinates[0]}if(i&&0!==i.length){for(var n=i[0][0],o=i[0][1],s=i[0][0],a=i[0][1],l=t.type===e.GEOMETRY.MultiPolygon||t.type===e.GEOMETRY.MultiLineString?t.coordinates.length:1,h=0;h<l;h++){switch(t.type){case e.GEOMETRY.MultiPolygon:i=t.coordinates[h][0];break;case e.GEOMETRY.MultiLineString:i=t.coordinates[h]}for(var u=0;u<i.length;u++)n=Math.min(n,i[u][0]),o=Math.min(o,i[u][1]),s=Math.max(s,i[u][0]),a=Math.max(a,i[u][1]),r&&u>0&&Math.abs(i[u-1][0]-i[u][0])>180&&(n=-180,s=180)}return[n,o,s,a]}};return s.prototype._lon2LevelZeroIndex=function(t){return Math.min(this.level0NumTilesX-1,Math.floor((t+180)*this.level0NumTilesX/360))},s.prototype._lat2LevelZeroIndex=function(t){return Math.min(this.level0NumTilesY-1,Math.floor((90-t)*this.level0NumTilesY/180))},s.prototype.lonlat2LevelZeroIndex=function(t,e){return this._lat2LevelZeroIndex(e)*this.level0NumTilesX+this._lon2LevelZeroIndex(t)},s.prototype.getOverlappedLevelZeroTiles=function(t){var e=[],i=a(t);if(i)for(var r=this._lon2LevelZeroIndex(i[0]),n=this._lat2LevelZeroIndex(i[3]),o=this._lon2LevelZeroIndex(i[2]),s=this._lat2LevelZeroIndex(i[1]),l=n;l<=s;l++)for(var h=r;h<=o;h++)e.push(l*this.level0NumTilesX+h);return e},s.prototype.findInsideTile=function(t,e,i){for(var r=0;r<i.length;r++){var o=i[r],s=n.lonLat2pix(o.order,t,e);if(s===o.pixelIndex)return o}return null},s}),r("Layer/WMSLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/GeoTiling"],function(t,e,i,r){var n=function(t){t.tilePixelSize=t.tilePixelSize||256,t.tiling=new r(4,2),t.numberOfLevels=t.numberOfLevels||21,e.prototype.constructor.call(this,i.LAYER.WMS,t);var n=this.baseUrl;n+=n.indexOf("?",0)===-1?"?service=wms":"&service=wms",n+="&version=",n+=t.hasOwnProperty("version")?t.version:"1.1.1",n+="&request=GetMap",n+="&layers="+t.layers,n+="&styles=",t.hasOwnProperty("styles")&&(n+=t.styles),n+="&format=",this.format=t.hasOwnProperty("format")?t.format:"image/jpeg",n+=this.format,t.hasOwnProperty("transparent")&&(n+="&transparent="+t.transparent),n+="&width=",n+=this.tilePixelSize,n+="&height=",n+=this.tilePixelSize,t.hasOwnProperty("time")&&(n+="&time="+t.time),this.getMapBaseUrl=n};return t.inherits(e,n),n.prototype.getUrl=function(t){var e=t.bound,i=this.getMapBaseUrl;return i+="&srs="+t.config.srs,i+="&bbox=",i+=e.west,i+=",",i+=e.south,i+=",",i+=e.east,i+=",",i+=e.north},n.prototype.getBaseURl=function(){return this.getMapBaseUrl},n}),r("Layer/WMTSLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,i.LAYER.WMTS,t),this.startLevel=t.startLevel||1;var r=this.baseUrl;r+=r.indexOf("?",0)===-1?"?service=wmts":"&service=wmts",r+="&version=",r+=t.version||"1.0.0",r+="&request=GetTile",r+="&layer="+t.layer,r+="&tilematrixset="+t.matrixSet,t.style&&(r+="&style="+t.style),r+="&format=",this.format=t.hasOwnProperty("format")?t.format:"image/png",r+=this.format,t.time&&(r+="&time="+t.time),this.getTileBaseUrl=r};return t.inherits(e,r),r.prototype.getUrl=function(t){var e=this.getTileBaseUrl;return e+="&tilematrix=",e+=t.level+this.startLevel,e+="&tilecol="+t.x,e+="&tilerow="+t.y},r.prototype.getBaseURl=function(){return this.getTileBaseUrl},r}),r("Layer/WCSElevationLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/GeoTiling"],function(t,e,i,r){var n=function(t){t.tilePixelSize=t.tilePixelSize||33,t.tiling=new r(4,2),t.numberOfLevels=t.numberOfLevels||21,e.prototype.constructor.call(this,i.LAYER.WMSElevation,t),this.version=t.version||"2.0.0",this.format=t.format||"image/x-aaigrid",this.minElevation=t.minElevation||0,this.scale=t.scale||1;var n=this.baseUrl;switch(n+=n.indexOf("?",0)===-1?"?service=wcs":"&service=wcs",n+="&version="+this.version,n+="&request=GetCoverage",this.version.substring(0,3)){case"2.0":this.crs=t.outputCRS||t.crs||"http://www.opengis.net/def/crs/EPSG/0/4326",n+="&outputCRS="+this.crs,n+="&size=x("+this.tilePixelSize+")",n+="&size=y("+this.tilePixelSize+")",n+="&coverageid="+t.coverage;break;case"1.0":n+="&width="+this.tilePixelSize,n+="&height="+this.tilePixelSize,n+="&crs="+(t.crs||"EPSG:4326"),n+="&coverage="+t.coverage}n+="&format="+this.format,this.getCoverageBaseUrl=n};return t.inherits(e,n),n.prototype.parseElevations=function(t){if(null===t)return this._returnZeroElevations();switch(this.format){case"image/x-aaigrid":return this._parseAAIGrid(t);default:return console.log("Format '"+this.format+"' could not be parsed."),this._returnZeroElevations()}},n.prototype._returnZeroElevations=function(){for(var t=[],e=0;e<this.tilePixelSize*this.tilePixelSize;++e)t.push(0);return t},n.prototype._parseAAIGrid=function(t){var e,i=[],r=t.trim().split("\n"),n=0;for(e=0;e<r.length;++e)if(" "===r[e].substring(0,1)){n=e;break}for(e=n;e<r.length;e++)for(var o=r[e].trim().split(/\s+/),s=0;s<o.length;s++){var a=parseInt(o[s],10);a<this.minElevation&&(a=this.minElevation),i.push(a*this.scale)}return i},n.prototype.getBaseURl=function(){return this.getCoverageBaseUrl},n.prototype.getUrl=function(t){var e=t.geoBound,i=this.getCoverageBaseUrl;return"2.0"===this.version.substring(0,3)?(i+="&subset=x,"+this.crs+"("+e.west+","+e.east+")",i+="&subset=y,"+this.crs+"("+e.south+","+e.north+")"):"1.0"===this.version.substring(0,3)&&(i+="&bbox=",i+=e.west,i+=",",i+=e.south,i+=",",i+=e.east,i+=",",i+=e.north),i},n}),r("Layer/VectorLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/FeatureStyle"],function(t,e,i,r){var n=function(t){e.prototype.constructor.call(this,i.LAYER.Vector,t),t&&t.url?this.url=t.url:this.url=null,t&&t.callback?this.callback=t.callback:this.callback=null,this.minLevel=t&&t.hasOwnProperty("minLevel")?t.minLevel:0,this.maxLevel=t&&t.hasOwnProperty("maxLevel")?t.maxLevel:15,this.features=[]};return t.inherits(e,n),n.prototype._attach=function(t){e.prototype._attach.call(this,t);for(var i=0;i<this.features.length;i++)this._addFeatureToRenderers(this.features[i])},n.prototype._detach=function(){for(var t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);e.prototype._detach.call(this)},n.prototype.addFeatureCollection=function(t){var e=t.features;if(e)for(var i=0;i<e.length;i++)this.addFeature(e[i])},n.prototype.removeFeatureCollection=function(t){var e=t.features;if(e)for(var i=0;i<e.length;i++)this.removeFeature(e[i])},n.prototype._addFeatureToRenderers=function(t){var e=t.geometry,i=this.style,r=t.properties;if(r&&r.style&&(i=r.style),"GeometryCollection"===e.type)for(var n=e.geometries,o=0;o<n.length;o++)this.globe.vectorRendererManager.addGeometry(this,n[o],i);else this.globe.vectorRendererManager.addGeometry(this,e,i)},n.prototype._removeFeatureFromRenderers=function(t){var e=t.geometry;if("GeometryCollection"===e.type){var i=e.geometries,r=!1;if(this.globe&&this.globe.vectorRendererManager)for(var n=0;n<i.length;n++)r=this.globe.vectorRendererManager.removeGeometry(i[n],this);return r}if(this.globe&&this.globe.vectorRendererManager)return this.globe.vectorRendererManager.removeGeometry(e,this)},n.prototype.addFeature=function(t){var e=t.geometry;e&&e.type&&(this.features.push(t),this.globe&&(this._addFeatureToRenderers(t),this.isVisible()&&this.globe.renderContext.requestFrame()))},n.prototype.removeFeature=function(t){var e=this.features.indexOf(t);this.features.splice(e,1),this.globe&&(this._removeFeatureFromRenderers(t),this.isVisible()&&this.globe.renderContext.requestFrame())},n.prototype.removeAllFeatures=function(){if(this.globe)for(var t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);this.features.length=0,this.globe&&this.isVisible()&&this.globe.renderContext.requestFrame()},n.prototype.modifyFeatureStyle=function(t,e){this._removeFeatureFromRenderers(t)&&(t.properties.style=e,this._addFeatureToRenderers(t))},n.prototype.modifyStyle=function(t){var e;for(e=0;e<this.features.length;e++)this._removeFeatureFromRenderers(this.features[e]);for(this.style=t,e=0;e<this.features.length;e++)this._addFeatureToRenderers(this.features[e])},n.prototype.getStyle=function(){return this.style},n.prototype.setStyle=function(t){this.style=t},n}),r("Layer/AtmosphereLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/Program"],function(t,e,i,r){var n=function(t){e.prototype.constructor.call(this,i.LAYER.Atmosphere,t),this.name||(this.name="Atmosphere"),this.kr=t&&t.kr||.0025,this.km=t&&t.km||.0015,this.sunBrightness=t&&t.sunBrightness||15,this.exposure=t&&t.exposure||2,this.wavelength=t&&t.wavelength||[.65,.57,.475],this.lightDir=t&&t.lightDir||[1,0,0],this._skyProgram=null,this._groundProgram=null,this._originalProgram=null,this._isValid=!1,this.zIndex=-1};return t.inherits(e,n),n.prototype._attach=function(t){this.globe=t,this._innerRadius=this.globe.getCoordinateSystem().getGeoide().getRadius(),this._outerRadius=1.005*this._innerRadius;var e=t.renderContext;if(this._skyFromSpaceProgram=new r(e),this._skyFromSpaceProgram.loadFromFile("SkyFromSpaceVert.glsl","SkyFrag.glsl"),this._skyFromAtmosphereProgram=new r(e),this._skyFromAtmosphereProgram.loadFromFile("SkyFromAtmosphereVert.glsl","SkyFrag.glsl"),this._groundFromSpaceProgram=new r(e),this._groundFromSpaceProgram.loadFromFile("GroundFromSpaceVert.glsl","GroundFrag.glsl"),this._groundFromAtmosphereProgram=new r(e),this._groundFromAtmosphereProgram.loadFromFile("GroundFromAtmosphereVert.glsl","GroundFrag.glsl"),this._isValid=null!==this._skyFromSpaceProgram.glProgram&&null!==this._skyFromAtmosphereProgram.glProgram&&null!==this._groundFromSpaceProgram.glProgram&&null!==this._groundFromAtmosphereProgram.glProgram,this._isValid){this._skyFromSpaceProgram.apply(),this._initUniforms(this._skyFromSpaceProgram.uniforms),this._skyFromAtmosphereProgram.apply(),this._initUniforms(this._skyFromAtmosphereProgram.uniforms),this._groundFromSpaceProgram.apply(),this._initUniforms(this._groundFromSpaceProgram.uniforms),this._groundFromAtmosphereProgram.apply(),this._initUniforms(this._groundFromAtmosphereProgram.uniforms);var i,n,o=[],s=[],a=72,l=144;for(i=-a;i<=a;i++){var h=i*(.5*Math.PI)/a;for(n=-l;n<=l;n++){var u=n*Math.PI/l,c=this._outerRadius*Math.cos(u)*Math.cos(h),d=this._outerRadius*Math.sin(u)*Math.cos(h),p=this._outerRadius*Math.sin(h);o.push(c),o.push(d),o.push(p)}}for(i=0;i<2*a;i++)for(n=0;n<2*l;n++)s.push(i*(2*l+1)+n),s.push((i+1)*(2*l+1)+n+1),s.push(i*(2*l+1)+n+1),s.push((i+1)*(2*l+1)+n+1),s.push(i*(2*l+1)+n),s.push((i+1)*(2*l+1)+n);var f=e.gl;this._vertexBuffer=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,this._vertexBuffer),f.bufferData(f.ARRAY_BUFFER,new Float32Array(o),f.STATIC_DRAW),this._indexBuffer=f.createBuffer(),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this._indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),f.STATIC_DRAW),this._numIndices=s.length,this._originalProgram=t.tileManager.program,t.preRenderers.push(this),t.tileManager.addPostRenderer(this)}},n.prototype._initUniforms=function(t){var e=this.globe.renderContext.gl,i=-.95,r=1/(this._outerRadius-this._innerRadius),n=.25;vec3.normalize(this.lightDir),e.uniform1f(t.fKrESun,this.kr*this.sunBrightness),e.uniform1f(t.fKmESun,this.kr*this.sunBrightness),e.uniform1f(t.fKr4PI,4*this.kr*Math.PI),e.uniform1f(t.fKm4PI,4*this.km*Math.PI),e.uniform1f(t.fExposure,this.exposure);var o=[Math.pow(this.wavelength[0],4),Math.pow(this.wavelength[1],4),Math.pow(this.wavelength[2],4)];e.uniform3f(t.v3InvWavelength,1/o[0],1/o[1],1/o[2]),e.uniform3f(t.v3LightPos,this.lightDir[0],this.lightDir[1],this.lightDir[2]),e.uniform1f(t.fInnerRadius,this._innerRadius),e.uniform1f(t.fInnerRadius2,this._innerRadius*this._innerRadius),e.uniform1f(t.fOuterRadius,this._outerRadius),e.uniform1f(t.fOuterRadius2,this._outerRadius*this._outerRadius),e.uniform1f(t.fScale,r),e.uniform1f(t.fScaleDepth,n),e.uniform1f(t.fScaleOverScaleDepth,r/n),e.uniform1f(t.g,i),e.uniform1f(t.g2,i*i)},n.prototype.preRender=function(){if(this._isValid){var t=this.globe.tileManager;if(!this.isVisible())return void(t.program=this._originalProgram);var e,i,r,n=this.globe.renderContext,o=n.gl,s=n.viewMatrix;e=s[12],i=s[13],r=s[14];var a=[-(s[0]*e+s[1]*i+s[2]*r),-(s[4]*e+s[5]*i+s[6]*r),-(s[8]*e+s[9]*i+s[10]*r)],l=vec3.length(a);this._skyProgram=l<this._outerRadius?this._skyFromAtmosphereProgram:this._skyFromSpaceProgram,this._groundProgram=l<this._outerRadius?this._groundFromAtmosphereProgram:this._groundFromSpaceProgram,this._skyProgram.apply(),o.uniform3f(this._skyProgram.uniforms.v3CameraPos,a[0],a[1],a[2]),o.uniform1f(this._skyProgram.uniforms.fCameraHeight2,l*l),o.uniform1f(this._skyProgram.uniforms.fCameraHeight,l),this._groundProgram.apply();var h=[0,0,0];mat4.multiplyVec3(n.viewMatrix,h),o.uniform3f(this._groundProgram.uniforms.earthCenter,h[0],h[1],h[2]),vec3.normalize(this.lightDir),e=this.lightDir[0],i=this.lightDir[1],r=this.lightDir[2];var u=n.viewMatrix,c=[];c[0]=u[0]*e+u[4]*i+u[8]*r,c[1]=u[1]*e+u[5]*i+u[9]*r,c[2]=u[2]*e+u[6]*i+u[10]*r,o.uniform3f(this._groundProgram.uniforms.lightDir,c[0],c[1],c[2]),o.uniform3f(this._groundProgram.uniforms.v3CameraPos,a[0],a[1],a[2]),o.uniform1f(this._groundProgram.uniforms.fCameraHeight2,l*l),o.uniform1f(this._groundProgram.uniforms.fCameraHeight,l),t.program=this._groundProgram}},n.prototype.render=function(){if(this._isValid&&this.isVisible()&&this.globe){var t=this.globe.renderContext,e=t.gl;e.enable(e.CULL_FACE),this._skyProgram.apply(),e.uniformMatrix4fv(this._skyProgram.uniforms.projectionMatrix,!1,t.projectionMatrix),e.uniformMatrix4fv(this._skyProgram.uniforms.viewMatrix,!1,t.viewMatrix),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.vertexAttribPointer(this._skyProgram.attributes.vertex,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.drawElements(e.TRIANGLES,this._numIndices,e.UNSIGNED_SHORT,0),e.disable(e.CULL_FACE)}},n}),r("Tiling/MercatorTiling",["./Tile","../Renderer/GeoBound","./GeoTiling"],function(t,e,i){var r=function(t){return 20037508.34*t/180},n=function(t){var e=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return 20037508.34*e/180},o=function(t,e){return t/Math.pow(2,e)*360-180},s=function(t,e){var i=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))},a=function(i,a,l){t.prototype.constructor.call(this),this.level=i,this.x=a,this.y=l,this.geoBound=new e(o(a,i),s(l+1,i),o(a+1,i),s(l,i)),this.bound=new e(r(this.geoBound.west),n(this.geoBound.south),r(this.geoBound.east),n(this.geoBound.north))};a.prototype=new t,a.prototype.getElevation=function(t,e){return 0},a.prototype.createChildren=function(){var t=new a(this.level+1,2*this.x,2*this.y),e=new a(this.level+1,2*this.x+1,2*this.y),i=new a(this.level+1,2*this.x,2*this.y+1),r=new a(this.level+1,2*this.x+1,2*this.y+1);t.initFromParent(this,0,0),e.initFromParent(this,1,0),i.initFromParent(this,0,1),r.initFromParent(this,1,1),this.children=[t,e,i,r]},a.prototype.lonlat2tile=function(t){for(var e=Math.pow(2,this.level),i=this.config.tesselation-1,r=[],n=0;n<t.length;n++){var o=(t[n][0]+180)/360,s=Math.sin(t[n][1]*Math.PI/180),a=.5-Math.log((1+s)/(1-s))/(4*Math.PI);r.push([i*(o*e-this.x),i*(a*e-this.y)])}return r},a.prototype.generateVertices=function(t){this.matrix=this.config.coordinateSystem.getLHVTransform(this.geoBound.getCenter());var e=mat4.create();mat4.inverse(this.matrix,e),this.inverseMatrix=e;for(var i=this.config.tesselation,r=new Float32Array(3*i*(i+6)),n=1/(i-1),o=(this.config.coordinateSystem.geoide.radius,this.config.coordinateSystem.geoide.heightScale),s=0,a=Math.pow(2,this.level),l=[0,0,0],h=this.y,u=0;u<i;u++){var c=Math.PI*(1-2*h/a),d=Math.atan(.5*(Math.exp(c)-Math.exp(-c)));d=180*d/Math.PI;for(var p=(Math.cos(d),Math.sin(d),this.x),f=0;f<i;f++){var g=180*(2*p/a-1),m=t?o*t[s]:0;this.config.coordinateSystem.fromGeoTo3D([g,d,m],l);var v=l[0],y=l[1],b=l[2],x=3*s;r[x]=e[0]*v+e[4]*y+e[8]*b+e[12],r[x+1]=e[1]*v+e[5]*y+e[9]*b+e[13],r[x+2]=e[2]*v+e[6]*y+e[10]*b+e[14],s++,p+=n}h+=n}return r},a.prototype.buildSkirtVertices=function(e,i,r,n){var o=this.config.tesselation,s=this.config.vertexSize,a=Math.pow(2,this.level),l=0===this.y&&n===s*(o*o),h=this.y===a-1&&n===s*((o+1)*o);if(l||h){var u=this.vertices,c=this.config.coordinateSystem.fromGeoTo3D(l?[0,90,0]:[0,-90,0]);mat4.multiplyVec3(this.inverseMatrix,c);for(var d=0;d<o;d++){u[n]=c[0],u[n+1]=c[1],u[n+2]=c[2];for(var p=3;p<s;p++)u[n+p]=u[i+p];n+=s}}else t.prototype.buildSkirtVertices.call(this,e,i,r,n)};var l=function(t){this.startLevel=t,this.level0NumTilesX=Math.pow(2,this.startLevel)};return l.prototype=new i,l.prototype.generateLevelZeroTiles=function(t){t.skirt=!t.coordinateSystem.isFlat(),t.cullSign=1,t.srs="EPSG:3857",t.project=function(t){return[r(t[0]),n(t[1])]};for(var e=[],i=Math.pow(2,this.startLevel),o=Math.pow(2,this.startLevel),s=0;s<o;s++)for(var l=0;l<i;l++){var h=new a(this.startLevel,l,s);h.config=t,e.push(h)}return e},l.prototype._lon2LevelZeroIndex=function(t){var e=(t+180)/360;return Math.min(this.level0NumTilesX-1,Math.floor(e*this.level0NumTilesX))},l.prototype._lat2LevelZeroIndex=function(t){var e=Math.sin(t*Math.PI/180),i=.5-Math.log((1+e)/(1-e))/(4*Math.PI);return Math.min(this.level0NumTilesX-1,Math.floor(i*this.level0NumTilesX))},l}),r("Layer/BingLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/MercatorTiling"],function(t,e,i,r){var n=function(){function t(t,e,i){return Math.min(Math.max(t,e),i)}function e(t){return 256<<t}function i(i,r,l){i=t(i,n,o),r=t(r,s,a);var h=(r+180)/360,u=Math.sin(i*Math.PI/180),c=.5-Math.log((1+u)/(1-u))/(4*Math.PI),d=e(l),p=t(h*d+.5,0,d-1),f=t(c*d+.5,0,d-1);return[Math.floor(p),Math.floor(f)]}function r(t,e,i){for(var r="",n=i;n>0;n--){var o="0",s=1<<n-1;0!==(t&s)&&o++,0!==(e&s)&&(o++,o++),r+=o}return r}var n=-85.05112878,o=85.05112878,s=-180,a=180;return{tileXYToQuadKey:r,latLongToPixelXY:i}}(),o=function(t){e.prototype.constructor.call(this,i.LAYER.Bing,t),this.tilePixelSize=256,this.tiling=new r(t.baseLevel||2),this.numberOfLevels=18,this.baseUrl="",this.baseUrlSubDomains=[],this._ready=!1;var n=this;window._bingTileProviderCallback=function(e){n.baseUrl=e.resourceSets[0].resources[0].imageUrl,n.baseUrlSubDomains=e.resourceSets[0].resources[0].imageUrlSubdomains,n._ready=!0,t.onready&&t.onready instanceof Function&&t.onready(n),n.globe&&n.globe.renderContext.requestFrame()};var o=document.createElement("script");o.type="text/javascript",o.src="http://dev.virtualearth.net/REST/V1/Imagery/Metadata/"+t.imageSet+"?jsonp=_bingTileProviderCallback&key="+t.key,o.id="_bingTileProviderCallback",document.getElementsByTagName("head")[0].appendChild(o)};return t.inherits(e,o),o.prototype.getUrl=function(t){var e=this.baseUrl.replace("{quadkey}",n.tileXYToQuadKey(t.x,t.y,t.level));return e.replace("{subdomain}",this.baseUrlSubDomains[Math.floor(Math.random()*this.baseUrlSubDomains.length)])},o}),r("Renderer/GroundOverlayRenderer",["./Program","../Tiling/Tile"],function(t,e){var i=function(e){this.renderContext=e.renderContext,this.tileManager=e;var i="attribute vec3 vertex;\n";i+="attribute vec2 tcoord;\n",i+="uniform mat4 modelViewMatrix;\n",i+="uniform mat4 projectionMatrix;\n",i+="uniform vec4 extent; \n",i+="varying vec2 texCoord;\n",i+="void main(void) \n",i+="{\n",i+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",i+="\ttexCoord.x = tcoord.x * (extent[1] - extent[0]) + extent[0];\n",i+="\ttexCoord.y = tcoord.y * (extent[3] - extent[2]) + extent[2];\n",i+="}\n";var r="#ifdef GL_ES\n";r+="precision highp float;\n",r+="#endif\n",r+="\n",r+="varying vec2 texCoord;\n",r+="uniform sampler2D overlayTexture;\n",r+="uniform mat3 transform;\n",r+="uniform float opacity; \n",r+="\n",r+="void main(void)\n",r+="{\n",r+="\tvec3 tc = transform * vec3(texCoord,1.0); \n",r+="\ttc.xy /= tc.z; \n",r+="\tgl_FragColor.rgba = texture2D(overlayTexture, tc.xy); \n",r+="\tgl_FragColor.a = (tc.x >= 0.0 && tc.x <= 1.0 && tc.y >= 0.0 && tc.y <= 1.0) ? opacity * gl_FragColor.a  : 0.0; \n",r+="}\n",this.program=new t(this.renderContext),this.program.createFromSource(i,r),this.groundOverlays=[]};return i.prototype.render=function(t){var i=this.renderContext.gl;this.program.apply();var r=this.program.attributes;i.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,this.renderContext.projectionMatrix),i.uniform1i(this.program.uniforms.overlayTexture,0),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.depthFunc(i.LEQUAL),i.depthMask(!1);for(var n=mat4.create(),o=null,s=0;s<this.groundOverlays.length;s++){var a=this.groundOverlays[s];if(a.image.complete){a.texture||(a.texture=this.renderContext.createNonPowerOfTwoTextureFromImage(a.image,a.flipY));for(var l=!1,h=0;h<t.length;h++){var u=t[h];if(a.geoBound.intersects(u.geoBound)){l||(i.uniformMatrix3fv(this.program.uniforms.transform,!1,a.inverseTransform),i.uniform1f(this.program.uniforms.opacity,a.opacity),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.texture),i.bindBuffer(i.ARRAY_BUFFER,this.tileManager.tcoordBuffer),i.vertexAttribPointer(r.tcoord,2,i.FLOAT,!1,0,0),l=!0);var c=u.state===e.State.LOADED?u.bound:u.parent.bound;i.uniform4f(this.program.uniforms.extent,c.west,c.east,c.north,c.south),mat4.multiply(this.renderContext.viewMatrix,u.matrix,n),i.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,n),i.bindBuffer(i.ARRAY_BUFFER,u.vertexBuffer),i.vertexAttribPointer(r.vertex,3,i.FLOAT,!1,0,0);var d=u.state===e.State.LOADED?this.tileManager.tileIndexBuffer.getSolid():this.tileManager.tileIndexBuffer.getSubSolid(u.parentIndex);o!==d&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,d),o=d),i.drawElements(i.TRIANGLES,d.numIndices,i.UNSIGNED_SHORT,0)}}}}i.disable(i.BLEND),i.depthMask(!0)},i}),r("Layer/GroundOverlayLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/GeoBound","../Renderer/GroundOverlayRenderer"],function(t,e,i,r,n){var o=function(t){e.prototype.constructor.call(this,i.LAYER.GroundOverlay,t),this.quad=t.quad,"undefined"==typeof t.flipY?this.flipY=!0:this.flipY=t.flipY,this.geoBound=new r,this.geoBound.computeFromCoordinates(this.quad),"string"==typeof t.image?(this.image=new Image,this.image.crossOrigin="",this.image.src=t.image):t.image instanceof HTMLImageElement&&(this.image=t.image),this.globe=null};return t.inherits(e,o),o.prototype._attach=function(t){var e=t.groundOverlayRenderer;e||(e=new n(t.tileManager),t.tileManager.addPostRenderer(e),t.groundOverlayRenderer=e),e.groundOverlays.push(this),this.globe=t,this.computeTransform()},o.prototype._detach=function(t){var e=this.globe.groundOverlayRenderer;if(e){var i=e.groundOverlays.indexOf(this);i!==-1&&(e.groundOverlays.splice(i,1),0===e.groundOverlays.length&&(this.globe.tileManager.removePostRenderer(e),this.globe.groundOverlayRenderer=null))}},o.prototype.computeInverse=function(){var t,e,i,r,n,o,s,a,l,h=this.transform[0]*(this.transform[8]*this.transform[4]-this.transform[5]*this.transform[7])-this.transform[3]*(this.transform[8]*this.transform[1]-this.transform[7])*this.transform[3]+this.transform[6]*(this.transform[5]*this.transform[1]-this.transform[4]*this.transform[2]);t=this.transform[4]*this.transform[8]-this.transform[5]*this.transform[7],r=this.transform[5]*this.transform[6]-this.transform[3]*this.transform[8],s=this.transform[3]*this.transform[7]-this.transform[4]*this.transform[6],e=this.transform[2]*this.transform[7]-this.transform[1]*this.transform[8],n=this.transform[0]*this.transform[8]-this.transform[2]*this.transform[6],a=this.transform[1]*this.transform[6]-this.transform[0]*this.transform[7],i=this.transform[1]*this.transform[5]-this.transform[2]*this.transform[4],o=this.transform[2]*this.transform[3]-this.transform[0]*this.transform[5],l=this.transform[0]*this.transform[4]-this.transform[1]*this.transform[3],this.inverseTransform=[t/h,e/h,i/h,r/h,n/h,o/h,s/h,a/h,l/h]},o.prototype.computeTransform=function(){var t=this.quad[0],e=this.quad[1],i=this.quad[2],r=this.quad[3],n=this.globe.tileManager.tileConfig;"EPSG:4326"!==n.srs&&(t=n.project(t),e=n.project(e),i=n.project(i),r=n.project(r));var o=t[0],s=e[0],a=i[0],l=r[0],h=t[1],u=e[1],c=i[1],d=r[1],p=o-s+a-l,f=h-u+c-d;if(p||f){var g,m,v,y,b,x,C,_,w=s-a,T=l-a,A=u-c,I=d-c,M=p*I-T*f,S=w*f-p*A,P=w*I-T*A;if(!P)return;C=M/P,_=S/P,g=s-o+C*s,m=l-o+_*l,v=o,y=u-h+C*u,b=d-h+_*d,x=h,this.transform=[g,y,C,m,b,_,v,x,1]}else this.transform=[s-o,u-h,0,a-s,c-u,0,o,h,1];this.computeInverse()},o}),r("Layer/OSMLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/MercatorTiling"],function(t,e,i,r){var n=function(t){t.tilePixelSize=t.tilePixelSize||256,t.tiling=new r(t.baseLevel||2),t.numberOfLevels=t.numberOfLevels||21,e.prototype.constructor.call(this,i.LAYER.OSM,t)};return t.inherits(e,n),n.prototype.getUrl=function(t){return this.baseUrl+"/"+t.level+"/"+t.x+"/"+t.y+".png"},n}),r("Layer/TileWireframeLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/Program","../Tiling/Tile"],function(t,e,i,r,n){var o=function(t){e.prototype.constructor.call(this,i.LAYER.TileWireframe,t),this.outline=!(!t||!t.outline)&&t.outline,this.globe=null,this.program=null,this.indexBuffer=null,this.subIndexBuffer=[null,null,null,null],this.zIndex=-1};return t.inherits(e,o),o.prototype.buildIndexBuffer=function(){var t,e,i,r,n,o,s=this.globe.renderContext.gl,a=this.globe.tileManager.tileConfig.tesselation,l=[],h=this.outline?a-1:1;for(e=0;e<a;e+=h)for(t=0;t<a-1;t++)l.push(e*a+t),l.push(e*a+t+1);for(e=0;e<a;e+=h)for(t=0;t<a-1;t++)l.push(t*a+e),l.push((t+1)*a+e);o=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),s.STATIC_DRAW),o.numIndices=l.length,this.indexBuffer=o;var u=(a-1)/2;for(h=this.outline?u:1,i=0;i<4;i++){for(t=i%2,e=Math.floor(i/2),l=[],r=u*e;r<u*(e+1)+1;r+=h)for(n=u*t;n<u*(t+1);n++)l.push(r*a+n),l.push(r*a+n+1);for(r=u*t;r<u*(t+1)+1;r+=h)for(n=u*e;n<u*(e+1);n++)l.push(n*a+r),l.push((n+1)*a+r);o=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),s.STATIC_DRAW),o.numIndices=l.length,this.subIndexBuffer[i]=o}},o.prototype._attach=function(t){if(e.prototype._attach.call(this,t),this.isVisible()&&this.globe.tileManager.addPostRenderer(this),!this.program){var i="attribute vec3 vertex;\n";i+="uniform mat4 modelViewMatrix;\n",i+="uniform mat4 projectionMatrix;\n",i+="void main(void) \n",i+="{\n",i+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",i+="}\n";var n="precision highp float; \n";n+="uniform vec3 color; \n",n+="uniform float alpha; \n",n+="void main(void)\n",n+="{\n",n+="\tgl_FragColor = vec4(color,alpha);\n",n+="}\n",this.program=new r(this.globe.renderContext),this.program.createFromSource(i,n),this.buildIndexBuffer()}},o.prototype._detach=function(){this.globe.tileManager.removePostRenderer(this),e.prototype._detach.call(this)},o.prototype.render=function(t){var e=this.globe.renderContext,i=e.gl;i.enable(i.BLEND),this.program.apply(),i.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,e.projectionMatrix);for(var r=this.program.attributes.vertex,o=null,s=0;s<t.length;s++){var a=t[s],l=a.state===n.State.LOADED,h=a.parentIndex===-1;mat4.multiply(e.viewMatrix,a.matrix,e.modelViewMatrix),i.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,e.modelViewMatrix),i.uniform3f(this.program.uniforms.color,this.color[0],this.color[1],this.color[2]),i.uniform1f(this.program.uniforms.alpha,this.getOpacity()),i.bindBuffer(i.ARRAY_BUFFER,a.vertexBuffer),i.vertexAttribPointer(r,3,i.FLOAT,!1,4*a.config.vertexSize,0);var u=l||h?this.indexBuffer:this.subIndexBuffer[a.parentIndex];o!==u&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,u),o=u);var c=o.numIndices;i.drawElements(i.LINES,c,i.UNSIGNED_SHORT,0)}i.disable(i.BLEND)},o.prototype.setVisible=function(t){return e.prototype.setVisible.call(this,t),"boolean"==typeof t&&(this.isVisible()?this.globe.tileManager.addPostRenderer(this):this.globe.tileManager.removePostRenderer(this)),this.isVisible()},o}),r("Renderer/Ray",["./glMatrix"],function(){var t=function(t,e){this.orig=t,this.dir=e};t.createFromPixel=function(e,i,r){var n=i/e.canvas.width*2-1,o=-(r/e.canvas.height*2-1),s=mat4.create();mat4.multiply(e.projectionMatrix,e.viewMatrix,s),mat4.inverse(s);var a=mat4.multiplyVec4(s,[n,o,-1,1]);a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];var l=mat4.create();mat4.inverse(e.viewMatrix,l),vec3.set([0,0,0],e.eyePosition),mat4.multiplyVec3(l,e.eyePosition);var h=vec3.create(e.eyePosition),u=vec3.subtract(a,e.eyePosition,vec3.create());return vec3.normalize(u),new t(h,u)},t.createFromEvent=function(e,i){var r=e.getXYRelativeToCanvas(i);return t.createFromPixel(r[0],r[1])},t.Intersection=function(t){this.t=t,this.geometry=null},t.prototype.computePoint=function(t){var e=vec3.create();return vec3.scale(this.dir,t,e),vec3.add(e,this.orig),e},t.prototype.planeIntersect=function(t,e){var i=vec3.dot(e,this.dir),r=1e-6;if(Math.abs(i)>r){var n=vec3.create();vec3.subtract(t,this.orig,n);var o=vec3.dot(n,e)/i;return o}return-1},t.prototype.sphereIntersect=function(t,e){var i=vec3.subtract(this.orig,t,vec3.create()),r=2*vec3.dot(this.dir,i),n=vec3.dot(i,i)-e*e,o=r*r-4*n;if(o<0)return-1;o=Math.sqrt(o);var s=(-r-o)/2,a=(-r+o)/2;if(s>a){var l=s;s=a,a=l}return a<0?-1:s<0?a:s};var e=1e-6;return t.prototype.triangleIntersectOptimized=function(i,r,n,o){var s=i[n]-i[r],a=i[n+1]-i[r+1],l=i[n+2]-i[r+2],h=i[o]-i[r],u=i[o+1]-i[r+1],c=i[o+2]-i[r+2],d=this.dir[1]*c-this.dir[2]*u,p=this.dir[2]*h-this.dir[0]*c,f=this.dir[0]*u-this.dir[1]*h,g=s*d+a*p+l*f;if(g>-e&&g<e)return null;var m=1/g,v=this.orig[0]-i[r],y=this.orig[1]-i[r+1],b=this.orig[2]-i[r+2],x=(v*d+y*p+b*f)*m;if(x<0||x>1)return null;
var C=y*l-b*a,_=b*s-v*l,w=v*a-y*s,T=(this.dir[0]*C+this.dir[1]*_+this.dir[2]*w)*m;if(T<0||x+T>1)return null;var A=(h*C+u*_+c*w)*m;return A>=0?new t.Intersection(A):null},t.prototype.nodeIntersect=function(t,e){var i;for(e=e||[],i=0;i<t.children.length;i++)t.children[i].intersectWith(this,e);for(i=0;i<t.geometries.length;i++)this.geometryIntersect(t.geometries[i],e);return e.sort(function(t,e){return t.t-e.t}),e},t.prototype.lodNodeIntersect=function(t,e){var i;if(e=e||[],this.sphereIntersect(t.center,t.radius)>=0)if(t.children.length>0&&0===t.childToLoad)for(i=0;i<t.children.length;i++)this.lodNodeIntersect(t.children[i],e);else for(i=0;i<t.geometries.length;i++)this.geometryIntersect(t.geometries[i],e);return e},t.prototype.geometryIntersect=function(t,e){for(var i=t.mesh.indices,r=0;r<i.length;r+=3){var n=this.triangleIntersectOptimized(t.mesh.vertices,t.mesh.numElements*i[r],t.mesh.numElements*i[r+1],t.mesh.numElements*i[r+2]);n&&(n.geometry=t,e.push(n))}},t}),r("Tiling/Mesh",[],function(){var t=function(t){this.renderContext=t,this.vertexBuffer=null,this.tcoordBuffer=null,this.indexBuffer=null,this.colorBuffer=null,this.numVertices=0,this.mode=t.gl.TRIANGLES};return t.prototype.setVertices=function(t){var e=this.renderContext.gl;null===this.vertexBuffer&&(this.vertexBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),this.numVertices=t.length},t.prototype.setTexCoords=function(t){var e=this.renderContext.gl;null===this.tcoordBuffer&&(this.tcoordBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.tcoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW)},t.prototype.setColors=function(t){var e=this.renderContext.gl;null===this.colorBuffer&&(this.colorBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW)},t.prototype.setIndices=function(t){var e=this.renderContext.gl;null===this.indexBuffer&&(this.indexBuffer=e.createBuffer()),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),e.STATIC_DRAW),this.numIndices=t.length},t.prototype.setIndicesToWireframe=function(t){this.mode=this.renderContext.gl.LINES;var e=[];e.length=2*t.length;for(var i=0;i<t.length;i+=3)e[2*i]=t[i],e[2*i+1]=t[i+1],e[2*i+2]=t[i+1],e[2*i+3]=t[i+2],e[2*i+4]=t[i+2],e[2*i+5]=t[i];this.setIndices(e)},t.prototype.render=function(t){var e=this.renderContext.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.vertexAttribPointer(t.vertex,3,e.FLOAT,!1,0,0),t.hasOwnProperty("tcoord")&&(e.bindBuffer(e.ARRAY_BUFFER,this.tcoordBuffer),e.vertexAttribPointer(t.tcoord,2,e.FLOAT,!1,0,0)),t.hasOwnProperty("color")&&(e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.vertexAttribPointer(t.color,4,e.FLOAT,!1,0,0)),this.indexBuffer?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(this.mode,this.numIndices,e.UNSIGNED_SHORT,0)):e.drawArrays(this.mode,0,this.numVertices/3)},t.prototype.dispose=function(){var t=this.renderContext.gl;this.indexBuffer&&t.deleteBuffer(this.indexBuffer),this.vertexBuffer&&t.deleteBuffer(this.vertexBuffer),this.tcoordBuffer&&t.deleteBuffer(this.tcoordBuffer),this.colorBuffer&&t.deleteBuffer(this.colorBuffer),this.indexBuffer=null,this.vertexBuffer=null,this.tcoordBuffer=null,this.colorBuffer=null},t}),r("Crs/AstroCoordTransform",[],function(){var t=2*Math.PI,e=4*Math.PI,i=180/Math.PI,r=[[.57595865315,4.9261918136,0,0,.11129056012,4.7005372834],[.574770433,4.9368292465,0,0,.11142137093,4.71279419371]],n=[[.88781538514,-.88781538514,.39788119938,-.39788119938,.86766174755,-.86766174755],[.88998808748,-.88998808748,.39777715593,-.39777715593,.86766622025,-.86766622025]],o=[[.46019978478,.46019978478,.9174369467,.9174369467,.49715499774,.49715499774],[.45598377618,.45598377618,.91748206207,.91748206207,.49714719172,.49714719172]],s=[[4.9261918136,.57595865315,0,0,4.7005372834,.11129056012],[4.9368292465,.574770433,0,0,4.71279419371,.11142137093]],a={transform:function(i,a){var l,h,u,c,d,p,f,g=1;return u=i[0]-s[g][a],c=i[1],d=Math.sin(c),p=Math.cos(c),f=p*Math.sin(u),c=-n[g][a]*f+o[g][a]*d,c=Math.max(-1,Math.min(c,1)),h=Math.asin(c),u=Math.atan2(o[g][a]*f+n[g][a]*d,p*Math.cos(u)),l=(u+r[g][a]+e)%t,[l,h]},transformInDeg:function(a,l){var h,u,c,d,p,f,g,m=1;return c=a[0]/i-s[m][l],d=a[1]/i,p=Math.sin(d),f=Math.cos(d),g=f*Math.sin(c),d=-n[m][l]*g+o[m][l]*p,d=Math.max(-1,Math.min(d,1)),u=Math.asin(d)*i,c=Math.atan2(o[m][l]*g+n[m][l]*p,f*Math.cos(c)),h=(c+r[m][l]+e)%t*i,[h,u]}};return a.Type={EQ2GAL:0,GAL2EQ:1,EQ2ECL:2,ECL2EQ:3,ECL2GAL:4,GAL2ECL:5},a}),r("Crs/Geoide",[],function(){var t=function(t){if(this.radius=t&&t.hasOwnProperty("radius")?t.radius:null,this.realPlanetRadius=t&&t.hasOwnProperty("realPlanetRadius")?t.realPlanetRadius:null,null===this.radius||null===this.realPlanetRadius)throw new ReferenceError("Radius and realPlanetRadius must be set to define a geoide","Geoide.js");this.heightScale=1/this.realPlanetRadius};return t.prototype.getRealPlanetRadius=function(){return this.realPlanetRadius},t.prototype.getRadius=function(){return this.radius},t.prototype.getHeightScale=function(){return this.heightScale},t}),r("Crs/AbstractCrs",["../Utils/Numeric","./Geoide","../Utils/Constants","./AstroCoordTransform","../Renderer/glMatrix"],function(t,e,i,r){var n=function(t){if(this.flat=!1,this.geoide=null,this.type=null,this.geoBound=null,!(t&&t.geoideName&&t.type&&t.geoBound))throw new ReferenceError("The geoide's parameters, the geoBound and the type of context must be defined",n.js);this.geoide=new e(t),this.geoideName=t.geoideName,this.type=t.type,this.geoBound=t.geoBound};return n.prototype.isFlat=function(){return this.flat},n.prototype.getVerticalAt3D=function(t,e){return e||(e=new Array(3)),this.isFlat()?(e[0]=0,e[1]=0,e[2]=1):vec3.normalize(t,e),e},n.prototype.fromGeoTo3D=function(e,i){if(i||(i=new Array(3)),!e||e.length<2)return console.log("Erreur !"),i[0]=0,i[1]=0,i[2]=0,i;var r=t.toRadian(e[0]),n=t.toRadian(e[1]),o=Math.cos(n),s=e.length>2?this.geoide.getHeightScale()*e[2]:0,a=this.geoide.getRadius()+s;return i[0]=a*Math.cos(r)*o,i[1]=a*Math.sin(r)*o,i[2]=a*Math.sin(n),i},n.prototype.from3DToGeo=function(e,i){i||(i=new Array(3));var r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=Math.atan2(e[1]/r,e[0]/r),o=Math.asin(e[2]/r);return i[0]=t.toDegree(n),i[1]=t.toDegree(o),i[2]=this.geoide.getRealPlanetRadius()*(r-this.geoide.getRadius()),i},n.prototype.getLocalTransform=function(t,e){e||(e=mat4.create());var i=t[0]*Math.PI/180,r=t[1]*Math.PI/180,n=[Math.cos(i)*Math.cos(r),Math.sin(i)*Math.cos(r),Math.sin(r)],o=[-Math.sin(i),Math.cos(i),0],s=vec3.create();return vec3.cross(n,o,s),e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=0,e[4]=s[0],e[5]=s[1],e[6]=s[2],e[7]=0,e[8]=n[0],e[9]=n[1],e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.prototype.getLHVTransform=function(t,e){e||(e=mat4.create());var i=t[0]*Math.PI/180,r=t[1]*Math.PI/180,n=[Math.cos(i)*Math.cos(r),Math.sin(i)*Math.cos(r),Math.sin(r)],o=[-Math.sin(i),Math.cos(i),0],s=vec3.create();vec3.cross(n,o,s);var a=this.get3DFromWorld(t);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=0,e[4]=s[0],e[5]=s[1],e[6]=s[2],e[7]=0,e[8]=n[0],e[9]=n[1],e[10]=n[2],e[11]=0,e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=1,e},n.prototype.getSideVector=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.prototype.getFrontVector=function(t,e){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e},n.prototype.getUpVector=function(t,e){return e[0]=t[8],e[1]=t[9],e[2]=t[10],e},n.prototype.formatCoordinates=function(t){throw"Not implemented"},n.prototype.getGeoide=function(){return this.geoide},n.prototype.getGeoideName=function(){return this.geoideName},n.prototype.getType=function(){return this.type},n.prototype.getElevation=function(t,e){return t.getElevation(e.coordinates[0],e.coordinates[1])},n.prototype.getWorldFrom3D=function(t,e){e||(e=new Array(3));var i=this.from3DToGeo(t);return this._setupPosAfterTrans(i),e[0]=i[0],e[1]=i[1],e[2]=i.length>2?i[2]:this.geoide.getRealPlanetRadius(),e},n.prototype.get3DFromWorld=function(t,e){e||(e=vec3.create());var i=t.slice(0);return this._setupPosBeforeTrans(i),this.fromGeoTo3D(i,e),e},n.prototype.get3DFromWorldInCrs=function(t,e,i){i||(i=vec3.create());var r=this.convert(t,e,this.getGeoideName());return this.get3DFromWorld(r,i),i},n.prototype.getSexagesimalFromDeg=function(t,e){e=e||[];var i=t[0];return i<0&&(i+=360),e[0]=this.fromDegreesToHMS(i),e[1]=this.fromDegreesToDMS(t[1]),e},n.prototype.getDecimalDegFromSexagesimal=function(t,e){function i(t){return"-"===t[0]?-1:1}e=e||[];var r=t[0].split(" "),n=parseFloat(r[0]),o=parseFloat(r[1]),s=parseFloat(r[2]);e[0]=15*(n+o/60+s/3600);var a=t[1].split(" ");return n=parseFloat(a[0]),o=parseFloat(a[1]),s=parseFloat(a[2]),e[1]=i(a[0])*(Math.abs(n)+o/60+s/3600),e},n.prototype.convert=function(t,e,n){if(e===n)return t;var o=null,s=null;switch(e+"2"+n){case i.CRS.Galactic+"2"+i.CRS.Equatorial:s=r.Type.GAL2EQ,o=r.transformInDeg(t,s);break;case i.CRS.Equatorial+"2"+i.CRS.Galactic:s=r.Type.EQ2GAL,o=r.transformInDeg(t,s),o[0]<0&&(console.warn("EQ2GAL transformation returned negative value"),o[0]+=360);break;case i.CRS.Mars_2000+"2"+i.CRS.Mars_2000_old:case i.CRS.Mars_2000_old+"2"+i.CRS.Mars_2000:o=t;break;default:throw"Conversion "+e+" to "+n+" is not implemented"}return o},n.prototype.fromDegreesToHMS=function(e){var i=e/15,r=Math.abs(i),n=Math.floor(r),o=60*(r-n),s=Math.floor(o),a=60*(o-s);return n+"h "+s+"m "+t.roundNumber(a,2)+"s"},n.prototype.fromDegreesToDMS=function(e){function i(t){return t>=0?"+":"-"}var r=Math.abs(e),n=Math.floor(r),o=60*(r-n),s=Math.floor(o),a=60*(o-s);return i(e)+n+String.fromCharCode(176)+" "+s+"' "+t.roundNumber(a,2)+'"'},n.prototype._setupPosBeforeTrans=function(t){throw"Not implemented"},n.prototype._setupPosAfterTrans=function(t){throw"Not implemented"},n.prototype.getGeoBound=function(){return this.geoBound},n}),r("Crs/WGS84Crs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(t,e,i,r,n){var o=function(i){t.prototype.constructor.call(this,{geoideName:r.CRS.WGS84,radius:1,realPlanetRadius:6378137,type:r.CONTEXT.Planet,geoBound:new e(-180,-90,180,90)})};return i.inherits(t,o),o.prototype.formatCoordinates=function(t){var e=[];return e[0]=n.roundNumber(t[0],3),e[0]+="&deg;",e[1]=n.roundNumber(t[1],3),e[1]+="&deg;",e},o.prototype._setupPosAfterTrans=function(t){},o.prototype._setupPosBeforeTrans=function(t){},o}),r("Crs/Mars2000Crs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(t,e,i,r,n){var o=function(i){t.prototype.constructor.call(this,{geoideName:r.CRS.Mars_2000,radius:1,realPlanetRadius:3396190,type:r.CONTEXT.Planet,geoBound:new e(-180,-90,180,90)})};return i.inherits(t,o),o.prototype.formatCoordinates=function(t){var e=[],i=n.roundNumber(t[0],3),r=n.roundNumber(t[1],3);return e[0]=r>=0?r+" N":-1*r+" S",e[1]=i>=0?i+" E":-1*i+" W",e},o.prototype._setupPosAfterTrans=function(t){},o.prototype._setupPosBeforeTrans=function(t){},o}),r("Crs/EquatorialCrs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(t,e,i,r){var n=function(i){t.prototype.constructor.call(this,{geoideName:r.CRS.Equatorial,radius:10,realPlanetRadius:1,type:r.CONTEXT.Sky,geoBound:new e(0,-90,360,90)})};return i.inherits(t,n),n.prototype.transformVec=function(t){var e=this.computeTransformMatrix(),i=[];return mat4.multiplyVec3(e,t,i),i},n.prototype.computeTransformMatrix=function(){var t=[],e=this.convert([0,90],r.CRS.Galactic,r.CRS.Equatorial),i=this.fromGeoTo3D(e),n=this.convert([0,0],r.CRS.Galactic,r.CRS.Equatorial),o=this.fromGeoTo3D(n),s=this.convert([90,0],r.CRS.Galactic,r.CRS.Equatorial),a=this.fromGeoTo3D(s);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=0,t[4]=a[0],t[5]=a[1],t[6]=a[2],t[7]=0,t[8]=i[0],t[9]=i[1],t[10]=i[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.prototype.formatCoordinates=function(t){return this.getSexagesimalFromDeg(t)},n.prototype._setupPosAfterTrans=function(t){t[0]<0&&(t[0]+=360)},n.prototype._setupPosBeforeTrans=function(t){t[0]>180&&(t[0]-=360)},n}),r("Crs/GalacticCrs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(t,e,i,r,n){var o=function(i){t.prototype.constructor.call(this,{geoideName:r.CRS.Galactic,radius:10,realPlanetRadius:1,type:r.CONTEXT.Sky,geoBound:new e(0,-90,360,90)})};return i.inherits(t,o),o.prototype.formatCoordinates=function(t){var e=[];return e[0]=n.roundNumber(t[0],3),e[0]+="&deg;",e[1]=n.roundNumber(t[1],3),e[1]+="&deg;",e},o.prototype._setupPosAfterTrans=function(t){t[0]<0&&(t[0]+=360),[t[0],t[1]]=this.convert(t,r.CRS.Equatorial,r.CRS.Galactic)},o.prototype._setupPosBeforeTrans=function(t){[t[0],t[1]]=this.convert(t,r.CRS.Galactic,r.CRS.Equatorial),t[0]>180&&(t[0]-=360)},o}),r("Projection/AbstractProjection",["../Renderer/GeoBound"],function(t){var e=function(e,i,r){this.geoBound=new t(i[0],i[1],i[2],i[3]),this.projectionCenter=e,this.options=r||{}};return e.prototype.getProjectionCenter=function(){return this.projectionCenter},e.prototype.getGeoBound=function(){return this.geoBound},e.prototype.unProject=function(t,e){throw"Not implemented"},e.prototype.project=function(t,e){throw"Not implemented"},e}),r("Projection/AitoffProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){t.prototype.constructor.call(this,[0,0],[-180,-90,180,90],e)};e.inherits(t,i);var r=function(t){return t?t/Math.sin(t):1};return i.prototype.unProject=function(t,e){e||(e=new Array(3));var i,r,n=.005;if(!(t[0]*t[0]+4*t[1]*t[1]>Math.PI*Math.PI+n)){var o=t[0],s=t[1],a=25;do{var l,h=Math.sin(o),u=Math.sin(o/2),c=Math.cos(o/2),d=Math.sin(s),p=Math.cos(s),f=Math.sin(2*s),g=d*d,m=p*p,v=u*u,y=1-m*c*c,b=y?Math.acos(p*c)*Math.sqrt(l=1/y):l=0,x=2*b*p*u-t[0],C=b*d-t[1],_=l*(m*v+b*p*c*g),w=l*(.5*h*f-2*b*d*u),T=.25*l*(f*u-b*d*m*h),A=l*(g*c+b*v*p),I=w*T-A*_;if(!I)break;i=(C*w-x*A)/I,r=(x*T-C*_)/I,o-=i,s-=r}while((Math.abs(i)>n||Math.abs(r)>n)&&--a>0);return e[0]=180*o/Math.PI,e[1]=180*s/Math.PI,e[2]=t[2],e}},i.prototype.project=function(t,e){e||(e=new Array(3));var i=t[0]*Math.PI/180,n=t[1]*Math.PI/180,o=Math.cos(n),s=r(Math.acos(o*Math.cos(i/=2)));return e[0]=2*o*Math.sin(i)*s,e[1]=Math.sin(n)*s,e[2]=t[2],e},i}),r("Projection/AugustProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){t.prototype.constructor.call(this,[0,0],[-180,-90,180,90],e)};return e.inherits(t,i),i.prototype.unProject=function(t,e){throw"must be implemented"},i.prototype.project=function(t,e){e||(e=new Array(3));var i=t[0]*Math.PI/180,r=t[1]*Math.PI/180,n=Math.tan(r/2),o=Math.sqrt(1-n*n),s=1+o*Math.cos(i/=2),a=Math.sin(i)*o/s,l=n/s,h=a*a,u=l*l;return e[0]=4/3*a*(3+h-3*u),e[1]=4/3*l*(3+3*h-u),e[2]=t[2],e},i}),r("Projection/MercatorProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){t.prototype.constructor.call(this,[0,0],[-180,-80,180,84],e),this.lambda0=e&&e.lambda0?e.lambda0:0};e.inherits(t,i);var r=function(t){var e=Math.exp(t);return(e-1/e)/2};return i.prototype.unProject=function(t,e){return e||(e=new Array(3)),e[0]=this.lambda0+180*t[0]/Math.PI,e[1]=180*Math.atan(r(t[1]))/Math.PI,e[2]=t[2],Math.abs(e[1])>85.05?null:e},i.prototype.project=function(t,e){e||(e=new Array(3)),t[1]>85.05&&(t[1]=85.05),t[1]<-85.05&&(t[1]=-85.05);var i=t[0]*Math.PI/180,r=t[1]*Math.PI/180,n=i-this.lambda0*Math.PI/180,o=Math.log(Math.tan(r)+1/Math.cos(r));return e[0]=n,e[1]=o,e[2]=t[2],e},i}),r("Projection/MollweideProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){function i(t){if(Math.abs(t)===Math.PI/2)return t;var e,i=.001,r=t;do{var n=2*r;r=e,r||(r=t),e=n/2-(n+Math.sin(n)-Math.PI*Math.sin(t))/(2+2*Math.cos(n))}while(Math.abs(e-r)>=i);return e}var r=function(e){t.prototype.constructor.call(this,[0,0],[-180,-90,180,90],e)};return e.inherits(t,r),r.prototype.unProject=function(t,e){e||(e=new Array(3));var i=Math.asin(t[1]/Math.sqrt(2)),r=Math.asin((2*i+Math.sin(2*i))/Math.PI),n=Math.PI*t[0]/(2*Math.sqrt(2)*Math.cos(i));return e[0]=180*n/Math.PI,e[1]=180*r/Math.PI,e[2]=t[2],e},r.prototype.project=function(t,e){e||(e=new Array(3));var r=t[0]*Math.PI/180,n=t[1]*Math.PI/180,o=i(n),s=2*Math.sqrt(2)/Math.PI*r*Math.cos(o),a=Math.sqrt(2)*Math.sin(o);return e[0]=s,e[1]=a,e[2]=t[2],e},r}),r("Projection/PlateProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){t.prototype.constructor.call(this,[0,0],[-180,-90,180,90],e)};return e.inherits(t,i),i.prototype.unProject=function(t,e){return e||(e=new Array(3)),e[0]=180*t[0]/Math.PI,e[1]=180*t[1]/Math.PI,e[2]=t[2],e},i.prototype.project=function(t,e){return e||(e=new Array(3)),e[0]=t[0]*Math.PI/180,e[1]=t[1]*Math.PI/180,e[2]=t[2],e},i}),r("Projection/AzimuthProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){this.pole=e&&e.pole||"north";var i,r;"south"===this.pole?(i=[-180,-90,180,0],r=[0,-90]):(i=[-180,0,180,90],r=[0,90],this.pole="north"),t.prototype.constructor.call(this,r,i,e)};return e.inherits(t,i),i.prototype.unProject=function(t,e){var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]),r=Math.atan2(t[0],-t[1]);return i=180*i/Math.PI,r=180*r/Math.PI,r*="south"===this.pole?-1:1,i>90?null:(e||(e=new Array(3)),e[0]=r,e[1]="south"===this.pole?i-90:90-i,e[2]=t[2],e)},i.prototype.project=function(t,e){e||(e=new Array(3));var i="south"===this.pole?90+t[1]:90-t[1];i=i*Math.PI/180;var r=t[0]*Math.PI/180;return r*="south"===this.pole?-1:1,e[0]=i*Math.sin(r),e[1]=-i*Math.cos(r),e[2]=t[2],e},i}),r("Projection/ProjectionFactory",["../Utils/Constants","./AitoffProjection","./AugustProjection","./MercatorProjection","./MollweideProjection","./PlateProjection","./AzimuthProjection"],function(t,e,i,r,n,o,s){return{create:function(a){var l;if(!a||!a.projectionName)throw new ReferenceError("Unable to get options.projectionName","ProjectionFactory.js");switch(a.projectionName){case t.PROJECTION.Aitoff:l=new e(a);break;case t.PROJECTION.August:l=new i(a);break;case t.PROJECTION.Azimuth:l=new s(a);break;case t.PROJECTION.Mercator:l=new r(a);break;case t.PROJECTION.Mollweide:l=new n(a);break;case t.PROJECTION.Plate:l=new o(l,a);break;default:throw new RangeError("Unable to create the projection "+a.projectionName,"ProjectionFactory.js")}return l}}}),r("Crs/ProjectedCrs",["./AbstractCrs","../Utils/Utils","../Projection/ProjectionFactory","../Renderer/glMatrix"],function(t,e,i){var r=function(e,r){t.prototype.constructor.call(this,{geoideName:e.getGeoideName(),radius:e.getGeoide().getRadius(),realPlanetRadius:e.getGeoide().getRealPlanetRadius(),type:e.getType(),geoBound:e.getGeoBound()}),this.cs=e,this.projection=i.create(r),this.geoBound.setWest(this.projection.getGeoBound().getWest()),this.geoBound.setSouth(this.projection.getGeoBound().getSouth()),this.geoBound.setEast(this.projection.getGeoBound().getEast()),this.geoBound.setNorth(this.projection.getGeoBound().getNorth()),this.flat=!0};return e.inherits(t,r),r.prototype.formatCoordinates=function(t){return this.cs.formatCoordinates(t)},r.prototype.getWorldFrom3D=function(t,e){return e||(e=new Array(3)),this.projection.unProject(t,e),this.cs._setupPosAfterTrans(e),e[2]=e[2]/this.geoide.getHeightScale(),e},r.prototype.get3DFromWorld=function(t,e){e||(e=vec3.create());var i=t.slice(0);return this.cs._setupPosBeforeTrans(i),this.projection.project(i,e),e[2]=e[2]?e[2]*this.geoide.getHeightScale():0,e},r.prototype.getLocalTransform=function(t,e){return e||(e=mat4.create()),mat4.identity(e),e},r.prototype.getLHVTransform=function(t,e){e||(e=mat4.create());var i=this.projection.project(t);return mat4.identity(e),e[12]=i[0],e[13]=i[1],e[14]=i[2]?i[2]*this.geoide.getHeightScale():0,e[15]=1,e},r}),r("Crs/CoordinateSystemFactory",["../Utils/Constants","./WGS84Crs","./Mars2000Crs","./EquatorialCrs","./GalacticCrs","./ProjectedCrs"],function(t,e,i,r,n,o){return{create:function(s){var a;if(!s||!s.geoideName)throw new ReferenceError("geoideName not defined in "+JSON.stringify(s),"CoordinateSystemFactory.js");switch(s.geoideName){case t.CRS.Equatorial:a=new r(s);break;case t.CRS.Galactic:a=new n(s);break;case t.CRS.WGS84:a=new e(s);break;case t.CRS.Mars_2000_old:case t.CRS.Mars_2000:a=new i(s);break;default:throw new RangeError("Datum "+s.geoideName+" not implemented","CoordinateSystemFactory.js")}return s&&s.projectionName&&(a=new o(a,s)),a}}}),r("Layer/CoordinateGridLayer",["./AbstractLayer","../Utils/Utils","../Renderer/Ray","../Renderer/Program","../Tiling/Mesh","../Crs/AstroCoordTransform","../Renderer/FeatureStyle","../Utils/Constants","../Crs/CoordinateSystemFactory"],function(t,e,i,r,n,o,s,a,l){var h=function(t){var e=t,i=[],r=function(t){var i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i},n=function(t){var r=i.pop();return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),r};this.createGLTexture=function(t){return i.length>0?n(t):r(t)},this.disposeGLTexture=function(t){i.push(t)},this.disposeAll=function(){for(var t=0;t<i.length;t++)e.deleteTexture(i[t]);i.length=0}},u=function(e){t.prototype.constructor.call(this,a.LAYER.CoordinateGrid,e),this.globe=null,this.labels={},this.texturePool=null,this.longitudeSample=e.longitudeSample||15,this.latitudeSample=e.latitudeSample||10,this.canvas2d=document.createElement("canvas"),this.canvas2d.width=100,this.canvas2d.height=20,this.vertexBuffer=null,this.indexBuffer=null,this.gridCrs=l.create(e.coordinateSystem),this.longFormat=e.longFormat?e.longFormat:"Deg",this.latFormat=e.latFormat?e.latFormat:"Deg",this.geoBound={},this.tesselation=e.tesselation||2};return e.inherits(t,u),u.prototype.generateImageData=function(t){var e=this.canvas2d.getContext("2d");e.clearRect(0,0,this.canvas2d.width,this.canvas2d.height),e.fillStyle=s.fromColorToString(this.color),e.font="18px sans-serif",e.textBaseline="top",e.textAlign="center";var i=this.canvas2d.width/2;return e.fillText(t,i,0),e.getImageData(0,0,this.canvas2d.width,this.canvas2d.height)},u.prototype._attach=function(e){if(t.prototype._attach.call(this,e),this.isVisible()&&this.globe.tileManager.addPostRenderer(this),!this.gridProgram){var i="attribute vec3 vertex;\n";i+="uniform mat4 viewProjectionMatrix;\n",i+="void main(void) \n",i+="{\n",i+="gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n",i+="}\n";var o="precision highp float; \n";o+="uniform float alpha; \n",o+="uniform vec3 color; \n",o+="void main(void)\n",o+="{\n",o+="gl_FragColor = vec4(color,alpha);\n",o+="}\n";var s="attribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \n";s+="uniform mat4 viewProjectionMatrix; \n",s+="uniform vec3 poiPosition; // world position \n",s+="uniform vec2 poiScale; // x,y scale \n",s+="\n",s+="varying vec2 texCoord; \n",s+="\n",s+="void main(void)  \n",s+="{ \n",s+="// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n",s+="texCoord = vertex.xy + vec2(0.5); \n",s+="// Invert y \n",s+="texCoord.y = 1.0 - texCoord.y; \n",s+="\n",s+="// Compute poi position in clip coordinate \n",s+="gl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n",s+="gl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n",s+="} \n";var a="#ifdef GL_ES \n";a+="precision highp float; \n",a+="#endif \n",a+="\n",a+="varying vec2 texCoord; \n",a+="uniform sampler2D texture; \n",a+="uniform float alpha; \n",a+="\n",a+="void main(void) \n",a+="{ \n",a+="\tvec4 textureColor = texture2D(texture, texCoord); \n",a+="\tgl_FragColor = vec4(textureColor.rgb, textureColor.a * alpha); \n",a+="} \n",this.gridProgram=new r(this.globe.renderContext),this.labelProgram=new r(this.globe.renderContext),this.gridProgram.createFromSource(i,o),this.labelProgram.createFromSource(s,a)}this.labelMesh=new n(this.globe.renderContext);var l=[-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0],u=[0,3,1,1,3,2];this.labelMesh.setVertices(l),this.labelMesh.setIndices(u);var c=this.globe.renderContext.gl;this.vertexBuffer=c.createBuffer(),this.indexBuffer=c.createBuffer(),this.texturePool||(this.texturePool=new h(c))},u.prototype._detach=function(){var e=this.globe.renderContext.gl;e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),this.texturePool.disposeAll();for(var i in this.labels)delete this.labels[i];this.globe.tileManager.removePostRenderer(this),t.prototype._detach.call(this)},u.prototype.clampGeoBound=function(t){return t.west=Math.floor(t.west/this.longitudeSample)*this.longitudeSample,t.east=Math.ceil(t.east/this.longitudeSample)*this.longitudeSample,t.north=Math.ceil(t.north/this.latitudeSample)*this.latitudeSample,t.south=Math.floor(t.south/this.latitudeSample)*this.latitudeSample,t},u.prototype.render=function(t){var e=this.globe.renderContext,i=e.gl;i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA);var r,n=this;r=this.globe.getViewportGeoBound(function(t){return n.globe.getCoordinateSystem().convert(t,a.CRS.Equatorial,n.gridCrs.getGeoideName())}),r=this.clampGeoBound(r),this.geoBound.west!==r.west||this.geoBound.east!==r.east||this.geoBound.north!==r.north||this.geoBound.south!==r.south?(this.geoBound=r,this.computeSamples(),this.generateGridBuffers(),this.generateLabels()):this.updateLabels(),this.gridProgram.apply(),mat4.multiply(e.projectionMatrix,e.viewMatrix,e.modelViewMatrix),i.uniformMatrix4fv(this.gridProgram.uniforms.viewProjectionMatrix,!1,e.modelViewMatrix),i.uniform1f(this.gridProgram.uniforms.alpha,this.opacity),i.uniform3f(this.gridProgram.uniforms.color,this.color[0],this.color[1],this.color[2]),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.vertexAttribPointer(this.gridProgram.attributes.vertex,this.vertexBuffer.itemSize,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i.drawElements(i.LINES,this.indexBuffer.numItems,i.UNSIGNED_SHORT,0),this.labelProgram.apply(),mat4.multiply(e.projectionMatrix,e.viewMatrix,e.modelViewMatrix),i.uniformMatrix4fv(this.labelProgram.uniforms.viewProjectionMatrix,!1,e.modelViewMatrix),i.uniform1i(this.labelProgram.uniforms.texture,0);var o=e.computePixelSizeVector();for(var s in this.labels){var l=this.labels[s];i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,l.texture);var h=[2*l.textureWidth/e.canvas.width,2*l.textureHeight/e.canvas.height];i.uniform2fv(this.labelProgram.uniforms.poiScale,h);var u=l.pos3d,c=l.vertical;h=l.textureHeight*(o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]);var d=c[0]*h+u[0],p=c[1]*h+u[1],f=c[2]*h+u[2];i.uniform3f(this.labelProgram.uniforms.poiPosition,d,p,f),i.uniform1f(this.labelProgram.uniforms.alpha,1),this.labelMesh.render(this.labelProgram.attributes),l.needed=!1}i.enable(i.DEPTH_TEST),i.disable(i.BLEND)},u.prototype.setVisible=function(e){t.prototype.setVisible.call(this,e),"boolean"==typeof e&&(this.isVisible()?this.globe.tileManager.addPostRenderer(this):this.globe.tileManager.removePostRenderer(this))},u.prototype.computeSamples=function(){var t=this.geoBound.east-this.geoBound.west;for(this.geoBound.north-this.geoBound.south;t/this.longitudeSample<3&&this.longitudeSample>1;)this.longitudeSample/=2,this.latitudeSample/=2;for(;t/this.longitudeSample>7&&this.longitudeSample<15;)this.longitudeSample*=2,this.latitudeSample*=2},u.prototype.generateGridBuffers=function(){var t,e,i,r,n;this.geoBound.east-this.geoBound.west>180?(t=0,e=360):(t=this.geoBound.west,e=this.geoBound.east);var o=[],s=180/this.latitudeSample;for(i=0;i<=s;i++){var l=i*Math.PI/s,h=Math.sin(l),u=Math.cos(l);for(r=t;r<=e;r+=this.longitudeSample){var c=this.longitudeSample/this.tesselation;for(n=0;n<this.tesselation;n++){var d=(r+n*c)*Math.PI/180,p=Math.sin(d),f=Math.cos(d),g=f*h*this.globe.getCoordinateSystem().getGeoide().getRadius(),m=p*h*this.globe.getCoordinateSystem().getGeoide().getRadius(),v=u*this.globe.getCoordinateSystem().getGeoide().getRadius();if(this.gridCrs.getGeoideName()!==a.CRS.Equatorial){var y=this.globe.getCoordinateSystem().from3DToGeo([g,m,v]);y=this.globe.getCoordinateSystem().convert(y,this.gridCrs.getGeoideName(),a.CRS.Equatorial);var b=this.globe.getCoordinateSystem().fromGeoTo3D(y);o.push(b[0],b[1],b[2])}else o.push(g,m,v)}}}var x=this.globe.renderContext.gl;x.bindBuffer(x.ARRAY_BUFFER,this.vertexBuffer),x.bufferData(x.ARRAY_BUFFER,new Float32Array(o),x.STATIC_DRAW),this.vertexBuffer.itemSize=3,this.vertexBuffer.numItems=o.length/3;var C=[],_=(e-t)/this.longitudeSample+1;for(_*=this.tesselation,i=0;i<s;i++)for(r=t,longNumber=0;r<e;r+=this.longitudeSample,longNumber+=this.tesselation){var w=i*_+longNumber%(_-1),T=w+_;for(n=0;n<this.tesselation;n++)C.push(w+n),C.push(w+n+1);C.push(w+this.tesselation),C.push(T+this.tesselation),C.push(T),C.push(w)}x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,this.indexBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,new Uint16Array(C),x.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=C.length},u.prototype.buildAngle=function(t,e){var i;switch(t){case"Deg":i=e+"°";break;case"HMS":i=this.globe.getCoordinateSystem().fromDegreesToHMS(e);break;case"DMS":i=this.globe.getCoordinateSystem().fromDegreesToDMS(e);break;default:return console.error(t+" : format not supported"),null}return i},u.prototype.computeGeoCenter=function(){var t=i.createFromPixel(this.globe.getRenderContext(),this.globe.getRenderContext().canvas.width/2,this.globe.getRenderContext().canvas.height/2),e=t.computePoint(t.sphereIntersect([0,0,0],this.globe.getCoordinateSystem().getGeoide().getRadius())),r=[];return this.globe.getCoordinateSystem().from3DToGeo(e,r),r=this.globe.getCoordinateSystem().convert(r,a.CRS.Equatorial,this.gridCrs.getGeoideName())},u.prototype.updateLabel=function(t,e){e=this.globe.getCoordinateSystem().convert(e,this.gridCrs.getGeoideName(),a.CRS.Equatorial);var i=this.globe.getCoordinateSystem().fromGeoTo3D(e),r=vec3.create();vec3.normalize(i,r),this.labels[t].pos3d=i,this.labels[t].vertical=r,this.labels[t].needed=!0},u.prototype.updateLabels=function(){var t=this.computeGeoCenter();for(var e in this.labels){var i;"lat"===this.labels[e].type?i=[this.labels[e].angle,t[1]]:"long"===this.labels[e].type&&(i=[t[0],this.labels[e].angle]),this.updateLabel(e,i)}},u.prototype.generateLabels=function(){var t,e,i,r,n,o,s,a;this.geoBound.east-this.geoBound.west>180?(e=0,t=360):(e=this.geoBound.west,t=this.geoBound.east);var l,h=this.computeGeoCenter();for(r=e;r<t;r+=this.longitudeSample)s=r<0?r+360:r,l=this.buildAngle(this.longFormat,s),this.labels["lat_"+l]||(this.labels["lat_"+l]={angle:r,type:"lat"},i=this.generateImageData(l),this._buildTextureFromImage(this.labels["lat_"+l],i)),o=[r,h[1]],this.updateLabel("lat_"+l,o);for(thetaStart=Math.min(this.geoBound.north,this.geoBound.south),thetaStop=Math.max(this.geoBound.north,this.geoBound.south),a=thetaStart;a<=thetaStop;a+=this.latitudeSample)l=this.buildAngle(this.latFormat,a),this.labels["long_"+l]||(this.labels["long_"+l]={angle:a,type:"long"},i=this.generateImageData(l),this._buildTextureFromImage(this.labels["long_"+l],i)),o=[h[0],a],this.updateLabel("long_"+l,o);for(n in this.labels)this.labels[n].needed||(this.texturePool.disposeGLTexture(this.labels[n].texture),delete this.labels[n])},u.prototype._buildTextureFromImage=function(t,e){t.texture=this.texturePool.createGLTexture(e),t.textureWidth=e.width,t.textureHeight=e.height},u}),r("Tiling/HEALPixTiling",["./Tile","./HEALPixBase","../Renderer/GeoBound","../Utils/Numeric","../Utils/Constants"],function(t,e,i,r,n){var o=function(e,i,r){t.prototype.constructor.call(this),this.order=e,this.nside=Math.pow(2,this.order),
this.pixelIndex=i,this.face=r,this.geoBound=null};o.prototype=new t,o.prototype.createChildren=function(){var t=new o(this.order+1,4*this.pixelIndex,this.face),e=new o(this.order+1,4*this.pixelIndex+2,this.face),i=new o(this.order+1,4*this.pixelIndex+1,this.face),r=new o(this.order+1,4*this.pixelIndex+3,this.face);t.initFromParent(this,0,0),e.initFromParent(this,1,0),i.initFromParent(this,0,1),r.initFromParent(this,1,1),this.children=[t,e,i,r]},o.prototype.computeLocalMatrix=function(t){for(var e=mat4.create(),i=vec3.create(),r=vec3.create(),n=vec3.create(),o=0,s=0,a=0,l=0;l<t.length;l++)o+=t[l][0],s+=t[l][1],a+=t[l][2];var h=vec3.create([o/t.length,s/t.length,a/t.length]);return vec3.set(h,n),vec3.normalize(n),vec3.subtract(t[0],t[3],r),vec3.cross(n,r,i),vec3.normalize(i),vec3.cross(n,i,r),vec3.normalize(r),e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=0,e[4]=r[0],e[5]=r[1],e[6]=r[2],e[7]=0,e[8]=n[0],e[9]=n[1],e[10]=n[2],e[11]=0,e[12]=h[0],e[13]=h[1],e[14]=h[2],e[15]=1,e},o.prototype.generateVertices=function(){for(var t=this.config.tesselation,r=[],o=1/(t-1),s=this.pixelIndex&this.nside*this.nside-1,a=e.compress_bits(s),l=e.compress_bits(s>>>1),h=this.config.coordinateSystem,u=0;u<t;u++)for(var c=0;c<t;c++){var d=e.fxyf((a+u*o)/this.nside,(l+c*o)/this.nside,this.face);if(d[0]*=h.getGeoide().getRadius(),d[1]*=h.getGeoide().getRadius(),d[2]*=h.getGeoide().getRadius(),h.getGeoideName()!==n.CRS.Equatorial){var p=h.getWorldFrom3D(d),f=h.convert(p,h.getGeoideName(),n.CRS.Equatorial);r[u*t+c]=h.get3DFromWorld(f)}else r[u*t+c]=d}this.geoBound=new i;var g=[];g.push(h.getWorldFrom3D(r[0])),g.push(h.getWorldFrom3D(r[t-1])),g.push(h.getWorldFrom3D(r[t*(t-1)])),g.push(h.getWorldFrom3D(r[t*t-1])),this.geoBound.computeFromCoordinates(g),this.matrix=this.computeLocalMatrix(r);var m=mat4.create();mat4.inverse(this.matrix,m),this.inverseMatrix=m;for(var v=new Float32Array(3*t*t),y=0,b=0;b<r.length;b++)v[y]=m[0]*r[b][0]+m[4]*r[b][1]+m[8]*r[b][2]+m[12],v[y+1]=m[1]*r[b][0]+m[5]*r[b][1]+m[9]*r[b][2]+m[13],v[y+2]=m[2]*r[b][0]+m[6]*r[b][1]+m[10]*r[b][2]+m[14],y+=3;return v};var s=function(t,e){this.order=t,this.nside=Math.pow(2,this.order),this.coordinateSystem=e.coordinateSystem};s.prototype.generateLevelZeroTiles=function(t,e){t.skirt=!1,t.cullSign=-1,t.tesselation=5,t.coordinateSystem=this.coordinateSystem,this.coordinateSystem=t.coordinateSystem;for(var i=[],r=Math.pow(this.nside,2),n=12,s=n*r,a=0;a<s;a++){var l=Math.floor(a/r),h=new o(this.order,a,l);h.config=t,i.push(h)}return i};var a=function(t){var e,i;switch(t.type){case n.GEOMETRY.Point:e=[],e.push(t.coordinates);break;case n.GEOMETRY.MultiPoint:case n.GEOMETRY.LineString:e=t.coordinates;break;case n.GEOMETRY.MultiLineString:for(e=[],i=0;i<t.coordinates.length;i++)e=e.concat(t.coordinates[i]);break;case n.GEOMETRY.Polygon:e=t.coordinates[0];break;case n.GEOMETRY.MultiPolygon:for(e=[],i=0;i<t.coordinates.length;i++)e=e.concat(t.coordinates[i][0]);break;case n.GEOMETRY.GeometryCollection:for(e=[],i=0;i<t.geometries.length;i++)e=e.concat(a(t.geometries[i]))}return e};return s.prototype.getOverlappedLevelZeroTiles=function(t){var e=[],i=a(t);if(!i)return console.log("Invalid geometry type or not supported."),e;for(var r={},n=0;n<i.length;n++){var o=this.lonlat2LevelZeroIndex(i[n][0],i[n][1]);r[o]||(r[o]=!0,e.push(o))}return e},s.prototype.lonlat2LevelZeroIndex=function(t,i){return e.lonLat2pix(this.order,t,i)},s.prototype.findInsideTile=function(t,i,r){for(var n=0;n<r.length;n++){var o=r[n],s=e.lonLat2pix(o.order,t,i);if(s===o.pixelIndex)return o}return null},s}),r("Layer/HipsMetadata",["jquery","../Utils/Constants"],function(t,e){function i(t){var e,i,r,n,o,s,a=[],l=[];for(var h in p){if(e=p[h],i=e[0],r=e[1],n=e[3],o=e[4],s=e[5],"R"!==i||t.hasOwnProperty(h)||("creator_did"===h&&"1.2"===t.hips_version?t.creator_did=t.publisher_did:a.push(h+" ("+r+") is not present. ")),s&&t.hasOwnProperty(h)&&(t[h]=t[h].split(/\s+/)),null!==o&&t.hasOwnProperty(h))if(s)for(var u in t[h]){var c=t[h][u];if(!o.hasOwnProperty(c)){l.push('The value "'+t[h]+'" of '+h+" ("+r+") is not correct. ");break}}else o.hasOwnProperty(t[h])||l.push('The value "'+t[h]+'" of '+h+" ("+r+") is not correct. ");null===n||t.hasOwnProperty(h)||(t[h]=n)}if(a.length>0||l.length>0)throw"unvalid hips metadata : \n"+a.toString()+"\n"+l.toString()}function r(e){var r=t.ajax({type:"GET",url:e+"/properties",async:!1}).responseText;if(void 0===r)throw"Unable to load the Hips at "+e;var o=n(r);return i(o),o}function n(e){var i={},r=e.split(/\r?\n/),n="";return t.each(r,function(t,e){if(!/^\s*(\#|\!|$)/.test(e))if(e=e.replace(/^\s*/,""),n+=e,/(\\\\)*\\$/.test(n))n=n.replace(/\\$/,"");else{/^\s*((?:[^\s:=\\]|\\.)+)\s*[:=\s]\s*(.*)$/.test(n);var r=RegExp.$1,o=RegExp.$2;i.hasOwnProperty(r)?i[r]=i[r].isPrototypeOf(Array)?i[r].push(o):[i[r],o]:i[r]=o,n=""}}),i}var o={Radio:"Radio",Millimeter:"Millimeter",Infrared:"Infrared",Optical:"Optical",UV:"UV",EUV:"EUV","X-ray":"X-ray","Gamma-ray":"Gamma-ray"},s={equatorial:e.CRS.Equatorial,galactic:e.CRS.Galactic,ecliptic:"ecliptic"},a={jpeg:"jpeg",png:"png",fits:"fits",tsv:"tsv"},l={none:"non",nearest:"nearest",bilinear:"bilinear"},h={add:"add",mean:"mean",first:"first",border_fading:"border_fading",custom:"custom"},u={none:"none",hips_estimation:"hips_estimation",fits_keyword:"fits_keyword"},c={image:"image",cube:"cube",catalog:"catalog",meta:"meta"},d={color:"color",live:"live"},p={creator_did:["R","Unique ID of the HiPS - Format: IVOID - Ex : ivo://CDS/P/2MASS/J",!1,null,null,!1],publisher_id:[null,"Unique ID of the HiPS publisher – Format: IVOID - Ex : ivo://CDS",!1,null,null,!1],obs_collection:[null,"Short name of original data set – Format: one word – Ex : 2MASS",!1,null,null,!1],obs_title:["R","Data set title – Format: free text, one line – Ex : HST F110W observations",!1,null,null,!1],obs_description:["S","Data set description – Format: free text, longer free text description of the dataset",!1,null,null,!1],obs_ack:[null,"Acknowledgment mention",!1,null,null,!1],prov_progenitor:["S","Provenance of the original data – Format: free text",!0,null,null,!1],bib_reference:[null,"Bibliographic reference",!0,null,null,!1],bib_reference_url:[null,"URL to bibliographic reference",!0,null,null,!1],obs_copyright:[null,"Copyright mention – Format: free text",!1,null,null,!1],obs_copyright_url:[null,"URL to a copyright mention",!1,null,null,!1],obs_regime:["S","General wavelength – Format: word",!0,null,o,!1],data_ucd:[null,"UCD describing data contents",!0,null,null,!1],hips_version:["R","Number of HiPS version – Format: number",!1,"1.4",null,!1],hips_builder:[null,"Name and version of the tool used for building the HiPS – Format: free text",!1,null,null,!1],hips_publisher:[null,"Institute or person who built the HiPS – Format: free text – Ex : CDS (T.Boch)",!1,null,null,!1],hips_creation_date:["S","HiPS first creation date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ",!1,null,null,!1],hips_release_date:["R","Last HiPS update date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ",!1,null,null,!1],hips_service_url:[null,"HiPS access url – Format: URL",!1,null,null,!1],hips_status:["R","HiPS status",!1,"public master clonableOnce",null,!0],hips_estsize:[null,"HiPS size estimation – Format: positive integer – Unit : KB",!1,null,null,!1],hips_frame:["R","Coordinate frame reference",!1,null,s,!1],hips_order:["R","Deepest HiPS order – Format: positive integer",!1,null,null,!1],hips_tile_width:[null,"Tiles width in pixels – Format: positive integer",!1,512,null,!1],hips_tile_format:["R","List of available tile formats. The first one is the default suggested to the client",!1,null,a,!0],hips_pixel_cut:[null,"Suggested pixel display cut range (physical values) – Format: min max",null,null,null,!0],hips_data_range:[null,"Pixel data range taken into account during the HiPS generation (physical values) – Format: min max – Ex : -18.5 510.5",!1,null,null,!0],hips_sampling:[null,"Sampling applied for the HiPS generation",!1,null,l,!1],hips_overlay:[null,"Pixel composition method applied on the image overlay region during HiPS generation",!1,null,h,!1],hips_skyval:[null,"Sky background subtraction method applied during HiPS generation",!1,null,u,!1],hips_pixel_bitpix:[null,"Fits tile BITPIX code",!1,null,null,!1],data_pixel_bitpix:[null,"Original data BITPIX code",!1,null,null],dataproduct_type:["R","Type of data",!1,null,c,!1],dataproduct_subtype:["RD","Subtype of data",!1,null,d,!1],hips_progenitor_url:[null,"URL to an associated progenitor HiPS",!1,null,null,!1],hips_cat_nrows:["S","Number of rows of the HiPS catalog",!1,null,null,!1],hips_cube_depth:["RD","Number of frames of the HiPS cube",!1,null,null,!1],hips_cube_firstframe:[null,"Initial first index frame to display for a HiPS cube",!1,0,null,!1],data_cube_crpix3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_crval3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_cdelt3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_bunit3:[null,"Third axis unit (see FITS doc)",!1,null,null,!1],hips_initial_ra:["S","Default RA display position (ICRS frame) – Unit : degrees",!1,null,null,!1],hips_initial_dec:["S","Default DEC display position (ICRS frame) – Unit : degrees",!1,null,null,!1],hips_initial_fov:["S","Default display size – Unit : degrees",!1,null,null,!1],hips_pixel_scale:[null,"HiPS pixel angular resolution at the highest order – Unit : degrees",!1,null,null,!1],s_pixel_scale:[null,"Best pixel angular resolution of the original images – Unit : degrees",!1,null,null,!1],t_min:["S","Start time of the observations - Representation: MJD",!1,null,null,!1],t_max:["S","Stop time of the observations - Representation: MJD",!1,null,null,!1],em_min:["S","Start in spectral coordinates – Unit: meters",!1,null,null,!1],em_max:["S","Stop in spectral coordinates – Unit: meters",!1,null,null,!1],client_category:[null,"/ separated keywords suggesting a display hierarchy to the client – Ex : Image/InfraRed",!1,null,null,!1],client_sort_key:[null,"Sort key suggesting a display order to the client inside a client_category – Sort : alphanumeric",!1,null,null,!1],addendum_did:[null,"In case of “live” HiPS, creator_did of the added HiPS",!0,null,null,!1],moc_sky_fraction:[null,"Fraction of the sky covers by the MOC associated to the HiPS – Format: real between 0 and 1",!1,null,null,!1]},f=function(t){"string"==typeof t?(this.baseUrl=t,this.hipsMetadata=r(t)):this.hipsMetadata=t};return f.prototype.GeneralWavelength=o,f.prototype.HipsFrame=s,f.prototype.HipsTileFormat=a,f.prototype.Sampling=l,f.prototype.PixelOverlay=h,f.prototype.SkyVal=u,f.prototype.DataProductType=c,f.prototype.SubTypeData=d,f.prototype.getHipsMetadata=function(){return this.hipsMetadata},f.prototype.getBaseUrl=function(){return this.baseUrl},f}),r("Layer/AbstractHipsLayer",["./AbstractRasterLayer","../Utils/Utils","../Utils/Constants","../Tiling/HEALPixTiling","../Crs/CoordinateSystemFactory","./HipsMetadata"],function(t,e,i,r,n,o){var s=function(e,s){if(!s)throw"Some required parameters are missing";var a=e;if(void 0===a){var l=new o(s.baseUrl);a=l.getHipsMetadata()}this.hipsMetadata=a,s.coordinateSystem=s.hasOwnProperty("coordinateSystem")?n.create(s.coordinateSystem):n.create({geoideName:i.MappingCrsHips2Mizar[this.hipsMetadata.hips_frame]}),s.tilePixelSize=s.hasOwnProperty("tilePixelSize")?s.tilePixelSize:this.hipsMetadata.hips_tile_width,s.baseLevel=s.hasOwnProperty("baseLevel")?s.baseLevel:e.hasOwnProperty("hips_order_min")?e.hips_order_min:2,s.tiling=new r(s.baseLevel||2,{coordinateSystem:s.coordinateSystem}),s.numberOfLevels=s.hasOwnProperty("numberOfLevels")?s.numberOfLevels:this.hipsMetadata.hips_order,s.name=s.hasOwnProperty("name")?s.name:this.hipsMetadata.obs_title,s.attribution=s.hasOwnProperty("attribution")?s.attribution:'<a href="'+this.hipsMetadata.obs_copyright_url+'" target="_blank">'+this.hipsMetadata.obs_copyright+"</a>",s.copyrightUrl=s.hasOwnProperty("copyrightUrl")?s.copyrightUrl:this.hipsMetadata.obs_copyright_url,s.ack=s.hasOwnProperty("ack")?s.ack:this.hipsMetadata.obs_ack,s.icon=s.hasOwnProperty("icon")?s.icon:s.mizarBaseUrl?s.mizarBaseUrl+"css/images/star.png":"",s.description=s.hasOwnProperty("description")?s.description:this.hipsMetadata.obs_description,s.visible=!!s.hasOwnProperty("visible")&&s.visible,s.properties=s.hasOwnProperty("properties")?s.properties:{},s.pickable=!!s.hasOwnProperty("pickable")&&s.pickable,s.services=s.hasOwnProperty("services")?s.services:[],s.format=s.hasOwnProperty("format")?s.format:this.hipsMetadata.hips_tile_format,s.baseUrl=s.hasOwnProperty("baseUrl")?s.baseUrl:this.hipsMetadata.hips_service_url,s.properties={initialRa:this.hipsMetadata.hasOwnProperty("obs_initial_ra")?parseFloat(this.hipsMetadata.obs_initial_ra):void 0,initialDec:this.hipsMetadata.hasOwnProperty("obs_initial_dec")?parseFloat(this.hipsMetadata.obs_initial_dec):void 0,initialFov:this.hipsMetadata.hasOwnProperty("obs_initial_fov")?parseFloat(this.hipsMetadata.obs_initial_fov):void 0,mocCoverage:this.hipsMetadata.hasOwnProperty("moc_sky_fraction")?this.hipsMetadata.moc_sky_fraction:void 0},s.category="Image",s.availableServices={},a.hasOwnProperty("moc_access_url")&&(s.availableServices.Moc={serviceURL:a.moc_access_url,skyFraction:a.moc_sky_fraction}),s.coordinateSystem.getGeoideName()===i.CRS.Galactic&&(s.background=!0),t.prototype.constructor.call(this,i.LAYER.Hips,s),this._overlay=!s.background};return e.inherits(t,s),s.prototype.getHipsMetadata=function(){return this.hipsMetadata},s}),r("Renderer/ColorMap",["../Utils/Numeric"],function(t){function e(t,e,i,r,n,o){var s;if(r===t.UNSIGNED_BYTE)s=new Uint8Array(e);else{if(r!==t.FLOAT)return null;s=new Float32Array(e)}var a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,i,n,o,0,i,r,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),a}var i={linear:[],asin:[],sqrt:[],sqr:[],log:[]},r=function(){for(var t in i){for(var e,r=Number.MAX_VALUE,n=Number.MIN_VALUE,o=[],s=0;s<256;s++){switch(e=s,t){case"linear":o[s]=e;break;case"asin":o[s]=Math.log(e+Math.sqrt(Math.pow(e,2)+1));break;case"log":o[s]=Math.log(e/10+1);break;case"sqrt":o[s]=Math.sqrt(e/10);break;case"sqr":o[s]=e*e}o[s]<r&&(r=o[s]),o[s]>n&&(n=o[s])}for(s=0;s<256;s++)e=256*((o[s]-r)/(n-r)),e>256?e=256:e<0&&(e=0),i[t][s]=Math.floor(e)}};r();var n={fire:{red:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,7,10,13,16,19,22,25,28,31,34,37,40,43,46,49,52,55,58,61,64,67,70,73,76,79,82,85,88,91,94,98,101,104,107,110,113,116,119,122,125,128,131,134,137,140,143,146,148,150,152,154,156,158,160,162,163,164,166,167,168,170,171,173,174,175,177,178,179,181,182,184,185,186,188,189,190,192,193,195,196,198,199,201,202,204,205,207,208,209,210,212,213,214,215,217,218,220,221,223,224,226,227,229,230,231,233,234,235,237,238,240,241,243,244,246,247,249,250,252,252,252,253,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,8,10,12,14,16,19,21,24,27,29,32,35,37,40,43,46,48,51,54,57,59,62,65,68,70,73,76,79,81,84,87,90,92,95,98,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,134,136,138,140,141,143,145,147,148,150,152,154,155,157,159,161,162,164,166,168,169,171,173,175,176,178,180,182,184,186,188,190,191,193,195,197,199,201,203,205,206,208,210,212,213,215,217,219,220,222,224,226,228,230,232,234,235,237,239,241,242,244,246,248,248,249,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],blue:[0,7,15,22,30,38,45,53,61,65,69,74,78,82,87,91,96,100,104,108,113,117,121,125,130,134,138,143,147,151,156,160,165,168,171,175,178,181,185,188,192,195,199,202,206,209,213,216,220,220,221,222,223,224,225,226,227,224,222,220,218,216,214,212,210,206,202,199,195,191,188,184,181,177,173,169,166,162,158,154,151,147,143,140,136,132,129,125,122,118,114,111,107,103,100,96,93,89,85,82,78,74,71,67,64,60,56,53,49,45,42,38,35,31,27,23,20,16,12,8,5,4,3,3,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,13,17,21,26,30,35,42,50,58,66,74,82,90,98,105,113,121,129,136,144,152,160,167,175,183,191,199,207,215,223,227,231,235,239,243,247,251,255,255,255,255,255,255,255,255]},eosb:{red:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,18,27,36,45,49,57,72,81,91,100,109,118,127,136,131,139,163,173,182,191,200,209,218,227,213,221,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,253,251,249,247,245,243,241,215,214,235,234,232,230,228,226,224,222,198,196,216,215,213,211,209,207,205,203,181,179,197,196,194,192,190,188,186,184,164,162,178,176,175,173,171,169,167,165,147,145,159,157,156,154,152,150,148,146,130,128,140,138,137,135,133,131,129,127,113,111,121,119,117,117],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,15,23,31,39,47,55,57,64,79,87,95,103,111,119,127,135,129,136,159,167,175,183,191,199,207,215,200,207,239,247,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,250,246,242,238,233,229,225,198,195,212,208,204,199,195,191,187,182,160,156,169,165,161,157,153,148,144,140,122,118,127,125,123,121,119,116,114,112,99,97,106,104,102,99,97,95,93,91,80,78,84,82,80,78,76,74,72,70,61,59,63,61,59,57,55,53,50,48,42,40,42,40,38,36,33,31,29,27,22,21,21,19,16,14,12,13,8,6,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],blue:[116,121,127,131,136,140,144,148,153,157,145,149,170,174,178,182,187,191,195,199,183,187,212,216,221,225,229,233,238,242,221,225,255,247,239,231,223,215,207,199,172,164,175,167,159,151,143,135,127,119,100,93,95,87,79,71,63,55,47,39,28,21,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},stern:{red:[0,18,36,54,72,90,108,127,145,163,199,217,235,254,249,244,239,234,229,223,218,213,208,203,197,192,187,182,177,172,161,156,151,146,140,135,130,125,120,115,109,104,99,94,89,83,78,73,68,63,52,47,42,37,32,26,21,16,11,6,64,65,66,67,68,69,70,71,72,73,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,117,118,119,120,121,122,123,124,125,126,128,129,130,131,132,133,134,135,136,137,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,181,182,183,184,185,186,187,188,189,190,192,193,194,195,196,197,198,199,200,201,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,245,246,247,248,249,250,251,252,253,254],green:[0,1,2,3,4,5,6,7,8,9,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,53,54,55,56,57,58,59,60,61,62,64,65,66,67,68,69,70,71,72,73,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,117,118,119,120,121,122,123,124,125,126,128,129,130,131,132,133,134,135,136,137,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,181,182,183,184,185,186,187,188,189,190,192,193,194,195,196,197,198,199,200,201,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,245,246,247,248,249,250,251,252,253,254],blue:[0,1,3,5,7,9,11,13,15,17,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,105,107,109,111,113,115,117,119,121,123,127,129,131,133,135,137,139,141,143,145,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,233,235,237,239,241,243,245,247,249,251,255,251,247,243,238,234,230,226,221,217,209,204,200,196,192,187,183,179,175,170,166,162,158,153,149,145,141,136,132,128,119,115,111,107,102,98,94,90,85,81,77,73,68,64,60,56,51,47,43,39,30,26,22,17,13,9,5,0,3,7,15,19,22,26,30,34,38,41,45,49,57,60,64,68,72,76,79,83,87,91,95,98,102,106,110,114,117,121,125,129,137,140,144,148,152,156,159,163,167,171,175,178,182,186,190,194,197,201,205,209,216,220,224,228,232,235,239,243,247,251]},rainbow:{red:[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0],blue:[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},grey:{red:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255],green:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255],blue:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]}};return{addCustomColormap:function(e,i){if(i.length<2)return console.error("Colors length must be >= 2"),null;for(var r=256,o={red:[],green:[],blue:[]},s=i.length-1,a=0;a<s;a++)for(var l=i[a],h=i[a+1],u=r/(i.length-1),c=o.red.length,d=Math.floor((a+1)*u),p=c;p<d;p++)o.red.push(t.lerp(p/d,l[0],h[0])),o.green.push(t.lerp(p/d,l[1],h[1])),o.blue.push(t.lerp(p/d,l[2],h[2]));n[e]=o},generateColormap:function(t,r,o,s){var a,l,h,u=i[r],c=[];a=n[o].red,l=n[o].green,h=n[o].blue;for(var d=a.length-1,p=0;p<256;p++){var f=u[p];f>d?f=d:f<0&&(f=0),s&&(f=d-f),c[3*p]=a[f]/256,c[3*p+1]=l[f]/256,c[3*p+2]=h[f]/256}return e(t,c,t.RGB,t.FLOAT,c.length/3,1)}}}),r("Renderer/DynamicImage",["./ColorMap"],function(t){var e="precision highp float; \n";e+="varying vec2 vTextureCoord;\n",e+="uniform sampler2D texture; \n",e+="uniform sampler2D colormap; \n",e+="uniform float min; \n",e+="uniform float max; \n",e+="uniform vec4 color; \n",e+="void main(void)\n",e+="{\n",e+="\tfloat i = texture2D(texture,vTextureCoord).r;\n",e+="\tfloat d = clamp( ( i - min ) / (max - min), 0.0, 1.0 );\n",e+="\tvec4 cmValue = texture2D(colormap, vec2(d,0.));\n",e+="\tgl_FragColor = vec4(cmValue.r,cmValue.g,cmValue.b,color.a);\n",e+="}\n";var i=function(t,e,i){i||(i=e.polygonProgram),t.uniform1f(i.uniforms.max,e.style.uniformValues.tmax),t.uniform1f(i.uniforms.min,e.style.uniformValues.tmin),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,e.style.uniformValues.colormapTex),t.uniform1i(i.uniforms.colormap,1)},r=function(t,r,n,o,s,a,l){e=l&&l.fragmentCode?l.fragmentCode:e,i=l&&l.updateUniforms?l.updateUniforms:i,this.fragmentCode=e,this.updateUniforms=i,this.tmin=0,this.tmax=1,this.colormapTex=null,this.renderContext=t,this.pixels=r,this.transferFn="raw",this.inverse=!1;var h=t.gl,u=h.createTexture();if(h.bindTexture(h.TEXTURE_2D,u),h.texImage2D(h.TEXTURE_2D,0,n,s,a,0,n,o,r),o===h.FLOAT){var c=h.getExtension("OES_texture_float_linear"),d=c?h.LINEAR:h.NEAREST;h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,d),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,d)}else h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this.texture=u,this.width=s,this.height=a,this.computeMinMax(r),t.requestFrame()};return r.prototype.computeMinMax=function(t){for(var e=Number.MIN_VALUE,i=Number.MAX_VALUE,r=1;r<t.length;r++){var n=t[r];isNaN(n)||(e<n&&(e=n),i>n&&(i=n))}this.min=i,this.max=e,this.tmax=e,this.tmin=i},r.prototype.updateColormap=function(r,n,o){var s=this.renderContext.gl;"raw"!==r?(this.fragmentCode=e,this.updateUniforms=i,this.colormapTex&&s.deleteTexture(this.colormapTex),this.colormapTex=t.generateColormap(s,r,n,o)):(this.fragmentCode=null,this.updateUniforms=null),this.transferFn=r,this.inverse=o},r.prototype.dispose=function(){var t=this.renderContext.gl;this.colormapTex&&t.deleteTexture(this.colormapTex),this.texture&&t.deleteTexture(this.texture),this.colormapTex=null,this.texture=null},r}),function(){var t,e,i,r,n,o,s,a,l,h,u,c,d,p,f,g=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},m={}.hasOwnProperty,v=function(t,e){function i(){this.constructor=t}for(var r in e)m.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},y=[].slice,b=function(t,e){return function(){return t.apply(e,arguments)}};null==this.astro&&(this.astro={}),n={},n.version="0.2.3",this.astro.FITS=n,f=["included","extended"],c=function(){function t(){}return t.include=function(t){var e,i,r;if(!t)throw"include(obj) requires obj";for(e in t)i=t[e],g.call(f,e)<0&&(this.prototype[e]=i);return null!=(r=t.included)&&r.apply(this),this},t.extend=function(t){var e,i,r;if(!t)throw"extend(obj) requires obj";for(e in t)i=t[e],g.call(f,e)<0&&(this[e]=i);return null!=(r=t.extended)&&r.apply(this),this},t.proxy=function(t){var e=this;return function(){return t.apply(e,arguments)}},t.prototype.proxy=function(t){var e=this;return function(){return t.apply(e,arguments)}},t}(),this.astro.FITS.Module=c,i=function(t){function e(t,e){this.view=t,this.begin=this.current=t.tell(),this.length=void 0}return v(e,t),e}(c),this.astro.FITS.DataUnit=i,l={verifyOrder:function(t,e){if(e!==this.cardIndex)return console.warn(""+t+" should appear at index "+this.cardIndex+" in the FITS header")},verifyBetween:function(t,e,i,r){if(!(e>=i&&e<=r))throw"The "+t+" value of "+e+" is not between "+i+" and "+r},verifyBoolean:function(t){return"T"===t},Functions:{SIMPLE:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e=arguments[0],this.primary=!0,this.verifyOrder("SIMPLE",0),
this.verifyBoolean(e)},XTENSION:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e=arguments[0],this.extension=!0,this.extensionType=e,this.verifyOrder("XTENSION",0),e},BITPIX:function(){var t,e,i;if(t=1<=arguments.length?y.call(arguments,0):[],e="BITPIX",i=parseInt(arguments[0]),this.verifyOrder(e,1),8!==i&&16!==i&&32!==i&&64!==i&&i!==-32&&i!==-64)throw""+e+" value "+i+" is not permitted";return i},NAXIS:function(){var t,e,i,r,n,o;if(t=1<=arguments.length?y.call(arguments,0):[],i="NAXIS",n=parseInt(arguments[0]),e=arguments[1],!e&&(this.verifyOrder(i,2),this.verifyBetween(i,n,0,999),this.isExtension()&&("TABLE"===(o=this.extensionType)||"BINTABLE"===o)&&(r=2,n!==r)))throw""+i+" must be "+r+" for TABLE and BINTABLE extensions";return n},PCOUNT:function(){var t,e,i,r,n,o;if(t=1<=arguments.length?y.call(arguments,0):[],e="PCOUNT",n=parseInt(arguments[0]),i=3+this.NAXIS,this.verifyOrder(e,i),this.isExtension()&&("IMAGE"===(o=this.extensionType)||"TABLE"===o)&&(r=0,n!==r))throw""+e+" must be "+r+" for the "+this.extensionType+" extensions";return n},GCOUNT:function(){var t,e,i,r,n,o;if(t=1<=arguments.length?y.call(arguments,0):[],e="GCOUNT",n=parseInt(arguments[0]),i=3+this.NAXIS+1,this.verifyOrder(e,i),this.isExtension()&&("IMAGE"===(o=this.extensionType)||"TABLE"===o||"BINTABLE"===o)&&(r=1,n!==r))throw""+e+" must be "+r+" for the "+this.extensionType+" extensions";return n},EXTEND:function(){var t,e,i;if(t=1<=arguments.length?y.call(arguments,0):[],e="EXTEND",i=arguments[0],!this.isPrimary())throw""+e+" must only appear in the primary header";return this.verifyBoolean(i)},BSCALE:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},BZERO:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},BLANK:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="BLANK",i=arguments[0],parseInt(i)},DATAMIN:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},DATAMAX:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},EXTVER:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="EXTVER",i=arguments[0],i=parseInt(i)},EXTLEVEL:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="EXTLEVEL",i=arguments[0],i=parseInt(i)},TFIELDS:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="TFIELDS",i=arguments[0],i=parseInt(i),this.verifyBetween(e,i,0,999),i},TBCOL:function(){var t,e,i,r;return t=1<=arguments.length?y.call(arguments,0):[],i="TBCOL",r=arguments[0],e=arguments[2],this.verifyBetween(i,e,0,this.TFIELDS),r},ZIMAGE:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="ZIMAGE",i=arguments[0],this.verifyBoolean(i)},ZCMPTYPE:function(){var t,e,i;if(t=1<=arguments.length?y.call(arguments,0):[],e="ZCMPTYPE",i=arguments[0],"GZIP_1"!==i&&"RICE_1"!==i&&"PLIO_1"!==i&&"HCOMPRESS_1"!==i)throw""+e+" value "+i+" is not permitted";if("RICE_1"!==i&&"GZIP_1"!==i)throw"Compress type "+i+" is not yet implement";return i},ZBITPIX:function(){var t,e,i;if(t=1<=arguments.length?y.call(arguments,0):[],e="ZBITPIX",i=parseInt(arguments[0]),8!==i&&16!==i&&32!==i&&64!==i&&i!==-32&&i!==-64)throw""+e+" value "+i+" is not permitted";return i},ZNAXIS:function(){var t,e,i,r;return t=1<=arguments.length?y.call(arguments,0):[],i="ZNAXIS",r=parseInt(arguments[0]),e=arguments[1],r=r,e||this.verifyBetween(i,r,0,999),r},ZTILE:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e="ZTILE",parseInt(arguments[0])},ZSIMPLE:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],"T"===arguments[0]},ZPCOUNT:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e="ZPCOUNT",parseInt(arguments[0])},ZGCOUNT:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e="ZGCOUNT",parseInt(arguments[0])}}},this.astro.FITS.HeaderVerify=l,a=function(t){function e(){this.init=b(this.init,this);var t,e,i;this.primary=!1,this.extension=!1,this.verifyCard={},i=this.Functions;for(e in i)t=i[e],this.verifyCard[e]=this.proxy(t);this.cards={},this.cardIndex=0}return v(e,t),e.keywordPattern=/^([A-Z0-9_-]+)\s*=\s*(.*)/,e.nonStringPattern=/([^\/]*)\s*\/*(.*)/,e.stringPattern=/'(.*)'\s*\/*(.*)/,e.arrayPattern=/([A-Za-z]+)(\d+)/,e.include(l),e.prototype.get=function(t){return this.contains(t)?this.cards[t]:console.warn("Header does not contain the key "+t)},e.prototype.getIndex=function(t){return this.contains(t)?this.cards[t][0]:console.warn("Header does not contain the key "+t)},e.prototype.getComment=function(t){return this.contains(t)?null!=this.cards[t][2]?this.cards[t][2]:console.warn(""+t+" does not contain a comment"):console.warn("Header does not contain the key "+t)},e.prototype.getComments=function(){return this.contains("COMMENT")?this.cards.COMMENT:console.warn("Header does not contain any COMMENT fields")},e.prototype.getHistory=function(){return this.contains("HISTORY")?this.cards.HISTORY:console.warn("Header does not contain any HISTORY fields")},e.prototype.set=function(t,e,i){return this.cards[t]=i?[this.cardIndex,e,i]:[this.cardIndex,e],this.cardIndex+=1},e.prototype.setComment=function(t){return this.contains("COMMENT")||(this.cards.COMMENT=[],this.cardIndex+=1),this.cards.COMMENT.push(t)},e.prototype.setHistory=function(t){return this.contains("HISTORY")||(this.cards.HISTORY=[],this.cardIndex+=1),this.cards.HISTORY.push(t)},e.prototype.contains=function(t){return this.cards.hasOwnProperty(t)},e.prototype.readCard=function(t){var i,r,n,o,s,a,l,h,u,c,d,p;if(a=t.match(e.keywordPattern),null!=a)switch(h=a.slice(1),o=h[0],l=h[1],"COMMENT"===o||"HISTORY"===o?a[1]=l.trim():"'"===l[0]?(a=l.match(e.stringPattern),a[1]=a[1].trim()):(a=l.match(e.nonStringPattern),a[1]="T"===(u=a[1][0])||"F"===u?a[1].trim():parseFloat(a[1])),a[2]=a[2].trim(),c=a.slice(1),l=c[0],r=c[1],s=o,d=[!1,void 0],i=d[0],n=d[1],a=o.match(e.arrayPattern),null!=a&&(s=a[1],p=[!0,a[2]],i=p[0],n=p[1]),this.verifyCard.hasOwnProperty(s)&&(l=this.verifyCard[s](l,i,n)),o){case"COMMENT":return this.setComment(l);case"HISTORY":return this.setHistory(l);default:return this.set(o,l,r),this.__defineGetter__(o,function(){return this.cards[o][1]})}},e.prototype.init=function(t){var e,i,r,n,o,s,a,l;for(r=80,o=t.length/r,n=600,o=o<n?o:n,l=[],e=s=0,a=o-1;0<=a?s<=a:s>=a;e=0<=a?++s:--s)i=t.slice(e*r,(e+1)*r),l.push(this.readCard(i));return l},e.prototype.hasDataUnit=function(){return 0!==this.NAXIS},e.prototype.isPrimary=function(){return this.primary},e.prototype.isExtension=function(){return this.extension},e}(c),this.astro.FITS.Header=a,u={initArray:function(t){return this.data=new t(this.width*this.height)},getExtremes:function(){var t,e,i,r,n,o;if(null!=this.min&&null!=this.max)return[this.min,this.max];for(t=this.data.length;t--;)if(r=this.data[t],!isNaN(r)){n=[r,r],i=n[0],e=n[1];break}for(;t--;)r=this.data[t],isNaN(r)||(r<i&&(i=r),r>e&&(e=r));return o=[i,e],this.min=o[0],this.max=o[1],[this.min,this.max]},getPixel:function(t,e){return this.data[e*this.width+t]}},this.astro.FITS.ImageUtils=u,h=function(t){function e(t,i){var r,n,o,s,a=this;for(e.__super__.constructor.apply(this,arguments),o=i.NAXIS,r=i.BITPIX,this.naxis=[],n=s=1;1<=o?s<=o:s>=o;n=1<=o?++s:--s)this.naxis.push(i["NAXIS"+n]);switch(this.width=i.NAXIS1,this.height=i.NAXIS2||1,this.bzero=i.BZERO||0,this.bscale=i.BSCALE||1,this.rowByteSize=this.width*Math.abs(r)/8,this.totalRowsRead=0,this.length=this.naxis.reduce(function(t,e){return t*e})*Math.abs(r)/8,this.data=void 0,this.frame=0,r){case 8:this.bscale%1===0?(this.arrayType=Uint8Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint8()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint8()});break;case 16:this.bscale%1===0?(this.arrayType=Int16Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getInt16()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getInt16()});break;case 32:this.bscale%1===0?(this.arrayType=Int32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint32()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint32()});break;case 64:this.arrayType=this.bscale%1===0?Int32Array:Float32Array,console.warn("Unusual behaviour with 64 bit integers."),this.accessor=function(){var t,e,i,r,n;return e=Math.abs(a.view.getInt32()),i=Math.abs(a.view.getInt32()),r=e%10,t=r?-1:1,e-=r,n=t*(e<<32|i),a.bzero+a.bscale*n};break;case-32:this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getFloat32()};break;case-64:this.arrayType=Float64Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getFloat64()};break;default:throw"Invalid BITPIX."}}return v(e,t),e.include(u),e.prototype.getRow=function(){var t,e,i;for(this.current=this.begin+this.totalRowsRead*this.rowByteSize,this.view.seek(this.current),t=e=0,i=this.width-1;0<=i?e<=i:e>=i;t=0<=i?++e:--e)this.data[this.width*this.rowsRead+t]=this.accessor();return this.rowsRead+=1,this.totalRowsRead+=1},e.prototype.getFrame=function(t){var e;for(this.frame=null!=t?t:this.frame,null==this.data&&this.initArray(this.arrayType),this.totalRowsRead=this.width*this.frame,this.rowsRead=0,e=this.height;e--;)this.getRow();return this.frame+=1,this.data},e.prototype.seek=function(t){return null==t&&(t=0),2===this.naxis.length?(this.totalRowsRead=0,this.frame=0):(this.totalRowsRead=this.height*t,this.frame=this.height/this.totalRowsRead-1)},e.prototype.isDataCube=function(){return this.naxis.length>2},e}(i),this.astro.FITS.Image=h,p=function(t){function e(t,i){this.getRow=b(this.getRow,this),e.__super__.constructor.apply(this,arguments),this.rowByteSize=i.NAXIS1,this.rows=i.NAXIS2,this.cols=i.TFIELDS,this.length=this.tableLength=this.rowByteSize*this.rows,this.rowsRead=0,this.columns=this.getColumnNames(i),this.accessors=[]}return v(e,t),e.dataAccessors={L:function(t){return 84===t.getInt8()},X:function(t){throw"Data type not yet implemented"},B:function(t){return t.getUint8()},I:function(t){return t.getInt16()},J:function(t){return t.getInt32()},K:function(t){var e,i,r,n,o;return i=Math.abs(t.getInt32()),r=Math.abs(t.getInt32()),n=i%10,e=n?-1:1,i-=n,o=e*(i<<32|r),console.warn("Something funky happens here when dealing with 64 bit integers.  Be wary!!!"),o},A:function(t){return t.getChar()},E:function(t){return t.getFloat32()},D:function(t){return t.getFloat64()},C:function(t){return[t.getFloat32(),t.getFloat32()]},M:function(t){return[t.getFloat64(),t.getFloat64()]}},e.prototype.getRow=function(t){var e,i,r,n,o;for(null==t&&(t=null),null!=t&&(this.rowsRead=t),this.current=this.begin+this.rowsRead*this.rowByteSize,this.view.seek(this.current),t={},o=this.accessors,i=r=0,n=o.length;r<n;i=++r)e=o[i],t[this.columns[i]]=e();return this.rowsRead+=1,t},e.prototype.getColumnNames=function(t){var e,i,r,n,o;for(e=[],i=n=1,o=this.cols;1<=o?n<=o:n>=o;i=1<=o?++n:--n){if(r="TTYPE"+i,!t.contains(r))return null;e.push(t[r])}return e},e}(i),this.astro.FITS.Tabular=p,d=function(t){function e(t,i){this.getRow=b(this.getRow,this);var r,n,o,s,a,l,h=this;for(e.__super__.constructor.apply(this,arguments),s=function(){var t,i,r,n,s;return s=o.slice(1),i=s[0],n=s[1],r=s[2],t=function(t){return e.dataAccessors[i](t)},h.accessors.push(t)},n=a=1,l=this.cols;1<=l?a<=l:a>=l;n=1<=l?++a:--a)r=i["TFORM"+n],o=r.match(e.formPattern),s()}return v(e,t),e.formPattern=/([AIFED])(\d+)\.*(\d+)*/,e.dataAccessors={A:function(t){return t.trim()},I:function(t){return parseInt(t)},F:function(t){return parseFloat(t)},E:function(t){return parseFloat(t)},D:function(t){return parseFloat(t)}},e.prototype.getRow=function(t){var e,i,r,n,o,s,a,l;for(null==t&&(t=null),null!=t&&(this.rowsRead=t),this.current=this.begin+this.rowsRead*this.rowByteSize,this.view.seek(this.current),r="",e=o=1,l=this.rowByteSize;1<=l?o<=l:o>=l;e=1<=l?++o:--o)r+=this.view.getChar();for(r=r.trim().split(/\s+/),t={},i=s=0,a=r.length;s<a;i=++s)n=r[i],t[this.columns[i]]=this.accessors[i](n);return this.rowsRead+=1,t},e}(p),this.astro.FITS.Table=d,t=function(t){function e(t,i){var r,n,o,s,a,l,h,u,c,d=this;for(e.__super__.constructor.apply(this,arguments),n=h=1,u=this.cols;1<=u?h<=u:h>=u;n=1<=u?++h:--h)o="TFORM"+n,l=i[o],a=l.match(e.arrayDescriptorPattern),null!=a?!function(){var t,i;return i=a[1],t=function(){var t,r,o,s;for(r=d.view.getInt32(),o=d.view.getInt32(),d.current=d.view.tell(),d.view.seek(d.begin+d.tableLength+o),t=[],n=s=1;1<=r?s<=r:s>=r;n=1<=r?++s:--s)t.push(e.dataAccessors[i](d.view));return d.view.seek(d.current),t},d.accessors.push(t)}():(a=l.match(e.dataTypePattern),c=a.slice(1),s=c[0],r=c[1],s=s?parseInt(s):0,0===s||1===s?!function(t){var i;return i=function(){var i;return i=e.dataAccessors[t](d.view)},d.accessors.push(i)}(r):!function(t,i){var r,o;return"X"===t?(o=Math.log(i)/Math.log(2),r=function(){var t,e,r,s,a,l,h,u;for(s=function(t){var e;for(e=[],n=128;n>=1;)e.push(t&n?1:0),n/=2;return e},a=[],n=l=1;1<=o?l<=o:l>=o;n=1<=o?++l:--l)for(r=d.view.getUint8(),e=s(r),h=0,u=e.length;h<u;h++)t=e[h],a.push(t);return a.slice(0,+(i-1)+1||9e9)}):r="A"===t?function(){var r,o;for(r="",n=o=1;1<=i?o<=i:o>=i;n=1<=i?++o:--o)r+=e.dataAccessors[t](d.view);return r.trim()}:function(){var r,o;for(r=[],n=o=1;1<=i?o<=i:o>=i;n=1<=i?++o:--o)r.push(e.dataAccessors[t](d.view));return r},d.accessors.push(r)}(r,s))}return v(e,t),e.dataTypePattern=/(\d*)([L|X|B|I|J|K|A|E|D|C|M])/,e.arrayDescriptorPattern=/[0,1]*P([L|X|B|I|J|K|A|E|D|C|M])\((\d*)\)/,e}(p),this.astro.FITS.BinaryTable=t,r={Rice:function(t,e,i,r,n,o){var s,a,l,h,u,c,d,p,f,g,m,v,y,b,x,C;for(a=1<<u,x=this.RiceSetup[r](t),u=x[0],c=x[1],g=x[2],b=x[3],v=new Uint8Array(256),y=8,C=[128,255],f=C[0],d=C[1];d>=0;){for(;d>=f;)v[d]=y,d-=1;f/=2,y-=1}for(v[0]=0,s=t[b],b+=1,m=8,d=0;d<o;){for(m-=u;m<0;)s=s<<8|t[b],b+=1,m+=8;if(h=(s>>m)-1,s&=(1<<m)-1,p=d+i,p>o&&(p=o),h<0)for(;d<p;)t[d]=g,d++;else if(h===c)for(;d<p;){for(f=a-m,l=s<<f,f-=8;f>=0;)s=t[b],b+=1,l|=s<<f,f-=8;m>0?(s=t[b],b+=1,l|=s>>-f,s&=(1<<m)-1):s=0,0===(1&l)?l>>=1:l=~(l>>1),t[d]=l+g,g=t[d],d++}else for(;d<p;){for(;0===s;)m+=8,s=t[b],b+=1;for(y=m-v[s],m-=y+1,s^=1<<m,m-=h;m<0;)s=s<<8|t[b],b+=1,m+=8;l=y<<h|s>>m,s&=(1<<m)-1,0===(1&l)?l>>=1:l=~(l>>1),n[d]=l+g,g=n[d],d++}}return n},RiceSetup:{1:function(t){var e,i,r,n;return n=0,e=3,i=6,r=t[n],n+=1,[e,i,r,n]},2:function(t){var e,i,r,n,o;return o=0,i=4,r=14,n=0,e=t[o],o+=1,n|=e<<8,e=t[o],o+=1,n|=e,[i,r,n,o]},4:function(t){var e,i,r,n,o;return o=0,i=5,r=25,n=0,e=t[o],o+=1,n|=e<<24,e=t[o],o+=1,n|=e<<16,e=t[o],o+=1,n|=e<<8,e=t[o],o+=1,n|=e,[i,r,n,o]}},gzip:function(t){throw"Not yet implemented"},plio:function(t,e){throw"Not yet implemented"},hcompress:function(t,e){throw"Not yet implemented"}},this.astro.FITS.Decompress=r,e=function(t){function e(t,i){var r,n,o,s,a,l;for(e.__super__.constructor.apply(this,arguments),this.length+=i.PCOUNT,this.zcmptype=i.ZCMPTYPE,this.zbitpix=i.ZBITPIX,this.znaxis=i.ZNAXIS,this.zblank=e.setValue(i,"ZBLANK",void 0),this.blank=e.setValue(i,"BLANK",void 0),this.ztile=[],r=a=1,l=this.znaxis;1<=l?a<=l:a>=l;r=1<=l?++a:--a)s=i.contains("ZTILE"+r)?i["ZTILE"+r]:1===r?i.ZNAXIS1:1,this.ztile.push(s);for(this.width=i.ZNAXIS1,this.height=i.ZNAXIS2||1,this.algorithmParameters={},r=1;;){if(n="ZNAME"+r,!i.contains(n))break;o="ZVAL"+r,this.algorithmParameters[i[n]]=i[o],r+=1}"RICE_1"===this.zcmptype&&this.setRiceDefaults(),this.zmaskcmp=e.setValue(i,"ZMASKCMP",void 0),this.zquantiz=e.setValue(i,"ZQUANTIZ","LINEAR_SCALING"),this.bzero=e.setValue(i,"BZERO",0),this.bscale=e.setValue(i,"BSCALE",1),this.defineColumnAccessors(i),this.defineGetRow()}return v(e,t),e.dataTypePattern=/(\d*)([L|X|B|I|J|K|A|E|D|C|M])/,e.arrayDescriptorPattern=/[0,1]*P([L|X|B|I|J|K|A|E|D|C|M])\((\d*)\)/,e.include(u),e.extend(r),e.typedArray={B:Uint8Array,I:Int16Array,J:Int32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint8Array,4:Int16Array,8:Int32Array},e.prototype.defineColumnAccessors=function(t){var i,r,n,o,s,a,l,h,u,c,d,p=this;for(this.columnNames={},d=[],n=h=1,u=this.cols;1<=u?h<=u:h>=u;n=1<=u?++h:--h){if(l=t["TFORM"+n],s=l.match(e.arrayDescriptorPattern),a=t["TTYPE"+n].toUpperCase(),this.columnNames[a]=n-1,i=null,null!=s)switch(r=s[1],a){case"COMPRESSED_DATA":!function(t){return i=function(){var i,r;return i=p._accessor(t),null==i?new Float32Array(p.ztile[0]):(r=new e.typedArray[p.algorithmParameters.BYTEPIX](p.ztile[0]),e.Rice(i,o,p.algorithmParameters.BLOCKSIZE,p.algorithmParameters.BYTEPIX,r,p.ztile[0]),r)}}(r);break;case"UNCOMPRESSED_DATA":!function(t){return i=p._accessor(t)}(r);break;case"GZIP_COMPRESSED_DATA":!function(t){return i=function(){var e,i,r,n,o;if(e=p._accessor(t),null!=e){for(e=new Float32Array(p.width),i=n=0,o=e.length;n<o;i=++n)r=e[i],e[i]=NaN;return e}return null}}(r);break;default:!function(t){return i=p._accessor(t)}(r)}else s=l.match(e.dataTypePattern),c=s.slice(1),o=c[0],r=c[1],o=null!=o?parseInt(o):0,0===o||1===o?!function(t){return i=function(){return e.dataAccessors[t](p.view)}}(r):!function(t,r){return i=function(){var i,o,s;for(i=new e.typedArray[r](t),n=o=0,s=t-1;0<=s?o<=s:o>=s;n=0<=s?++o:--o)i[n]=e.dataAccessors[r](p.view);return i}}(o,r);d.push(this.accessors.push(i))}return d},e.prototype.defineGetRow=function(){var t;return this.totalRowsRead=0,t=null!=this.zblank||null!=this.blank||this.columnNames.hasOwnProperty("ZBLANK"),this.getRow=t?this.getRowHasBlanks:this.getRowNoBlanks},e.prototype.setRiceDefaults=function(){if(this.algorithmParameters.hasOwnProperty("BLOCKSIZE")||(this.algorithmParameters.BLOCKSIZE=32),!this.algorithmParameters.hasOwnProperty("BYTEPIX"))return this.algorithmParameters.BYTEPIX=4},e.setValue=function(t,e,i){return t.contains(e)?t[e]:i},e.prototype.getRowHasBlanks=function(){var t,e,i,r,n,o,s,a,l,h;for(h=this._getRow(),e=h[0],t=h[1],n=h[2],s=h[3],i=a=0,l=e.length;a<l;i=++a)o=e[i],r=this.totalRowsRead*this.width+i,this.data[r]=o===t?NaN:s+n*o;return this.rowsRead+=1,this.totalRowsRead+=1},e.prototype.getRowNoBlanks=function(){var t,e,i,r,n,o,s,a,l,h;for(h=this._getRow(),e=h[0],t=h[1],n=h[2],s=h[3],i=a=0,l=e.length;a<l;i=++a)o=e[i],r=this.totalRowsRead*this.width+i,this.data[r]=s+n*o;return this.rowsRead+=1,this.totalRowsRead+=1},e.prototype.getFrame=function(){var t;for(null==this.data&&this.initArray(Float32Array),this.totalRowsRead=0,this.rowsRead=0,t=this.height;t--;)this.getRow();return this.data},e.prototype._accessor=function(t){var i,r,n,o,s,a,l;if(a=[this.view.getInt32(),this.view.getInt32()],n=a[0],o=a[1],0===n)return null;for(i=new e.typedArray[t](n),this.current=this.view.tell(),this.view.seek(this.begin+this.tableLength+o),r=s=0,l=n-1;0<=l?s<=l:s>=l;r=0<=l?++s:--s)i[r]=e.dataAccessors[t](this.view);return this.view.seek(this.current),i},e.prototype._getRow=function(){var t,e,i,r,n,o,s,a,l;for(this.current=this.begin+this.totalRowsRead*this.rowByteSize,this.view.seek(this.current),r=[],l=this.accessors,s=0,a=l.length;s<a;s++)t=l[s],r.push(t());return i=r[this.columnNames.COMPRESSED_DATA]||r[this.columnNames.UNCOMPRESSED_DATA]||r[this.columnNames.GZIP_COMPRESSED_DATA],e=r[this.columnNames.ZBLANK]||this.zblank,n=r[this.columnNames.ZSCALE]||this.bscale,o=r[this.columnNames.ZZERO]||this.bzero,[i,e,n,o]},e.subtractiveDither1=function(){throw"Not yet implemented"},e.linearScaling=function(){throw"Not yet implemented"},e}(p),this.astro.FITS.CompressedImage=e,s=function(){function t(t,e){this.header=t,this.data=e}return t.prototype.hasData=function(){return null!=this.data},t.prototype.getCard=function(t){return this.header[t]},t}(),this.astro.FITS.HDU=s,o=function(){function i(t){var e;switch(e=i.getType(t)){case"arraybuffer":this.initFromBuffer(t);break;case"object":this.initFromObject(t);break;default:throw"fitsjs cannot initialize object"}}return i.LINEWIDTH=80,i.BLOCKLENGTH=2880,i.getType=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},i.excessBytes=function(t){return(i.BLOCKLENGTH-t%i.BLOCKLENGTH)%i.BLOCKLENGTH},i.extendDataView=function(t){var e,i,r,n,o,s,a,l;return DataView.prototype.getString=function(t){var e,i,r,n,o;for(r="",i=n=0,o=t-1;0<=o?n<=o:n>=o;i=0<=o?++n:--n)e=this.getUint8(),r+=String.fromCharCode(e>127?65533:e);return r},DataView.prototype.getChar=function(){return this.getString(1)},t.offset=0,o=t.getInt8,l=t.getUint8,r=t.getInt16,s=t.getUint16,n=t.getInt32,a=t.getUint32,e=t.getFloat32,i=t.getFloat64,t.getInt8=function(){var t;return t=o.apply(this,[this.offset]),this.offset+=1,t},t.getUint8=function(){var t;return t=l.apply(this,[this.offset]),this.offset+=1,t},t.getInt16=function(){var t;return t=r.apply(this,[this.offset,!1]),this.offset+=2,t},t.getUint16=function(){var t;return t=s.apply(this,[this.offset,!1]),this.offset+=2,t},t.getInt32=function(){var t;return t=n.apply(this,[this.offset,!1]),this.offset+=4,t},t.getUint32=function(){var t;return t=a.apply(this,[this.offset,!1]),this.offset+=4,t},t.getFloat32=function(){var t;return t=e.apply(this,[this.offset,!1]),this.offset+=4,t},t.getFloat64=function(){var t;return t=i.apply(this,[this.offset,!1]),this.offset+=8,t},t.seek=function(t){return this.offset=t},t.tell=function(){return this.offset}},i.prototype.initFromBuffer=function(t){var e,r,n,o;for(this.length=t.byteLength,this.view=new DataView(t),this.hdus=[],this.eof=!1,i.extendDataView(this.view),o=[];;){if(n=this.readHeader(),e=this.readData(n),r=new s(n,e),this.hdus.push(r),this.eof)break;o.push(void 0)}return o},i.prototype.initFromObject=function(t){return this.length=t.length,this.view=null,this.hdus=t.hdus,this.eof=!0},i.prototype.readHeader=function(){var t,e,r,n,o,s,l,h,u,c,d,p;for(p=/\s{80}/,s=/^END\s/,t=this.view.tell(),r=!1;;){if(r)break;for(e=this.view.getString(i.BLOCKLENGTH),h=0;;){if(d=i.BLOCKLENGTH-i.LINEWIDTH*(h+1),n=i.BLOCKLENGTH-i.LINEWIDTH*h,u=e.slice(d,n),c=u.match(p),!c){if(c=u.match(s))return o=this.view.tell(),this.view.seek(t),e=this.view.getString(o-t),l=new a,l.init(e),r=!0,this.checkEOF(),l;break}h+=1}}},i.prototype.readData=function(r){var n,o;if(r.hasDataUnit())return r.isPrimary()?n=new h(this.view,r):r.isExtension()&&("BINTABLE"===r.extensionType?n=r.contains("ZIMAGE")?new e(this.view,r):new t(this.view,r):"TABLE"===r.extensionType?n=new d(this.view,r):"IMAGE"===r.extensionType&&(n=new h(this.view,r))),o=i.excessBytes(n.length),this.view.seek(this.view.tell()+n.length+o),this.checkEOF(),n},i.prototype.checkEOF=function(){if(this.view.offset>=this.length)return this.eof=!0},i.prototype.count=function(){return this.hdus.length},i.prototype.getHDU=function(t){var e,i,r,n;if(null==t&&(t=void 0),null!=t&&null!=this.hdus[t])return this.hdus[t];for(n=this.hdus,i=0,r=n.length;i<r;i++)if(e=n[i],e.hasData())return e},i.prototype.getHeader=function(t){return null==t&&(t=void 0),this.getHDU(t).header},i.prototype.getDataUnit=function(t){return null==t&&(t=void 0),this.getHDU(t).data},i.prototype.getData=function(t){return null==t&&(t=void 0),this.getHDU(t).data.getFrame()},i}(),this.astro.FITS.File=o}.call(this),r("fits",function(){}),r("Layer/FitsLoader",["fits"],function(){function t(t){var e,i=astro.FITS,r=new i.File(t),n=r.getHDU(),o=n.data,s=new Uint8Array(o.view.buffer,o.begin,o.length);e=o.arrayType?o.arrayType.BYTES_PER_ELEMENT:Math.abs(n.header.BITPIX)/8;for(var a=0;a<s.length;a+=e)for(var l,h=0;h<e/2;h++)l=s[a+h],s[a+h]=s[a+e-1-h],s[a+e-1-h]=l;return r}var e=function(e,i,r,n){var o=new XMLHttpRequest;return o.onreadystatechange=function(n){if(4===o.readyState)if(200===o.status){if(o.response){var s=t(o.response);i&&i(s)}}else console.log("Error while loading "+e),r&&r()},o.onprogress=function(t){},o.open("GET",e),o.responseType="arraybuffer",o.send(),o};return{loadFits:e,parseFits:t}}),function(){"use strict";function t(t,e){var i=t.split("."),r=g;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(var n;i.length&&(n=i.shift());)i.length||e===p?r=r[n]?r[n]:r[n]={}:r[n]=e}function e(t,e){if(this.index="number"==typeof e?e:0,this.f=0,this.buffer=t instanceof(m?Uint8Array:Array)?t:new(m?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&i(this)}function i(t){var e,i=t.buffer,r=i.length,n=new(m?Uint8Array:Array)(r<<1);if(m)n.set(i);else for(e=0;e<r;++e)n[e]=i[e];return t.buffer=n}function r(t,e,i){var r,n="number"==typeof e?e:e=0,o="number"==typeof i?i:t.length;for(r=-1,n=7&o;n--;++e)r=r>>>8^T[255&(r^t[e])];for(n=o>>3;n--;e+=8)r=r>>>8^T[255&(r^t[e])],r=r>>>8^T[255&(r^t[e+1])],r=r>>>8^T[255&(r^t[e+2])],r=r>>>8^T[255&(r^t[e+3])],r=r>>>8^T[255&(r^t[e+4])],r=r>>>8^T[255&(r^t[e+5])],r=r>>>8^T[255&(r^t[e+6])],r=r>>>8^T[255&(r^t[e+7])];return(4294967295^r)>>>0}function n(t){this.buffer=new(m?Uint16Array:Array)(2*t),this.length=0}function o(t,e){this.h=I,this.j=0,this.input=m&&t instanceof Array?new Uint8Array(t):t,this.c=0,e&&(e.lazy&&(this.j=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=m&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.c=e.outputIndex)),this.a||(this.a=new(m?Uint8Array:Array)(32768))}function s(t,e){this.length=t,this.k=e}function a(t,e){function i(t,e){var i,r=t.k,n=[],o=0;i=P[t.length],n[o++]=65535&i,n[o++]=i>>16&255,n[o++]=i>>24;var s;switch(f){case 1===r:s=[0,r-1,0];break;case 2===r:s=[1,r-2,0];break;case 3===r:s=[2,r-3,0];break;case 4===r:s=[3,r-4,0];break;case 6>=r:s=[4,r-5,1];break;case 8>=r:s=[5,r-7,1];break;case 12>=r:s=[6,r-9,2];break;case 16>=r:s=[7,r-13,2];break;case 24>=r:s=[8,r-17,3];break;case 32>=r:s=[9,r-25,3];break;case 48>=r:s=[10,r-33,4];break;case 64>=r:s=[11,r-49,4];break;case 96>=r:s=[12,r-65,5];break;case 128>=r:s=[13,r-97,5];break;case 192>=r:s=[14,r-129,6];break;case 256>=r:s=[15,r-193,6];break;case 384>=r:s=[16,r-257,7];break;case 512>=r:s=[17,r-385,7];break;case 768>=r:s=[18,r-513,8];break;case 1024>=r:s=[19,r-769,8];break;case 1536>=r:s=[20,r-1025,9];break;case 2048>=r:s=[21,r-1537,9];break;case 3072>=r:s=[22,r-2049,10];break;case 4096>=r:s=[23,r-3073,10];break;case 6144>=r:s=[24,r-4097,11];break;case 8192>=r:s=[25,r-6145,11];break;case 12288>=r:s=[26,r-8193,12];break;case 16384>=r:s=[27,r-12289,12];break;case 24576>=r:s=[28,r-16385,13];break;case 32768>=r:s=[29,r-24577,13];break;default:throw"invalid distance"}i=s,n[o++]=i[0],n[o++]=i[1],n[o++]=i[2];var a,l;for(a=0,l=n.length;a<l;++a)v[y++]=n[a];x[n[0]]++,C[n[3]]++,b=t.length+e-1,c=null}var r,n,o,s,a,h,u,c,d,g={},v=m?new Uint16Array(2*e.length):[],y=0,b=0,x=new(m?Uint32Array:Array)(286),C=new(m?Uint32Array:Array)(30),_=t.j;if(!m){for(o=0;285>=o;)x[o++]=0;for(o=0;29>=o;)C[o++]=0}for(x[256]=1,r=0,n=e.length;r<n;++r){for(o=a=0,s=3;o<s&&r+o!==n;++o)a=a<<8|e[r+o];if(g[a]===p&&(g[a]=[]),h=g[a],!(0<b--)){for(;0<h.length&&32768<r-h[0];)h.shift();if(r+3>=n){for(c&&i(c,-1),o=0,s=n-r;o<s;++o)d=e[r+o],v[y++]=d,++x[d];break}0<h.length?(u=l(e,r,h),c?c.length<u.length?(d=e[r-1],v[y++]=d,++x[d],i(u,0)):i(c,-1):u.length<_?c=u:i(u,0)):c?i(c,-1):(d=e[r],v[y++]=d,++x[d])}h.push(r)}return v[y++]=256,x[256]++,t.n=x,t.m=C,m?v.subarray(0,y):v}function l(t,e,i){var r,n,o,a,l,h,u=0,c=t.length;a=0,h=i.length;t:for(;a<h;a++){if(r=i[h-a-1],o=3,3<u){for(l=u;3<l;l--)if(t[r+l-1]!==t[e+l-1])continue t;o=u}for(;258>o&&e+o<c&&t[r+o]===t[e+o];)++o;if(o>u&&(n=r,u=o),258===o)break}return new s(u,e-n)}function h(t,e){var i,r,o,s,a,l=t.length,h=new n(572),c=new(m?Uint8Array:Array)(l);if(!m)for(s=0;s<l;s++)c[s]=0;for(s=0;s<l;++s)0<t[s]&&h.push(s,t[s]);if(i=Array(h.length/2),r=new(m?Uint32Array:Array)(h.length/2),1===i.length)return c[h.pop().index]=1,c;for(s=0,a=h.length/2;s<a;++s)i[s]=h.pop(),r[s]=i[s].value;for(o=u(r,r.length,e),s=0,a=i.length;s<a;++s)c[i[s].index]=o[s];return c}function u(t,e,i){function r(t){var i=p[t][f[t]];i===e?(r(t+1),r(t+1)):--c[i],++f[t]}var n,o,s,a,l,h=new(m?Uint16Array:Array)(i),u=new(m?Uint8Array:Array)(i),c=new(m?Uint8Array:Array)(e),d=Array(i),p=Array(i),f=Array(i),g=(1<<i)-e,v=1<<i-1;for(h[i-1]=e,o=0;o<i;++o)g<v?u[o]=0:(u[o]=1,g-=v),g<<=1,h[i-2-o]=(h[i-1-o]/2|0)+e;for(h[0]=u[0],d[0]=Array(h[0]),p[0]=Array(h[0]),o=1;o<i;++o)h[o]>2*h[o-1]+u[o]&&(h[o]=2*h[o-1]+u[o]),d[o]=Array(h[o]),p[o]=Array(h[o]);for(n=0;n<e;++n)c[n]=i;for(s=0;s<h[i-1];++s)d[i-1][s]=t[s],p[i-1][s]=s;for(n=0;n<i;++n)f[n]=0;for(1===u[i-1]&&(--c[0],++f[i-1]),o=i-2;0<=o;--o){for(a=n=0,l=f[o+1],s=0;s<h[o];s++)a=d[o+1][l]+d[o+1][l+1],a>t[n]?(d[o][s]=a,p[o][s]=e,l+=2):(d[o][s]=t[n],p[o][s]=n,++n);f[o]=0,1===u[o]&&r(o)}return c}function c(t){var e,i,r,n,o=new(m?Uint16Array:Array)(t.length),s=[],a=[],l=0;for(e=0,i=t.length;e<i;e++)s[t[e]]=(0|s[t[e]])+1;for(e=1,i=16;e<=i;e++)a[e]=l,l+=0|s[e],l<<=1;for(e=0,i=t.length;e<i;e++)for(l=a[t[e]],a[t[e]]+=1,r=o[e]=0,n=t[e];r<n;r++)o[e]=o[e]<<1|1&l,l>>>=1;return o}function d(t,e){this.input=t,this.c=this.i=0,this.d={},e&&(e.flags&&(this.d=e.flags),"string"==typeof e.filename&&(this.filename=e.filename),"string"==typeof e.comment&&(this.l=e.comment),e.deflateOptions&&(this.e=e.deflateOptions)),this.e||(this.e={})}var p=void 0,f=!0,g=this,m="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;e.prototype.b=function(t,e,r){var n,o=this.buffer,s=this.index,a=this.f,l=o[s];if(r&&1<e&&(t=8<e?(_[255&t]<<24|_[t>>>8&255]<<16|_[t>>>16&255]<<8|_[t>>>24&255])>>32-e:_[t]>>8-e),8>e+a)l=l<<e|t,a+=e;else for(n=0;n<e;++n)l=l<<1|t>>e-n-1&1,8===++a&&(a=0,o[s++]=_[l],l=0,s===o.length&&(o=i(this)));o[s]=l,this.buffer=o,this.f=a,this.index=s},e.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.f&&(e[i]<<=8-this.f,e[i]=_[e[i]],i++),m?t=e.subarray(0,i):(e.length=i,t=e),t};var v,y=new(m?Uint8Array:Array)(256);for(v=0;256>v;++v){for(var b=v,x=b,C=7,b=b>>>1;b;b>>>=1)x<<=1,x|=1&b,--C;y[v]=(x<<C&255)>>>0}var _=y,w=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],T=m?new Uint32Array(w):w;
n.prototype.getParent=function(t){return 2*((t-2)/4|0)},n.prototype.push=function(t,e){var i,r,n,o=this.buffer;for(i=this.length,o[this.length++]=e,o[this.length++]=t;0<i&&(r=this.getParent(i),o[i]>o[r]);)n=o[i],o[i]=o[r],o[r]=n,n=o[i+1],o[i+1]=o[r+1],o[r+1]=n,i=r;return this.length},n.prototype.pop=function(){var t,e,i,r,n,o=this.buffer;for(e=o[0],t=o[1],this.length-=2,o[0]=o[this.length],o[1]=o[this.length+1],n=0;(r=2*n+2,!(r>=this.length))&&(r+2<this.length&&o[r+2]>o[r]&&(r+=2),o[r]>o[n]);)i=o[n],o[n]=o[r],o[r]=i,i=o[n+1],o[n+1]=o[r+1],o[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var A,I=2,M=[];for(A=0;288>A;A++)switch(f){case 143>=A:M.push([A+48,8]);break;case 255>=A:M.push([A-144+400,9]);break;case 279>=A:M.push([A-256+0,7]);break;case 287>=A:M.push([A-280+192,8]);break;default:throw"invalid literal: "+A}o.prototype.g=function(){var t,i,r,n,o=this.input;switch(this.h){case 0:for(r=0,n=o.length;r<n;){i=m?o.subarray(r,r+65535):o.slice(r,r+65535),r+=i.length;var s=i,l=r===n,u=p,d=p,g=p,v=p,y=p,b=this.a,x=this.c;if(m){for(b=new Uint8Array(this.a.buffer);b.length<=x+s.length+5;)b=new Uint8Array(b.length<<1);b.set(this.a)}if(u=l?1:0,b[x++]=0|u,d=s.length,g=~d+65536&65535,b[x++]=255&d,b[x++]=d>>>8&255,b[x++]=255&g,b[x++]=g>>>8&255,m)b.set(s,x),x+=s.length,b=b.subarray(0,x);else{for(v=0,y=s.length;v<y;++v)b[x++]=s[v];b.length=x}this.c=x,this.a=b}break;case 1:var C=new e(m?new Uint8Array(this.a.buffer):this.a,this.c);C.b(1,1,f),C.b(1,2,f);var _,w,T,A=a(this,o);for(_=0,w=A.length;_<w;_++)if(T=A[_],e.prototype.b.apply(C,M[T]),256<T)C.b(A[++_],A[++_],f),C.b(A[++_],5),C.b(A[++_],A[++_],f);else if(256===T)break;this.a=C.finish(),this.c=this.a.length;break;case I:var S,P,E,R,k,D,L,N,F,O,B,U,z,j,G,H=new e(m?new Uint8Array(this.a.buffer):this.a,this.c),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=Array(19);for(S=I,H.b(1,1,f),H.b(S,2,f),P=a(this,o),D=h(this.n,15),L=c(D),N=h(this.m,7),F=c(N),E=286;257<E&&0===D[E-1];E--);for(R=30;1<R&&0===N[R-1];R--);var V,q,X,Z,K,J,Q=E,$=R,tt=new(m?Uint32Array:Array)(Q+$),et=new(m?Uint32Array:Array)(316),it=new(m?Uint8Array:Array)(19);for(V=q=0;V<Q;V++)tt[q++]=D[V];for(V=0;V<$;V++)tt[q++]=N[V];if(!m)for(V=0,Z=it.length;V<Z;++V)it[V]=0;for(V=K=0,Z=tt.length;V<Z;V+=q){for(q=1;V+q<Z&&tt[V+q]===tt[V];++q);if(X=q,0===tt[V])if(3>X)for(;0<X--;)et[K++]=0,it[0]++;else for(;0<X;)J=138>X?X:138,J>X-3&&J<X&&(J=X-3),10>=J?(et[K++]=17,et[K++]=J-3,it[17]++):(et[K++]=18,et[K++]=J-11,it[18]++),X-=J;else if(et[K++]=tt[V],it[tt[V]]++,X--,3>X)for(;0<X--;)et[K++]=tt[V],it[tt[V]]++;else for(;0<X;)J=6>X?X:6,J>X-3&&J<X&&(J=X-3),et[K++]=16,et[K++]=J-3,it[16]++,X-=J}for(t=m?et.subarray(0,K):et.slice(0,K),O=h(it,7),j=0;19>j;j++)Y[j]=O[W[j]];for(k=19;4<k&&0===Y[k-1];k--);for(B=c(O),H.b(E-257,5,f),H.b(R-1,5,f),H.b(k-4,4,f),j=0;j<k;j++)H.b(Y[j],3,f);for(j=0,G=t.length;j<G;j++)if(U=t[j],H.b(B[U],O[U],f),16<=U){switch(j++,U){case 16:z=2;break;case 17:z=3;break;case 18:z=7;break;default:throw"invalid code: "+U}H.b(t[j],z,f)}var rt,nt,ot,st,at,lt,ht,ut,ct=[L,D],dt=[F,N];for(at=ct[0],lt=ct[1],ht=dt[0],ut=dt[1],rt=0,nt=P.length;rt<nt;++rt)if(ot=P[rt],H.b(at[ot],lt[ot],f),256<ot)H.b(P[++rt],P[++rt],f),st=P[++rt],H.b(ht[st],ut[st],f),H.b(P[++rt],P[++rt],f);else if(256===ot)break;this.a=H.finish(),this.c=this.a.length;break;default:throw"invalid compression type"}return this.a};var S=function(){function t(t){switch(f){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}var e,i,r=[];for(e=3;258>=e;e++)i=t(e),r[e]=i[2]<<24|i[1]<<16|i[0];return r}(),P=m?new Uint32Array(S):S;d.prototype.g=function(){var t,e,i,n,s,a,l,h,u=new(m?Uint8Array:Array)(32768),c=0,d=this.input,f=this.i,g=this.filename,v=this.l;if(u[c++]=31,u[c++]=139,u[c++]=8,t=0,this.d.fname&&(t|=k),this.d.fcomment&&(t|=D),this.d.fhcrc&&(t|=R),u[c++]=t,e=(Date.now?Date.now():+new Date)/1e3|0,u[c++]=255&e,u[c++]=e>>>8&255,u[c++]=e>>>16&255,u[c++]=e>>>24&255,u[c++]=0,u[c++]=E,this.d.fname!==p){for(l=0,h=g.length;l<h;++l)a=g.charCodeAt(l),255<a&&(u[c++]=a>>>8&255),u[c++]=255&a;u[c++]=0}if(this.d.comment){for(l=0,h=v.length;l<h;++l)a=v.charCodeAt(l),255<a&&(u[c++]=a>>>8&255),u[c++]=255&a;u[c++]=0}return this.d.fhcrc&&(i=65535&r(u,0,c),u[c++]=255&i,u[c++]=i>>>8&255),this.e.outputBuffer=u,this.e.outputIndex=c,s=new o(d,this.e),u=s.g(),c=s.c,m&&(c+8>u.buffer.byteLength?(this.a=new Uint8Array(c+8),this.a.set(new Uint8Array(u.buffer)),u=this.a):u=new Uint8Array(u.buffer)),n=r(d,p,p),u[c++]=255&n,u[c++]=n>>>8&255,u[c++]=n>>>16&255,u[c++]=n>>>24&255,h=d.length,u[c++]=255&h,u[c++]=h>>>8&255,u[c++]=h>>>16&255,u[c++]=h>>>24&255,this.i=f,m&&c<u.length&&(this.a=u=u.subarray(0,c)),u};var E=255,R=2,k=8,D=16;t("Zlib.Gzip",d),t("Zlib.Gzip.prototype.compress",d.prototype.g)}.call(this),r("gzip",function(){}),r("Layer/FitsRequest",["../Utils/ImageRequest"],function(t){t.prototype.send=function(t,e,i){var r=this;if(i)return void r.failCallback(r);if(t.search("fits")>0){var n=new XMLHttpRequest;n.onreadystatechange=function(e){n&&4===n.readyState&&(200===n.status?n.response&&(r.image=n.response,r.successCallback&&r.successCallback(r)):0!==n.status&&(console.log("Error while loading "+t),r.failCallback&&r.failCallback(r)),n=null)},n.onabort=function(t){r.abortCallback&&r.abortCallback(r),r.xhr=null},n.open("GET",t),n.responseType="arraybuffer",n.send(),this.xhr=n}else this.image=new Image,this.image.aborted=!1,this.image.crossOrigin="",this.image.dataType="byte",this.image.onload=function(){var t=0!==r.image.naturalWidth&&r.image.complete;t&&!this.aborted&&r.successCallback.call(r)},this.image.onerror=function(){r.failCallback&&!this.aborted&&r.failCallback(r)},this.image.src=t},t.prototype.abort=function(){this.xhr?this.xhr.abort():(this.abortCallback&&this.abortCallback(this),this.image.aborted=!0,this.image.src="")}}),r("Layer/HipsFitsLayer",["../Utils/Constants","../Utils/Utils","../Utils/Constants","../Tiling/HEALPixTiling","./AbstractHipsLayer","../Renderer/DynamicImage","./FitsLoader","gzip","../Utils/ImageRequest","./FitsRequest"],function(t,e,i,r,n,o,s,a,l){var h=function(t,e){n.prototype.constructor.call(this,t,e),this._ready=!1,this.fitsSupported=!0,this.levelZeroImage=null,this.rawFragShader="precision lowp float; \n",this.rawFragShader+="varying vec2 texCoord;\n",this.rawFragShader+="uniform sampler2D colorTexture; \n",this.rawFragShader+="uniform float opacity; \n",this.rawFragShader+="uniform float inversed; \n",this.rawFragShader+="bool isnan(float val) {\n",this.rawFragShader+="\t\treturn (val <= 0.0 || 0.0 <= val) ? ((val == 5e-324) ? true : false) : true;\n",this.rawFragShader+="}\n",this.rawFragShader+="void main(void)\n",this.rawFragShader+="{\n",this.rawFragShader+="\tvec4 color = texture2D(colorTexture, vec2(texCoord.x, (inversed == 1.) ? 1.0 - texCoord.y : texCoord.y));\n",this.rawFragShader+="\tgl_FragColor = vec4(color.r,color.g,color.b, color.a*opacity);\n",this.rawFragShader+="\tif (isnan( (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3. ) )\n",this.rawFragShader+="\t{\n",this.rawFragShader+="\t\tgl_FragColor.a = 0.;\n",this.rawFragShader+="\t}\n",this.rawFragShader+="}\n",this.colormapFragShader="precision lowp float; \n",this.colormapFragShader+="varying vec2 texCoord;\n",this.colormapFragShader+="uniform sampler2D colorTexture; \n",this.colormapFragShader+="uniform sampler2D colormap; \n",this.colormapFragShader+="uniform float min; \n",this.colormapFragShader+="uniform float max; \n",this.colormapFragShader+="uniform float opacity; \n",this.colormapFragShader+="bool isnan(float val) {\n",this.colormapFragShader+="\treturn (val <= 0.0 || 0.0 <= val) ? false : true;\n",this.colormapFragShader+="}\n",this.colormapFragShader+="void main(void)\n",this.colormapFragShader+="{\n",this.colormapFragShader+="\tfloat i = texture2D(colorTexture,vec2(texCoord.x, 1.0 - texCoord.y)).r;\n",this.colormapFragShader+="\tfloat d = clamp( ( i - min ) / (max - min), 0.0, 1.0 );\n",this.colormapFragShader+="\tvec4 cmValue = texture2D(colormap, vec2(d,0.));\n",this.colormapFragShader+="\tgl_FragColor = vec4(cmValue.r,cmValue.g,cmValue.b, cmValue.a*opacity);\n",this.colormapFragShader+="\tif (isnan( i ) )\n",this.colormapFragShader+="\t{\n",this.colormapFragShader+="\t\t gl_FragColor.a = 0.;\n",this.colormapFragShader+="\t}\n",this.colormapFragShader+="}\n";var i=this;this.customShader={fragmentCode:this.rawFragShader,updateUniforms:function(t,e){t.uniform1f(e.uniforms.inversed,i.inversed),i.levelZeroImage&&(t.uniform1f(e.uniforms.max,i.levelZeroImage.tmax),t.uniform1f(e.uniforms.min,i.levelZeroImage.tmin),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,i.levelZeroImage.colormapTex),t.uniform1i(e.uniforms.colormap,1),t.uniform1f(e.uniforms.opacity,i.getOpacity()))}},this.imageRequest=new l({successCallback:function(){var t,r;if(i._ready=!0,"fits"===i.format){try{t=new Uint8Array(i.imageRequest.image),r=a.unzip(t),i.imageRequest.image=new Uint8Array(r).buffer}catch(e){if("Not a GZIP file"!==e)return console.error(e),void this.failCallback();console.log("not gzipped"),t=null}i.handleImage(i.imageRequest);var n=i.imageRequest.image;if(i.globe){var s=i.globe.renderContext.gl;i.levelZeroImage=new o(i.globe.renderContext,n.typedArray,s.LUMINANCE,s.FLOAT,n.width,n.height),i.getLevelZeroTexture=function(){return i.levelZeroImage.texture}}}else i.levelZeroImage=this.image,i.getLevelZeroTexture=null;e.onready&&e.onready instanceof Function&&e.onready(i),i.globe&&i.globe.renderContext.requestFrame()},failCallback:function(){i.globe&&(i.globe.publishEvent("baseLayersError",i),i._ready=!1,console.log("Error while loading background"))},abortCallback:function(t){i._ready=!1,console.log("Background image request has been aborted")}})};return e.inherits(n,h),h.prototype._attach=function(t){n.prototype._attach.call(this,t);var e=this.globe.renderContext.gl;this.requestLevelZeroImage();var i=e.getExtension("OES_texture_float");i||(console.error("no OES_texture_float"),this.fitsSupported=!1)},h.prototype._detach=function(){this._ready||this.imageRequest.abort(),this._ready=!1,this.disposeResources(),n.prototype._detach.call(this)},h.prototype.getUrl=function(t){var e=this.baseUrl;return e+="/Norder",e+=t.order,e+="/Dir",e+=1e4*Math.floor(t.pixelIndex/1e4),e+="/Npix",e+=t.pixelIndex,e+="."+this.format},h.prototype.extractFitsData=function(t,e,i,r){for(var n,o=64,s=(this.levelZeroImage.height,this.levelZeroImage.width),a=this.levelZeroImage.pixels,l=o*s*(28-Math.floor(t/27))+t%27*o,h=0;h<o;h++)n=a.subarray(l+h*s,l+h*s+o),e.set(n,r+128*h+i)},h.prototype.generateLevel0Textures=function(t,e){var i,r,n,o,s,a,l;if("fits"!==this.format){var h=document.createElement("canvas");h.width=128,h.height=128;var u=h.getContext("2d");for(s=0;s<t.length;s++)a=t[s],r=4*a.pixelIndex,n=r%27*64,o=64*Math.floor(r/27),u.drawImage(this.levelZeroImage,n,o,64,64,0,0,64,64),r=4*a.pixelIndex+2,n=r%27*64,o=64*Math.floor(r/27),u.drawImage(this.levelZeroImage,n,o,64,64,64,0,64,64),r=4*a.pixelIndex+1,n=r%27*64,o=64*Math.floor(r/27),u.drawImage(this.levelZeroImage,n,o,64,64,0,64,64,64),r=4*a.pixelIndex+3,n=r%27*64,o=64*Math.floor(r/27),u.drawImage(this.levelZeroImage,n,o,64,64,64,64,64,64),l=u.getImageData(0,0,128,128),l.dataType="byte",a.texture=e.createGLTexture(l),a.imageSize=128}else for(s=0;s<t.length;s++)a=t[s],i=new Float32Array(16384),r=4*a.pixelIndex,this.extractFitsData(r,i,0,8192),r=4*a.pixelIndex+2,this.extractFitsData(r,i,64,8192),r=4*a.pixelIndex+1,this.extractFitsData(r,i,0,0),r=4*a.pixelIndex+3,this.extractFitsData(r,i,64,0),l={typedArray:i,width:128,height:128,dataType:"float"},a.texture=e.createGLTexture(l),a.imageSize=128},h.prototype.handleImage=function(t){if(!(t.image instanceof Image)){var e,i,r,n=s.parseFits(t.image),o=n.getHDU().data,a=o.arrayType.BYTES_PER_ELEMENT;if("Float64Array"===o.arrayType.name)for(i=new Float64Array(o.view.buffer,o.begin,o.length/a),e=new Float32Array(o.length/a),r=0;r<i.length;r++)e[r]=i[r];else e=new Float32Array(o.view.buffer,o.begin,o.length/a);t.image={typedArray:e,width:o.width,height:o.height,dataType:"float"}}},h.prototype.requestLevelZeroImage=function(){this.fitsSupported||(this.format="jpg"),this.customShader.fragmentCode=this.rawFragShader,"fits"===this.format?this.inversed=1:this.inversed=0;var t=this.baseUrl+"/Norder3/Allsky."+this.format;this.imageRequest.send(t)},h.prototype.disposeResources=function(){this.levelZeroImage&&this.levelZeroImage.dispose&&this.levelZeroImage.dispose(),this.levelZeroTexture&&this.globe.renderContext.gl.deleteTexture(this.levelZeroTexture),this.levelZeroImage=null,this.levelZeroTexture=null},h.prototype.setFormat=function(t){this.format=isFits?"fits":"jpg"},h}),r("Layer/HipsGraphicLayer",["../Utils/Utils","../Tiling/HEALPixTiling","./AbstractHipsLayer"],function(t,e,i){var r=function(t,e){i.prototype.constructor.call(this,t,e),this.levelZeroImage=new Image;var r=this;this.levelZeroImage.crossOrigin="",this.levelZeroImage.onload=function(){r._ready=!0,e.onready&&e.onready instanceof Function&&e.onready(r),r.globe&&r.globe.renderContext.requestFrame()},this.levelZeroImage.onerror=function(t){r.globe.publishEvent("baseLayersError",r),r._ready=!1,console.log("Cannot load "+r.levelZeroImage.src)},this._ready=!1};return t.inherits(i,r),r.prototype._attach=function(t){i.prototype._attach.call(this,t),this._overlay||(this.levelZeroImage.src=this.baseUrl+"/Norder3/Allsky."+this.format)},r.prototype.getUrl=function(t){var e=this.baseUrl;e+="/Norder",e+=t.order,e+="/Dir";var i=1e4*Math.floor(t.pixelIndex/1e4);return e+=i,e+="/Npix",e+=t.pixelIndex,e+="."+this.format},r.prototype.generateLevel0Textures=function(t,e){var i=document.createElement("canvas");i.width=128,i.height=128;var r,n,o,s,a,l=i.getContext("2d");for(r=0;r<t.length;r++){a=t[r],n=4*a.pixelIndex,o=n%27*64,s=64*Math.floor(n/27),l.drawImage(this.levelZeroImage,o,s,64,64,0,0,64,64),n=4*a.pixelIndex+2,o=n%27*64,s=64*Math.floor(n/27),l.drawImage(this.levelZeroImage,o,s,64,64,64,0,64,64),n=4*a.pixelIndex+1,o=n%27*64,s=64*Math.floor(n/27),l.drawImage(this.levelZeroImage,o,s,64,64,0,64,64,64),n=4*a.pixelIndex+3,o=n%27*64,s=64*Math.floor(n/27),l.drawImage(this.levelZeroImage,o,s,64,64,64,64,64,64);var h=l.getImageData(0,0,128,128);h.dataType="byte",a.texture=e.createGLTexture(h),a.imageSize=128}},r}),r("Layer/MocLayer",["jquery","./AbstractLayer","../Utils/Constants","../Renderer/FeatureStyle","../Utils/Utils","../Tiling/HEALPixBase","./FitsLoader"],function(t,e,i,r,n,o,s){var a=function(t){t.dataType=i.GEOMETRY.LineString,e.prototype.constructor.call(this,i.LAYER.Moc,t),this.serviceUrl=t.serviceUrl,this.startOrder=t.startOrder||2,t&&t.style?this.style=new r(t.style):this.style=new r,this.featuresSet=null};return n.inherits(e,a),a.prototype._attach=function(i){e.prototype._attach.call(this,i);var r,n=this;String(n.serviceUrl).endsWith(".fits")?s.loadFits(n.serviceUrl,function(t){var e={},i=t.getHDU(1).data;for(r=0;r<i.rows;r++){var s=i.getRow(r),a=o.uniq2hpix(s[i.columns[0]]),l=a[0];void 0===e[l]&&(e[l]=[]),e[l].push(a[1])}if(e.hasOwnProperty("0")||e.hasOwnProperty("1")||e.hasOwnProperty("2"))for(r=0;r<3;r++)if(e.hasOwnProperty(r)){var h=e[r];_.each(h,function(t){var i=o.getChildren(t);e.hasOwnProperty(r+1)||(e[r+1]=[]),e[r+1].push(i[0]),e[r+1].push(i[1]),e[r+1].push(i[2]),e[r+1].push(i[3])}),delete e[r]}n.moc=e,n.handleDistribution(e)}):t.ajax({type:"GET",url:n.serviceUrl,dataType:"json",success:function(t){n.handleDistribution(t)},error:function(e,i,r){t("#addLayer_"+n.id).find("label").css("color","red"),console.error(e.responseText)}}),i.tileManager.addPostRenderer(this)},a.prototype.generate=function(t){if(this.featuresSet&&t.order===this.startOrder){var e=this.featuresSet[t.pixelIndex];if(e)for(var i=0;i<e.length;i++)this.globe.vectorRendererManager.addGeometryToTile(this,e[i],this.style,t)}},a.prototype.render=function(){},a.prototype._detach=function(){for(var t in this.featuresSet)for(var i=this.globe.tileManager.level0Tiles[t],r=0;r<this.featuresSet[t].length;r++)this.globe.vectorRendererManager.removeGeometryFromTile(this.featuresSet[t][r],i);this.featuresSet=null,this.globe.tileManager.removePostRenderer(this),e.prototype._detach.call(this)},a.prototype.findChildIndices=function(t,e){for(var i=this.startOrder,r=i-e,n=Math.pow(4,r),o=t*n,s=[],a=o;a<o+n;a++)s.push(a);return s},a.prototype.findParentIndex=function(t,e){var i=this.startOrder,r=e-i;return Math.floor(t/Math.pow(4,r))},a.prototype.handleDistribution=function(t){this.globe.tileManager.renderContext.gl;this.featuresSet={};var e,r,n,s;for(var a in t){var l=parseInt(a,10);for(r=0;r<t[a].length;r++){var h=t[a][r];if(l>this.startOrder)e=this.findParentIndex(h,l);else{if(l!==this.startOrder){var u=this.findChildIndices(h,l);void 0===t[this.startOrder.toString()]?t[this.startOrder.toString()]=t[0].concat(u):t[this.startOrder.toString()]=t[this.startOrder.toString()].concat(u);continue}e=h}var c={type:i.GEOMETRY.Polygon,gid:"moc"+this.id+"_"+l+"_"+h,coordinates:[[]]},d=2,p=1;l<5&&(d=5,p=1/(d-1));var f,g,m=Math.pow(2,l),v=h&m*m-1,y=o.compress_bits(v),b=o.compress_bits(v>>>1),x=h>>>2*l;for(n=0;n<2;n++)for(s=0;s<d;s++)f=o.fxyf((y+n*(d-1)*p)/m,(b+s*p)/m,x),g=this.globe.getCoordinateSystem().getWorldFrom3D(f),0===n?c.coordinates[0][2*n*d+(d-1)-s]=[g[0],g[1]]:c.coordinates[0][2*n*d+s]=[g[0],g[1]];for(s=0;s<2;s++)for(n=0;n<d;n++)f=o.fxyf((y+n*p)/m,(b+s*(d-1)*p)/m,x),g=this.globe.getCoordinateSystem().getWorldFrom3D(f),1===s?c.coordinates[0][d+2*s*d+(d-1)-n]=[g[0],g[1]]:c.coordinates[0][d+2*s*d+n]=[g[0],g[1]];var C=this.globe.tileManager.level0Tiles[e];this.featuresSet[e]||(this.featuresSet[e]=[]),this.featuresSet[e].push(c),this.globe.vectorRendererManager.addGeometryToTile(this,c,this.style,C)}}},a}),r("Renderer/VectorRendererManager",[],function(){var t=function(e){this.renderers=[];for(var i=0;i<t.factory.length;i++)this.renderers.push(t.factory[i](e));this.renderables=[],this.bucketId=0};t.factory=[],t.prototype.getRenderer=function(t,e){for(var i=0;i<this.renderers.length;i++)if(this.renderers[i].canApply(t.type,e))return this.renderers[i];return null},t.prototype.generate=function(t){var e;if(t.parent){var i=t.parent.extension.renderer;if(i)for(delete t.extension.renderer,e=0;e<i.renderables.length;e++){var r=i.renderables[e];r.generateChild&&r.generateChild(t)}}else for(e=0;e<this.renderers.length;e++)this.renderers[e].generateLevelZero(t)},t.prototype.addGeometry=function(t,e,i){var r=this.getRenderer(e,i);r?r.addGeometry(t,e,i):console.log("No renderer for VectorRendererManager")},t.prototype.removeGeometry=function(t,e){var i=t._bucket;return!(!i||i.layer!==e)&&(i.renderer.removeGeometry(t),!0)},t.prototype.addGeometryToTile=function(t,e,i,r){var n=this.getRenderer(e,i);n.addGeometryToTile(t,e,i,r)},t.prototype.removeGeometryFromTile=function(t,e){var i=t._bucket;i.renderer.removeGeometryFromTile(t,e)};var e=function(t,e){var i=t.bucket.style.zIndex-e.bucket.style.zIndex;return 0===i?t.bucket.id-e.bucket.id:i};return t.prototype.render=function(){var t,i;for(i=0;i<this.renderers.length;i++){var r=this.renderers[i].buckets;for(t=0;t<r.length;t++)r[t].layer.isVisible()&&r[t].mainRenderable&&this.renderables.push(r[t].mainRenderable)}for(this.renderables.sort(e),t=0;t<this.renderables.length;){i=t+1;for(var n=this.renderables[t].bucket.renderer;i<this.renderables.length&&this.renderables[i].bucket.renderer===n;)i++;n.render(this.renderables,t,i),t=i}this.renderables.length=0},t}),r("Layer/OpenSearchLayer",["../Renderer/FeatureStyle","../Renderer/VectorRendererManager","../Utils/Utils","./AbstractLayer","../Renderer/RendererTileData","../Tiling/Tile","../Utils/Constants"],function(t,e,i,r,n,o,s){function a(t,e){return t.tile.distance-e.tile.distance}var l=function(t){t.dataType=s.GEOMETRY.Point,r.prototype.constructor.call(this,s.LAYER.OpenSearch,t),this.serviceUrl=t.serviceUrl,this.minOrder=t.minOrder||5,this.maxRequests=t.maxRequests||2,this.requestProperties="",this.invertY=t.invertY||!1,this.coordSystemRequired=!t.hasOwnProperty("coordSystemRequired")||t.coordSystemRequired,this.extId="os",this.features=[],this.featuresSet={},this.freeRequests=[],this.tilesToLoad=[];for(var e=0;e<this.maxRequests;e++){var i=new XMLHttpRequest;this.freeRequests.push(i)}};i.inherits(r,l);var h=function(t,e,i){this.layer=t,this.parent=i,this.tile=e,this.featureIds=[],this.state=l.TileState.NOT_LOADED,this.complete=!1,this.childrenCreated=!1};return l.prototype._attach=function(t){r.prototype._attach.call(this,t),this.extId+=this.id,t.tileManager.addPostRenderer(this)},l.prototype._detach=function(){this.globe.tileManager.removePostRenderer(this),r.prototype._detach.call(this)},l.prototype.launchRequest=function(t,e){var i=t.extension[this.extId];if(0!==this.freeRequests.length){i.state=l.TileState.LOADING,""!==this.requestProperties&&(e+="&"+this.requestProperties),this.maxRequests===this.freeRequests.length&&this.globe.publishEvent("startLoad",this);var r=this.freeRequests.pop(),n=this;r.onreadystatechange=function(e){var o,s,a,h;if(4===r.readyState){if(200===r.status){for(a=JSON.parse(r.response),i.complete=a.totalResults===a.features.length,n.updateFeatures(a.features),o=a.features.length-1;o>=0;o--)s=a.features[o],s.hasOwnProperty("id")||(s.id=s.properties.identifier),h=n.featuresSet.hasOwnProperty(s.id),h&&a.features.splice(o,1),n.addFeature(s,t);n.globe.refresh()}else if(r.status>=400)return i.complete=!0,void console.error(r.responseText);i.state=l.TileState.LOADED,n.freeRequests.push(r),void 0!==a&&null!==a.features&&a.features.length>0&&n.globe.publishEvent("features:added",{layer:n,features:a.features}),n.maxRequests===n.freeRequests.length&&n.globe.publishEvent("endLoad",n)}},r.open("GET",e),r.send()}},l.prototype.setRequestProperties=function(t){for(var e in this.featuresSet)for(var i=this.featuresSet[e],r=0;r<i.tiles.length;r++){var n=i.tiles[r],o=this.features[i.index];this.globe.vectorRendererManager.removeGeometryFromTile(this,o.geometry,n)}var s=this;this.globe.tileManager.visitTiles(function(t){t.extension[s.extId]&&(t.extension[s.extId].dispose(),t.extension[s.extId].featureIds=[],t.extension[s.extId].state=l.TileState.NOT_LOADED,t.extension[s.extId].complete=!1)}),this.featuresSet={},this.features=[],this.requestProperties="";for(var a in t)""!==this.requestProperties&&(this.requestProperties+="&"),this.requestProperties+=a+"="+t[a]},l.prototype.addFeature=function(t,e){var i,r=e.extension[this.extId];this.featuresSet.hasOwnProperty(t.id)?(i=this.featuresSet[t.id],i.tiles.push(e),t=this.features[i.index]):(this.features.push(t),i={index:this.features.length-1,tiles:[e]},this.featuresSet[t.properties.identifier]=i,this.featuresSet[t.id]=i),r.featureIds.push(t.id),t.geometry.gid=t.id;var n=t.properties.style?t.properties.style:this.style;this.globe.vectorRendererManager.addGeometryToTile(this,t.geometry,n,e)},l.prototype.removeFeature=function(t,e){var i=this.featuresSet[t];if(i){var r=i.tiles.indexOf(e);if(r>=0?i.tiles.splice(r,1):console.log("OpenSearchLayer internal error : tile not found when removing feature"),0===i.tiles.length){delete this.featuresSet[t];var n=this.features.pop();i.index<this.features.length&&(this.features[i.index]=n,this.featuresSet[n.id].index=i.index)}}},l.prototype.modifyFeatureStyle=function(t,e){t.properties.style=e;var i=this.featuresSet[t.id];if(i)for(var r=0;r<i.tiles.length;r++){var n=i.tiles[r];this.globe.vectorRendererManager.removeGeometryFromTile(t.geometry,n),this.globe.vectorRendererManager.addGeometryToTile(this,t.geometry,e,n)}},l.TileState={LOADING:0,LOADED:1,NOT_LOADED:2,INHERIT_PARENT:3},l.prototype.generate=function(t){t.order===this.minOrder&&(t.extension[this.extId]=new h(this,t,null))},h.prototype.traverse=function(t){if(this.layer.isVisible()&&t.state===o.State.LOADED&&(this.state===l.TileState.NOT_LOADED&&this.layer.tilesToLoad.push(this),this.state===l.TileState.LOADED&&!this.complete&&t.state===o.State.LOADED&&t.children&&!this.childrenCreated)){var e;for(e=0;e<4;e++)t.children[e].extension[this.layer.extId]||(t.children[e].extension[this.layer.extId]=new h(this.layer,t.children[e],this));this.childrenCreated=!0;var i=t.extension.renderer?t.extension.renderer.renderables:[];for(e=0;e<i.length;e++)i[e].bucket.layer===this.layer&&(i[e].hasChildren=!0)}},h.prototype.dispose=function(t,e){var i;if(this.parent&&this.parent.childrenCreated){this.parent.childrenCreated=!1;var r=this.parent.tile.extension.renderer?this.parent.tile.extension.renderer.renderables:[];for(i=0;i<r.length;i++)r[i].bucket.layer===this.layer&&(r[i].hasChildren=!1)}for(i=0;i<this.featureIds.length;i++)this.layer.removeFeature(this.featureIds[i],this.tile);this.tile=null,this.parent=null},l.prototype.buildUrl=function(t){var e=this.serviceUrl+"/search?order="+t.order+"&healpix="+t.pixelIndex;return this.coordSystemRequired&&(e+="&coordSystem=EQUATORIAL"),e+="&media=json"},l.prototype.render=function(t){if(this.isVisible()){this.tilesToLoad.sort(a);for(var e=0;e<this.tilesToLoad.length&&this.freeRequests.length>0;e++){var i=this.tilesToLoad[e].tile,r=this.buildUrl(i);r&&this.launchRequest(i,r)}this.tilesToLoad.length=0}},l.prototype.updateFeatures=function(t){for(var e=0;e<t.length;e++){var i=t[e];switch(i.geometry.type){case s.GEOMETRY.Point:i.geometry.coordinates[0]>180&&(i.geometry.coordinates[0]-=360);break;case s.GEOMETRY.Polygon:for(var r=i.geometry.coordinates[0],n=0;n<r.length;n++)r[n][0]>180&&(r[n][0]-=360)}}},l}),r("Services/FitsVisu",["jquery","../Renderer/FeatureStyle","../Renderer/DynamicImage","../Layer/FitsLoader","fits"],function(t,e,i,r){function n(t,e,i){t.xhr=r.loadFits(e,function(e){delete t.xhr;var r=e.getHDU().data;i&&i(t,e),o(r,t)}),h.publish("image:download",t)}function o(t,r){var n,o=new Float32Array(t.view.buffer,t.begin,t.length/4),s=h.getContextManager().getRenderContext().gl,a=new i(h.getContextManager().getRenderContext(),o,s.LUMINANCE,s.FLOAT,t.width,t.height),l=r.feature,u=r.layer;return n=new e(l.properties.style?l.properties.style:u.style),n.fillTexture=a.texture,n.uniformValues=a,n.fill=!0,u.modifyFeatureStyle(l,n),l.services&&(a.url=l.services.download.url),a}function s(t){return r.parseFits(t)}function a(t){t.xhr&&(t.xhr.abort(),delete t.xhr);var i=h.getContextManager().getRenderContext().gl;t.feature.properties.style.uniformValues&&t.feature.properties.style.uniformValues.dispose();var r=t.feature.properties.style.fillTexture;r&&i.deleteTexture(r);var n=new e(t.feature.properties.style);n.fillTexture=null,n.fill=!1,n.fillShader={fragmentCode:null,updateUniforms:null},delete n.uniformValues,t.layer.modifyFeatureStyle(t.feature,n)}var l,h;return{init:function(t,e){h=t,l=e.sitoolsBaseUrl;h.getContextManager().getRenderContext().gl.getExtension("OES_texture_float")},hideImage:function(t){var i=new e(t.feature.properties.style);i.fill=!1,t.layer.modifyFeatureStyle(t.feature,i)},showImage:function(t){var i=new e(t.feature.properties.style);i.fill=!0,t.layer.modifyFeatureStyle(t.feature,i)},removeImage:function(e){if(h.publish("image:remove",e),e.isFits)a(e),t("#quicklookFits").removeClass("selected");else{var i=e.feature.properties.style;i.fill=!1,i.fillTextureUrl=null,e.layer.modifyFeatureStyle(e.feature,i),t("#quicklook").removeClass("selected")}h.getContextManager().getActivatedContext().refresh()},addImage:function(i){var r=i.feature,n=new e(r.properties.style);if(n.fill=!0,h.publish("image:add",i),i.isFits){var o=l+"/proxy?external_url="+encodeURIComponent(r.services.download.url);this.computeFits(i,o),t("#quicklookFits").addClass("selected")}else n.fillTextureUrl=l+"/proxy?external_url="+r.properties.quicklook+"&rewrite_redirection=true",t("#quicklook").addClass("selected");i.layer.modifyFeatureStyle(r,n),h.getContextManager().getActivatedContext().refresh()},computeFits:n,handleFits:o,parseFits:s}}),r("Services/Triangle",[],function(){function t(t,e,i,r){var n=[],o=[],s=[],a=[],l=[];return vec3.cross(vec3.subtract(r,i,n),vec3.subtract(t,i,o),a),vec3.cross(n,vec3.subtract(e,i,s),l),vec3.dot(a,l)>=0}function e(e,i,r,n){return t(e,i,r,n)&&t(e,r,i,n)&&t(e,n,i,r)}var i=function(t,e,i){this.initA=t.slice(0),this.initB=e.slice(0),this.initC=i.slice(0),this.a=t,this.b=e,this.c=i,this.dragging=!1,this.hover=!1,this.halfWidth=Math.abs((i[0]-e[0])/2)};return i.prototype.reset=function(){this.a=this.initA.slice(0),this.b=this.initB.slice(0),this.c=this.initC.slice(0)},i.prototype.contains=function(t){return e(t,this.a,this.b,this.c)},i.prototype.draw=function(t,e){this.dragging?t.fillStyle="#FF0"|e.draggingColor:t.fillStyle="#F00"|e.noDraggingColor,t.beginPath(),t.moveTo(this.a[0],this.a[1]),t.lineTo(this.b[0],this.b[1]),t.lineTo(this.c[0],this.c[1]),t.closePath(),t.fill(),!this.dragging&&this.hover&&(t.strokeStyle="#FF0"|e.draggingColor,t.stroke())},i.prototype.modifyPosition=function(t){this.a[0]=t[0],this.b[0]=t[0]-this.halfWidth,this.c[0]=t[0]+this.halfWidth},i}),r("Services/HistogramCore",["./Triangle"],function(t){function e(){s=n.height-l,a=i+o>n.width?n.width:i+o,this.minThreshold=new t([o,s+1,0],[o-h,s+l-1,0],[o+h,s+l-1,0]),this.maxThreshold=new t([a,s+1,0],[a-h,s+l-1,0],[a+h,s+l-1,0])}var i,r,n,o,s,a,l,h;return{init:function(t){this.image=t.image,this.onUpdate=t.onUpdate,this.accuracy=t.accuracy||6,r=this,i=t.nbBins||256,l=t.paddingBottom||15,o=t.originX||5,h=t.triangleHalfWidth||5,n=document.getElementById(t.canvas),this.ctx=n.getContext("2d"),this.initThresholds()},initThresholds:e}}),function(t){"function"==typeof r&&r.amd?r("jquery.ui",["jquery"],t):t(jQuery)}(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function r(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,
calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker(m.inline?m.dpDiv.parent()[0]:m.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function s(e,i){t.extend(e,i);for(var r in i)null==i[r]&&(e[r]=i[r]);return e}function a(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var l=0,h=Array.prototype.slice;t.cleanData=function(e){return function(i){var r,n,o;for(o=0;null!=(n=i[o]);o++)try{r=t._data(n,"events"),r&&r.remove&&t(n).triggerHandler("remove")}catch(t){}e(i)}}(t.cleanData),t.widget=function(e,i,r){var n,o,s,a={},l=e.split(".")[0];e=e.split(".")[1];var h=l+"-"+e;return r||(r=i,i=t.Widget),t.isArray(r)&&(r=t.extend.apply(null,[{}].concat(r))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],o=t[l][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new o(t,e)},t.extend(o,n,{version:r.version,_proto:t.extend({},r),_childConstructors:[]}),s=new i,s.options=t.widget.extend({},s.options),t.each(r,function(e,r){return t.isFunction(r)?void(a[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=r.apply(this,arguments),this._super=i,this._superApply=o,e}}()):void(a[e]=r)}),o.prototype=t.widget.extend(s,{widgetEventPrefix:n?s.widgetEventPrefix||e:e},a,{constructor:o,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var r=i.prototype;t.widget(r.namespace+"."+r.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,r,n=h.call(arguments,1),o=0,s=n.length;s>o;o++)for(i in n[o])r=n[o][i],n[o].hasOwnProperty(i)&&void 0!==r&&(e[i]=t.isPlainObject(r)?t.isPlainObject(e[i])?t.widget.extend({},e[i],r):t.widget.extend({},r):r);return e},t.widget.bridge=function(e,i){var r=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,s=h.call(arguments,1),a=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,r);return"instance"===n?(a=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,s),i!==o&&void 0!==i?(a=i&&i.jquery?a.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):a=void 0:(s.length&&(n=t.widget.extend.apply(null,[n].concat(s))),this.each(function(){var e=t.data(this,r);e?(e.option(n||{}),e._init&&e._init()):t.data(this,r,new i(n,this))})),a}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var r,n,o,s=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(s={},r=e.split("."),e=r.shift(),r.length){for(n=s[e]=t.widget.extend({},this.options[e]),o=0;r.length-1>o;o++)n[r[o]]=n[r[o]]||{},n=n[r[o]];if(e=r.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];s[e]=i}return this._setOptions(s),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,r,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(r=t(n.get()),this._removeClass(n,i),r.addClass(this._classes({element:r,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var s,a;for(a=0;i.length>a;a++)s=n.classesElementLookup[i[a]]||t(),s=t(e.add?t.unique(s.get().concat(e.element.get())):s.not(e.element).get()),n.classesElementLookup[i[a]]=s,r.push(i[a]),o&&e.classes[i[a]]&&r.push(e.classes[i[a]])}var r=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),r.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(r,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[r]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,r){r="boolean"==typeof r?r:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:r};return o.element.toggleClass(this._classes(o),r),this},_on:function(e,i,r){var n,o=this;"boolean"!=typeof e&&(r=i,i=e,e=!1),r?(i=n=t(i),this.bindings=this.bindings.add(i)):(r=i,i=this.element,n=this.widget()),t.each(r,function(r,s){function a(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var l=r.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+o.eventNamespace,u=l[2];u?n.on(h,u,a):i.on(h,a)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?r[t]:t).apply(r,arguments)}var r=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,r){var n,o,s=this.options[e];if(r=r||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,r),!(t.isFunction(s)&&s.apply(this.element[0],[i].concat(r))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(r,n,o){"string"==typeof n&&(n={effect:n});var s,a=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),s=!t.isEmptyObject(n),n.complete=o,n.delay&&r.delay(n.delay),s&&t.effects&&t.effects.effect[a]?r[e](n):a!==e&&r[a]?r[a](n.duration,n.easing,o):r.queue(function(i){t(this)[e](),o&&o.call(r[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(c.test(t[0])?e/100:1),parseFloat(t[1])*(c.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function r(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,s=Math.abs,a=/left|center|right/,l=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,c=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,r=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=r.children()[0];return t("body").append(r),e=o.offsetWidth,r.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=r[0].clientWidth),r.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),r=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===r||"auto"===r&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),r=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!r&&!n;return{element:i,isWindow:r,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var c,p,f,g,m,v,y=t(n.of),b=t.position.getWithinInfo(n.within),x=t.position.getScrollInfo(b),C=(n.collision||"flip").split(" "),_={};return v=r(y),y[0].preventDefault&&(n.at="left top"),p=v.width,f=v.height,g=v.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=a.test(i[0])?i.concat(["center"]):l.test(i[0])?["center"].concat(i):["center","center"]),i[0]=a.test(i[0])?i[0]:"center",i[1]=l.test(i[1])?i[1]:"center",t=h.exec(i[0]),e=h.exec(i[1]),_[this]=[t?t[0]:0,e?e[0]:0],n[this]=[u.exec(i[0])[0],u.exec(i[1])[0]]}),1===C.length&&(C[1]=C[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),c=e(_.at,p,f),m.left+=c[0],m.top+=c[1],this.each(function(){var r,a,l=t(this),h=l.outerWidth(),u=l.outerHeight(),d=i(this,"marginLeft"),v=i(this,"marginTop"),w=h+d+i(this,"marginRight")+x.width,T=u+v+i(this,"marginBottom")+x.height,A=t.extend({},m),I=e(_.my,l.outerWidth(),l.outerHeight());"right"===n.my[0]?A.left-=h:"center"===n.my[0]&&(A.left-=h/2),"bottom"===n.my[1]?A.top-=u:"center"===n.my[1]&&(A.top-=u/2),A.left+=I[0],A.top+=I[1],r={marginLeft:d,marginTop:v},t.each(["left","top"],function(e,i){t.ui.position[C[e]]&&t.ui.position[C[e]][i](A,{targetWidth:p,targetHeight:f,elemWidth:h,elemHeight:u,collisionPosition:r,collisionWidth:w,collisionHeight:T,offset:[c[0]+I[0],c[1]+I[1]],my:n.my,at:n.at,within:b,elem:l})}),n.using&&(a=function(t){var e=g.left-A.left,i=e+p-h,r=g.top-A.top,a=r+f-u,c={target:{element:y,left:g.left,top:g.top,width:p,height:f},element:{element:l,left:A.left,top:A.top,width:h,height:u},horizontal:0>i?"left":e>0?"right":"center",vertical:0>a?"top":r>0?"bottom":"middle"};h>p&&p>s(e+i)&&(c.horizontal="center"),u>f&&f>s(r+a)&&(c.vertical="middle"),c.important=o(s(e),s(i))>o(s(r),s(a))?"horizontal":"vertical",n.using.call(this,t,c)}),l.offset(t.extend(A,{using:a}))})},t.ui.position={fit:{left:function(t,e){var i,r=e.within,n=r.isWindow?r.scrollLeft:r.offset.left,s=r.width,a=t.left-e.collisionPosition.marginLeft,l=n-a,h=a+e.collisionWidth-s-n;e.collisionWidth>s?l>0&&0>=h?(i=t.left+l+e.collisionWidth-s-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+s-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=o(t.left-a,t.left)},top:function(t,e){var i,r=e.within,n=r.isWindow?r.scrollTop:r.offset.top,s=e.within.height,a=t.top-e.collisionPosition.marginTop,l=n-a,h=a+e.collisionHeight-s-n;e.collisionHeight>s?l>0&&0>=h?(i=t.top+l+e.collisionHeight-s-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+s-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=o(t.top-a,t.top)}},flip:{left:function(t,e){var i,r,n=e.within,o=n.offset.left+n.scrollLeft,a=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,u=h-l,c=h+e.collisionWidth-a-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>u?(i=t.left+d+p+f+e.collisionWidth-a-o,(0>i||s(u)>i)&&(t.left+=d+p+f)):c>0&&(r=t.left-e.collisionPosition.marginLeft+d+p+f-l,(r>0||c>s(r))&&(t.left+=d+p+f))},top:function(t,e){var i,r,n=e.within,o=n.offset.top+n.scrollTop,a=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,u=h-l,c=h+e.collisionHeight-a-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>u?(r=t.top+p+f+g+e.collisionHeight-a-o,(0>r||s(u)>r)&&(t.top+=p+f+g)):c>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,(i>0||c>s(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,r){return!!t.data(e,r[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var u="ui-effects-",c="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var r=c[e.type]||{};return null==t?i||!e.def?null:e.def:(t=r.floor?~~t:parseFloat(t),isNaN(t)?e.def:r.mod?(t+r.mod)%r.mod:0>t?0:t>r.max?r.max:t)}function r(i){var r=h(),n=r._rgba=[];return i=i.toLowerCase(),f(l,function(t,o){var s,a=o.re.exec(i),l=a&&o.parse(a),h=o.space||"rgba";return l?(s=r[h](l),r[u[h].cache]=s[u[h].cache],n=r._rgba=s._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),r):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,s="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",a=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],h=t.Color=function(e,i,r,n){return new t.Color.fn.parse(e,i,r,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),h.fn=t.extend(h.prototype,{parse:function(n,s,a,l){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(s),s=e);var c=this,d=t.type(n),p=this._rgba=[];return s!==e&&(n=[n,s,a,l],d="array"),"string"===d?this.parse(r(n)||o._default):"array"===d?(f(u.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof h?f(u,function(t,e){n[e.cache]&&(c[e.cache]=n[e.cache].slice())}):f(u,function(e,r){var o=r.cache;f(r.props,function(t,e){if(!c[o]&&r.to){if("alpha"===t||null==n[t])return;c[o]=r.to(c._rgba)}c[o][e.idx]=i(n[t],e,!0)}),c[o]&&0>t.inArray(null,c[o].slice(0,3))&&(c[o][3]=1,r.from&&(c._rgba=r.from(c[o])))}),this):e},is:function(t){var i=h(t),r=!0,n=this;return f(u,function(t,o){var s,a=i[o.cache];return a&&(s=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=a[i.idx]?r=a[i.idx]===s[i.idx]:e})),r}),r},_space:function(){var t=[],e=this;return f(u,function(i,r){e[r.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var r=h(t),n=r._space(),o=u[n],s=0===this.alpha()?h("transparent"):this,a=s[o.cache]||o.to(s._rgba),l=a.slice();return r=r[o.cache],f(o.props,function(t,n){var o=n.idx,s=a[o],h=r[o],u=c[n.type]||{};null!==h&&(null===s?l[o]=h:(u.mod&&(h-s>u.mod/2?s+=u.mod:s-h>u.mod/2&&(s-=u.mod)),l[o]=i((h-s)*e+s,n)))}),this[n](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),r=i.pop(),n=h(e)._rgba;return h(t.map(i,function(t,e){return(1-r)*n[e]+r*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),r=i.pop();return e&&i.push(~~(255*r)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,u.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,r=t[0]/255,n=t[1]/255,o=t[2]/255,s=t[3],a=Math.max(r,n,o),l=Math.min(r,n,o),h=a-l,u=a+l,c=.5*u;return e=l===a?0:r===a?60*(n-o)/h+360:n===a?60*(o-r)/h+120:60*(r-n)/h+240,i=0===h?0:.5>=c?h/u:h/(2-u),[Math.round(e)%360,i,c,null==s?1:s]},u.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],r=t[2],o=t[3],s=.5>=r?r*(1+i):r+i-r*i,a=2*r-s;return[Math.round(255*n(a,s,e+1/3)),Math.round(255*n(a,s,e)),Math.round(255*n(a,s,e-1/3)),o]},f(u,function(r,n){var o=n.props,s=n.cache,l=n.to,u=n.from;h.fn[r]=function(r){if(l&&!this[s]&&(this[s]=l(this._rgba)),r===e)return this[s].slice();var n,a=t.type(r),c="array"===a||"object"===a?r:arguments,d=this[s].slice();return f(o,function(t,e){var r=c["object"===a?t:e.idx];null==r&&(r=d[e.idx]),d[e.idx]=i(r,e)}),u?(n=h(u(d)),n[s]=d,n):h(d)},f(o,function(e,i){h.fn[e]||(h.fn[e]=function(n){var o,s=t.type(n),l="alpha"===e?this._hsla?"hsla":"rgba":r,h=this[l](),u=h[i.idx];return"undefined"===s?u:("function"===s&&(n=n.call(this,u),s=t.type(n)),null==n&&i.empty?this:("string"===s&&(o=a.exec(n),o&&(n=u+parseFloat(o[2])*("+"===o[1]?1:-1))),h[i.idx]=n,this[l](h)))})})}),h.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,s,a="";if("transparent"!==n&&("string"!==t.type(n)||(o=r(n)))){if(n=h(o||n),!d.rgba&&1!==n._rgba[3]){for(s="backgroundColor"===i?e.parentNode:e;(""===a||"transparent"===a)&&s&&s.style;)try{a=t.css(s,"backgroundColor"),s=s.parentNode}catch(t){}n=n.blend(a&&"transparent"!==a?a:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(t){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=h(e.elem,i),e.end=h(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},h.hook(s),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,r){e["border"+r+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,r,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(r=n.length;r--;)i=n[r],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var r,o,s={};for(r in i)o=i[r],e[r]!==o&&(n[r]||(t.fx.step[r]||!isNaN(parseFloat(o)))&&(s[r]=o));return s}var r=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,s,a){var l=t.speed(o,s,a);return this.queue(function(){var o,s=t(this),a=s.attr("class")||"",h=l.children?s.find("*").addBack():s;h=h.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(r,function(t,e){n[e]&&s[e+"Class"](n[e])})},o(),h=h.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),s.attr("class",a),h=h.map(function(){var e=this,i=t.Deferred(),r=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,r),i.promise()}),t.when.apply(t,h.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(s[0])})})},t.fn.extend({addClass:function(e){return function(i,r,n,o){return r?t.effects.animateClass.call(this,{add:i},r,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,r,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},r,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,r,n,o,s){return"boolean"==typeof r||void 0===r?n?t.effects.animateClass.call(this,r?{add:i}:{remove:i},n,o,s):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},r,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,r,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},r,n,o)}})}(),function(){function e(e,i,r,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,r=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=r,r=i,i={}),t.isFunction(r)&&(n=r,r=null),i&&t.extend(e,i),r=r||i.duration,e.duration=t.fx.off?0:"number"==typeof r?r:r in t.fx.speeds?t.fx.speeds[r]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!(e&&"number"!=typeof e&&!t.fx.speeds[e])||("string"==typeof e&&!t.effects.effect[e]||(!!t.isFunction(e)||"object"==typeof e&&!e.effect))}function r(t,e){var i=e.outerWidth(),r=e.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,o=n.exec(t)||["",0,i,r,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?r:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),t.uiBackCompat!==!1&&t.extend(t.effects,{save:function(t,e){for(var i=0,r=e.length;r>i;i++)null!==e[i]&&t.data(u+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,r=0,n=e.length;n>r;r++)null!==e[r]&&(i=t.data(u+e[r]),t.css(e[r],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),float:e.css("float")},r=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(t){o=document.body}return e.wrap(r),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),r=e.parent(),"static"===e.css("position")?(r.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,r){i[r]=e.css(r),isNaN(parseInt(i[r],10))&&(i[r]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),r.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,r){return r||(r=i,i="effect"),t.effects.effect[e]=r,t.effects.effect[e].mode=i,r},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var r="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*r,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*r}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var r=t.queue();e>1&&r.splice.apply(r,[1,0].concat(r.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(c,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(c)||"",t.removeData(c)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,r;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=t[1]/e.width}return{x:r,y:i}},createPlaceholder:function(e){var i,r=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(r)&&(r="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),float:e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(u+"placeholder",i)),e.css({position:r,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=u+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,r,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*r+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){a.removeData(d),t.effects.cleanUp(a),"hide"===r.mode&&a.hide(),s()}function s(){t.isFunction(l)&&l.call(a[0]),t.isFunction(e)&&e()}var a=t(this);r.mode=u.shift(),t.uiBackCompat===!1||o?"none"===r.mode?(a[h](),s()):n.call(a[0],r,i):(a.is(":hidden")?"hide"===h:"show"===h)?(a[h](),s()):n.call(a[0],r,s)}var r=e.apply(this,arguments),n=t.effects.effect[r.effect],o=n.mode,s=r.queue,a=s||"fx",l=r.complete,h=r.mode,u=[],c=function(e){var i=t(this),r=t.effects.mode(i,h)||o;i.data(d,!0),u.push(r),o&&("show"===r||r===o&&"hide"===r)&&i.show(),o&&"none"===r||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?h?this[h](r.duration,l):this.each(function(){l&&l.call(this)}):s===!1?this.each(c).each(i):this.queue(a,c).queue(a,i)},show:function(t){return function(r){if(i(r))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(r){if(i(r))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(r){if(i(r)||"boolean"==typeof r)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),r=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(r=[parseFloat(i),e])}),r},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):r(this.css("clip"),this)},transfer:function(e,i){var r=t(this),n=t(e.to),o="fixed"===n.css("position"),s=t("body"),a=o?s.scrollTop():0,l=o?s.scrollLeft():0,h=n.offset(),u={top:h.top-a,left:h.left-l,height:n.innerHeight(),width:n.innerWidth()},c=r.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:c.top-a,left:c.left-l,height:r.innerHeight(),width:r.innerWidth(),position:o?"fixed":"absolute"}).animate(u,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=r(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2);
},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();var f=t.effects;t.effects.define("blind","hide",function(e,i){var r={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",s=n.cssClip(),a={clip:t.extend({},s)},l=t.effects.createPlaceholder(n);a.clip[r[o][0]]=a.clip[r[o][1]],"show"===e.mode&&(n.cssClip(a.clip),l&&l.css(t.effects.clipToBox(a)),a.clip=s),l&&l.animate(t.effects.clipToBox(a),e.duration,e.easing),n.animate(a,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var r,n,o,s=t(this),a=e.mode,l="hide"===a,h="show"===a,u=e.direction||"up",c=e.distance,d=e.times||5,p=2*d+(h||l?1:0),f=e.duration/p,g=e.easing,m="up"===u||"down"===u?"top":"left",v="up"===u||"left"===u,y=0,b=s.queue().length;for(t.effects.createPlaceholder(s),o=s.css(m),c||(c=s["top"===m?"outerHeight":"outerWidth"]()/3),h&&(n={opacity:1},n[m]=o,s.css("opacity",0).css(m,v?2*-c:2*c).animate(n,f,g)),l&&(c/=Math.pow(2,d-1)),n={},n[m]=o;d>y;y++)r={},r[m]=(v?"-=":"+=")+c,s.animate(r,f,g).animate(n,f,g),c=l?2*c:c/2;l&&(r={opacity:0},r[m]=(v?"-=":"+=")+c,s.animate(r,f,g)),s.queue(i),t.effects.unshift(s,b,p+1)}),t.effects.define("clip","hide",function(e,i){var r,n={},o=t(this),s=e.direction||"vertical",a="both"===s,l=a||"horizontal"===s,h=a||"vertical"===s;r=o.cssClip(),n.clip={top:h?(r.bottom-r.top)/2:r.top,right:l?(r.right-r.left)/2:r.right,bottom:h?(r.bottom-r.top)/2:r.bottom,left:l?(r.right-r.left)/2:r.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=r),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var r,n=t(this),o=e.mode,s="show"===o,a=e.direction||"left",l="up"===a||"down"===a?"top":"left",h="up"===a||"left"===a?"-=":"+=",u="+="===h?"-=":"+=",c={opacity:0};t.effects.createPlaceholder(n),r=e.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,c[l]=h+r,s&&(n.css(c),c[l]=u+r,c.opacity=1),n.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function r(){b.push(this),b.length===c*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),i()}var o,s,a,l,h,u,c=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=c,p=t(this),f=e.mode,g="show"===f,m=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/d),y=Math.ceil(p.outerHeight()/c),b=[];for(o=0;c>o;o++)for(l=m.top+o*y,u=o-(c-1)/2,s=0;d>s;s++)a=m.left+s*v,h=s-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-s*v,top:-o*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:a+(g?h*v:0),top:l+(g?u*y:0),opacity:g?0:1}).animate({left:a+(g?0:h*v),top:l+(g?0:u*y),opacity:g?1:0},e.duration||500,e.easing,r)}),t.effects.define("fade","toggle",function(e,i){var r="show"===e.mode;t(this).css("opacity",r?0:1).animate({opacity:r?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var r=t(this),n=e.mode,o="show"===n,s="hide"===n,a=e.size||15,l=/([0-9]+)%/.exec(a),h=!!e.horizFirst,u=h?["right","bottom"]:["bottom","right"],c=e.duration/2,d=t.effects.createPlaceholder(r),p=r.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[u[0]],p[u[1]]],v=r.queue().length;l&&(a=parseInt(l[1],10)/100*m[s?0:1]),f.clip[u[0]]=a,g.clip[u[0]]=a,g.clip[u[1]]=0,o&&(r.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),r.queue(function(i){d&&d.animate(t.effects.clipToBox(f),c,e.easing).animate(t.effects.clipToBox(g),c,e.easing),i()}).animate(f,c,e.easing).animate(g,c,e.easing).queue(i),t.effects.unshift(r,v,4)}),t.effects.define("highlight","show",function(e,i){var r=t(this),n={backgroundColor:r.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(r),r.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var r,n,o,s=t(this),a=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],u=e.mode,c="effect"!==u,d=e.scale||"both",p=e.origin||["middle","center"],f=s.css("position"),g=s.position(),m=t.effects.scaledDimensions(s),v=e.from||m,y=e.to||t.effects.scaledDimensions(s,0);t.effects.createPlaceholder(s),"show"===u&&(o=v,v=y,y=o),n={from:{y:v.height/m.height,x:v.width/m.width},to:{y:y.height/m.height,x:y.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(v=t.effects.setTransition(s,l,n.from.y,v),y=t.effects.setTransition(s,l,n.to.y,y)),n.from.x!==n.to.x&&(v=t.effects.setTransition(s,h,n.from.x,v),y=t.effects.setTransition(s,h,n.to.x,y))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(v=t.effects.setTransition(s,a,n.from.y,v),y=t.effects.setTransition(s,a,n.to.y,y)),p&&(r=t.effects.getBaseline(p,m),v.top=(m.outerHeight-v.outerHeight)*r.y+g.top,v.left=(m.outerWidth-v.outerWidth)*r.x+g.left,y.top=(m.outerHeight-y.outerHeight)*r.y+g.top,y.left=(m.outerWidth-y.outerWidth)*r.x+g.left),s.css(v),("content"===d||"both"===d)&&(l=l.concat(["marginTop","marginBottom"]).concat(a),h=h.concat(["marginLeft","marginRight"]),s.find("*[width]").each(function(){var i=t(this),r=t.effects.scaledDimensions(i),o={height:r.height*n.from.y,width:r.width*n.from.x,outerHeight:r.outerHeight*n.from.y,outerWidth:r.outerWidth*n.from.x},s={height:r.height*n.to.y,width:r.width*n.to.x,outerHeight:r.height*n.to.y,outerWidth:r.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,l,n.from.y,o),s=t.effects.setTransition(i,l,n.to.y,s)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,h,n.from.x,o),s=t.effects.setTransition(i,h,n.to.x,s)),c&&t.effects.saveStyle(i),i.css(o),i.animate(s,e.duration,e.easing,function(){c&&t.effects.restoreStyle(i)})})),s.animate(y,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=s.offset();0===y.opacity&&s.css("opacity",v.opacity),c||(s.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(s)),i()}})}),t.effects.define("scale",function(e,i){var r=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),s=t.extend(!0,{from:t.effects.scaledDimensions(r),to:t.effects.scaledDimensions(r,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(s.from.opacity=1,s.to.opacity=0),t.effects.effect.size.call(this,s,i)}),t.effects.define("puff","hide",function(e,i){var r=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,r,i)}),t.effects.define("pulsate","show",function(e,i){var r=t(this),n=e.mode,o="show"===n,s="hide"===n,a=o||s,l=2*(e.times||5)+(a?1:0),h=e.duration/l,u=0,c=1,d=r.queue().length;for((o||!r.is(":visible"))&&(r.css("opacity",0).show(),u=1);l>c;c++)r.animate({opacity:u},h,e.easing),u=1-u;r.animate({opacity:u},h,e.easing),r.queue(i),t.effects.unshift(r,d,l+1)}),t.effects.define("shake",function(e,i){var r=1,n=t(this),o=e.direction||"left",s=e.distance||20,a=e.times||3,l=2*a+1,h=Math.round(e.duration/l),u="up"===o||"down"===o?"top":"left",c="up"===o||"left"===o,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[u]=(c?"-=":"+=")+s,p[u]=(c?"+=":"-=")+2*s,f[u]=(c?"-=":"+=")+2*s,n.animate(d,h,e.easing);a>r;r++)n.animate(p,h,e.easing).animate(f,h,e.easing);n.animate(p,h,e.easing).animate(d,h/2,e.easing).queue(i),t.effects.unshift(n,g,l+1)}),t.effects.define("slide","show",function(e,i){var r,n,o=t(this),s={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},a=e.mode,l=e.direction||"left",h="up"===l||"down"===l?"top":"left",u="up"===l||"left"===l,c=e.distance||o["top"===h?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),r=o.cssClip(),n=o.position()[h],d[h]=(u?-1:1)*c+n,d.clip=o.cssClip(),d.clip[s[l][1]]=d.clip[s[l][0]],"show"===a&&(o.cssClip(d.clip),o.css(h,d[h]),d.clip=r,d[h]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});var f;t.uiBackCompat!==!1&&(f=t.effects.define("transfer",function(e,i){t(this).transfer(e,i)})),t.ui.focusable=function(i,r){var n,o,s,a,l,h=i.nodeName.toLowerCase();return"area"===h?(n=i.parentNode,o=n.name,!(!i.href||!o||"map"!==n.nodeName.toLowerCase())&&(s=t("img[usemap='#"+o+"']"),s.length>0&&s.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(h)?(a=!i.disabled,a&&(l=t(i).closest("fieldset")[0],l&&(a=!l.disabled))):a="a"===h?i.href||r:r,a&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function r(e,i,r,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,r&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),s={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?s["inner"+i].call(this):this.each(function(){t(this).css(o,r(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?s["outer"+i].call(this,e):this.each(function(){t(this).css(o,r(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,r,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),r=this.attr("id"),r&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(r)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),r="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return(!r||"static"!==e.css("position"))&&n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),r=null!=i;return(!r||i>=0)&&t.ui.focusable(e,r)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,r=this.options.icons;r&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+r.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,r.header)._addClass(i,null,r.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),void("icons"===t&&(this._destroyIcons(),e&&this._createIcons())))},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,r=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%r];break;case i.LEFT:case i.UP:o=this.headers[(n-1+r)%r];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[r-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,r=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),r=e.next(),n=r.uniqueId().attr("id");e.attr("aria-controls",n),r.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===r?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),r=i.css("position");"absolute"!==r&&"fixed"!==r&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===r&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,r,n=this.options,o=this.active,s=t(e.currentTarget),a=s[0]===o[0],l=a&&n.collapsible,h=l?t():s.next(),u=o.next(),c={oldHeader:o,oldPanel:u,newHeader:l?t():s,newPanel:h};e.preventDefault(),a&&!n.collapsible||this._trigger("beforeActivate",e,c)===!1||(n.active=!l&&this.headers.index(s),this.active=a?t():s,this._toggle(c),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),a||(this._removeClass(s,"ui-accordion-header-collapsed")._addClass(s,"ui-accordion-header-active","ui-state-active"),n.icons&&(r=s.children(".ui-accordion-header-icon"),this._removeClass(r,null,n.icons.header)._addClass(r,null,n.icons.activeHeader)),this._addClass(s.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,r=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=r,this.options.animate?this._animate(i,r,e):(r.hide(),i.show(),this._toggleComplete(e)),r.attr({"aria-hidden":"true"}),r.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&r.length?r.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var r,n,o,s=this,a=0,l=t.css("box-sizing"),h=t.length&&(!e.length||t.index()<e.index()),u=this.options.animate||{},c=h&&u.down||u,d=function(){s._toggleComplete(i)};return"number"==typeof c&&(o=c),"string"==typeof c&&(n=c),n=n||c.easing||u.easing,o=o||c.duration||u.duration,e.length?t.length?(r=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===l&&(a+=i.now):"content"!==s.options.heightStyle&&(i.now=Math.round(r-e.outerHeight()-a),a=0)}})):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),r=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&r.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),r=t(e.currentTarget);i[0]===r[0]&&(this._removeClass(r.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,r))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,r,n,o,s=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:s=!1,r=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===r?o=!0:n=r+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}s&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i,r,n,o,s=this,a=this.options.icons.submenu,l=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),r=l.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),r=t("<span>").data("ui-menu-submenu-caret",!0);s._addClass(r,"ui-menu-icon","ui-icon "+a),i.attr("aria-haspopup","true").prepend(r),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(r,"ui-menu","ui-widget ui-widget-content ui-front"),e=l.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);s._isDivider(e)&&s._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),o=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,r,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),r=this.active.children(".ui-menu-item-wrapper"),this._addClass(r,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,r,n,o,s,a;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-r,o=this.activeMenu.scrollTop(),s=this.activeMenu.height(),a=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+a>s&&this.activeMenu.scrollTop(o+n-s+a))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var r=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(e),this._removeClass(r.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=r},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var r;this.active&&(r="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),r&&r.length&&this.active||(r=this.activeMenu.find(this.options.items)[e]()),this.focus(i,r)},nextPage:function(e){var i,r,n;return this.active?void(this.isLastItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-r-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,r,n;return this.active?void(this.isFirstItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-r+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),r=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return r.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,r,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,s="input"===n;this.isMultiLine=o||!s&&this._isContentEditable(this.element),this.valueMethod=this.element[o||s?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,r=!0,void(i=!0);e=!1,r=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(r){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&r.preventDefault());if(!i){var n=t.ui.keyCode;switch(r.keyCode){case n.PAGE_UP:this._move("previousPage",r);break;case n.PAGE_DOWN:this._move("nextPage",r);break;case n.UP:this._keyEvent("previous",r);break;case n.DOWN:this._keyEvent("next",r)}}},input:function(t){return r?(r=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,
this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var r,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)})):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),r=i.item.attr("aria-label")||n.value,void(r&&t.trim(r).length&&(this.liveRegion.children().hide(),t("<div>").text(r).appendTo(this.liveRegion))))},menuselect:function(e,i){var r=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=r})),!1!==this._trigger("select",e,{item:r})&&this._value(r.value),this.term=this._value(),this.close(e),this.selectedItem=r}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,r=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,r){r(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){r.xhr&&r.xhr.abort(),r.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),r=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!r)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var r=this;t.each(i,function(t,i){r._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var r=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return r.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(r,n){var o,s={};return n?"controlgroupLabel"===r?(o=e.element.find(n),o.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(o.get()))):void(t.fn[r]&&(s=e["_"+r+"Options"]?e["_"+r+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[r]("instance"),a=t.widget.extend({},s);if("button"!==r||!n.parent(".ui-spinner").length){o||(o=n[r]()[r]("instance")),o&&(a.classes=e._resolveClassesValues(a.classes,o)),n[r](a);var l=n[r]("widget");t.data(l[0],"ui-controlgroup-data",o?o:n[r]("instance")),i.push(l[0])}}))):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),r=i.data("ui-controlgroup-data");r&&r[e]&&r[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",r=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,r)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,r={classes:{}};return r.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],r},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:!!e&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var r={};return t.each(e,function(n){var o=i.options.classes[n]||"";o=t.trim(o.replace(g,"")),r[n]=(o+" "+e[n]).replace(/\s+/g," ")}),r},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?void this._callChildMethod(e?"disable":"enable"):void this.refresh()},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,r){var n=e[r]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":r);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[r](),r)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,r=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){r.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,r="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(r):t(r).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),void(this.element[0].disabled=e)):void this.refresh()):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var r="iconPosition"!==e,n=r?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?r&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),r&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?void this._super("showLabel",e):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var m;t.extend(r.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return s(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var r,n,o;r=e.nodeName.toLowerCase(),n="div"===r||"span"===r,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===r?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var r=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var r=t(e);i.append=t([]),i.trigger=t([]),r.hasClass(this.markerClassName)||(this._attachments(r,i),r.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var r,n,o,s=this._get(i,"appendText"),a=this._get(i,"isRTL");i.append&&i.append.remove(),s&&(i.append=t("<span class='"+this._appendClass+"'>"+s+"</span>"),e[a?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),r=this._get(i,"showOn"),("focus"===r||"both"===r)&&e.on("focus",this._showDatepicker),("button"===r||"both"===r)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[a?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,r,n,o=new Date(2009,11,20),s=this._get(t,"dateFormat");s.match(/[DM]/)&&(e=function(t){for(i=0,r=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,r=n);return r},o.setMonth(e(this._get(t,s.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var r=t(e);r.hasClass(this.markerClassName)||(r.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,r,n,o){var a,l,h,u,c,d=this._dialogInst;return d||(this.uuid+=1,a="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+a+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),s(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(l=document.documentElement.clientWidth,h=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+u,h/2-150+c]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=r,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,r=t(e),n=t.data(e,"datepicker");r.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),r.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&r.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,r,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(r=n.children("."+this._inlineClass),r.children().removeClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,r,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(r=n.children("."+this._inlineClass),r.children().addClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,r){var n,o,a,l,h=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):h?"all"===i?t.extend({},h.settings):this._get(h,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=r),void(h&&(this._curInst===h&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),a=this._getMinMaxDate(h,"min"),l=this._getMinMaxDate(h,"max"),s(h.settings,n),null!==a&&void 0!==n.dateFormat&&void 0===n.minDate&&(h.settings.minDate=this._formatDate(h,a)),null!==l&&void 0!==n.dateFormat&&void 0===n.maxDate&&(h.settings.maxDate=this._formatDate(h,l)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),h),this._autoSize(h),this._setDate(h,o),this._updateAlternate(h),this._updateDatepicker(h))))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,r,n,o=t.datepicker._getInst(e.target),s=!0,a=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),s=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(r=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[r,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),s=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),s=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,a?1:-1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),s=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,a?-1:1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),s=e.ctrlKey||e.metaKey;break;default:s=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):s=!1;s&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,r,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),r=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">r||!i||i.indexOf(r)>-1):void 0},_doKeyUp:function(e){var i,r=t.datepicker._getInst(e.target);if(r.input.val()!==r.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(r,"dateFormat"),r.input?r.input.val():null,t.datepicker._getFormatConfig(r)),i&&(t.datepicker._setDateFromField(r),t.datepicker._updateAlternate(r),t.datepicker._updateDatepicker(r))}catch(t){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var r,n,o,a,l,h,u;r=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==r&&(t.datepicker._curInst.dpDiv.stop(!0,!0),r&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(r,"beforeShow"),o=n?n.apply(e,[e,r]):{},o!==!1&&(s(r.settings,o),r.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(r),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),a=!1,t(e).parents().each(function(){return a|="fixed"===t(this).css("position"),!a}),l={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,r.dpDiv.empty(),r.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(r),l=t.datepicker._checkOffset(r,l,a),r.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":a?"fixed":"absolute",display:"none",left:l.left+"px",top:l.top+"px"}),r.inline||(h=t.datepicker._get(r,"showAnim"),u=t.datepicker._get(r,"duration"),r.dpDiv.css("z-index",i(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[h]?r.dpDiv.show(h,t.datepicker._get(r,"showOptions"),u):r.dpDiv[h||"show"](h?u:null),t.datepicker._shouldFocusInput(r)&&r.input.trigger("focus"),t.datepicker._curInst=r))}},_updateDatepicker:function(e){this.maxRows=4,m=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,r=this._getNumberOfMonths(e),n=r[1],s=17,a=e.dpDiv.find("."+this._dayOverClass+" a");a.length>0&&o.apply(a.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",s*n+"em"),e.dpDiv[(1!==r[0]||1!==r[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,r){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,a=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(r?0:t(document).scrollLeft()),h=document.documentElement.clientHeight+(r?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-s:0,
i.left-=r&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=r&&i.top===e.input.offset().top+a?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+o>h&&h>o?Math.abs(o+a):0),i},_findPos:function(e){for(var i,r=this._getInst(e),n=this._get(r,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,r,n,o,s=this._curInst;!s||e&&s!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(s,"showAnim"),r=this._get(s,"duration"),n=function(){t.datepicker._tidyDialog(s)},t.effects&&(t.effects.effect[i]||t.effects[i])?s.dpDiv.hide(i,t.datepicker._get(s,"showOptions"),r,n):s.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?r:null,n),i||n(),this._datepickerShowing=!1,o=this._get(s,"onClose"),o&&o.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),r=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==r)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,r){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===r?this._get(o,"showCurrentAtPos"):0),r),this._updateDatepicker(o))},_gotoToday:function(e){var i,r=t(e),n=this._getInst(r[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(r)},_selectMonthYear:function(e,i,r){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===r?"Month":"Year")]=o["draw"+("M"===r?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,r,n){var o,s=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||(o=this._getInst(s[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=r,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var r,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),r=this._get(o,"onSelect"),r?r.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,r,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),r=this._getDate(e),n=this.formatDate(i,r,this._getFormatConfig(e)),t(o).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,r){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,o,s,a,l=0,h=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),c=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,d=(r?r.dayNames:null)||this._defaults.dayNames,p=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,f=(r?r.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,v=-1,y=-1,b=!1,x=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},C=function(t){var e=x(t),r="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?r:1,o=RegExp("^\\d{"+n+","+r+"}"),s=i.substring(l).match(o);if(!s)throw"Missing number at position "+l;return l+=s[0].length,parseInt(s[0],10)},_=function(e,r,n){var o=-1,s=t.map(x(e)?n:r,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(s,function(t,e){var r=e[1];return i.substr(l,r.length).toLowerCase()===r.toLowerCase()?(o=e[0],l+=r.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+l},w=function(){if(i.charAt(l)!==e.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||x("'")?w():b=!1;else switch(e.charAt(n)){case"d":v=C("d");break;case"D":_("D",c,d);break;case"o":y=C("o");break;case"m":m=C("m");break;case"M":m=_("M",p,f);break;case"y":g=C("y");break;case"@":a=new Date(C("@")),g=a.getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"!":a=new Date((C("!")-this._ticksTo1970)/1e4),g=a.getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"'":x("'")?w():b=!0;break;default:w()}if(i.length>l&&(s=i.substr(l),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=g?0:-100)),y>-1)for(m=1,v=y;o=this._getDaysInMonth(g,m-1),!(o>=v);)m++,v-=o;if(a=this._daylightSavingAdjust(new Date(g,m-1,v)),a.getFullYear()!==g||a.getMonth()+1!==m||a.getDate()!==v)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var r,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=function(e){var i=t.length>r+1&&t.charAt(r+1)===e;return i&&r++,i},h=function(t,e,i){var r=""+e;if(l(t))for(;i>r.length;)r="0"+r;return r},u=function(t,e,i,r){return l(t)?r[e]:i[e]},c="",d=!1;if(e)for(r=0;t.length>r;r++)if(d)"'"!==t.charAt(r)||l("'")?c+=t.charAt(r):d=!1;else switch(t.charAt(r)){case"d":c+=h("d",e.getDate(),2);break;case"D":c+=u("D",e.getDay(),n,o);break;case"o":c+=h("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=h("m",e.getMonth()+1,2);break;case"M":c+=u("M",e.getMonth(),s,a);break;case"y":c+=l("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":c+=e.getTime();break;case"!":c+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?c+="'":d=!0;break;default:c+=t.charAt(r)}return c},_possibleChars:function(t){var e,i="",r=!1,n=function(i){var r=t.length>e+1&&t.charAt(e+1)===i;return r&&e++,r};for(e=0;t.length>e;e++)if(r)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):r=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":r=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),r=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,s=this._getFormatConfig(t);try{o=this.parseDate(i,r,s)||n}catch(t){r=e?"":r}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=r?o.getDate():0,t.currentMonth=r?o.getMonth():0,t.currentYear=r?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,r){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(t){}for(var r=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,n=r.getFullYear(),o=r.getMonth(),s=r.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=a.exec(i);l;){switch(l[2]||"d"){case"d":case"D":s+=parseInt(l[1],10);break;case"w":case"W":s+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),s=Math.min(s,t.datepicker._getDaysInMonth(n,o));break;case"y":case"Y":n+=parseInt(l[1],10),s=Math.min(s,t.datepicker._getDaysInMonth(n,o))}l=a.exec(i)}return new Date(n,o,s)},s=null==i||""===i?r:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?r:n(i):new Date(i.getTime());return s=s&&"Invalid Date"==""+s?r:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var r=!e,n=t.selectedMonth,o=t.selectedYear,s=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=s.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=s.getMonth(),t.drawYear=t.selectedYear=t.currentYear=s.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(r?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),r="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(r,-i,"M")},next:function(){t.datepicker._adjustDate(r,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(r)},selectDay:function(){return t.datepicker._selectDay(r,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(r,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(r,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,r,n,o,s,a,l,h,u,c,d,p,f,g,m,v,y,b,x,C,_,w,T,A,I,M,S,P,E,R,k,D,L,N,F,O,B,U,z=new Date,j=this._daylightSavingAdjust(new Date(z.getFullYear(),z.getMonth(),z.getDate())),G=this._get(t,"isRTL"),H=this._get(t,"showButtonPanel"),W=this._get(t,"hideIfNoPrevNext"),Y=this._get(t,"navigationAsDateFormat"),V=this._getNumberOfMonths(t),q=this._get(t,"showCurrentAtPos"),X=this._get(t,"stepMonths"),Z=1!==V[0]||1!==V[1],K=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(t,"min"),Q=this._getMinMaxDate(t,"max"),$=t.drawMonth-q,tt=t.drawYear;if(0>$&&($+=12,tt--),Q)for(e=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-V[0]*V[1]+1,Q.getDate())),e=J&&J>e?J:e;this._daylightSavingAdjust(new Date(tt,$,1))>e;)$--,0>$&&($=11,tt--);for(t.drawMonth=$,t.drawYear=tt,i=this._get(t,"prevText"),i=Y?this.formatDate(i,this._daylightSavingAdjust(new Date(tt,$-X,1)),this._getFormatConfig(t)):i,r=this._canAdjustMonth(t,-1,tt,$)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"e":"w")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=Y?this.formatDate(n,this._daylightSavingAdjust(new Date(tt,$+X,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,tt,$)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"w":"e")+"'>"+n+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"w":"e")+"'>"+n+"</span></a>",s=this._get(t,"currentText"),a=this._get(t,"gotoCurrent")&&t.currentDay?K:j,s=Y?this.formatDate(s,a,this._getFormatConfig(t)):s,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",h=H?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(G?l:"")+(this._isInRange(t,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(G?"":l)+"</div>":"",u=parseInt(this._get(t,"firstDay"),10),u=isNaN(u)?0:u,c=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),y=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),x="",_=0;V[0]>_;_++){for(w="",this.maxRows=4,T=0;V[1]>T;T++){if(A=this._daylightSavingAdjust(new Date(tt,$,t.selectedDay)),I=" ui-corner-all",M="",Z){if(M+="<div class='ui-datepicker-group",V[1]>1)switch(T){case 0:M+=" ui-datepicker-group-first",I=" ui-corner-"+(G?"right":"left");break;case V[1]-1:M+=" ui-datepicker-group-last",I=" ui-corner-"+(G?"left":"right");break;default:M+=" ui-datepicker-group-middle",I=""}M+="'>"}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===_?G?o:r:"")+(/all|right/.test(I)&&0===_?G?r:o:"")+this._generateMonthYearHeader(t,$,tt,J,Q,_>0||T>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",S=c?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",C=0;7>C;C++)P=(C+u)%7,S+="<th scope='col'"+((C+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[P]+"'>"+p[P]+"</span></th>";for(M+=S+"</tr></thead><tbody>",E=this._getDaysInMonth(tt,$),tt===t.selectedYear&&$===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,E)),R=(this._getFirstDayOfMonth(tt,$)-u+7)%7,k=Math.ceil((R+E)/7),D=Z&&this.maxRows>k?this.maxRows:k,this.maxRows=D,L=this._daylightSavingAdjust(new Date(tt,$,1-R)),N=0;D>N;N++){for(M+="<tr>",F=c?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(L)+"</td>":"",C=0;7>C;C++)O=m?m.apply(t.input?t.input[0]:null,[L]):[!0,""],B=L.getMonth()!==$,U=B&&!y||!O[0]||J&&J>L||Q&&L>Q,F+="<td class='"+((C+u+6)%7>=5?" ui-datepicker-week-end":"")+(B?" ui-datepicker-other-month":"")+(L.getTime()===A.getTime()&&$===t.selectedMonth&&t._keyEvent||b.getTime()===L.getTime()&&b.getTime()===A.getTime()?" "+this._dayOverClass:"")+(U?" "+this._unselectableClass+" ui-state-disabled":"")+(B&&!v?"":" "+O[1]+(L.getTime()===K.getTime()?" "+this._currentClass:"")+(L.getTime()===j.getTime()?" ui-datepicker-today":""))+"'"+(B&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(U?"":" data-handler='selectDay' data-event='click' data-month='"+L.getMonth()+"' data-year='"+L.getFullYear()+"'")+">"+(B&&!v?"&#xa0;":U?"<span class='ui-state-default'>"+L.getDate()+"</span>":"<a class='ui-state-default"+(L.getTime()===j.getTime()?" ui-state-highlight":"")+(L.getTime()===K.getTime()?" ui-state-active":"")+(B?" ui-priority-secondary":"")+"' href='#'>"+L.getDate()+"</a>")+"</td>",L.setDate(L.getDate()+1),L=this._daylightSavingAdjust(L);M+=F+"</tr>"}$++,$>11&&($=0,tt++),M+="</tbody></table>"+(Z?"</div>"+(V[0]>0&&T===V[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),w+=M}x+=w}return x+=h,t._keyEvent=!1,x},_generateMonthYearHeader:function(t,e,i,r,n,o,s,a){var l,h,u,c,d,p,f,g,m=this._get(t,"changeMonth"),v=this._get(t,"changeYear"),y=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",x="";if(o||!m)x+="<span class='ui-datepicker-month'>"+s[e]+"</span>";else{for(l=r&&r.getFullYear()===i,h=n&&n.getFullYear()===i,x+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!l||u>=r.getMonth())&&(!h||n.getMonth()>=u)&&(x+="<option value='"+u+"'"+(u===e?" selected='selected'":"")+">"+a[u]+"</option>");x+="</select>"}if(y||(b+=x+(!o&&m&&v?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(c=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(c[0]),g=Math.max(f,p(c[1]||"")),f=r?Math.max(f,r.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),y&&(b+=(!o&&m&&v?"":"&#xa0;")+x),b+="</div>"},_adjustInstDate:function(t,e,i){var r=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(r,n))+("D"===i?e:0),s=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(r,n,o)));t.selectedDay=s.getDate(),t.drawMonth=t.selectedMonth=s.getMonth(),t.drawYear=t.selectedYear=s.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),r=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return r&&n>r?r:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,r){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,r+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,r,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),s=null,a=null,l=this._get(t,"yearRange");return l&&(i=l.split(":"),r=(new Date).getFullYear(),s=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(s+=r),i[1].match(/[+\-].*/)&&(a+=r)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!s||e.getFullYear()>=s)&&(!a||a>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,r){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(r,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new r,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var v=!1;t(document).on("mouseup",function(){v=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!v){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,r=1===e.which,n=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return!(r&&!n&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),v=!0,!0))}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,v=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,r){var n,o=t.ui[e].prototype;for(n in r)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,r[n]])},call:function(t,e,i,r){var n,o=t.plugins[e];if(o&&(r||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.options;return!(this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(e),!!this.handle&&(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),r=t(e.target);r.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var r=this._uiHash();if(this._trigger("drag",e,r)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=r.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,r=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(r=t.ui.ddmanager.drop(this,e)),this.dropped&&(r=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,r=t.isFunction(i.helper),n=r?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),r&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,r,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===n.containment?void(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):n.containment.constructor===Array?void(this.containment=n.containment):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),r=i[0],void(r&&(e=/(scroll|auto)/.test(i.css("overflow")),
this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,r=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,r,n,o,s=this.options,a=this._isRootNode(this.scrollParent[0]),l=t.pageX,h=t.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(r=this.relativeContainer.offset(),i=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),s.grid&&(n=s.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-s.grid[1]:n+s.grid[1]:n,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-s.grid[0]:o+s.grid[0]:o),"y"===s.axis&&(l=this.originalPageX),"x"===s.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,r){return r=r||this._uiHash(),t.ui.plugin.call(this,e,[i,r,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),r.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,r){var n=t.extend({},i,{item:r.element});r.sortables=[],t(r.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(r.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,r){var n=t.extend({},i,{item:r.element});r.cancelHelperRemoval=!1,t.each(r.sortables,function(){var t=this;t.isOver?(t.isOver=0,r.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,r){t.each(r.sortables,function(){var n=!1,o=this;o.positionAbs=r.positionAbs,o.helperProportions=r.helperProportions,o.offset.click=r.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(r.sortables,function(){return this.positionAbs=r.positionAbs,this.helperProportions=r.helperProportions,this.offset.click=r.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,r._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=r.offset.click.top,o.offset.click.left=r.offset.click.left,o.offset.parent.left-=r.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=r.offset.parent.top-o.offset.parent.top,r._trigger("toSortable",e),r.dropped=o.element,t.each(r.sortables,function(){this.refreshPositions()}),r.currentItem=r.element,o.fromOutside=r),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(r._parent),r._refreshOffsets(e),i.position=r._generatePosition(e,!0),r._trigger("fromSortable",e),r.dropped=!1,t.each(r.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,r){var n=t("body"),o=r.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,r){var n=r.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,r){var n=t(i.helper),o=r.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,r){var n=r.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,r){var n=r.options,o=!1,s=r.scrollParentNotHidden[0],a=r.document[0];s!==a&&"HTML"!==s.tagName?(n.axis&&"x"===n.axis||(r.overflowOffset.top+s.offsetHeight-e.pageY<n.scrollSensitivity?s.scrollTop=o=s.scrollTop+n.scrollSpeed:e.pageY-r.overflowOffset.top<n.scrollSensitivity&&(s.scrollTop=o=s.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(r.overflowOffset.left+s.offsetWidth-e.pageX<n.scrollSensitivity?s.scrollLeft=o=s.scrollLeft+n.scrollSpeed:e.pageX-r.overflowOffset.left<n.scrollSensitivity&&(s.scrollLeft=o=s.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(a).scrollTop()<n.scrollSensitivity?o=t(a).scrollTop(t(a).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(a).scrollTop())<n.scrollSensitivity&&(o=t(a).scrollTop(t(a).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(a).scrollLeft()<n.scrollSensitivity?o=t(a).scrollLeft(t(a).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(a).scrollLeft())<n.scrollSensitivity&&(o=t(a).scrollLeft(t(a).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(r,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,r){var n=r.options;r.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==r.element[0]&&r.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,r){var n,o,s,a,l,h,u,c,d,p,f=r.options,g=f.snapTolerance,m=i.offset.left,v=m+r.helperProportions.width,y=i.offset.top,b=y+r.helperProportions.height;for(d=r.snapElements.length-1;d>=0;d--)l=r.snapElements[d].left-r.margins.left,h=l+r.snapElements[d].width,u=r.snapElements[d].top-r.margins.top,c=u+r.snapElements[d].height,l-g>v||m>h+g||u-g>b||y>c+g||!t.contains(r.snapElements[d].item.ownerDocument,r.snapElements[d].item)?(r.snapElements[d].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,e,t.extend(r._uiHash(),{snapItem:r.snapElements[d].item})),r.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(u-b),o=g>=Math.abs(c-y),s=g>=Math.abs(l-v),a=g>=Math.abs(h-m),n&&(i.position.top=r._convertPositionTo("relative",{top:u-r.helperProportions.height,left:0}).top),o&&(i.position.top=r._convertPositionTo("relative",{top:c,left:0}).top),s&&(i.position.left=r._convertPositionTo("relative",{top:0,left:l-r.helperProportions.width}).left),a&&(i.position.left=r._convertPositionTo("relative",{top:0,left:h}).left)),p=n||o||s||a,"outer"!==f.snapMode&&(n=g>=Math.abs(u-y),o=g>=Math.abs(c-b),s=g>=Math.abs(l-m),a=g>=Math.abs(h-v),n&&(i.position.top=r._convertPositionTo("relative",{top:u,left:0}).top),o&&(i.position.top=r._convertPositionTo("relative",{top:c-r.helperProportions.height,left:0}).top),s&&(i.position.left=r._convertPositionTo("relative",{top:0,left:l}).left),a&&(i.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left)),!r.snapElements[d].snapping&&(n||o||s||a||p)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,e,t.extend(r._uiHash(),{snapItem:r.snapElements[d].item})),r.snapElements[d].snapping=n||o||s||a||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,r){var n,o=r.options,s=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});s.length&&(n=parseInt(t(s[0]).css("zIndex"),10)||0,t(s).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+s.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,r){var n=t(i.helper),o=r.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,r){var n=r.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var r=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[r]>0||(e[r]=1,n=e[r]>0,e[r]=0,n)},_create:function(){var e,i=this.options,r=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(r._removeClass("ui-resizable-autohide"),r._handles.show())}).on("mouseleave",function(){i.disabled||r.resizing||(r._addClass("ui-resizable-autohide"),r._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var e,i,r,n,o,s=this.options,a=this;if(this.handles=s.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),r=this.handles.split(","),this.handles={},i=0;r.length>i;i++)e=t.trim(r[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:s.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,r,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(r=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?r.outerHeight():r.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){a.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=o&&o[1]?o[1]:"se")}),s.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,r,n=!1;for(i in this.handles)r=t(this.handles[i])[0],(r===e.target||t.contains(r,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,r,n,o=this.options,s=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),r=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,r+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:r},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalPosition={left:i,top:r},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,r,n=this.originalMousePosition,o=this.axis,s=e.pageX-n.left||0,a=e.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[e,s,a]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),r=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(r)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1)},_mouseStop:function(e){this.resizing=!1;var i,r,n,o,s,a,l,h=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,r=i.length&&/textarea/i.test(i[0].nodeName),n=r&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,o=r?0:u.sizeDiff.width,s={width:u.helper.width()-o,height:u.helper.height()-n},a=parseFloat(u.element.css("left"))+(u.position.left-u.originalPosition.left)||null,l=parseFloat(u.element.css("top"))+(u.position.top-u.originalPosition.top)||null,h.animate||this.element.css(t.extend(s,{top:l,left:a})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,r,n,o,s=this.options;o={minWidth:this._isNumber(s.minWidth)?s.minWidth:0,maxWidth:this._isNumber(s.maxWidth)?s.maxWidth:1/0,minHeight:this._isNumber(s.minHeight)?s.minHeight:0,maxHeight:this._isNumber(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,r=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),r>o.minHeight&&(o.minHeight=r),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,r=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===r&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===r&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,r=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,s=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,a=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,h=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),s&&(t.height=e.minHeight),r&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&h&&(t.left=a-e.minWidth),r&&h&&(t.left=a-e.maxWidth),s&&u&&(t.top=l-e.minHeight),n&&u&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],r=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(r[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,r=this.originalPosition;return{left:r.left+e,width:i.width-e}},n:function(t,e,i){var r=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:r.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,r){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,r]))},sw:function(e,i,r){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,r]))},ne:function(e,i,r){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,r]))},nw:function(e,i,r){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,r]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),r=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),s=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,a=o?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},h=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,u=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,u&&h?{top:u,left:h}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:r.width,height:r.height}),i._updateCache(r),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,r,n,o,s,a,l=t(this).resizable("instance"),h=l.options,u=l.element,c=h.containment,d=c instanceof t?c.get(0):/parent/.test(c)?u.parent().get(0):c;d&&(l.containerElement=t(d),/document/.test(c)||c===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,r){i[t]=l._num(e.css("padding"+r))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},r=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,s=l._hasScroll(d,"left")?d.scrollWidth:o,a=l._hasScroll(d)?d.scrollHeight:n,l.parentData={element:d,left:r.left,top:r.top,width:s,height:a}))},resize:function(e){var i,r,n,o,s=t(this).resizable("instance"),a=s.options,l=s.containerOffset,h=s.position,u=s._aspectRatio||e.shiftKey,c={top:0,left:0},d=s.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(c=l),h.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-c.left),u&&(s.size.height=s.size.width/s.aspectRatio,p=!1),s.position.left=a.helper?l.left:0),h.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),u&&(s.size.width=s.size.height*s.aspectRatio,p=!1),s.position.top=s._helper?l.top:0),n=s.containerElement.get(0)===s.element.parent().get(0),o=/relative|absolute/.test(s.containerElement.css("position")),n&&o?(s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top):(s.offset.left=s.element.offset().left,s.offset.top=s.element.offset().top),i=Math.abs(s.sizeDiff.width+(s._helper?s.offset.left-c.left:s.offset.left-l.left)),r=Math.abs(s.sizeDiff.height+(s._helper?s.offset.top-c.top:s.offset.top-l.top)),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,u&&(s.size.height=s.size.width/s.aspectRatio,p=!1)),r+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-r,u&&(s.size.width=s.size.height*s.aspectRatio,p=!1)),p||(s.position.left=s.prevPosition.left,s.position.top=s.prevPosition.top,s.size.width=s.prevSize.width,s.size.height=s.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,r=e.containerOffset,n=e.containerPosition,o=e.containerElement,s=t(e.helper),a=s.offset(),l=s.outerWidth()-e.sizeDiff.width,h=s.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:a.left-n.left-r.left,width:l,height:h}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:a.left-n.left-r.left,width:l,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var r=t(this).resizable("instance"),n=r.options,o=r.originalSize,s=r.originalPosition,a={height:r.size.height-o.height||0,width:r.size.width-o.width||0,top:r.position.top-s.top||0,left:r.position.left-s.left||0};t(n.alsoResize).each(function(){var e=t(this),r=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(r[e]||0)+(a[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),r=i.options,n=i.size,o=i.originalSize,s=i.originalPosition,a=i.axis,l="number"==typeof r.grid?[r.grid,r.grid]:r.grid,h=l[0]||1,u=l[1]||1,c=Math.round((n.width-o.width)/h)*h,d=Math.round((n.height-o.height)/u)*u,p=o.width+c,f=o.height+d,g=r.maxWidth&&p>r.maxWidth,m=r.maxHeight&&f>r.maxHeight,v=r.minWidth&&r.minWidth>p,y=r.minHeight&&r.minHeight>f;r.grid=l,v&&(p+=h),y&&(f+=u),g&&(p-=h),m&&(f-=u),/^(se|s|e)$/.test(a)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(a)?(i.size.width=p,i.size.height=f,i.position.top=s.top-d):/^(sw)$/.test(a)?(i.size.width=p,i.size.height=f,i.position.left=s.left-c):((0>=f-u||0>=p-h)&&(e=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=s.top-d):(f=u-e.height,i.size.height=f,i.position.top=s.top+o.height-f),p-h>0?(i.size.width=p,i.position.left=s.left-c):(p=h-e.width,i.size.width=p,i.position.left=s.left+o.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var r=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),r=!0),r&&!i&&this._trigger("focus",e),r},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),
t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),r=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==r[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){r.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(t.each(i,function(i,r){var n,o;r=t.isFunction(r)?{click:r,text:i}:r,r=t.extend({type:"button"},r),n=r.click,o={icon:r.icon,iconPosition:r.iconPosition,showLabel:r.showLabel,icons:r.icons,text:r.text},delete r.click,delete r.icon,delete r.iconPosition,delete r.showLabel,delete r.icons,"boolean"==typeof r.text&&delete r.text,t("<button></button>",r).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,r=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(r,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",r,e(n))},drag:function(t,r){i._trigger("drag",t,e(r))},stop:function(n,o){var s=o.offset.left-i.document.scrollLeft(),a=o.offset.top-i.document.scrollTop();r.position={my:"left top",at:"left"+(s>=0?"+":"")+s+" top"+(a>=0?"+":"")+a,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,r=this.options,n=r.resizable,o=this.uiDialog.css("position"),s="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:this._minHeight(),handles:s,start:function(r,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",r,e(n))},resize:function(t,r){i._trigger("resize",t,e(r))},stop:function(n,o){var s=i.uiDialog.offset(),a=s.left-i.document.scrollLeft(),l=s.top-i.document.scrollTop();r.height=i.uiDialog.height(),r.width=i.uiDialog.width(),r.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(l>=0?"+":"")+l,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,r=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(r=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),r&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var r,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(r=o.is(":data(ui-draggable)"),r&&!i&&o.draggable("destroy"),!r&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=o.is(":data(ui-resizable)"),n&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),t=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),e=Math.max(0,r.minHeight-t),i="number"==typeof r.maxHeight?Math.max(0,r.maxHeight-t):"none","auto"===r.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,r.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,r=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(r)?r:function(t){return t.is(r)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var r=t.ui.ddmanager.droppables[this.options.scope];this._splice(r),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var r=i||t.ui.ddmanager.current,n=!1;return!(!r||(r.currentItem||r.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===r.options.scope&&i.accept.call(i.element[0],r.currentItem||r.element)&&y(r,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),!n&&(!!this.accept.call(this.element[0],r.currentItem||r.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(r)),this.element)))},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var y=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,r,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,s=(e.positionAbs||e.position.absolute).top+e.margins.top,a=o+e.helperProportions.width,l=s+e.helperProportions.height,h=i.offset.left,u=i.offset.top,c=h+i.proportions().width,d=u+i.proportions().height;switch(r){case"fit":return o>=h&&c>=a&&s>=u&&d>=l;case"intersect":return o+e.helperProportions.width/2>h&&c>a-e.helperProportions.width/2&&s+e.helperProportions.height/2>u&&d>l-e.helperProportions.height/2;case"pointer":return t(n.pageY,u,i.proportions().height)&&t(n.pageX,h,i.proportions().width);case"touch":return(s>=u&&d>=s||l>=u&&d>=l||u>s&&l>d)&&(o>=h&&c>=o||a>=h&&c>=a||h>o&&a>c);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,i){var r,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],s=i?i.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(r=0;o.length>r;r++)if(!(o[r].options.disabled||e&&!o[r].accept.call(o[r].element[0],e.currentItem||e.element))){for(n=0;a.length>n;n++)if(a[n]===o[r].element[0]){o[r].proportions().height=0;continue t}o[r].visible="none"!==o[r].element.css("display"),o[r].visible&&("mousedown"===s&&o[r]._activate.call(o[r],i),o[r].offset=o[r].element.offset(),o[r].proportions({width:o[r].element[0].offsetWidth,height:o[r].element[0].offsetHeight}))}},drop:function(e,i){var r=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&y(e,this,this.options.tolerance,i)&&(r=this._drop.call(this,i)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),r},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,n,o,s=y(e,this,this.options.tolerance,i),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(r=t(o[0]).droppable("instance"),r.greedyChild="isover"===a)),r&&"isover"===a&&(r.isover=!1,r.isout=!0,r._out.call(r,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),r&&"isout"===a&&(r.isout=!1,r.isover=!0,r._over.call(r,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),void this._refreshValue())},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),r=i.offset(),n={left:r.left-e.elementPos.left,top:r.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,r=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(r.filter,this.element[0]),this._trigger("start",e),t(r.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=t.data(this,"selectable-item");r.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(r.$element,"ui-selected"),r.selected=!1,i._addClass(r.$element,"ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",e,{unselecting:r.element}))}),t(e.target).parents().addBack().each(function(){var r,n=t.data(this,"selectable-item");return n?(r=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,r?"ui-unselecting":"ui-selected")._addClass(n.$element,r?"ui-selecting":"ui-unselecting"),n.unselecting=!r,n.selecting=r,n.selected=r,r?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,r=this,n=this.options,o=this.opos[0],s=this.opos[1],a=e.pageX,l=e.pageY;return o>a&&(i=a,a=o,o=i),s>l&&(i=l,l=s,s=i),this.helper.css({left:o,top:s,width:a-o,height:l-s}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1,u={};i&&i.element!==r.element[0]&&(u.left=i.left+r.elementPos.left,u.right=i.right+r.elementPos.left,u.top=i.top+r.elementPos.top,u.bottom=i.bottom+r.elementPos.top,"touch"===n.tolerance?h=!(u.left>a||o>u.right||u.top>l||s>u.bottom):"fit"===n.tolerance&&(h=u.left>o&&a>u.right&&u.top>s&&l>u.bottom),h?(i.selected&&(r._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(r._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(r._addClass(i.$element,"ui-selecting"),i.selecting=!0,r._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(r._removeClass(i.$element,"ui-selecting"),i.selecting=!1,r._addClass(i.$element,"ui-selected"),i.selected=!0):(r._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(r._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),r._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(r._removeClass(i.$element,"ui-selected"),i.selected=!1,r._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var r=t.data(this,"selectable-item");i._removeClass(r.$element,"ui-unselecting"),r.unselecting=!1,r.startselected=!1,i._trigger("unselected",e,{unselected:r.element})}),t(".ui-selecting",this.element[0]).each(function(){var r=t.data(this,"selectable-item");i._removeClass(r.$element,"ui-selecting")._addClass(r.$element,"ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,i._trigger("selected",e,{selected:r.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,r=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(r).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var r=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&r.index!==e.focusIndex&&(e._trigger("focus",t,{item:r}),e.isOpen||e._select(r,t)),e.focusIndex=r.index,e.button.attr("aria-activedescendant",e.menuItems.eq(r.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var r=this,n="";t.each(i,function(i,o){var s;o.optgroup!==n&&(s=t("<li>",{text:o.optgroup}),r._addClass(s,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),s.appendTo(e),n=o.optgroup),r._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var r=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(r,null,"ui-state-disabled"),this._setText(n,i.label),r.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,r,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),r="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),r.length&&this.menuInstance.focus(e,r)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return t===!1?void this.button.css("width",""):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),void this.button.outerWidth(t))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,r=[];e.each(function(e,n){r.push(i._parseOption(t(n),e))}),this.items=r},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,r=this.options,n=this.element.find(".ui-slider-handle"),o="<span tabindex='0'></span>",s=[];for(i=r.values&&r.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)s.push(o);this.handles=n.add(t(s.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),
this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,r,n,o,s,a,l,h,u=this,c=this.options;return!c.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},r=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(r-u.values(e));(n>i||n===i&&(e===u._lastChangedValue||u.values(e)===c.min))&&(n=i,o=t(this),s=e)}),a=this._start(e,s),a!==!1&&(this._mouseSliding=!0,this._handleIndex=s,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),l=o.offset(),h=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-o.width()/2,top:e.pageY-l.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,s,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,r,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=i/e,r>1&&(r=1),0>r&&(r=0),"vertical"===this.orientation&&(r=1-r),n=this._valueMax()-this._valueMin(),o=this._valueMin()+r*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var r={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(r.value=void 0!==e?e:this.values(t),r.values=i||this.values()),r},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var r,n,o=this.value(),s=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),s[e]=i),i!==o&&(r=this._trigger("slide",t,this._uiHash(e,i,s)),r!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var r,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(r=this.options.values,n=arguments[0],o=0;r.length>o;o+=1)r[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var r,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=n-1;r>=0;r--)this._change(null,r);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,r;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),r=0;i.length>r;r+=1)i[r]=this._trimAlignValue(i[r]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,r=t-i;return 2*Math.abs(i)>=e&&(r+=i>0?e:-e),parseFloat(r.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,r=Math.round((t-e)/i)*i;t=r+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,r,n,o,s=this.options.range,a=this.options,l=this,h=!this._animateOff&&a.animate,u={};this._hasMultipleValues()?this.handles.each(function(r){i=100*((l.values(r)-l._valueMin())/(l._valueMax()-l._valueMin())),u["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](u,a.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===r&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},a.animate),1===r&&l.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:a.animate})):(0===r&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},a.animate),1===r&&l.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:a.animate}))),e=i}):(r=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((r-n)/(o-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](u,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:100-i+"%"},a.animate),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:100-i+"%"},a.animate))},_handleEvents:{keydown:function(e){var i,r,n,o,s=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,s),i===!1))return}switch(o=this.options.step,r=n=this._hasMultipleValues()?this.values(s):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(r+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(r-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(r===this._valueMax())return;n=this._trimAlignValue(r+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(r===this._valueMin())return;n=this._trimAlignValue(r-o)}this._slide(e,s,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var r=null,n=!1,o=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(r=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(r=t(e.target)),!!r&&(!(this.options.handle&&!i&&(t(this.options.handle,r).find("*").addBack().each(function(){this===e.target&&(n=!0)}),!n))&&(this.currentItem=r,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,r){var n,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=t("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,r,n,o,s=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(e.pageY-this.document.scrollTop()<s.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-s.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<s.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+s.scrollSpeed)),e.pageX-this.document.scrollLeft()<s.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-s.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<s.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+s.scrollSpeed))),a!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(r=this.items[i],n=r.item[0],o=this._intersectsWithPointer(r),o&&r.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],n))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(e,r),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var r=this,n=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){r._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&r.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!r.length&&e.key&&r.push(e.key+"="),r.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},i.each(function(){r.push(t(e.item||this).attr(e.attribute||"id")||"")}),r},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,r=this.positionAbs.top,n=r+this.helperProportions.height,o=t.left,s=o+t.width,a=t.top,l=a+t.height,h=this.offset.click.top,u=this.offset.click.left,c="x"===this.options.axis||r+h>a&&l>r+h,d="y"===this.options.axis||e+u>o&&s>e+u,p=c&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&s>i-this.helperProportions.width/2&&r+this.helperProportions.height/2>a&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,r="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=r&&n;return!!o&&(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:r&&("down"===r&&e||"up"===r&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){a.push(this)}var r,n,o,s,a=[],l=[],h=this._connectWith();if(h&&e)for(r=h.length-1;r>=0;r--)for(o=t(h[r],this.document[0]),n=o.length-1;n>=0;n--)s=t.data(o[n],this.widgetFullName),s&&s!==this&&!s.options.disabled&&l.push([t.isFunction(s.options.items)?s.options.items.call(s.element):t(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=l.length-1;r>=0;r--)l[r][0].each(i);return t(a)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,r,n,o,s,a,l,h,u=this.items,c=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),r=n.length-1;r>=0;r--)o=t.data(n[r],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(c.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=c.length-1;i>=0;i--)for(s=c[i][1],a=c[i][0],r=0,h=a.length;h>r;r++)l=t(a[r]),l.data(this.widgetName+"-item",s),u.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,r,n,o;for(i=this.items.length-1;i>=0;i--)r=this.items[i],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,r.item):r.item,e||(r.width=n.outerWidth(),r.height=n.outerHeight()),o=n.offset(),r.left=o.left,r.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,r=e.options;r.placeholder&&r.placeholder.constructor!==String||(i=r.placeholder,r.placeholder={element:function(){var r=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+r+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===r?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===r?e._createTrPlaceholder(e.currentItem,n):"img"===r&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||r.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(r.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),r.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var r=this;e.children().each(function(){t("<td>&#160;</td>",r.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,r,n,o,s,a,l,h,u,c,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,u=d.floating||this._isFloating(this.currentItem),s=u?"left":"top",a=u?"width":"height",c=u?"pageX":"pageY",r=this.items.length-1;r>=0;r--)t.contains(this.containers[p].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(l=this.items[r].item.offset()[s],h=!1,e[c]-l>this.items[r][a]/2&&(h=!0),n>Math.abs(e[c]-l)&&(n=Math.abs(e[c]-l),o=this.items[r],this.direction=h?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,r=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||i.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||i.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,r,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),r="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(r?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(r?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var r="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*r}},_generatePosition:function(e){var i,r,n=this.options,o=e.pageX,s=e.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/n.grid[1])*n.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,r=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-n.grid[0]:r+n.grid[0]:r)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(t,e,i,r){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!r)})},_clear:function(t,e){function i(t,e,i){return function(r){i._trigger(t,r,e._uiHash(e))}}this.reverting=!1;var r,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)("auto"===this._storedCSS[r]||"static"===this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){
this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--)e||n.push(i("deactivate",this,this.containers[r])),this.containers[r].containerCache.over&&(n.push(i("out",this,this.containers[r])),this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(r=0;n.length>r;r++)n[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,r){var n=i.attr(r);null!=n&&n.length&&(e[r]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=r,this._delay(function(){this.previous=r}))}var r;r=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)!==!1&&void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,r=t.ui.keyCode;switch(e.keyCode){case r.UP:return this._repeat(null,1,e),!0;case r.DOWN:return this._repeat(null,-1,e),!0;case r.PAGE_UP:return this._repeat(null,i.page,e),!0;case r.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return!(!this.spinning&&this._trigger("start",t)===!1)&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,r=this.options;return e=null!==r.min?r.min:0,i=t-e,i=Math.round(i/r.step)*r.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==r.max&&t>r.max?r.max:null!==r.min&&r.min>t?r.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,r,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,void this.element.val(this._format(i))):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(r=this.buttons.first().find(".ui-icon"),this._removeClass(r,null,this.options.icons.up),this._addClass(r,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),void this._super(t,e))},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:a(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null!==t&&t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:a(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:a(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:a(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:a(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void a(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,r;i=e.href.replace(t,""),r=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(t){}try{r=decodeURIComponent(r)}catch(t){}return e.hash.length>1&&i===r}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,r=location.hash.substring(1);return null===e&&(r&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===r?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=!!this.tabs.length&&0)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=!i&&0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),r=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:r++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,r--;break;case t.ui.keyCode.END:r=this.anchors.length-1;break;case t.ui.keyCode.HOME:r=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(r);case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(r!==this.options.active&&r);default:return}e.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function r(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(r(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?void this._activate(e):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),void("heightStyle"===t&&this._setupHeightStyle(e)))},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,r=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,r){var n,o,s,a=t(r).uniqueId().attr("id"),l=t(r).closest("li"),h=l.attr("aria-controls");e._isLocal(r)?(n=r.hash,s=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(s=l.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+s,o=e.element.find(n),o.length||(o=e._createPanel(s),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),h&&l.data("ui-tabs-aria-controls",h),l.attr({"aria-controls":s,"aria-labelledby":a}),o.attr("aria-labelledby",a)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(r.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,r,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;r=this.tabs[n];n++)i=t(r),e===!0||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,e===!0)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,r=this.element.parent();"fill"===e?(i=r.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),r=e.css("position");"absolute"!==r&&"fixed"!==r&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,r=this.active,n=t(e.currentTarget),o=n.closest("li"),s=o[0]===r[0],a=s&&i.collapsible,l=a?t():this._getPanelForTab(o),h=r.length?this._getPanelForTab(r):t(),u={oldTab:r,oldPanel:h,newTab:a?t():o,newPanel:l};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||s&&!i.collapsible||this._trigger("beforeActivate",e,u)===!1||(i.active=!a&&this.tabs.index(o),this.active=s?t():o,this.xhr&&this.xhr.abort(),h.length||l.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),e),this._toggle(e,u))},_toggle:function(e,i){function r(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),s.length&&o.options.show?o._show(s,o.options.show,r):(s.show(),r())}var o=this,s=i.newPanel,a=i.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),a.hide(),n()),a.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),s.length&&a.length?i.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,r=this._findActive(e);r[0]!==this.active[0]&&(r.length||(r=this.active),i=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var r=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),s=this._getPanelForTab(n),a={tab:n,panel:s},l=function(t,e){"abort"===e&&r.panels.stop(!1,!0),r._removeClass(n,"ui-tabs-loading"),s.removeAttr("aria-busy"),t===r.xhr&&delete r.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,a)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){s.html(t),r._trigger("load",i,a),l(n,e)},1)}).fail(function(t,e){setTimeout(function(){l(t,e)},1)})))},_ajaxSettings:function(e,i,r){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},r))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.uiBackCompat!==!1&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var r=(e.attr("aria-describedby")||"").split(/\s+/);r.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(r.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),r=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,r);-1!==n&&r.splice(n,1),e.removeData("ui-tooltip-id"),r=t.trim(r.join(" ")),r?e.attr("aria-describedby",r):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var r=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){r._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,r){var n=t.Event("blur");n.target=n.currentTarget=r.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,r=t(e?e.target:this.element).closest(this.options.items);r.length&&!r.data("ui-tooltip-id")&&(r.attr("title")&&r.data("ui-tooltip-title",r.attr("title")),r.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&r.parents().each(function(){var e,r=t(this);r.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),r.attr("title")&&(r.uniqueId(),i.parents[this.id]={element:this,title:r.attr("title")},r.attr("title",""))}),this._registerCloseHandlers(e,r),this._updateContent(r,e))},_updateContent:function(t,e){var i,r=this.options.content,n=this,o=e?e.type:null;return"string"==typeof r||r.nodeType||r.jquery?this._open(e,t,r):(i=r.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}),void(i&&this._open(e,t,i)))},_open:function(e,i,r){function n(t){h.of=t,s.is(":hidden")||s.position(h)}var o,s,a,l,h=t.extend({},this.options.position);if(r){if(o=this._find(i))return void o.tooltip.find(".ui-tooltip-content").html(r);i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),s=o.tooltip,this._addDescribedBy(i,s.attr("id")),s.find(".ui-tooltip-content").html(r),this.liveRegion.children().hide(),l=t("<div>").html(s.find(".ui-tooltip-content").html()),l.removeAttr("name").find("[name]").removeAttr("name"),l.removeAttr("id").find("[id]").removeAttr("id"),l.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):s.position(t.extend({of:i},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(a=this.delayedShow=setInterval(function(){s.is(":visible")&&(n(h.of),clearInterval(a))},t.fx.interval)),this._trigger("open",e,{tooltip:s})}},_registerCloseHandlers:function(e,i){var r={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var r=t.Event(e);r.currentTarget=i[0],this.close(r,!0)}}};i[0]!==this.element[0]&&(r.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(r.mouseleave="close"),e&&"focusin"!==e.type||(r.focusout="close"),this._on(!0,i,r)},close:function(e){var i,r=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,void(o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){r._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete r.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)))):void n.removeData("ui-tooltip-open")},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),r=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(r,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,r){var n=t.Event("blur"),o=r.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),t.uiBackCompat!==!1&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip}),r("Services/ImageProcessingCore",["jquery","../Renderer/FeatureStyle","jquery.ui"],function(t,e){function i(){h.dialog("isOpen")?h.dialog("close"):h.dialog("open")}function r(e){o&&o.properties.identifier===e.feature.properties.identifier?this.toggle():h.dialog("isOpen")||this.toggle(),o=e.feature,s=e.layer,e.feature.services&&c.setUrl(e.feature.services.download.url);var i=e.feature.properties.style.uniformValues;i?this.setImage(i):h.find(".histogramContent").children("div").fadeOut(function(){t(this).siblings("p").fadeIn()})}function n(e){u.setImage(e),e.url&&c.setUrl(e.url),h.find(".histogramContent").children("p").fadeOut(function(){t(this).siblings("div").fadeIn()})}var o,s,a,l,h,u,c;return{init:function(t,e,i,r){t&&(o=t.feature||null,s=t.layer||null,a=t.disable||null,l=t.unselect||null),h=e,u=i,c=r},setData:r,setImage:n,toggle:i}}),r("Services/MeasureToolPlanetCore",["jquery","underscore-min","../Layer/VectorLayer","../Renderer/Ray","../Utils/Numeric","../Renderer/FeatureStyle","../Renderer/glMatrix"],function(t,e,i,r,n,o){function s(t){if(t.preventDefault(),T.activated){b.stop(),A=!0,T.elevations=[],t.type.search("touch")>=0?T.pickPoint=[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:T.pickPoint=[t.layerX,t.layerY];var e=x.getContextManager().getActivatedContext().getLonLatFromPixel(T.pickPoint[0],T.pickPoint[1]);return null===e?null:(T.geoPickPoint=x.getContextManager().getActivatedContext().getLonLatFromPixel(T.pickPoint[0],T.pickPoint[1]),T.geoPickPoint)}}function a(t){t.preventDefault();var i;if(i=t.type.search("touch")>=0?x.getContextManager().getActivatedContext().getLonLatFromPixel(t.changedTouches[0].clientX,t.changedTouches[0].clientY):x.getContextManager().getActivatedContext().getLonLatFromPixel(t.layerX,t.layerY),!e.isEmpty(i)){var r=vec3.dot(vec3.normalize(x.getContextManager().getCrs().get3DFromWorld(i)),vec3.normalize(x.getContextManager().getCrs().get3DFromWorld(T.geoPickPoint))),o=Math.acos(r);T.geoDistance=n.toDegree(o),C&&C()}b.start(),A=!1}function l(t){if(t.preventDefault(),T.activated&&A){t.type.search("touch")>=0?T.secondPickPoint=[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:T.secondPickPoint=[t.layerX,t.layerY];var e=x.getContextManager().getActivatedContext().getLonLatFromPixel(T.secondPickPoint[0],T.secondPickPoint[1]);if(null!==e){T.secondGeoPickPoint=x.getContextManager().getActivatedContext().getLonLatFromPixel(T.secondPickPoint[0],T.secondPickPoint[1]),T.distance=Math.sqrt(Math.pow(T.secondPickPoint[0]-T.pickPoint[0],2)+Math.pow(T.secondPickPoint[1]-T.pickPoint[1],2));var i;i=void 0===T.secondGeoPickPoint?vec3.dot(vec3.normalize(x.getContextManager().getCrs().get3DFromWorld(T.secondPickPoint)),vec3.normalize(x.getContextManager().getCrs().get3DFromWorld(T.geoPickPoint))):vec3.dot(vec3.normalize(x.getContextManager().getCrs().get3DFromWorld(T.secondGeoPickPoint)),vec3.normalize(x.getContextManager().getCrs().get3DFromWorld(T.geoPickPoint)));var r=Math.acos(i);T.geoDistance=n.toDegree(r),p()}}}function h(t){var e=T.renderContext,i=mat4.create();mat4.inverse(e.viewMatrix,i);var n=[i[12],i[13],i[14]];mat4.multiply(e.projectionMatrix,e.viewMatrix,i),mat4.inverse(i);for(var o=[0,0,0],s=0;s<t.length;s++){mat4.multiplyVec4(i,t[s]),vec3.scale(t[s],1/t[s][3]),vec3.subtract(t[s],n,t[s]),vec3.normalize(t[s]);var a=new r(n,t[s]),l=a.computePoint(a.sphereIntersect(o,x.getContextManager().getCrs().getGeoide().getRadius()));t[s]=x.getContextManager().getCrs().getWorldFrom3D(l)}return t}function u(t,e){e=e*Math.PI/180;var i=Math.cos(e),r=Math.sin(e);return[t[0]*i-t[1]*r,t[0]*r+t[1]*i]}function c(t,e){e||(e=t);var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return e[0]=t[0]/i,e[1]=t[1]/i,e}function d(){var t,e=T.renderContext,i=2/e.canvas.width,r=2/e.canvas.height;if(x.getContextManager().getNavigation().getType()===x.NAVIGATION.FlatNavigation)return t=[[T.geoPickPoint[0],T.geoPickPoint[1],1],[T.secondGeoPickPoint[0],T.secondGeoPickPoint[1],1]];var n=[T.secondPickPoint[0]-T.pickPoint[0],T.secondPickPoint[1]-T.pickPoint[1]];c(n);var o=u(n,30),s=u(n,-30);o=[T.pickPoint[0]+10*o[0],T.pickPoint[1]+10*o[1]],s=[T.pickPoint[0]+10*s[0],T.pickPoint[1]+10*s[1]];var a=[-n[0],-n[1]],l=u(a,30),h=u(a,-30);return l=[T.secondPickPoint[0]+10*l[0],T.secondPickPoint[1]+10*l[1]],h=[T.secondPickPoint[0]+10*h[0],T.secondPickPoint[1]+10*h[1]],t=[[o[0]*i-1,(e.canvas.height-o[1])*r-1,1,1],[T.pickPoint[0]*i-1,(e.canvas.height-T.pickPoint[1])*r-1,1,1],[s[0]*i-1,(e.canvas.height-s[1])*r-1,1,1],[T.pickPoint[0]*i-1,(e.canvas.height-T.pickPoint[1])*r-1,1,1]],t.push([T.secondPickPoint[0]*i-1,(e.canvas.height-T.secondPickPoint[1])*r-1,1,1],[l[0]*i-1,(e.canvas.height-l[1])*r-1,1,1],[T.secondPickPoint[0]*i-1,(e.canvas.height-T.secondPickPoint[1])*r-1,1,1],[h[0]*i-1,(e.canvas.height-h[1])*r-1,1,1]),T.computeIntersection(t),t}function p(){T.clear();var t=T.computeMeasure();T.measureFeature={geometry:{gid:"measureShape",coordinates:t,type:x.GEOMETRY.LineString,crs:{type:"name",properties:{name:x.getContextManager().getCrs().getGeoideName()}}},properties:{style:new o({fillColor:[1,0,0,1]})},type:"Feature"};var e=[(T.secondPickPoint[0]+T.pickPoint[0])/2,(T.secondPickPoint[1]+T.pickPoint[1])/2],i=x.getContextManager().getActivatedContext().getLonLatFromPixel(e[0],e[1]),r=T.calculateDistanceElevation(T.geoPickPoint,T.secondGeoPickPoint);r=n.roundNumber(r.toFixed(3),2),T.measureLabel={geometry:{type:x.GEOMETRY.Point,gid:"measureShape",coordinates:i,crs:{type:"name",properties:{name:x.getContextManager().getCrs().getGeoideName()}}},properties:{style:new o({label:r+" km",fillColor:[1,1,1,1],pointMaxSize:600,extrusionScale:-1e5})}},w.addFeature(T.measureFeature),w.addFeature(T.measureLabel)}function f(){T.measureFeature&&w.removeFeature(T.measureFeature),T.measureLabel&&w.removeFeature(T.measureLabel);
}function g(t,e,i){var r,n=50|t.scale,o=e[0]-i[0];o>180?(o=360-o,r=-o/n):o<-180?(o=360+o,r=o/n):r=o/n;var s=(e[1]-i[1])/n,a=[];a[0]=e;for(var l=1;l<n;l++){var h=a[l-1][0]-r;h>180?h-=360:h<-180&&(h+=360);var u=a[l-1][1]-s;a[l]=[h,u]}return a[n]=i,a}function m(t,e){var i=x.getContextManager().getCrs().getGeoide().getRealPlanetRadius(),r=n.toRadian(t[1]),o=n.toRadian(e[1]),s=n.toRadian(e[1]-t[1]),a=n.toRadian(e[0]-t[0]),l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(r)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2),h=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),u=i*h;return u/1e3}function v(t,e){var i=T.calculateDistanceElevation(t,e);i=n.roundNumber(i.toFixed(3),2);var r=x.getContextManager().getActivatedContext().getElevation(e[0],e[1]);r=n.roundNumber(r/_,0);var o=[i,r];T.elevations.push(o)}function y(t){x=t.getMizarAPI(),b=x.getContextManager().getNavigation(),_=x.getContextManager().getActivatedContext().planetLayer.elevationLayer.scale,A=!1,w||(w=new i),x.getContextManager().getPlanetContext().globe.addLayer(w,x.getContextManager().getActivatedContext().planetLayer),this.activated=!1,this.renderContext=x.getContextManager().getRenderContext(),this.elevations=[],this.measureFeature=null}var b,x,C,_,w,T,A;return{init:function(t){x=t.mizar.getMizarAPI(),b=x.getContextManager().getNavigation(),C=t.onselect,_=x.getContextManager().getActivatedContext().planetLayer.elevationLayer.scale,T=this,A=!1,w=x.LayerFactory.create({type:x.LAYER.Vector,visible:!0}),x.getContextManager().getPlanetContext().globe.addLayer(w,x.getContextManager().getActivatedContext().planetLayer),this.activated=!1,this.renderContext=x.getContextManager().getRenderContext(),this.elevations=[],this.measureFeature=null},_handleMouseDown:s,_handleMouseUp:a,_handleMouseMove:l,clear:f,updateContext:y,calculateIntermediateElevationPoint:g,calculateDistanceElevation:m,computeMeasure:d,computeIntersection:h,storeDistanceAndElevation:v}}),r("Services/MeasureToolSkyCore",["jquery","underscore-min","../Utils/Numeric","../Layer/VectorLayer","../Renderer/Ray","../Renderer/FeatureStyle","../Renderer/glMatrix"],function(t,e,i,r,n,o){function s(t){t.preventDefault(),x.activated&&(x.distance=0,v.stop(),C=!0,x.elevations=[],t.type.search("touch")>=0?x.pickPoint=[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:x.pickPoint=[t.layerX,t.layerY],x.geoPickPoint=g.getContextManager().getActivatedContext().getLonLatFromPixel(x.pickPoint[0],x.pickPoint[1]))}function a(t){if(t.preventDefault(),x.activated){var e;e=t.type.search("touch")>=0?g.getContextManager().getActivatedContext().getLonLatFromPixel(t.changedTouches[0].clientX,t.changedTouches[0].clientY):g.getContextManager().getActivatedContext().getLonLatFromPixel(t.layerX,t.layerY);var r=vec3.dot(vec3.normalize(g.getContextManager().getCrs().get3DFromWorld(e)),vec3.normalize(g.getContextManager().getCrs().get3DFromWorld(x.geoPickPoint))),n=Math.acos(r);x.geoDistance=i.toDegree(n),y&&y(),v.start(),C=!1}}function l(t){if(t.preventDefault(),x.activated&&C){t.type.search("touch")>=0?x.secondPickPoint=[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:x.secondPickPoint=[t.layerX,t.layerY],x.secondGeoPickPoint=g.getContextManager().getActivatedContext().getLonLatFromPixel(x.secondPickPoint[0],x.secondPickPoint[1]),x.distance=Math.sqrt(Math.pow(x.secondPickPoint[0]-x.pickPoint[0],2)+Math.pow(x.secondPickPoint[1]-x.pickPoint[1],2));var e=vec3.dot(vec3.normalize(g.getContextManager().getCrs().get3DFromWorld(x.secondGeoPickPoint)),vec3.normalize(g.getContextManager().getCrs().get3DFromWorld(x.geoPickPoint))),r=Math.acos(e);x.geoDistance=i.toDegree(r),x.updateMeasure()}}function h(t){var e=x.renderContext,i=mat4.create();mat4.inverse(e.viewMatrix,i);var r=[i[12],i[13],i[14]];mat4.multiply(e.projectionMatrix,e.viewMatrix,i),mat4.inverse(i);for(var o=[0,0,0],s=0;s<t.length;s++){mat4.multiplyVec4(i,t[s]),vec3.scale(t[s],1/t[s][3]),vec3.subtract(t[s],r,t[s]),vec3.normalize(t[s]);var a=new n(r,t[s]),l=a.computePoint(a.sphereIntersect(o,g.getContextManager().getCrs().getGeoide().getRadius()));t[s]=g.getContextManager().getCrs().getWorldFrom3D(l)}return t}function u(t,e){e=e*Math.PI/180;var i=Math.cos(e),r=Math.sin(e);return[t[0]*i-t[1]*r,t[0]*r+t[1]*i]}function c(t,e){e||(e=t);var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return e[0]=t[0]/i,e[1]=t[1]/i,e}function d(){var t=x.renderContext,e=2/t.canvas.width,i=2/t.canvas.height,r=[x.secondPickPoint[0]-x.pickPoint[0],x.secondPickPoint[1]-x.pickPoint[1]];c(r);var n=u(r,30),o=u(r,-30);n=[x.pickPoint[0]+10*n[0],x.pickPoint[1]+10*n[1]],o=[x.pickPoint[0]+10*o[0],x.pickPoint[1]+10*o[1]];var s=[-r[0],-r[1]],a=u(s,30),l=u(s,-30);a=[x.secondPickPoint[0]+10*a[0],x.secondPickPoint[1]+10*a[1]],l=[x.secondPickPoint[0]+10*l[0],x.secondPickPoint[1]+10*l[1]];var h=[[x.pickPoint[0]*e-1,(t.canvas.height-x.pickPoint[1])*i-1,1,1],[n[0]*e-1,(t.canvas.height-n[1])*i-1,1,1],[x.pickPoint[0]*e-1,(t.canvas.height-x.pickPoint[1])*i-1,1,1],[o[0]*e-1,(t.canvas.height-o[1])*i-1,1,1],[x.pickPoint[0]*e-1,(t.canvas.height-x.pickPoint[1])*i-1,1,1],[x.secondPickPoint[0]*e-1,(t.canvas.height-x.secondPickPoint[1])*i-1,1,1],[a[0]*e-1,(t.canvas.height-a[1])*i-1,1,1],[x.secondPickPoint[0]*e-1,(t.canvas.height-x.secondPickPoint[1])*i-1,1,1],[l[0]*e-1,(t.canvas.height-l[1])*i-1,1,1],[x.secondPickPoint[0]*e-1,(t.canvas.height-x.secondPickPoint[1])*i-1,1,1]];return this.computeIntersection(h),h}function p(){x.clear();var t=x.computeMeasure();t.push(t[0]),x.measureFeature={geometry:{gid:"measureShape",coordinates:[t],type:g.GEOMETRY.Polygon,crs:{type:"name",properties:{name:g.getContextManager().getCrs().getGeoideName()}}},properties:{style:new o({zIndex:2,fillColor:[1,0,0,1]})},type:"Feature"};var e=[(x.secondPickPoint[0]+x.pickPoint[0])/2,(x.secondPickPoint[1]+x.pickPoint[1])/2],i=g.getContextManager().getActivatedContext().getLonLatFromPixel(e[0],e[1]);x.measureLabel={geometry:{type:g.GEOMETRY.Point,gid:"measureShape",coordinates:i,crs:{type:"name",properties:{name:g.getContextManager().getCrs().getGeoideName()}}},properties:{style:new o({label:g.getContextManager().getCrs().fromDegreesToDMS(x.geoDistance),fillColor:[1,1,1,1],zIndex:2})}},b.addFeature(x.measureFeature),b.addFeature(x.measureLabel)}function f(){x.measureFeature&&b.removeFeature(x.measureFeature),x.measureLabel&&b.removeFeature(x.measureLabel)}var g,m,v,y,b,x,C;return{init:function(t){m=t.mizar,g=m.getMizarAPI(),v=g.getContextManager().getNavigation(),y=t.onselect,x=this,C=!1,b=g.LayerFactory.create({type:g.LAYER.Vector,visible:!0}),g.getContextManager().getSkyContext().globe.addLayer(b),this.activated=!1,this.renderContext=g.getContextManager().getRenderContext(),this.elevations=[],this.measureFeature=null},_handleMouseDown:s,_handleMouseUp:a,_handleMouseMove:l,updateMeasure:p,clear:f,computeMeasure:d,computeIntersection:h}}),r("Services/MocBase",["jquery","../Renderer/FeatureStyle","../Layer/MocLayer","../Utils/Numeric","../Layer/FitsLoader","../Tiling/HEALPixBase"],function(t,e,i,r,n,o){function s(e,i,r){e.serviceUrl&&1!==e.serviceUrl.search(/[\/.fits]+$/g)?(e.describeUrl=e.serviceUrl,i(e)):t.ajax({type:"GET",url:e.serviceUrl,success:function(n){var o=t(n).find('Url[rel="mocdesc"]'),s=t(o).attr("template");if(s){var a=s.indexOf("?q=");a!==-1&&(s=s.substring(0,a)),e.describeUrl=s,i(e)}else e.describeUrl="Not available",e.coverage="Not available",r&&r(e)},error:function(t){e.describeUrl="Not available",e.coverage="Not available",r&&r(e)}})}function a(t,e,i){if("Not available"!==t.coverage){var r="?media=txt";t.describeUrl?(t.describeUrl.lastIndexOf("?")>0&&(r="&media=txt"),l(t,t.describeUrl+r,e)):s(t,function(t){t.describeUrl.lastIndexOf("?")>0&&(r="&media=txt"),l(t,t.describeUrl+r,e)},i)}else i(t)}function l(t,e){this.getSkyCoverage(t,function(t){e(t.coverage)},function(t){e(t.coverage)})}function h(t,e,i){if("Not available"!==t.describeUrl)if(t.describeUrl){u(t,t.describeUrl);var r=t.describeUrl;String(r).endsWith(".fits")||(r+="?media=txt"),l(t,r,e)}else s(t,function(t){u(t,t.describeUrl);var i=t.describeUrl;String(i).endsWith(".fits")||(i+="?media=txt"),l(t,i,e)},i);else i(t)}function l(e,i,s){e.hasOwnProperty("properties")&&e.properties.hasOwnProperty("mocCoverage")&&(e.coverage=r.roundNumber(100*parseFloat(e.properties.mocCoverage),5)+"%"),e.coverage?s(e):String(i).endsWith(".fits")?n.loadFits(i,function(t){for(var i={},n=t.getHDU(1).data,a=0;a<n.rows;a++){var l=n.getRow(a),h=o.uniq2hpix(l[n.columns[0]]),u=h[0];void 0===i[u]&&(i[u]=[]),i[u].push(h[1])}var c;_.each(i,function(t,e){c=parseInt(e,10)});var d=c+1;_.isNumber(response)?e.coverage=r.roundNumber(100*p(d,i),5)+"%":e.coverage="Not available",s&&s(e)}):t.ajax({type:"GET",url:i,success:function(t){_.isNumber(t)?e.coverage=r.roundNumber(parseFloat(t),5)+"%":e.coverage="Not available",s&&s(e)}})}function u(t,e){var r=(t.style,new i({serviceUrl:e,style:t.style,visible:!1}));r.style.fill=!0,r.style.fillColor[3]=.3,t.globe.addLayer(r),t.subLayers||(t.subLayers=[]),t.subLayers.push(r)}function c(t){if(t.subLayers)for(var e=0;e<t.subLayers.length;e++)if(t.subLayers[e]instanceof i)return t.subLayers[e];return null}function d(t){for(var r=b,n="",o=0;o<t.length;o++){var s=t[o];n+=s.name,r+=s.describeUrl,o!==t.length-1&&(r+=";",n+=" x ")}return intersectionLayer=new i({name:"Intersection( "+n+" )",serviceUrl:r+"&media=json",style:new e({rendererHint:"Basic",fill:!0,fillColor:[1,0,0,.3]}),visible:!1}),y.getContextManager().getSkyContext().globe.addLayer(intersectionLayer),intersectionLayer.describeUrl=r,intersectionLayer}function p(t,e){var i=g(t);return 0===i?0:f(t,e)/i}function f(t,e){for(var i=0,r=1,n=t-1;n>=0;n--,r*=4)i+=m(n,e)*r;return i}function g(t){if(0===t)return 0;var e=v(t-1);return 12*e*e}function m(t,e){return e[t]?e[t].length:0}function v(t){return 1<<t}var y,b;return{init:function(t,e){y=t,b="TODO must use AbstractLayer to get info"},createMocSublayer:h,findMocSublayer:c,getSkyCoverage:a,requestSkyCoverage:l,intersectLayers:d}}),r("Services/MollweideViewerCore",["jquery","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(t,e,i){function r(t){if(Math.abs(t)===Math.PI/2)return t;var e,i,r=.001;do{e=i,e||(e=t);var n=2*e;i=n/2-(n+Math.sin(n)-Math.PI*Math.sin(t))/(2+2*Math.cos(n))}while(Math.abs(i-e)>=r);return i}function n(t){var e=l.getContextManager().getCrs(),i=e.getWorldFrom3D(t);i[0]>180&&(i[0]-=360);var n=i[0]*Math.PI/180,o=i[1]*Math.PI/180,s=r(o),a=2*Math.sqrt(2)/Math.PI*n*Math.cos(s),h=Math.sqrt(2)*Math.sin(s),u=-a*g/2.8+g+d,c=-h*f/1.38+f+p;return[u,c]}function o(t){v.x=2.8*-(t[0]-g-d)/g,v.y=1.38*-(t[1]-f-p)/f;var e=Math.asin(v.y/Math.sqrt(2)),i=Math.asin((2*e+Math.sin(2*e))/Math.PI),r=Math.PI*v.x/(2*Math.sqrt(2)*Math.cos(e)),n=[180*r/Math.PI,180*i/Math.PI];l.getContextManager().getCrs().get3DFromWorld(n,c.center3d),c.computeViewMatrix()}function s(){b.clearRect(0,0,b.canvas.width,b.canvas.height),b.drawImage(C,0,0),b.fillStyle="rgb(255,0,0)";for(var r,o,s,a=l.getContextManager().getRenderContext().canvas.clientWidth/(m-1),h=l.getContextManager().getRenderContext().canvas.clientHeight/(m-1),u=0;u<m;u++)for(var d=0;d<m;d++)r=i.createFromPixel(l.getContextManager().getRenderContext(),u*a,d*h),o=r.computePoint(r.sphereIntersect([0,0,0],l.getContextManager().getCrs().getGeoide().getRadius())),s=n(o),b.fillRect(s[0],s[1],2,2);b.fillStyle=v.color,s=n(c.center3d),v.x=s[0]-v.size/2,v.y=s[1]-v.size/2,b.fillRect(s[0]-v.size/2,s[1]-v.size/2,v.size,v.size);var p=c.getFov(),f=e.roundNumber(p[0],2);f=l.getContextManager().getCrs().fromDegreesToDMS(f);var g=e.roundNumber(p[1],2);g=l.getContextManager().getCrs().fromDegreesToDMS(g),t("#fov").html("Fov : "+f+" x "+g)}function a(e){t(x.getImageObj()).attr("src",u+"css/images/MollweideSky_"+e.getGeoideName()+".png")}var l,h,u,c,d,p,f,g,m,v,y,b,x,C,_=function(t){this.x=0|t.x,this.y=0|t.y,this.color="rgb(255,0,0)"|t.color,this.size=2|t.size;for(var e in t)this[e]=t[e]};return{init:function(t){h=t.mizar,l=h.getMizarAPI(),u=t.mizarBaseUrl,c=l.getContextManager().getNavigation(),d=16,p=8,f=50,g=100,m=9,v=new _({size:5,color:"rgb(255,255,0)"}),y=document.getElementById("mollweideCanvas"),b=y.getContext("2d"),x=this,C=new Image,C.onload=function(){b.drawImage(C,0,0),s(C)}},getImageObj:function(){return C},_findTheta:r,computeMollweidePosition:n,updateNavigation:o,updateMollweideFov:s,updateGalaxyProjection:a}}),r("Services/PickingManagerCore",["../Renderer/FeatureStyle","../Layer/OpenSearchLayer","../Utils/Utils","../Utils/UtilsIntersection","../Utils/Constants"],function(t,e,i,r,n){function o(t){C.indexOf(t)===-1?C.push(t):console.log("WARN:"+t.name+" has been already added")}function s(t){for(var e=0;e<C.length;e++)t.id===C[e].id&&C.splice(e,1)}function a(){return C}function l(){var e=this.getSelection()[this.stackSelectionIndex];if(e){var i=new t(e.feature.properties.style);switch(e.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:i.strokeColor=e.layer.style.strokeColor;break;case n.GEOMETRY.Point:i.fillColor=e.feature.properties.style.strokeColor}i.zIndex=e.layer.style.zIndex,e.layer.modifyFeatureStyle(e.feature,i)}}function h(e,i){i&&i.isExclusive&&c();var r=i.color?t.fromStringToColor(i.color):this.selectedStyle.strokeColor,o=i.color?t.fromStringToColor(i.color):this.selectedStyle.fillColor,s=this.getSelection()[e];if(s){this.stackSelectionIndex=e;var a=new t(s.feature.properties.style);switch(s.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:a.strokeColor=r;break;case n.GEOMETRY.Point:a.fillColor=o}a.zIndex=this.selectedStyle.zIndex,s.layer.modifyFeatureStyle(s.feature,a)}x.refresh()}function u(){return _}function c(){for(var e=0;e<this.getSelection().length;e++){var i=this.getSelection()[e],r=new t(i.feature.properties.style);switch(i.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:r.strokeColor=i.layer.style.strokeColor;break;case n.GEOMETRY.Point:r.fillColor=i.feature.properties.style.strokeColor}r.zIndex=i.layer.style.zIndex,i.layer.globe&&i.layer.modifyFeatureStyle(i.feature,r)}}function d(e){for(var i,r=0;r<e.length;r++){var o=e[r];switch(i=new t(o.feature.properties.style?o.feature.properties.style:o.layer.style),o.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:i.strokeColor=this.selectedStyle.strokeColor;break;case n.GEOMETRY.Point:i.fillColor=this.selectedStyle.fillColor}i.zIndex=this.selectedStyle.zIndex,o.layer.modifyFeatureStyle(o.feature,i)}}function p(){this.blurSelection(),this.setSelection([])}function f(t,e){for(var i=!1,r=e[0][0],n=1;n<e.length&&!i;n++){var o=Math.abs(e[n][0]-r);o>180&&(i=!0)}var s;if(i){var a=[];if(t[0]<0)for(s=0;s<e.length;s++)e[s][0]>0?a[s]=[e[s][0]-360,e[s][1]]:a[s]=[e[s][0],e[s][1]];else for(s=0;s<e.length;s++)e[s][0]<0?a[s]=[e[s][0]+360,e[s][1]]:a[s]=[e[s][0],e[s][1]];return a}return e}function g(t,e){var i,o,s,a,l,h;switch(t.geometry.type){case n.GEOMETRY.LineString:for(i=0;i<t.geometry.coordinates.length-1;i++)if(a=t.geometry.coordinates[i],l=t.geometry.coordinates[i+1],r.pointInLine(e,a,l))return!0;break;case n.GEOMETRY.MultiLineString:for(i=0;i<t.geometry.coordinates.length;i++)for(o=0;o<t.geometry.coordinates[i].length-1;o++)if(a=t.geometry.coordinates[i][o],l=t.geometry.coordinates[i][o+1],r.pointInLine(e,a,l))return!0;break;case n.GEOMETRY.Polygon:return h=this.fixDateLine(e,t.geometry.coordinates[0]),r.pointInRing(e,h);case n.GEOMETRY.MultiPolygon:for(s=0;s<t.geometry.coordinates.length;s++)if(h=this.fixDateLine(e,t.geometry.coordinates[s][0]),r.pointInRing(e,h))return!0;return!1;case n.GEOMETRY.Point:var u=t.geometry.coordinates,c=t.properties.style&&t.properties.style.label;return r.pointInSphere(b,e,u,t.geometry._bucket.textureHeight)&&!c;default:return console.log("Picking for "+t.geometry.type+" is not implemented yet"),!1}}function m(t){if(!t)return[];var i,r,n,o=[];for(i=0;i<this.getPickableLayers().length;i++){var s=x.tileManager.getVisibleTile(t[0],t[1]),a=this.getPickableLayers()[i];if(a.isVisible()&&a.globe===x)if(a instanceof e){var l=s,h=l.extension[a.extId];if(!h||h.state!==e.TileState.LOADED)for(;l.parent&&(!h||h.state!==e.TileState.LOADED);)l=l.parent,h=l.extension[a.extId];if(h)for(r=0;r<h.featureIds.length;r++)n=a.features[a.featuresSet[h.featureIds[r]].index],this.featureIsPicked(n,t)&&o.push({feature:n,layer:a})}else for(r=0;r<a.features.length;r++)n=a.features[r],this.featureIsPicked(n,t)&&o.push({feature:n,layer:a});o.selectedTile=s}return o}function v(t){return _=t}function y(t,e){_.push(t),h(_-1,e)}var b,x,C=[],_=[],w=-1,T=new t({strokeColor:[1,1,0,1],fillColor:[1,1,0,1],zIndex:1});return{selectedStyle:T,stackSelectionIndex:w,init:function(t){b=t,x=t.globe},addPickableLayer:o,removePickableLayer:s,getPickableLayers:a,blurSelectedFeature:l,focusFeatureByIndex:h,getSelection:u,blurSelection:c,focusSelection:d,clearSelection:p,fixDateLine:f,featureIsPicked:g,computePickSelection:m,setSelection:v,highlightObservation:y}}),r("Parser/JsonProcessor",["../Layer/HipsGraphicLayer","../Utils/Constants","../Crs/CoordinateSystemFactory"],function(t,e,i){function r(i,r){console.log("hop",i);for(var n in r.services){var o=r.services[n];switch(i.subLayers||(i.subLayers=[]),o.type){case e.LAYER.Hips:o.layer=new t({format:o.format,baseUrl:o.url,name:o.name,visible:!1,coordinates:r.geometry.coordinates[0]}),i.subLayers.push(o.layer),i.planet&&i.visible()&&i.planet.addLayer(o.layer)}}}var n=0;return{handleFeatureCollection:function(t,o){var s={type:"name",properties:{name:e.CRS.WGS84}};if(null===o||void 0===o)throw"Error, featureCollection is null";var a=o.crs?o.crs:s;t.coordinateSystem=i.create({geoideName:a.properties.name});var l=o.features;if(null===l||void 0===l)return void console.log("Error, no feature in featureCollection : ",o);var h;for(h=0;h<l.length;h++){var u=l[h];switch(u.geometry.type){case e.GEOMETRY.Point:t.dataType?"point"!==t.dataType&&(t.dataType="none"):t.dataType="point";break;case e.GEOMETRY.Polygon:case e.GEOMETRY.MultiPolygon:t.dataType?"line"!==t.dataType&&(t.dataType="none"):t.dataType="line",u.properties._imageCoordinates&&(u.geometry._imageCoordinates=u.properties._imageCoordinates)}u.geometry.crs||(u.geometry.crs=a),u.geometry.gid="jsonProc_"+n,n++,u.services&&r(t,u)}}}}),r("Gui/dialog/ErrorDialog",["jquery","jquery.ui"],function(t){var e='<div id="errorDiv" style="text-align: justify" title="Error"></div>',i=t(e).appendTo("body").dialog({autoOpen:!1,resizable:!1,draggable:!1,width:"300px",minHeight:"auto",dialogClass:"errorBox"});return{open:function(t){i.html(t).dialog("open")}}});var n=function(){var t=21012,e="/",i="samp.webhub.",r="";TYPE_STRING="string",TYPE_LIST="list",TYPE_MAP="map";var o=function(t){function e(){}return e.prototype=t,new e},s=function(t){if("string"==typeof t)return TYPE_STRING;if(t instanceof Array)return TYPE_LIST;if(t instanceof Object&&null!==t)return TYPE_MAP;throw new Error("Not legal SAMP object type: "+t)},a=function(t,e){var i,r,n=t.childNodes,o=[];for(r=0;r<n.length;r++)if(i=n[r],1===i.nodeType){if(e&&i.tagName!==e)throw new Error("Child <"+n[r].tagName+"> of <"+t.tagName+"> is not a <"+e+">");o.push(i)}return o},l=function(t,e){var i=a(t,e);if(1===i.length)return i[0];throw new Error("No sole child of <"+t.tagName+">")},h=function(t){var e,i,r="";for(e=0;e<t.childNodes.length;e++){if(i=t.childNodes[e],1===i.nodeType)throw new Error("Element found in text content");3!==i.nodeType&&4!==i.nodeType||(r+=i.nodeValue)}return r},u=function(t){return"undefined"==typeof JSON?"...":JSON.stringify(t)},c={};c.escapeXml=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},c.checkParams=function(t,e){var i;for(i=0;i<e.length;i++)if(e[i]!==TYPE_STRING&&e[i]!==TYPE_LIST&&e[i]!==TYPE_MAP)throw new Error("Unknown type "+e[i]+" in check list");var r=t.length,n=[],o=!0;for(i=0;i<r;i++)n.push(s(t[i]));for(o=o&&e.length===r,i=0;o&&i<r;i++)o=o&&e[i]===n[i];if(!o)throw new Error("Param type list mismatch: ["+e+"] != ["+n+"]")},c.valueToXml=function t(e,i){i=i||"";var r,n,o=s(e);if(o===TYPE_STRING)return i+"<value><string>"+c.escapeXml(e)+"</string></value>";if(o===TYPE_LIST){for(n=[],n.push(i+"<value>",i+"  <array>",i+"    <data>"),r=0;r<e.length;r++)n.push(t(e[r],i+"      "));return n.push(i+"    </data>",i+"  </array>",i+"</value>"),n.join("\n")}if(o===TYPE_MAP){n=[],n.push(i+"<value>"),n.push(i+"  <struct>");for(r in e)n.push(i+"    <member>"),n.push(i+"      <name>"+c.escapeXml(r)+"</name>"),n.push(t(e[r],i+"      ")),n.push(i+"    </member>");return n.push(i+"  </struct>"),n.push(i+"</value>"),n.join("\n")}throw new Error("bad type")},c.xmlToValue=function t(e,i){var r,n,o,s,u=a(e);if(0===u.length)return h(e);if(1===u.length){if(o=u[0],s=o.tagName,"string"===s)return h(o);if("array"===s){var c=a(l(o,"data"),"value"),d=[];for(r=0;r<c.length;r++)d.push(t(c[r],i));return d}if("struct"===s){var p,f,g,m=a(o,"member"),v={};for(r=0;r<m.length;r++){for(p=void 0,f=void 0,n=0;n<m[r].childNodes.length;n++)g=m[r].childNodes[n],1==g.nodeType&&("name"===g.tagName?p=h(g):"value"===g.tagName&&(f=t(g,i)));if(void 0===p||void 0===f)throw new Error("No <name> and/or <value> in <member>?");v[p]=f}return v}if(!i||"int"!==s&&"i4"!==s)throw new Error("Non SAMP-friendly value content: <"+s+">");return h(o)}throw new Error("Bad XML-RPC <value> content - multiple elements")},c.decodeParams=function(t){var e,i=a(t,"param"),r=[];for(e=0;e<i.length;e++)r.push(c.xmlToValue(l(i[e],"value")));return r},c.decodeFault=function(t){var e=c.xmlToValue(l(t,"value"),!0);return new c.Fault(e.faultString,e.faultCode)},c.decodeResponse=function(t){var e=t.documentElement;if("methodResponse"!==e.tagName)throw new Error("Response element is not <methodResponse>");var i=l(e);if("fault"===i.tagName)return c.decodeFault(i);if("params"===i.tagName)return c.decodeParams(i)[0];throw new Error("Bad XML-RPC response - unknown element <"+i.tagName+">")},c.Fault=function(t,e){this.faultString=t,this.faultCode=e},c.Fault.prototype.toString=function(){return"XML-RPC Fault ("+this.faultCode+"): "+this.faultString};var d=function(t,e){this.methodName=t,this.params=e||[]};d.prototype.toString=function(){return this.methodName+"("+u(this.params)+")"},d.prototype.addParam=function(t){return this.params.push(t),this},d.prototype.addParams=function(t){var e;for(e=0;e<t.length;e++)this.params.push(t[e]);return this},d.prototype.checkParams=function(t){c.checkParams(this.params,t)},d.prototype.toXml=function(){var t=[];t.push("<?xml version='1.0'?>","<methodCall>","  <methodName>"+this.methodName+"</methodName>","  <params>");for(var e=0;e<this.params.length;e++)t.push("    <param>",c.valueToXml(this.params[e],"      "),"    </param>");return t.push("  </params>","</methodCall>"),t.join("\n")};var p=function(i){this.endpoint=i||"http://localhost:"+t+e};p.createXHR=function(){var t=function(t){this.xhr=t,t.onreadystatechange=function(e){return function(){4===t.readyState&&(e.completed||200===+t.status&&(e.completed=!0,e.responseText=t.responseText,e.responseXML=t.responseXML,e.onload&&e.onload()))}}(this),t.onerror=function(t){return function(e){t.completed||(t.completed=!0,t.onerror&&(e?e.toString=function(){return"No hub?"}:e="No hub?",t.onerror(e)))}}(this),t.ontimeout=function(t){return function(e){t.completed||(t.completed=!0,t.onerror&&t.onerror("timeout"))}}(this)};t.prototype.open=function(t,e){this.xhr.open(t,e)},t.prototype.send=function(t){this.xhr.send(t)},t.prototype.abort=function(){this.xhr.abort()},t.prototype.setContentType=function(t){"setRequestHeader"in this.xhr&&this.xhr.setRequestHeader("Content-Type",t)};var e=function(t){this.xdr=t,t.onload=function(e){return function(){if(e.responseText=t.responseText,"text/xml"===t.contentType||"application/xml"===t.contentType||/\/x-/.test(t.contentType))try{var i=new ActiveXObject("Microsoft.XMLDOM");i.loadXML(t.responseText),e.responseXML=i}catch(t){e.responseXML=t}e.onload&&e.onload()}}(this),t.onerror=function(t){return function(e){t.onerror&&t.onerror(e)}}(this),t.ontimeout=function(t){return function(e){t.onerror&&t.onerror(e)}}(this)};if(e.prototype.open=function(t,e){this.xdr.open(t,e)},e.prototype.send=function(t){this.xdr.send(t)},e.prototype.abort=function(){this.xdr.abort()},e.prototype.setContentType=function(t){},"undefined"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;if("withCredentials"in i)return new t(i)}if("undefined"!=typeof XDomainRequest)return new e(new XDomainRequest);if("undefined"!=typeof flensed.flXHR)return new t(new flensed.flXHR({instancePooling:!0}));throw new Error("no cross-origin mechanism available")},p.prototype.execute=function(t,e,i){!function(r){var n;try{n=p.createXHR(),n.open("POST",r.endpoint),n.setContentType("text/xml")}catch(t){throw i(t),t}return n.onload=function(){var t,r=n.responseXML;if(!r)return void(i&&i("no XML response"));try{t=c.decodeResponse(r)}catch(t){return void(i&&i(t))}t instanceof c.Fault?i&&i(t):e&&e(t)},n.onerror=function(t){t?t.toString=function(){return"No hub?"}:t="No hub",i&&i(t)},n.send(t.toXml()),n}(this)};var f=function(t,e){this["samp.mtype"]=t,this["samp.params"]=e},g=function(t){if(this.regInfo=t,this.privateKey=t["samp.private-key"],"string"===(this.privateKey,!1))throw new Error("Bad registration object");this.xClient=new p};!function(){var t,e={call:[TYPE_STRING,TYPE_STRING,TYPE_MAP],callAll:[TYPE_STRING,TYPE_MAP],callAndWait:[TYPE_STRING,TYPE_MAP,TYPE_STRING],declareMetadata:[TYPE_MAP],declareSubscriptions:[TYPE_MAP],getMetadata:[TYPE_STRING],getRegisteredClients:[],getSubscribedClients:[TYPE_STRING],getSubscriptions:[TYPE_STRING],notify:[TYPE_STRING,TYPE_MAP],notifyAll:[TYPE_MAP],ping:[],reply:[TYPE_STRING,TYPE_MAP]};for(t in e)!function(t,e){g.prototype[t]=function(r,n,o){var s=function(t){return function(){t.close()}}(this);o=o||s,c.checkParams(r,e);var a=new d(i+t);return a.addParam(this.privateKey),a.addParams(r),this.xClient.execute(a,n,o)}}(t,e[t])}(),g.prototype.unregister=function(){if(this.callbackRequest)try{this.callbackRequest.abort()}catch(t){}var t=new d(i+"unregister");t.addParam(this.privateKey);try{this.xClient.execute(t)}catch(t){}delete this.regInfo,delete this.privateKey},g.prototype.close=function(){if(!this.closed){this.closed=!0;try{this.regInfo&&this.unregister()}catch(t){}if(this.onclose){oc=this.onclose,delete this.onclose;try{oc()}catch(t){}}}},g.prototype.setCallable=function(t,e){if(this.callbackRequest)try{this.callbackRequest.abort()}catch(t){}finally{delete this.callbackRequest}if(t||this.regInfo){var n=new d(i+"allowReverseCallbacks");n.addParam(this.privateKey),n.addParam(t?"1":"0");var o=function(t){return function(){t.close()}}(this);t?!function(a){var l,h=function(e){var i=e["samp.methodName"],n=e["samp.params"],o=void 0;i===r+"receiveNotification"?o=t.receiveNotification:i===r+"receiveCall"?o=t.receiveCall:i===r+"receiveResponse"&&(o=t.receiveResponse),o&&o.apply(t,n)},u=function(t){if(s(t)!=TYPE_LIST)return void c(new Error("pullCallbacks result not List"));var e;for(e=0;e<t.length;e++)try{h(t[e])}catch(t){}p()},c=function(t){var e=(new Date).getTime()-l;e<1e3?a.close():p()},p=function(){if(a.regInfo){var t=new d(i+"pullCallbacks");t.addParam(a.privateKey),t.addParam("600"),l=(new Date).getTime(),a.callbackRequest=a.xClient.execute(t,u,c)}},f=function(){p(),e()};a.xClient.execute(n,f,o)}(this):this.xClient.execute(n,e,o)}},g.prototype.translateUrl=function(t){var e=this.regInfo["samp.url-translator"]||"";return e+t},g.Action=function(t,e,i){this.actName=t,this.actArgs=e,this.resultKey=i};var m=function(t){this.callHandler={},this.replyHandler={}};m.prototype.init=function(t){},m.prototype.receiveNotification=function(t,e){var i=e["samp.mtype"],r=!1;if(i in this.callHandler){try{this.callHandler[i](t,e,!1)}catch(t){}r=!0}return r},m.prototype.receiveCall=function(t,e,i){var r,n,o=i["samp.mtype"],s=!1;if(o in this.callHandler)try{n=this.callHandler[o](t,i,!0)||{},r={"samp.status":"samp.ok","samp.result":n},s=!0}catch(t){r={"samp.status":"samp.error","samp.error":{"samp.errortxt":t.toString()}}}else r={"samp.status":"samp.warning","samp.result":{},"samp.error":{"samp.errortxt":"no action"}};return this.connection.reply([e,r]),s},m.prototype.receiveResponse=function(t,e,i){var r=!1;if(e in this.replyHandler)try{this.replyHandler[e](t,e,i),r=!0}catch(t){}return r},m.prototype.calculateSubscriptions=function(){var t,e={};for(t in this.callHandler)e[t]={};return e};var v=function(){var t=this;this.ids={},this.metas={},this.subs={},this.replyHandler={},this.callHandler={"samp.hub.event.shutdown":function(e,i){t.connection.close()},"samp.hub.disconnect":function(e,i){t.connection.close()},"samp.hub.event.register":function(e,i){var r=i["samp.params"].id;t.ids[r]=!0,t.changed(r,"register",null)},"samp.hub.event.unregister":function(e,i){var r=i["samp.params"].id;delete t.ids[r],delete t.metas[r],delete t.subs[r],t.changed(r,"unregister",null)},"samp.hub.event.metadata":function(e,i){var r=i["samp.params"].id,n=i["samp.params"].metadata;t.metas[r]=n,t.changed(r,"meta",n)},"samp.hub.event.subscriptions":function(e,i){var r=i["samp.params"].id,n=i["samp.params"].subscriptions;t.subs[r]=n,t.changed(r,"subs",n)}}};v.prototype=o(m.prototype),v.prototype.changed=function(t,e,i){this.onchange&&this.onchange(t,e,i)},v.prototype.init=function(t){var e=this;this.connection=t;var i=function(i,r,n,o){t[n]([i],function(t){o[i]=t,e.changed(i,r,t)})};t.getRegisteredClients([],function(t){var r,n;for(e.ids={},r=0;r<t.length;r++)n=t[r],e.ids[n]=!0,i(n,"meta","getMetadata",e.metas),i(n,"subs","getSubscriptions",e.subs);e.changed(null,"ids",null)})},v.prototype.getName=function(t){var e=this.metas[t];return e&&e["samp.name"]?e["samp.name"]:"["+t+"]"};var y=function(t,e,i,r){this.name=t,this.meta=e,this.callableClient=i,this.subs=r,this.regTextNodes=[],this.whenRegs=[],this.whenUnregs=[],this.connection=void 0,this.onreg=void 0,this.onunreg=void 0},b=function(t,e){var i,r,n=t.regTextNodes;for(i=0;i<n.length;i++)r=n[i],r.innerHTML="",r.appendChild(document.createTextNode(e))};y.prototype.setConnection=function(t){var e=this;if(this.connection&&(this.connection.close(),this.onunreg))try{this.onunreg()}catch(t){}if(this.connection=t,t&&(t.onclose=function(){if(e.connection=null,e.onunreg)try{e.onunreg()}catch(t){}e.update()},this.meta&&t.declareMetadata([this.meta]),this.callableClient&&(this.callableClient.init&&this.callableClient.init(t),t.setCallable(this.callableClient,function(){t.declareSubscriptions([e.subs])})),this.onreg))try{this.onreg(t)}catch(t){}this.update()},y.prototype.register=function(){var t=this,e=function(e){b(t,"no ("+e.toString()+")")},i=function(e){t.setConnection(e),b(t,e?"Yes":"No")};C(this.name,i,e)},y.prototype.unregister=function(){this.connection&&(this.connection.unregister([]),this.setConnection(null))},y.prototype.createRegButtons=function(){var t=this,e=document.createElement("button");e.setAttribute("type","button"),e.appendChild(document.createTextNode("Register")),e.onclick=function(){t.register()},this.whenUnregs.push(e);var i=document.createElement("button");i.setAttribute("type","button"),i.appendChild(document.createTextNode("Unregister")),i.onclick=function(){t.unregister()},this.whenRegs.push(i);var r=document.createElement("span");this.regTextNodes.push(r);var n=document.createDocumentFragment();n.appendChild(e),n.appendChild(document.createTextNode(" ")),n.appendChild(i);var o=document.createElement("span");return o.innerHTML=" <strong>Registered: </strong>",n.appendChild(o),n.appendChild(r),this.update(),n},y.prototype.update=function(){var t,e=!!this.connection,i=e?this.whenRegs:this.whenUnregs,r=e?this.whenUnregs:this.whenRegs;for(t=0;t<i.length;t++)i[t].removeAttribute("disabled");for(t=0;t<r.length;t++)r[t].setAttribute("disabled","disabled");b(this,"No")},y.prototype.runWithConnection=function(t,e){var i=this,r=function(e){
i.setConnection(e),t(e)},n=function(t){i.setConnection(void 0),e(t)},o=function(e){t(i.connection)},s=function(t){C(this.name,r,n)};this.connection?this.connection.getRegisteredClients([],o,s):C(this.name,r,n)},y.prototype.onHubAvailability=function(t,e){return n.ping(t),setInterval(function(){n.ping(t)},e)};var x=function(t,e){var i,r=function(t,e){if(t==e)return!0;if("*"===t)return!0;var r,n=/^(.*)\.\*$/.exec(i);return!(!n||(r=n[1],r!==e.substring(0,r.length)))};for(i in t)if(r(i,e))return!0;return!1},C=function(t,e,r){var n=new p,o=new d(i+"register"),s={"samp.name":t};o.addParam(s),o.checkParams([TYPE_MAP]);var a=function(t){var i;try{i=new g(t)}catch(t){return void r(t)}e(i)};n.execute(o,a,r)},_=function(t){var e=new p,r=new d(i+"ping"),n=function(e){t(!0)},o=function(e){t(!1)};e.execute(r,n,o)},w={};return w.XmlRpcRequest=d,w.XmlRpcClient=p,w.Message=f,w.TYPE_STRING=TYPE_STRING,w.TYPE_LIST=TYPE_LIST,w.TYPE_MAP=TYPE_MAP,w.register=C,w.ping=_,w.isSubscribed=x,w.Connector=y,w.CallableClient=m,w.ClientTracker=v,w}();return r("samp",function(){}),r("Services/SampCore",["jquery","underscore-min","../Parser/JsonProcessor","../Gui/dialog/ErrorDialog","samp","jquery.ui"],function(t,e,i,r){function o(){var e=new n.ClientTracker,i=e.callHandler;return i["samp.app.ping"]=function(t,i,r){if(r)return{text:"ping to you, "+e.getName(t)}},i["table.load.votable"]=function(t,e,i){u||r.open("votable2geojson plugin base url isn't defined")},i["image.load.fits"]=function(t,e,i){},i["coord.pointAt.sky"]=function(t,e,i){c=!0;var r=e["samp.params"],n=parseFloat(r.ra),o=parseFloat(r.dec),s=[n,o],h=[];a.getCoordinateSystem().get3DFromWorld(s,h),l.center3d=h,l.computeViewMatrix(),a.getRenderContext().requestFrame()},i["samp.hub.event.unregister"]=function(e,i,r){t("#registerSamp").removeAttr("disabled").button("refresh"),t("#unregisterSamp").attr("disabled","disabled").button("refresh"),t("#sampInvoker").toggleClass("selected")},e}function s(){var e=o(),i={receiveNotification:function(i,r){e.receiveNotification(i,r);"samp.hub.event.subscriptions"===r["samp.mtype"]&&(t("#unregisterSamp").removeAttr("disabled").button("refresh"),t("#registerSamp").attr("disabled","disabled").button("refresh"),t("#sampInvoker").addClass("selected"))},receiveCall:function(t,i,r){e.receiveCall(t,i,r)},receiveResponse:function(t,i,r){e.receiveResponse(t,i,r)},init:function(t){e.init(t)}},r={"samp.name":"Mizar","samp.description.text":"Module for Interactive visualiZation from Astronomical Repositories","mizar.version":"v0.1","author.affiliation":"CNES/TPZ","home.page":"http://github.com/TPZF/RTWeb3D"},s=e.calculateSubscriptions();return h=new n.Connector("Mizar",r,i,s),h.regTextNodes.push(t("#sampResult")[0]),h}var a,l,h,u,c=!1;return{initSamp:s,sendImage:function(t){if(this.isConnected()){var e=new n.Message("image.load.fits",{url:t});return h.connection.notifyAll([e]),"Image has been sent"}return"Connect to SAMP Hub first"},sendVOTable:function(t,e){if(this.isConnected()){var i=new n.Message("table.load.votable",{url:e+"&media=votable"});return h.connection.notifyAll([i]),"VOTable has been sent"}return"Connect to SAMP Hub first"},highlightFeature:function(t,e){},isConnected:function(){return h.connection}}}),r("Services/SelectionToolCore",["jquery","../Utils/UtilsIntersection","../Utils/Numeric","../Layer/VectorLayer","../Renderer/FeatureStyle","../Renderer/Ray","../Renderer/glMatrix"],function(t,e,i,r,n,o){var s,a,l,h=function(t){s=t.ctx,a=s.getNavigation(),l=t.onselect,this.activated=t.activated||!1,this.renderContext=s.getRenderContext(),this.coordinateSystem=s.getCoordinateSystem();var i;i=t&&t.style?t.style:new n,i.zIndex=2,this.selectionLayer=new r({style:i,visible:!0}),s.globe.addLayer(this.selectionLayer),this.selectionFeature=null,this.radius=null,this.pickPoint=null,this.geoRadius=null,this.geoPickPoint=null;var o,h=this,u=!1;this.renderContext.canvas.addEventListener("mousedown",function(t){var i=[t.layerX,t.layerY],r=s.getLonLatFromPixel(t.layerX,t.layerY);if(h.activated||h.selectionFeature)if(h.activated)a.stop(),u=!0,h.pickPoint=i,h.geoPickPoint=r,h.radius=0,o="resize";else{var n=e.pointInRing(r,h.selectionFeature.geometry.coordinates[0]);if(!n)return;a.stop(),u=!0;for(var l=!1,c=0;c<h.selectionFeature.geometry.coordinates[0].length;c++){var d=h.selectionFeature.geometry.coordinates[0][c];l|=e.pointInSphere(s,r,d,20)}o=l?"resize":"move"}}),this.renderContext.canvas.addEventListener("mousemove",function(t){if(u){var e=s.getLonLatFromPixel(t.layerX,t.layerY);"resize"===o?(h.radius=Math.sqrt(Math.pow(t.layerX-h.pickPoint[0],2)+Math.pow(t.layerY-h.pickPoint[1],2)),h.computeGeoRadius(e)):"move"===o&&(h.pickPoint=[t.layerX,t.layerY],h.geoPickPoint=s.getLonLatFromPixel(t.layerX,t.layerY)),h.updateSelection()}}),this.renderContext.canvas.addEventListener("mouseup",function(t){if(u){var e=(s.getLonLatFromPixel(t.layerX,t.layerY),h.computeSelection());h.activated&&l&&l(e),a.start(),u=!1}})};return h.prototype.computeGeoRadius=function(t){var e=vec3.dot(vec3.normalize(this.coordinateSystem.get3DFromWorld(t)),vec3.normalize(this.coordinateSystem.get3DFromWorld(this.geoPickPoint))),r=Math.acos(e);this.geoRadius=i.toDegree(r)},h.prototype.computeSelection=function(){var t=this.renderContext,e=mat4.create();mat4.inverse(t.viewMatrix,e);var i=[e[12],e[13],e[14]];mat4.multiply(t.projectionMatrix,t.viewMatrix,e),mat4.inverse(e);for(var r=2/t.canvas.width,n=2/t.canvas.height,s=[[(this.pickPoint[0]-this.radius)*r-1,(t.canvas.height-this.pickPoint[1]-this.radius)*n-1,1,1],[(this.pickPoint[0]-this.radius)*r-1,(t.canvas.height-this.pickPoint[1]+this.radius)*n-1,1,1],[(this.pickPoint[0]+this.radius)*r-1,(t.canvas.height-this.pickPoint[1]+this.radius)*n-1,1,1],[(this.pickPoint[0]+this.radius)*r-1,(t.canvas.height-this.pickPoint[1]-this.radius)*n-1,1,1]],a=[0,0,0],l=0;l<4;l++){mat4.multiplyVec4(e,s[l]),vec3.scale(s[l],1/s[l][3]),vec3.subtract(s[l],i,s[l]),vec3.normalize(s[l]);var h=new o(i,s[l]),u=h.computePoint(h.sphereIntersect(a,this.coordinateSystem.getGeoide().getRadius()));s[l]=this.coordinateSystem.getWorldFrom3D(u)}return s},h.prototype.updateSelection=function(){this.selectionFeature&&this.selectionLayer.removeFeature(this.selectionFeature);var t=this.computeSelection();t.push(t[0]),this.selectionFeature={geometry:{gid:"selectionShape",coordinates:[t],type:"Polygon",crs:{type:"name",properties:{name:s.getCoordinateSystem().getGeoideName()}}},type:"Feature"},this.selectionLayer.addFeature(this.selectionFeature)},h.prototype.toggle=function(){this.activated=!this.activated,this.activated?t(this.renderContext.canvas).css("cursor","url(css/images/selectionCursor.png)"):t(this.renderContext.canvas).css("cursor","default")},h.prototype.clear=function(){this.selectionFeature&&this.selectionLayer.removeFeature(this.selectionFeature),this.pickPoint=null,this.radius=null,this.geoPickPoint=null,this.geoRadius=null},h}),r("NameResolver/AbstractNameResolver",[],function(){var t=function(t){this.ctx=t};return t.prototype.handle=function(t){throw"handle from NameResolver not implemented"},t.prototype.remove=function(){throw"remove from NameResolver not implemented"},t}),r("NameResolver/CDSNameResolver",["jquery","underscore-min","../Utils/Constants","../Utils/Utils","./AbstractNameResolver"],function(t,e,i,r,n){var o=function(t){n.prototype.constructor.call(this,t)};return r.inherits(n,o),o.prototype.handle=function(r){var n=(this.ctx,r.objectName),o=r.onError,s=r.onComplete,a=r.onSuccess,l=r.searchLayer,h=r.zoomTo,u="http://cdsweb.u-strasbg.fr/cgi-bin/nph-sesame/-oxp/A?"+n;t.ajax({type:"GET",url:u,dataType:"xml",success:function(r){var s=t(r).find("Target"),u=t(s).find("name").text(),c=[];t(s).find("Resolver").each(function(i){var r=this,n=t(r).find("jradeg"),o=t(r).find("jdedeg");if(!e.isEmpty(n.text())&&!e.isEmpty(o.text())){n=parseFloat(n.text()),o=parseFloat(o.text());var s={};s.ra=n,s.dec=o,s.credit=t(r).attr("name"),c.push(s)}});var d={totalResults:c.length,type:"FeatureCollection",features:[]};if(e.each(c,function(t){d.features.push({type:"Feature",geometry:{coordinates:[t.ra,t.dec],type:i.GEOMETRY.Point,crs:{type:"name",properties:{name:i.CRS.Equatorial}}},properties:{identifier:"CDS0",name:u,credits:'Powered by <a href="http://cdsweb.u-strasbg.fr/cgi-bin/Sesame">Sesame API</a> ('+t.credit+")"}})}),"FeatureCollection"===d.type&&d.features.length>0){var p=d.features[0],f=function(){l(n,a,o,d)};h(p.geometry.coordinates[0],p.geometry.coordinates[1],i.CRS.Equatorial,f,d)}else l(n,a,o,d)},error:function(t){l(n,a,o),console.error(t.responseText)},complete:function(t,e){s&&s(t)}})},o.prototype.remove=function(){},o}),r("NameResolver/DictionaryNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver","../Layer/VectorLayer","../Renderer/FeatureStyle","../Utils/Constants"],function(t,e,i,r,n,o,s){var a,l=function(e){var i=e.getContextConfiguration().nameResolver.baseUrl.indexOf("json")>=0;if(i){var r=e.getContextConfiguration().nameResolver.baseUrl;t.ajax({type:"GET",dataType:"json",url:r,success:function(t){a=t},error:function(t){console.error(t)}})}else a=null},h=function(t){r.prototype.constructor.call(this,t),a=l(t)};return i.inherits(r,h),h.prototype.handle=function(t){var i=this.ctx,r=t.objectName,n=t.onError,o=(t.onComplete,t.onSuccess),l=t.searchLayer,h=t.zoomTo,u=e.find(a.features,function(t){return t.properties.Name.toLowerCase()===r.toLowerCase()});if(u){var c=parseFloat(u.properties.center_lon),d=parseFloat(u.properties.center_lat);u.geometry.crs={type:"name",properties:{name:i.getCoordinateSystem().getGeoideName()}};var p=function(){l(r,o,n,{features:[u]})};h(c,d,s.CRS.Mars_2000,p,{features:[u]})}else l(r,o,n)},h.prototype.remove=function(){a=null},h}),r("NameResolver/IMCCENameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver","../Utils/Constants"],function(t,e,i,r,n){var o=function(t){r.prototype.constructor.call(this,t)};return i.inherits(r,o),o.prototype.handle=function(i){var r=i.objectName,o=i.onError,s=i.onComplete,a=i.onSuccess,l=i.searchLayer,h=i.zoomTo,u="https://api.ssodnet.imcce.fr/quaero/1/sso?q="+r+"&from=Mizar";t.ajax({type:"GET",url:u,dataType:"json",success:function(i){function s(t,i){var r=[],n=0,s=t.length;0===s?o():e.each(t,function(t){u(t,function(t){n++,e.isEmpty(t)||r.push(t),n===s&&i(r)})})}function u(i,r){var n=i.type,o=i.id,s=i.name;if(t.inArray(n,["Planet","Asteroid","Satellite","Star","Comet"])!==-1){var a="https://api.ssodnet.imcce.fr/quaero/1/sso/"+o+"/resolver";t.ajax({type:"GET",url:a,dataType:"json",success:function(t){var i=t.geometry.coordinates,a=360*i[0]/24,l=i[1];if(e.isNumber(a)&&e.isNumber(l)){a=parseFloat(a),l=parseFloat(l);var h={};h.ra=a,h.dec=l,h.credits='Powered by <a href="http://vo.imcce.fr/webservices/ssodnet/?quaero" target="_blank">SsODNet/Quaero API</a>.',h.id=o,h.type=n,h.name=s,r(h)}},error:function(t){console.error(t.responseText)}})}else r()}function c(t){var i={totalResults:t.length,type:"FeatureCollection",features:[]};if(e.each(t,function(t){i.features.push({type:"Feature",geometry:{coordinates:[t.ra,t.dec],type:"Point",crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{identifier:t.id,type:t.type,name:t.name,credits:t.credits}})}),"FeatureCollection"===i.type&&i.features.length>0){var s=i.features[0],u=function(){l(r,a,o,i)};h(s.geometry.coordinates[0],s.geometry.coordinates[1],n.CRS.Equatorial,u,i)}else o()}var d=i.data;s(d,c)},error:function(t){l(r,a,o),console.error(t.responseText)},complete:function(t){s&&s(t)}})},o.prototype.remove=function(){},o}),r("NameResolver/DefaultNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver"],function(t,e,i,r){var n=function(t){r.prototype.constructor.call(this,t)};return i.inherits(r,n),n.prototype.handle=function(e){var i=this.ctx,r=e.objectName,n=e.onError,o=e.onComplete,s=e.onSuccess,a=e.searchLayer,l=e.zoomTo,h=i.getMizarConfiguration().nameResolver.baseUrl+"/"+r+"/EQUATORIAL";t.ajax({type:"GET",url:h,success:function(t){if("FeatureCollection"===t.type){var e=t.features[0],i=function(){a(r,s,n,t)};l(e.geometry.coordinates[0],e.geometry.coordinates[1],i,t)}else n()},error:function(t){a(r,s,n),console.error(t.responseText)},complete:function(t,e){o&&o(t)}})},n.prototype.remove=function(){},n}),r("NameResolver/NameResolver",["jquery","underscore-min","../Renderer/FeatureStyle","../Layer/VectorLayer","../Tiling/HEALPixBase","jquery.ui","./CDSNameResolver","./DictionaryNameResolver","./IMCCENameResolver","./DefaultNameResolver"],function(t,i,r,n,o){function s(t,e,i){m={geometry:{coordinates:[t,e],type:c.GEOMETRY.Point,crs:{type:"name",properties:{name:i}}},type:"Feature"},g.addFeature(m)}function a(t,e,i,r){var n;t=t.replace(/\s{2,}/g," ");var s=new RegExp("\\d{1,2}[h|:]\\d{1,2}[m|:]\\d{1,2}([\\.]\\d+)?s?\\s[-+]?[\\d]+[°|:]\\d{1,2}['|:]\\d{1,2}([\\.]\\d+)?\"?","g"),a=/^healpix\((\d)+,(\d+)\)/,u=/^(-?\d+(\.\d+)?),?\s(-?\d+(\.\d+)?)/,d=/^layer:(.)*?/,p=a.exec(t),f=u.exec(t);d.exec(t);if(p){var g=parseInt(p[1],10),m=parseInt(p[2],10),y=Math.pow(2,g),b=m&y*y-1,x=o.compress_bits(b),C=o.compress_bits(b>>>1),_=m>>>2*g,w=.5,T=.5,A=o.fxyf((x+w)/y,(C+T)/y,_);n=[],c.getContextManager().getCrs().getWorldFrom3D(A,n),h(n[0],n[1],c.getContextManager().getCrs().getGeoideName(),e)}else if(t.match(s)){var I=t.split(" ");I[0]=I[0].replace(/h|m|:/g," "),I[0]=I[0].replace("s",""),I[1]=I[1].replace(/°|'|:/g," "),I[1]=I[1].replace('"',""),n=[],c.getContextManager().getCrs().getDecimalDegFromSexagesimal([I[0],I[1]],n),h(n[0],n[1],c.getContextManager().getCrs().getGeoideName(),e)}else if(f){var M=parseFloat(f[1]),S=parseFloat(f[3]),P=[M,S];h(P[0],P[1],c.getContextManager().getCrs().getGeoideName(),e)}else{var E={objectName:t,onError:i,onComplete:r,onSuccess:e,searchLayer:l,zoomTo:h};v?v.handle(E):c.publish("plugin:not_found","No name resolver found")}}function l(t,e,r,n){var o=c.getLayerManager().searchOnLayerDescription(t,c.getContextManager().getMode());if(0===o.length&&(!n||0===n.totalResults))return void(r&&r());o=i.sortBy(o,function(t){return"background"===t.category?0:1});var s;n&&"FeatureCollection"===n.type?s=n:(s={},s.type="FeatureCollection",s.features=[]),i.each(o,function(t){s.features.push({type:"Feature",properties:{type:"layer",name:t.name,description:t.description,layerType:t.type,visible:t.visible,background:"background"===t.category}})}),e(s)}function h(t,e,i,r,n){if(null!==n)for(var o=0;o<n.features.length;)n.features[o].geometry.coordinates=c.getContextManager().getCrs().convert(n.features[o].geometry.coordinates,i,c.getContextManager().getCrs().getGeoideName()),n.features[o].geometry.crs.properties.name=i,o++;var a=function(){s(t,e,i),r&&r.call(this,n)};if([t,e]=c.getContextManager().getCrs().convert([t,e],i,c.getContextManager().getCrs().getGeoideName()),c.getContextManager().getMode()===c.CONTEXT.Sky)c.getContextManager().getNavigation().zoomTo([t,e],{fov:f,duration:p,callback:a});else{var l=c.getContextManager().getNavigation().getDistance();c.getContextManager().getNavigation().zoomTo([t,e],{distance:l,duration:p,callback:a})}}function u(){m&&(g.removeFeature(m),m=null)}var c,d,p,f,g,m,v=null;return{init:function(t){d?console.error("Name resolver is already initialized"):(c=t,this.setContext(c.getContextManager().getActivatedContext()))},remove:function(){d&&(c.getContextManager().getActivatedContext().globe.removeLayer(g),void 0!==v&&v.remove(),c.getContextManager().getActivatedContext().unsubscribe("modifiedNavigation",u),d=null)},goTo:a,zoomTo:h,setContext:function(t){this.remove(),d=t;var i,o;"undefined"!=typeof d.getContextConfiguration().nameResolver?(o=e(d.getContextConfiguration().nameResolver.jsObject),i=!1):(o=e("gw/NameResolver/DefaultNameResolver"),i=!0),v=new o(d);var s=new r({iconUrl:t.getMizarConfiguration().mizarBaseUrl+"css/images/target.png",fillColor:[1,1,1,1]});g=new n({style:s,visible:!0}),c.getContextManager().getActivatedContext().globe.addLayer(g),p=i?3e3:d.getContextConfiguration().nameResolver.duration,f=i?15:d.getContextConfiguration().nameResolver.zoomFov,t.subscribe("modifiedNavigation",u)}}}),r("ReverseNameResolver/AbstractReverseNameResolver",[],function(){var t=function(t){this.ctx=t};return t.prototype.handle=function(){throw"handle from AbstractReverseNameResolver not implemented"},t.prototype.remove=function(){throw"remove from AbstractReverseNameResolver not implemented"},t}),r("ReverseNameResolver/CDSReverseNameResolver",["jquery","underscore-min","../Utils/Constants","../Utils/Utils","./AbstractReverseNameResolver","../Tiling/HEALPixBase"],function(t,e,i,r,n,o){var s=15,a=null,l=6e3,h=function(t){n.prototype.constructor.call(this,t)};return r.inherits(n,h),h.prototype.handle=function(e){var r=Date.now(),n=r-l;if(null!==a&&n<=a)return void(e&&e.error&&e.error({status:503}));var s=this,h=e.maxOrder,u=e.pos,c=e.mizarAPI;u=c.getContextManager().getCrs().convert(u,c.getContextManager().getCrs().getGeoideName(),c.CRS.Equatorial);var d=[];c.getContextManager().getCrs().getSexagesimalFromDeg(u,d),d[0]=d[0].replace("h ",":"),d[0]=d[0].replace("m ",":"),d[0]=d[0].replace("s",""),d[1]=d[1].replace("° ",":"),d[1]=d[1].replace("' ",":"),d[1]=d[1].replace('"',"");var p=1/3600,f=1800,g=Math.pow(2,h),m=o.getPixRes(g),v=m>f?f:m/2;v*=p;var y=c.getContextManager().getActivatedContext().getContextConfiguration().reverseNameResolver.baseUrl;y=y.replace("{coordinates}",d[0]+" "+d[1]),y=y.replace("{radius}",v),t.ajax({type:"GET",url:y,success:function(t){a=Date.now();var r=t.indexOf("("),n=t.indexOf(","),o=t.indexOf("/"),l=t.substring(0,o),h=t.substring(o+1,r),u=parseFloat(t.substring(r+1,n)),c=t.substring(n+1,t.length-2),d=l.split(" "),p=parseFloat(d[0]),f=parseFloat(d[1]),g=parseFloat(d[2]),m=parseFloat(d[3]),v=parseFloat(d[4]),y=parseFloat(d[5]),b=s._parseRa(p,f,g),x=s._parseDec(m,v,y),C={totalResults:1,type:"FeatureCollection",features:[{type:"Feature",geometry:{coordinates:[b,x],type:i.GEOMETRY.Point,crs:{type:"name",properties:{name:i.CRS.Equatorial}}},properties:{title:h,magnitude:u,credits:"CDS",seeAlso:"http://simbad.u-strasbg.fr/simbad/sim-id?Ident="+h,type:c,identifier:h}}]};e&&e.success&&e.success(C)},error:function(t,i,r){e&&e.error&&e.error(t)}})},h.prototype._parseRa=function(t,e,i){var r=parseInt(t),n=(i/60+e)/60;return t<0||parseFloat(t)===-0?(n=t-n,r=-r):n=r+n,n*s},h.prototype._parseDec=function(t,e,i){var r=parseInt(t),n=(i/60+e)/60;return t<0||parseFloat(t)===-0?(n=t-n,r=-r):n=r+n,n},h.prototype.remove=function(){},h}),r("ReverseNameResolver/DefaultReverseNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractReverseNameResolver"],function(t,e,i,r){var n=function(t){r.prototype.constructor.call(this,t)};return i.inherits(r,n),n.prototype.handle=function(e){var i=e.maxOrder,r=e.equatorialCoordinates,n=e.context,o=n.getMizarConfiguration().reverseNameResolver.baseUrl+"/EQUATORIAL/"+r[0]+" "+r[1]+";"+i;t.ajax({type:"GET",url:o,success:function(t){e&&e.success&&e.success(t)},error:function(t,i,r){e&&e.error&&e.error(t)}})},n.prototype.remove=function(t){},n}),r("ReverseNameResolver/ReverseNameResolver",["jquery","./CDSReverseNameResolver","./DefaultReverseNameResolver"],function(t){var i,r,n=null;return{init:function(t){i=t,this.setContext(i.getContextManager().getActivatedContext())},sendRequest:function(t,e){if(i.getContextManager().getMode()===i.CONTEXT.Sky){var r=3;i.getContextManager().getScene().tileManager.visitTiles(function(t){r<t.order&&(r=t.order)}),e.maxOrder=r,e.pos=t,e.mizarAPI=i,n?n.handle(e):i.publish("plugin:not_found","No reserve name resolver found")}else console.error("Not implemented yet"),e&&e.error&&e.error()},setContext:function(t){r=t;var i;i=e("undefined"!=typeof r.getContextConfiguration().reverseNameResolver?r.getContextConfiguration().reverseNameResolver.jsObject:["./DefaultReverseNameResolver"]),n=new i(r)}}}),r("Services/ServiceFactory",["../Utils/Constants","../Services/FitsVisu","../Services/HistogramCore","../Services/ImageProcessingCore","../Services/MeasureToolPlanetCore","../Services/MeasureToolSkyCore","../Services/MocBase","../Services/MollweideViewerCore","../Services/PickingManagerCore","../Services/SampCore","../Services/SelectionToolCore","../NameResolver/NameResolver","../ReverseNameResolver/ReverseNameResolver"],function(t,e,i,r,n,o,s,a,l,h,u,c,d){return{create:function(p,f){var g;switch(p){case t.SERVICE.FitsVisu:g=e;break;case t.SERVICE.Histogram:g=i;break;case t.SERVICE.ImageProcessing:g=r;break;case t.SERVICE.MeasureToolPlanet:g=n;break;case t.SERVICE.MeasureToolSky:g=o;break;case t.SERVICE.MocBase:g=s;break;case t.SERVICE.MollweideViewer:g=a;break;case t.SERVICE.PickingManager:g=l;break;case t.SERVICE.Samp:g=h;break;case t.SERVICE.SelectionTool:g=new u(f);break;case t.SERVICE.NameResolver:g=c;break;case t.SERVICE.ReverseNameResolver:g=d;break;default:throw"Cannot retrieve service "+p}return g}}}),r("Layer/PlanetLayer",["jquery","underscore-min","./AbstractLayer","../Crs/CoordinateSystemFactory","./WMSLayer","./WCSElevationLayer","../Utils/Utils","../Services/ServiceFactory","../Utils/Constants"],function(t,e,i,r,n,o,s,a,l){var h=function(e){e.coordinateSystem=e.hasOwnProperty("coordinateSystem")?r.create(e.coordinateSystem):r.create({geoideName:l.CRS.WGS84}),i.prototype.constructor.call(this,l.LAYER.Planet,e),this.name=e.name,this.baseImageries=[],this.layers=[],this.category="Planets",this.nameResolver=e.nameResolver,this.typeLayer="Planet";for(var s=0;s<e.baseImageries.length;s++){var a=e.baseImageries[s];a=t.extend({},e,a);var h=new n(a);h.background=!0,h.category="background",h.type="WMS",this.baseImageries.push(h)}e.elevation&&(this.elevationLayer=new o(e.elevation))};return s.inherits(i,h),h.prototype._attach=function(t){i.prototype._attach.call(this,t);var r=e.findWhere(this.baseImageries,{visible:!0});r||(r=this.baseImageries[0]),this.globe.setBaseImagery(r),this.elevationLayer&&this.globe.setBaseElevation(this.elevationLayer),r.setVisible(!0);for(var n=0;n<this.layers.length;n++)this.globe.addLayer(this.layers[n])},h.prototype._detach=function(){this.globe.setBaseImagery(null);for(var t=0;t<this.layers.length;t++)this.globe.removeLayer(this.layers[t]);i.prototype._detach.call(this)},h}),r("Layer/WMSElevationLayer",["../Utils/Utils","./WMSLayer"],function(t,e){var i=function(t){t.format="image/x-aaigrid",t.tilePixelSize=t.tilePixelSize||33,e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.parseElevations=function(t){for(var e=[],i=t.trim().split("\n"),r=5;r<i.length;r++)for(var n=i[r].trim().split(/\s+/),o=0;o<n.length;o++)e.push(parseInt(n[o],10));return e},i}),r("Layer/JsVotable/utils",[],function(){var t={};return t.inherits=function(t,e){function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},t.makeHttpObject=function(){try{return new XMLHttpRequest}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}throw new Error("The object creation for making HTTP requests has failed.")},t.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.findValueByKeyword=function(t,e){var r=void 0;for(i=0;i<t.length;i++){var n=t[i];if(n[0]===e){r=n[1];break}}return r},t.parseXML=function(t){if(document.implementation&&document.implementation.createDocument)xmlDoc=(new DOMParser).parseFromString(t,"text/xml");else{if(!window.ActiveXObject)return alert("Your browser cannot handle this script"),null;xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.loadXML(t)}return xmlDoc},t}),r("Layer/JsVotable/cache",[],function(){var t=function(){this.nodeID={},this.nodeName={},this.warnings=[]};return t.prototype.getEltsByID=function(){return this.nodeID},t.prototype.getEltsByName=function(){return this.nodeName},t.prototype.getWarnings=function(){return this.warnings},t.prototype.addEntryID=function(t,e){this.nodeID[t]=e},t.prototype.addEntryName=function(t,e){this.nodeName.hasOwnProperty(t)?this.nodeName[t].push(e):(this.nodeName[t]=[],this.nodeName[t].push(e))},t.prototype.addWarning=function(t){this.warnings.push(t)},t}),r("Layer/JsVotable/abstractNode",["./utils","./cache"],function(t,e){var i=function(t){if(this.attributes={},null!=t&&1==t.nodeType){for(var e=0,i=t.attributes.length;e<i;e++){var n=t.attributes[e];this.attributes[n.name]=n.value}if(this.attributes.hasOwnProperty("ID")){var o=r.getInstance();o.addEntryID(this.attributes.ID,this)}if(this.attributes.hasOwnProperty("name")){var o=r.getInstance();o.addEntryName(this.attributes.name,this)}}};i.prototype.getAttributes=function(){return this.attributes},i.prototype.hasAttribute=function(t){return this.attributes.hasOwnProperty(t)},i.prototype.hasAttributes=function(){return 0!=Object.keys(this.attributes).length},i.prototype.getCache=function(){return r.getInstance()};var r=function(){function t(){var t=new e;return t}var i;return{getInstance:function(){return i||(i=t()),i}}}();return i}),r("Layer/JsVotable/description",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t),this.value;var i=t.childNodes[0];null!=i&&3==i.nodeType&&(this.value=null==i.textContent?null:i.textContent.trim())};return t.inherits(e,i),i.prototype.getContent=function(){return this.value},i}),r("Layer/JsVotable/fieldref",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.ref=function(){return this.attributes.ref},i.prototype.ucd=function(){return this.attributes.ucd},i.prototype.utype=function(){return this.attributes.utype},i}),r("Layer/JsVotable/paramref",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.ref=function(){return this.attributes.ref},i.prototype.ucd=function(){return this.attributes.ucd},i.prototype.utype=function(){return this.attributes.utype},i}),r("Layer/JsVotable/min",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.value=function(){return this.attributes.value},i.prototype.inclusive=function(){return this.attributes.inclusive},i}),r("Layer/JsVotable/max",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.value=function(){return this.attributes.value},i.prototype.inclusive=function(){return this.attributes.inclusive},i}),r("Layer/JsVotable/option",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t),this.options=r(t)},r=function(t){for(var e=[],r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType){var o=n.localName;"OPTION"==o?e.push(new i(n)):this.getCache().addWarning("unknown element "+o+" in Option node")}}return e};return t.inherits(e,i),i.prototype.name=function(){return this.attributes.name},i.prototype.value=function(){return this.attributes.value},i.prototype.getOptions=function(){return this.options},i}),r("Layer/JsVotable/values",["./utils","./abstractNode","./min","./max","./option"],function(t,e,i,r,n){var o=function(t){e.prototype.constructor.call(this,t);var i=s(t);this.min=i[0],this.max=i[1],this.options=i[2]},s=function(t){for(var e,o,s=[],a=0;null!=t&&a<t.childNodes.length;a++){var l=t.childNodes[a];if(1==l.nodeType){var h=l.localName;switch(h){case"MIN":e=new i(l);break;case"MAX":o=new r(l);break;case"OPTION":s.push(new n(l));break;default:this.getCache().addWarning("unknown element "+h+" in Values node")}}}return[e,o,s]};return t.inherits(e,o),o.prototype.ID=function(){return this.attributes.ID},o.prototype.type=function(){return this.attributes.type},o.prototype.null=function(){return this.attributes.null},o.prototype.ref=function(){return this.attributes.ref},o.prototype.getMin=function(){return this.min},o.prototype.getMax=function(){return this.max},o.prototype.getOptions=function(){return this.options},o}),r("Layer/JsVotable/link",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.ID=function(){return this.attributes.ID},i.prototype.content_role=function(){return this.attributes["content-role"]},i.prototype.content_type=function(){return this.attributes["content-type"]},i.prototype.title=function(){return this.attributes.title},i.prototype.value=function(){return this.attributes.value},i.prototype.href=function(){return this.attributes.href},i.prototype.gref=function(){return this.attributes.gref},i.prototype.action=function(){return this.attributes.action},i}),r("Layer/JsVotable/field",["./utils","./abstractNode","./description","./values","./link"],function(t,e,i,r,n){var o=function(t){e.prototype.constructor.call(this,t);var i=s(t);this.description=i[0],this.values=i[1],this.links=i[2]},s=function(t){for(var e,o,s=[],a=0;null!=t&&a<t.childNodes.length;a++){var l=t.childNodes[a];if(1==l.nodeType){var h=l.localName;switch(h){case"DESCRIPTION":e=new i(l);break;case"VALUES":o=new r(l);break;case"LINK":s.push(new n(l));break;default:this.getCache().addWarning("unknown element "+h+" in Field node")}}}return[e,o,s]};return t.inherits(e,o),o.prototype.ID=function(){return this.attributes.ID},o.prototype.unit=function(){return this.attributes.unit},o.prototype.datatype=function(){return this.attributes.datatype},o.prototype.precision=function(){return this.attributes.precision},o.prototype.width=function(){return this.attributes.width},o.prototype.xtype=function(){return this.attributes.xtype},o.prototype.ref=function(){return this.attributes.ref},o.prototype.name=function(){return this.attributes.name},o.prototype.ucd=function(){return this.attributes.ucd},o.prototype.utype=function(){return this.attributes.utype},o.prototype.arraysize=function(){return this.attributes.arraysize},o.prototype.type=function(){return this.attributes.type},o.prototype.getDescription=function(){return this.description},o.prototype.getValues=function(){return this.values},o.prototype.getLinks=function(){return this.links},o}),r("Layer/JsVotable/param",["./utils","./field"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.value=function(){return this.attributes.value},i}),r("Layer/JsVotable/group",["./utils","./abstractNode","./description","./fieldref","./paramref","./param"],function(t,e,i,r,n,o){var s=function(t){e.prototype.constructor.call(this,t);var i=a(t);this.description=i[0],this.fieldrefs=i[1],this.paramrefs=i[2],this.params=i[3],this.groups=i[4]},a=function(t){for(var e,a=[],l=[],h=[],u=[],c=0;null!=t&&c<t.childNodes.length;c++){var d=t.childNodes[c];if(1==d.nodeType){var p=d.localName;switch(p){case"DESCRIPTION":e=new i(d);break;case"FIELDref":a.push(new r(d));break;case"PARAMref":l.push(new n(d));break;case"PARAM":h.push(new o(d));break;case"GROUP":u.push(new s(d));break;default:this.getCache().addWarning("unknown element "+p+" in Group node")}}}return[e,a,l,h,u]};return t.inherits(e,s),s.prototype.ID=function(){return this.attributes.ID},s.prototype.name=function(){return this.attributes.name},s.prototype.ref=function(){return this.attributes.ref},s.prototype.ucd=function(){return this.attributes.ucd},s.prototype.utype=function(){return this.attributes.utype},s.prototype.getDescription=function(){return this.description},s.prototype.getFieldrefs=function(){return this.fieldrefs},s.prototype.getParamrefs=function(){return this.paramrefs},s.prototype.getParams=function(){return this.params},s.prototype.getGroups=function(){return this.groups},s}),r("Layer/JsVotable/coosys",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t),this.value=r(t)};t.inherits(e,i);var r=function(t){for(var e,i=0;null!=t&&i<t.childNodes.length;i++){var r=t.childNodes[i];null!=r&&3==r.nodeType?e=null==r.textContent?null:r.textContent.trim():this.getCache().addWarning("unknown element "+r+" in Coosys node");
}return e};return i.prototype.ID=function(){return this.attributes.ID},i.prototype.equinox=function(){return this.attributes.equinox},i.prototype.epoch=function(){return this.attributes.epoch},i.prototype.system=function(){return this.attributes.system},i.prototype.getContent=function(){return this.value},i}),r("Layer/JsVotable/definitions",["./utils","./abstractNode","./group","./param","./coosys"],function(t,e,i,r,n){var o=function(t){e.prototype.constructor.call(this,t);var i=s(t);this.coosys=i[0],this.param=i[1]},s=function(t){for(var e=[],i=[],o=0;null!=t&&o<t.childNodes.length;o++){var s=t.childNodes[o];if(1==s.nodeType){var a=s.localName;switch(a){case"COOSYS":e.push(new n(s));break;case"PARAM":i.push(new r(s));break;default:this.getCache().addWarning("unknown element "+a+" in Definitions node")}"COOSYS"==a?e.push(new n(s)):"PARAM"==a?i.push(new r(s)):this.getCache().addWarning("unknown element "+a+" in Definitions node")}}return[e,i]};return t.inherits(e,o),o.prototype.getCoosyss=function(){return this.coosys},o.prototype.getParams=function(){return this.param},o}),r("Layer/JsVotable/info",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t);var i=t.childNodes[0];null!=i&&3==i.nodeType&&(this.value=null==i.textContent?null:i.textContent.trim())};return i.prototype.name=function(){return this.attributes.name},i.prototype.value=function(){return this.attributes.value},i.prototype.ID=function(){return this.attributes.ID},i.prototype.unit=function(){return this.attributes.unit},i.prototype.xtype=function(){return this.attributes.xtype},i.prototype.ref=function(){return this.attributes.ref},i.prototype.ucd=function(){return this.attributes.ucd},i.prototype.utype=function(){return this.attributes.utype},i.prototype.getContent=function(){return this.value},i}),r("Layer/JsVotable/td",["./utils","./abstractNode"],function(t,e){var i=function(t,i){e.prototype.constructor.call(this,t),null==i?this.value=null==t.textContent?"":t.textContent.trim():this.value=null==i?"":i.trim()};return t.inherits(e,i),i.prototype.encoding=function(){return this.attributes.encoding},i.prototype.getContent=function(){return this.value},i}),r("Layer/JsVotable/tr",["./utils","./abstractNode","./td"],function(t,e,i){var r=function(t,r){if(e.prototype.constructor.call(this,t),null==r)this.tds=n(t);else{this.tds=[];for(var o=0;o<r.length;o++)this.tds.push(new i(null,r[o]))}},n=function(t){for(var e=[],r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType){var o=n.localName;"TD"==o?e.push(new i(n)):this.getCache().addWarning("unknown element "+o+" in Tr node")}}return e};return t.inherits(e,r),r.prototype.ID=function(){return this.attributes.ID},r.prototype.getTds=function(){return this.tds},r}),r("Layer/JsVotable/abstractData",["./utils","./abstractNode"],function(t,e){var i=function(t,i){e.prototype.constructor.call(this,t),this.name=i};return t.inherits(e,i),i.prototype.getName=function(){return this.name},i}),r("Layer/JsVotable/tabledata",["./utils","./tr","./abstractData"],function(t,e,i){var r=function(t,r){if(i.prototype.constructor.call(this,t,"TableData"),null==r)this.trs=n(t);else{this.trs=[];for(var o=0;o<r.length;o++)this.trs.push(new e(null,r[o]))}},n=function(t){for(var i=[],r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType){var o=n.localName;"TR"==o?i.push(new e(n)):this.getCache().addWarning("unknown element "+o+" in TableData node")}}return i};return t.inherits(i,r),r.prototype.getTrs=function(){return this.trs},r}),r("Layer/JsVotable/converter/base64",[],function(){function t(t){"use strict";var e,i,r;return e=new ArrayBuffer(2),i=new DataView(e),r=t.join(""),i.setUint16(0,parseInt(r,2)),i.getInt16(0)}function e(t){"use strict";var e,i,r;return e=new ArrayBuffer(4),i=new DataView(e),r=t.join(""),i.setUint32(0,parseInt(r,2)),i.getInt32(0)}function i(t){"use strict";var e,i,r;return e=new ArrayBuffer(4),i=new DataView(e),r=t.join(""),i.setUint32(0,parseInt(r,2)),i.getFloat32(0)}function r(t){"use strict";var e,i,r;return e=new ArrayBuffer(8),i=new DataView(e),r=t.slice(0,32).join(""),i.setUint32(0,parseInt(r,2)),r="",r=t.slice(32,64).join(""),i.setUint32(4,parseInt(r,2)),i.getFloat64(0)}function n(t){"use strict";var e,i,r;return e=new ArrayBuffer(1),i=new DataView(e),r=t.join(""),i.setUint8(0,parseInt(r,2)),i.getUint8(0)}function o(t){"use strict";var e,i,r,o,s;for(e=t.length/8,i=[],s="",o=0,r=0;r<e;r+=1)i=t.slice(o,o+8),s=s.concat(String.fromCharCode(n(i))),i=[],o+=8;return s}function s(t){"use strict";var e,i,r;return e=new ArrayBuffer(4),i=new DataView(e),r=t.join(""),i.setUint32(0,parseInt(r,2)),i.getUint32(0)}function a(t){var e;return t>64&&t<91?e=t-65:t>96&&t<123?e=t-71:t>47&&t<58?e=t+4:43===t?e=62:47===t&&(e=63),e}var l={short:16,int:32,float:32,double:64,unsignedByte:8},h=function(t){this.ptrStream=0,this.bufferTabBits=[],this.fields=t};return h.prototype.computeDataSize=function(t,e,i){var r=0;if("char"===t)if(/\*/.test(this.fields[e].arraysize())){var n=this.streamB64(32,i);r=8*s(n),n=[]}else r=8*this.fields[e].arraysize();else r=l[t];return r},h.prototype.streamB64=function(t,e){for(var i=[],r=this.bufferTabBits.length,n=Math.ceil((t-r)/6),o=0;o<r;o+=1)i.push(this.bufferTabBits[o]);this.bufferTabBits=[];for(var o=0;o<n;o+=1){if(10==e.charCodeAt(this.ptrStream))o-=1;else for(var s=a(e.charCodeAt(this.ptrStream)),l=32;l>0;l>>=1)i.length!==t?i.push((s&l)===l?"1":"0"):this.bufferTabBits.push((s&l)===l?"1":"0");this.ptrStream+=1}return i},h.prototype.decodeValue=function(s,a,l,h){var u,c=[];switch("NULL"!=s&&(c=this.streamB64(a,h)),s){case"short":u=t(c);break;case"int":u=e(c);break;case"float":u=i(c),u=u.toFixed(this.fields[l].precision());break;case"double":u=r(c),u=u.toFixed(this.fields[l].precision());break;case"unsignedByte":u=n(c);break;case"char":u=o(c);break;case"NULL":u="NULL"}return"NaN"!==u&&"NULL"!==u&&0!==u||(u=""),u},h.prototype.decode=function(t){var e=[],i=0,r=t.length,n=this.fields.length,o=[];do{var s=this.fields[i].datatype(),a=this.computeDataSize(s,i,t);0==a&&(s="NULL");var l=this.decodeValue(s,a,i,t);o.push(l),i===n-1?(i=0,e.push(o),o=[]):i+=1}while(this.ptrStream<r);return e},h}),r("Layer/JsVotable/stream",["./utils","./abstractNode","./converter/base64","./tabledata"],function(t,e,i,r){var n=function(t){e.prototype.constructor.call(this,t),this.value=t.textContent};return t.inherits(e,n),n.prototype.type=function(){return this.attributes.type},n.prototype.href=function(){return this.attributes.href},n.prototype.actuate=function(){return this.attributes.actuate},n.prototype.encoding=function(){return this.attributes.encoding},n.prototype.expires=function(){return this.attributes.expires},n.prototype.rights=function(){return this.attributes.rights},n.prototype.getContent=function(t,e){var n;if(null==t||0==t)n=this.value;else{var o=new i(e);n=new r(null,o.decode(this.value))}return n},n}),r("Layer/JsVotable/binary",["./utils","./stream","./abstractData"],function(t,e,i){var r=function(t){i.prototype.constructor.call(this,t,"Binary"),this.stream=n(t)},n=function(t){for(var i,r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType){var o=n.localName;if("STREAM"!=o)throw"Unknown element";i=new e(n)}}return i};return t.inherits(i,r),r.prototype.getStream=function(){return this.stream},r}),r("Layer/JsVotable/binary2",["./utils","./stream","./abstractData"],function(t,e,i){var r=function(t){i.prototype.constructor.call(this,t,"Binary2"),this.stream=n(t)},n=function(t){for(var e,i=0;null!=t&&i<t.childNodes.length;i++){var r=t.childNodes[i];if(1==r.nodeType){var n=r.localName;"STREAM"==n?e=new Definitions(r):this.getCache().addWarning("unknown element "+n+" in Binary2 node")}}return e};return t.inherits(i,r),r.prototype.getStream=function(){return this.stream},r}),r("Layer/JsVotable/fits",["./utils","./abstractData","./stream"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,t,"Fits"),this.stream=n(t)},n=function(t){for(var e,i=0;null!=t&&i<t.childNodes.length;i++){var r=t.childNodes[i];if(1==r.nodeType){var n=r.localName;"STREAM"==n?e=new Definitions(r):this.getCache().addWarning("unknown element "+n+" in Fits node")}}return e};return t.inherits(e,r),r.prototype.getStream=function(){return this.stream},r.prototype.extnum=function(){return this.attributes.extnum},r}),r("Layer/JsVotable/data",["./utils","./abstractNode","./tabledata","./binary","./binary2","./fits","./info"],function(t,e,i,r,n,o,s){var a=function(t){e.prototype.constructor.call(this,t);var i=l(t);this.data=i[0],this.infos=i[1]},l=function(t){for(var e,a=[],l=0;null!=t&&l<t.childNodes.length;l++){var h=t.childNodes[l];if(1==h.nodeType){var u=h.localName;switch(u){case"TABLEDATA":e=new i(h);break;case"BINARY":e=new r(h);break;case"BINARY2":e=new n(h);break;case"FITS":e=new o(h);break;case"INFO":a.push(new s(h));break;default:this.getCache().addWarning("unknown element "+u+" in Data node")}}}return[e,a]};return t.inherits(e,a),a.prototype.getData=function(){return this.data},a.prototype.getDataImplementationName=function(){return this.data.getName()},a.prototype.getInfos=function(){return this.infos},a}),r("Layer/JsVotable/table",["./utils","./abstractNode","./description","./field","./param","./group","./link","./data","./info"],function(t,e,i,r,n,o,s,a,l){var h=function(t){e.prototype.constructor.call(this,t);var i=u(t);this.fields=i[0],this.params=i[1],this.groups=i[2],this.links=i[3],this.data=i[4],this.description=i[5],this.infos=i[6]},u=function(t){for(var e,h,u=[],c=[],d=[],p=[],f=[],g=0;null!=t&&g<t.childNodes.length;g++){var m=t.childNodes[g];if(1==m.nodeType){var v=m.localName;switch(v){case"DESCRIPTION":h=new i(m);break;case"FIELD":u.push(new r(m));break;case"PARAM":c.push(new n(m));break;case"GROUP":d.push(new o(m));break;case"LINK":p.push(new s(m));break;case"DATA":e=new a(m);break;case"INFO":f.push(new l(m));break;default:this.getCache().addWarning("unknown element "+v+" in Table node")}}}return[u,c,d,p,e,h,f]};return t.inherits(e,h),h.prototype.ID=function(){return this.attributes.ID},h.prototype.name=function(){return this.attributes.name},h.prototype.ref=function(){return this.attributes.ref},h.prototype.ucd=function(){return this.attributes.ucd},h.prototype.utype=function(){return this.attributes.utype},h.prototype.nrows=function(){return this.attributes.nrows},h.prototype.getFields=function(){return this.fields},h.prototype.getParams=function(){return this.params},h.prototype.getGroups=function(){return this.groups},h.prototype.getLinks=function(){return this.links},h.prototype.getData=function(){return this.data},h.prototype.getInfos=function(){return this.infos},h.prototype.getDescription=function(){return this.description},h}),r("Layer/JsVotable/resource",["./utils","./abstractNode","./description","./info","./table","./link","./coosys","./param","./group"],function(t,e,i,r,n,o,s,a,l){var h=function(t){e.prototype.constructor.call(this,t);var i=u(t);this.description=i[0],this.infos=i[1],this.coosyss=i[2],this.params=i[3],this.groups=i[4],this.abstractSequences=i[5]},u=function(t){for(var e,u=[],c=[],d=[],p=[],f=[],g=0,m=0;null!=t&&m<t.childNodes.length;m++){var v=t.childNodes[m];if(1==v.nodeType){var y=v.localName;switch(y){case"DESCRIPTION":e=new i(v);break;case"INFO":u.push(new r(v));break;case"COOSYS":c.push(new s);break;case"GROUP":d.push(new l);break;case"PARAM":p.push(new a);break;default:g=m}}if(0!=g)break}for(var b={},x=[],C=[],m=g;null!=t&&m<t.childNodes.length;m++){var v=t.childNodes[m];if(1==v.nodeType){var y=v.localName;switch(y){case"LINK":b.hasOwnProperty("TABLE")||b.hasOwnProperty("RESOURCE")?(b.LINKS=x,b.INFOS=C,f.push(b),b={},x=[],C=[]):x.push(new o(v));break;case"TABLE":b.TABLE=new n(v);break;case"RESOURCE":b.RESOURCE=new h(v);break;case"INFO":C.push(new r(v));break;default:this.getCache().addWarning("Unkknown element "+y+" in RESOURCE node")}}}return 0!=Object.keys(b).length&&f.push(b),[e,u,c,p,d,f]};return t.inherits(e,h),h.prototype.ID=function(){return this.attributes.ID},h.prototype.name=function(){return this.attributes.name},h.prototype.utype=function(){return this.attributes.utype},h.prototype.type=function(){return this.attributes.type},h.prototype.getDescription=function(){return this.description},h.prototype.getInfos=function(){return this.infos},h.prototype.getCoosyss=function(){return this.coosyss},h.prototype.getGroups=function(){return this.groups},h.prototype.getParams=function(){return this.params},h.prototype.getResourcesOrTables=function(){return this.abstractSequences},h}),r("Layer/JsVotable/converter/geojson",["../utils"],function(t){function e(t){function e(t){var e,i=t.getDefinitions();return null!=i&&(e=i.getCoosyss()[0]),null!=t.getCoosyss()[0]&&(e=t.getCoosyss()[0]),e}var r={type:"FeatureCollection",features:[]},n=e(t);null!=n&&(r.crs={type:"name",properties:{name:n}});for(var o=[],s=t.getResources(),a=0;a<s.length;a++)i(s[a],o);return r.features=o,r}function i(t,e){for(var n=t.getResourcesOrTables(),o=0;o<n.length;o++){var s=n[o];s.hasOwnProperty("RESOURCE")?i(s.RESOURCE,e):s.hasOwnProperty("TABLE")&&r(s.TABLE,e)}}function r(t,e){var i,r=t.getFields(),o=t.getData(),s=t.getInfos();switch(o.getDataImplementationName()){case"TableData":var a=o.getData();i=a.getTrs();break;case"Binary":var l=o.getData(),a=l.getStream().getContent(!0,r);i=a.getTrs();break;case"Binary2":o.getData();throw new Error("Binary2 not implemented");break;case"Fits":o.getData();throw new Error("Fits not implemented");break;default:throw new Error("Type of data not implemented")}n(r,s,i,e)}function n(t,e,i,r){for(var n=0;n<i.length;n++){var s=i[n].getTds();r.push(o(t,e,s))}}function o(e,i,r){function n(t){if(!(t.hasOwnProperty("RA")&&t.hasOwnProperty("DEC")&&t.hasOwnProperty("COOSYS")&&t.hasOwnProperty("ID")))throw new Error("core metadata missing "+JSON.stringify(t))}function o(t,e){var i;switch(e){case"short":case"int":case"long":i=Number.parseInt(t);break;case"float":case"double":i=Number.parseFloat(t);break;default:i=t}return i}function h(t,e){var i=t.filter(function(t){return t===e});return 0!=i.length}for(var u={type:"Feature",geometry:null,properties:{}},c={},d=0;d<r.length;d++){var p=r[d],f=e[d],g=f.getValues(),m=null!=g?g.null():null,v=f.ucd(),y=f.datatype(),b=p.getContent(),x=f.name();if(h(a,v))c.RA=Number.parseFloat(b),c.COOSYS=f.ref();else if(h(l,v))c.DEC=Number.parseFloat(b);else if(h(s,v))c.ID=b;else{var C=u.properties;b!=m&&(C[x]=o(b,y))}}c.hasOwnProperty("ID")||(c.ID=t.guid());for(var d=0;d<i.length;d++){var _=i[d];C[_.name()]=_.value()}n(c);var w={type:"Point",coordinates:[c.RA,c.DEC],crs:{type:"name",properties:{name:c.COOSYS}}};return u.geometry=w,u}var s=["meta.record","meta.id;meta.main","VOX:Image_Titleq"],a=["pos.eq.ra;meta.main","POS_EQ_RA_MAIN"],l=["pos.eq.dec;meta.main","POS_EQ_DEC_MAIN"],h=function(t){this.votable=t,this.featureCollection=e(this.votable)};return h.prototype.getGeoJSon=function(t){var e=t|!1;return JSON.stringify(this.featureCollection,null,e)},h}),r("Layer/JsVotable/votable",["./utils","./abstractNode","./definitions","./info","./resource","./description","./coosys","./group","./param","./converter/geojson"],function(t,e,i,r,n,o,s,a,l,h){function u(t){if(null==t)throw new Error("xml cannot be null");if("string"==typeof t){var e=new DOMParser;t=e.parseFromString(t,"application/xml")}else if(null==t.documentElement)throw new Error("This object is not supported");var i=t.documentElement.localName;if("VOTABLE"!=i)throw new Error("This input is not a VOTable");return t}var c=function(t){t=u(t);var i=t.documentElement;e.prototype.constructor.call(this,i);var r=d(i);this.definitions=r[0],this.infos=r[1],this.resources=r[2],this.description=r[3],this.coosyss=r[4],this.groups=r[5],this.params=r[6]},d=function(t){for(var e,h,u=t,c=[],d=[],p=[],f=[],g=[],m=0;m<u.childNodes.length;m++){var v=u.childNodes[m];if(1==v.nodeType){var y=v.localName;switch(y){case"DEFINITIONS":e=new i(v);break;case"INFO":c.push(new r(v));break;case"RESOURCE":d.push(new n(v));break;case"DESCRIPTION":h=new o(v);break;case"COOSYS":p.push(new s(v));break;case"GROUP":f.push(new a(v));break;case"PARAM":g.push(new l(v));break;default:this.getCache().addWarning("unknown element "+y+" in Votable node")}}}return[e,c,d,h,p,f,g]};return t.inherits(e,c),c.prototype.ID=function(){return this.attributes.ID},c.prototype.version=function(){return this.attributes.version},c.prototype.getInfos=function(){return this.infos},c.prototype.getDefinitions=function(){return this.definitions},c.prototype.getResources=function(){return this.resources},c.prototype.getCoosyss=function(){return this.coosyss},c.prototype.getGroups=function(){return this.groups},c.prototype.getParams=function(){return this.params},c.prototype.getDescription=function(){return this.description},c.prototype.getVotableEltByID=function(t){return this.getCache().getEltsByID()[t]},c.prototype.getVotableEltsByName=function(t){return this.getCache().getEltsByName()[t]},c.prototype.convertToGeoJSon=function(t){var e=new h(this);return e.getGeoJSon(t)},c}),r("Layer/JsVotable/JsVotable",["./votable","./binary","./binary2","./coosys","./data","./definitions","./description","./field","./fieldref","./fits","./group","./info","./link","./max","./min","./option","./param","./paramref","./resource","./stream","./table","./tabledata","./td","./tr","./values"],function(t,e,i,r,n,o,s,a,l,h,u,c,d,p,f,g,m,v,y,b,x,C,_,w,T){var A={};return A.Votable=t,A.Binary=e,A.Binary2=i,A.Coosys=r,A.Data=n,A.Definitions=o,A.Description=s,A.Field=a,A.Fieldref=l,A.Fits=h,A.Group=u,A.Info=c,A.Link=d,A.Max=p,A.Min=f,A.Option=g,A.Param=m,A.Paramref=v,A.Resource=y,A.Stream=b,A.Table=x,A.TableData=C,A.Td=_,A.Tr=w,A.Values=T,A.version={major:1,minor:1,patch:0,date:"2016-10-12",toString:function(){return this.major+"."+this.minor+"."+this.patch}},window.JsVotable=A,A}),r("Layer/JsCSV/csv",[],function(){function t(t){if(null==t)throw new Error("csv cannot be null");if("string"!=typeof t)throw new Error("This object is not supported");return t}function e(t,e,n){for(var o=t.split("\n"),s=0,a=0;a<o.length&&i(o[a],e,n.name);a++)s++;return r(o,s,e,n)}function i(t,e,i){return t.startsWith(s)||0==t.length||i.toString()==t.split(e).toString()}function r(t,e,i,r){for(var o=[],s=e;s<t.length;s++)0!==t[s].length&&o.push(n(t[s],i,r));return o}function n(t,e,i){for(var r={},n=t.split(e),s=0;s<n.length;s++)r[i.name[s]]=o(n[s],i.datatype[s]);return r}function o(t,e){var i;switch(e){case"short":case"int":case"long":i=Number.parseInt(t);break;case"float":case"double":i=Number.parseFloat(t);break;default:i=t}return i}var s="#",a=function(i,r,n){i=t(i),this.store=e(i,r,n)};return a.prototype.getStore=function(){return this.store},a.prototype.getGeoJSon=function(t,e){for(var i=t.RA,r=t.DEC,n=t.ID,o=[],s=0;s<this.store.length;s++){var a={type:"Feature",id:this.store[s][n],geometry:{type:"Point",coordinates:[this.store[s][i],this.store[s][r]],crs:{type:"name",properties:{name:e}}}},l=JSON.parse(JSON.stringify(this.store[s]));delete l[i],delete l[r],delete l[n],a.properties=l,o.push(a)}var h={type:"FeatureCollection",features:o};return h},a}),r("Layer/HipsCatLayer",["../Renderer/FeatureStyle","../Renderer/VectorRendererManager","../Utils/Utils","./AbstractLayer","../Renderer/RendererTileData","../Tiling/Tile","./JsVotable/JsVotable","./JsVotable/utils","./JsCSV/csv","../Utils/Constants"],function(t,e,i,r,n,o,s,a,l,h){function u(t,e){return t.tile.distance-e.tile.distance}var c=function(t){r.prototype.constructor.call(this,h.LAYER.HipsCat,t);var e,i=new d(t.serviceUrl+"/properties"),n=i.getProperties(),o=n.hips_order;this.serviceUrl=t.serviceUrl,this.minOrder=t.minOrder||2,this.maxOrder=Number.parseInt(o,10),this.maxRequests=t.maxRequests||4,this.invertY=t.invertY||!1;var l=a.makeHttpObject();l.open("GET",t.serviceUrl+"/metadata.xml",!1),l.send();var u=new s.Votable(l.responseXML),c=u.getResources()[0],p=c.getResourcesOrTables()[0].TABLE;for(this.fields=p.getFields(),this.raColNumber=null,this.decColNumber=null,this.sourceId=null,e=0;e<this.fields.length;e++){var f=this.fields[e].ucd();"pos.eq.ra"===f?this.raColNumber=this.fields[e].name():"pos.eq.dec"===f?this.decColNumber=this.fields[e].name():"meta.id;meta.main"===f&&(this.sourceId=this.fields[e].name())}for(this.extId="hipsCat",this.features=[],this.featuresSet={},this.freeRequests=[],this.tilesToLoad=[],e=0;e<this.maxRequests;e++)l=new XMLHttpRequest,this.freeRequests.push(l)};i.inherits(r,c);var d=function(t){this.properties={};var e,i=new XMLHttpRequest;i.open("GET",t,!1),i.send();var r=i.responseText;r.trim();var n=r.split("\n");for(e=0;null!==n&&e<n.length;e++){var o=n[e];if(null===o||!(o.indexOf("#")>-1)&&o.trim()){var s=o.split("="),a=s[0].replace(/^\s+|\s+$/g,""),l=s[1].replace(/^\s+|\s+$/g,"");this.properties[a]=l}}};d.prototype.getProperties=function(){return this.properties},c.prototype._attach=function(t){r.prototype._attach.call(this,t),this.extId+=this.id,t.tileManager.addPostRenderer(this)},c.prototype._detach=function(){this.globe.tileManager.removePostRenderer(this),r.prototype._detach.call(this)},c.prototype.launchRequest=function(t,e){var i=t.extension[this.extId];if(0!==this.freeRequests.length){i.state=c.TileState.LOADING,this.maxRequests===this.freeRequests.length&&this.globe.publishEvent("startLoad",this);var r=this.freeRequests.pop(),n=this;r.onreadystatechange=function(e){if(4===r.readyState){if(200===r.status){var o={},s={name:[],datatype:[]};n.fields.forEach(function(t){s.name.push(t.name()),s.datatype.push(t.datatype())});var a=new l(r.response,"\t",s),h=a.getGeoJSon({RA:n.raColNumber,DEC:n.decColNumber,ID:n.sourceId},"Equatorial"),u=h.features;o.features=u,o.totalResults=u.length,i.complete=o.totalResults===o.features.length;var d;for(d=o.features.length-1;d>=0;d--){var p=o.features[d],f=n.featuresSet.hasOwnProperty(p.id);f&&o.features.splice(d,1),p.properties.style=this.style,n.addFeature(p,t)}n.globe.refresh(),o.hasOwnProperty(u)&&o.features.length>0&&n.globe.publishEvent("features:added",{layer:n,features:o.features})}else r.status>=400&&(i.complete=!0,console.error(r.responseText));i.state=c.TileState.LOADED,n.freeRequests.push(r),n.maxRequests===n.freeRequests.length&&n.globe.publishEvent("endLoad",n)}},r.open("GET",e),r.send()}},c.prototype.addFeature=function(t,e){var i,r=e.extension[this.extId];this.featuresSet.hasOwnProperty(t.id)?(i=this.featuresSet[t.id],i.tiles.push(e),t=this.features[i.index]):(this.features.push(t),i={index:this.features.length-1,tiles:[e]},this.featuresSet[t.id]=i),r.featureIds.push(t.id),t.geometry.gid=t.id;var n=t.properties.style?t.properties.style:this.style;this.globe.vectorRendererManager.addGeometryToTile(this,t.geometry,n,e)},c.prototype.removeFeature=function(t,e){var i=this.featuresSet[t];if(i){var r=i.tiles.indexOf(e);if(r>=0?i.tiles.splice(r,1):console.log("HipsCatLayer internal error : tile not found when removing feature"),0===i.tiles.length){delete this.featuresSet[t];var n=this.features.pop();i.index<this.features.length&&(this.features[i.index]=n,this.featuresSet[n.id].index=i.index)}}},c.prototype.modifyFeatureStyle=function(t,e){t.properties.style=e;var i=this.featuresSet[t.id];if(i){var r;for(r=0;r<i.tiles.length;r++){var n=i.tiles[r];this.globe.vectorRendererManager.removeGeometryFromTile(t.geometry,n),this.globe.vectorRendererManager.addGeometryToTile(this,t.geometry,e,n)}}},c.TileState={LOADING:0,LOADED:1,NOT_LOADED:2,INHERIT_PARENT:3},c.prototype.generate=function(t){this.minOrder<=t.order&&t.order<=this.maxOrder&&(t.extension[this.extId]=new p(this,t,null))};var p=function(t,e,i){this.layer=t,this.parent=i,this.tile=e,this.featureIds=[],this.state=c.TileState.NOT_LOADED,this.complete=!1,this.childrenCreated=!1};return p.prototype.traverse=function(t){var e;if(this.layer.visible&&t.state===o.State.LOADED&&(this.state===c.TileState.NOT_LOADED&&this.layer.tilesToLoad.push(this),this.state===c.TileState.LOADED&&!this.complete&&t.state===o.State.LOADED&&t.children&&!this.childrenCreated)){for(e=0;e<4;e++)t.children[e].extension[this.layer.extId]||(t.children[e].extension[this.layer.extId]=new p(this.layer,t.children[e],this));this.childrenCreated=!0;var i=t.extension.renderer?t.extension.renderer.renderables:[];for(e=0;e<i.length;e++)i[e].bucket.layer===this.layer&&(i[e].hasChildren=!0)}},p.prototype.dispose=function(t,e){var i;if(this.parent&&this.parent.childrenCreated){this.parent.childrenCreated=!1;var r=this.parent.tile.extension.renderer?this.parent.tile.extension.renderer.renderables:[];for(i=0;i<r.length;i++)r[i].bucket.layer===this.layer&&(r[i].hasChildren=!1)}for(i=0;i<this.featureIds.length;i++)this.layer.removeFeature(this.featureIds[i],this.tile);this.tile=null,this.parent=null},c.prototype.buildUrl=function(t){var e;if(t.order<=0)e=this.serviceUrl+"/Norder"+t.order+"/Allsky.xml";else{e=this.serviceUrl,e+="/Norder",e+=t.order,e+="/Dir";var i=1e4*Math.floor(t.pixelIndex/1e4);e+=i,e+="/Npix",e+=t.pixelIndex,e+=".tsv"}return e},c.prototype.render=function(t){var e;if(this.visible){for(this.tilesToLoad.sort(u),e=0;e<this.tilesToLoad.length&&this.freeRequests.length>0;e++){var i=this.tilesToLoad[e].tile,r=this.buildUrl(i);r&&this.launchRequest(i,r)}this.tilesToLoad.length=0}},c}),r("Layer/GeoJsonLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,i.LAYER.GeoJSON,t),this.url=t.url,this.gid=0,t&&t.callback?this.callback=t.callback:this.callback=null,this.minLevel=t&&t.hasOwnProperty("minLevel")?t.minLevel:0,this.maxLevel=t&&t.hasOwnProperty("maxLevel")?t.maxLevel:15,this.features=[]};return t.inherits(e,r),r.prototype._attach=function(t){e.prototype._attach.call(this,t);for(var i=0;i<this.features.length;i++)this._addFeatureToRenderers(this.features[i])},r.prototype._detach=function(){for(var t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);this.features=[],e.prototype._detach.call(this)},r.prototype.addFeatureCollection=function(t){if(null===t||void 0===t)throw"Error, featureCollection is null";var e={type:"name",properties:{name:i.CRS.WGS84}},r=t.crs?t.crs:e,n=t.features;if(n)for(var o=0;o<n.length;o++)this.addFeature(n[o],r)},r.prototype.removeFeatureCollection=function(t){var e=t.features;if(e)for(var i=0;i<e.length;i++)this.removeFeature(e[i]);this.features=[]},r.prototype._addFeatureToRenderers=function(t){var e=t.geometry,i=this.style,r=t.properties;if(r&&r.style&&(i=r.style),"GeometryCollection"===e.type)for(var n=e.geometries,o=0;o<n.length;o++)this.globe.vectorRendererManager.addGeometry(this,n[o],i);else this.globe.vectorRendererManager.addGeometry(this,e,i)},r.prototype._removeFeatureFromRenderers=function(t){var e=t.geometry;if("GeometryCollection"===e.type){var i=e.geometries,r=!1;if(this.globe&&this.globe.vectorRendererManager)for(var n=0;n<i.length;n++)r=this.globe.vectorRendererManager.removeGeometry(i[n],this);return r}if(this.globe&&this.globe.vectorRendererManager)return this.globe.vectorRendererManager.removeGeometry(e,this)},r.prototype._setDataType=function(t){this.datatype||(t.geometry.type.startsWith(i.GEOMETRY.Point)?this.dataType=i.GEOMETRY.Point:this.dataType=i.GEOMETRY.LineString)},r.prototype.addFeature=function(t,e){var r=t.geometry;if(!r||!r.type)throw"Invalid GeoJson";t.geometry.crs||(t.geometry.crs=e?e:{type:"name",properties:{name:i.CRS.WGS84}}),t.geometry.gid="GeoJSON_"+this.gid,this.gid++,this._setDataType(t),this.features.push(t),this.globe&&(this._addFeatureToRenderers(t),this.isVisible()&&this.globe.renderContext.requestFrame())},r.prototype.removeFeature=function(t){var e=this.features.indexOf(t);this.features.splice(e,1),this.globe&&(this._removeFeatureFromRenderers(t),this.isVisible()&&this.globe.renderContext.requestFrame())},r.prototype.removeAllFeatures=function(){if(this.globe)for(var t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);this.features.length=0,this.globe&&this.isVisible()&&this.globe.renderContext.requestFrame()},r.prototype.modifyFeatureStyle=function(t,e){this._removeFeatureFromRenderers(t)&&(t.properties.style=e,this._addFeatureToRenderers(t))},r.prototype.modifyStyle=function(t){var e;for(e=0;e<this.features.length;e++)this._removeFeatureFromRenderers(this.features[e]);for(this.style=t,e=0;e<this.features.length;e++)this._addFeatureToRenderers(this.features[e])},r.prototype.getStyle=function(){return this.style},r.prototype.setStyle=function(t){this.style=t},r}),r("Layer/LayerFactory",["jquery","../Utils/Constants","./WMSLayer","./WMTSLayer","./WCSElevationLayer","./VectorLayer","./AtmosphereLayer","./BingLayer","./GroundOverlayLayer","./OSMLayer","./TileWireframeLayer","./CoordinateGridLayer","./HipsFitsLayer","./HipsGraphicLayer","./MocLayer","./OpenSearchLayer","./PlanetLayer","./WMSElevationLayer","./HipsMetadata","./HipsCatLayer","./GeoJsonLayer"],function(t,e,i,r,n,o,s,a,l,h,u,c,d,p,f,g,m,v,y,b,x){function C(e,i){var r,n="undefined"==typeof e?new y(i.baseUrl):e,o=n.getHipsMetadata(),s=i.hasOwnProperty("hips_tile_format")?i.hips_tile_format:o.hips_tile_format,a=i.hasOwnProperty("dataproduct_type")?i.dataproduct_type:o.dataproduct_type;switch(a){case n.DataProductType.catalog:break;case n.DataProductType.cube:break;case n.DataProductType.image:var l=t.inArray(n.HipsTileFormat.png,s)!==-1;t.inArray(n.HipsTileFormat.jpeg,s)!==-1,t.inArray(n.HipsTileFormat.fits,s)!==-1;i.format=l?n.HipsTileFormat.png:"jpg",r=_(o,i);break;case n.DataProductType.meta:break;default:throw"Hips : Unknown dataproduct type"}return r}function _(t,e){return new p(t,e)}function w(t){t.style.fill=!0,t.style.fillColor[3]=.3;var e=new f(t);return e.dataType="line",e}function T(t){var e=new g(t);return t.displayProperties&&(e.displayProperties=t.displayProperties),e.pickable=!t.hasOwnProperty("pickable")||t.pickable,e.availableServices=t.availableServices,e}return{create:function(t){var d;switch(t.type){case e.LAYER.WMS:d=new i(t);break;case e.LAYER.WMTS:d=new r(t);break;case e.LAYER.WMSElevation:d=new v(t);break;case e.LAYER.WCSElevation:d=new n(t);break;case e.LAYER.GeoJSON:d=new x(t),d.pickable=!t.hasOwnProperty("pickable")||t.pickable;break;case e.LAYER.Vector:d=new o(t),d.pickable=!t.hasOwnProperty("pickable")||t.pickable,d.deletable=!!t.hasOwnProperty("deletable")&&t.deletable;break;case e.LAYER.Atmosphere:d=new s(t);break;case e.LAYER.Bing:d=new a(t);break;case e.LAYER.GroundOverlay:d=new l(t);break;case e.LAYER.OSM:d=new h(t);break;case e.LAYER.HipsGrid:case e.LAYER.TileWireframe:d=new u(t);break;case e.LAYER.HipsCat:t.background=!1,d=new b(t);break;case e.LAYER.CoordinateGrid:d=new c(t);break;case e.LAYER.Hips:d=C(t.hipsMetadata,t);break;case e.LAYER.Moc:d=w(t);break;case e.LAYER.OpenSearch:d=T(t);break;case e.LAYER.Planet:d=new m(t);break;default:throw"Unable to create the layer "+t.type}return d}}}),r("Gui/Tracker/AbstractTracker",[],function(){var t=function(t){this.options=t};return t.prototype.update=function(t){throw"update from AbstractTracker not implemented"},t.prototype.compute=function(t){throw"compute from AbstractTracker not implemented"},t.prototype.attachTo=function(t){throw"attachTo from AbstractTracker not implemented"},t.prototype.detach=function(){throw"detach from AbstractTracker not implemented"},t}),r("Gui/Tracker/PositionTracker",["jquery","./AbstractTracker","../../Utils/Utils"],function(t,e,i){var r,n,o,s=function(i){e.prototype.constructor.call(this,i),o=this,n=i.element,i.position&&t("#"+n).css(i.position,"2px")};return i.inherits(e,s),s.prototype.attachTo=function(t){r=t,r.renderContext.canvas.addEventListener("mousemove",o.update),this.options.isMobile&&r.renderContext.canvas.addEventListener("touchmove",o.update)},s.prototype.detach=function(){r.renderContext.canvas.removeEventListener("mousemove",o.update),this.options.isMobile&&r.renderContext.canvas.removeEventListener("touchmove",o.update)},s.prototype.update=function(t){if(t.type.search("touch")>=0&&(t.clientX=t.changedTouches[0].clientX,
t.clientY=t.changedTouches[0].clientY),document.getElementById(n)){var e=r.getLonLatFromPixel(t.clientX,t.clientY);if(e){var i=o.compute([e[0],e[1]]);document.getElementById(n).innerHTML=i[0]+" x "+i[1]}else document.getElementById(n).innerHTML=""}},s.prototype.compute=function(t){return r.getCoordinateSystem().formatCoordinates([t[0],t[1]])},s}),r("Gui/Tracker/ElevationTracker",["jquery","./AbstractTracker","../../Utils/Utils","../../Utils/Numeric"],function(t,e,i,r){var n,o,s,a,l=function(i){e.prototype.constructor.call(this,i),a=this,o=i.element,i.position&&t("#"+o).css(i.position,"2px"),null!==i.elevationLayer&&void 0!==i.elevationLayer&&(s=i.elevationLayer.hasOwnProperty("scale")?i.elevationLayer.scale:1)};return i.inherits(e,l),l.prototype.setScaleLayer=function(t){s=t.hasOwnProperty("scale")?t.scale:1},l.prototype.attachTo=function(t){n=t,n.renderContext.canvas.addEventListener("mousemove",a.update),this.options.isMobile&&n.renderContext.canvas.addEventListener("touchmove",a.update)},l.prototype.detach=function(){n.renderContext.canvas.removeEventListener("mousemove",a.update),this.options.isMobile&&n.renderContext.canvas.removeEventListener("touchmove",a.update)},l.prototype.update=function(t){if(t.type.search("touch")>=0&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),document.getElementById(o)){var e=n.getLonLatFromPixel(t.clientX,t.clientY);if(e&&s){var i=a.compute([e[0],e[1]]);document.getElementById(o).innerHTML="Elevation : "+r.roundNumber(i/s,0)+" meters"}else document.getElementById(o).innerHTML=""}},l.prototype.compute=function(t){return n.getElevation(t[0],t[1])},l}),r("Utils/AttributionHandler",[],function(){var t=function(t,e){var i=e?e.element:void 0;i&&("string"==typeof i?this.element=document.getElementById(i):this.element=i),this.element&&(t.attributionHandler=this)};return t.prototype.removeAttribution=function(t){var e=document.getElementById(this.element.id+"_"+t.id);e&&this.element.removeChild(e)},t.prototype.addAttribution=function(t){var e,i=document.createElement("div"),r=void 0!==t.ack?t.ack:"";e=""!==t.copyrightUrl&&void 0!==t.copyrightUrl?'<a class="whiteLink" href="'+t.copyrightUrl+'" target="_blank" title="'+r+'">'+t.attribution+"</a>":t.attribution,i.innerHTML=e,i.id=this.element.id+"_"+t.id,0===t.id?this.element.insertBefore(i,this.element.firstChild):this.element.appendChild(i)},t.prototype.toggleAttribution=function(t){var e=document.getElementById(this.element.id+"_"+t.id);e?this.removeAttribution(t):this.addAttribution(t)},t}),r("Renderer/VectorRenderer",["./RendererTileData","../Tiling/Tile"],function(t,e){var i=function(t){this.tileManager=t.tileManager,this.globe=t,this.buckets=[],this.maxTilePerGeometry=100,this.levelZeroTiledGeometries=[]};return i.prototype.findBucket=function(t,e){for(var i=0;i<this.buckets.length;i++){var r=this.buckets[i];if(r.layer===t&&r.isCompatible(e))return r}return null},i.prototype.generateLevelZero=function(t){for(var e=0;e<this.levelZeroTiledGeometries.length;e++){for(var i=this.levelZeroTiledGeometries[e],r=!1,n=0;n<i._tileIndices.length&&!r;n++){var o=this.tileManager.level0Tiles[i._tileIndices[n]];r=o===t}r&&this._addGeometryToTile(i._bucket,i,t)}},i.prototype._recursiveAddGeometryToTile=function(t,i,r){var n=this._addGeometryToTile(t,i,r);if(n&&n.generateChild&&r.children)for(var o=0;o<4;o++)r.children[o].state===e.State.LOADED&&(n.hasChildren=!0,this._recursiveAddGeometryToTile(t,i,r.children[o]))},i.prototype.addGeometry=function(t,i,r){var n=this.getOrCreateBucket(t,i,r);i._bucket=n;var o=this.maxTilePerGeometry>0?this.tileManager.tiling.getOverlappedLevelZeroTiles(i):null;if(o&&o.length<this.maxTilePerGeometry){for(var s=0;s<o.length;s++){var a=this.tileManager.level0Tiles[o[s]];a&&a.state===e.State.LOADED&&this._recursiveAddGeometryToTile(n,i,a)}i._tileIndices=o,this.levelZeroTiledGeometries.push(i)}else n.mainRenderable||(n.mainRenderable=n.createRenderable()),n.mainRenderable.add(i)},i.prototype.removeGeometry=function(t){var e=t._tileIndices;if(e){for(var i=0;i<e.length;i++){var r=this.tileManager.level0Tiles[e[i]];this.removeGeometryFromTile(t,r)}this.levelZeroTiledGeometries.splice(this.levelZeroTiledGeometries.indexOf(t),1),t._tileIndices=null}else{var n=t._bucket;if(n.mainRenderable){var o=n.mainRenderable.remove(t);0===o&&(n.mainRenderable.dispose(this.renderContext),n.mainRenderable=null)}}},i.prototype.getOrCreateBucket=function(t,e,i){var r=this.findBucket(t,i);return r||(r=this.createBucket(t,i),r.renderer=this,r.id=this.globe.vectorRendererManager.bucketId++,this.buckets.push(r)),r},i.prototype.addGeometryToTile=function(t,e,i,r){var n=this.getOrCreateBucket(t,e,i);return e._bucket=n,this._addGeometryToTile(n,e,r)},i.prototype._addGeometryToTile=function(e,i,r){var n=r.extension.renderer;n||(n=r.extension.renderer=new t(this.globe.vectorRendererManager));var o=n.getRenderable(e),s=!1;return o||(o=e.createRenderable(),s=!0),o.add(i,r)?(s&&n.renderables.push(o),o):null},i.prototype.removeGeometryFromTile=function(t,i){var r=null;if(i&&i.extension&&(r=i.extension.renderer),r)for(var n=0;n<r.renderables.length;){var o=r.renderables[n],s=o.bucket.renderer;if(s===this){var a=o.remove(t);if(0===a?r.renderables.splice(n,1):n++,o.hasChildren&&i.children)for(var l=0;l<4;l++)i.children[l].state===e.State.LOADED&&this.removeGeometryFromTile(t,i.children[l])}else n++}},i}),r("Renderer/PointRenderer",["../Utils/Utils","../Utils/Constants","./VectorRenderer","./VectorRendererManager","./FeatureStyle","./Program","./GeoBound"],function(t,e,i,r,n,o,s){var a=function(){var t=18,e=1,i=null,r=function(){i=document.createElement("canvas"),i.width=512,i.height=t+2*e},o=function(o,s){i||r();var a=s;a?a instanceof Array&&(a=n.fromColorToString(s)):a="#fff";var l=i.getContext("2d");l.clearRect(0,0,i.width,i.height),l.fillStyle=a,l.font=t+"px sans-serif",l.textBaseline="top",l.shadowColor="#000",l.shadowOffsetX=1,l.shadowOffsetY=1,l.shadowBlur=2,l.fillText(o,e,e);var h=l.measureText(o);return l.getImageData(0,0,Math.floor(h.width)+2*e,i.height)};return{generateImageData:o}}(),l=function(t){i.prototype.constructor.call(this,t),this.renderContext=t.tileManager.renderContext,this.tileConfig=t.tileManager.tileConfig,this.numberOfRenderPoints=0;var e="attribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \n";e+="uniform mat4 viewProjectionMatrix; \n",e+="uniform vec3 poiPosition; // world position \n",e+="uniform vec2 poiScale; // x,y scale \n",e+="uniform vec2 tst; \n",e+="\n",e+="varying vec2 texCoord; \n",e+="\n",e+="void main(void)  \n",e+="{ \n",e+="\t// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n",e+="\ttexCoord = vertex.xy + vec2(0.5) + tst; \n",e+="\t// Invert y \n",e+="\ttexCoord.y = 1.0 - texCoord.y; \n",e+="\t\n",e+="\t// Compute poi position in clip coordinate \n",e+="\tgl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n",e+="\tgl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n",e+="} \n";var r="precision lowp float; \n";r+="varying vec2 texCoord; \n",r+="uniform sampler2D texture; \n",r+="uniform float alpha; \n",r+="uniform vec3 color; \n",r+="\n",r+="void main(void) \n",r+="{ \n",r+="\tvec4 textureColor = texture2D(texture, texCoord); \n",r+="\tgl_FragColor = vec4(textureColor.rgb * color, textureColor.a * alpha); \n",r+="\tif (gl_FragColor.a <= 0.0) discard; \n",r+="} \n",this.program=new o(this.renderContext),this.program.createFromSource(e,r);var n=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),s=this.renderContext.gl;this.vertexBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW),this.defaultTexture=null};t.inherits(i,l),l.prototype._buildDefaultTexture=function(t){if(!this.defaultTexture){var e=this.renderContext.gl;this.defaultTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.defaultTexture);var i=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i)}t.texture=this.defaultTexture,t.textureWidth=10,t.textureHeight=10},l.prototype._buildTextureFromImage=function(t,e){t.texture=this.renderContext.createNonPowerOfTwoTextureFromImage(e),t.textureWidth=e.width,t.textureHeight=e.height};var h=function(t){this.bucket=t,this.points=[]};h.prototype.add=function(t){var e=this.bucket.layer.globe.getCoordinateSystem(),i=t.coordinates;i=e.convert(i,t.crs.properties.name,e.getGeoideName());var r=new s(e.getGeoBound().getWest(),e.getGeoBound().getSouth(),e.getGeoBound().getEast(),e.getGeoBound().getNorth());if(r.isPointInside(i)){var n=e.get3DFromWorld(i),o=e.getVerticalAt3D(n);return this.points.push({pos3d:n,vertical:o,geometry:t}),!0}return!1},h.prototype.remove=function(t){for(var e=0;e<this.points.length;e++)if(this.points[e].geometry===t)return this.points.splice(e,1),this.points.length;return this.points.length},h.prototype.dispose=function(t){};var u=function(t,e){this.layer=t,this.style=new n(e),this.renderer=null,this.texture=null};return u.prototype.createRenderable=function(){return new h(this)},u.prototype.isCompatible=function(t){return this.style.iconUrl===t.iconUrl&&this.style.icon===t.icon&&this.style.label===t.label},l.prototype.createBucket=function(t,e){var i=new u(t,e);if(e.label){var r=a.generateImageData(e.label,e.textColor);this._buildTextureFromImage(i,r)}else if(e.iconUrl){var n=new Image;n.crossOrigin="";var o=this;n.onload=function(){o._buildTextureFromImage(i,n),o.renderContext.requestFrame()},n.onerror=function(){o._buildDefaultTexture(i)},n.src=e.iconUrl}else e.icon?this._buildTextureFromImage(i,e.icon):this._buildDefaultTexture(i);return i},l.prototype.render=function(t,e,i){this.numberOfRenderPoints=0;var r=this.renderContext,n=this.renderContext.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.program.apply(),mat4.multiply(r.projectionMatrix,r.viewMatrix,r.modelViewMatrix),n.uniformMatrix4fv(this.program.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix),n.uniform1i(this.program.uniforms.texture,0),mat4.inverse(r.viewMatrix,r.modelViewMatrix);var o=[r.modelViewMatrix[8],r.modelViewMatrix[9],r.modelViewMatrix[10]];vec3.normalize(o),vec3.scale(o,this.tileConfig.cullSign,o);var s=r.computePixelSizeVector();n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(this.program.attributes.vertex,3,n.FLOAT,!1,0,0);for(var a,l=null,h=e;h<i;h++){var u=t[h],c=u.bucket;if(0!==u.points.length){c!==l&&(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,c.texture),a=[2*c.textureWidth/r.canvas.width,2*c.textureHeight/r.canvas.height],n.uniform2fv(this.program.uniforms.poiScale,a),n.uniform2fv(this.program.uniforms.tst,[.5/c.textureWidth,.5/c.textureHeight]));for(var d=0;d<u.points.length;d++){var p=u.points[d].pos3d,f=u.points[d].vertical;a=c.textureHeight*(s[0]*p[0]+s[1]*p[1]+s[2]*p[2]+s[3]),a*=this.tileConfig.cullSign;var g=a/this.globe.getCoordinateSystem().getGeoide().getHeightScale()*.001;if(!(g>c.style.pointMaxSize)&&vec3.dot(f,o)>0&&r.worldFrustum.containsSphere(p,a)>=0){var m=f[0]*a+p[0],v=f[1]*a+p[1],y=f[2]*a+p[2];n.uniform3f(this.program.uniforms.poiPosition,m,v,y),n.uniform1f(this.program.uniforms.alpha,c.layer.opacity);var b=c.style.fillColor;n.uniform3f(this.program.uniforms.color,b[0],b[1],b[2]),n.drawArrays(n.TRIANGLE_FAN,0,4),this.numberOfRenderPoints++}}}}n.disable(n.BLEND)},l.prototype.canApply=function(t,i){return t===e.GEOMETRY.Point&&null===i.iconUrl},r.factory.push(function(t){return new l(t)}),l}),r("Renderer/BatchRenderable",[],function(){var t=function(t){this.bucket=t,this.vertexBuffer=null,this.indexBuffer=null,this.vertices=[],this.triIndices=[],this.lineIndices=[],this.geometryInfos=[],this.bufferDirty=!0,this.vertexSize=3,this.indexType=0,this.vertexBufferShared=!1};return t.prototype.remove=function(t){for(var e,i=-1,r=0,n=0,o=0,s=0;s<this.geometryInfos.length;s++){var a=this.geometryInfos[s];if(a.geometry===t){this.vertices.splice(r,a.vertexCount),this.lineIndices.splice(n,a.lineIndexCount),this.triIndices.splice(o,a.triIndexCount);var l=a.vertexCount/this.vertexSize;for(e=n;e<this.lineIndices.length;e++)this.lineIndices[e]-=l;for(e=o;e<this.triIndices.length;e++)this.triIndices[e]-=l;i=s;break}r+=a.vertexCount,n+=a.lineIndexCount,o+=a.triIndexCount}return i>=0?(this.bufferDirty=!0,this.geometryInfos.splice(i,1),this.vertices.length):this.vertices.length},t.prototype.add=function(t,e){this.tile=e;var i=this.vertices.length,r=this.lineIndices.length,n=this.triIndices.length,o=this.build(t,e);return!!o&&(this.geometryInfos.push({geometry:t,vertexCount:this.vertices.length-i,lineIndexCount:this.lineIndices.length-r,triIndexCount:this.triIndices.length-n}),this.bufferDirty=!0,!0)},t.prototype.dispose=function(t){var e=t.gl;this.indexBuffer&&e.deleteBuffer(this.indexBuffer),this.indexBuffer=null,this.vertexBuffer&&!this.vertexBufferShared&&(e.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null)},t.prototype.bindBuffers=function(t){var e=t.gl;if(this.bufferDirty){this.dispose(t),this.vertexBuffer?e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer):(this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertices),e.STATIC_DRAW)),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=this.triIndices;i=this.triIndices.length>0?this.lineIndices.length>0?this.triIndices.concat(this.lineIndices):this.triIndices:this.lineIndices;var r=this.vertices.length/this.vertexSize;r>65535?(e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(i),e.STATIC_DRAW),this.indexType=e.UNSIGNED_INT):(e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),e.STATIC_DRAW),this.indexType=e.UNSIGNED_SHORT),this.bufferDirty=!1}else e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)},t}),r("Tiling/TiledVectorRenderable",["../Utils/Utils","../Renderer/BatchRenderable","../Utils/Constants"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,t),this.tile=null,this.hasChildren=!0};return t.inherits(e,r),r.prototype.initChild=function(t,e){var i=new r(this.bucket);return i.tile=this.tile,i.vertexBufferShared=!0,i.vertexBuffer=this.vertexBuffer,i.vertices=this.vertices,i.buildChildrenIndices(this,2*e+t),i},r.prototype.generateChild=function(t){for(var e=0;e<this.geometryInfos.length;e++)this.bucket.renderer._addGeometryToTile(this.bucket,this.geometryInfos[e].geometry,t)},r.prototype.buildChildrenIndices=function(t,e){var i,r,n,o,s,a,l,h,u,c,d,p;for(i=0;i<t.triIndices.length;i+=3)r=3*t.triIndices[i],n=3*t.triIndices[i+1],o=3*t.triIndices[i+2],s=t.vertices[r],a=t.vertices[n],l=t.vertices[o],h=0,(s>0||0===s&&a>0||0===s&&0===a&&l>0)&&(h=1),u=t.vertices[r+1],c=t.vertices[n+1],d=t.vertices[o+1],p=1,(u>0||0===u&&c>0||0===u&&0===c&&d>0)&&(p=0),e===2*p+h&&this.triIndices.push(t.triIndices[i],t.triIndices[i+1],t.triIndices[i+2]);for(i=0;i<t.lineIndices.length/2;i++)r=3*t.lineIndices[2*i],n=3*t.lineIndices[2*i+1],s=t.vertices[r],a=t.vertices[n],h=0,(s>0||0===s&&a>0)&&(h=1),u=t.vertices[r+1],c=t.vertices[n+1],p=1,(u>0||0===u&&c>0)&&(p=0),e===2*p+h&&this.lineIndices.push(t.lineIndices[2*i],t.lineIndices[2*i+1])},r.prototype.build=function(t,e){this.tile=e;var r,n,o=this.bucket.layer.minLevel<=e.level&&this.bucket.layer.maxLevel>e.level;if(o){var s=t.coordinates;switch(t.type){case i.GEOMETRY.LineString:this.buildVerticesAndIndices(e,s);break;case i.GEOMETRY.Polygon:for(r=0;r<s.length;r++)this.buildVerticesAndIndices(e,s[r]);break;case i.GEOMETRY.MultiLineString:for(r=0;r<s.length;r++)this.buildVerticesAndIndices(e,s[r]);break;case i.GEOMETRY.MultiPolygon:for(n=0;n<s.length;n++)for(r=0;r<s[n].length;r++)this.buildVerticesAndIndices(e,s[n][r])}}return e.geoBound.intersectsGeometry(t)},r}),r("Tiling/TiledVectorRenderer",["../Utils/Utils","../Renderer/VectorRenderer","../Renderer/Program"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,t);var r="attribute vec3 vertex; \n";r+="uniform float zOffset; \n",r+="uniform mat4 modelViewMatrix;\n",r+="uniform mat4 projectionMatrix;\n",r+="\n",r+="void main(void)  \n",r+="{ \n",r+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex.x, vertex.y, vertex.z + zOffset, 1.0); \n",r+="} \n";var n="#ifdef GL_ES \n";n+="precision highp float; \n",n+="#endif \n",n+="uniform vec4 color; \n",n+="\n",n+="void main(void) \n",n+="{ \n",n+="\tgl_FragColor = color; \n",n+="} \n",this.program=new i(this.tileManager.renderContext),this.program.createFromSource(r,n)};return t.inherits(e,r),r.prototype.render=function(t,e,i){var r=this.tileManager.renderContext,n=r.gl,o=mat4.create();this.program.apply(),n.depthFunc(n.LEQUAL),n.depthMask(!1),n.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,r.projectionMatrix);for(var s=null,a=e;a<i;a++){var l=t[a],h=l.tile;if(mat4.multiply(r.viewMatrix,h.matrix,o),n.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,o),n.uniform1f(this.program.uniforms.zOffset,7e-4*h.radius),s=l.bucket.style,l.bindBuffers(r),n.vertexAttribPointer(this.program.attributes.vertex,3,n.FLOAT,!1,0,0),l.triIndices.length>0&&(n.uniform4f(this.program.uniforms.color,s.fillColor[0],s.fillColor[1],s.fillColor[2],s.fillColor[3]*l.bucket.layer.opacity),n.drawElements(n.TRIANGLES,l.triIndices.length,l.indexType,0)),l.lineIndices.length>0){n.lineWidth(s.strokeWidth),n.uniform4f(this.program.uniforms.color,s.strokeColor[0],s.strokeColor[1],s.strokeColor[2],s.strokeColor[3]*l.bucket.layer.opacity);var u=l.indexType===n.UNSIGNED_INT?4:2;n.drawElements(n.LINES,l.lineIndices.length,l.indexType,l.triIndices.length*u)}}n.depthMask(!0),n.depthFunc(n.LESS)},r}),r("Renderer/LineStringRenderable",["../Utils/Constants","../Utils/Utils","./FeatureStyle","./VectorRendererManager","../Tiling/TiledVectorRenderable","../Tiling/TiledVectorRenderer","../Utils/Numeric"],function(t,e,i,r,n,o,s){var a=function(t){n.prototype.constructor.call(this,t)};e.inherits(n,a),a.prototype._fixDateLine=function(t,e){for(var i=[],r=[i],n=0;n<e.length-1;n++){i.push(e[n]);var o=e[n][0],s=e[n][1],a=e[n+1][0],l=e[n+1][1];if(Math.abs(a-o)>180){o<0&&(o+=360),a<0&&(a+=360);var h=(180-o)/(a-o);if(h>0&&h<1){var u=s+h*(l-s),c=e[n][0]>0?180:-180;i.push([c,u]),i=[[-c,u]],r.push(i)}}}return i.push(e[e.length-1]),r},a.prototype.buildVerticesAndIndices=function(t,e){if(0!==e.length)for(var i=this._fixDateLine(t,e),r=0;r<i.length;r++)this._buildVerticesAndIndices(t,i[r])},a.prototype._buildVerticesAndIndices=function(t,e){var i=t.config.tesselation,r=t.config.vertexSize;e.push(e[e.length-1]);for(var n=t.lonlat2tile(e),o=0;o<e.length-1;o++){var a,l,h,u,c,d,p,f,g=n[o][0],m=n[o][1],v=n[o+1][0],y=n[o+1][1],b=[],x=Math.max(-1,Math.min(g,v)),C=Math.min(i-1,Math.max(g,v));for(a=Math.floor(x)+1;a<Math.floor(C)+1;a++)if(u=a,h=s.lineIntersection(g,m,v,y,u,0,u,i-1),h[0]>0&&h[0]<1&&h[1]>=0&&h[1]<=1){l=h[1]*(i-1);var _=Math.floor(l),w=l-_;c=r*(_*i+a),d=(1-w)*t.vertices[c]+w*t.vertices[c+r*i],p=(1-w)*t.vertices[c+1]+w*t.vertices[c+r*i+1],f=(1-w)*t.vertices[c+2]+w*t.vertices[c+r*i+2],b.push([h[0],d,p,f])}var T=Math.max(-1,Math.min(m,y)),A=Math.min(i-1,Math.max(m,y));for(a=Math.floor(T)+1;a<Math.floor(A)+1;a++)if(l=a,h=s.lineIntersection(g,m,v,y,0,l,i-1,l),h[0]>0&&h[0]<1&&h[1]>=0&&h[1]<=1){u=h[1]*(i-1);var I=Math.floor(u),M=u-I;c=r*(a*i+I),d=(1-M)*t.vertices[c]+M*t.vertices[c+r],p=(1-M)*t.vertices[c+1]+M*t.vertices[c+r+1],f=(1-M)*t.vertices[c+2]+M*t.vertices[c+r+2],b.push([h[0],d,p,f])}b.sort(function(t,e){return t[0]>e[0]});var S,P=this.vertices.length/3;for(g>=0&&g<=i-1&&m>=0&&m<=i-1&&(S=t.computePosition(g,m),this.vertices.push(S[0]),this.vertices.push(S[1]),this.vertices.push(S[2])),a=0;a<b.length;a++)this.vertices.push(b[a][1]),this.vertices.push(b[a][2]),this.vertices.push(b[a][3]);v>=0&&v<=i-1&&y>=0&&y<=i-1&&(S=t.computePosition(v,y),this.vertices.push(S[0]),this.vertices.push(S[1]),this.vertices.push(S[2]));var E=this.vertices.length/3;for(a=P;a<E-1;a++)this.lineIndices.push(a),this.lineIndices.push(a+1)}};var l=function(t){o.prototype.constructor.call(this,t)};e.inherits(o,l),l.prototype.canApply=function(e,i){return!this.globe.isSky()&&!(e!==t.GEOMETRY.LineString&&e!==t.GEOMETRY.MultiLineString&&(i.fill||e!==t.GEOMETRY.Polygon&&e!==t.GEOMETRY.MultiPolygon)||i.gradientLength)};var h=function(t,e){this.layer=t,this.style=new i(e),this.renderer=null};return h.prototype.createRenderable=function(){return new a(this)},h.prototype.isCompatible=function(t){return this.style.strokeColor[0]===t.strokeColor[0]&&this.style.strokeColor[1]===t.strokeColor[1]&&this.style.strokeColor[2]===t.strokeColor[2]&&this.style.strokeColor[3]===t.strokeColor[3]&&this.style.strokeWidth===t.strokeWidth},l.prototype.createBucket=function(t,e){return new h(t,e)},r.factory.push(function(t){return new l(t)}),a}),r("Renderer/pnltri",[],function(){var t={REVISION:"2.1.1"};return t.Math={random:Math.random,array_shuffle:function(e){for(var i=e.length-1;i>0;i--){var r=Math.floor(t.Math.random()*(i+1)),n=e[i];e[i]=e[r],e[r]=n}return e},compare_pts_yx:function(e,i){var r=e.y-i.y;if(r<t.Math.EPSILON_N)return-1;if(r>t.Math.EPSILON_P)return 1;var n=e.x-i.x;return n<t.Math.EPSILON_N?-1:n>t.Math.EPSILON_P?1:0},ptsCrossProd:function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)}},t.Math.EPSILON_P=Math.pow(2,-43),t.Math.EPSILON_N=-t.Math.EPSILON_P,t.PolygonData=function(t){if(this.vertices=[],this.segments=[],this.diagonals=[],this.idNextPolyChain=0,this.PolyLeftArr=[],this.monoSubPolyChains=[],this.triangles=[],t)for(var e=0,i=t.length;e<i;e++)this.addPolygonChain(t[e])},t.PolygonData.prototype={constructor:t.PolygonData,nbVertices:function(){return this.vertices.length},getSegments:function(){return this.segments},getFirstSegment:function(){return this.segments[0]},getMonoSubPolys:function(){return this.monoSubPolyChains},getTriangles:function(){return this.triangles.concat()},nbPolyChains:function(){return this.idNextPolyChain},get_PolyLeftArr:function(){return this.PolyLeftArr.concat()},set_PolyLeft_wrong:function(t){this.PolyLeftArr[t]=!1},isClockWise:function(t){var e=t,i=0;do i+=(e.vFrom.x-e.vTo.x)*(e.vFrom.y+e.vTo.y),e=e.snext;while(e!=t);return i<0},appendVertexEntry:function(t,e){var i={id:this.vertices.length,x:t,y:e};return this.vertices.push(i),i},createSegmentEntry:function(e,i){return{chainId:this.idNextPolyChain,vFrom:e,vTo:i,upward:1==t.Math.compare_pts_yx(i,e),sprev:null,snext:null,rootFrom:null,rootTo:null,is_inserted:!1,trLeft:null,trRight:null,mprev:null,mnext:null,marked:!1}},appendSegmentEntry:function(t){return this.segments.push(t),t},appendDiagonalsEntry:function(t){return this.diagonals.push(t),t},addVertexChain:function(e){function i(e,i){return Math.abs(e.x-i.x)<t.Math.EPSILON_P&&Math.abs(e.y-i.y)<t.Math.EPSILON_P}function r(e,i,r){if(Math.abs(t.Math.ptsCrossProd(i,e,r))>t.Math.EPSILON_P)return!1;var n,o,s;return Math.abs(e.y-i.y)<t.Math.EPSILON_P?(o=i.x,e.x<r.x?(n=e.x,s=r.x):(n=r.x,s=e.x)):(o=i.y,e.y<r.y?(n=e.y,s=r.y):(n=r.y,s=e.y)),n-o<t.Math.EPSILON_P&&o-s<t.Math.EPSILON_P}for(var n,o,s,a=[],l=0;l<e.length;l++)n=this.appendVertexEntry(e[l].x,e[l].y),o=!0,s=a.length-1,s>=0&&(i(n,a[s])?o=!1:s>0&&r(a[s-1],a[s],n)&&a.pop()),o&&a.push(n);return s=a.length-1,s>0&&i(a[s],a[0])&&(a.pop(),s--),s>1&&(r(a[s-1],a[s],a[0])&&(a.pop(),s--),s>1&&r(a[s],a[0],a[1])&&a.shift()),a},addPolygonChain:function(t){var e=this.addVertexChain(t);if(e.length<3)return console.log("Polygon has < 3 vertices!",e),0;for(var i,r,n,o=this.segments.length,s=0;s<e.length-1;s++)i=this.createSegmentEntry(e[s],e[s+1]),n?(i.sprev=n,n.snext=i):r=i,n=i,this.appendSegmentEntry(i);return i=this.createSegmentEntry(e[e.length-1],e[0]),i.sprev=n,n.snext=i,this.appendSegmentEntry(i),r.sprev=i,i.snext=r,this.PolyLeftArr[this.idNextPolyChain++]=!0,this.segments.length-o},create_mono_chains:function(){for(var t,e,i,r,n=0,o=this.segments.length;n<o;n++)t=this.segments[n],this.PolyLeftArr[t.chainId]?(e=t.vTo,t.mprev=t.sprev,t.mnext=t.snext):(e=t.vFrom,t=t.snext,t.mprev=t.snext,t.mnext=t.sprev),(r=t.vFrom.lastInDiag)&&(r.mnext=t,t.mprev=r,t.vFrom.lastInDiag=null),(i=e.firstOutDiag)&&(i.mprev=t,t.mnext=i,e.firstOutDiag=null)},unique_monotone_chains_max:function(){function e(e){var i,r,n,o=e;for(r=n=e.vFrom,e.marked=!0,e=e.mnext;i=e.vFrom;){if(e.marked){if(i==r)break;return console.log("ERR unique_monotone: segment in two chains",r,e),null}e.marked=!0,1==t.Math.compare_pts_yx(i,n)&&(n=i,o=e),e=e.mnext}return o}var i,r;this.monoSubPolyChains=[];for(var n=0,o=this.segments.length;n<o;n++)i=this.segments[n],i.marked||(r=e(i),r&&this.monoSubPolyChains.push(r));return this.monoSubPolyChains},clearTriangles:function(){this.triangles=[]},addTriangle:function(t,e,i){this.triangles.push([t.id,e.id,i.id])}},t.EarClipTriangulator=function(t){this.polyData=t},t.EarClipTriangulator.prototype={constructor:t.EarClipTriangulator,triangulate_polygon_no_holes:function(){function e(e){var i=e.mprev.vFrom.x,r=e.mprev.vFrom.y,n=e.vFrom.x,o=e.vFrom.y,s=e.mnext.vFrom.x,a=e.mnext.vFrom.y,l=s-n,h=a-o,u=i-s,c=r-a,d=n-i,p=o-r;if(t.Math.EPSILON_P>d*h-l*p)return!1;for(var f=e.mprev.mprev,g=e.mnext;g!=f;){g=g.mnext;var m=g.vFrom.x,v=g.vFrom.y,y=m-i,b=v-r;if(0!==y||0!==b){var x=m-n,C=v-o;if(0!==x||0!==C){var _=m-s,w=v-a;if((0!==_||0!==w)&&l*C-h*x>=t.Math.EPSILON_N&&d*b-p*y>=t.Math.EPSILON_N&&u*w-c*_>=t.Math.EPSILON_N)return!1}}}return!0}var i=this.polyData,r=i.getFirstSegment(),n=r;if(i.isClockWise(r)){do n.mprev=n.snext,n.mnext=n.sprev,n=n.sprev;while(n!=r);i.set_PolyLeft_wrong(0)}else do n.mprev=n.sprev,n.mnext=n.snext,n=n.snext;while(n!=r);for(var o=r,s=o;o.mnext!=o.mprev;)if(e(o))this.polyData.addTriangle(o.mprev.vFrom,o.vFrom,o.mnext.vFrom),o.mprev.mnext=o.mnext,o.mnext.mprev=o.mprev,o=o.mnext,s=o;else if(o=o.mnext,o==s)return!1;return!0}},t.Trapezoid=function(t,e,i,r){this.vHigh=t?t:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},this.vLow=e?e:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},this.lseg=i,this.rseg=r,this.depth=-1,this.monoDone=!1},t.Trapezoid.prototype={constructor:t.Trapezoid,clone:function(){var e=new t.Trapezoid(this.vHigh,this.vLow,this.lseg,this.rseg);return e.uL=this.uL,e.uR=this.uR,e.dL=this.dL,e.dR=this.dR,e.sink=this.sink,e},splitOffLower:function(t){var e=this.clone();return this.vLow=e.vHigh=t,this.dL=e,e.uL=this,this.dR=e.uR=null,e.dL&&(e.dL.uL=e),e.dR&&(e.dR.uR=e),e}},t.QsNode=function(t){this.trap=t,t.sink=this},t.QsNode.prototype={constructor:t.QsNode},t.QueryStructure=function(e){var i=new t.Trapezoid(null,null,null,null);if(this.trapArray=[],this.appendTrapEntry(i),this.root=new t.QsNode(i),e)for(var r=e.getSegments(),n=0;n<r.length;n++)r[n].rootFrom=r[n].rootTo=this.root,r[n].is_inserted=!1},t.QueryStructure.prototype={constructor:t.QueryStructure,getRoot:function(){return this.root},appendTrapEntry:function(t){t.trapID=this.trapArray.length,this.trapArray.push(t)},cloneTrap:function(t){var e=t.clone();return this.appendTrapEntry(e),e},splitNodeAtPoint:function(e,i,r){var n=e.trap;if(n.vHigh==i)return e;if(n.vLow==i)return e;var o=n.splitOffLower(i);return this.appendTrapEntry(o),e.yval=i,e.trap=null,e.right=new t.QsNode(n),e.left=new t.QsNode(o),r?n.sink:o.sink},fpEqual:function(e,i){return Math.abs(e-i)<t.Math.EPSILON_P},is_left_of:function(e,i,r){var n,o=e.vFrom.x-i.x,s=e.vTo.x-i.x,a=this.fpEqual(e.vFrom.y,i.y);if(this.fpEqual(e.vTo.y,i.y)){if(a)return 0;n=s}else{if(!a)return e.upward?t.Math.ptsCrossProd(e.vFrom,e.vTo,i):t.Math.ptsCrossProd(e.vTo,e.vFrom,i);n=o}return Math.abs(n)<t.Math.EPSILON_P?0:n},segNodes:function(t){this.ptNode(t,!0),this.ptNode(t,!1)},ptNode:function(e,i){var r,n,o;i?(r=e.vFrom,n=e.vTo,o=e.rootFrom):(r=e.vTo,n=e.vFrom,o=e.rootTo);for(var s,a;o;)if(o.yval)o=t.Math.compare_pts_yx(r==o.yval?n:r,o.yval)==-1?o.left:o.right;else{if(!o.seg)return o.trap||console.log("ptNode: unknown type",o),i?e.rootFrom=o:e.rootTo=o,o;if(r==o.seg.vFrom||r==o.seg.vTo){if(this.fpEqual(r.y,n.y)){this.fpEqual(o.seg.vFrom.y,o.seg.vTo.y)?r==o.seg.vFrom?(a=e.upward?n.x>=o.seg.vTo.x:n.x<o.seg.vTo.x,o=(a?e.sprev.upward:o.seg.snext.upward)?o.right:o.left):(a=e.upward?n.x<o.seg.vFrom.x:n.x>=o.seg.vFrom.x,o=(a?e.snext.upward:o.seg.sprev.upward)?o.left:o.right):o=n.x<r.x?o.left:o.right;continue}s=this.is_left_of(o.seg,n,!1),0===s&&(r==o.seg.vFrom?(a=e.upward?n.y>=o.seg.vTo.y:n.y<o.seg.vTo.y,s=a?this.is_left_of(o.seg,e.sprev.vFrom,!1):-this.is_left_of(o.seg,o.seg.snext.vTo,!1)):(a=e.upward?n.y<o.seg.vFrom.y:n.y>=o.seg.vFrom.y,s=a?this.is_left_of(o.seg,e.snext.vTo,!1):-this.is_left_of(o.seg,o.seg.sprev.vFrom,!1)))}else if(s=this.is_left_of(o.seg,r,!0),0===s&&(s=this.is_left_of(o.seg,n,!1),0===s)){var l=i?e.sprev.vFrom:e.snext.vTo;s=this.is_left_of(o.seg,l,!1)}if(s>0)o=o.left;else{if(!(s<0))return o;o=o.right}}},add_segment:function(e){function i(){var t=C.uL||C.uR;t.dL&&t.dR?C==t.dL?(m.uL=null,t.dL=g):(g.uR=null,t.dR=m):(m.uL=null,m.uR=t,t.dR=m)}function r(){C.usave?(C.uleft?(m.uL=C.uR,m.uR=C.usave,m.uL.dL=m,m.uR.dR=m):(g.uR=C.uL,g.uL=C.usave,g.uL.dL=g,g.uR.dR=g),g.usave=m.usave=null):C.vHigh==f.vHigh?(m.uR.dR=m,g.uR=m.uL=null):m==C?(m.uL=m.uR,m.uR=null,m.uL.dL=m):(g.uR=g.uL,g.uL=null)}function n(t){C.vLow==x.vLow?(h?C.dL?(t.uL=g,g.dL=t,m.dR=null):(t.uR=m,g.dL=null,m.dR=t):(t.uL=g,t.uR=m,g.dL=m.dR=t),g.dR=m.dL=null):(t.uL&&t.uR&&(t.uL==C?(t.usave=t.uR,t.uleft=!0):(t.usave=t.uL,t.uleft=!1)),t.uL=g,t.uR=m,g.dR=m.dL=t,g.dL=m.dR=null)}function o(){var t;if(C.vLow==x.vLow&&h)C.dL.uL=g,C.dR.uR=m,g.dL=C.dL,m.dR=C.dR,g.dR=m.dL=null,t=null;else{C.dL.uL=g,C.dR.uR=m;var i,r=s.is_left_of(e,C.vLow,!0);if(r>0)i=!0;else if(r<0)i=!1;else{var n=C.dL.rseg,o=n.upward,a=o?n.vFrom:n.vTo;r=s.is_left_of(e,a,!1),r>0?i=!0:r<0?i=!1:(n=o?n.snext:n.sprev,a=o?n.vTo:n.vFrom,r=s.is_left_of(e,a,!1),i=r>0)}i?(t=C.dR,C.dR.uL=g,g.dL=C.dL,m.dR=null):(t=C.dL,C.dL.uR=m,m.dR=C.dR,g.dL=null),g.dR=m.dL=t}return t}var s=this;this.segNodes(e);var a,l,h,u,c,d;if(e.upward?(a=e.vFrom,u=e.vTo,l=e.rootFrom,c=e.rootTo,h=e.sprev.is_inserted,d=e.snext.is_inserted):(a=e.vTo,u=e.vFrom,l=e.rootTo,c=e.rootFrom,h=e.snext.is_inserted,d=e.sprev.is_inserted),!d){var p=this.splitNodeAtPoint(c,u,!1);c==l&&(l=p),c=p}var f=c.trap;if(!f.uL&&!f.uR)return void console.log("ERR add_segment: missing trFirst.uX: ",f);if(f.vHigh!=u)return void console.log("ERR add_segment: trFirstHigh != segHigh: ",f);h||(l=this.splitNodeAtPoint(l,a,!0));for(var g,m,v,y,b,x=l.trap,C=f,_=this.trapArray.length+2;C;){if(--_<0)return void console.log("ERR add_segment: infinite loop",C,e,this);if(!C.dL&&!C.dR)return void console.log("ERR add_segment: missing successors",C,e,this);var w=C.sink;w.seg=e,w.trap=null,y&&y.rseg==C.rseg?(g=C,m=y,m.vLow=C.vLow,w.left=new t.QsNode(g),w.right=y.sink):v&&v.lseg==C.lseg?(m=C,g=v,g.vLow=C.vLow,w.left=v.sink,w.right=new t.QsNode(m)):(g=C,m=this.cloneTrap(C),w.left=new t.QsNode(g),w.right=new t.QsNode(m)),C.uL&&C.uR?r():i(),C.dL&&C.dR?b=o():(b=C.dL?C.dL:C.dR,n(b)),g.rseg&&(g.rseg.trLeft=m),m.lseg&&(m.lseg.trRight=g),g.rseg=m.lseg=e,e.trLeft=g,e.trRight=m,C.vLow!=x.vLow?(v=g,y=m,C=b):C=null}e.is_inserted=!0},assignDepths:function(t){var e,i,r=[this.trapArray[0]],n=[],o=0;do{for(var s=o%2==1;e=r.pop();)e.depth==-1&&(e.depth=o,e.uL&&r.push(e.uL),e.uR&&r.push(e.uR),e.dL&&r.push(e.dL),e.dR&&r.push(e.dR),(i=e.lseg)&&i.trLeft.depth==-1&&n.push(i.trLeft),(i=e.rseg)&&(i.trRight.depth==-1&&n.push(i.trRight),i.upward!=s&&t.set_PolyLeft_wrong(i.chainId)));r=n,n=[],o++}while(r.length>0)},create_visibility_map:function(t){var e,i,r=0,n=1,o=2,s=3,a=4,l=5,h=6,u=7,c=t.nbVertices(),d=new Array(c);for(e=0;e<c;e++)d[e]=new Array(u+1);var p=new Array(c);for(e=0,i=this.trapArray.length;e<i;e++){var f=this.trapArray[e],g=f.uL?f.uR?l:u:f.uR?a:h,m=f.dL?f.dR?n:r:f.dR?s:o;if(f.depth%2==1){if(g==l||m==n||g==u&&m==s||g==a&&m==r){var v=t.appendDiagonalsEntry({vFrom:f.vLow,vTo:f.vHigh,mprev:null,mnext:null,marked:!1}),y=t.appendDiagonalsEntry({vFrom:f.vHigh,vTo:f.vLow,revDiag:v,mprev:null,mnext:null,marked:!1});v.revDiag=y,d[f.vLow.id][m]=v,d[f.vHigh.id][g]=y}}else null!==f.vHigh.id&&(p[f.vHigh.id]=g),
null!==f.vLow.id&&(p[f.vLow.id]=m)}var b,x,C,_,w;for(e=0;e<c;e++)if(x=d[e],C=p[e],null!=C){i=C,w=null;do i++>u&&(i=r),(b=x[i])&&(w?(b.mprev=w,w.mnext=b):(_=b.vFrom,_.firstOutDiag=b),w=b.revDiag);while(i!=C);w&&(_.lastInDiag=w)}}},t.Trapezoider=function(e){this.polyData=e,this.queryStructure=new t.QueryStructure(this.polyData)},t.Trapezoider.prototype={constructor:t.Trapezoider,optimise_randomlist:function(t){var e=0,i=this.polyData.nbPolyChains();if(1!=i)for(var r=new Array(i),n=t.concat(),o=0;o<n.length;o++){var s=n[o].chainId;r[s]?t[i++]=n[o]:(t[e++]=n[o],r[s]=!0)}},trapezoide_polygon:function(){var e=this.polyData.getSegments().concat();t.Math.array_shuffle(e),this.optimise_randomlist(e);for(var i,r=e.length,n=this.queryStructure,o=0,s=r;o<r;){s=Math.log(s)/Math.LN2;for(var a=s>1?Math.floor(r/s):r;o<a;o++)n.add_segment(e[o]);for(i=o;i<r;i++)this.queryStructure.segNodes(e[i])}for(n.assignDepths(this.polyData),i=0;i<r;i++)e[i].trLeft=e[i].trRight=null},create_visibility_map:function(){return this.queryStructure.create_visibility_map(this.polyData)}},t.MonoSplitter=function(t){this.polyData=t,this.trapezoider=null},t.MonoSplitter.prototype={constructor:t.MonoSplitter,monotonate_trapezoids:function(){this.trapezoider=new t.Trapezoider(this.polyData),this.trapezoider.trapezoide_polygon(),this.trapezoider.create_visibility_map(),this.polyData.create_mono_chains(),this.polyData.unique_monotone_chains_max()}},t.MonoTriangulator=function(t){this.polyData=t},t.MonoTriangulator.prototype={constructor:t.MonoTriangulator,triangulate_all_polygons:function(){var t=this.polyData.getMonoSubPolys();this.polyData.clearTriangles();for(var e=0;e<t.length;e++){var i=t[e],r=i.mprev,n=i.mnext;n.mnext==r?this.polyData.addTriangle(i.vFrom,n.vFrom,r.vFrom):this.triangulate_monotone_polygon(i)}},triangulate_monotone_polygon:function(e){function i(){for(console.log("ERR uni-y-monotone: only concave angles left",s);a>1;)a--,r.polyData.addTriangle(s[a-1],s[a],s[a+1])}var r=this,n=e.mnext,o=e.vFrom,s=[n.vFrom],a=0;n=n.mnext;var l=n.vFrom;if(l!=o){for(;l!=o||a>1;)if(a>0){var h=t.Math.ptsCrossProd(s[a],l,s[a-1]);Math.abs(h)<=t.Math.EPSILON_P&&(l!=o&&t.Math.compare_pts_yx(s[a],l)!=t.Math.compare_pts_yx(s[a],s[a-1])||(h=1)),h>0?(this.polyData.addTriangle(s[a-1],s[a],l),a--):(s[++a]=l,l==o?i():(n=n.mnext,l=n.vFrom))}else s[++a]=l,n=n.mnext,l=n.vFrom;this.polyData.addTriangle(s[a-1],s[a],l)}}},t.Triangulator=function(){this.lastPolyData=null},t.Triangulator.prototype={constructor:t.Triangulator,clear_lastData:function(){this.lastPolyData=null},get_PolyLeftArr:function(){return this.lastPolyData?this.lastPolyData.get_PolyLeftArr():null},triangulate_polygon:function(e,i){function r(){return!i&&1==o.nbPolyChains()}if(this.clear_lastData(),!e||0===e.length)return[];var n,o=new t.PolygonData(e),s=r();if(s&&(n=new t.EarClipTriangulator(o),s=n.triangulate_polygon_no_holes()),!s){var a=new t.MonoSplitter(o);a.monotonate_trapezoids(),n=new t.MonoTriangulator(o),n.triangulate_all_polygons()}return this.lastPolyData=o,o.getTriangles()}},t}),r("Renderer/PolygonRenderer",["../Utils/Constants","../Utils/Utils","./VectorRenderer","./VectorRendererManager","./FeatureStyle","./Program","./BatchRenderable","./pnltri","./GeoBound"],function(t,e,i,r,n,o,s,a,l){var h=function(t){i.prototype.constructor.call(this,t),this.maxTilePerGeometry=2,this.renderContext=t.renderContext,this.defaultVertexShader="attribute vec3 vertex;\n",this.defaultVertexShader+="uniform mat4 mvp;\n",this.defaultVertexShader+="void main(void) \n",this.defaultVertexShader+="{\n",this.defaultVertexShader+="\tgl_Position = mvp * vec4(vertex, 1.0);\n",this.defaultVertexShader+="}\n",this.extrudeVertexShader="attribute vec3 vertex;\n",this.extrudeVertexShader+="attribute vec4 normal;\n",this.extrudeVertexShader+="uniform float extrusionScale; \n",this.extrudeVertexShader+="uniform mat4 mvp;\n",this.extrudeVertexShader+="void main(void) \n",this.extrudeVertexShader+="{\n",this.extrudeVertexShader+="\tvec3 extrudedVertex = vertex + normal.w * vec3(normal.x, normal.y, normal.z) * extrusionScale;",this.extrudeVertexShader+="\tgl_Position = mvp * vec4(extrudedVertex, 1.0);\n",this.extrudeVertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="uniform vec4 u_color;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor = u_color;\n",this.fragmentShader+="\t//if (u_color.a == 0.0) discard;\n",this.fragmentShader+="}\n",this.program=new o(t.renderContext),this.program.createFromSource(this.defaultVertexShader,this.fragmentShader),this.extrudeProgram=new o(t.renderContext),this.extrudeProgram.createFromSource(this.extrudeVertexShader,this.fragmentShader)};e.inherits(i,h);var u=function(t){s.prototype.constructor.call(this,t),this.origin=null,this.vertexSize=t.style.extrude?7:3,this.matrix=mat4.create()};e.inherits(s,u);var c=function(t,e,i){return[e[0]+t*(i[0]-e[0]),e[1]+t*(i[1]-e[1])]},d=function(t,e,i,r){for(var n,o,s=[],a=0;a<r.length;a++){var l=r[a],h=r[(a+1)%r.length],u=l[t],d=h[t],p=(u-i)*e>=0,f=(d-i)*e>=0;!p&&f?(n=(i-u)/(d-u),o=c(n,l,h),s.push(o),s.push(h)):p&&f?s.push(h):p&&!f&&(n=(i-u)/(d-u),o=c(n,l,h),s.push(o))}return s},p=function(t,e){var i;return i=d(0,1,e.west,t),i=d(0,-1,e.east,i),i=d(1,1,e.south,i),i=d(1,-1,e.north,i)},f=function(t){for(var e=!1,i=1;i<t.length&&!e;i++){var r=Math.abs(t[i][0]-t[i-1][0]);r>180&&r<360&&(e=!0)}var n;if(e){var o=[];for(n=0;n<t.length;n++)t[n][0]>0?o[n]=[t[n][0]-360,t[n][1]]:o[n]=[t[n][0],t[n][1]];var s=[];for(n=0;n<t.length;n++)t[n][0]<0?s[n]=[t[n][0]+360,t[n][1]]:s[n]=[t[n][0],t[n][1]];return[s,o]}return[t]};u.prototype.build=function(e){var i=this.bucket.renderer,r=this.bucket.style,n=i.globe.getCoordinateSystem(),o=e.type===t.GEOMETRY.MultiPolygon?e.coordinates:[e.coordinates],s=new l,h=new l(n.getGeoBound().getWest(),n.getGeoBound().getSouth(),n.getGeoBound().getEast(),n.getGeoBound().getNorth()),u=s.computeFromCoordinatesInCrsTo(o[0][0],e.crs.properties.name,n);if(s.intersects(h)){var c,d,g=vec3.create();this.origin||(this.origin=vec3.create(),n.get3DFromWorld(u,this.origin),mat4.identity(this.matrix),mat4.translate(this.matrix,this.origin));var m,v,y=this.vertices.length/this.vertexSize,b=this.vertices.length,x=[];for(d=0;d<o.length;d++)x=x.concat(f(o[d][0]));for(d=0;d<x.length;d++){var C=p(x[d],h);b=this.vertices.length;var _=0;for(c=0;c<C.length;c++){if(n.get3DFromWorldInCrs([C[c][0],C[c][1],0],e.crs.properties.name,g),this.vertices[b]=g[0]-this.origin[0],this.vertices[b+1]=g[1]-this.origin[1],this.vertices[b+2]=g[2]-this.origin[2],c<C.length-1&&(_+=(C[c+1][0]-C[c][0])*(C[c+1][1]+C[c][1])),r.extrude){vec3.normalize(g),this.vertices[b+3]=g[0],this.vertices[b+4]=g[1],this.vertices[b+5]=g[2];var w;w="boolean"==typeof r.extrude?C[c][2]:r.extrude,this.vertices[b+6]=w*n.geoide.heightScale}b+=this.vertexSize}if(r.extrude){var T=y*this.vertexSize;for(this.vertices=this.vertices.concat(this.vertices.slice(T,b)),c=b;c<this.vertices.length;c+=this.vertexSize)this.vertices[c+6]=0}var A=new a.Triangulator,I=C.map(function(t){return{x:t[0],y:t[1]}}),M=A.triangulate_polygon([I]);for(c=0;c<M.length;c++)this.triIndices.push(y+M[c][0],y+M[c][1],y+M[c][2]);if(r.extrude)for(m=y,v=y+C.length,c=0;c<C.length-1;c++)_>0?(this.triIndices.push(m,m+1,v),this.triIndices.push(m+1,v+1,v)):(this.triIndices.push(m,v,m+1),this.triIndices.push(m+1,v,v+1)),m+=1,v+=1;for(c=0;c<C.length-1;c++)this.lineIndices.push(y+c,y+c+1);if(r.extrude)for(m=y,v=y+C.length,c=0;c<C.length-1;c++)this.lineIndices.push(m+c,v+c);y=this.vertices.length/this.vertexSize}return!0}};var g=function(t,e){this.layer=t,this.style=e,this.renderer=null};g.prototype.createRenderable=function(){return new u(this)},g.prototype.isCompatible=function(t){return this.style===t},h.prototype.render=function(t,e,i){var r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.depthFunc(n.LEQUAL);var o=null,s=mat4.create();mat4.multiply(r.projectionMatrix,r.viewMatrix,s);for(var a=mat4.create(),l=e;l<i;l++){var h=t[l],u=h.bucket.style,c=u.extrude?this.extrudeProgram:this.program;if(c!==o&&(c.apply(),o=c),mat4.multiply(s,h.matrix,a),n.uniformMatrix4fv(c.uniforms.mvp,!1,a),n.uniform4f(c.uniforms.u_color,u.fillColor[0],u.fillColor[1],u.fillColor[2],u.fillColor[3]*h.bucket.layer.opacity),h.bindBuffers(r),n.lineWidth(u.strokeWidth),n.vertexAttribPointer(c.attributes.vertex,3,n.FLOAT,!1,4*h.vertexSize,0),u.extrude&&(n.vertexAttribPointer(c.attributes.normal,4,n.FLOAT,!1,4*h.vertexSize,12),n.uniform1f(c.uniforms.extrusionScale,u.extrusionScale)),n.drawElements(n.TRIANGLES,h.triIndices.length,h.indexType,0),h.lineIndices.length>0){n.uniform4f(c.uniforms.u_color,u.strokeColor[0],u.strokeColor[1],u.strokeColor[2],u.strokeColor[3]*h.bucket.layer.opacity);var d=h.indexType===n.UNSIGNED_INT?4:2;n.drawElements(n.LINES,h.lineIndices.length,h.indexType,h.triIndices.length*d)}}n.lineWidth(1),n.depthFunc(n.LESS),n.disable(n.BLEND)},h.prototype.canApply=function(e,i){return(e===t.GEOMETRY.Polygon||e===t.GEOMETRY.MultiPolygon)&&i.fill},h.prototype.createBucket=function(t,e){return new g(t,e)},r.factory.push(function(t){return new h(t)})}),r("Renderer/LineRenderer",["../Utils/Constants","../Utils/Utils","../Utils/Numeric","./VectorRenderer","./VectorRendererManager","./Program","./BatchRenderable"],function(t,e,i,r,n,o,s){var a=function(t){r.prototype.constructor.call(this,t),this.maxTilePerGeometry=2,this.renderContext=t.getRenderContext(),this.defaultVertexShader="attribute vec4 vertex;\n",this.defaultVertexShader+="uniform mat4 mvp;\n",this.defaultVertexShader+="varying float s;\n",this.defaultVertexShader+="void main(void) \n",this.defaultVertexShader+="{\n",this.defaultVertexShader+="\ts = vertex.w;\n",this.defaultVertexShader+="\tgl_Position = mvp * vec4(vertex.xyz, 1.0);\n",this.defaultVertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="uniform vec4 u_color;\n",this.fragmentShader+="uniform float speed;\n",this.fragmentShader+="uniform float time;\n",this.fragmentShader+="uniform float gradientLength;\n",this.fragmentShader+="varying float s;\n",this.fragmentShader+="uniform sampler2D colorTexture;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\t// 0.5 is a time scale parameter, parametrize it ?\n",this.fragmentShader+="\tfloat m = speed * time * 0.5;\n",this.fragmentShader+="\tfloat u = (-s+m)/gradientLength;\n",this.fragmentShader+="\tgl_FragColor.rgb = texture2D(colorTexture, vec2(u,0.)).rgb;\n",this.fragmentShader+="\t// TODO: handle appereance of rivers\n",this.fragmentShader+="\tif ( s < m )\n",this.fragmentShader+="\t{\n",this.fragmentShader+="\t\tgl_FragColor.a = 1.0;\n",this.fragmentShader+="\t}\n",this.fragmentShader+="\telse\n",this.fragmentShader+="\t{\n",this.fragmentShader+="\t\tgl_FragColor.a = 0.0;\n",this.fragmentShader+="\t}\n",this.fragmentShader+="}\n",this.program=new o(t.renderContext),this.program.createFromSource(this.defaultVertexShader,this.fragmentShader),this.time=Date.now()/1e3,this.palette=null,this.colorTexture=this.generateTexture([[0,0,255],[0,200,255]])};e.inherits(r,a),a.prototype.generateTexture=function(t){var e,r,n,o,s=t[0],a=t[1],l=[],h=this.globe.renderContext.gl;for(this.colorTexture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.colorTexture),e=0;e<128;e++)r=i.coserp(e/128,s[0],a[0]),n=i.coserp(e/128,s[1],a[1]),o=i.coserp(e/128,s[2],a[2]),l.push(r),l.push(n),l.push(o),l.push(255);for(e=0;e<128;e++)r=i.coserp(e/128,a[0],s[0]),n=i.coserp(e/128,a[1],s[1]),o=i.coserp(e/128,a[2],s[2]),l.push(r),l.push(n),l.push(o),l.push(255);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,l.length/4,1,0,h.RGBA,h.UNSIGNED_BYTE,new Uint8Array(l)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),this.palette=t};var l=function(t){s.prototype.constructor.call(this,t),this.vertexSize=4,this.matrix=mat4.create(),mat4.identity(this.matrix)};e.inherits(s,l),l.prototype.build=function(e){var i,r,n=this.bucket.renderer,o=(this.bucket.style,e.type===t.GEOMETRY.MultiLineString?e.coordinates:[e.coordinates]),s=vec3.create(),a=vec3.create();for(r=0;r<o.length;r++){var l=o[r],h=this.vertices.length/4,u=n.globe.getCoordinateSystem(),c=4*h,d=0;for(i=0;i<l.length;i++){u.get3DFromWorldInCrs(l[i],e.crs.properties.name,s),this.vertices[c]=s[0],this.vertices[c+1]=s[1],this.vertices[c+2]=s[2],i>0&&(d+=vec3.dist(s,a));var p=a;a=s,s=p,this.vertices[c+3]=d,c+=4}for(i=0;i<l.length-1;i++)this.lineIndices.push(h+i,h+i+1)}return!0};var h=function(t,e){this.layer=t,this.style=e,this.renderer=null};h.prototype.createRenderable=function(){return new l(this)},h.prototype.isCompatible=function(t){return this.style===t},a.prototype.render=function(t,e,i){var r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.depthFunc(n.LEQUAL);var o=mat4.create();mat4.multiply(r.projectionMatrix,r.viewMatrix,o);var s=mat4.create();this.program.apply(),n.activeTexture(n.TEXTURE0),n.uniform1i(this.program.uniforms.colorTexture,0),n.bindTexture(n.TEXTURE_2D,this.colorTexture);for(var a=e;a<i;a++){var l=t[a],h=l.bucket.style;mat4.multiply(o,l.matrix,s),n.uniformMatrix4fv(this.program.uniforms.mvp,!1,s),h.palette&&h.palette!==this.palette&&(n.deleteTexture(this.colorTexture),this.generateTexture(h.palette)),n.lineWidth(h.strokeWidth),n.uniform4f(this.program.uniforms.u_color,h.strokeColor[0],h.strokeColor[1],h.strokeColor[2],h.strokeColor[3]*l.bucket.layer.opacity),n.uniform1f(this.program.uniforms.speed,h.hasOwnProperty("speed")?h.speed:1),n.uniform1f(this.program.uniforms.time,Date.now()/1e3-this.time),n.uniform1f(this.program.uniforms.gradientLength,h.hasOwnProperty("gradientLength")?h.gradientLength:10),l.bindBuffers(r),n.vertexAttribPointer(this.program.attributes.vertex,4,n.FLOAT,!1,0,0),n.drawElements(n.LINES,l.lineIndices.length,l.indexType,0)}n.lineWidth(1),n.depthFunc(n.LESS),n.disable(n.BLEND)},a.prototype.canApply=function(e,i){return(e===t.GEOMETRY.LineString||e===t.GEOMETRY.MultiLineString)&&i.gradientLength},a.prototype.createBucket=function(t,e){return new h(t,e)},n.factory.push(function(t){return new a(t)})}),r("Renderer/PointSpriteRenderer",["../Utils/Utils","./VectorRenderer","./Program","./FeatureStyle","./VectorRendererManager","../Utils/Constants"],function(t,e,i,r,n,o){var s=function(t){e.prototype.constructor.call(this,t),this.numberOfRenderPoints=0;var r="attribute vec3 vertex; \n";r+="uniform mat4 viewProjectionMatrix; \n",r+="uniform float pointSize; \n",r+="void main(void)  \n",r+="{ \n",r+="\tgl_Position = viewProjectionMatrix * vec4(vertex,1.0); \n",r+="\tgl_PointSize = pointSize; \n",r+="} \n";var n="precision lowp float; \n";n+="uniform sampler2D texture; \n",n+="uniform float alpha; \n",n+="uniform vec3 color; \n",n+="\n",n+="void main(void) \n",n+="{ \n",n+="\tvec4 textureColor = texture2D(texture, gl_PointCoord); \n",n+="\tgl_FragColor = vec4(textureColor.rgb * color, textureColor.a * alpha); \n",n+="\tif (gl_FragColor.a <= 0.0) discard; \n",n+="\t//gl_FragColor = vec4(1.0); \n",n+="} \n",this.program=new i(t.renderContext),this.program.createFromSource(r,n),this.defaultTexture=null};t.inherits(e,s);var a=function(t){this.bucket=t,this.geometry2vb={},this.vertices=[],this.vertexBuffer=null,this.vertexBufferDirty=!1};a.prototype.add=function(t){this.geometry2vb[t.gid]=this.vertices.length;var e=this.bucket.renderer.globe,i=e.getCoordinateSystem(),r=i.get3DFromWorldInCrs(t.coordinates,t.crs.properties.name),n=i.getGeoide().getRealPlanetRadius(),o=(i.getGeoide().getRadius(),this.bucket.renderer.globe.isSky()?.95:1.0005+i.getElevation(e,t)/n);return this.vertices.push(o*r[0],o*r[1],o*r[2]),this.vertexBufferDirty=!0,!0},a.prototype.remove=function(t){if(this.geometry2vb.hasOwnProperty(t.gid)){var e=this.geometry2vb[t.gid];delete this.geometry2vb[t.gid],this.vertices.splice(e,3),this.vertexBufferDirty=!0;for(var i in this.geometry2vb)i&&this.geometry2vb[i]>e&&(this.geometry2vb[i]-=3)}return this.vertices.length},a.prototype.dispose=function(t){this.vertexBuffer&&t.gl.deleteBuffer(this.vertexBuffer)},s.prototype._buildDefaultTexture=function(t){if(!this.defaultTexture){var e=this.globe.renderContext.gl;this.defaultTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.defaultTexture);var i=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i)}t.texture=this.defaultTexture,t.textureWidth=10,t.textureHeight=10},s.prototype._buildTextureFromImage=function(t,e){t.texture=this.globe.renderContext.createNonPowerOfTwoTextureFromImage(e),t.textureWidth=e.width,t.textureHeight=e.height},s.prototype.canApply=function(t,e){return t===o.GEOMETRY.Point&&!e.label};var l=function(t,e){this.layer=t,this.style=new r(e),this.texture=null,this.renderer=null};return l.prototype.createRenderable=function(){return new a(this)},l.prototype.isCompatible=function(t){return this.style.iconUrl===t.iconUrl&&this.style.icon===t.icon&&this.style.fillColor[0]===t.fillColor[0]&&this.style.fillColor[1]===t.fillColor[1]&&this.style.fillColor[2]===t.fillColor[2]},s.prototype.createBucket=function(t,e){var i=this.globe.renderContext.gl,r=(i.createBuffer(),new l(t,e));if(r.renderer=this,e.iconUrl){var n=new Image;n.crossOrigin="";var o=this;n.onload=function(){o._buildTextureFromImage(r,n),o.globe.renderContext.requestFrame()},n.onerror=function(){o._buildDefaultTexture(r)},n.src=e.iconUrl}else e.icon?this._buildTextureFromImage(r,e.icon):this._buildDefaultTexture(r);return r},s.prototype.render=function(t,e,i){var r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.program.apply(),mat4.multiply(r.projectionMatrix,r.viewMatrix,r.modelViewMatrix),n.uniformMatrix4fv(this.program.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix),n.uniform1i(this.program.uniforms.texture,0);for(var o=null,s=e;s<i;s++){var a=t[s],l=a.bucket;if(o!==l){n.uniform1f(this.program.uniforms.alpha,l.layer.opacity);var h=l.style.fillColor;n.uniform3f(this.program.uniforms.color,h[0],h[1],h[2]),n.uniform1f(this.program.uniforms.pointSize,l.textureWidth),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l.texture),o=l}a.vertexBuffer||(a.vertexBuffer=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,a.vertexBuffer),n.vertexAttribPointer(this.program.attributes.vertex,3,n.FLOAT,!1,0,0),a.vertexBufferDirty&&(n.bufferData(n.ARRAY_BUFFER,new Float32Array(a.vertices),n.STATIC_DRAW),a.vertexBufferDirty=!1),n.drawArrays(n.POINTS,0,a.vertices.length/3)}n.disable(n.BLEND)},n.factory.push(function(t){return new s(t)}),s}),r("Tiling/Triangulator",[],function(){var t=1e-10,e=function(t){for(var e=t.length,i=0,r=e-1,n=0;n<e;r=n++)i+=t[r][0]*t[n][1]-t[n][0]*t[r][1];return.5*i},i=function(t,e,i,r,n,o,s,a){var l,h,u,c,d,p,f,g,m,v,y,b,x,C,_;return l=n-i,h=o-r,u=t-n,c=e-o,d=i-t,p=r-e,f=s-t,g=a-e,m=s-i,v=a-r,y=s-n,b=a-o,_=l*v-h*m,x=d*g-p*f,C=u*b-c*y,_>=0&&C>=0&&x>=0},r=function(e,r,n,o,s,a){var l,h,u,c,d,p,f,g,m;if(h=e[a[r]][0],u=e[a[r]][1],c=e[a[n]][0],d=e[a[n]][1],p=e[a[o]][0],f=e[a[o]][1],t>(c-h)*(f-u)-(d-u)*(p-h))return!1;for(l=0;l<s;l++)if(l!==r&&l!==n&&l!==o&&(g=e[a[l]][0],m=e[a[l]][1],i(h,u,c,d,p,f,g,m)))return!1;return!0},n=function(t){var i=t.length;if(t[0][0]===t[i-1][0]&&t[0][1]===t[i-1][1]&&i--,i<3)return null;var n,o,s=new Array(i);if(0<e(t))for(o=0;o<i;o++)s[o]=o;else for(o=0;o<i;o++)s[o]=i-1-o;var a=i,l=[],h=2*a;for(n=0,o=a-1;a>2;){if(0>=h--)return null;var u=o;a<=u&&(u=0),o=u+1,a<=o&&(o=0);var c=o+1;if(a<=c&&(c=0),r(t,u,o,c,a,s)){var d,p,f,g,m;for(d=s[u],p=s[o],f=s[c],l.push(d),l.push(p),l.push(f),n++,g=o,m=o+1;m<a;g++,m++)s[g]=s[m];a--,h=2*a}}return l},o={process:n};return o}),r("Renderer/ConvexPolygonRenderer",["../Utils/Utils","../Utils/Constants","./VectorRenderer","./Program","./FeatureStyle","./VectorRendererManager","../Tiling/Triangulator","./glMatrix"],function(t,e,i,r,n,o,s){var a=function(t,e){this.layer=t,this.style=new n(e),this.texture=null,this.polygonProgram=null,this.renderer=null,this.mainRenderable=null};a.prototype.isCompatible=function(t){return this.style.strokeColor[0]===t.strokeColor[0]&&this.style.strokeColor[1]===t.strokeColor[1]&&this.style.strokeColor[2]===t.strokeColor[2]&&this.style.fill===t.fill&&this.style.fillTexture===t.fillTexture&&this.style.fillTextureUrl===t.fillTextureUrl&&this.style.fillShader===t.fillShader};var l=function(t){this.bucket=t,this.geometry2vb={},this.vertices=[],this.lineIndices=[],this.triangleIndices=[],this.vertexBuffer=null,this.lineIndexBuffer=null,this.triangleIndexBuffer=null,this.bufferDirty=!1,this.triBufferDirty=!1,this.tcoords=[]};l.prototype.add=function(t){var i,r,n,o=[],a=t.crs.properties.name;if(t.type===e.GEOMETRY.MultiPolygon)for(i=0;i<t.coordinates.length;i++)o.push(t.coordinates[i][0]);else if(t.type===e.GEOMETRY.LineString)o.push(t.coordinates);else if(t.type===e.GEOMETRY.MultiLineString)for(i=0;i<t.coordinates.length;i++)o.push(t.coordinates[i]);else o.push(t.coordinates[0]);for(r=0;r<o.length;r++){var l=o[r],h=l.length,u={vertexStart:this.vertices.length,vertexCount:3*h,lineIndexStart:this.lineIndices.length,lineIndexCount:2*h,triIndexStart:0,triIndexCount:0},c=this.bucket.renderer.globe.getCoordinateSystem();if(t._imageCoordinates){u.tcoordsStart=this.tcoords.length,u.tcoordsCount=2*h;var d=c.get3DFromWorldInCrs(t._imageCoordinates[0][0],a),p=c.get3DFromWorldInCrs(t._imageCoordinates[0][1],a),f=c.get3DFromWorldInCrs(t._imageCoordinates[0][3],a),g=[];vec3.subtract(p,d,g);var m=[];vec3.subtract(f,d,m);var v=vec3.length(g)*vec3.length(g),y=vec3.length(m)*vec3.length(m);for(i=0;i<h;i++){n=c.get3DFromWorldInCrs(l[i],a);var b=[];vec3.subtract(n,d,b);var x=vec3.dot(b,g),C=vec3.dot(b,m),_=x/v,w=C/y;this.tcoords.push(_),this.tcoords.push(w)}}var T=this.vertices.length/3;for(i=0;i<h&&(n=c.get3DFromWorldInCrs(l[i],a),this.vertices.push(n[0],n[1],n[2]),t.type!==e.GEOMETRY.MultiLineString&&t.type!==e.GEOMETRY.LineString||i!==h-1);i++)this.lineIndices.push(T+i,T+(i+1)%h);if(this.bucket.style.fill){u.triIndexStart=this.triangleIndices.length,u.triIndexCount=3*(h-2);var A=s.process(l);if(null!==A)this.triangleIndices=A;else for(i=0;i<h-2;i++)this.triangleIndices.push(T,T+i+1,T+i+2)}this.geometry2vb[t.gid]?(this.geometry2vb[t.gid].vertexCount+=u.vertexCount,this.geometry2vb[t.gid].lineIndexCount+=u.lineIndexCount,this.geometry2vb[t.gid].triIndexCount+=u.triIndexCount):this.geometry2vb[t.gid]=u,this.bufferDirty=!0,this.triBufferDirty=!0}return!0},l.prototype.remove=function(t){var e;if(this.geometry2vb.hasOwnProperty(t.gid)){var i=this.geometry2vb[t.gid];for(delete this.geometry2vb[t.gid],this.vertices.splice(i.vertexStart,i.vertexCount),e=i.lineIndexStart+i.lineIndexCount;e<this.lineIndices.length;e++)this.lineIndices[e]-=i.vertexCount/3;for(e=i.triIndexStart+i.triIndexCount;e<this.triangleIndices.length;e++)this.triangleIndices[e]-=i.vertexCount/3;this.lineIndices.splice(i.lineIndexStart,i.lineIndexCount),this.triangleIndices.splice(i.triIndexStart,i.triIndexCount),i.tcoordsStart>=0&&this.tcoords.splice(i.tcoordsStart,i.tcoordsCount);for(var r in this.geometry2vb)if(r){var n=this.geometry2vb[r];n.vertexStart>i.vertexStart&&(n.vertexStart-=i.vertexCount,n.lineIndexStart-=i.lineIndexCount,n.triIndexStart-=i.triIndexCount,n.tcoordsStart>=0&&(n.tcoordsStart-=i.tcoordsCount))}this.bufferDirty=!0,this.triBufferDirty=!0}return this.vertices.length},l.prototype.dispose=function(t){this.vertexBuffer&&t.gl.deleteBuffer(this.vertexBuffer),this.lineIndexBuffer&&t.gl.deleteBuffer(this.lineIndexBuffer),this.triangleIndexBuffer&&t.gl.deleteBuffer(this.triangleIndexBuffer),this.tcoordBuffer&&t.gl.deleteBuffer(this.tcoordBuffer)},a.prototype.createRenderable=function(){return new l(this)};var h=function(t){i.prototype.constructor.call(this,t),this.maxTilePerGeometry=2,this.renderContext=t.tileManager.renderContext,this.tileConfig=t.tileManager.tileConfig,this.programs=[],this.basicVertexShader="attribute vec3 vertex;\n",this.basicVertexShader+="uniform mat4 viewProjectionMatrix;\n",this.basicVertexShader+="    \n",this.basicVertexShader+="    void main(void)\n",this.basicVertexShader+="    {\n",this.basicVertexShader+="        gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n",this.basicVertexShader+="    }\n",this.basicFragmentShader="precision lowp float; \n",this.basicFragmentShader+="    uniform vec4 color; \n",this.basicFragmentShader+="    \n",this.basicFragmentShader+="    void main(void) \n",this.basicFragmentShader+="    { \n",this.basicFragmentShader+="        gl_FragColor = color; \n",this.basicFragmentShader+="    } \n",this.texVertexShader="attribute vec3 vertex;\n",this.texVertexShader+="    attribute vec2 tcoord;\n",this.texVertexShader+="    uniform mat4 viewProjectionMatrix;\n",this.texVertexShader+="    \n",this.texVertexShader+="    varying vec2 vTextureCoord;\n",this.texVertexShader+="    \n",this.texVertexShader+="    void main(void) \n",this.texVertexShader+="    {\n",this.texVertexShader+="        vTextureCoord = tcoord;\n",this.texVertexShader+="        vTextureCoord.y = 1.0 - vTextureCoord.y; \n",this.texVertexShader+="        gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n",this.texVertexShader+="    }\n",this.texFragmentShader="precision lowp float; \n",this.texFragmentShader+="    uniform vec4 color;\n",this.texFragmentShader+="    varying vec2 vTextureCoord;\n",this.texFragmentShader+="    uniform sampler2D texture; \n",this.texFragmentShader+="    void main(void)\n",this.texFragmentShader+="    {\n",this.texFragmentShader+="        gl_FragColor = texture2D(texture, vTextureCoord) * color;\n",this.texFragmentShader+="    }\n",this.basicFillShader={vertexCode:this.basicVertexShader,fragmentCode:this.basicFragmentShader,updateUniforms:null},this.texFillShader={vertexCode:this.texVertexShader,fragmentCode:this.texFragmentShader,updateUniforms:null},this.basicProgram=this.createProgram(this.basicFillShader),this.texProgram=this.createProgram(this.texFillShader);var e=this.renderContext.gl;this.whiteTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.whiteTexture);var r=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r),this.tcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.tcoordBuffer);var n=[0,0,1,0,1,1,0,1,0,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),this.tcoordBuffer.itemSize=2,this.tcoordBuffer.numItems=5};return t.inherits(i,h),h.prototype.canApply=function(t,i){return!!this.globe.isSky()&&(t===e.GEOMETRY.Polygon||t===e.GEOMETRY.MultiPolygon||t===e.GEOMETRY.LineString||t===e.GEOMETRY.MultiLineString)},h.prototype.createProgram=function(t){var e=new r(this.renderContext);return e.createFromSource(t.vertexCode,t.fragmentCode),e.id=this.programs.length,this.programs.push({fillShader:t,program:e}),e},h.prototype.getProgram=function(t){for(var e,i=0;i<this.programs.length;i++)this.programs[i].fillShader===t&&(e=this.programs[i].program);return e||(e=this.createProgram(t)),e},h.prototype.createBucket=function(t,e){var i=this.renderContext.gl,r=(i.createBuffer(),new a(t,e)),n=this;if(e.fill){var o=!1;if(e.fillTextureUrl){var s=new Image;s.crossOrigin="",s.onload=function(){r.texture=n.renderContext.createNonPowerOfTwoTextureFromImage(s,t.invertY)},s.onerror=function(t){console.log("Cannot load "+s.src)},s.src=e.fillTextureUrl,o=!0}else e.fillTexture&&(r.texture=e.fillTexture,o=!0);e.fillShader&&e.fillShader.fragmentCode?(e.fillShader.vertexCode||(e.fillShader.vertexCode=this.texVertexShader),e.fillShader.vertexCode||(e.fillShader.fragmentCode=this.texFragmentShader),r.polygonProgram=this.getProgram(e.fillShader)):r.polygonProgram=o?this.texProgram:this.basicProgram}return r},h.prototype.render=function(t,e,i){var r=this.renderContext,n=this.renderContext.gl;n.disable(n.DEPTH_TEST),n.depthMask(!1),n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.basicProgram.apply(),mat4.multiply(r.projectionMatrix,r.viewMatrix,r.modelViewMatrix),n.uniformMatrix4fv(this.basicProgram.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix);for(var o=e;o<i;o++){var s=t[o],a=s.bucket,l=a.style.strokeColor;if(n.uniform4f(this.basicProgram.uniforms.color,l[0],l[1],l[2],l[3]*a.layer.getOpacity()),s.vertexBuffer||(s.vertexBuffer=n.createBuffer(),s.lineIndexBuffer=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,s.vertexBuffer),n.vertexAttribPointer(this.basicProgram.attributes.vertex,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.lineIndexBuffer),s.bufferDirty&&(n.bufferData(n.ARRAY_BUFFER,new Float32Array(s.vertices),n.STATIC_DRAW),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(s.lineIndices),n.STATIC_DRAW),s.bufferDirty=!1),n.drawElements(n.LINES,s.lineIndices.length,n.UNSIGNED_SHORT,0),a.polygonProgram){var h=a.polygonProgram;h.apply(),n.uniformMatrix4fv(h.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix),n.uniform1i(h.uniforms.texture,0),s.tcoords.length>0?(s.tcoordBuffer||(s.tcoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,s.tcoordBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(s.tcoords),n.STATIC_DRAW),s.tcoordBuffer.itemSize=2,s.tcoordBuffer.numItems=s.tcoords.length/2),n.bindBuffer(n.ARRAY_BUFFER,s.tcoordBuffer)):n.bindBuffer(n.ARRAY_BUFFER,this.tcoordBuffer),n.vertexAttribPointer(h.attributes.tcoord,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,s.vertexBuffer),n.vertexAttribPointer(h.attributes.vertex,3,n.FLOAT,!1,0,0),a.style.fillShader&&a.style.fillShader.updateUniforms&&a.style.fillShader.updateUniforms(n,s.bucket,h),s.triangleIndexBuffer||(s.triangleIndexBuffer=n.createBuffer()),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.triangleIndexBuffer),s.triBufferDirty&&(n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(s.triangleIndices),n.STATIC_DRAW),s.triBufferDirty=!1),n.activeTexture(n.TEXTURE0),s.bucket.texture?(n.bindTexture(n.TEXTURE_2D,s.bucket.texture),n.uniform4f(h.uniforms.color,1,1,1,l[3]*a.layer.getOpacity())):(n.bindTexture(n.TEXTURE_2D,this.whiteTexture),l=s.bucket.style.fillColor,n.uniform4f(h.uniforms.color,l[0],l[1],l[2],l[3]*a.layer.getOpacity())),n.drawElements(n.TRIANGLES,s.triangleIndices.length,n.UNSIGNED_SHORT,0),this.basicProgram.apply()}}n.enable(n.DEPTH_TEST),n.depthMask(!0),n.disable(n.BLEND)},o.factory.push(function(t){return new h(t)}),h}),r("Context/AbstractContext",["jquery","underscore-min","../Utils/Event","../Utils/Utils","../Layer/LayerFactory","../Services/ServiceFactory","../Utils/Constants","../Gui/Tracker/PositionTracker","../Gui/Tracker/ElevationTracker","../Utils/AttributionHandler","../Renderer/PointRenderer","../Renderer/LineStringRenderable","../Renderer/PolygonRenderer","../Renderer/LineRenderer","../Renderer/PointSpriteRenderer","../Renderer/ConvexPolygonRenderer"],function(t,e,i,r,n,o,s,a,l,h){function u(t){if(t.isVisible()&&t.properties&&!t.background&&t.properties.hasOwnProperty("initialRa")&&t.properties.hasOwnProperty("initialDec")&&t.properties.hasOwnProperty("initialFov"))if(self.getMode()===s.GLOBE.Sky){var e=self.getNavigation().getRenderContext().fov;self.getNavigation().zoomTo([t.properties.initialRa,t.properties.initialDec],{fov:e,duration:3e3})}else self.getNavigation().zoomTo([t.properties.initialRa,t.properties.initialDec],{distance:t.properties.initialFov,duration:3e3})}var c=function(e,r,n){i.prototype.constructor.call(this);var o=this;this.components={},this.dataProviders={},this.canvas=e.canvas,this.subscribe("baseLayersReady",function(e){t(o.canvas.parentElement).find("#loading").hide()}),this.globe=null,this.navigation=null,this.mizarConfiguration=e.hasOwnProperty("configuration")?e.configuration:{},this.credits=!0,this.ctxOptions=n,this.mode=r,this.layers=[],this.initCanvas(this.canvas),this.positionTracker=new a({
element:this.mizarConfiguration.positionTracker&&this.mizarConfiguration.positionTracker.element?this.mizarConfiguration.positionTracker.element:"posTracker",isMobile:!!this.mizarConfiguration.isMobile,position:this.mizarConfiguration.positionTracker&&this.mizarConfiguration.positionTracker.position?this.mizarConfiguration.positionTracker.position:"bottom"}),this.elevationTracker=new l({element:this.mizarConfiguration.elevationTracker&&this.mizarConfiguration.elevationTracker.element?this.mizarConfiguration.elevationTracker.element:"elevTracker",isMobile:!!this.mizarConfiguration.isMobile,position:this.mizarConfiguration.elevationTracker&&this.mizarConfiguration.elevationTracker.elevation?this.mizarConfiguration.elevationTracker.position:"bottom",elevationLayer:void 0!==n.planetLayer?n.planetLayer.elevationLayer:void 0})};return r.inherits(i,c),c.prototype.registerNoStandardDataProvider=function(t,e){this.dataProviders[t.toString()]=e},c.prototype.getContextConfiguration=function(){return this.ctxOptions},c.prototype.getMizarConfiguration=function(){return this.mizarConfiguration},c.prototype.getLonLatFromPixel=function(t,e){return this.globe.getLonLatFromPixel(t,e)},c.prototype.getElevation=function(t,e){return this.globe.getElevation(t,e)},c.prototype.getPositionTracker=function(){return this.positionTracker},c.prototype.getElevationTracker=function(){return this.elevationTracker},c.prototype.getLayers=function(){return this.layers},c.prototype.getLayerByID=function(t){return e.find(e.union(this.getLayers()),function(e){return e.ID===t})},c.prototype.getLayerByName=function(t){return e.findWhere(this.getLayers(),{name:t})},c.prototype.addLayer=function(t,e){var i=n.create(t);if(e?e.layers.push(i):"Planet"===i.type?this.layers.push(i):(this.layers.push(i),"background"===i.category&&i.isVisible()?this.globe.setBaseImagery(i):this.globe.addLayer(i)),t.data&&this.dataProviders[t.data.type]){var r=this.dataProviders[t.data.type];r(i,t.data)}i.pickable&&o.create(s.SERVICE.PickingManager).addPickableLayer(i),i.subscribe("visibility:changed",u);var a="background"===i.category?"backgroundLayer:add":"additionalLayer:add";return this.publish(a,i),i},c.prototype.removeLayer=function(e){var i=null,r=t.map(this.layers,function(t,i){if(t.ID===e)return i});if(r.length>0){var n=this.layers.splice(r[0],1);i=n[0],i.unsubscribe("visibility:changed",u),o.create(s.SERVICE.PickingManager).removePickableLayer(i),i._detach()}return i},c.prototype.initTouchNavigation=function(t){t.navigation.touch={inversed:this.globe.isSky(),zoomOnDblClick:!0};var e=this;window.addEventListener("orientationchange",function(){e.refresh()},!1)},c.prototype.refresh=function(){this.globe.refresh()},c.prototype.initCanvas=function(e){var i,r,n=t(e.parentElement);t(e.parentElement).find("#loading").show(),i=t(e).attr("width")?t(e).attr("width"):n.attr("width")?n.attr("width"):window.innerWidth,r=t(e).attr("height")?t(e).attr("height"):n.attr("height")?n.attr("height"):window.innerHeight,e.width=i,e.height=r,n&&n.css({position:"relative",overflow:"hidden"});var o,s=this,a=function(){n&&n.attr("height")&&n.attr("width")?(e.width=n.width(),e.height=n.height()):(e.width=window.innerWidth,e.height=window.innerHeight),s.refresh()};t(window).resize(function(){o&&clearTimeout(o),o=setTimeout(a,500)}),e.addEventListener("webglcontextlost",function(t){t.preventDefault(),document.getElementById("loading").style.display="none",document.getElementById("webGLContextLost").style.display="block"},!1)},c.prototype.initGlobeEvents=function(e){e&&(this.globe=e,new h(this.globe,{element:this.mizarConfiguration.attributionHandler&&this.mizarConfiguration.attributionHandler.element?this.mizarConfiguration.attributionHandler.element:"globeAttributions"}),this.mizarConfiguration.isMobile&&this.initTouchNavigation(options),this.positionTracker.attachTo(this.globe),this.elevationTracker.attachTo(this.globe));var i=this;this.subscribe("baseLayersError",function(e){t(i.canvas.parentElement).find("#loading").hide(),console.log("error")})},c.prototype.show=function(){this.navigation.start();for(var e in this.components)this.components[e]&&t("#"+e).fadeIn(1e3)},c.prototype.showComponents=function(){for(var e in this.components)this.components[e]&&t("#"+e).fadeIn(1e3)},c.prototype.hideComponents=function(e){for(var i in this.components)t.inArray(i,e)===-1&&t("#"+i).fadeOut()},c.prototype.hide=function(){this.navigation.stopAnimations(),this.navigation.stop();for(var e in this.components)t("#"+e).fadeOut()},c.prototype.setComponentVisibility=function(e,i){var r=t("#"+e);i?r.show():r.hide(),this.components[e]=i},c.prototype.showAdditionalLayers=function(){e.each(this.visibleLayers,function(t){t.setVisible(!0)})},c.prototype.hideAdditionalLayers=function(){this.visibleLayers=[];var t=this.getAdditionalLayers(),i=this;e.each(t,function(t){t.isVisible()&&(t.setVisible(!1),i.visibleLayers.push(t))})},c.prototype.setBackgroundLayer=function(t){var e=this.getLayerByName(t);return e?(this.globe.setBaseImagery(e),this.publish("backgroundLayer:change",e)):this.publish("backgroundSurveyError","Survey "+layerName+" hasn't been found"),e},c.prototype.setBackgroundLayerByID=function(t){var e=this.getLayerByID(t);return e&&this.globe.setBaseImagery(e),e},c.prototype.getAdditionalLayers=function(){return e.filter(this.layers,function(t){return"background"!==t.category})},c.prototype.getRenderContext=function(){return this.globe.getRenderContext()},c.prototype.disable=function(){throw"Disable not implemented"},c.prototype.enable=function(){throw"Enable not implemented"},c.prototype.setCompassVisible=function(t,e){throw"compass visible not implemented"},c.prototype.getMode=function(){return this.mode},c.prototype.setCoordinateSystem=function(t){throw"CRS not implemented"},c.prototype.getNavigation=function(){return this.navigation},c.prototype.getCoordinateSystem=function(){return this.globe.getCoordinateSystem()},c.prototype.addAnimation=function(t){this.globe.addAnimation(t)},c.prototype.removeAnimation=function(t){this.globe.removeAnimation(t)},c.prototype.render=function(){this.globe.render()},c.prototype.dispose=function(){this.globe.dispose()},c.prototype.destroy=function(){throw"destroy Not implemented"},c}),r("Tiling/TilePool",[],function(){var t=function(t){var e=t.gl,i={},r=[],n=this,o=e.getExtension("OES_texture_float_linear"),s=o?e.LINEAR:e.NEAREST;this.numCreatedTextures=0,this.numReusedTextures=0;var a=function(t,i){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),"byte"===t.dataType?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):(e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t.width,t.height,0,e.LUMINANCE,e.FLOAT,t.typedArray),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r.pool=i,n.numCreatedTextures++,r},l=function(t,i){var r=i.pop();return e.bindTexture(e.TEXTURE_2D,r),"byte"===t.dataType?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D)):e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t.width,t.height,0,e.LUMINANCE,e.FLOAT,t.typedArray),n.numReusedTextures++,r},h=function(t){var e=t.dataType+t.width;return i[e]||(i[e]=[]),i[e]};this.createGLTexture=function(t){var e=h(t);return e.length>0?l(t,e):a(t,e)},this.createGLBuffer=function(t){var i;return i=r.length>0?r.pop():e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),i},this.disposeGLTexture=function(t){t.pool.push(t)},this.disposeGLBuffer=function(t){r.push(t)},this.disposeAll=function(){var t;for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];for(t=0;t<o.length;t++)e.deleteTexture(o[t])}for(i={},t=0;t<r.length;t++)e.deleteBuffer(r[t]);r.length=0}};return t}),r("Tiling/TileRequest",["./Tile","../Utils/ImageRequest"],function(t,e){var i=function(i){var r,n=!1,o=!0,s=new XMLHttpRequest;this.tile=null,this.elevations=null,this.image=null;var a=this,l=function(){a.elevations=i.elevationProvider.parseElevations(s.responseText),o=!0,n&&(i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame())},h=function(){a.elevations=null,o=!0,n&&(i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame())};s.onreadystatechange=function(t){4===s.readyState&&(200===s.status?l():h())};var u=function(){n||(n=!0,o&&(i.imageryProvider&&i.imageryProvider.handleImage&&i.imageryProvider.handleImage(r),i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame()),a.image=r.image)},c=function(){a.tile.state=t.State.ERROR,i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.availableRequests.push(a)},d=function(){a.tile.state=t.State.NONE,i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.availableRequests.push(a)};this.launch=function(l){if(l.state=t.State.LOADING,this.tile=l,i.pendingRequests.push(this),this.image=null,this.elevations=null,i.elevationProvider){o=!1,s.open("GET",i.elevationProvider.getUrl(l));var h="use-credentials"===i.elevationProvider.crossOrigin;s.withCredentials=h,s.send()}else o=!0;if(i.imageryProvider){r||(r=new e({successCallback:function(){u(),i.imageryProvider.cache&&i.imageryProvider.cache.storeInCache(a)},failCallback:c,abortCallback:d}));var p;i.imageryProvider.cache&&(p=p=i.imageryProvider.cache.getFromCache(l)),n=!1,p?(r.image=p.image,u()):r.send(i.imageryProvider.getUrl(l),i.imageryProvider.crossOrigin)}else n=!0;i.imageryProvider||i.elevationProvider||(i.pendingRequests.splice(i.pendingRequests.indexOf(this),1),i.completedRequests.push(this))},this.abort=function(){r&&r.abort()}};return i}),r("Tiling/TileIndexBuffer",[],function(){var t=function(t,e){this.renderContext=t,this.config=e,this.solidIndexBuffer=null,this.subSolidIndexBuffer=[null,null,null,null],this.subIndices=[null,null,null,null]};return t.prototype.reset=function(){for(var t=this.renderContext.gl,e=0;e<4;e++)this.subSolidIndexBuffer[e]&&(t.deleteBuffer(this.subSolidIndexBuffer[e]),this.subSolidIndexBuffer[e]=null);this.solidIndexBuffer&&(t.deleteBuffer(this.solidIndexBuffer),this.solidIndexBuffer=null)},t.prototype.getSubSolid=function(t){if(null===this.subSolidIndexBuffer[t]){var e,i,r=t%2,n=Math.floor(t/2),o=this.config.tesselation,s=(o-1)/2,a=[];for(e=s*n;e<s*(n+1);e++)for(i=s*r;i<s*(r+1);i++)a.push(e*o+i),a.push((e+1)*o+i),a.push(e*o+i+1),a.push(e*o+i+1),a.push((e+1)*o+i),a.push((e+1)*o+i+1);if(this.subIndices[t]=a,this.config.skirt){var l=0===n?o*o:o*o+4*o,h=0===n?0:s*o;for(e=s*r;e<s*(r+1);e++)a.push(l+e),a.push(h+e),a.push(l+e+1),a.push(l+e+1),a.push(h+e),a.push(h+e+1);for(l=0===n?o*o+4*o:o*o+o,h=0===n?s*o:(o-1)*o,e=s*r;e<s*(r+1);e++)a.push(h+e),a.push(l+e),a.push(h+e+1),a.push(h+e+1),a.push(l+e),a.push(l+e+1);for(l=0===r?o*o+2*o:o*o+5*o,h=0===r?0:s,i=s*n;i<s*(n+1);i++)a.push(l+i),a.push(l+i+1),a.push(h+i*o),a.push(h+i*o),a.push(l+i+1),a.push(h+(i+1)*o);for(l=0===r?o*o+5*o:o*o+3*o,h=0===r?s:o-1,i=s*n;i<s*(n+1);i++)a.push(i*o+h),a.push((i+1)*o+h),a.push(l+i),a.push(l+i),a.push((i+1)*o+h),a.push(l+i+1)}var u=this.renderContext.gl,c=u.createBuffer();u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,c),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),u.STATIC_DRAW),c.numIndices=a.length,this.subSolidIndexBuffer[t]=c}return this.subSolidIndexBuffer[t]},t.prototype.getSolid=function(){if(null===this.solidIndexBuffer){var t,e,i=this.config.tesselation,r=[];for(e=0;e<i-1;e++)for(t=0;t<i-1;t++)r.push(e*i+t),r.push((e+1)*i+t),r.push(e*i+t+1),r.push(e*i+t+1),r.push((e+1)*i+t),r.push((e+1)*i+t+1);if(this.config.skirt){var n=i*i;for(t=0;t<i-1;t++)r.push(n+t),r.push(t),r.push(n+t+1),r.push(n+t+1),r.push(t),r.push(t+1);for(n+=i,t=0;t<i-1;t++)r.push((i-1)*i+t),r.push(n+t),r.push((i-1)*i+t+1),r.push((i-1)*i+t+1),r.push(n+t),r.push(n+t+1);for(n+=i,e=0;e<i-1;e++)r.push(n+e),r.push(n+e+1),r.push(e*i),r.push(e*i),r.push(n+e+1),r.push((e+1)*i);for(n+=i,e=0;e<i-1;e++)r.push(e*i+i-1),r.push((e+1)*i+i-1),r.push(n+e),r.push(n+e),r.push((e+1)*i+i-1),r.push(n+e+1)}var o=this.renderContext.gl,s=o.createBuffer();o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),o.STATIC_DRAW),this.numIndices=r.length,this.solidIndexBuffer=s,this.solidIndexBuffer.numIndices=r.length}return this.solidIndexBuffer},t}),r("Tiling/TileManager",["./Tile","./GeoTiling","./TilePool","./TileRequest","./TileIndexBuffer","../Renderer/Program"],function(t,e,i,r,n,o){var s=function(t,s){this.parent=t,this.publishEvent=s.publishEvent,this.renderContext=this.parent.renderContext,this.tilePool=t.tilePool||new i(this.renderContext),this.tiling=new e(4,2),this.imageryProvider=null,this.elevationProvider=null,this.tilesToRender=[],this.visibleTiles=[],this.tilesToRequest=[],this.postRenderers=[];var a=this.renderContext.gl;this.defaultTexture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.defaultTexture);var l=s.defaultColor?s.defaultColor:[200,200,200,255],h=new Uint8Array(l);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,h),this.maxRequests=4,this.availableRequests=[];for(var u=0;u<this.maxRequests;u++)this.availableRequests[u]=new r(this);this.pendingRequests=[],this.completedRequests=[],this.level0TilesLoaded=!1,this.tileConfig={tesselation:9,skirt:!0,cullSign:1,imageSize:256,vertexSize:this.renderContext.lighting?6:3,normals:this.renderContext.lighting,coordinateSystem:this.parent.coordinateSystem},this.level0Tiles=this.tiling.generateLevelZeroTiles(this.tileConfig,this.tilePool),this.tcoordBuffer=null,this.tileIndexBuffer=new n(this.renderContext,this.tileConfig),this.renderTileWithoutTexture=!s.hasOwnProperty("renderTileWithoutTexture")||s.renderTileWithoutTexture,this.freeze=!1,this.numTilesGenerated=0,this.frameNumber=0,this.vertexShader="attribute vec3 vertex;\n",this.vertexShader+="attribute vec2 tcoord;\n",this.vertexShader+="uniform mat4 modelViewMatrix;\n",this.vertexShader+="uniform mat4 projectionMatrix;\n",this.vertexShader+="varying vec2 texCoord;\n",this.renderContext.lighting&&(this.vertexShader+="attribute vec3 normal;\nvarying vec3 color;\n"),this.vertexShader+="void main(void) \n",this.vertexShader+="{\n",this.vertexShader+="gl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",this.renderContext.lighting&&(this.vertexShader+="vec4 vn = modelViewMatrix * vec4(normal,0);\ncolor = max( vec3(-vn[2],-vn[2],-vn[2]), 0.0 );\n"),this.vertexShader+="texCoord = tcoord;\n",this.vertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="varying vec2 texCoord;\n",this.renderContext.lighting&&(this.fragmentShader+="varying vec3 color;\n"),this.fragmentShader+="uniform sampler2D colorTexture;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor.rgb = texture2D(colorTexture, texCoord).rgb;\n",this.renderContext.lighting&&(this.fragmentShader+="  gl_FragColor.rgb *= color;\n"),this.fragmentShader+="  gl_FragColor.a = 1.0;\n",this.fragmentShader+="}\n",this.program=new o(this.renderContext),this.program.createFromSource(this.vertexShader,this.fragmentShader)};s.prototype.addPostRenderer=function(t){this.postRenderers.push(t),this.postRenderers.sort(function(t,e){var i=0|t.zIndex,r=0|e.zIndex;return i-r}),t.generate&&this.visitTiles(function(e){t.generate(e)})},s.prototype.removePostRenderer=function(t){var e=this.postRenderers.indexOf(t);e!==-1&&(t.cleanupTile&&this.visitTiles(function(e){t.cleanupTile(e)}),this.postRenderers.splice(e,1))},s.prototype.setImageryProvider=function(t){this.reset(),this.imageryProvider=t,t&&(this.tilePool.disposeAll(),this.tiling=t.tiling,this.tileConfig.imageSize=t.tilePixelSize,this.level0Tiles=this.tiling.generateLevelZeroTiles(this.tileConfig,this.tilePool),t.customShader?(this.program.dispose(),this.program=new o(this.renderContext),this.currentFragmentShader=t.customShader.fragmentCode?t.customShader.fragmentCode:this.fragmentShader,this.program.createFromSource(t.customShader.vertexCode?t.customShader.vertexCode:this.vertexShader,this.currentFragmentShader)):null!==this.currentFragmentShader&&(this.program.dispose(),this.program=new o(this.renderContext),this.program.createFromSource(this.vertexShader,this.fragmentShader),this.currentFragmentShader=null))},s.prototype.setElevationProvider=function(t){this.reset(),this.elevationProvider=t;var e=t?t.tilePixelSize:9;if(e!==this.tileConfig.tesselation){this.tileConfig.tesselation=e;var i=this.renderContext.gl;this.tileIndexBuffer.reset(),i.deleteBuffer(this.tcoordBuffer),this.tcoordBuffer=null}},s.prototype.reset=function(){this.abortRequests();for(var t=0;t<this.level0Tiles.length;t++)this.level0Tiles[t].deleteChildren(this.renderContext,this.tilePool),this.level0Tiles[t].dispose(this.renderContext,this.tilePool);this.tileIndexBuffer.reset(),this.level0TilesLoaded=!1},s.prototype.abortRequests=function(){for(var t=this.pendingRequests.length-1;t>=0;t--)this.pendingRequests[t].abort()},s.prototype.visitTiles=function(t){for(var e=this.level0Tiles.concat([]);e.length>0;){var i=e.shift();t(i),i.children&&(e.push(i.children[0]),e.push(i.children[1]),e.push(i.children[2]),e.push(i.children[3]))}},s.prototype.traverseTiles=function(){this.tilesToRender.length=0,this.visibleTiles.length=0,this.tilesToRequest.length=0,this.numTraversedTiles=0;var e,i;if(!this.level0TilesLoaded){for(this.level0TilesLoaded=!0,e=0;e<this.level0Tiles.length;e++){i=this.level0Tiles[e];var r=i.state===t.State.LOADED;i.frameNumber=this.frameNumber,this.level0TilesLoaded=this.level0TilesLoaded&&r,r||(i.state===t.State.NONE?(i.state=t.State.REQUESTED,this.tilesToRequest.push(i)):i.state===t.State.ERROR&&this.imageryProvider&&this.publishEvent("baseLayersError",this.imageryProvider))}this.level0TilesLoaded&&this.imageryProvider&&this.publishEvent("baseLayersReady",this.imageryProvider)}if(this.level0TilesLoaded)for(e=0;e<this.level0Tiles.length;e++)i=this.level0Tiles[e],i.isCulled(this.renderContext)?i.deleteChildren(this.renderContext,this.tilePool):this.processTile(i,0)},s.prototype.processTile=function(e,i){this.numTraversedTiles++,e.frameNumber=this.frameNumber;var r=!0;if(e.state===t.State.NONE&&(e.state=t.State.REQUESTED,this.tilesToRequest.push(e)),e.state===t.State.LOADED&&(r=!!this.imageryProvider&&i>=this.imageryProvider.numberOfLevels,r|=!e.needsToBeRefined(this.renderContext)),r)(e.texture||this.renderTileWithoutTexture)&&this.tilesToRender.push(e),this.visibleTiles.push(e);else{null===e.children&&e.createChildren();for(var n=0;n<4;n++)e.children[n].isCulled(this.renderContext)?e.children[n].deleteChildren(this.renderContext,this.tilePool):this.processTile(e.children[n],i+1)}for(var o in e.extension){var s=e.extension[o];s.traverse&&s.traverse(e,r)}},s.prototype.generateTile=function(t,e){t.generate(this.tilePool,e.image,e.elevations);for(var i=0;i<this.postRenderers.length;i++)this.postRenderers[i].generate&&this.postRenderers[i].generate(t);this.numTilesGenerated++,this.renderContext.requestFrame()},s.prototype.generateReceivedTiles=function(){for(;this.completedRequests.length>0;){var e=this.completedRequests.pop(),i=e.tile;i.frameNumber===this.frameNumber?this.generateTile(i,e):i.state=t.State.NONE,this.availableRequests.push(e)}this.availableRequests.length===this.maxRequests&&this.imageryProvider&&this.publishEvent("endBackgroundLoad")},s.prototype.renderTiles=function(){var e,i,r,n,s=this.renderContext,a=s.gl;if(this.tileConfig.cullSign<0)r=.2*this.tileConfig.coordinateSystem.geoide.radius,n=1.1*this.tileConfig.coordinateSystem.geoide.radius;else for(r=1e9,n=0,e=0;e<this.visibleTiles.length;e++)i=this.visibleTiles[e],r=Math.min(r,i.distance-1.5*i.radius),n=Math.max(n,i.distance+1.5*i.radius);if(s.near=Math.max(s.minNear,r),s.far=Math.max(s.minFar,n),0!==this.tilesToRender.length){this.tileConfig.cullSign<0?(a.depthMask(!1),a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE)):(a.enable(a.POLYGON_OFFSET_FILL),a.polygonOffset(0,4)),this.currentFragmentShader&&this.currentFragmentShader!==this.imageryProvider.customShader.fragmentCode&&(this.program.dispose(),this.program=new o(this.renderContext),this.imageryProvider&&this.imageryProvider.customShader&&(this.currentFragmentShader=this.imageryProvider.customShader.fragmentCode?this.imageryProvider.customShader.fragmentCode:this.fragmentShader,this.program.createFromSource(this.imageryProvider.customShader.vertexShader?this.imageryProvider.customShader.vertexShader:this.vertexShader,this.currentFragmentShader))),this.program.apply();var l=this.program.attributes;mat4.perspective(s.fov,s.canvas.width/s.canvas.height,s.near,s.far,s.projectionMatrix),this.imageryProvider&&this.imageryProvider.customShader&&this.imageryProvider.customShader.updateUniforms(a,this.program),a.activeTexture(a.TEXTURE0),a.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,s.projectionMatrix),a.uniform1i(this.program.uniforms.colorTexture,0),this.tcoordBuffer||this.buildSharedTexCoordBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.tcoordBuffer),a.vertexAttribPointer(l.tcoord,2,a.FLOAT,!1,0,0);var h=null;for(e=0;e<this.tilesToRender.length;e++){i=this.tilesToRender[e];var u=i.state===t.State.LOADED,c=i.parentIndex===-1;i.texture?a.bindTexture(a.TEXTURE_2D,i.texture):a.bindTexture(a.TEXTURE_2D,this.defaultTexture),mat4.multiply(s.viewMatrix,i.matrix,s.modelViewMatrix),a.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,s.modelViewMatrix),a.bindBuffer(a.ARRAY_BUFFER,i.vertexBuffer),a.vertexAttribPointer(l.vertex,3,a.FLOAT,!1,4*this.tileConfig.vertexSize,0),this.tileConfig.normals&&a.vertexAttribPointer(l.normal,3,a.FLOAT,!1,4*this.tileConfig.vertexSize,12);var d=u||c?this.tileIndexBuffer.getSolid():this.tileIndexBuffer.getSubSolid(i.parentIndex);h!==d&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d),h=d),a.drawElements(a.TRIANGLES,h.numIndices,a.UNSIGNED_SHORT,0)}this.tileConfig.cullSign<0?(a.depthMask(!0),a.enable(a.DEPTH_TEST)):a.disable(a.POLYGON_OFFSET_FILL)}for(e=0;e<this.postRenderers.length;e++)this.postRenderers[e].render(this.visibleTiles)};var a=function(t,e){return t.distance-e.distance};return s.prototype.launchRequests=function(){this.tilesToRequest.sort(a);for(var e=this.tilesToRequest.length,i=0;i<e;i++){var r=this.tilesToRequest[i];if(this.availableRequests.length>0){this.availableRequests.length===this.maxRequests&&this.imageryProvider&&this.publishEvent("startBackgroundLoad");var n=this.availableRequests.pop();n.launch(r)}else r.state=t.State.NONE}},s.prototype.render=function(){if(!this.imageryProvider||this.imageryProvider._ready){if(!this.level0TilesLoaded&&this.imageryProvider&&this.imageryProvider.levelZeroImage){this.imageryProvider.generateLevel0Textures(this.level0Tiles,this.tilePool);for(var t=0;t<this.level0Tiles.length;t++){var e=this.level0Tiles[t];this.generateTile(e,{})}this.level0TilesLoaded=!0,this.publishEvent("baseLayersReady",this.parent.isSky())}var i=this.renderContext.stats;this.freeze||(i&&i.start("traverseTime"),this.traverseTiles(),i&&i.end("traverseTime")),!this.level0TilesLoaded&&this.imageryProvider||(i&&i.start("renderTime"),this.renderTiles(),i&&i.end("renderTime")),i&&i.start("generateTime"),this.generateReceivedTiles(),i&&i.end("generateTime"),i&&i.start("requestTime"),this.launchRequests(),i&&i.end("requestTime"),this.frameNumber++}},s.prototype.getVisibleTile=function(t,e){return this.tiling.findInsideTile(t,e,this.visibleTiles)},s.prototype.buildSharedTexCoordBuffer=function(){var t=this.tileConfig.tesselation,e=this.tileConfig.skirt,i=2*t*t;e&&(i+=2*t*6);var r,n,o,s,a=new Float32Array(i),l=1/(t-1),h=0;for(n=0,s=0;s<t;s++){for(r=0,o=0;o<t;o++)a[h]=r,a[h+1]=n,h+=2,r+=l;n+=l}if(e){for(r=0,n=0,o=0;o<t;o++)a[h]=r,a[h+1]=n,r+=l,h+=2;for(r=0,n=1,o=0;o<t;o++)a[h]=r,a[h+1]=n,r+=l,h+=2;for(r=0,n=0,o=0;o<t;o++)a[h]=r,a[h+1]=n,n+=l,h+=2;for(r=1,n=0,o=0;o<t;o++)a[h]=r,a[h+1]=n,n+=l,h+=2;for(r=0,n=.5,o=0;o<t;o++)a[h]=r,a[h+1]=n,r+=l,h+=2;for(r=.5,n=0,o=0;o<t;o++)a[h]=r,a[h+1]=n,n+=l,h+=2}var u=this.renderContext.gl,c=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,c),u.bufferData(u.ARRAY_BUFFER,a,u.STATIC_DRAW),this.tcoordBuffer=c},s.prototype.setFreeze=function(t){this.freeze=t},s.prototype.getFreeze=function(){return this.freeze},s}),r("Renderer/Frustum",["./glMatrix"],function(){var t=function(){this.normal=vec3.create([0,0,0]),this.d=0};t.prototype.init=function(t,e,i){var r=[],n=[];vec3.subtract(e,t,r),vec3.subtract(i,t,n),vec3.cross(r,n,this.normal),vec3.normalize(this.normal),this.d=-vec3.dot(t,this.normal)},t.prototype.transform=function(t){var e=[this.normal[0],this.normal[1],this.normal[2],this.d];mat4.multiplyVec4(t,e),this.normal[0]=e[0],this.normal[1]=e[1],this.normal[2]=e[2],this.d=e[3]},t.prototype.intersectSphere=function(t,e){var i=vec3.dot(t,this.normal)+this.d;return i>e?1:i<-e?-1:0},t.prototype.distance=function(t){return t[0]*this.normal[0]+t[1]*this.normal[1]+t[2]*this.normal[2]+this.d},t.prototype.intersectBoundingBox=function(t){var e=(this.normal[0]>=0?1:0)|(this.normal[1]>=0?2:0)|(this.normal[2]>=0?4:0),i=7&~e;return this.distance(t.getCorner(i))>0?1:this.distance(t.getCorner(e))<0?-1:0};var e=function(){this.planes=[new t,new t,new t,new t,new t]};return e.prototype.compute=function(t){var e=mat4.create();mat4.inverse(t,e);var i=mat4.project(e,[-1,-1,-1,1]),r=mat4.project(e,[-1,1,-1,1]),n=mat4.project(e,[1,1,-1,1]),o=mat4.project(e,[1,-1,-1,1]);this.planes[0].init([0,0,0],i,r),this.planes[1].init([0,0,0],r,n),this.planes[2].init([0,0,0],n,o),this.planes[3].init([0,0,0],o,i),this.planes[4].init(i,r,n)},e.prototype.transform=function(t,e){var i=mat4.create();mat4.inverse(e,i),this.inverseTransform(t,i)},e.prototype.inverseTransform=function(t,e){for(var i=0;i<t.planes.length;i++){var r=t.planes[i],n=r.normal[0],o=r.normal[1],s=r.normal[2],a=r.d;r=this.planes[i],r.normal[0]=e[0]*n+e[1]*o+e[2]*s+e[3]*a,r.normal[1]=e[4]*n+e[5]*o+e[6]*s+e[7]*a,r.normal[2]=e[8]*n+e[9]*o+e[10]*s+e[11]*a,r.d=e[12]*n+e[13]*o+e[14]*s+e[15]*a}},e.prototype.containsSphere=function(t,e){for(var i=1,r=0;r<this.planes.length;r++){var n=this.planes[r].normal,o=t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+this.planes[r].d;if(o<=e){if(o<-e)return-1;i=0}}return i},e.prototype.containsBoundingBox=function(t){for(var e=0;e<this.planes.length;e++){var i=this.planes[e],r=i.normal[0]>=0?t.max[0]:t.min[0],n=i.normal[1]>=0?t.max[1]:t.min[1],o=i.normal[2]>=0?t.max[2]:t.min[2],s=r*i.normal[0]+n*i.normal[1]+o*i.normal[2]+i.d;if(s<0)return!1}return!0},e.Plane=t,e}),r("Renderer/RenderContext",["./Frustum","./glMatrix"],function(t){var e=function(i){this.activeAnimations=[],this.shadersPath=i.shadersPath||"../shaders/",this.tileErrorTreshold=i.tileErrorTreshold||4,this.lighting=i.lighting||!1,this.continuousRendering=i.continuousRendering||!1,this.stats=null,this.isActive=!0;var r=null;if(!i.canvas)throw"Mizar : no canvas in options";if(r="string"==typeof i.canvas?$(i.canvas):i.canvas,!(r instanceof HTMLCanvasElement))throw"Mizar : invalid canvas";for(var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],o=null,s=0;s<n.length&&null===o;++s)try{o=r.getContext(n[s],e.contextAttributes)}catch(t){}if(null===o)throw"Mizar : WebGL context cannot be initialized";if(i.backgroundColor){var a=i.backgroundColor;o.clearColor(a[0],a[1],a[2],a[3])}else o.clearColor(0,0,0,1);o.getExtension("OES_element_index_uint"),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,o.NONE),o.enable(o.DEPTH_TEST),o.enable(o.CULL_FACE),this.viewMatrix=mat4.create(),this.modelViewMatrix=mat4.create(),this.projectionMatrix=mat4.create(),this.gl=o,this.canvas=r,this.frustum=new t,this.worldFrustum=new t,this.localFrustum=new t,this.eyePosition=vec3.create(),this.eyeDirection=vec3.create(),this.minNear=1e-4,this.minFar=i.minFar||0,this.near=e.minNear,this.far=6,this.numActiveAttribArray=0,this.frameRequested=!1,this.fov=45,this.renderers=[],window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}());var l=this;this.frameCallback=function(){l.frame()}};return e.contextAttributes={},e.prototype.requestFrame=function(){this.frameRequested||(window.requestAnimationFrame(this.frameCallback),this.frameRequested=!0)},e.prototype.deactivate=function(){this.isActive=!1,this.frameRequested=!1},e.prototype.activate=function(){this.isActive=!0},e.prototype.frame=function(){if(this.isActive){this.frameRequested=!1;var t,i=(this.stats,this.gl);if(this.stats&&this.stats.start("globalRenderTime"),this.activeAnimations.length>0){var r=Date.now();for(t=0;t<this.activeAnimations.length;t++)this.activeAnimations[t].update(r)}if(e.contextAttributes.stencil?i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT):i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),0===this.canvas.width||0===this.canvas.height)return;for(i.viewport(0,0,this.canvas.width,this.canvas.height),this.updateViewDependentProperties(),t=0;t<this.renderers.length;t++)this.renderers[t].render();this.stats&&this.stats.end("globalRenderTime"),this.continuousRendering?this.requestFrame():this.activeAnimations.length>0&&this.requestFrame()}},e.prototype.updateViewDependentProperties=function(){var t=mat4.create();mat4.inverse(this.viewMatrix,t),vec3.set([0,0,0],this.eyePosition),mat4.multiplyVec3(t,this.eyePosition),vec3.set([0,0,-1],this.eyeDirection),mat4.rotateVec3(t,this.eyeDirection),mat4.perspective(this.fov,this.canvas.width/this.canvas.height,this.minNear,this.far,this.projectionMatrix),this.frustum.compute(this.projectionMatrix),this.worldFrustum.inverseTransform(this.frustum,this.viewMatrix),this.pixelSizeVector=this.computePixelSizeVector()},e.prototype.getXYRelativeToCanvas=function(t){var e=[];t.pageX||t.pageY?(e[0]=t.pageX,e[1]=t.pageY):(e[0]=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e[1]=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);for(var i=this.canvas;i;)e[0]-=i.offsetLeft,e[1]-=i.offsetTop,i=i.offsetParent;return e},e.prototype.computePixelSizeVector=function(t){var e=this.canvas.width,i=this.canvas.height,r=this.projectionMatrix,n=t||this.viewMatrix,o=r[0]*e*.5,s=r[8]*e*.5+r[11]*e*.5,a=[n[0]*o+n[2]*s,n[4]*o+n[6]*s,n[8]*o+n[10]*s],l=r[5]*i*.5,h=r[9]*i*.5+r[11]*i*.5,u=[n[1]*l+n[2]*h,n[5]*l+n[6]*h,n[9]*l+n[10]*h],c=r[11],d=r[15],p=[n[2]*c,n[6]*c,n[10]*c,n[14]*c+n[15]*d],f=.7071067811/Math.sqrt(vec3.dot(a,a)+vec3.dot(u,u));return p[0]*=f,p[1]*=f,p[2]*=f,p[3]*=f,p},e.prototype.getPixelFrom3D=function(t,e,i){var r=mat4.create();mat4.multiply(this.projectionMatrix,this.viewMatrix,r);var n=[t,e,i,1];mat4.project(r,n);var o=Math.round(.5*(1+n[0])*this.canvas.width),s=Math.round(.5*(1-n[1])*this.canvas.height);return[o,s]},e.prototype.createNonPowerOfTwoTextureFromImage=function(t,e){var i=this.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),r},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getFov=function(){return this.fov},e.prototype.setFov=function(t){this.fov=t},e.prototype.getWorldFrustum=function(){return this.worldFrustum},e.prototype.getViewMatrix=function(){return this.viewMatrix},e.prototype.setViewMatrix=function(t){this.viewMatrix=t},e}),r("Globe/AbstractGlobe",["../Utils/Event","../Utils/Utils","../Tiling/TileManager","../Renderer/VectorRendererManager","../Renderer/Ray","../Renderer/GeoBound","../Crs/CoordinateSystemFactory","../Renderer/RenderContext","../Renderer/glMatrix"],function(t,e,i,r,n,o,s,a){
var l=function(t){if(!t.coordinateSystem)throw new ReferenceError("coordinateSystem is not defined in "+JSON.stringify(t),"AbstractGLobe.js");this.coordinateSystem=s.create(t.coordinateSystem),t.renderContext?this.renderContext=t.renderContext:this.renderContext=new a(t),this.publishEvent=t.publishEvent,this.isEnable=!0,this.sky=!0,this.continuousRendering=t.continuousRendering||!1,this.tileManager=new i(this,t),this.vectorRendererManager=new r(this),this.attributionHandler=null,this.baseImagery=null,this.preRenderers=[],this.nbCreatedLayers=0,this.tileManager.addPostRenderer(this.vectorRendererManager),this.renderContext.renderers.push(this),this.renderContext.requestFrame()};return l.prototype.isSky=function(){return this.sky},l.prototype.dispose=function(){this.tileManager.tilePool.disposeAll(),this.tileManager.reset()},l.prototype.destroy=function(){this.dispose(),this.tileManager.removePostRenderer(this.vectorRendererManager),this.renderContext.renderers.splice(this.renderContext.renderers.indexOf(this.globe),1)},l.prototype.refresh=function(){this.renderContext.requestFrame()},l.prototype.setBaseImagery=function(t){throw"setBaseImagery Not implemented"},l.prototype.getBaseImagery=function(){return this.baseImagery},l.prototype.setBaseElevation=function(t){throw"setBaseElevation Not implemented"},l.prototype.getBaseElevation=function(){return this.tileManager.elevationProvider},l.prototype.addLayer=function(t){var e=this;t.url?$.ajax({url:t.url,success:function(i){t.addFeatureCollection(i),t.id=e.nbCreatedLayers,t._attach(e),e.renderContext.requestFrame(),e.nbCreatedLayers++,t.callback&&t.callback(i)}}):(t.id=this.nbCreatedLayers,t._attach(e),this.renderContext.requestFrame(),this.nbCreatedLayers++),this.publishEvent("layer:add",t)},l.prototype.removeLayer=function(t){t.setVisible(!1),t._detach(),this.renderContext.requestFrame(),this.publishEvent("layer:remove",t)},l.prototype.addAnimation=function(t){t.renderContext=this.renderContext},l.prototype.removeAnimation=function(t){t.renderContext=null},l.prototype.getElevation=function(t,e){throw"getElevation Not implemented"},l.prototype.getViewportGeoBound=function(t){var e=this.renderContext,i=mat4.create();mat4.inverse(e.viewMatrix,i);var r=[i[12],i[13],i[14]];mat4.multiply(e.projectionMatrix,e.viewMatrix,i),mat4.inverse(i);for(var s=[[-1,-1,1,1],[1,-1,1,1],[-1,1,1,1],[1,1,1,1]],a=[0,0,0],l=0;l<4;l++){mat4.multiplyVec4(i,s[l]),vec3.scale(s[l],1/s[l][3]),vec3.subtract(s[l],r,s[l]),vec3.normalize(s[l]);var h=new n(r,s[l]),u=h.sphereIntersect(a,this.coordinateSystem.getGeoide().getRadius());if(u<0)return null;var c=h.computePoint(u);s[l]=this.coordinateSystem.from3DToGeo(c),t&&(s[l]=t(s[l]))}var d=new o;return d.computeFromCoordinates(s),d},l.prototype.getLonLatFromPixel=function(t,e){var i,r=n.createFromPixel(this.renderContext,t,e);if(i=this.coordinateSystem.isFlat()?r.planeIntersect([0,0,0],[0,0,1]):r.sphereIntersect([0,0,0],this.coordinateSystem.getGeoide().getRadius()),i>=0){var o=this.coordinateSystem.getWorldFrom3D(r.computePoint(i)),s=this.coordinateSystem.getGeoBound();return!o||o[0]<s[0]||o[0]>s[2]||o[1]<s[1]||o[1]>s[3]||isNaN(o[0])||isNaN(o[1])?null:o}return null},l.prototype.getPixelFromLonLat=function(t,e){var i=vec3.create();return this.coordinateSystem.get3DFromWorld([t,e],i),this.renderContext.getPixelFrom3D(i[0],i[1],i[2])},l.prototype.render=function(){throw"render Not implemented"},l.prototype.setCoordinateSystem=function(t){this.coordinateSystem=t,this.tileManager.tileConfig.coordinateSystem=t,this.dispose(),this.tileManager.level0Tiles=this.tileManager.tiling.generateLevelZeroTiles(this.tileManager.tileConfig,this.tileManager.tilePool)},l.prototype.getCoordinateSystem=function(){return this.coordinateSystem},l.prototype.getRenderStats=function(){return"# rendered tiles : "+this.tileManager.tilesToRender.length},l.prototype.getRenderContext=function(){return this.renderContext},l.prototype.setRenderContext=function(t){this.renderContext=t},l.prototype.getTileManager=function(){return this.tileManager},l.prototype.isEnabled=function(){return this.isEnable},l.prototype.enable=function(){this.isEnable=!0},l.prototype.disable=function(){this.isEnable=!1},l}),r("Globe/Planet",["../Tiling/Tile","../Utils/Event","../Utils/Utils","./AbstractGlobe"],function(t,e,i,r){var n=function(t){r.prototype.constructor.call(this,t),this.sky=!1};return i.inherits(r,n),n.prototype.setBaseImagery=function(t){this.baseImagery!==t&&(this.baseImagery&&(this.removeLayer(this.baseImagery),this.baseImagery=null),t&&(t._overlay=!1,this.addLayer(t),this.baseImagery=t,t.setVisible(!0)),this.tileManager.setImageryProvider(t))},n.prototype.setBaseElevation=function(t){this.tileManager.elevationProvider&&this.removeLayer(this.tileManager.elevationProvider),this.tileManager.setElevationProvider(t),t&&(t._overlay=!1,this.addLayer(t))},n.prototype.getElevation=function(e,i){var r=this.tileManager.tiling;this.baseImagery&&(r=this.baseImagery.tiling);var n=this.tileManager.level0Tiles[r.lonlat2LevelZeroIndex(e,i)];return t.State&&n&&n.state===t.State.LOADED?n.getElevation(e,i):0},n.prototype.render=function(){if(this.isEnabled()){if(!this.coordinateSystem.isFlat())for(var t=0;t<this.preRenderers.length;t++)this.preRenderers[t].preRender();this.tileManager.render()}},n}),r("Globe/Sky",["../Tiling/TileManager","../Tiling/TilePool","../Utils/Utils","./AbstractGlobe","../Utils/Constants"],function(t,e,i,r,n){var o=function(i){r.prototype.constructor.call(this,i),this.sky=!0,this.tilePool=new e(this.renderContext),this.tileManagers={Equatorial:this.tileManager,Galactic:new t(this,i)},this.renderContext.requestFrame()};return i.inherits(r,o),o.prototype.dispose=function(){for(var t in this.tileManagers)this.tileManagers[t].tilePool.disposeAll(),this.tileManagers[t].reset()},o.prototype.setBaseImagery=function(t){this.baseImagery!==t&&(this.baseImagery&&(this.removeLayer(this.baseImagery),this.tileManagers[this.baseImagery.tiling.coordinateSystem.getGeoideName()].setImageryProvider(null),this.baseImagery=null,t.background=!1),t&&(t._overlay=!1,t.background=!0,this.addLayer(t),this.tileManagers[t.tiling.coordinateSystem.getGeoideName()].setImageryProvider(t),this.baseImagery=t,t.setVisible(!0)))},o.prototype.render=function(){this.isEnabled()&&(this.tileManagers[n.CRS.Galactic].render(),this.tileManagers[n.CRS.Equatorial].render())},o}),r("Globe/GlobeFactory",["./Planet","./Sky","../Utils/Constants"],function(t,e,i){return{create:function(r,n){var o;switch(r){case i.GLOBE.Planet:o=new t(n);break;case i.GLOBE.Sky:o=new e(n);break;default:throw RangeError("The type "+r+" is not allowed, A valid type is included in the list GLOBE","GlobeFactory.js")}return o}}}),r("Navigation/GoogleMouseNavigationHandler",[],function(){var t=function(t){var e=null,i=-1,r=-1,n=-1,o=!1,s=!1,a=0,l=0,h=null,u=null,c=0,d=function(t){e.ctx.publish("startNavigation");var i,r,n;if(i="undefined"==typeof t.wheelDelta?t.detail:-t.wheelDelta/120,e.inertia||(n=e.ctx.getRenderContext().getXYRelativeToCanvas(t),r=e.ctx.getLonLatFromPixel(n[0],n[1])),e.zoom(i),e.stopAnimations(),e.inertia)e.inertia.launch("zoom",i<0?-1:1);else if(r){var o=e.ctx.getPixelFromLonLat(r[0],r[1]),s=n[0]-o[0],a=Math.round(e.ctx.getRenderContext().getCanvas().width/e.ctx.getRenderContext().getCanvas().height);a=a<1?1:a,s*=a;var l=n[1]-o[1];e.pan(s,l)}return t.preventDefault&&t.preventDefault(),t.returnValue=!1,e.ctx.publish("endNavigation"),e.ctx.getRenderContext().requestFrame(),!1},p=function(t){if(i=t.button,e.stopAnimations(),r=t.clientX,n=t.clientY,a=0,l=0,1===t.button)e.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABeUlEQVR42u2XS07DMBCGbaCCQstzy4YDcAGWCAE3YI3omsN0XcSaGxSEWHIBDsCGLY9SykM80m/CFLkhIBycVpVi6ZetUez/S2x5JtYMudkCYJQBbGJ+pBoIgMybQKUoijrW2hnGr+jNFyILQM+8jHkLc0Nv6OeIPflC+AJ8M++1rBA+AD+a/wfCB2Bczdtp5gmIqkK8hwSQt69gcNu3gJ6BRGyB7kG/QlAAOe3rSD5zFeO6cwj3ibVRC52hTmgA2YJJVUUgML5wAFbVXN78RRV0C+TZMVUZLWJ86QCsELsxn3v/oQp6CN02hZYwvnIAloldo2efhQqAAqAAGKl7IL4JpQDpWyA9F8iVHfwmjHMBZnd/yIbzJodcEGdDtInJ0S/1wA7DE5NDNozrATSLtjE7SKmI9hg20b3JoR74qogUYgvThnMIa8SOHfPgFVEaxAbmh5jvMj71Nc8CkISYRmvoHD36mmcFcCFKOhbDgf0XuHOH9mcUrHUBoVXvIfh2krcAAAAASUVORK5CYII=), auto";else{var s=e.ctx.getRenderContext().getXYRelativeToCanvas(t);h=e.ctx.getLonLatFromPixel(s[0],s[1]),0===t.button?e.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAZUlEQVR42sSTQQrAMAgEHcn/v7w9tYgNNsGW7kkI2TgbRZJ15NbU+waAAFV11MiXz0yq2sxMEiVCDDcHLeky8nQAUDJnM88IuyGOGf/n3wjcQ1zhf+xgxSS+PkXY7aQ9yvy+jccAMs9AI/bwo38AAAAASUVORK5CYII=), auto":e.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABeUlEQVR42u2XS07DMBCGbaCCQstzy4YDcAGWCAE3YI3omsN0XcSaGxSEWHIBDsCGLY9SykM80m/CFLkhIBycVpVi6ZetUez/S2x5JtYMudkCYJQBbGJ+pBoIgMybQKUoijrW2hnGr+jNFyILQM+8jHkLc0Nv6OeIPflC+AJ8M++1rBA+AD+a/wfCB2Bczdtp5gmIqkK8hwSQt69gcNu3gJ6BRGyB7kG/QlAAOe3rSD5zFeO6cwj3ibVRC52hTmgA2YJJVUUgML5wAFbVXN78RRV0C+TZMVUZLWJ86QCsELsxn3v/oQp6CN02hZYwvnIAloldo2efhQqAAqAAGKl7IL4JpQDpWyA9F8iVHfwmjHMBZnd/yIbzJodcEGdDtInJ0S/1wA7DE5NDNozrATSLtjE7SKmI9hg20b3JoR74qogUYgvThnMIa8SOHfPgFVEaxAbmh5jvMj71Nc8CkISYRmvoHD36mmcFcCFKOhbDgf0XuHOH9mcUrHUBoVXvIfh2krcAAAAASUVORK5CYII=), auto"}return o=!0,!1},f=function(t){return i=-1,!e.inertia||0===a&&0===l||(0===t.button?u?e.inertia.launch("rotate",u,0):e.inertia.launch("pan",a,l):1===t.button&&e.inertia.launch("rotate",-a,-l)),e.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAjElEQVR42pyRQRLAIAwCoePD8vT8jB7aONHRVuWagBuku2MmMxMAuDtnO2VmMDNJAgCQVOz0YSWbR4ZQnuWQC4cK2pLRSEoSJIHkp/nd0RFBnFMJUnkgiaAYGXrxmdeCfg2NmWxLXDWG2d15veUdhdRv7EO2A3YV+E3AKUVDsBKSXx+esEvC3dZ73QMAeuphLLn/cTIAAAAASUVORK5CYII=), auto",h=null,c=0,s&&e.ctx.publish("endNavigation"),o=!1,s=!1,!1},g=function(t){if(!(i<0)&&(a=t.clientX-r,l=t.clientY-n,0!==a||0!==l)){var d,p,f,g=!1;if(0===i)o&&(e.ctx.publish("startNavigation"),o=!1,s=!0),p=e.ctx.getRenderContext().getXYRelativeToCanvas(t),h&&(u=null,d=e.ctx.getLonLatFromPixel(p[0],p[1]),d&&(f=e.ctx.getPixelFromLonLat(h[0],h[1]),a=p[0]-f[0],l=p[1]-f[1],e.pan(a,l))),h&&d||(u=Math.abs(a)>Math.abs(l)?p[1]>e.ctx.getRenderContext().getCanvas().height/2?-a:a:p[0]>e.ctx.getRenderContext().getCanvas().width/2?l:-l,e.rotate(u,0),p=e.ctx.getRenderContext().getXYRelativeToCanvas(t),h=e.ctx.getLonLatFromPixel(p[0],p[1]),h&&(u=null)),e.ctx.getRenderContext().requestFrame(),g=!0;else if(1===i)e.rotate(-a,-l),e.ctx.getRenderContext().requestFrame(),g=!0;else{if(c++,c%3===0&&c>1){if(e.ctx.publish("startNavigation"),e.zoom(-l/10),l>0&&l>a&&h){p=[e.ctx.getRenderContext().getCanvas().clientLeft+e.ctx.getRenderContext().getCanvas().clientWidth/2,e.ctx.getRenderContext().getCanvas().clientTop+e.ctx.getRenderContext().getCanvas().clientHeight/2],f=e.ctx.getPixelFromLonLat(h[0],h[1]);var m=p[0]-f[0];m=10*m/100;var v=p[1]-f[1];v=10*v/100,e.pan(m,v)}e.stopAnimations(),e.ctx.publish("endNavigation"),e.ctx.getRenderContext().requestFrame()}g=!0}return r=t.clientX,n=t.clientY,g}},m=function(t){if(0===t.button){var i=e.ctx.getRenderContext().getXYRelativeToCanvas(t),r=e.ctx.getLonLatFromPixel(i[0],i[1]);r&&e.zoomTo(r)}},v=function(t){return t.preventDefault(),!1};this.install=function(t){e=t;var i=e.getRenderContext.getCanvas;i.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAjElEQVR42pyRQRLAIAwCoePD8vT8jB7aONHRVuWagBuku2MmMxMAuDtnO2VmMDNJAgCQVOz0YSWbR4ZQnuWQC4cK2pLRSEoSJIHkp/nd0RFBnFMJUnkgiaAYGXrxmdeCfg2NmWxLXDWG2d15veUdhdRv7EO2A3YV+E3AKUVDsBKSXx+esEvC3dZ73QMAeuphLLn/cTIAAAAASUVORK5CYII=), auto",i.addEventListener("mousedown",p),i.addEventListener("mouseup",f),i.addEventListener("mousemove",g),i.addEventListener("contextmenu",v),i.addEventListener("dblclick",m),i.addEventListener("DOMMouseScroll",d),i.addEventListener("mousewheel",d)},this.uninstall=function(){var t=e.getRenderContext().getCanvas();t.style.cursor="auto",t.removeEventListener("mousedown",p),t.removeEventListener("mouseup",f),t.removeEventListener("mousemove",g),t.removeEventListener("contextmenu",v),t.removeEventListener("dblclick",m),t.removeEventListener("DOMMouseScroll",d),t.removeEventListener("mousewheel",d)}};return t}),r("Navigation/KeyboardNavigationHandler",[],function(){var t=function(t){var e=null,i=this;this.panFactor=10,this.zoomFactor=1,t&&(t.panFactor&&"number"==typeof t.panFactor&&(this.panFactor=t.panFactor),t.zoomFactor&&"number"==typeof t.zoomFactor&&(this.zoomFactor=t.zoomFactor));var r=function(t){return this.focus(),!1},n=function(t){switch(t.keyCode){case 32:e.stopAnimations();break;case 187:case 61:case 107:e.zoom(-i.zoomFactor);break;case 189:case 54:case 109:e.zoom(i.zoomFactor);break;case 81:case 37:t.shiftKey?e.rotate(i.panFactor,0):e.pan(i.panFactor,0);break;case 90:case 38:t.shiftKey?e.rotate(0,i.panFactor):e.pan(0,i.panFactor);break;case 68:case 39:t.shiftKey?e.rotate(-i.panFactor,0):e.pan(-i.panFactor,0);break;case 83:case 40:t.shiftKey?e.rotate(0,-i.panFactor):e.pan(0,-i.panFactor)}};this.install=function(i){if(e=i,t&&t.installOnDocument)document.addEventListener("keydown",n);else{var o=e.renderContext.canvas;o.addEventListener("keydown",n),o.tabIndex="0",o.addEventListener("mousedown",r)}},this.uninstall=function(){if(t&&t.installOnDocument)document.removeEventListener("keydown",n);else{var i=e.renderContext.canvas;i.removeEventListener("keydown",n),i.removeEventListener("mousedown",r)}}};return t}),r("Navigation/MouseNavigationHandler",[],function(){var t=function(t){var e=null,i=-1,r=-1,n=-1,o=0,s=0,a=t&&t.panButton||0,l=t&&t.rotateButton||1,h=t&&t.zoomOptions?t.zoomOptions:{},u=function(t){var i;return i=void 0===t.wheelDelta?t.detail:-t.wheelDelta/120,e.zoom(i),e.stopAnimations(),e.inertia&&e.inertia.launch("zoom",i<0?-1:1),t.preventDefault&&t.preventDefault(),t.returnValue=!1,!1},c=function(t){return document.addEventListener("mouseup",d),i=t.button,e.stopAnimations(),t.button!==a&&t.button!==l||(r=t.clientX,n=t.clientY,o=0,s=0,!1)},d=function(t){return i=-1,document.removeEventListener("mouseup",d),!e.inertia||0===o&&0===s||(t.button===a&&e.inertia.launch("pan",o,s),t.button===l&&e.inertia.launch("rotate",o,s)),t.button!==a&&t.button!==l||(t.preventDefault(),!1)},p=function(t){if(!(i<0)&&(o=t.clientX-r,s=t.clientY-n,0!==o||0!==s)){var h=!1;return i===a?(e.pan(o,s),h=!0):i===l&&(e.rotate(o,s),h=!0),r=t.clientX,n=t.clientY,h}},f=function(t){if(0===t.button){console.log("navigation",e);var i,r;i=e.ctx.getRenderContext().getXYRelativeToCanvas(t),r=e.ctx.getLonLatFromPixel(i[0],i[1]),r&&e.zoomTo(r,h)}};this.install=function(i){e=i;var r=e.renderContext.canvas;r.addEventListener("mousedown",c),r.addEventListener("mousemove",p),t&&t.zoomOnDblClick&&r.addEventListener("dblclick",f),r.addEventListener("DOMMouseScroll",u),r.addEventListener("mousewheel",u),r.addEventListener("dragstart",function(t){return t.preventDefault(),!1}),2===l&&r.addEventListener("contextmenu",function(t){return t.preventDefault(),!1},!1)},this.uninstall=function(){var i=e.renderContext.canvas;i.removeEventListener("mousedown",c),i.removeEventListener("mousemove",p),t&&t.zoomOnDblClick&&i.removeEventListener("dblclick",f),i.removeEventListener("DOMMouseScroll",u),i.removeEventListener("mousewheel",u)}};return t}),r("Navigation/TouchNavigationHandler",[],function(){var t={PAN:0,ROTATE:1,TILT:2,ZOOM:3},e=function(e){var i,r,n,o,s,a,l,h=null,u=[],c=[0,0,0,0],d=300,p=!(!e||!e.hasOwnProperty("inversed"))&&e.inversed,f=function(t,e){var i=e.clientY-t.clientY,r=e.clientX-t.clientX;return 180*Math.atan2(i,r)/Math.PI},g=function(t,e){return t.length>=2&&e.length>=2?f(e[1],e[0])-f(t[1],t[0]):0},m=function(t){if(r=t.touches,u=t.touches,c=[0,0,0,0],h.stopAnimations(),o=0,s=0,2===t.touches.length){var e=t.touches[0].clientX-t.touches[1].clientX,a=t.touches[0].clientY-t.touches[1].clientY;i=Math.sqrt(e*e+a*a),console.log("Finger distance : "+i),n=g(u,t.touches)}return t.preventDefault&&t.preventDefault(),t.returnValue=!1,!1},v=function(e){o=e.touches[0].clientX-r[0].clientX,s=e.touches[0].clientY-r[0].clientY;var a,d,f,m,v;if(1===e.touches.length)h.pan(o,s),c[t.PAN]++;else{var y=(e.touches[0].clientY-r[0].clientY)*(e.touches[1].clientY-r[1].clientY)>0;y?(h.rotate(0,-s),c[t.TILT]++):(f=g(u,e.touches),a=f-n,n=f,p&&(a*=-1),l=10*a,h.rotate(l,0),c[t.ROTATE]++),a=e.touches[0].clientX-e.touches[1].clientX,d=e.touches[0].clientY-e.touches[1].clientY,m=Math.sqrt(a*a+d*d),v=m-i;var b;b=p?m/i:i/m,0!==i&&(h.zoom(.025*v,b),c[t.ZOOM]++),h.getRenderContext().requestFrame(),i=m}return r=e.touches,e.preventDefault&&e.preventDefault(),e.returnValue=!1,!1},y=function(i){if(e&&e.zoomOnDblClick&&0===i.touches.length&&0===o&&0===s){var n=Date.now();if(n-a<d){var l=h.ctx.getLonLatFromPixel(r[0].clientX,r[0].clientY);l&&h.zoomTo(l)}a=n}if(r=i.touches,h.inertia&&(0!==o||0!==s)){var u=c.indexOf(Math.max.apply(this,c));u===t.PAN?h.inertia.launch("pan",o,s):u===t.ROTATE?console.log("Rotate not implemented in navigation"):u===t.TILT&&console.log("Tilt not implemented in navigation")}return i.preventDefault&&i.preventDefault(),i.returnValue=!1,!1};this.install=function(t){h=t;var e=h.renderContext.canvas;e.addEventListener("touchstart",m,!1),e.addEventListener("touchend",y,!1),e.addEventListener("touchmove",v,!1)},this.uninstall=function(){var t=h.renderContext.canvas;t.removeEventListener("touchstart",m,!1),t.removeEventListener("touchend",y,!1),t.removeEventListener("touchmove",v,!1)}};return e}),r("Navigation/NavigationHandlerFactory",["../Utils/Constants","./GoogleMouseNavigationHandler","./KeyboardNavigationHandler","./MouseNavigationHandler","./TouchNavigationHandler"],function(t,e,i,r,n){return{create:function(o,s){var a;switch(o){case t.HANDLER.GoogleMouse:a=new e(s);break;case t.HANDLER.Keyboard:a=new i(s);break;case t.HANDLER.Mouse:a=new r(s);break;case t.HANDLER.Touch:a=new n(s);break;default:throw RangeError("The type "+o+" is not allowed, A valid type is included in the list Constants.HANDLER","NavigationHandlerFactory.js")}return a}}}),r("Animation/AbstractAnimation",[],function(){var t=function(){this.startTime=-1,this.pauseTime=-1,this.renderContext=null};return t.prototype.getRenderContext=function(){return this.renderContext},t.prototype._unregisterActive=function(){var t=this.renderContext.activeAnimations.indexOf(this);t>=0&&this.renderContext.activeAnimations.splice(t,1)},t.prototype.getStatus=function(){return this.startTime===-1?"STOPPED":this.pauseTime===-1?"RUNNING":"PAUSED"},t.prototype.start=function(){if(this.renderContext&&(this.startTime===-1||this.pauseTime!==-1)){var t=Date.now();this.startTime===-1?this.startTime=t:(this.startTime+=t-this.pauseTime,this.pauseTime=-1),this.renderContext.activeAnimations.push(this),this.renderContext.requestFrame()}},t.prototype.pause=function(){this.renderContext&&this.startTime!==-1&&this.pauseTime===-1&&(this.pauseTime=Date.now(),this._unregisterActive(this))},t.prototype.stop=function(){this.startTime=-1,this.pauseTime=-1,this.onstop&&this.onstop(),this._unregisterActive(this)},t}),r("Animation/SegmentedAnimation",["../Utils/Utils","./AbstractAnimation","../Utils/Numeric"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this),this.segments=[],this.duration=t.duration,this.valueSetter=t.valueSetter};t.inherits(e,r);var n=function(t,e,i,r,n){this.start=t,this.startValue=e,this.end=i,this.endValue=r,this.interpolator=n};return r.prototype.addSegment=function(t,e,i,r,o){for(var s=this.segments.length,a=0;a<s&&this.segments[a].end<=t;)a++;this.segments.splice(a,0,new n(t,e,i,r,o))},r.prototype.update=function(t){var e=i.map01(t,this.startTime,this.startTime+this.duration);if(e>=1){var r=this.segments.length-1;this.valueSetter(this.segments[r].endValue),this.stop()}else{for(var n=this.segments.length,o=0;o<n&&this.segments[o].end<e;)o++;o=Math.min(o,n-1),e=i.map01(e,this.segments[o].start,this.segments[o].end);var s=this.segments[o].interpolator(e,this.segments[o].startValue,this.segments[o].endValue);this.valueSetter(s)}},r}),r("Animation/PathAnimation",["../Utils/Utils","./AbstractAnimation","../Utils/Numeric","../Renderer/glMatrix"],function(t,e,i){var r=function(t){var i,r,n,o,s,a,l,h;for(e.prototype.constructor.call(this),this.globe=t.globe,this.speed=t.speed*this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3,this.nodes=[],i=0;i<t.coords.length;i++)l={position:this.globe.getCoordinateSystem().get3DFromWorld(t.coords[i]),velocity:null,distance:0},this.nodes.push(l),i>0&&(o=this.nodes[i].position[0]-this.nodes[i-1].position[0],s=this.nodes[i].position[1]-this.nodes[i-1].position[1],a=this.nodes[i].position[2]-this.nodes[i-1].position[2],this.nodes[i-1].distance=Math.sqrt(o*o+s*s+a*a));for(i=1;i<t.coords.length-1;i++)r=vec3.subtract(this.nodes[i+1].position,this.nodes[i].position,vec3.create()),n=vec3.subtract(this.nodes[i-1].position,this.nodes[i].position,vec3.create()),vec3.normalize(r),vec3.normalize(n),this.nodes[i].velocity=vec3.subtract(r,n,vec3.create()),
vec3.normalize(this.nodes[i].velocity);h=vec3.subtract(this.nodes[1].position,this.nodes[0].position,vec3.create()),vec3.scale(h,3/this.nodes[0].distance),this.nodes[0].velocity=vec3.subtract(h,this.nodes[1].velocity,vec3.create()),vec3.scale(this.nodes[0].velocity,.5),i=t.coords.length-1,h=vec3.subtract(this.nodes[i].position,this.nodes[i-1].position,vec3.create()),vec3.scale(h,3/this.nodes[i-1].distance),this.nodes[i].velocity=vec3.subtract(h,this.nodes[i-1].velocity,vec3.create()),vec3.scale(this.nodes[i].velocity,.5),this.index=0,this.currentDistance=0,this.previousTime=-1,this.centerOffset=-.2,this.altitudeOffset=1e3;var u=this;t.setter?this.valueSetter=t.setter:this.valueSetter=function(e,i){var r,n=vec3.normalize(e,vec3.create());if(t.globe){var o=t.globe.getCoordinateSystem().getWorldFrom3D(e);o[2]=t.globe.getElevation(o[0],o[1])+u.altitudeOffset,r=t.globe.getCoordinateSystem().get3DFromWorld(o)}else r=e,r[2]+=u.altitudeOffset;var s=vec3.normalize(i,vec3.create()),a=vec3.add(r,s,vec3.create());vec3.add(a,vec3.scale(n,u.centerOffset,vec3.create())),mat4.lookAt(r,a,n,u.renderContext.getViewMatrix())}};return t.inherits(e,r),r.prototype.setSpeed=function(t){this.speed=parseFloat(t)*this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3},r.prototype.getSpeed=function(){return this.speed/(this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3)},r.prototype.setAltitudeOffset=function(t){this.altitudeOffset=parseFloat(t)},r.prototype.getAltitudeOffset=function(){return this.altitudeOffset},r.prototype.setDirectionAngle=function(t){this.centerOffset=Math.tan(parseFloat(t)*Math.PI/180)},r.prototype.start=function(){var t=-1;this.pauseTime!==-1&&(t=this.startTime),Animation.prototype.start.call(this),t!==-1?this.previousTime+=this.startTime-t:this.previousTime=-1},r.prototype.update=function(t){for(this.previousTime===-1?(this.index=0,this.currentDistance=0):this.currentDistance+=(t-this.previousTime)*this.speed,this.previousTime=t;this.currentDistance>=this.nodes[this.index].distance&&this.index<this.nodes.length-1;)this.currentDistance-=this.nodes[this.index].distance,this.index=this.index+1;if(this.index<this.nodes.length-1){var e=this.currentDistance/this.nodes[this.index].distance,r=this.nodes[this.index].position,n=this.nodes[this.index+1].position,o=vec3.scale(this.nodes[this.index].velocity,this.nodes[this.index].distance,vec3.create()),s=vec3.scale(this.nodes[this.index+1].velocity,this.nodes[this.index].distance,vec3.create()),a=i.cubicInterpolation(e,r,o,n,s),l=i.cubicInterpolationDerivative(e,r,o,n,s);this.valueSetter(a,l)}else this.index===this.nodes.length-1?this.valueSetter(this.nodes[this.index].position,this.nodes[this.index].velocity):this.stop()},r}),r("Animation/InertiaAnimation",["../Utils/Utils","./AbstractAnimation"],function(t,e){var i=.1,r=function(t){e.prototype.constructor.call(this),t&&(this.panFactor=t.hasOwnProperty("panFactor")?t.panFactor:.95,this.rotateFactor=t.hasOwnProperty("rotateFactor")?t.rotateFactor:.95,this.zoomFactor=t.hasOwnProperty("zoomFactor")?t.zoomFactor:.5),this.type=null,this.dx=0,this.dy=0,this.navigation=t.nav,this.renderContext=t.nav.getRenderContext()};return t.inherits(e,r),r.prototype.update=function(t){var e=!1;switch(this.type){case"pan":this.navigation.pan(this.dx,this.dy),this.dx*=this.panFactor,this.dy*=this.panFactor,e=Math.abs(this.dx)<i&&Math.abs(this.dy)<i;break;case"rotate":this.navigation.rotate(this.dx,this.dy),this.dx*=this.rotateFactor,this.dy*=this.rotateFactor,e=Math.abs(this.dx)<i&&Math.abs(this.dy)<i;break;case"zoom":this.navigation.zoom(this.dx),this.dx*=this.zoomFactor,e=Math.abs(this.dx)<i}this.navigation.getRenderContext().requestFrame(),e&&this.stop()},r.prototype.launch=function(t,e,i){this.type=t,this.dx=e,this.dy=i,this.start()},r}),r("Animation/InterpolatedAnimation",["../Utils/Utils","./AbstractAnimation"],function(t,e){var i=function(t){e.prototype.constructor.call(this),this.values=[[0,t.startValue],[1,t.endValue]],this.duration=t.duration,this.interpolationFunction=t.interpolationFunction,this.setFunction=t.setFunction};return t.inherits(e,i),i.prototype.addValue=function(t,e){for(var i=this.values.length,r=0;r<i&&this.values[r][0]<t;)r++;this.values.splice(r,0,[t,e])},i.prototype.start=function(){Animation.prototype.start.call(this),this.setFunction(this.startValue)},i.prototype.stop=function(){Animation.prototype.stop.call(this),this.setFunction(this.endValue)},i.prototype.update=function(t){var e=Numeric.map01(t,this.startTime,this.startTime+this.duration);if(e>=1)return void this.stop();for(var i=this.values.length,r=0;r<i&&this.values[r][0]<e;)r++;r=Math.min(r,i-1);var n=Math.max(0,r-1);e=Numeric.map01(e,this.values[n][0],this.values[r][0]);var o=this.interpolationFunction(e,this.values[n][1],this.values[r][1]);this.setFunction(o)},i}),r("Animation/AnimationFactory",["../Utils/Constants","./SegmentedAnimation","./PathAnimation","./InertiaAnimation","./InterpolatedAnimation"],function(t,e,i,r,n){return{create:function(o,s){var a;switch(o){case t.ANIMATION.Inertia:a=new r(s);break;case t.ANIMATION.Interpolated:a=new n(s);break;case t.ANIMATION.Path:a=new i(s);break;case t.ANIMATION.Segmented:a=new e(s);break;default:throw RangeError("The type "+o+" is not allowed, A valid type is included in the list Constants.ANIMATION","AnimationFactory.js")}return a}}}),r("Navigation/AbstractNavigation",["../Utils/Utils","../Utils/Event","../Navigation/NavigationHandlerFactory","../Animation/AnimationFactory","../Utils/Numeric","../Utils/Constants","../Renderer/glMatrix"],function(t,e,i,r,n,o){var s=function(t,n,s){if(e.prototype.constructor.call(this),this.type=t,this.ctx=n,this.renderContext=this.ctx.globe.getRenderContext(),this.options=s||{},s&&s.handlers?this.handlers=s.handlers:(this.handlers=[i.create(o.HANDLER.Mouse,s?s.mouse:null),i.create(o.HANDLER.Keyboard,s?s.keyboard:null)],s&&s.isMobile&&this.handlers.push(i.create(o.HANDLER.Touch,s?s.touch:null))),s&&s.inertia){var a=s.inertiaAnimation||{};a.nav=this,this.inertia=r.create(o.ANIMATION.Inertia,a)}this.zoomToAnimation=null,this.start()};return t.inherits(e,s),s.prototype.getType=function(){return this.type},s.prototype.getOptions=function(){return this.options},s.prototype.start=function(){for(var t=0;t<this.handlers.length;t++)this.handlers[t].install(this)},s.prototype.stop=function(){for(var t=0;t<this.handlers.length;t++)this.handlers[t].uninstall()},s.prototype.stopAnimations=function(){this.inertia&&this.inertia.stop(),this.zoomToAnimation&&(this.zoomToAnimation.stop(),this.zoomToAnimation=null)},s.prototype.getFov=function(){var t=this.renderContext.getCanvas().width/this.renderContext.getCanvas().height;return[t*this.renderContext.getFov(),this.renderContext.getFov()]},s.prototype.moveUpTo=function(t,e){throw"moveUpTo not implemented"},s.prototype.getCenter=function(){return this.ctx.globe.getLonLatFromPixel(.5*this.renderContext.getCanvas().width,.5*this.renderContext.getCanvas().height)},s.prototype.rotate=function(t,e){throw"rotate is not implemented"},s.prototype.pan=function(t,e){throw"pan is not implemented"},s.prototype.zoom=function(t,e){throw"zoom is not implemented"},s.prototype.zoomTo=function(t,e){throw"zoomTo is not implemented"},s.prototype.computeViewMatrix=function(){throw"computeViewMatrix not implemented"},s.prototype.toViewMatrix=function(t,e,i,s){var a=this,l=this.renderContext.getViewMatrix(),h=mat4.toMat3(l),u=quat4.fromRotationMatrix(h),c=mat4.toMat3(t),d=quat4.fromRotationMatrix(c),p=e||45;i=i||1e3;var f=[u,[l[12],l[13],l[14]],a.getRenderContext().getFov()],g=[d,[t[12],t[13],t[14]],p],m=r.create(o.ANIMATION.Segmented,{duration:i,valueSetter:function(t){var e=quat4.toMat4(t[0]),i=mat4.transpose(e);i[12]=t[1][0],i[13]=t[1][1],i[14]=t[1][2],a.renderContext.setViewMatrix(i),a.renderContext.setFov(t[2]),a.renderContext.requestFrame()}});m.addSegment(0,f,1,g,function(t,e,i){var r=n.easeOutQuad(t),o=quat4.create();quat4.slerp(e[0],i[0],r,o);var s=vec3.create();vec3.lerp(e[1],i[1],r,s);var a=n.lerp(r,e[2],i[2]);return[o,s,a]}),m.onstop=function(){s&&s()},this.ctx.globe.addAnimation(m),m.start()},s.prototype.getRenderContext=function(){return this.renderContext},s.prototype.setRenderContext=function(t){this.renderContext=t},s}),r("Navigation/PlanetNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/glMatrix"],function(t,e,i,r,n){const o=1e3;var s=function(t,r){i.prototype.constructor.call(this,e.NAVIGATION.PlanetNavigation,t,r),this.minDistance=r&&r.minDistance||0,this.maxDistance=r&&r.maxDistance||3*this.ctx.getCoordinateSystem().getGeoide().getRadius()/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.minDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.maxDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.geoCenter=[0,0,0],this.heading=0,this.tilt=90,this.distance=this.maxDistance,this.inverseViewMatrix=mat4.create();var n=!r||!r.hasOwnProperty("updateViewMatrix")||r.updateViewMatrix;r&&r.initTarget&&(this.geoCenter[0]=r.initTarget[0],this.geoCenter[1]=r.initTarget[1],this.distance=3===r.initTarget.length?r.initTarget[2]*this.ctx.getCoordinateSystem().getGeoide().getHeightScale():this.distance,this.distance<this.minDistance&&(this.minDistance=this.distance),this.distance>this.maxDistance&&(this.maxDistance=this.distance)),n&&this.computeViewMatrix()};return t.inherits(i,s),s.prototype.save=function(){return{geoCenter:this.geoCenter,heading:this.heading,tilt:this.tilt,distance:this.distance}},s.prototype.restore=function(t){this.geoCenter=t.geoCenter,this.heading=t.heading,this.tilt=t.tilt,this.distance=t.distance,this.computeViewMatrix()},s.prototype.zoomTo=function(t,i){var o=this,s=i&&i.distance?i.distance:this.distance/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),a=i&&i.duration?i.duration:5e3,l=i&&i.tilt?i.tilt:90,h=[this.geoCenter[0],this.geoCenter[1],this.distance,this.tilt],u=[t[0],t[1],s*this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),l];this.zoomToAnimation=new r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){o.geoCenter[0]=t[0],o.geoCenter[1]=t[1],o.distance=t[2],o.tilt=t[3],o.computeViewMatrix()}});var c=this.ctx.getCoordinateSystem().get3DFromWorld(this.geoCenter),d=this.ctx.getCoordinateSystem().get3DFromWorld(t),p=vec3.subtract(c,d),f=vec3.length(p),g=this.ctx.getRenderContext().canvas,m=Math.min(n.toRadian(45),n.toRadian(45*g.width/g.height)),v=1.1*(f/2/Math.tan(m/2));if(v>this.distance){var y=[.5*h[0]+.5*u[0],.5*h[1]+.5*u[1],v,l];this.zoomToAnimation.addSegment(0,h,.5,y,function(t,e,i){var r=n.easeInQuad(t),o=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2]),n.lerp(t,e[3],i[3])]}),this.zoomToAnimation.addSegment(.5,y,1,u,function(t,e,i){var r=n.easeOutQuad(t),o=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2]),n.lerp(t,e[3],i[3])]})}else this.zoomToAnimation.addSegment(0,h,1,u,function(t,e,i){var r=n.easeOutQuad(t),o=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2]),n.lerp(t,e[3],i[3])]});var b=this;this.zoomToAnimation.onstop=function(){i&&i.callback&&i.callback(),b.zoomToAnimation=null},this.ctx.addAnimation(this.zoomToAnimation),this.zoomToAnimation.start()},s.prototype.applyLocalRotation=function(t){mat4.rotate(t,this.heading*Math.PI/180,[0,0,1]),mat4.rotate(t,(90-this.tilt)*Math.PI/180,[1,0,0])},s.prototype.computeViewMatrix=function(){this.computeInverseViewMatrix(),mat4.inverse(this.inverseViewMatrix,this.renderContext.viewMatrix),this.ctx.publish("modifiedNavigation"),this.renderContext.requestFrame()},s.prototype.computeInverseViewMatrix=function(){this.ctx.getCoordinateSystem().getLHVTransform(this.geoCenter,this.inverseViewMatrix),this.applyLocalRotation(this.inverseViewMatrix),mat4.translate(this.inverseViewMatrix,[0,0,this.distance])},s.prototype.zoom=function(t,e){var i=this.distance;e?this.distance*=e:this.distance*=1+.1*t,this.distance>this.maxDistance&&(this.distance=this.maxDistance),this.distance<this.minDistance&&(this.distance=this.minDistance),this.computeViewMatrix(),this.hasCollision()&&(this.distance=i,this.computeViewMatrix())},s.prototype.hasCollision=function(){var t=[this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]],e=vec3.create();this.ctx.getCoordinateSystem().getWorldFrom3D(t,e);var i=this.ctx.getElevation(e[0],e[1]);return e[2]<i+o},s.prototype.pan=function(t,e){var i=vec3.create();vec3.set(this.geoCenter,i);var r=mat4.create(),n=this.ctx.getCoordinateSystem();n.getLocalTransform(this.geoCenter,r);var o=vec3.create(),s=vec3.create([0,1,0]);n.getUpVector(r,o),mat4.multiplyVec3(r,s,s),this.applyLocalRotation(r);var a=vec3.create(),l=vec3.create();n.getSideVector(r,a),n.getFrontVector(r,l),vec3.cross(o,a,l),vec3.cross(l,o,a),vec3.normalize(a,a),vec3.normalize(l,l),t/=this.renderContext.getCanvas().width,e/=this.renderContext.getCanvas().height;var h=vec3.create();n.get3DFromWorld(this.geoCenter,h),vec3.scale(a,t*this.distance,a),vec3.scale(l,e*this.distance,l),vec3.subtract(h,a,h),vec3.add(h,l,h),vec3.normalize(h),vec3.scale(h,n.getGeoide().getRadius()),n.getWorldFrom3D(h,this.geoCenter);var u=vec3.create([0,1,0]);n.getLocalTransform(this.geoCenter,r),mat4.multiplyVec3(r,u,u),vec3.dot(s,u)<0&&(this.heading=(this.heading+180)%360),this.computeViewMatrix(),this.hasCollision()&&(this.geoCenter=i,this.computeViewMatrix())},s.prototype.rotate=function(t,e){var i=this.heading,r=this.tilt;this.heading+=.1*t,this.tilt+=.1*e,this.computeViewMatrix(),this.hasCollision()&&(this.heading=i,this.tilt=r,this.computeViewMatrix())},s.prototype.getDistance=function(){return this.distance*this.ctx.getCoordinateSystem().getGeoide().getRealPlanetRadius()},s}),r("Navigation/AstroNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(t,e,i,r,n,o){var s=function(t,r){i.prototype.constructor.call(this,e.NAVIGATION.AstroNavigation,t,r),this.minFov=r&&r.minFov||.001,this.maxFov=r&&r.maxFov||100,this.center3d=[1,0,0],this.up=[0,0,1],r&&(r.initTarget&&this.ctx.getCoordinateSystem().get3DFromWorld(r.initTarget,this.center3d),r.initFov&&(this.minFov>r.initFov?this.minFov=r.initFov:this.maxFov<r.initFov&&(this.maxFov=r.initFov),this.renderContext.setFov(r.initFov),this._clampFov()),r.up&&(this.up=r.up)),this.computeViewMatrix()};return t.inherits(i,s),s.prototype.zoomTo=function(t,i){var o=this,s=i&&i.fov?i.fov:2,a=i&&i.duration?i.duration:2e3,l=[],h=25;this.ctx.getCoordinateSystem().getWorldFrom3D(this.center3d,l);var u=[l[0],l[1],this.renderContext.getFov()],c=[t[0],t[1],s];Math.abs(t[0]-l[0])>180&&(l[0]<t[0]?u[0]+=360:c[0]+=360);var d=r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){var e=o.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);o.center3d[0]=e[0],o.center3d[1]=e[1],o.center3d[2]=e[2],o.ctx.getRenderContext().setFov(t[2]),o.computeViewMatrix()}}),p=this.ctx.getCoordinateSystem().get3DFromWorld(t);if(h>this.renderContext.getFov()&&this.renderContext.getWorldFrustum().containsSphere(p,.005)<0){var f=[.5*u[0]+.5*c[0],.5*u[1]+.5*c[1],h];d.addSegment(0,u,.5,f,function(t,e,i){var r=n.easeInQuad(t),o=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2])]}),d.addSegment(.5,f,1,c,function(t,e,i){var r=n.easeOutQuad(t),o=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2])]})}else d.addSegment(0,u,1,c,function(t,e,i){var r=n.easeOutQuad(t),o=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2])]});d.onstop=function(){i&&i.callback&&i.callback(),o.zoomToAnimation=null},this.ctx.addAnimation(d),d.start(),this.zoomToAnimation=d},s.prototype.moveTo=function(t,i,o){var s=this,a=i||5e3,l=[];this.ctx.getCoordinateSystem().getWorldFrom3D(this.center3d,l);var h=[l[0],l[1]],u=[t[0],t[1]];Math.abs(t[0]-l[0])>180&&(l[0]<t[0]?h[0]+=360:u[0]+=360);var c=r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){var e=s.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);s.center3d[0]=e[0],s.center3d[1]=e[1],s.center3d[2]=e[2],s.computeViewMatrix()}});c.addSegment(0,h,1,u,function(t,e,i){var r=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1])]}),c.onstop=function(){o&&o()},this.ctx.addAnimation(c),c.start()},s.prototype.moveUpTo=function(t,i){var o=[],s=[];this.ctx.getCoordinateSystem().getWorldFrom3D(this.up,o),this.ctx.getCoordinateSystem().getWorldFrom3D(t,s);var a=i||1e3,l=this,h=r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){var e=l.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);l.up[0]=e[0],l.up[1]=e[1],l.up[2]=e[2],l.computeViewMatrix()}});h.addSegment(0,o,1,s,function(t,e,i){var r=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1])]}),this.ctx.addAnimation(h),h.start()},s.prototype.computeViewMatrix=function(){vec3.normalize(this.center3d);var t=this.renderContext.getViewMatrix();mat4.lookAt([0,0,0],this.center3d,this.up,t),this.up=[t[1],t[5],t[9]],this.ctx.publish("modifiedNavigation"),this.renderContext.requestFrame()},s.prototype.zoom=function(t,e){e?this.renderContext.setFov(1*this.renderContext.getFov()/e):this.renderContext.setFov(this.renderContext.getFov()*(1+.1*t)),this._clampFov(),this.computeViewMatrix()},s.prototype.pan=function(t,e){var i=this.renderContext.getCanvas().width/2,r=this.renderContext.getCanvas().height/2,n=o.createFromPixel(this.renderContext,i-t,r-e);this.center3d=n.computePoint(n.sphereIntersect([0,0,0],this.ctx.getCoordinateSystem().getGeoide().getRadius())),this.computeViewMatrix()},s.prototype.rotate=function(t,e){var i=.1*t*Math.PI/180,r=quat4.fromAngleAxis(i,this.center3d);quat4.multiplyVec3(r,this.up),this.computeViewMatrix()},s.prototype._clampFov=function(){this.renderContext.getFov()>this.maxFov&&this.renderContext.setFov(this.maxFov),this.renderContext.getFov()<this.minFov&&this.renderContext.setFov(this.minFov)},s}),r("Navigation/FlatNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(t,e,i,r,n,o){var s=function(t,r){if(i.prototype.constructor.call(this,e.NAVIGATION.FlatNavigation,t,r),this.minDistance=r&&r.minDistance||6e4,this.maxDistance=r&&r.maxDistance||5*this.ctx.getCoordinateSystem().getGeoide().getRadius()/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.minDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.maxDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.center=[0,0,0],this.distance=this.maxDistance,this.up=[0,1,0],r&&r.initTarget){var n=this.ctx.getCoordinateSystem().get3DFromWorld(r.initTarget);this.center[0]=n[0],this.center[1]=n[1],this.distance=3===r.initTarget.length?r.initTarget[2]*this.ctx.getCoordinateSystem().getGeoide().getHeightScale():this.distance,this.distance<this.minDistance&&(this.minDistance=this.distance),this.distance>this.maxDistance&&(this.maxDistance=this.distance)}this.computeViewMatrix()};return t.inherits(i,s),s.prototype.save=function(){return{center:this.center,distance:this.distance,up:this.up}},s.prototype.restore=function(t){this.center=t.center,this.distance=t.distance,this.up=t.up,this.computeViewMatrix()},s.prototype.computeViewMatrix=function(){var t=[],e=this.renderContext.getViewMatrix();t=[this.center[0],this.center[1],this.distance],mat4.lookAt(t,this.center,this.up,e),this.up=[e[1],e[5],e[9]],this.ctx.publish("modifiedNavigation"),this.renderContext.requestFrame()},s.prototype.zoomTo=function(t,i){var o=this,s=i&&i.distance?i.distance:this.distance/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),a=i&&i.duration?i.duration:5e3,l=this.ctx.getCoordinateSystem().get3DFromWorld(t),h=[this.center[0],this.center[1],this.distance],u=[l[0],l[1],s*this.ctx.getCoordinateSystem().getGeoide().getHeightScale()];this.zoomToAnimation=r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){o.center[0]=t[0],o.center[1]=t[1],o.distance=t[2],o.computeViewMatrix()}});var c=this.center,d=l,p=vec3.subtract(c,d),f=vec3.length(p),g=this.ctx.getRenderContext().getCanvas(),m=Math.min(n.toRadian(45),n.toRadian(45*g.width/g.height)),v=1.1*(f/2/Math.tan(m/2));if(v>this.distance){var y=[.5*h[0]+.5*u[0],.5*h[1]+.5*u[1],v];this.zoomToAnimation.addSegment(0,h,.5,y,function(t,e,i){var r=n.easeInQuad(t),o=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2])]}),this.zoomToAnimation.addSegment(.5,y,1,u,function(t,e,i){var r=n.easeOutQuad(t),o=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2])]})}else this.zoomToAnimation.addSegment(0,h,1,u,function(t,e,i){var r=n.easeOutQuad(t),o=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(o,e[2],i[2])]});var b=this;this.zoomToAnimation.onstop=function(){i&&i.callback&&i.callback(),b.zoomToAnimation=null},this.ctx.addAnimation(this.zoomToAnimation),this.zoomToAnimation.start()},s.prototype.zoom=function(t,e){var i=this.distance;e?this.distance*=e:this.distance*=1+.1*t,this.distance>this.maxDistance&&(this.distance=i),this.distance<this.minDistance&&(this.distance=i),this.computeViewMatrix()},s.prototype.pan=function(t,e){var i=this.renderContext.getCanvas().width/2,r=this.renderContext.getCanvas().height/2,n=this.ctx.getLonLatFromPixel(0,r);null===n&&t>0&&(t=0);var s=this.ctx.getLonLatFromPixel(this.renderContext.getCanvas().width,r);null===s&&t<0&&(t=0);var a=this.ctx.getLonLatFromPixel(i,0);null===a&&e>0&&(e=0);var l=this.ctx.getLonLatFromPixel(i,this.renderContext.getCanvas().height);if(null===l&&e<0&&(e=0),0!==t||0!==e){var h=o.createFromPixel(this.renderContext,i-t,r-e);this.center=h.computePoint(h.planeIntersect([0,0,0],[0,0,1])),this.computeViewMatrix()}},s.prototype.rotate=function(t,e){var i=.1*-t*Math.PI/180,r=quat4.fromAngleAxis(i,[0,0,1]);quat4.multiplyVec3(r,this.up),this.computeViewMatrix()},s.prototype.getDistance=function(){return this.distance*this.ctx.getCoordinateSystem().getGeoide().getRealPlanetRadius()},s}),r("Navigation/NavigationFactory",["./PlanetNavigation","./AstroNavigation","./FlatNavigation","../Utils/Constants"],function(t,e,i,r){return{create:function(n,o,s){var a;switch(n){case r.NAVIGATION.AstroNavigation:a=new e(o,s);break;case r.NAVIGATION.PlanetNavigation:a=new t(o,s);break;case r.NAVIGATION.FlatNavigation:a=new i(o,s);break;default:throw new RangeError("The type "+n+" is not allowed, A valid type is included in the list NAVIGATION","NavigationFactory.js")}return a}}}),r("Context/PlanetContext",["jquery","underscore-min","../Utils/Utils","./AbstractContext","../Utils/Constants","../Globe/GlobeFactory","../Navigation/NavigationFactory","../Services/ServiceFactory"],function(t,e,i,r,n,o,s,a){var l=function(t,e){r.prototype.constructor.call(this,t,n.CONTEXT.Planet,e);var i=this;this.components={posTracker:!0,elevTracker:!0,compassDiv:!1};var l={tileErrorTreshold:e.tileErrorTreshold||3,continuousRendering:e.continuousRendering||!1,renderContext:e.renderContext,canvas:this.canvas,coordinateSystem:e.coordinateSystem,shadersPath:"../../shaders/",lighting:!1,backgroundColor:[0,0,0,1],minFar:0,defaultColor:[200,200,200,255],renderTileWithoutTexture:!0,publishEvent:function(t,e){i.publish(t,e)}};try{this.globe=o.create(n.GLOBE.Planet,l),this.initGlobeEvents(this.globe),this.planetLayer=e.planetLayer,this.planetLayer&&(this.globe.addLayer(this.planetLayer),this.layers=this.layers.concat(this.planetLayer.layers),this.layers=this.layers.concat(this.planetLayer.baseImageries)),this.navigationOptions=e.navigation,this.navigation=s.create(this.getCoordinateSystem().isFlat()?n.NAVIGATION.FlatNavigation:n.NAVIGATION.PlanetNavigation,this,e.navigation),a.create(n.SERVICE.PickingManager).init(this)}catch(t){console.log("Erreur creation Planet : ",t),document.getElementById("GlobWebCanvas")&&(document.getElementById("GlobWebCanvas").style.display="none"),document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),document.getElementById("webGLNotAvailable")&&(document.getElementById("webGLNotAvailable").style.display="block")}};return i.inherits(r,l),l.prototype.setCompassVisible=function(t,e){},l.prototype.setBaseElevation=function(t){this.globe.setBaseElevation(t),this.elevationTracker.setScaleLayer(t)},l.prototype.setCoordinateSystem=function(e){if(e.getType()!==this.getMode())throw"incompatible coordinate reference system with Planet context";var i,r,o=this;t(o.canvas.parentElement).find("#loading").show(),i=this.globe.getCoordinateSystem().isFlat()?this.globe.getCoordinateSystem().getWorldFrom3D(this.navigation.center):this.navigation.geoCenter,r=this.navigation.distance/this.globe.getCoordinateSystem().getGeoide().getHeightScale(),this.globe.setCoordinateSystem(e),this.navigation.stop();var a={};a.inertia=!!this.navigation.getOptions().hasOwnProperty("inertia")&&this.navigation.getOptions().inertia,this.navigation.getOptions().hasOwnProperty("mouse")&&(a.mouse=this.navigation.getOptions().mouse);try{e.isFlat()?(this.navigation=s.create(n.NAVIGATION.FlatNavigation,this,a),this.navigation.center=this.globe.getCoordinateSystem().get3DFromWorld(i)):(this.navigation=s.create(n.NAVIGATION.PlanetNavigation,this,a),this.navigation.geoCenter=i),this.navigation.distance=r*this.globe.getCoordinateSystem().getGeoide().getHeightScale()}catch(t){console.log("Erreur creation Planet : ",t),document.getElementById("GlobWebCanvas")&&(document.getElementById("GlobWebCanvas").style.display="none"),document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),document.getElementById("webGLNotAvailable")&&(document.getElementById("webGLNotAvailable").style.display="block")}this.navigation.computeViewMatrix(),this.publish("modifiedCrs",e)},l.prototype.enable=function(){for(var t=this.getRenderContext().renderers,e=0;e<t.length;e++)if(t[e].isSky()){this.getRenderContext().renderers[0].enable();break}},l.prototype.disable=function(){for(var t=this.getRenderContext().renderers,e=0;e<t.length;e++)if(!t[e].isSky()){this.getRenderContext().renderers[0].disable();break}},l.prototype.destroy=function(){this.hide(),this.elevationTracker&&this.elevationTracker.detach(),this.positionTracker&&this.positionTracker.detach(),this.planetLayer.setVisible(!1),this.planetLayer._detach();for(var t=0;t<this.layers.length;t++){var e=this.layers[t];this.removeLayer(e)}this.globe.destroy(),this.globe=null,this.layers=[]},l}),r("Gui/CompassCore",["jquery","../Utils/Constants"],function(t,e){function i(t){var i=[0,0,1],r=a.getCoordinateSystem(),n=[];r.from3DToGeo(i,n,!1),n=r.convert(n,r.getGeoideName(),e.CRS.Equatorial),r.fromGeoTo3D(n,i,!1),a.getNavigation().moveUpTo(i)}function r(){var t=[],i=a.getCoordinateSystem();i.from3DToGeo(a.getNavigation().center3d,t,!1),t=i.convert(t,e.CRS.Equatorial,i.getGeoideName());var r=[];i.getLHVTransform(t,r);var n=[],s=[r[4],r[5],r[6]],l=[r[8],r[9],r[10]],h=vec3.create(a.getNavigation().up);i.from3DToGeo(h,n,!1),n=i.convert(n,e.CRS.Equatorial,i.getGeoideName()),i.fromGeoTo3D(n,h,!1),vec3.normalize(h);var u=vec3.dot(h,s)/(vec3.length(h)*vec3.length(s)),c=Math.acos(u);if(!isNaN(c)){var d,p=180*c/Math.PI;vec3.cross(h,s,n),d=vec3.dot(n,[l[0],l[1],l[2]]),d<0&&(p*=-1);var f=o.getElementById("NorthText");f.setAttribute("transform","rotate("+p+" 40 40)")}}function n(){a.unsubscribe("modifiedNavigation",r),document.getElementById(s).innerHTML=""}var o,s=null,a=null;return{init:function(t){s=t.element,a=t.ctx,o=t.svgDoc},updateNorth:r,_alignWithNorth:i,remove:n}}),r("Gui/Compass",["jquery","./CompassCore"],function(t,e){var i,r=null,n=null,o=function(o){if(r=o.element,n=o.ctx,null===document.getElementById(r))return void console.log("Warning, the div specified ("+r+") do not exist");document.getElementById(r).innerHTML='<div id="objectCompass"></div>',t.get("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjw/eG1sLXN0eWxlc2hlZXQgdHlwZT0idGV4dC9jc3MiIGhyZWY9ImNvbXBhc3MuY3NzIj8+PHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgd2lkdGg9IjUyMCIKICAgaGVpZ2h0PSI1MjAiCiAgIGlkPSJzdmcyIgogICB2ZXJzaW9uPSIxLjEiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguMSByOTc2MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iY29tcGFzc05vcnRoMi5zdmciCiAgIHZpZXdCb3g9Ii0yMjAgLTIyMCA1MjAgNTIwIj4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE0NSI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGUgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGRlZnMKICAgICBpZD0iZGVmczQzIj4KICAgIDxyYWRpYWxHcmFkaWVudAogICAgICAgaWQ9ImdyYWQxIgogICAgICAgY3g9IjAiCiAgICAgICBjeT0iMCIKICAgICAgIHI9IjIwNyIKICAgICAgIGZ4PSIwIgogICAgICAgZnk9IjAiCiAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICAgIDxzdG9wCiAgICAgICAgIG9mZnNldD0iMC43NSIKICAgICAgICAgaWQ9InN0b3A2IgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTowIiAvPgogICAgICA8c3RvcAogICAgICAgICBvZmZzZXQ9IjAuOTQ5OTk5OTkiCiAgICAgICAgIGlkPSJzdG9wOCIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmOTkwMDtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3AKICAgICAgICAgb2Zmc2V0PSIxMDAlIgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjpyZ2IoMjU1LCAyNTUsIDI1NSk7c3RvcC1vcGFjaXR5OjAiCiAgICAgICAgIGlkPSJzdG9wMTAiIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50PgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEyODAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTAwMCIKICAgICBpZD0ibmFtZWR2aWV3NDEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjAuNDEzMTgxODMiCiAgICAgaW5rc2NhcGU6Y3g9IjEwMy43NDIwNiIKICAgICBpbmtzY2FwZTpjeT0iNDguNTQ5MDc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9IkVhc3QiCiAgICAgc2hvd2d1aWRlcz0idHJ1ZSIKICAgICBpbmtzY2FwZTpndWlkZS1iYm94PSJ0cnVlIj4KICAgIDxpbmtzY2FwZTpncmlkCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBpZD0iZ3JpZDMwMTAiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiCiAgICAgICBzbmFwdmlzaWJsZWdyaWRsaW5lc29ubHk9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPGcKICAgICBpZD0iT3V0ZXJDaXJjbGUiCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMS4xNDI4MTM4LDAsMCwxLjEwNTc4OCwwLjMwODI3MzYsNC42MTQ3ODQpIj4KICAgIDxnCiAgICAgICBpZD0iZzMyNjciCiAgICAgICBzdHlsZT0ib3BhY2l0eTowLjYiPgogICAgICA8Y2lyY2xlCiAgICAgICAgIHNvZGlwb2RpOnJ5PSIyMDciCiAgICAgICAgIHNvZGlwb2RpOnJ4PSIyMDciCiAgICAgICAgIHNvZGlwb2RpOmN5PSIwIgogICAgICAgICBzb2RpcG9kaTpjeD0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIGN4PSIwIgogICAgICAgICBkPSJtIDIwNywwIGMgMCwxMTQuMzIyOTQgLTkyLjY3NzA2LDIwNyAtMjA3LDIwNyAtMTE0LjMyMjk0LDAgLTIwNywtOTIuNjc3MDYgLTIwNywtMjA3IDAsLTExNC4zMjI5NCA5Mi42NzcwNiwtMjA3IDIwNywtMjA3IDExNC4zMjI5NCwwIDIwNyw5Mi42NzcwNiAyMDcsMjA3IHoiCiAgICAgICAgIGlkPSJjaXJjbGUyNCIKICAgICAgICAgcj0iMjA3IgogICAgICAgICBzdHlsZT0ib3BhY2l0eTowLjc1O2ZpbGw6dXJsKCNncmFkMSkiCiAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMTA1MjI3OSwwLDAsMS4xMDUyMjc5LDM0LDMyKSIgLz4KICAgIDwvZz4KICAgIDxnCiAgICAgICBpZD0iZzE4IgogICAgICAgc3R5bGU9InN0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxMCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuOTY1NTg4OTksMCwwLDAuOTcxMzI0MTUsMzQsMzIpIj4KICAgICAgPGNpcmNsZQogICAgICAgICByPSIyMTEiCiAgICAgICAgIGlkPSJjaXJjbGUyMCIKICAgICAgICAgZD0ibSAyMTEsMCBjIDAsMTE2LjUzMjA4IC05NC40Njc5MiwyMTEgLTIxMSwyMTEgLTExNi41MzIwOCwwIC0yMTEsLTk0LjQ2NzkyIC0yMTEsLTIxMSAwLC0xMTYuNTMyMDggOTQuNDY3OTIsLTIxMSAyMTEsLTIxMSAxMTYuNTMyMDgsMCAyMTEsOTQuNDY3OTIgMjExLDIxMSB6IgogICAgICAgICBjeD0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgc29kaXBvZGk6cng9IjIxMSIKICAgICAgICAgc29kaXBvZGk6cnk9IjIxMSIgLz4KICAgIDwvZz4KICA8L2c+CiAgPGcKICAgICBpZD0iU291dGgiCiAgICAgY2xhc3M9ImFycm93IgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM5LjU3ODM4MywzNi45NzA0MzUpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ciCiAgICAgICBkPSJNIDM5LjQxNiw5NS4xNiBDIDMzLjY1LDEwMy45NSAzMC43NiwxMTAuNSAyOC45MywxMTcuMTggMTUuMjQsMTEzLjQzIDEzLjU0LDEyNy4xNSAyMy4wNCwxMzEgMTMuNzEsMTQ1LjggNy44NCwxNzMuOTMgMCwyMTIgTCAwLDEwMyBhIDEwMywxMDMgMCAwIDAgMzkuNDE2LC03Ljg0IHoiIC8+CiAgICA8dXNlCiAgICAgICBoZWlnaHQ9IjQ0MCIKICAgICAgIHdpZHRoPSI0NDAiCiAgICAgICB5PSIwIgogICAgICAgeD0iMCIKICAgICAgIGlkPSJzb3V0aCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwxLDIsMCkiCiAgICAgICB4bGluazpocmVmPSIjSGFsZkFycm93IiAvPgogIDwvZz4KICA8ZwogICAgIGlkPSJFYXN0IgogICAgIGNsYXNzPSJhcnJvdyIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLDEsLTEsMCwzOC44MDYyMSwzNy4yMjA0MjkpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ctNiIKICAgICAgIGQ9Ik0gMzkuNDE2LDk1LjE2IEMgMzMuNjUsMTAzLjk1IDMwLjc2LDExMC41IDI4LjkzLDExNy4xOCAxNS4yNCwxMTMuNDMgMTMuNTQsMTI3LjE1IDIzLjA0LDEzMSAxMy43MSwxNDUuOCA3Ljg0LDE3My45MyAwLDIxMiBMIDAsMTAzIGEgMTAzLDEwMyAwIDAgMCAzOS40MTYsLTcuODQgeiIgLz4KICAgIDx1c2UKICAgICAgIGhlaWdodD0iNDQwIgogICAgICAgd2lkdGg9IjQ0MCIKICAgICAgIHk9IjAiCiAgICAgICB4PSIwIgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIKICAgICAgIGlkPSJzb3V0aC01IgogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTEsMCwwLDEsMiwwKSIKICAgICAgIHhsaW5rOmhyZWY9IiNIYWxmQXJyb3ctNiIgLz4KICA8L2c+CiAgPGcKICAgICBpZD0iTm9ydGgiCiAgICAgY2xhc3M9ImFycm93IgogICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwtMSw0MS45MDI3OCw0My43ODMzNzYpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ctNi0wIgogICAgICAgZD0iTSAzOS40MTYsOTUuMTYgQyAzMy42NSwxMDMuOTUgMzAuNzYsMTEwLjUgMjguOTMsMTE3LjE4IDE1LjI0LDExMy40MyAxMy41NCwxMjcuMTUgMjMuMDQsMTMxIDEzLjcxLDE0NS44IDcuODQsMTczLjkzIDAsMjEyIEwgMCwxMDMgYSAxMDMsMTAzIDAgMCAwIDM5LjQxNiwtNy44NCB6IiAvPgogICAgPHVzZQogICAgICAgaGVpZ2h0PSI0NDAiCiAgICAgICB3aWR0aD0iNDQwIgogICAgICAgeT0iMCIKICAgICAgIHg9IjAiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmIgogICAgICAgaWQ9InNvdXRoLTUtNiIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwxLDIsMCkiCiAgICAgICB4bGluazpocmVmPSIjSGFsZkFycm93LTYtMCIgLz4KICA8L2c+CiAgPGcKICAgICBpZD0iV2VzdCIKICAgICBjbGFzcz0iYXJyb3ciCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMCwtMSwxLDAsMzcuMzc0NzU4LDM5LjU0NzAyMykiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7c3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjEiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgaWQ9IkhhbGZBcnJvdy02LTAtNSIKICAgICAgIGQ9Ik0gMzkuNDE2LDk1LjE2IEMgMzMuNjUsMTAzLjk1IDMwLjc2LDExMC41IDI4LjkzLDExNy4xOCAxNS4yNCwxMTMuNDMgMTMuNTQsMTI3LjE1IDIzLjA0LDEzMSAxMy43MSwxNDUuOCA3Ljg0LDE3My45MyAwLDIxMiBMIDAsMTAzIGEgMTAzLDEwMyAwIDAgMCAzOS40MTYsLTcuODQgeiIgLz4KICAgIDx1c2UKICAgICAgIGhlaWdodD0iNDQwIgogICAgICAgd2lkdGg9IjQ0MCIKICAgICAgIHk9IjAiCiAgICAgICB4PSIwIgogICAgICAgaWQ9InNvdXRoLTUtNi0yIgogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTEsMCwwLDEsMiwwKSIKICAgICAgIHhsaW5rOmhyZWY9IiNIYWxmQXJyb3ctNi0wLTUiIC8+CiAgPC9nPgogIDx0ZXh0CiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjkwcHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpib2xkO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpzdGFydDtsaW5lLWhlaWdodDoxMjkuOTk5OTk1MjMlO2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiNmZjdmMmE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7Zm9udC1mYW1pbHk6VGltZXMgTmV3IFJvbWFuOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246J1RpbWVzIE5ldyBSb21hbiwgQm9sZCciCiAgICAgeD0iMTkuMjU0ODc1IgogICAgIHk9Ii0xNjMuMDY2NzYiCiAgICAgaWQ9Ik5vcnRoVGV4dCIKICAgICBzb2RpcG9kaTpsaW5lc3BhY2luZz0iMTMwJSIKICAgICB0cmFuc2Zvcm09InNjYWxlKDEuMDA4MzY2NSwwLjk5MTcwMjkyKSI+PHRzcGFuCiAgICAgICBzb2RpcG9kaTpyb2xlPSJsaW5lIgogICAgICAgaWQ9InRzcGFuMzAyNCIKICAgICAgIHg9IjE5LjI1NDg3NSIKICAgICAgIHk9Ii0xNjMuMDY2NzYiCiAgICAgICBzdHlsZT0iZm9udC1zaXplOjgwcHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpib2xkO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpzdGFydDtsaW5lLWhlaWdodDoxMjkuOTk5OTk1MjMlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiNmZjdmMmE7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjFweDtmb250LWZhbWlseTpUaW1lcyBOZXcgUm9tYW47LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonVGltZXMgTmV3IFJvbWFuLCBCb2xkJyI+TjwvdHNwYW4+PC90ZXh0PgogIDxnCiAgICAgaWQ9IklubmVyQ2lyY2xlIgogICAgIHN0eWxlPSJvcGFjaXR5OjAuNiIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzOS4yNjA3MjYsNDEuMjEwMTIxKSI+CiAgICA8ZwogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6OCIKICAgICAgIGlkPSJnNyI+CiAgICAgIDxjaXJjbGUKICAgICAgICAgc29kaXBvZGk6cng9Ijc1IgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIGN4PSIwIgogICAgICAgICBkPSJNIDc1LDAgQyA3NSw0MS40MjEzNTYgNDEuNDIxMzU2LDc1IDAsNzUgLTQxLjQyMTM1Niw3NSAtNzUsNDEuNDIxMzU2IC03NSwwIGMgMCwtNDEuNDIxMzU2IDMzLjU3ODY0NCwtNzUgNzUsLTc1IDQxLjQyMTM1NiwwIDc1LDMzLjU3ODY0NCA3NSw3NSB6IgogICAgICAgICBpZD0iY2lyY2xlOSIKICAgICAgICAgcj0iNzUiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBzb2RpcG9kaTpyeT0iNzUiIC8+CiAgICA8L2c+CiAgICA8ZwogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzFiMWIxYjtzdHJva2Utd2lkdGg6MSIKICAgICAgIGlkPSJnMTEiPgogICAgICA8Y2lyY2xlCiAgICAgICAgIHNvZGlwb2RpOnJ5PSI3MSIKICAgICAgICAgc29kaXBvZGk6cng9IjcxIgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgc29kaXBvZGk6Y3g9IjAiCiAgICAgICAgIGN5PSIwIgogICAgICAgICBjeD0iMCIKICAgICAgICAgZD0iTSA3MSwwIEMgNzEsMzkuMjEyMjE3IDM5LjIxMjIxNyw3MSAwLDcxIC0zOS4yMTIyMTcsNzEgLTcxLDM5LjIxMjIxNyAtNzEsMCBjIDAsLTM5LjIxMjIxNyAzMS43ODc3ODMsLTcxIDcxLC03MSAzOS4yMTIyMTcsMCA3MSwzMS43ODc3ODMgNzEsNzEgeiIKICAgICAgICAgaWQ9ImNpcmNsZTEzIgogICAgICAgICByPSI3MSIgLz4KICAgICAgPGNpcmNsZQogICAgICAgICBzb2RpcG9kaTpyeT0iNzkiCiAgICAgICAgIHNvZGlwb2RpOnJ4PSI3OSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjAiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBjeT0iMCIKICAgICAgICAgY3g9IjAiCiAgICAgICAgIGQ9Ik0gNzksMCBDIDc5LDQzLjYzMDQ5NSA0My42MzA0OTUsNzkgMCw3OSAtNDMuNjMwNDk1LDc5IC03OSw0My42MzA0OTUgLTc5LDAgYyAwLC00My42MzA0OTUgMzUuMzY5NTA1LC03OSA3OSwtNzkgNDMuNjMwNDk1LDAgNzksMzUuMzY5NTA1IDc5LDc5IHoiCiAgICAgICAgIGlkPSJjaXJjbGUxNSIKICAgICAgICAgcj0iNzkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K",function(a){
i=document.importNode(a.documentElement,!0),i.height.baseVal.value=100,i.width.baseVal.value=100,t("#objectCompass").append(i),o.svgDoc=i,e.init(o),s(),n.publish("modifiedNavigation"),t("#"+r).css("display","block")},"xml");var s=function(){var t=i.getElementById("East"),r=i.getElementById("West"),s=i.getElementById("South"),a=i.getElementById("North"),l=i.getElementById("NorthText"),h=i.getElementById("OuterCircle"),u=o.panFactor?o.panFactor:30,c=-1,d=-1,p=0,f=0,g=!1,m=h.ownerSVGElement.clientWidth/2,v=function(t){t.preventDefault(),t.type.search("touch")>=0&&(t.layerX=t.changedTouches[0].clientX,t.layerY=t.changedTouches[0].clientY),g=!0,c=t.layerX-m,d=t.layerY-m,p=0,f=0};i.addEventListener("mousedown",v);var y=function(t){if(t.preventDefault(),t.type.search("touch")>=0&&(t.layerX=t.changedTouches[0].clientX,t.layerY=t.changedTouches[0].clientY),g){var i=c*(t.layerY-m)-d*(t.layerX-m);n.getNavigation().rotate(i,0),c=t.layerX-m,d=t.layerY-m,e.updateNorth()}};i.addEventListener("mousemove",y);var b=function(t){t.preventDefault(),g=!1};i.addEventListener("mouseup",b),t.addEventListener("click",function(){n.getNavigation().pan(u,0),e.updateNorth()}),r.addEventListener("click",function(){n.getNavigation().pan(-u,0),e.updateNorth()}),a.addEventListener("click",function(){n.getNavigation().pan(0,u),e.updateNorth()}),s.addEventListener("click",function(){n.getNavigation().pan(0,-u),e.updateNorth()}),l.addEventListener("click",e._alignWithNorth),o.isMobile&&(i.addEventListener("touchstart",v),i.addEventListener("touchup",b),i.addEventListener("touchmove",y),l.addEventListener("touchstart",e._alignWithNorth)),n.subscribe("modifiedNavigation",e.updateNorth,l)}};return o.prototype.remove=e.remove,o}),r("Context/SkyContext",["underscore-min","../Utils/Utils","./AbstractContext","../Globe/GlobeFactory","../Navigation/NavigationFactory","../Services/ServiceFactory","../Gui/Compass","../Utils/Constants"],function(t,e,i,r,n,o,s,a){var l=function(t,e){i.prototype.constructor.call(this,t,a.CONTEXT.Sky,e);var s=this;this.components={posTracker:!0,elevTracker:!1,compassDiv:!0};var l={canvas:this.canvas,tileErrorTreshold:e.tileErrorTreshold||1.5,continuousRendering:e.continuousRendering||!0,renderTileWithoutTexture:!1,radius:e.radius||10,minFar:e.minFar||15,coordinateSystem:e.coordinateSystem,lighting:!1,backgroundColor:[0,0,0,1],defaultColor:[200,200,200,255],publishEvent:function(t,e){s.publish(t,e)}};e.renderContext&&(l.renderContext=e.renderContext);try{this.globe=r.create(a.GLOBE.Sky,l),this.initGlobeEvents(this.globe),this.navigation=n.create(a.NAVIGATION.AstroNavigation,this,e.navigation?e.navigation:e),o.create(a.SERVICE.PickingManager).init(this),this.components.compassDiv&&this.setCompassVisible(e.compass?e.compass:"compassDiv",!0)}catch(t){console.log("Erreur creation Sky : ",t),document.getElementById("GlobWebCanvas")&&(document.getElementById("GlobWebCanvas").style.display="none"),document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),document.getElementById("webGLNotAvailable")&&(document.getElementById("webGLNotAvailable").style.display="block")}};return e.inherits(i,l),l.prototype.setCompassVisible=function(t,e){e?this.compass=new s({element:t,ctx:this}):this.compass&&this.compass.remove(),this.setComponentVisibility(t,e)},l.prototype.setCoordinateSystem=function(t){if(t.getType()!==this.getMode())throw"incompatible coordinate reference system with Sky context";this.globe.setCoordinateSystem(t),this.publish("modifiedCrs",t)},l.prototype.enable=function(){for(var t=this.getRenderContext().renderers,e=0;e<t.length;e++)if(t[e].isSky()){this.getRenderContext().renderers[0].enable();break}},l.prototype.disable=function(){for(var t=this.getRenderContext().renderers,e=0;e<t.length;e++)if(t[e].isSky()){this.getRenderContext().renderers[0].disable();break}},l.prototype.destroy=function(){this.hide(),this.compass.setCompassVisible(!1),this.elevationTracker&&this.elevationTracker.detach(),this.positionTracker&&this.positionTracker.detach();for(var t=0;t<this.layers.length;t++){var e=this.layers[t];this.removeLayer(e)}this.globe.destroy(),this.globe=null,this.layers=[]},l}),r("Context/ContextFactory",["../Utils/Constants","./PlanetContext","./SkyContext"],function(t,e,i){return{create:function(r,n,o){var s;switch(r){case t.CONTEXT.Planet:s=new e(n,o);break;case t.CONTEXT.Sky:s=new i(n,o);break;default:throw RangeError("The type "+r+" is not allowed, A valid type is included in the list Constants.CONTEXT","ContextFactory.js")}return s}}}),r("Provider/AbstractProvider",["jquery"],function(t){var e=function(t){this.options=t};return e.prototype.loadFiles=function(t,e){},e.prototype.handleFeatures=function(t){},e}),r("Provider/ConstellationProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Utils","../Utils/Constants"],function(t,e,i,r,n){function o(t){for(var e=a.split("\n"),i=l.split("\n"),r=0;r<i.length;r++){var o=i[r].replace("  "," ");o=o.split(" ");var s=parseFloat(o[0]),h=parseFloat(o[1]),c=o[2];o[3];if(s*=15,!u[c])for(var d=0;d<e.length;d++){o=e[d].split(";");var p=o[0];if(p===c){var f=o[1];u[c]={coord:[],name:f,x:0,y:0,z:0,nbStars:0};break}}var g=[s,h],m=[];t.globe.getCoordinateSystem().get3DFromWorldInCrs(g,n.CRS.Equatorial,m),u[c].x+=m[0],u[c].y+=m[1],u[c].z+=m[2],u[c].nbStars++,u[c].coord.push(g)}}function s(){console.error("Failed to load files")}var a,l,h,u={},c=function(t){e.prototype.constructor.call(this,t),h=this};return r.inherits(e,c),c.prototype.loadFiles=function(e,i){var r=e;if(!i.nameUrl||!i.catalogueUrl)return console.error("Not valid options"),!1;var n={type:"GET",url:i.nameUrl,success:function(t){a=t},error:function(t,e,i){console.error(t.responseText)}},u={type:"GET",url:i.catalogueUrl,success:function(t){l=t},error:function(t,e,i){console.error(t.responseText)}};t.when(t.ajax(n),t.ajax(u)).then(function(){o(r),h.handleFeatures(r)},s)},c.prototype.handleFeatures=function(t){var e=[],r=[];for(var o in u){var s=u[o];s.coord.push(s.coord[0]);var a={geometry:{type:n.GEOMETRY.Polygon,gid:"constellationShape_"+s.name,coordinates:[s.coord],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:s.name}};r.push(a);var l=[];t.globe.getCoordinateSystem().getWorldFrom3D([s.x/s.nbStars,s.y/s.nbStars,s.z/s.nbStars],l);var h={geometry:{type:n.GEOMETRY.Point,gid:"constellationName_"+s.name,coordinates:[l[0],l[1]],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:s.name,style:new i({textColor:"#083BA8",fillColor:[1,1,1,1],label:s.name})}};e.push(h)}var c={type:"FeatureCollection",features:r},d={type:"FeatureCollection",features:e};t.addFeatureCollection(c),t.addFeatureCollection(d)},c}),r("Provider/OpenSearchProvider",["jquery","./AbstractProvider","../Parser/JsonProcessor"],function(t,e,i){var r,n=function(t){r=this,e.prototype.constructor.call(this,t)};return n.prototype.loadFiles=function(e,i,n){t.ajax({type:"GET",url:i.url+"startIndex="+n+"&count=500",success:function(t){r.handleFeatures(e,i,n,t)},error:function(t,e,i){console.error(t.responseText)}})},n.prototype.handleFeatures=function(t,e,n,o){i.handleFeatureCollection(t,o),t.addFeatureCollection(o),n+o.features.length<o.totalResults&&r.loadFiles(t,e.url,n+o.features.length)},n}),r("Provider/PlanetProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Constants"],function(t,e,i,r){function n(t,e,i){var r,n=t.toFixed(i),o=n.length,s="";for(r=0;r<e-o;r++)s+=" ";for(r=0;r<o;r++)s+=n.charAt(r);return s}function o(t,e,o,s){var a;return a=new i(e===r.GEOMETRY.Point?{iconUrl:t.style.iconUrl,strokeColor:i.fromStringToColor(s.color),fillColor:i.fromStringToColor(s.color)}:{label:o,strokeColor:i.fromStringToColor(s.color),fillColor:i.fromStringToColor(s.color)}),{geometry:{type:r.GEOMETRY.Point,gid:"planet"+e+"_"+o,coordinates:[s.ra,s.dec],crs:{type:"name",properties:{name:r.CRS.Equatorial}}},properties:{name:o,distance:n(s.rvec,9,6)+" AU",style:a}}}function s(){this.ra=parseFloat("0"),this.dec=parseFloat("0"),this.rvec=parseFloat("0")}function a(t,e,i,r,n){var o=r+n/60;return 367*t-Math.floor(7*(t+Math.floor((e+9)/12))/4)+Math.floor(275*e/9)+i-730531.5+o/24}function l(){this.color="",this.a=parseFloat("0"),this.e=parseFloat("0"),this.i=parseFloat("0"),this.O=parseFloat("0"),this.w=parseFloat("0"),this.L=parseFloat("0")}function h(t){var e;return e=t>=0?Math.floor(t):Math.ceil(t)}function u(t){var e=t/(2*Math.PI),i=2*Math.PI*(e-h(e));return i<0&&(i=2*Math.PI+i),i}function c(t,e){var i,r,n=t+e*Math.sin(t)*(1+e*Math.cos(t));do r=n,n=r-(r-e*Math.sin(r)-t)/(1-e*Math.cos(r));while(Math.abs(n-r)>b);return i=2*Math.atan(Math.sqrt((1+e)/(1-e))*Math.tan(.5*n)),i<0&&(i+=2*Math.PI),i}function d(t,e,i){var r=i/36525;switch(e){case 0:t.color="rgb(170,150,170)",t.a=.38709893+6.6e-7*r,t.e=.20563069+2527e-8*r,t.i=(7.00487-23.51*r/3600)*y,t.O=(48.33167-446.3*r/3600)*y,t.w=(77.45645+573.57*r/3600)*y,t.L=u((252.25084+538101628.29*r/3600)*y);break;case 1:t.color="rgb(245,222,179)",t.a=.72333199+9.2e-7*r,t.e=.00677323-4938e-8*r,t.i=(3.39471-2.86*r/3600)*y,t.O=(76.68069-996.89*r/3600)*y,t.w=(131.53298-108.8*r/3600)*y,t.L=u((181.97973+210664136.06*r/3600)*y);break;case 2:t.color="rgb(255,193,37)",t.a=1.00000011-5e-8*r,t.e=.01671022-3804e-8*r,t.i=(5e-5-46.94*r/3600)*y,t.O=(-11.26064-18228.25*r/3600)*y,t.w=(102.94719+1198.28*r/3600)*y,t.L=u((100.46435+129597740.63*r/3600)*y);break;case 3:t.color="rgb(255,50,50)",t.a=1.52366231-7221e-8*r,t.e=.09341233+11902e-8*r,t.i=(1.85061-25.47*r/3600)*y,t.O=(49.57854-1020.19*r/3600)*y,t.w=(336.04084+1560.78*r/3600)*y,t.L=u((355.45332+68905103.78*r/3600)*y);break;case 4:t.color="rgb(255,150,150)",t.a=5.20336301+60737e-8*r,t.e=.04839266-1288e-7*r,t.i=(1.3053-4.15*r/3600)*y,t.O=(100.55615+1217.17*r/3600)*y,t.w=(14.75385+839.93*r/3600)*y,t.L=u((34.40438+10925078.35*r/3600)*y);break;case 5:t.color="rgb(200,150,150)",t.a=9.53707032-.0030153*r,t.e=.0541506-36762e-8*r,t.i=(2.48446+6.11*r/3600)*y,t.O=(113.71504-1591.05*r/3600)*y,t.w=(92.43194-1948.89*r/3600)*y,t.L=u((49.94432+4401052.95*r/3600)*y);break;case 6:t.color="rgb(130,150,255)",t.a=19.19126393+.00152025*r,t.e=.04716771-1915e-7*r,t.i=(.76986-2.09*r/3600)*y,t.O=(74.22988-1681.4*r/3600)*y,t.w=(170.96424+1312.56*r/3600)*y,t.L=u((313.23218+1542547.79*r/3600)*y);break;case 7:t.color="rgb(100,100,255)",t.a=30.06896348-.00125196*r,t.e=.00858587+251e-7*r,t.i=(1.76917-3.64*r/3600)*y,t.O=(131.72169-151.25*r/3600)*y,t.w=(44.97135-844.43*r/3600)*y,t.L=u((304.88003+786449.21*r/3600)*y);break;case 8:t.color="rgb(100,100,255)",t.a=39.48168677-76912e-8*r,t.e=.24880766+6465e-8*r,t.i=(17.14175+11.07*r/3600)*y,t.O=(110.30347-37.33*r/3600)*y,t.w=(224.06676-132.25*r/3600)*y,t.L=u((238.92881+522747.9*r/3600)*y);break;default:throw"function mean_elements() failed!"}}function p(t,e,i){var r=new l;d(r,e,i);var n=r.a,o=r.e,s=r.i,a=r.O,h=r.w,p=r.L,f=new l;d(f,2,i);var g=f.a,m=f.e,b=f.w,x=f.L,C=u(x-b),_=c(C,m),w=g*(1-m*m)/(1+m*Math.cos(_)),T=w*Math.cos(_+b),A=w*Math.sin(_+b),I=0,M=u(p-h),S=c(M,r.e),P=n*(1-o*o)/(1+o*Math.cos(S)),E=P*(Math.cos(a)*Math.cos(S+h-a)-Math.sin(a)*Math.sin(S+h-a)*Math.cos(s)),R=P*(Math.sin(a)*Math.cos(S+h-a)+Math.cos(a)*Math.sin(S+h-a)*Math.cos(s)),k=P*(Math.sin(S+h-a)*Math.sin(s));2===e&&(E=0,R=0,k=0);var D=E-T,L=R-A,N=k-I,F=23.439281*y,O=D,B=L*Math.cos(F)-N*Math.sin(F),U=L*Math.sin(F)+N*Math.cos(F);t.ra=u(Math.atan2(B,O))*v,t.dec=Math.atan(U/Math.sqrt(O*O+B*B))*v,t.rvec=Math.sqrt(O*O+B*B+U*U),t.color=r.color}var f,g,m,v=180/Math.PI,y=Math.PI/180,b=1e-12,x=new Array("Mercury","Venus","Sun","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto"),C=function(t){for(var e=[],i=new Date,n=i.getUTCFullYear(),l=i.getUTCMonth()+1,h=i.getUTCDate(),u=i.getUTCHours(),c=i.getUTCMinutes(),d=i.getUTCSeconds(),f=a(n,l,h,u,c+d/60),g=new s,v=0;v<9;v++){p(g,v,f);var y=o(t,"Label",x[v],g);e.push(y);var b=o(t,r.GEOMETRY.Point,x[v],g);e.push(b)}m={type:"FeatureCollection",features:e},t.addFeatureCollection(m)},_=function(t){e.prototype.constructor.call(this,t),f=this};return _.prototype.loadFiles=function(t,e){g=e.interval?e.interval:6e4,f.handleFeatures(t)},_.prototype.handleFeatures=function(t){C(t),setInterval(function(){t.removeFeatureCollection(m),C(t)},g)},_}),r("Provider/StarProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Utils","../Utils/Constants"],function(t,e,i,r,n){function o(){console.error("Failed to load files")}var s,a,l,h=function(t){e.prototype.constructor.call(this,t),l=this};return r.inherits(e,h),h.prototype.loadFiles=function(e,i){if(!i.nameUrl||!i.catalogueUrl)return console.error("Not valid options"),null;var r={type:"GET",url:i.nameUrl,success:function(t){s=t},error:function(t,e,i){console.error(t.responseText)}},n={type:"GET",url:i.catalogueUrl,success:function(t){a=t},error:function(t,e,i){console.error(t.responseText)}};t.proxy(t.when(t.ajax(r),t.ajax(n)).then(function(){l.handleFeatures(e)},o))},h.prototype.handleFeatures=function(t){var e=s.slice(s.indexOf("897;Acamar"),s.indexOf("1231;Zaurak")+11),r=e.split("\n");e=a.slice(a.indexOf("001."),a.indexOf("4.98;K3Ibv")+10);for(var o=e.split("\n"),l=[],h=0;h<r.length;h++)for(var u=r[h].split(";"),c=parseInt(u[0],10),d=u[1],p=0;p<o.length;p++)if(u=o[p].split(";"),parseInt(u[2],10)===c){var f=u[6],g=u[7],m=[];t.globe.getCoordinateSystem().getDecimalDegFromSexagesimal([f,g],m);var v={geometry:{type:n.GEOMETRY.Point,gid:"star_"+d,coordinates:[m[0],m[1]],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:d,style:new i({label:d,fillColor:[1,1,1,1]})}};l.push(v)}var y={type:"FeatureCollection",features:l};t.addFeatureCollection(y)},h}),r("Provider/CraterProvider",["jquery","./AbstractProvider","../Utils/Utils","../Renderer/FeatureStyle"],function(t,e,i,r){var n,o,s=function(t){e.prototype.constructor.call(this,t),n=this};return i.inherits(e,s),s.prototype.loadFiles=function(e,i){t.ajax({type:"GET",url:i.url,success:function(t){o=t,n.handleFeatures(e)},error:function(t,e,i){console.error(t.responseText)}})},s.prototype.handleFeatures=function(t){for(var e=o.crs,i=o.features,n=0;n<i.length;n++){var s=i[n];s.geometry.crs=e;var a=s.properties.name;s.properties.style=new r({label:a,fillColor:[1,1,1,1],pointMaxSize:20})}t.addFeatureCollection(o)},s}),r("Provider/ProviderFactory",["./ConstellationProvider","./OpenSearchProvider","./PlanetProvider","./StarProvider","./CraterProvider","../Utils/Constants"],function(t,e,i,r,n,o){return{create:function(s,a){var l;switch(s){case o.PROVIDER.Constellation:l=new t(a);break;case o.PROVIDER.Crater:l=new n(a);break;case o.PROVIDER.OpenSearch:l=new e(a);break;case o.PROVIDER.Planet:l=new i(a);break;case o.PROVIDER.Star:l=new r(a);break;default:throw"unable to create the provider "+s}return l}}}),r("Layer/LayerManager",["jquery","underscore-min","../Utils/Constants","../Provider/ProviderFactory","./HipsMetadata","../Gui/dialog/ErrorDialog"],function(t,e,i,r,n,o){function s(t){var e=[];return t.hips_service_url&&e.push(t.hips_service_url),t.hips_service_url_1&&e.push(t.hips_service_url_1),t.hips_service_url_2&&e.push(t.hips_service_url_2),e}function a(e,i){if(0===e.length)return i(void 0);var r=e.shift();t.ajax({type:"GET",url:r+"/properties",dataType:"text"}).done(function(t,e,n){if(200===n.status)return i(r)}).error(function(){a(e,i)})}function l(i,r){t.ajax({type:"GET",url:r,context:i,dataType:"json"}).done(function(r){e.each(r,function(e){var r=s(e);a(r,function(r){return"undefined"==typeof r?void console.log("Cannot add layer "+e.obs_title+" no mirror available"):void t.proxy(h,i)(e,r)})},i)})}function h(t,e){if(!t.hasOwnProperty("hips_status")||null!==!t.hips_status.match("public")){t.hips_service_url=e;try{this.addLayer({type:i.LAYER.Hips,hipsMetadata:new n(t)})}catch(e){o.open("Hips layer "+t.creator_did+" not valid in Hips registry.")}}}var u,c=function(t,e){this.mizarAPI=t,this.dataProviders={},e.hasOwnProperty("registry")&&e.registry.hasOwnProperty("hips")&&l(this,e.registry.hips),u=this};return c.prototype.registerNoStandardDataProvider=function(t,e,r){switch(this.dataProviders[t.toString()]=e,r){case void 0:this.mizarAPI.getContextManager().getActivatedContext().registerNoStandardDataProvider(t,e);break;case i.CONTEXT.Sky:this.mizarAPI.getContextManager().getSkyContext().registerNoStandardDataProvider(t,e);break;case i.CONTEXT.Planet:this.mizarAPI.getContextManager().getPlanetContext().registerNoStandardDataProvider(t,e);break;default:throw new RangeError("The more "+more+" is not allowed, A valid mode is included in the list CONTEXT","LayerManager.js")}},c.prototype.getSkyLayers=function(){return this.mizarAPI.getContextManager().getSkyContext().getLayers()},c.prototype.getPlanetLayers=function(){return this.mizarAPI.getContextManager().getPlanetContext().getLayers()},c.prototype.getLayers=function(t){var e=[];switch(t){case void 0:e=this.mizarAPI.getContextManager().getActivatedContext().getLayers();break;case i.CONTEXT.Sky:e=this.getSkyLayers();break;case i.CONTEXT.Planet:e=this.getPlanetLayers();break;default:throw new RangeError("The more "+more+" is not allowed, A valid mode is included in the list CONTEXT","LayerManager.js")}return e},c.prototype.getAllLayers=function(){return e.union(this.getSkyLayers(),this.getPlanetLayers())},c.prototype.getLayerByID=function(t,e){var r;switch(e){case void 0:r=this.mizarAPI.getContextManager().getActivatedContext().getLayerByID(t);break;case i.CONTEXT.Sky:r=this.mizarAPI.getContextManager().getSkyContext().getLayerByID(t);break;case i.CONTEXT.Planet:r=this.mizarAPI.getContextManager().getPlanetContext().getLayerByID(t);break;default:throw new RangeError("unknown mode "+e+" in getLayerByID(layerID,mode)","LayerManager.js")}return r},c.prototype.getLayerByName=function(t,e){var r;switch(e){case void 0:r=this.mizarAPI.getContextManager().getActivatedContext().getLayerByName(t);break;case i.CONTEXT.Sky:r=this.mizarAPI.getContextManager().getSkyContext().getLayerByName(t);break;case i.CONTEXT.Planet:r=this.mizarAPI.getContextManager().getPlanetContext().getLayerByName(t);break;default:throw new RangeError("unknown mode "+e+" in getLayerByName(layerName,mode)","LayerManager.js")}return r},c.prototype.addLayer=function(t,e){var i;return e?(i=this.mizarAPI.LayerFactory.create(t),e.layers.push(i)):i=this.mizarAPI.getContextManager().getActivatedContext().addLayer(t),i.ID},c.prototype.removeLayer=function(t,e){var r;switch(e){case void 0:r=this.mizarAPI.getContextManager().getActivatedContext().removeLayer(t);break;case i.CONTEXT.Sky:r=this.mizarAPI.getContextManager().getSkyContext().removeLayer(t);break;case i.CONTEXT.Planet:r=this.mizarAPI.getContextManager().getPlanetContext().removeLayer(t);break;default:throw new RangeError("unknown mode "+e+" in getLayerByID(layerID,mode)","LayerManager.js")}return"undefined"!=typeof gwLayer},c.prototype.setBackgroundLayer=function(t,e){var r;switch(e){case void 0:r=this.mizarAPI.getContextManager().getActivatedContext().setBackgroundLayer(t);break;case i.CONTEXT.Sky:r=this.mizarAPI.getContextManager().getSkyContext().setBackgroundLayer(t);break;case i.CONTEXT.Planet:r=this.mizarAPI.getContextManager().getPlanetContext().setBackgroundLayer(t);break;default:throw new RangeError("unknown mode "+e+" in setBackgroundLayer(layerName,mode)","LayerManager.js")}return"undefined"!=typeof r},c.prototype.setBackgroundLayerByID=function(t,e){var r;switch(e){case void 0:r=this.mizarAPI.getContextManager().getActivatedContext().setBackgroundLayerByID(t);break;case i.CONTEXT.Sky:r=this.mizarAPI.getContextManager().getSkyContext().setBackgroundLayerByID(t);break;case i.CONTEXT.Planet:r=this.mizarAPI.getContextManager().getPlanetContext().setBackgroundLayerByID(t);break;default:throw new RangeError("unknown mode "+e+" in setBackgroundLayer(layerName,mode)","LayerManager.js")}return"undefined"!=typeof r},c.prototype.setBaseElevation=function(t,e){var r=this.getLayerByName(t,e),n=!1;switch(e){case void 0:n=this.mizarAPI.getContextManager().getActivatedContext().setBaseElevation(r);break;case i.CONTEXT.Sky:n=this.mizarAPI.getContextManager().getSkyContext().setBaseElevation(r);break;case i.CONTEXT.Planet:n=this.mizarAPI.getContextManager().getPlanetContext().setBaseElevation(r);break;default:throw new RangeError("unknown mode "+e+" in setBaseElevation(layer)","LayerManager.js")}return n},c.prototype.searchOnLayerDescription=function(t,i){var r=this.getLayers(i);return e.filter(r,function(e){return String(e.name).indexOf(t)>=0||String(e.description||"").indexOf(t)>=0})},c.prototype.searchGlobeLayer=function(t){var i=this.getSkyLayers();return e.filter(i,function(e){return String(e.name).indexOf(t)>=0||String(e.description||"").indexOf(t)>=0})},c.prototype.searchPlanetLayer=function(t){var i=this.getPlanetLayers();return e.filter(i,function(e){return String(e.name).indexOf(t)>=0||String(e.description||"").indexOf(t)>=0})},c.prototype.destroy=function(){this.dataProviders=null,this.mizarAPI=null},c}),r("Utils/Stats",[],function(){var t=function(t,e){this.type=null,t.getRenderContext().stats=this,this.context=t;var i=e?e.element:void 0;i&&("string"==typeof i?(this.element=document.getElementById(i),this.type="dom"):(this.element=i,this.type="jquery")),this.showFPS=this.context.globe.continuousRendering,this.verbose=!(!e||!e.verbose)&&e.verbose,this.numFrames=0;var r=this;window.setInterval(function(){r.print()},1e3)};return t.prototype.start=function(t){this[t]=Date.now()},t.prototype.end=function(t){var e=Date.now()-this[t],i=this["max_"+t]||-1;i<e&&(i=e);var r=this["sum_"+t]||0;r+=e,this[t]=e,this["max_"+t]=i,this["sum_"+t]=r,"globalRenderTime"===t&&this.numFrames++},t.prototype.print=function(){if(this.numFrames>0){var t="";this.showFPS&&(t+="FPS : "+this.numFrames+"<br>"),t+="Average render time : "+(this.sum_globalRenderTime/this.numFrames).toFixed(2)+" ms",this.verbose&&(t+="<br>Average traverse tiles time : "+(this.sum_traverseTime/this.numFrames).toFixed(2)+" ms",t+="<br>Average render tiles time : "+(this.sum_renderTime/this.numFrames).toFixed(2)+" ms",t+="<br>Average generate tiles time : "+(this.sum_generateTime/this.numFrames).toFixed(2)+" ms",t+="<br>Average request tiles time : "+(this.sum_requestTime/this.numFrames).toFixed(2)+" ms",t+="<br>Max render time : "+this.max_globalRenderTime+" ms",t+="<br>Max traverse tiles time : "+this.max_traverseTime+" ms",t+="<br>Max render tiles time : "+this.max_renderTime+" ms",t+="<br>Max generate tiles time : "+this.max_generateTime+" ms",t+="<br>Max request tiles time : "+this.max_requestTime+" ms"),this.element&&("dom"===this.type?this.element.innerHTML=t:"jquery"===this.type&&this.element.html(t)),this.sum_globalRenderTime=0,this.sum_traverseTime=0,this.sum_renderTime=0,this.sum_generateTime=0,this.sum_requestTime=0,this.max_globalRenderTime=0,this.max_traverseTime=0,this.max_renderTime=0,this.max_generateTime=0,this.max_requestTime=0,this.numFrames=0}},t}),r("Context/ContextManager",["./ContextFactory","../Crs/CoordinateSystemFactory","../Utils/Stats"],function(t,e,i){var r=function(t){this.mizarAPI=t,this.skyContext=null,this.planetContext=null,this.activatedContext=null,this.renderContext=null};return r.prototype.subscribe=function(t,e){this.activatedContext.subscribe(t,e)},r.prototype.unsubscribe=function(t,e){this.activatedContext.unsubscribe(t,e)},r.prototype.getMode=function(){return this.activatedContext.getMode()},r.prototype.createContext=function(t,e){switch(e.renderContext=this.mizarAPI.getOptions().renderContext,t){case this.mizarAPI.CONTEXT.Sky:this.skyContext=this.mizarAPI.ContextFactory.create(this.mizarAPI.CONTEXT.Sky,this.mizarAPI.getOptions(),e),this.activatedContext=this.skyContext;break;case this.mizarAPI.CONTEXT.Planet:this.planetContext=this.mizarAPI.ContextFactory.create(this.mizarAPI.CONTEXT.Planet,this.mizarAPI.getOptions(),e),this.activatedContext=this.planetContext;break;default:throw RangeError("The contextMode "+t+" is not allowed, A valid contextMode is included in the list Constants.CONTEXT","ContextManager.js")}this.mizarAPI.getOptions().renderContext=this.activatedContext.globe.renderContext,this.mizarAPI.publish("mizarMode:toggle",this.activatedContext)},r.prototype.getSkyContext=function(){return this.skyContext},r.prototype.getPlanetContext=function(){return this.planetContext},r.prototype.getActivatedContext=function(){return this.activatedContext},r.prototype.refresh=function(){this.activatedContext.refresh()},r.prototype.getRenderContext=function(){return this.activatedContext.getRenderContext()},r.prototype.getCrs=function(){return this.activatedContext.getCoordinateSystem()},r.prototype.setCrs=function(t){var i=e.create(t);this.activatedContext.setCoordinateSystem(i)},r.prototype.addAnimation=function(t){this.activatedContext.addAnimation(t)},r.prototype.removeAnimation=function(t){this.activatedContext.removeAnimation(t)},r.prototype.render=function(){this.getRenderContext().frame()},r.prototype.dispose=function(){this.planetContext&&this.planetContext.dispose(),this.skyContext&&this.skyContext.dispose()},r.prototype.destroy=function(){this.planetContext&&this.planetContext.destroy(),this.skyContext&&this.skyContext.destroy(),this.planetContext=null,this.skyContext=null,this.activatedContext=null,this.renderContext=null},r.prototype.createStats=function(t){this.skyContext?this.Stats=new i(this.skyContext,t):this.planetContext?this.Stats=new i(this.planetContext,t):console.log("No context")},r.prototype.getScene=function(){return this.activatedContext.globe},r.prototype.toggleDimension=function(){if(this.getMode()!==this.mizarAPI.CONTEXT.Sky){if(this.activatedContext.getCoordinateSystem().isFlat()?void 0!==this.activatedContext._atmosphereLayer&&null!==this.activatedContext._atmosphereLayer.globe&&(this.activatedContext._atmosphereLayer.setVisible(this.activatedContext._saveAtmosphereVisible),this.render()):void 0!==this.activatedContext._atmosphereLayer&&null!==this.activatedContext._atmosphereLayer.globe&&(this.activatedContext._saveAtmosphereVisible=this.activatedContext._atmosphereLayer.visible,this.activatedContext._atmosphereLayer.setVisible(!1),this.render()),this.getCrs().isFlat())this.skyContext.enable(),this.setCrs({geoideName:this.getCrs().getGeoideName()}),this.planetContext.navigation.zoom(0);else{this.skyContext.disable();var t=this.activatedContext.navigation.getCenter();null!==t&&90-Math.abs(t[1])<=30?this.setCrs({geoideName:this.getCrs().getGeoideName(),projectionName:this.mizarAPI.PROJECTION.Azimuth,pole:Math.sign(t[1])>0?"north":"south"}):this.setCrs({geoideName:this.getCrs().getGeoideName(),projectionName:this.mizarAPI.PROJECTION.Plate})}this.render()}},r.prototype.setActivatedContext=function(t){switch(t){case this.mizarAPI.CONTEXT.Planet:this.planetContext?this.activatedContext=this.planetContext:console.log("Error");break;case this.mizarAPI.CONTEXT.Sky:this.skyContext?this.activatedContext=this.skyContext:console.log("Error");break;default:throw RangeError("The contextMode "+t+" is not allowed, A valid contextMode is included in the list Constants.CONTEXT","ContextManager.js")}this.mizarAPI.publish("mizarMode:toggle",this.activatedContext)},r.prototype.toggleContext=function(t,e,i){var r=this.getMode()===this.mizarAPI.CONTEXT.Sky?this.mizarAPI.CONTEXT.Planet:this.mizarAPI.CONTEXT.Sky,n=this;if(r===this.mizarAPI.CONTEXT.Sky)this.getActivatedContext().hide(),this.getActivatedContext().hideAdditionalLayers(),this.activatedContext=this.skyContext,this.planetContext.navigation.toViewMatrix(this._oldVM,this._oldFov,2e3,function(){n.getActivatedContext().showAdditionalLayers(),n.getScene().renderContext.tileErrorTreshold=1.5,n.mizarAPI.publish("mizarMode:toggle",n.activatedContext),n.planetContext.destroy(),n.getActivatedContext().show(),n.getScene().refresh(),n.getActivatedContext().getPositionTracker().attachTo(n.getScene())});else if(this.getActivatedContext().hide(),this.getActivatedContext().hideAdditionalLayers(),e.planetLayer=t,e.coordinateSystem=t.coordinateSystem,e.renderContext=this.getRenderContext(),e.renderContext.shadersPath="../../Mizar/shaders/",this.createContext(this.mizarAPI.CONTEXT.Planet,e),this.activatedContext=this.planetContext,this.getActivatedContext().credits=this.skyContext.credits,this._oldVM=this.getRenderContext().getViewMatrix(),this._oldFov=this.getRenderContext().getFov(),this.getActivatedContext().getCoordinateSystem().isFlat())this.getActivatedContext().show(),this.refresh(),this.mizarAPI.publish("mizarMode:toggle",n.activatedContext);else{var o=mat4.create();this.getNavigation().computeInverseViewMatrix(),mat4.inverse(this.getNavigation().inverseViewMatrix,o),this.getNavigation().toViewMatrix(o,90,2e3,function(){n.getActivatedContext().show(),n.refresh(),n.mizarAPI.publish("mizarMode:toggle",n.activatedContext)})}i&&i.call(n)},r.prototype.getNavigation=function(){return this.activatedContext.getNavigation()},r}),r("Mizar",["jquery","underscore-min","./Context/ContextFactory","./Navigation/NavigationFactory","./Layer/LayerFactory","./Layer/LayerManager","./Context/ContextManager","./Animation/AnimationFactory","./Utils/UtilityFactory","./Services/ServiceFactory","./Provider/ProviderFactory","./Utils/Utils","./Utils/Event","./Utils/Constants"],function(t,e,i,r,n,o,s,a,l,h,u,c,d,p){function f(t){var e={};if("undefined"==typeof t)throw new ReferenceError("No options found","Mizar.js");if("undefined"==typeof t.canvas)throw new ReferenceError("Canvas not defined","Mizar.js");return e={canvas:"string"==typeof t.canvas?document.getElementById(t.canvas):t.canvas},t.hasOwnProperty("configuration")&&(e.configuration=t.configuration),t.hasOwnProperty("skyContext")&&(e.skyContext=t.skyContext),t.hasOwnProperty("planetContext")&&(e.planetContext=t.planetContext),e}var g=function(t){d.prototype.constructor.call(this),this.options=f(t),this.ContextFactory=i,this.LayerFactory=n,this.AnimationFactory=a,this.ServiceFactory=h,this.UtilityFactory=l,this.ProviderFactory=u,this.layerManager=null,this.contextManager=new s(this),t.skyContext&&this.contextManager.createContext(this.CONTEXT.Sky,t.skyContext),t.planetContext&&this.contextManager.createContext(this.CONTEXT.Planet,t.planetContext)};return c.inherits(d,g),g.prototype.ANIMATION=p.ANIMATION,g.prototype.LAYER=p.LAYER,g.prototype.GEOMETRY=p.GEOMETRY,g.prototype.NAVIGATION=p.NAVIGATION,g.prototype.CONTEXT=p.CONTEXT,g.prototype.PROJECTION=p.PROJECTION,g.prototype.CRS=p.CRS,g.prototype.SERVICE=p.SERVICE,g.prototype.UTILITY=p.UTILITY,g.prototype.PROVIDER=p.PROVIDER,g.prototype.getServiceByName=function(t,e){return h.create(t,e)},g.prototype.getLayerManager=function(){return null===this.layerManager&&(this.layerManager=new o(this,this.options.hasOwnProperty("configuration")?this.options.configuration:{})),this.layerManager},g.prototype.getContextManager=function(){return this.contextManager},g.prototype.getNavigation=function(){return this.contextManager.getNavigation()},g.prototype.getOptions=function(){return this.options},g.prototype.destroy=function(){this.contextManager.destroy(),this.layerManager.destroy(),this.ContextFactory=null,this.LayerFactory=null,this.AnimationFactory=null,this.ServiceFactory=null,this.UtilityFactory=null},window.Mizar=g,g}),e("Mizar")});