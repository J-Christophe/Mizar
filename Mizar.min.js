/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! jQuery v3.2.1 | (c) JS Foundation and other contributors | jquery.org/license */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*******************************************************************************
 * Copyright 2017 CNES - CENTRE NATIONAL d'ETUDES SPATIALES
 *
 * This file is part of MIZAR.
 *
 * MIZAR is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * MIZAR is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with SITools2. If not, see <http://www.gnu.org/licenses/>.
 ******************************************************************************/

/***************************************
 * Copyright 2011, 2012 GlobWeb contributors.
 *
 * This file is part of GlobWeb.
 *
 * GlobWeb is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, version 3 of the License, or
 * (at your option) any later version.
 *
 * GlobWeb is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with GlobWeb. If not, see <http://www.gnu.org/licenses/>.
 ***************************************/

/**
         * AbstactLayer configuration
         * @typedef {Object} AbstractLayer.configuration
         * @property {String} [name=""] - Layer name
         * @property {String} [attribution=""] - Attribution
         * @property {String} [copyrightUrl=""] - Copyright URL
         * @property {String} [ack=""] - ack
         * @property {String} [icon=a default image] - An icon to represent the layer
         * @property {String} [description=""] - A description
         * @property {boolean} [visible=true] - A boolean flag to display the layer
         * @property {Object} [properties={}] properties
         * @property {boolean} [pickable=false] - Sets to true to make the layer pickable
         * @property {boolean} [service=[]] - List of services related to the layer
         * @property {GEOMETRY} dataType - the data type for vector layers
         * @property background
         * @property category
         * @param {Crs} coordinateSystem
         * @param {string} [format=""]
         * @param {string} [baseUrl=""]
         * @param {boolean} [deletable=""]
         * @param {Array} [color= a random color]
         * @param {float} [opacity=1.0] - An opacity value
         * @param {FeatureStyle} [style]
         * @param {Array} [availableServices=[]}
         * @param {layerCallback} callback - A callback that transfoms data.
         */

/**
         * @function getCopyrightUrl
         * @memberOf AbstractLayer#
         */

/*
 * Copyright (c) 2012 Brandon Jones, Colin MacKenzie IV
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */

/**
     * Hips data model
     * Mandatory, description, isMultiple, default value, distinctvalue, isArray
     * @namespace
     * HIPS_METADATA
     * @property {String} creator_did - Unique ID of the HiPS - Format: IVOID - Ex : ivo://CDS/P/2MASS/J
     * @property {String} [publisher_id] - Unique ID of the HiPS publisher – Format: IVOID - Ex : ivo://CDS
     * @property {String} [obs_collection] - Short name of original data set – Format: one word – Ex : 2MASS
     * @property {String} obs_title - Data set title – Format: free text, one line – Ex : HST F110W observations
     * @property {String} [obs_description] - Data set description – Format: free text, longer free text description of the dataset
     * @property {String} [obs_ack] - Acknowledgment mention"
     * @property {String} [prov_progenitor] - Provenance of the original data – Format: free text
     * @property {String} [bib_reference] - Bibliographic reference
     * @property {String} [bib_reference_url] - URL to bibliographic reference
     * @property {String} [obs_copyright] - Copyright mention – Format: free text
     * @property {String} [obs_copyright_url] - URL to a copyright mention
     * @property {GENERAL_WAVELENGTH} [obs_regime] - General wavelength
     * @property {String} [data_ucd] - UCD describing data contents
     * @property {String} hips_version="1.4" - Number of HiPS version – Format: number
     * @property {String} [hips_builder] - Name and version of the tool used for building the HiPS – Format: free text
     * @property {String} [hips_publisher] - Institute or person who built the HiPS – Format: free text – Ex : CDS (T.Boch)
     * @property {String} [hips_creation_date] - HiPS first creation date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ
     * @property {String} hips_release_date - Last HiPS update date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ
     * @property {String} [hips_service_url] - HiPS access url – Format: URL
     * @property {String} hips_status - HiPS status
     * @property {String} [hips_estsize] - HiPS size estimation – Format: positive integer – Unit : KB
     * @property {HIPS_FRAME} hips_frame - Coordinate frame reference
     * @property {int} hips_order - Deepest HiPS order – Format: positive integer
     * @property {int} [hips_tile_width=512] - Tiles width in pixels – Format: positive integer
     * @property {HIPS_TILE_FORMAT} hips_tile_format - List of available tile formats
     * @property {String} [hips_pixel_cut] - Suggested pixel display cut range (physical values) – Format: min max
     * @property {String} [hips_data_range] - Pixel data range taken into account during the HiPS generation (physical values) – Format: min max – Ex : -18.5 510.5
     * @property {SAMPLING} [hips_sampling] - Sampling applied for the HiPS generation
     * @property {PIXEL_OVERLAY} [hips_overlay] - Pixel composition method applied on the image overlay region during HiPS generation
     * @property {SKY_VAL} [hips_skyval] - Sky background subtraction method applied during HiPS generation
     * @property {String} [hips_pixel_bitpix] - Fits tile BITPIX code
     * @property {String} [data_pixel_bitpix] - Original data BITPIX code
     * @property {DATA_PRODUCT_TYPE} dataproduct_type - Type of data
     * @property {SUB_TYPE_DATA} [dataproduct_subtype] - Subtype of data
     * @property {String} [hips_progenitor_url] - URL to an associated progenitor HiPS
     * @property {int} [hips_cat_nrows] -  Number of rows of the HiPS catalog
     * @property {int} [hips_cube_depth] - Number of frames of the HiPS cube
     * @property {int} [hips_cube_firstframe=0] - Initial first index frame to display for a HiPS cube
     * @property {float} [data_cube_crpix3] - Coef for computing physical channel value
     * @property {float} [data_cube_crval3] - Coef for computing physical channel value
     * @property {float} [data_cube_cdelt3] - Coef for computing physical channel value
     * @property {String} [data_cube_bunit3] - Third axis unit
     * @property {float} [hips_initial_ra] - Default RA display position (ICRS frame) – Unit : degrees
     * @property {float} [hips_initial_dec] - Default DEC display position (ICRS frame) – Unit : degrees
     * @property {float} [hips_initial_fov] - Default display size – Unit : degrees
     * @property {float} [hips_pixel_scale] - HiPS pixel angular resolution at the highest order – Unit : degrees
     * @property {float} [s_pixel_scale] - Best pixel angular resolution of the original images – Unit : degrees
     * @property {float} [t_min] - Start time of the observations - Representation: MJD
     * @property {float} [t_max] - Stop time of the observations - Representation: MJD
     * @property {float} [em_min] - Start in spectral coordinates – Unit: meters
     * @property {float} [em_max] - Stop in spectral coordinates – Unit: meters
     * @property {String} [client_category] - / separated keywords suggesting a display hierarchy to the client – Ex : Image/InfraRed
     * @property {String} [client_sort_key] - Sort key suggesting a display order to the client inside a client_category – Sort : alphanumeric
     * @property {String} [addendum_did] - In case of “live” HiPS, creator_did of the added HiPS
     * @property {float} [moc_sky_fraction] - Fraction of the sky covers by the MOC associated to the HiPS – Format: real between 0 and 1
     */

/**
         * AbstractHipsLayer configuration
         * @typedef {AbstractLayer.configuration} AbstractHipsLayer.configuration
         * @property {Crs} [coordinateSystem = CoordinateSystemFactory.create({geoideName: Constants.MappingCrsHips2Mizar[this.hipsMetadata.hips_frame]})] - Coordinate reference system
         * @property {int} [tilePixelSize = hipsMetadata['hips_tile_width'] - Tiles width in pixels
         * @property {int} [baseLevel = 2] - min HiPS order
         * @property {HEALPixTiling} [tiling = new HEALPixTiling(options.baseLevel, {coordinateSystem: options.coordinateSystem})] - Tiling
         * @property {int} [numberOfLevels = hipsMetadata['hips_order']] - Deepest order min
         * @property {string} [name = hipsMetadata['obs_title']] - Data set title
         * @property {string} [attribution = <a href=\"" + this.hipsMetadata['obs_copyright_url'] + "\" target=\"_blank\">" + this.hipsMetadata['obs_copyright'] + "</a>"] - URL to a copyright mention
         * @property {string} [ack = hipsMetadata['obs_ack']] - Acknowledgment mention
         * @property {string} [icon = ""] - icon used as metadata representation on the map
         * @property {string} [description = hipsMetadata['obs_description']] - Data set description
         * @property {boolean} [visible = false] visibility by default on the map
         * @property {Object} properties - other metadata
         * @property {float} [properties.initialRa = undefined] - Initial RA
         * @property {float} [properties.initialDec = undefined] - Initial DEC
         * @property {float} [properties.initialFov = undefined] - Initial field of view
         * @property {float} [properties.mocCoverage = undefined] - Sky fraction coverage
         * @property {boolean} [pickable = false] - Pickable layer
         * @property {Array} [availableServices = {}] - List of services related to the layer
         * @property {Array} [format = hipsMetadata['hips_tile_format']] - List of available tile formats
         * @property {string} [baseUrl =  hipsMetadata['hips_service_url']] - Endpoint service
         * @property {string} [category = Image] - Default category
         * @property {boolean} background - Tell if the layer is set as background         
         */

/*! jQuery UI - v1.12.1 - 2016-09-14
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

/*!

JSZip v3.1.3 - A Javascript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

/*******************************************************************************
 * Copyright 2012-2015 CNES - CENTRE NATIONAL d'ETUDES SPATIALES
 *
 * This file is part of SITools2.
 *
 * SITools2 is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * SITools2 is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with SITools2. If not, see <http://www.gnu.org/licenses/>.
 ******************************************************************************/

// Adding a copyright file into each folder

/*******************************************************************************
 * Copyright 2016 - Jean-Christophe Malapert
 *
 * This file is part of JsVotable.
 *
 * JsVotable is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * JsVotable is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with JVotable.  If not, see <http://www.gnu.org/licenses/>.
 ******************************************************************************/

/***************************************
 * Copyright 2011, 2012 GlobWeb contributors.
 *
 * This file is part of GlobWeb.
 *
 * GlobWeb is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, version 3 of the License, or
 * (at your option) any later version.
 *
 * GlobWeb is distributered in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with GlobWeb. If not, see <http://www.gnu.org/licenses/>.
 ***************************************/

!function(t,e){"function"==typeof define&&define.amd?define([],e):t.libGlobalName=e()}(this,function(){var t,e,r;!function(i){function n(t,e){return x.call(t,e)}function s(t,e){var i,r,n,s,o,a,l,h,u,c,d=e&&e.split("/"),p=y.map,f=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=d.concat(t.split("/")),h=0;h<t.length;h+=1)if(c=t[h],"."===c)t.splice(h,1),h-=1;else if(".."===c){if(1===h&&(".."===t[2]||".."===t[0]))break;h>0&&(t.splice(h-1,2),h-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||f)&&p){for(i=t.split("/"),h=i.length;h>0;h-=1){if(r=i.slice(0,h).join("/"),d)for(u=d.length;u>0;u-=1)if(n=p[d.slice(0,u).join("/")],n&&(n=n[r])){s=n,o=h;break}if(s)break;!a&&f&&f[r]&&(a=f[r],l=h)}!s&&a&&(s=a,o=l),s&&(i.splice(0,o,s),t=i.join("/"))}return t}function o(t,e){return function(){return p.apply(i,_.call(arguments,0).concat([t,e]))}}function a(t){return function(e){return s(e,t)}}function l(t){return function(e){m[t]=e}}function h(t){if(n(v,t)){var e=v[t];delete v[t],b[t]=!0,d.apply(i,e)}if(!n(m,t)&&!n(b,t))throw new Error("No "+t);return m[t]}function u(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function c(t){return function(){return y&&y.config&&y.config[t]||{}}}var d,p,f,g,m={},v={},y={},b={},x=Object.prototype.hasOwnProperty,_=[].slice;f=function(t,e){var i,r=u(t),n=r[0];return t=r[1],n&&(n=s(n,e),i=h(n)),n?t=i&&i.normalize?i.normalize(t,a(e)):s(t,e):(t=s(t,e),r=u(t),n=r[0],t=r[1],n&&(i=h(n))),{f:n?n+"!"+t:t,n:t,pr:n,p:i}},g={require:function(t){return o(t)},exports:function(t){var e=m[t];return"undefined"!=typeof e?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:c(t)}}},d=function(t,e,r,s){var a,u,c,d,p,y,x=[];if(s=s||t,"function"==typeof r){for(e=!e.length&&r.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(d=f(e[p],s),u=d.f,"require"===u)x[p]=g.require(t);else if("exports"===u)x[p]=g.exports(t),y=!0;else if("module"===u)a=x[p]=g.module(t);else if(n(m,u)||n(v,u)||n(b,u))x[p]=h(u);else{if(!d.p)throw new Error(t+" missing "+u);d.p.load(d.n,o(s,!0),l(u),{}),x[p]=m[u]}c=r.apply(m[t],x),t&&(a&&a.exports!==i&&a.exports!==m[t]?m[t]=a.exports:c===i&&y||(m[t]=c))}else t&&(m[t]=r)},t=e=p=function(t,e,r,n,s){return"string"==typeof t?g[t]?g[t](e):h(f(t,e).f):(t.splice||(y=t,e.splice?(t=e,e=r,r=null):t=i),e=e||function(){},"function"==typeof r&&(r=n,n=s),n?d(i,t,e,r):setTimeout(function(){d(i,t,e,r)},4),p)},p.config=function(t){return y=t,y.deps&&p(y.deps,y.callback),p},r=function(t,e,i){e.splice||(i=e,e=[]),n(m,t)||n(v,t)||(v[t]=[t,e,i])},r.amd={jQuery:!0}}(),r("../build/almond",function(){}),!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function i(t,e){e=e||rt;var i=e.createElement("script");i.text=t,e.head.appendChild(i).parentNode.removeChild(i)}function n(t){var e=!!t&&"length"in t&&t.length,i=mt.type(t);return"function"!==i&&!mt.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function s(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}function o(t,e,i){return mt.isFunction(e)?mt.grep(t,function(t,r){return!!e.call(t,r,t)!==i}):e.nodeType?mt.grep(t,function(t){return t===e!==i}):"string"!=typeof e?mt.grep(t,function(t){return lt.call(e,t)>-1!==i}):It.test(e)?mt.filter(e,t,i):(e=mt.filter(e,t),mt.grep(t,function(t){return lt.call(e,t)>-1!==i&&1===t.nodeType}))}function a(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function l(t){var e={};return mt.each(t.match(Rt)||[],function(t,i){e[i]=!0}),e}function h(t){return t}function u(t){throw t}function c(t,e,i,r){var n;try{t&&mt.isFunction(n=t.promise)?n.call(t).done(e).fail(i):t&&mt.isFunction(n=t.then)?n.call(t,e,i):e.apply(void 0,[t].slice(r))}catch(t){i.apply(void 0,[t])}}function d(){rt.removeEventListener("DOMContentLoaded",d),t.removeEventListener("load",d),mt.ready()}function p(){this.expando=mt.expando+p.uid++}function f(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:Ut.test(t)?JSON.parse(t):t)}function g(t,e,i){var r;if(void 0===i&&1===t.nodeType)if(r="data-"+e.replace(zt,"-$&").toLowerCase(),i=t.getAttribute(r),"string"==typeof i){try{i=f(i)}catch(t){}Bt.set(t,e,i)}else i=void 0;return i}function m(t,e,i,r){var n,s=1,o=20,a=r?function(){return r.cur()}:function(){return mt.css(t,e,"")},l=a(),h=i&&i[3]||(mt.cssNumber[e]?"":"px"),u=(mt.cssNumber[e]||"px"!==h&&+l)&&Gt.exec(mt.css(t,e));if(u&&u[3]!==h){h=h||u[3],i=i||[],u=+l||1;do s=s||".5",u/=s,mt.style(t,e,u+h);while(s!==(s=a()/l)&&1!==s&&--o)}return i&&(u=+u||+l||0,n=i[1]?u+(i[1]+1)*i[2]:+i[2],r&&(r.unit=h,r.start=u,r.end=n)),n}function v(t){var e,i=t.ownerDocument,r=t.nodeName,n=Vt[r];return n?n:(e=i.body.appendChild(i.createElement(r)),n=mt.css(e,"display"),e.parentNode.removeChild(e),"none"===n&&(n="block"),Vt[r]=n,n)}function y(t,e){for(var i,r,n=[],s=0,o=t.length;s<o;s++)r=t[s],r.style&&(i=r.style.display,e?("none"===i&&(n[s]=Ot.get(r,"display")||null,n[s]||(r.style.display="")),""===r.style.display&&Wt(r)&&(n[s]=v(r))):"none"!==i&&(n[s]="none",Ot.set(r,"display",i)));for(s=0;s<o;s++)null!=n[s]&&(t[s].style.display=n[s]);return t}function b(t,e){var i;return i="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e||"*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&s(t,e)?mt.merge([t],i):i}function x(t,e){for(var i=0,r=t.length;i<r;i++)Ot.set(t[i],"globalEval",!e||Ot.get(e[i],"globalEval"))}function _(t,e,i,r,n){for(var s,o,a,l,h,u,c=e.createDocumentFragment(),d=[],p=0,f=t.length;p<f;p++)if(s=t[p],s||0===s)if("object"===mt.type(s))mt.merge(d,s.nodeType?[s]:s);else if(Jt.test(s)){for(o=o||c.appendChild(e.createElement("div")),a=(Xt.exec(s)||["",""])[1].toLowerCase(),l=Kt[a]||Kt._default,o.innerHTML=l[1]+mt.htmlPrefilter(s)+l[2],u=l[0];u--;)o=o.lastChild;mt.merge(d,o.childNodes),o=c.firstChild,o.textContent=""}else d.push(e.createTextNode(s));for(c.textContent="",p=0;s=d[p++];)if(r&&mt.inArray(s,r)>-1)n&&n.push(s);else if(h=mt.contains(s.ownerDocument,s),o=b(c.appendChild(s),"script"),h&&x(o),i)for(u=0;s=o[u++];)Zt.test(s.type||"")&&i.push(s);return c}function w(){return!0}function C(){return!1}function T(){try{return rt.activeElement}catch(t){}}function A(t,e,i,r,n,s){var o,a;if("object"==typeof e){"string"!=typeof i&&(r=r||i,i=void 0);for(a in e)A(t,a,i,r,e[a],s);return t}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),n===!1)n=C;else if(!n)return t;return 1===s&&(o=n,n=function(t){return mt().off(t),o.apply(this,arguments)},n.guid=o.guid||(o.guid=mt.guid++)),t.each(function(){mt.event.add(this,e,n,r,i)})}function I(t,e){return s(t,"table")&&s(11!==e.nodeType?e:e.firstChild,"tr")?mt(">tbody",t)[0]||t:t}function S(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function M(t){var e=se.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function k(t,e){var i,r,n,s,o,a,l,h;if(1===e.nodeType){if(Ot.hasData(t)&&(s=Ot.access(t),o=Ot.set(e,s),h=s.events)){delete o.handle,o.events={};for(n in h)for(i=0,r=h[n].length;i<r;i++)mt.event.add(e,n,h[n][i])}Bt.hasData(t)&&(a=Bt.access(t),l=mt.extend({},a),Bt.set(e,l))}}function E(t,e){var i=e.nodeName.toLowerCase();"input"===i&&qt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function P(t,e,r,n){e=ot.apply([],e);var s,o,a,l,h,u,c=0,d=t.length,p=d-1,f=e[0],g=mt.isFunction(f);if(g||d>1&&"string"==typeof f&&!ft.checkClone&&ne.test(f))return t.each(function(i){var s=t.eq(i);g&&(e[0]=f.call(this,i,s.html())),P(s,e,r,n)});if(d&&(s=_(e,t[0].ownerDocument,!1,t,n),o=s.firstChild,1===s.childNodes.length&&(s=o),o||n)){for(a=mt.map(b(s,"script"),S),l=a.length;c<d;c++)h=s,c!==p&&(h=mt.clone(h,!0,!0),l&&mt.merge(a,b(h,"script"))),r.call(t[c],h,c);if(l)for(u=a[a.length-1].ownerDocument,mt.map(a,M),c=0;c<l;c++)h=a[c],Zt.test(h.type||"")&&!Ot.access(h,"globalEval")&&mt.contains(u,h)&&(h.src?mt._evalUrl&&mt._evalUrl(h.src):i(h.textContent.replace(oe,""),u))}return t}function R(t,e,i){for(var r,n=e?mt.filter(e,t):t,s=0;null!=(r=n[s]);s++)i||1!==r.nodeType||mt.cleanData(b(r)),r.parentNode&&(i&&mt.contains(r.ownerDocument,r)&&x(b(r,"script")),r.parentNode.removeChild(r));return t}function D(t,e,i){var r,n,s,o,a=t.style;return i=i||he(t),i&&(o=i.getPropertyValue(e)||i[e],""!==o||mt.contains(t.ownerDocument,t)||(o=mt.style(t,e)),!ft.pixelMarginRight()&&le.test(o)&&ae.test(e)&&(r=a.width,n=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=r,a.minWidth=n,a.maxWidth=s)),void 0!==o?o+"":o}function N(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function L(t){if(t in ge)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=fe.length;i--;)if(t=fe[i]+e,t in ge)return t}function F(t){var e=mt.cssProps[t];return e||(e=mt.cssProps[t]=L(t)||t),e}function O(t,e,i){var r=Gt.exec(e);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):e}function B(t,e,i,r,n){var s,o=0;for(s=i===(r?"border":"content")?4:"width"===e?1:0;s<4;s+=2)"margin"===i&&(o+=mt.css(t,i+Ht[s],!0,n)),r?("content"===i&&(o-=mt.css(t,"padding"+Ht[s],!0,n)),"margin"!==i&&(o-=mt.css(t,"border"+Ht[s]+"Width",!0,n))):(o+=mt.css(t,"padding"+Ht[s],!0,n),"padding"!==i&&(o+=mt.css(t,"border"+Ht[s]+"Width",!0,n)));return o}function U(t,e,i){var r,n=he(t),s=D(t,e,n),o="border-box"===mt.css(t,"boxSizing",!1,n);return le.test(s)?s:(r=o&&(ft.boxSizingReliable()||s===t.style[e]),"auto"===s&&(s=t["offset"+e[0].toUpperCase()+e.slice(1)]),s=parseFloat(s)||0,s+B(t,e,i||(o?"border":"content"),r,n)+"px")}function z(t,e,i,r,n){return new z.prototype.init(t,e,i,r,n)}function j(){ve&&(rt.hidden===!1&&t.requestAnimationFrame?t.requestAnimationFrame(j):t.setTimeout(j,mt.fx.interval),mt.fx.tick())}function G(){return t.setTimeout(function(){me=void 0}),me=mt.now()}function H(t,e){var i,r=0,n={height:t};for(e=e?1:0;r<4;r+=2-e)i=Ht[r],n["margin"+i]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function W(t,e,i){for(var r,n=(q.tweeners[e]||[]).concat(q.tweeners["*"]),s=0,o=n.length;s<o;s++)if(r=n[s].call(i,e,t))return r}function Y(t,e,i){var r,n,s,o,a,l,h,u,c="width"in e||"height"in e,d=this,p={},f=t.style,g=t.nodeType&&Wt(t),m=Ot.get(t,"fxshow");i.queue||(o=mt._queueHooks(t,"fx"),null==o.unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,d.always(function(){d.always(function(){o.unqueued--,mt.queue(t,"fx").length||o.empty.fire()})}));for(r in e)if(n=e[r],ye.test(n)){if(delete e[r],s=s||"toggle"===n,n===(g?"hide":"show")){if("show"!==n||!m||void 0===m[r])continue;g=!0}p[r]=m&&m[r]||mt.style(t,r)}if(l=!mt.isEmptyObject(e),l||!mt.isEmptyObject(p)){c&&1===t.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],h=m&&m.display,null==h&&(h=Ot.get(t,"display")),u=mt.css(t,"display"),"none"===u&&(h?u=h:(y([t],!0),h=t.style.display||h,u=mt.css(t,"display"),y([t]))),("inline"===u||"inline-block"===u&&null!=h)&&"none"===mt.css(t,"float")&&(l||(d.done(function(){f.display=h}),null==h&&(u=f.display,h="none"===u?"":u)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",d.always(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]})),l=!1;for(r in p)l||(m?"hidden"in m&&(g=m.hidden):m=Ot.access(t,"fxshow",{display:h}),s&&(m.hidden=!g),g&&y([t],!0),d.done(function(){g||y([t]),Ot.remove(t,"fxshow");for(r in p)mt.style(t,r,p[r])})),l=W(g?m[r]:0,r,d),r in m||(m[r]=l.start,g&&(l.end=l.start,l.start=0))}}function V(t,e){var i,r,n,s,o;for(i in t)if(r=mt.camelCase(i),n=e[r],s=t[i],Array.isArray(s)&&(n=s[1],s=t[i]=s[0]),i!==r&&(t[r]=s,delete t[i]),o=mt.cssHooks[r],o&&"expand"in o){s=o.expand(s),delete t[r];for(i in s)i in t||(t[i]=s[i],e[i]=n)}else e[r]=n}function q(t,e,i){var r,n,s=0,o=q.prefilters.length,a=mt.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var e=me||G(),i=Math.max(0,h.startTime+h.duration-e),r=i/h.duration||0,s=1-r,o=0,l=h.tweens.length;o<l;o++)h.tweens[o].run(s);return a.notifyWith(t,[h,s,i]),s<1&&l?i:(l||a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:mt.extend({},e),opts:mt.extend(!0,{specialEasing:{},easing:mt.easing._default},i),originalProperties:e,originalOptions:i,startTime:me||G(),duration:i.duration,tweens:[],createTween:function(e,i){var r=mt.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(r),r},stop:function(e){var i=0,r=e?h.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)h.tweens[i].run(1);return e?(a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h,e])):a.rejectWith(t,[h,e]),this}}),u=h.props;for(V(u,h.opts.specialEasing);s<o;s++)if(r=q.prefilters[s].call(h,t,u,h.opts))return mt.isFunction(r.stop)&&(mt._queueHooks(h.elem,h.opts.queue).stop=mt.proxy(r.stop,r)),r;return mt.map(u,W,h),mt.isFunction(h.opts.start)&&h.opts.start.call(t,h),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always),mt.fx.timer(mt.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h}function X(t){var e=t.match(Rt)||[];return e.join(" ")}function Z(t){return t.getAttribute&&t.getAttribute("class")||""}function K(t,e,i,r){var n;if(Array.isArray(e))mt.each(e,function(e,n){i||ke.test(t)?r(t,n):K(t+"["+("object"==typeof n&&null!=n?e:"")+"]",n,i,r)});else if(i||"object"!==mt.type(e))r(t,e);else for(n in e)K(t+"["+n+"]",e[n],i,r)}function J(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var r,n=0,s=e.toLowerCase().match(Rt)||[];if(mt.isFunction(i))for(;r=s[n++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(i)):(t[r]=t[r]||[]).push(i)}}function Q(t,e,i,r){function n(a){var l;return s[a]=!0,mt.each(t[a]||[],function(t,a){var h=a(e,i,r);return"string"!=typeof h||o||s[h]?o?!(l=h):void 0:(e.dataTypes.unshift(h),n(h),!1)}),l}var s={},o=t===je;return n(e.dataTypes[0])||!s["*"]&&n("*")}function $(t,e){var i,r,n=mt.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((n[i]?t:r||(r={}))[i]=e[i]);return r&&mt.extend(!0,t,r),t}function tt(t,e,i){for(var r,n,s,o,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(n in a)if(a[n]&&a[n].test(r)){l.unshift(n);break}if(l[0]in i)s=l[0];else{for(n in i){if(!l[0]||t.converters[n+" "+l[0]]){s=n;break}o||(o=n)}s=s||o}if(s)return s!==l[0]&&l.unshift(s),i[s]}function et(t,e,i,r){var n,s,o,a,l,h={},u=t.dataTypes.slice();if(u[1])for(o in t.converters)h[o.toLowerCase()]=t.converters[o];for(s=u.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!l&&r&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=s,s=u.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(o=h[l+" "+s]||h["* "+s],!o)for(n in h)if(a=n.split(" "),a[1]===s&&(o=h[l+" "+a[0]]||h["* "+a[0]])){o===!0?o=h[n]:h[n]!==!0&&(s=a[0],u.unshift(a[1]));break}if(o!==!0)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+l+" to "+s}}}return{state:"success",data:e}}var it=[],rt=t.document,nt=Object.getPrototypeOf,st=it.slice,ot=it.concat,at=it.push,lt=it.indexOf,ht={},ut=ht.toString,ct=ht.hasOwnProperty,dt=ct.toString,pt=dt.call(Object),ft={},gt="3.2.1",mt=function(t,e){return new mt.fn.init(t,e)},vt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,yt=/^-ms-/,bt=/-([a-z])/g,xt=function(t,e){return e.toUpperCase()};mt.fn=mt.prototype={jquery:gt,constructor:mt,length:0,toArray:function(){return st.call(this)},get:function(t){return null==t?st.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=mt.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return mt.each(this,t)},map:function(t){return this.pushStack(mt.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(st.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:at,sort:it.sort,splice:it.splice},mt.extend=mt.fn.extend=function(){var t,e,i,r,n,s,o=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof o&&(h=o,o=arguments[a]||{},a++),"object"==typeof o||mt.isFunction(o)||(o={}),a===l&&(o=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)i=o[e],r=t[e],o!==r&&(h&&r&&(mt.isPlainObject(r)||(n=Array.isArray(r)))?(n?(n=!1,s=i&&Array.isArray(i)?i:[]):s=i&&mt.isPlainObject(i)?i:{},o[e]=mt.extend(h,s,r)):void 0!==r&&(o[e]=r));return o},mt.extend({expando:"jQuery"+(gt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===mt.type(t)},isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=mt.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==ut.call(t)||(e=nt(t))&&(i=ct.call(e,"constructor")&&e.constructor,"function"!=typeof i||dt.call(i)!==pt))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?ht[ut.call(t)]||"object":typeof t},globalEval:function(t){i(t)},camelCase:function(t){return t.replace(yt,"ms-").replace(bt,xt)},each:function(t,e){var i,r=0;if(n(t))for(i=t.length;r<i&&e.call(t[r],r,t[r])!==!1;r++);else for(r in t)if(e.call(t[r],r,t[r])===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(vt,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(n(Object(t))?mt.merge(i,"string"==typeof t?[t]:t):at.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:lt.call(e,t,i)},merge:function(t,e){for(var i=+e.length,r=0,n=t.length;r<i;r++)t[n++]=e[r];return t.length=n,t},grep:function(t,e,i){for(var r,n=[],s=0,o=t.length,a=!i;s<o;s++)r=!e(t[s],s),r!==a&&n.push(t[s]);return n},map:function(t,e,i){var r,s,o=0,a=[];if(n(t))for(r=t.length;o<r;o++)s=e(t[o],o,i),null!=s&&a.push(s);else for(o in t)s=e(t[o],o,i),null!=s&&a.push(s);return ot.apply([],a)},guid:1,proxy:function(t,e){var i,r,n;if("string"==typeof e&&(i=t[e],e=t,t=i),mt.isFunction(t))return r=st.call(arguments,2),n=function(){return t.apply(e||this,r.concat(st.call(arguments)))},n.guid=t.guid=t.guid||mt.guid++,n},now:Date.now,support:ft}),"function"==typeof Symbol&&(mt.fn[Symbol.iterator]=it[Symbol.iterator]),mt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){ht["[object "+e+"]"]=e.toLowerCase()});var _t=function(t){function e(t,e,i,r){var n,s,o,a,l,h,u,d=e&&e.ownerDocument,f=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==f&&9!==f&&11!==f)return i;if(!r&&((e?e.ownerDocument||e:j)!==D&&R(e),e=e||D,L)){if(11!==f&&(l=vt.exec(t)))if(n=l[1]){if(9===f){if(!(o=e.getElementById(n)))return i;if(o.id===n)return i.push(o),i}else if(d&&(o=d.getElementById(n))&&U(e,o)&&o.id===n)return i.push(o),i}else{if(l[2])return Q.apply(i,e.getElementsByTagName(t)),i;if((n=l[3])&&w.getElementsByClassName&&e.getElementsByClassName)return Q.apply(i,e.getElementsByClassName(n)),i}if(w.qsa&&!V[t+" "]&&(!F||!F.test(t))){if(1!==f)d=e,u=t;else if("object"!==e.nodeName.toLowerCase()){for((a=e.getAttribute("id"))?a=a.replace(_t,wt):e.setAttribute("id",a=z),h=I(t),s=h.length;s--;)h[s]="#"+a+" "+p(h[s]);u=h.join(","),d=yt.test(t)&&c(e.parentNode)||e}if(u)try{return Q.apply(i,d.querySelectorAll(u)),i}catch(t){}finally{a===z&&e.removeAttribute("id")}}}return M(t.replace(at,"$1"),e,i,r)}function i(){function t(i,r){return e.push(i+" ")>C.cacheLength&&delete t[e.shift()],t[i+" "]=r}var e=[];return t}function r(t){return t[z]=!0,t}function n(t){var e=D.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function s(t,e){for(var i=t.split("|"),r=i.length;r--;)C.attrHandle[i[r]]=e}function o(t,e){var i=e&&t,r=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(r)return r;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function l(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function h(t){return function(e){return"form"in e?e.parentNode&&e.disabled===!1?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Tt(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function u(t){return r(function(e){return e=+e,r(function(i,r){for(var n,s=t([],i.length,e),o=s.length;o--;)i[n=s[o]]&&(i[n]=!(r[n]=i[n]))})})}function c(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function d(){}function p(t){for(var e=0,i=t.length,r="";e<i;e++)r+=t[e].value;return r}function f(t,e,i){var r=e.dir,n=e.next,s=n||r,o=i&&"parentNode"===s,a=H++;return e.first?function(e,i,n){for(;e=e[r];)if(1===e.nodeType||o)return t(e,i,n);return!1}:function(e,i,l){var h,u,c,d=[G,a];if(l){for(;e=e[r];)if((1===e.nodeType||o)&&t(e,i,l))return!0}else for(;e=e[r];)if(1===e.nodeType||o)if(c=e[z]||(e[z]={}),u=c[e.uniqueID]||(c[e.uniqueID]={}),n&&n===e.nodeName.toLowerCase())e=e[r]||e;else{if((h=u[s])&&h[0]===G&&h[1]===a)return d[2]=h[2];if(u[s]=d,d[2]=t(e,i,l))return!0}return!1}}function g(t){return t.length>1?function(e,i,r){for(var n=t.length;n--;)if(!t[n](e,i,r))return!1;return!0}:t[0]}function m(t,i,r){for(var n=0,s=i.length;n<s;n++)e(t,i[n],r);return r}function v(t,e,i,r,n){for(var s,o=[],a=0,l=t.length,h=null!=e;a<l;a++)(s=t[a])&&(i&&!i(s,r,n)||(o.push(s),h&&e.push(a)));return o}function y(t,e,i,n,s,o){return n&&!n[z]&&(n=y(n)),s&&!s[z]&&(s=y(s,o)),r(function(r,o,a,l){var h,u,c,d=[],p=[],f=o.length,g=r||m(e||"*",a.nodeType?[a]:a,[]),y=!t||!r&&e?g:v(g,d,t,a,l),b=i?s||(r?t:f||n)?[]:o:y;if(i&&i(y,b,a,l),n)for(h=v(b,p),n(h,[],a,l),u=h.length;u--;)(c=h[u])&&(b[p[u]]=!(y[p[u]]=c));if(r){if(s||t){if(s){for(h=[],u=b.length;u--;)(c=b[u])&&h.push(y[u]=c);s(null,b=[],h,l)}for(u=b.length;u--;)(c=b[u])&&(h=s?tt(r,c):d[u])>-1&&(r[h]=!(o[h]=c))}}else b=v(b===o?b.splice(f,b.length):b),s?s(null,o,b,l):Q.apply(o,b)})}function b(t){for(var e,i,r,n=t.length,s=C.relative[t[0].type],o=s||C.relative[" "],a=s?1:0,l=f(function(t){return t===e},o,!0),h=f(function(t){return tt(e,t)>-1},o,!0),u=[function(t,i,r){var n=!s&&(r||i!==k)||((e=i).nodeType?l(t,i,r):h(t,i,r));return e=null,n}];a<n;a++)if(i=C.relative[t[a].type])u=[f(g(u),i)];else{if(i=C.filter[t[a].type].apply(null,t[a].matches),i[z]){for(r=++a;r<n&&!C.relative[t[r].type];r++);return y(a>1&&g(u),a>1&&p(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(at,"$1"),i,a<r&&b(t.slice(a,r)),r<n&&b(t=t.slice(r)),r<n&&p(t))}u.push(i)}return g(u)}function x(t,i){var n=i.length>0,s=t.length>0,o=function(r,o,a,l,h){var u,c,d,p=0,f="0",g=r&&[],m=[],y=k,b=r||s&&C.find.TAG("*",h),x=G+=null==y?1:Math.random()||.1,_=b.length;for(h&&(k=o===D||o||h);f!==_&&null!=(u=b[f]);f++){if(s&&u){for(c=0,o||u.ownerDocument===D||(R(u),a=!L);d=t[c++];)if(d(u,o||D,a)){l.push(u);break}h&&(G=x)}n&&((u=!d&&u)&&p--,r&&g.push(u))}if(p+=f,n&&f!==p){for(c=0;d=i[c++];)d(g,m,o,a);if(r){if(p>0)for(;f--;)g[f]||m[f]||(m[f]=K.call(l));m=v(m)}Q.apply(l,m),h&&!r&&m.length>0&&p+i.length>1&&e.uniqueSort(l)}return h&&(G=x,k=y),g};return n?r(o):o}var _,w,C,T,A,I,S,M,k,E,P,R,D,N,L,F,O,B,U,z="sizzle"+1*new Date,j=t.document,G=0,H=0,W=i(),Y=i(),V=i(),q=function(t,e){return t===e&&(P=!0),0},X={}.hasOwnProperty,Z=[],K=Z.pop,J=Z.push,Q=Z.push,$=Z.slice,tt=function(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",rt="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",nt="\\["+it+"*("+rt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+rt+"))|)"+it+"*\\]",st=":("+rt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+nt+")*)|.*)\\)|)",ot=new RegExp(it+"+","g"),at=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),lt=new RegExp("^"+it+"*,"+it+"*"),ht=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ut=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),ct=new RegExp(st),dt=new RegExp("^"+rt+"$"),pt={ID:new RegExp("^#("+rt+")"),CLASS:new RegExp("^\\.("+rt+")"),TAG:new RegExp("^("+rt+"|[*])"),ATTR:new RegExp("^"+nt),PSEUDO:new RegExp("^"+st),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},ft=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,mt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yt=/[+~]/,bt=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),xt=function(t,e,i){var r="0x"+e-65536;return r!==r||i?e:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},_t=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,wt=function(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},Ct=function(){R()},Tt=f(function(t){return t.disabled===!0&&("form"in t||"label"in t)},{dir:"parentNode",next:"legend"});try{Q.apply(Z=$.call(j.childNodes),j.childNodes),Z[j.childNodes.length].nodeType}catch(t){Q={apply:Z.length?function(t,e){J.apply(t,$.call(e))}:function(t,e){for(var i=t.length,r=0;t[i++]=e[r++];);t.length=i-1}}}w=e.support={},A=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},R=e.setDocument=function(t){var e,i,r=t?t.ownerDocument||t:j;return r!==D&&9===r.nodeType&&r.documentElement?(D=r,N=D.documentElement,L=!A(D),j!==D&&(i=D.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",Ct,!1):i.attachEvent&&i.attachEvent("onunload",Ct)),w.attributes=n(function(t){return t.className="i",!t.getAttribute("className")}),w.getElementsByTagName=n(function(t){return t.appendChild(D.createComment("")),!t.getElementsByTagName("*").length}),w.getElementsByClassName=mt.test(D.getElementsByClassName),w.getById=n(function(t){return N.appendChild(t).id=z,!D.getElementsByName||!D.getElementsByName(z).length}),w.getById?(C.filter.ID=function(t){var e=t.replace(bt,xt);return function(t){return t.getAttribute("id")===e}},C.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&L){var i=e.getElementById(t);return i?[i]:[]}}):(C.filter.ID=function(t){var e=t.replace(bt,xt);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},C.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&L){var i,r,n,s=e.getElementById(t);if(s){if(i=s.getAttributeNode("id"),i&&i.value===t)return[s];for(n=e.getElementsByName(t),r=0;s=n[r++];)if(i=s.getAttributeNode("id"),i&&i.value===t)return[s]}return[]}}),C.find.TAG=w.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):w.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,r=[],n=0,s=e.getElementsByTagName(t);if("*"===t){for(;i=s[n++];)1===i.nodeType&&r.push(i);return r}return s},C.find.CLASS=w.getElementsByClassName&&function(t,e){if("undefined"!=typeof e.getElementsByClassName&&L)return e.getElementsByClassName(t)},O=[],F=[],(w.qsa=mt.test(D.querySelectorAll))&&(n(function(t){N.appendChild(t).innerHTML="<a id='"+z+"'></a><select id='"+z+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&F.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||F.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+z+"-]").length||F.push("~="),t.querySelectorAll(":checked").length||F.push(":checked"),t.querySelectorAll("a#"+z+"+*").length||F.push(".#.+[+~]")}),n(function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=D.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&F.push("name"+it+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&F.push(":enabled",":disabled"),N.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&F.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),F.push(",.*:")})),(w.matchesSelector=mt.test(B=N.matches||N.webkitMatchesSelector||N.mozMatchesSelector||N.oMatchesSelector||N.msMatchesSelector))&&n(function(t){w.disconnectedMatch=B.call(t,"*"),B.call(t,"[s!='']:x"),O.push("!=",st)}),F=F.length&&new RegExp(F.join("|")),O=O.length&&new RegExp(O.join("|")),e=mt.test(N.compareDocumentPosition),U=e||mt.test(N.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},q=e?function(t,e){if(t===e)return P=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!w.sortDetached&&e.compareDocumentPosition(t)===i?t===D||t.ownerDocument===j&&U(j,t)?-1:e===D||e.ownerDocument===j&&U(j,e)?1:E?tt(E,t)-tt(E,e):0:4&i?-1:1)}:function(t,e){if(t===e)return P=!0,0;var i,r=0,n=t.parentNode,s=e.parentNode,a=[t],l=[e];if(!n||!s)return t===D?-1:e===D?1:n?-1:s?1:E?tt(E,t)-tt(E,e):0;if(n===s)return o(t,e);for(i=t;i=i.parentNode;)a.unshift(i);for(i=e;i=i.parentNode;)l.unshift(i);for(;a[r]===l[r];)r++;return r?o(a[r],l[r]):a[r]===j?-1:l[r]===j?1:0},D):D},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==D&&R(t),i=i.replace(ut,"='$1']"),w.matchesSelector&&L&&!V[i+" "]&&(!O||!O.test(i))&&(!F||!F.test(i)))try{var r=B.call(t,i);if(r||w.disconnectedMatch||t.document&&11!==t.document.nodeType)return r}catch(t){}return e(i,D,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==D&&R(t),U(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==D&&R(t);var i=C.attrHandle[e.toLowerCase()],r=i&&X.call(C.attrHandle,e.toLowerCase())?i(t,e,!L):void 0;return void 0!==r?r:w.attributes||!L?t.getAttribute(e):(r=t.getAttributeNode(e))&&r.specified?r.value:null},e.escape=function(t){return(t+"").replace(_t,wt)},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],r=0,n=0;if(P=!w.detectDuplicates,E=!w.sortStable&&t.slice(0),t.sort(q),P){for(;e=t[n++];)e===t[n]&&(r=i.push(n));for(;r--;)t.splice(i[r],1)}return E=null,t},T=e.getText=function(t){var e,i="",r=0,n=t.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=T(t)}else if(3===n||4===n)return t.nodeValue}else for(;e=t[r++];)i+=T(e);return i},C=e.selectors={cacheLength:50,createPseudo:r,match:pt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(bt,xt),t[3]=(t[3]||t[4]||t[5]||"").replace(bt,xt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return pt.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&ct.test(i)&&(e=I(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(bt,xt).toLowerCase();
return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=W[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&W(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,r){return function(n){var s=e.attr(n,t);return null==s?"!="===i:!i||(s+="","="===i?s===r:"!="===i?s!==r:"^="===i?r&&0===s.indexOf(r):"*="===i?r&&s.indexOf(r)>-1:"$="===i?r&&s.slice(-r.length)===r:"~="===i?(" "+s.replace(ot," ")+" ").indexOf(r)>-1:"|="===i&&(s===r||s.slice(0,r.length+1)===r+"-"))}},CHILD:function(t,e,i,r,n){var s="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===r&&0===n?function(t){return!!t.parentNode}:function(e,i,l){var h,u,c,d,p,f,g=s!==o?"nextSibling":"previousSibling",m=e.parentNode,v=a&&e.nodeName.toLowerCase(),y=!l&&!a,b=!1;if(m){if(s){for(;g;){for(d=e;d=d[g];)if(a?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[o?m.firstChild:m.lastChild],o&&y){for(d=m,c=d[z]||(d[z]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),h=u[t]||[],p=h[0]===G&&h[1],b=p&&h[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(b=p=0)||f.pop();)if(1===d.nodeType&&++b&&d===e){u[t]=[G,p,b];break}}else if(y&&(d=e,c=d[z]||(d[z]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),h=u[t]||[],p=h[0]===G&&h[1],b=p),b===!1)for(;(d=++p&&d&&d[g]||(b=p=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++b||(y&&(c=d[z]||(d[z]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),u[t]=[G,b]),d!==e)););return b-=n,b===r||b%r===0&&b/r>=0}}},PSEUDO:function(t,i){var n,s=C.pseudos[t]||C.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return s[z]?s(i):s.length>1?(n=[t,t,"",i],C.setFilters.hasOwnProperty(t.toLowerCase())?r(function(t,e){for(var r,n=s(t,i),o=n.length;o--;)r=tt(t,n[o]),t[r]=!(e[r]=n[o])}):function(t){return s(t,0,n)}):s}},pseudos:{not:r(function(t){var e=[],i=[],n=S(t.replace(at,"$1"));return n[z]?r(function(t,e,i,r){for(var s,o=n(t,null,r,[]),a=t.length;a--;)(s=o[a])&&(t[a]=!(e[a]=s))}):function(t,r,s){return e[0]=t,n(e,null,s,i),e[0]=null,!i.pop()}}),has:r(function(t){return function(i){return e(t,i).length>0}}),contains:r(function(t){return t=t.replace(bt,xt),function(e){return(e.textContent||e.innerText||T(e)).indexOf(t)>-1}}),lang:r(function(t){return dt.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(bt,xt).toLowerCase(),function(e){var i;do if(i=L?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===N},focus:function(t){return t===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:h(!1),disabled:h(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!C.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return ft.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:u(function(){return[0]}),last:u(function(t,e){return[e-1]}),eq:u(function(t,e,i){return[i<0?i+e:i]}),even:u(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:u(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:u(function(t,e,i){for(var r=i<0?i+e:i;--r>=0;)t.push(r);return t}),gt:u(function(t,e,i){for(var r=i<0?i+e:i;++r<e;)t.push(r);return t})}},C.pseudos.nth=C.pseudos.eq;for(_ in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[_]=a(_);for(_ in{submit:!0,reset:!0})C.pseudos[_]=l(_);return d.prototype=C.filters=C.pseudos,C.setFilters=new d,I=e.tokenize=function(t,i){var r,n,s,o,a,l,h,u=Y[t+" "];if(u)return i?0:u.slice(0);for(a=t,l=[],h=C.preFilter;a;){r&&!(n=lt.exec(a))||(n&&(a=a.slice(n[0].length)||a),l.push(s=[])),r=!1,(n=ht.exec(a))&&(r=n.shift(),s.push({value:r,type:n[0].replace(at," ")}),a=a.slice(r.length));for(o in C.filter)!(n=pt[o].exec(a))||h[o]&&!(n=h[o](n))||(r=n.shift(),s.push({value:r,type:o,matches:n}),a=a.slice(r.length));if(!r)break}return i?a.length:a?e.error(t):Y(t,l).slice(0)},S=e.compile=function(t,e){var i,r=[],n=[],s=V[t+" "];if(!s){for(e||(e=I(t)),i=e.length;i--;)s=b(e[i]),s[z]?r.push(s):n.push(s);s=V(t,x(n,r)),s.selector=t}return s},M=e.select=function(t,e,i,r){var n,s,o,a,l,h="function"==typeof t&&t,u=!r&&I(t=h.selector||t);if(i=i||[],1===u.length){if(s=u[0]=u[0].slice(0),s.length>2&&"ID"===(o=s[0]).type&&9===e.nodeType&&L&&C.relative[s[1].type]){if(e=(C.find.ID(o.matches[0].replace(bt,xt),e)||[])[0],!e)return i;h&&(e=e.parentNode),t=t.slice(s.shift().value.length)}for(n=pt.needsContext.test(t)?0:s.length;n--&&(o=s[n],!C.relative[a=o.type]);)if((l=C.find[a])&&(r=l(o.matches[0].replace(bt,xt),yt.test(s[0].type)&&c(e.parentNode)||e))){if(s.splice(n,1),t=r.length&&p(s),!t)return Q.apply(i,r),i;break}}return(h||S(t,u))(r,e,!L,i,!e||yt.test(t)&&c(e.parentNode)||e),i},w.sortStable=z.split("").sort(q).join("")===z,w.detectDuplicates=!!P,R(),w.sortDetached=n(function(t){return 1&t.compareDocumentPosition(D.createElement("fieldset"))}),n(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||s("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),w.attributes&&n(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||s("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),n(function(t){return null==t.getAttribute("disabled")})||s(et,function(t,e,i){var r;if(!i)return t[e]===!0?e.toLowerCase():(r=t.getAttributeNode(e))&&r.specified?r.value:null}),e}(t);mt.find=_t,mt.expr=_t.selectors,mt.expr[":"]=mt.expr.pseudos,mt.uniqueSort=mt.unique=_t.uniqueSort,mt.text=_t.getText,mt.isXMLDoc=_t.isXML,mt.contains=_t.contains,mt.escapeSelector=_t.escape;var wt=function(t,e,i){for(var r=[],n=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(n&&mt(t).is(i))break;r.push(t)}return r},Ct=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},Tt=mt.expr.match.needsContext,At=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,It=/^.[^:#\[\.,]*$/;mt.filter=function(t,e,i){var r=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===r.nodeType?mt.find.matchesSelector(r,t)?[r]:[]:mt.find.matches(t,mt.grep(e,function(t){return 1===t.nodeType}))},mt.fn.extend({find:function(t){var e,i,r=this.length,n=this;if("string"!=typeof t)return this.pushStack(mt(t).filter(function(){for(e=0;e<r;e++)if(mt.contains(n[e],this))return!0}));for(i=this.pushStack([]),e=0;e<r;e++)mt.find(t,n[e],i);return r>1?mt.uniqueSort(i):i},filter:function(t){return this.pushStack(o(this,t||[],!1))},not:function(t){return this.pushStack(o(this,t||[],!0))},is:function(t){return!!o(this,"string"==typeof t&&Tt.test(t)?mt(t):t||[],!1).length}});var St,Mt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,kt=mt.fn.init=function(t,e,i){var r,n;if(!t)return this;if(i=i||St,"string"==typeof t){if(r="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:Mt.exec(t),!r||!r[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(r[1]){if(e=e instanceof mt?e[0]:e,mt.merge(this,mt.parseHTML(r[1],e&&e.nodeType?e.ownerDocument||e:rt,!0)),At.test(r[1])&&mt.isPlainObject(e))for(r in e)mt.isFunction(this[r])?this[r](e[r]):this.attr(r,e[r]);return this}return n=rt.getElementById(r[2]),n&&(this[0]=n,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):mt.isFunction(t)?void 0!==i.ready?i.ready(t):t(mt):mt.makeArray(t,this)};kt.prototype=mt.fn,St=mt(rt);var Et=/^(?:parents|prev(?:Until|All))/,Pt={children:!0,contents:!0,next:!0,prev:!0};mt.fn.extend({has:function(t){var e=mt(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(mt.contains(this,e[t]))return!0})},closest:function(t,e){var i,r=0,n=this.length,s=[],o="string"!=typeof t&&mt(t);if(!Tt.test(t))for(;r<n;r++)for(i=this[r];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&mt.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(s.length>1?mt.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?lt.call(mt(t),this[0]):lt.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(mt.uniqueSort(mt.merge(this.get(),mt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),mt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return wt(t,"parentNode")},parentsUntil:function(t,e,i){return wt(t,"parentNode",i)},next:function(t){return a(t,"nextSibling")},prev:function(t){return a(t,"previousSibling")},nextAll:function(t){return wt(t,"nextSibling")},prevAll:function(t){return wt(t,"previousSibling")},nextUntil:function(t,e,i){return wt(t,"nextSibling",i)},prevUntil:function(t,e,i){return wt(t,"previousSibling",i)},siblings:function(t){return Ct((t.parentNode||{}).firstChild,t)},children:function(t){return Ct(t.firstChild)},contents:function(t){return s(t,"iframe")?t.contentDocument:(s(t,"template")&&(t=t.content||t),mt.merge([],t.childNodes))}},function(t,e){mt.fn[t]=function(i,r){var n=mt.map(this,e,i);return"Until"!==t.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=mt.filter(r,n)),this.length>1&&(Pt[t]||mt.uniqueSort(n),Et.test(t)&&n.reverse()),this.pushStack(n)}});var Rt=/[^\x20\t\r\n\f]+/g;mt.Callbacks=function(t){t="string"==typeof t?l(t):mt.extend({},t);var e,i,r,n,s=[],o=[],a=-1,h=function(){for(n=n||t.once,r=e=!0;o.length;a=-1)for(i=o.shift();++a<s.length;)s[a].apply(i[0],i[1])===!1&&t.stopOnFalse&&(a=s.length,i=!1);t.memory||(i=!1),e=!1,n&&(s=i?[]:"")},u={add:function(){return s&&(i&&!e&&(a=s.length-1,o.push(i)),function e(i){mt.each(i,function(i,r){mt.isFunction(r)?t.unique&&u.has(r)||s.push(r):r&&r.length&&"string"!==mt.type(r)&&e(r)})}(arguments),i&&!e&&h()),this},remove:function(){return mt.each(arguments,function(t,e){for(var i;(i=mt.inArray(e,s,i))>-1;)s.splice(i,1),i<=a&&a--}),this},has:function(t){return t?mt.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return n=o=[],s=i="",this},disabled:function(){return!s},lock:function(){return n=o=[],i||e||(s=i=""),this},locked:function(){return!!n},fireWith:function(t,i){return n||(i=i||[],i=[t,i.slice?i.slice():i],o.push(i),e||h()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},mt.extend({Deferred:function(e){var i=[["notify","progress",mt.Callbacks("memory"),mt.Callbacks("memory"),2],["resolve","done",mt.Callbacks("once memory"),mt.Callbacks("once memory"),0,"resolved"],["reject","fail",mt.Callbacks("once memory"),mt.Callbacks("once memory"),1,"rejected"]],r="pending",n={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},catch:function(t){return n.then(null,t)},pipe:function(){var t=arguments;return mt.Deferred(function(e){mt.each(i,function(i,r){var n=mt.isFunction(t[r[4]])&&t[r[4]];s[r[1]](function(){var t=n&&n.apply(this,arguments);t&&mt.isFunction(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[r[0]+"With"](this,n?[t]:arguments)})}),t=null}).promise()},then:function(e,r,n){function s(e,i,r,n){return function(){var a=this,l=arguments,c=function(){var t,c;if(!(e<o)){if(t=r.apply(a,l),t===i.promise())throw new TypeError("Thenable self-resolution");c=t&&("object"==typeof t||"function"==typeof t)&&t.then,mt.isFunction(c)?n?c.call(t,s(o,i,h,n),s(o,i,u,n)):(o++,c.call(t,s(o,i,h,n),s(o,i,u,n),s(o,i,h,i.notifyWith))):(r!==h&&(a=void 0,l=[t]),(n||i.resolveWith)(a,l))}},d=n?c:function(){try{c()}catch(t){mt.Deferred.exceptionHook&&mt.Deferred.exceptionHook(t,d.stackTrace),e+1>=o&&(r!==u&&(a=void 0,l=[t]),i.rejectWith(a,l))}};e?d():(mt.Deferred.getStackHook&&(d.stackTrace=mt.Deferred.getStackHook()),t.setTimeout(d))}}var o=0;return mt.Deferred(function(t){i[0][3].add(s(0,t,mt.isFunction(n)?n:h,t.notifyWith)),i[1][3].add(s(0,t,mt.isFunction(e)?e:h)),i[2][3].add(s(0,t,mt.isFunction(r)?r:u))}).promise()},promise:function(t){return null!=t?mt.extend(t,n):n}},s={};return mt.each(i,function(t,e){var o=e[2],a=e[5];n[e[1]]=o.add,a&&o.add(function(){r=a},i[3-t][2].disable,i[0][2].lock),o.add(e[3].fire),s[e[0]]=function(){return s[e[0]+"With"](this===s?void 0:this,arguments),this},s[e[0]+"With"]=o.fireWith}),n.promise(s),e&&e.call(s,s),s},when:function(t){var e=arguments.length,i=e,r=Array(i),n=st.call(arguments),s=mt.Deferred(),o=function(t){return function(i){r[t]=this,n[t]=arguments.length>1?st.call(arguments):i,--e||s.resolveWith(r,n)}};if(e<=1&&(c(t,s.done(o(i)).resolve,s.reject,!e),"pending"===s.state()||mt.isFunction(n[i]&&n[i].then)))return s.then();for(;i--;)c(n[i],o(i),s.reject);return s.promise()}});var Dt=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;mt.Deferred.exceptionHook=function(e,i){t.console&&t.console.warn&&e&&Dt.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,i)},mt.readyException=function(e){t.setTimeout(function(){throw e})};var Nt=mt.Deferred();mt.fn.ready=function(t){return Nt.then(t).catch(function(t){mt.readyException(t)}),this},mt.extend({isReady:!1,readyWait:1,ready:function(t){(t===!0?--mt.readyWait:mt.isReady)||(mt.isReady=!0,t!==!0&&--mt.readyWait>0||Nt.resolveWith(rt,[mt]))}}),mt.ready.then=Nt.then,"complete"===rt.readyState||"loading"!==rt.readyState&&!rt.documentElement.doScroll?t.setTimeout(mt.ready):(rt.addEventListener("DOMContentLoaded",d),t.addEventListener("load",d));var Lt=function(t,e,i,r,n,s,o){var a=0,l=t.length,h=null==i;if("object"===mt.type(i)){n=!0;for(a in i)Lt(t,e,a,i[a],!0,s,o)}else if(void 0!==r&&(n=!0,mt.isFunction(r)||(o=!0),h&&(o?(e.call(t,r),e=null):(h=e,e=function(t,e,i){return h.call(mt(t),i)})),e))for(;a<l;a++)e(t[a],i,o?r:r.call(t[a],a,e(t[a],i)));return n?t:h?e.call(t):l?e(t[0],i):s},Ft=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};p.uid=1,p.prototype={cache:function(t){var e=t[this.expando];return e||(e={},Ft(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var r,n=this.cache(t);if("string"==typeof e)n[mt.camelCase(e)]=i;else for(r in e)n[mt.camelCase(r)]=e[r];return n},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][mt.camelCase(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,r=t[this.expando];if(void 0!==r){if(void 0!==e){Array.isArray(e)?e=e.map(mt.camelCase):(e=mt.camelCase(e),e=e in r?[e]:e.match(Rt)||[]),i=e.length;for(;i--;)delete r[e[i]]}(void 0===e||mt.isEmptyObject(r))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!mt.isEmptyObject(e)}};var Ot=new p,Bt=new p,Ut=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,zt=/[A-Z]/g;mt.extend({hasData:function(t){return Bt.hasData(t)||Ot.hasData(t)},data:function(t,e,i){return Bt.access(t,e,i)},removeData:function(t,e){Bt.remove(t,e)},_data:function(t,e,i){return Ot.access(t,e,i)},_removeData:function(t,e){Ot.remove(t,e)}}),mt.fn.extend({data:function(t,e){var i,r,n,s=this[0],o=s&&s.attributes;if(void 0===t){if(this.length&&(n=Bt.get(s),1===s.nodeType&&!Ot.get(s,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&(r=o[i].name,0===r.indexOf("data-")&&(r=mt.camelCase(r.slice(5)),g(s,r,n[r])));Ot.set(s,"hasDataAttrs",!0)}return n}return"object"==typeof t?this.each(function(){Bt.set(this,t)}):Lt(this,function(e){var i;if(s&&void 0===e){if(i=Bt.get(s,t),void 0!==i)return i;if(i=g(s,t),void 0!==i)return i}else this.each(function(){Bt.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Bt.remove(this,t)})}}),mt.extend({queue:function(t,e,i){var r;if(t)return e=(e||"fx")+"queue",r=Ot.get(t,e),i&&(!r||Array.isArray(i)?r=Ot.access(t,e,mt.makeArray(i)):r.push(i)),r||[]},dequeue:function(t,e){e=e||"fx";var i=mt.queue(t,e),r=i.length,n=i.shift(),s=mt._queueHooks(t,e),o=function(){mt.dequeue(t,e)};"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===e&&i.unshift("inprogress"),delete s.stop,n.call(t,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Ot.get(t,i)||Ot.access(t,i,{empty:mt.Callbacks("once memory").add(function(){Ot.remove(t,[e+"queue",i])})})}}),mt.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?mt.queue(this[0],t):void 0===e?this:this.each(function(){var i=mt.queue(this,t,e);mt._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&mt.dequeue(this,t)})},dequeue:function(t){return this.each(function(){mt.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,r=1,n=mt.Deferred(),s=this,o=this.length,a=function(){--r||n.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)i=Ot.get(s[o],t+"queueHooks"),i&&i.empty&&(r++,i.empty.add(a));return a(),n.promise(e)}});var jt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Gt=new RegExp("^(?:([+-])=|)("+jt+")([a-z%]*)$","i"),Ht=["Top","Right","Bottom","Left"],Wt=function(t,e){return t=e||t,"none"===t.style.display||""===t.style.display&&mt.contains(t.ownerDocument,t)&&"none"===mt.css(t,"display")},Yt=function(t,e,i,r){var n,s,o={};for(s in e)o[s]=t.style[s],t.style[s]=e[s];n=i.apply(t,r||[]);for(s in e)t.style[s]=o[s];return n},Vt={};mt.fn.extend({show:function(){return y(this,!0)},hide:function(){return y(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Wt(this)?mt(this).show():mt(this).hide()})}});var qt=/^(?:checkbox|radio)$/i,Xt=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Zt=/^$|\/(?:java|ecma)script/i,Kt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Kt.optgroup=Kt.option,Kt.tbody=Kt.tfoot=Kt.colgroup=Kt.caption=Kt.thead,Kt.th=Kt.td;var Jt=/<|&#?\w+;/;!function(){var t=rt.createDocumentFragment(),e=t.appendChild(rt.createElement("div")),i=rt.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),ft.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",ft.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var Qt=rt.documentElement,$t=/^key/,te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ee=/^([^.]*)(?:\.(.+)|)/;mt.event={global:{},add:function(t,e,i,r,n){var s,o,a,l,h,u,c,d,p,f,g,m=Ot.get(t);if(m)for(i.handler&&(s=i,i=s.handler,n=s.selector),n&&mt.find.matchesSelector(Qt,n),i.guid||(i.guid=mt.guid++),(l=m.events)||(l=m.events={}),(o=m.handle)||(o=m.handle=function(e){return"undefined"!=typeof mt&&mt.event.triggered!==e.type?mt.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(Rt)||[""],h=e.length;h--;)a=ee.exec(e[h])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p&&(c=mt.event.special[p]||{},p=(n?c.delegateType:c.bindType)||p,c=mt.event.special[p]||{},u=mt.extend({type:p,origType:g,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&mt.expr.match.needsContext.test(n),namespace:f.join(".")},s),(d=l[p])||(d=l[p]=[],d.delegateCount=0,c.setup&&c.setup.call(t,r,f,o)!==!1||t.addEventListener&&t.addEventListener(p,o)),c.add&&(c.add.call(t,u),u.handler.guid||(u.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,u):d.push(u),mt.event.global[p]=!0)},remove:function(t,e,i,r,n){var s,o,a,l,h,u,c,d,p,f,g,m=Ot.hasData(t)&&Ot.get(t);if(m&&(l=m.events)){for(e=(e||"").match(Rt)||[""],h=e.length;h--;)if(a=ee.exec(e[h])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p){for(c=mt.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,d=l[p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=d.length;s--;)u=d[s],!n&&g!==u.origType||i&&i.guid!==u.guid||a&&!a.test(u.namespace)||r&&r!==u.selector&&("**"!==r||!u.selector)||(d.splice(s,1),u.selector&&d.delegateCount--,c.remove&&c.remove.call(t,u));o&&!d.length&&(c.teardown&&c.teardown.call(t,f,m.handle)!==!1||mt.removeEvent(t,p,m.handle),delete l[p])}else for(p in l)mt.event.remove(t,p+e[h],i,r,!0);mt.isEmptyObject(l)&&Ot.remove(t,"handle events")}},dispatch:function(t){var e,i,r,n,s,o,a=mt.event.fix(t),l=new Array(arguments.length),h=(Ot.get(this,"events")||{})[a.type]||[],u=mt.event.special[a.type]||{};for(l[0]=a,e=1;e<arguments.length;e++)l[e]=arguments[e];if(a.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,a)!==!1){for(o=mt.event.handlers.call(this,a,h),e=0;(n=o[e++])&&!a.isPropagationStopped();)for(a.currentTarget=n.elem,i=0;(s=n.handlers[i++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(s.namespace)||(a.handleObj=s,a.data=s.data,r=((mt.event.special[s.origType]||{}).handle||s.handler).apply(n.elem,l),void 0!==r&&(a.result=r)===!1&&(a.preventDefault(),a.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,a),a.result}},handlers:function(t,e){var i,r,n,s,o,a=[],l=e.delegateCount,h=t.target;if(l&&h.nodeType&&!("click"===t.type&&t.button>=1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==t.type||h.disabled!==!0)){for(s=[],o={},i=0;i<l;i++)r=e[i],n=r.selector+" ",void 0===o[n]&&(o[n]=r.needsContext?mt(n,this).index(h)>-1:mt.find(n,this,null,[h]).length),o[n]&&s.push(r);s.length&&a.push({elem:h,handlers:s})}return h=this,l<e.length&&a.push({elem:h,handlers:e.slice(l)}),a},addProp:function(t,e){Object.defineProperty(mt.Event.prototype,t,{enumerable:!0,configurable:!0,get:mt.isFunction(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[mt.expando]?t:new mt.Event(t)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==T()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===T()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&s(this,"input"))return this.click(),!1},_default:function(t){return s(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},mt.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},mt.Event=function(t,e){return this instanceof mt.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?w:C,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&mt.extend(this,e),this.timeStamp=t&&t.timeStamp||mt.now(),void(this[mt.expando]=!0)):new mt.Event(t,e)},mt.Event.prototype={constructor:mt.Event,isDefaultPrevented:C,isPropagationStopped:C,isImmediatePropagationStopped:C,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=w,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=w,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=w,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},mt.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&$t.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&te.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},mt.event.addProp),mt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){mt.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,r=this,n=t.relatedTarget,s=t.handleObj;return n&&(n===r||mt.contains(r,n))||(t.type=s.origType,i=s.handler.apply(this,arguments),t.type=e),i}}}),mt.fn.extend({on:function(t,e,i,r){return A(this,t,e,i,r)},one:function(t,e,i,r){return A(this,t,e,i,r,1)},off:function(t,e,i){var r,n;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,mt(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(n in t)this.off(n,e,t[n]);return this}return e!==!1&&"function"!=typeof e||(i=e,e=void 0),i===!1&&(i=C),this.each(function(){mt.event.remove(this,t,i,e)})}});var ie=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,re=/<script|<style|<link/i,ne=/checked\s*(?:[^=]|=\s*.checked.)/i,se=/^true\/(.*)/,oe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;mt.extend({htmlPrefilter:function(t){return t.replace(ie,"<$1></$2>")},clone:function(t,e,i){var r,n,s,o,a=t.cloneNode(!0),l=mt.contains(t.ownerDocument,t);if(!(ft.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||mt.isXMLDoc(t)))for(o=b(a),s=b(t),r=0,n=s.length;r<n;r++)E(s[r],o[r]);if(e)if(i)for(s=s||b(t),o=o||b(a),r=0,n=s.length;r<n;r++)k(s[r],o[r]);else k(t,a);return o=b(a,"script"),o.length>0&&x(o,!l&&b(t,"script")),a},cleanData:function(t){for(var e,i,r,n=mt.event.special,s=0;void 0!==(i=t[s]);s++)if(Ft(i)){if(e=i[Ot.expando]){if(e.events)for(r in e.events)n[r]?mt.event.remove(i,r):mt.removeEvent(i,r,e.handle);i[Ot.expando]=void 0}i[Bt.expando]&&(i[Bt.expando]=void 0)}}}),mt.fn.extend({detach:function(t){return R(this,t,!0)},remove:function(t){return R(this,t)},text:function(t){return Lt(this,function(t){return void 0===t?mt.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return P(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=I(this,t);e.appendChild(t)}})},prepend:function(){return P(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=I(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return P(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return P(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(mt.cleanData(b(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return mt.clone(this,t,e)})},html:function(t){return Lt(this,function(t){var e=this[0]||{},i=0,r=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!re.test(t)&&!Kt[(Xt.exec(t)||["",""])[1].toLowerCase()]){t=mt.htmlPrefilter(t);try{for(;i<r;i++)e=this[i]||{},1===e.nodeType&&(mt.cleanData(b(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return P(this,arguments,function(e){var i=this.parentNode;mt.inArray(this,t)<0&&(mt.cleanData(b(this)),i&&i.replaceChild(e,this))},t)}}),mt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){mt.fn[t]=function(t){for(var i,r=[],n=mt(t),s=n.length-1,o=0;o<=s;o++)i=o===s?this:this.clone(!0),mt(n[o])[e](i),at.apply(r,i.get());return this.pushStack(r)}});var ae=/^margin/,le=new RegExp("^("+jt+")(?!px)[a-z%]+$","i"),he=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)};!function(){function e(){if(a){a.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Qt.appendChild(o);var e=t.getComputedStyle(a);i="1%"!==e.top,s="2px"===e.marginLeft,r="4px"===e.width,a.style.marginRight="50%",n="4px"===e.marginRight,Qt.removeChild(o),a=null}}var i,r,n,s,o=rt.createElement("div"),a=rt.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",ft.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",o.appendChild(a),mt.extend(ft,{pixelPosition:function(){return e(),i},boxSizingReliable:function(){return e(),r},pixelMarginRight:function(){return e(),n},reliableMarginLeft:function(){return e(),s}}))}();var ue=/^(none|table(?!-c[ea]).+)/,ce=/^--/,de={position:"absolute",visibility:"hidden",display:"block"},pe={letterSpacing:"0",fontWeight:"400"},fe=["Webkit","Moz","ms"],ge=rt.createElement("div").style;mt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=D(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(t,e,i,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var n,s,o,a=mt.camelCase(e),l=ce.test(e),h=t.style;return l||(e=F(a)),o=mt.cssHooks[e]||mt.cssHooks[a],void 0===i?o&&"get"in o&&void 0!==(n=o.get(t,!1,r))?n:h[e]:(s=typeof i,"string"===s&&(n=Gt.exec(i))&&n[1]&&(i=m(t,e,n),s="number"),void(null!=i&&i===i&&("number"===s&&(i+=n&&n[3]||(mt.cssNumber[a]?"":"px")),ft.clearCloneStyle||""!==i||0!==e.indexOf("background")||(h[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,r))||(l?h.setProperty(e,i):h[e]=i))))}},css:function(t,e,i,r){var n,s,o,a=mt.camelCase(e),l=ce.test(e);return l||(e=F(a)),o=mt.cssHooks[e]||mt.cssHooks[a],o&&"get"in o&&(n=o.get(t,!0,i)),void 0===n&&(n=D(t,e,r)),"normal"===n&&e in pe&&(n=pe[e]),""===i||i?(s=parseFloat(n),i===!0||isFinite(s)?s||0:n):n}}),mt.each(["height","width"],function(t,e){mt.cssHooks[e]={get:function(t,i,r){if(i)return!ue.test(mt.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?U(t,e,r):Yt(t,de,function(){return U(t,e,r)})},set:function(t,i,r){var n,s=r&&he(t),o=r&&B(t,e,r,"border-box"===mt.css(t,"boxSizing",!1,s),s);return o&&(n=Gt.exec(i))&&"px"!==(n[3]||"px")&&(t.style[e]=i,i=mt.css(t,e)),O(t,i,o)}}}),mt.cssHooks.marginLeft=N(ft.reliableMarginLeft,function(t,e){if(e)return(parseFloat(D(t,"marginLeft"))||t.getBoundingClientRect().left-Yt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),mt.each({margin:"",padding:"",border:"Width"},function(t,e){mt.cssHooks[t+e]={expand:function(i){for(var r=0,n={},s="string"==typeof i?i.split(" "):[i];r<4;r++)n[t+Ht[r]+e]=s[r]||s[r-2]||s[0];return n}},ae.test(t)||(mt.cssHooks[t+e].set=O)}),mt.fn.extend({css:function(t,e){return Lt(this,function(t,e,i){var r,n,s={},o=0;if(Array.isArray(e)){for(r=he(t),n=e.length;o<n;o++)s[e[o]]=mt.css(t,e[o],!1,r);return s}return void 0!==i?mt.style(t,e,i):mt.css(t,e)},t,e,arguments.length>1)}}),mt.Tween=z,z.prototype={constructor:z,init:function(t,e,i,r,n,s){this.elem=t,this.prop=i,this.easing=n||mt.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=r,this.unit=s||(mt.cssNumber[i]?"":"px");
},cur:function(){var t=z.propHooks[this.prop];return t&&t.get?t.get(this):z.propHooks._default.get(this)},run:function(t){var e,i=z.propHooks[this.prop];return this.options.duration?this.pos=e=mt.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):z.propHooks._default.set(this),this}},z.prototype.init.prototype=z.prototype,z.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=mt.css(t.elem,t.prop,""),e&&"auto"!==e?e:0)},set:function(t){mt.fx.step[t.prop]?mt.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[mt.cssProps[t.prop]]&&!mt.cssHooks[t.prop]?t.elem[t.prop]=t.now:mt.style(t.elem,t.prop,t.now+t.unit)}}},z.propHooks.scrollTop=z.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},mt.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},mt.fx=z.prototype.init,mt.fx.step={};var me,ve,ye=/^(?:toggle|show|hide)$/,be=/queueHooks$/;mt.Animation=mt.extend(q,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return m(i.elem,t,Gt.exec(e),i),i}]},tweener:function(t,e){mt.isFunction(t)?(e=t,t=["*"]):t=t.match(Rt);for(var i,r=0,n=t.length;r<n;r++)i=t[r],q.tweeners[i]=q.tweeners[i]||[],q.tweeners[i].unshift(e)},prefilters:[Y],prefilter:function(t,e){e?q.prefilters.unshift(t):q.prefilters.push(t)}}),mt.speed=function(t,e,i){var r=t&&"object"==typeof t?mt.extend({},t):{complete:i||!i&&e||mt.isFunction(t)&&t,duration:t,easing:i&&e||e&&!mt.isFunction(e)&&e};return mt.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in mt.fx.speeds?r.duration=mt.fx.speeds[r.duration]:r.duration=mt.fx.speeds._default),null!=r.queue&&r.queue!==!0||(r.queue="fx"),r.old=r.complete,r.complete=function(){mt.isFunction(r.old)&&r.old.call(this),r.queue&&mt.dequeue(this,r.queue)},r},mt.fn.extend({fadeTo:function(t,e,i,r){return this.filter(Wt).css("opacity",0).show().end().animate({opacity:e},t,i,r)},animate:function(t,e,i,r){var n=mt.isEmptyObject(t),s=mt.speed(e,i,r),o=function(){var e=q(this,mt.extend({},t),s);(n||Ot.get(this,"finish"))&&e.stop(!0)};return o.finish=o,n||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(t,e,i){var r=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,n=null!=t&&t+"queueHooks",s=mt.timers,o=Ot.get(this);if(n)o[n]&&o[n].stop&&r(o[n]);else for(n in o)o[n]&&o[n].stop&&be.test(n)&&r(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=t&&s[n].queue!==t||(s[n].anim.stop(i),e=!1,s.splice(n,1));!e&&i||mt.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=Ot.get(this),r=i[t+"queue"],n=i[t+"queueHooks"],s=mt.timers,o=r?r.length:0;for(i.finish=!0,mt.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;e<o;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete i.finish})}}),mt.each(["toggle","show","hide"],function(t,e){var i=mt.fn[e];mt.fn[e]=function(t,r,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(H(e,!0),t,r,n)}}),mt.each({slideDown:H("show"),slideUp:H("hide"),slideToggle:H("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){mt.fn[t]=function(t,i,r){return this.animate(e,t,i,r)}}),mt.timers=[],mt.fx.tick=function(){var t,e=0,i=mt.timers;for(me=mt.now();e<i.length;e++)t=i[e],t()||i[e]!==t||i.splice(e--,1);i.length||mt.fx.stop(),me=void 0},mt.fx.timer=function(t){mt.timers.push(t),mt.fx.start()},mt.fx.interval=13,mt.fx.start=function(){ve||(ve=!0,j())},mt.fx.stop=function(){ve=null},mt.fx.speeds={slow:600,fast:200,_default:400},mt.fn.delay=function(e,i){return e=mt.fx?mt.fx.speeds[e]||e:e,i=i||"fx",this.queue(i,function(i,r){var n=t.setTimeout(i,e);r.stop=function(){t.clearTimeout(n)}})},function(){var t=rt.createElement("input"),e=rt.createElement("select"),i=e.appendChild(rt.createElement("option"));t.type="checkbox",ft.checkOn=""!==t.value,ft.optSelected=i.selected,t=rt.createElement("input"),t.value="t",t.type="radio",ft.radioValue="t"===t.value}();var xe,_e=mt.expr.attrHandle;mt.fn.extend({attr:function(t,e){return Lt(this,mt.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){mt.removeAttr(this,t)})}}),mt.extend({attr:function(t,e,i){var r,n,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return"undefined"==typeof t.getAttribute?mt.prop(t,e,i):(1===s&&mt.isXMLDoc(t)||(n=mt.attrHooks[e.toLowerCase()]||(mt.expr.match.bool.test(e)?xe:void 0)),void 0!==i?null===i?void mt.removeAttr(t,e):n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:(t.setAttribute(e,i+""),i):n&&"get"in n&&null!==(r=n.get(t,e))?r:(r=mt.find.attr(t,e),null==r?void 0:r))},attrHooks:{type:{set:function(t,e){if(!ft.radioValue&&"radio"===e&&s(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,r=0,n=e&&e.match(Rt);if(n&&1===t.nodeType)for(;i=n[r++];)t.removeAttribute(i)}}),xe={set:function(t,e,i){return e===!1?mt.removeAttr(t,i):t.setAttribute(i,i),i}},mt.each(mt.expr.match.bool.source.match(/\w+/g),function(t,e){var i=_e[e]||mt.find.attr;_e[e]=function(t,e,r){var n,s,o=e.toLowerCase();return r||(s=_e[o],_e[o]=n,n=null!=i(t,e,r)?o:null,_e[o]=s),n}});var we=/^(?:input|select|textarea|button)$/i,Ce=/^(?:a|area)$/i;mt.fn.extend({prop:function(t,e){return Lt(this,mt.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[mt.propFix[t]||t]})}}),mt.extend({prop:function(t,e,i){var r,n,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&mt.isXMLDoc(t)||(e=mt.propFix[e]||e,n=mt.propHooks[e]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:t[e]=i:n&&"get"in n&&null!==(r=n.get(t,e))?r:t[e]},propHooks:{tabIndex:{get:function(t){var e=mt.find.attr(t,"tabindex");return e?parseInt(e,10):we.test(t.nodeName)||Ce.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),ft.optSelected||(mt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),mt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){mt.propFix[this.toLowerCase()]=this}),mt.fn.extend({addClass:function(t){var e,i,r,n,s,o,a,l=0;if(mt.isFunction(t))return this.each(function(e){mt(this).addClass(t.call(this,e,Z(this)))});if("string"==typeof t&&t)for(e=t.match(Rt)||[];i=this[l++];)if(n=Z(i),r=1===i.nodeType&&" "+X(n)+" "){for(o=0;s=e[o++];)r.indexOf(" "+s+" ")<0&&(r+=s+" ");a=X(r),n!==a&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,r,n,s,o,a,l=0;if(mt.isFunction(t))return this.each(function(e){mt(this).removeClass(t.call(this,e,Z(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(Rt)||[];i=this[l++];)if(n=Z(i),r=1===i.nodeType&&" "+X(n)+" "){for(o=0;s=e[o++];)for(;r.indexOf(" "+s+" ")>-1;)r=r.replace(" "+s+" "," ");a=X(r),n!==a&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):mt.isFunction(t)?this.each(function(i){mt(this).toggleClass(t.call(this,i,Z(this),e),e)}):this.each(function(){var e,r,n,s;if("string"===i)for(r=0,n=mt(this),s=t.match(Rt)||[];e=s[r++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==t&&"boolean"!==i||(e=Z(this),e&&Ot.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||t===!1?"":Ot.get(this,"__className__")||""))})},hasClass:function(t){var e,i,r=0;for(e=" "+t+" ";i=this[r++];)if(1===i.nodeType&&(" "+X(Z(i))+" ").indexOf(e)>-1)return!0;return!1}});var Te=/\r/g;mt.fn.extend({val:function(t){var e,i,r,n=this[0];return arguments.length?(r=mt.isFunction(t),this.each(function(i){var n;1===this.nodeType&&(n=r?t.call(this,i,mt(this).val()):t,null==n?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=mt.map(n,function(t){return null==t?"":t+""})),e=mt.valHooks[this.type]||mt.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))})):n?(e=mt.valHooks[n.type]||mt.valHooks[n.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(n,"value"))?i:(i=n.value,"string"==typeof i?i.replace(Te,""):null==i?"":i)):void 0}}),mt.extend({valHooks:{option:{get:function(t){var e=mt.find.attr(t,"value");return null!=e?e:X(mt.text(t))}},select:{get:function(t){var e,i,r,n=t.options,o=t.selectedIndex,a="select-one"===t.type,l=a?null:[],h=a?o+1:n.length;for(r=o<0?h:a?o:0;r<h;r++)if(i=n[r],(i.selected||r===o)&&!i.disabled&&(!i.parentNode.disabled||!s(i.parentNode,"optgroup"))){if(e=mt(i).val(),a)return e;l.push(e)}return l},set:function(t,e){for(var i,r,n=t.options,s=mt.makeArray(e),o=n.length;o--;)r=n[o],(r.selected=mt.inArray(mt.valHooks.option.get(r),s)>-1)&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),mt.each(["radio","checkbox"],function(){mt.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=mt.inArray(mt(t).val(),e)>-1}},ft.checkOn||(mt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var Ae=/^(?:focusinfocus|focusoutblur)$/;mt.extend(mt.event,{trigger:function(e,i,r,n){var s,o,a,l,h,u,c,d=[r||rt],p=ct.call(e,"type")?e.type:e,f=ct.call(e,"namespace")?e.namespace.split("."):[];if(o=a=r=r||rt,3!==r.nodeType&&8!==r.nodeType&&!Ae.test(p+mt.event.triggered)&&(p.indexOf(".")>-1&&(f=p.split("."),p=f.shift(),f.sort()),h=p.indexOf(":")<0&&"on"+p,e=e[mt.expando]?e:new mt.Event(p,"object"==typeof e&&e),e.isTrigger=n?2:3,e.namespace=f.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),i=null==i?[e]:mt.makeArray(i,[e]),c=mt.event.special[p]||{},n||!c.trigger||c.trigger.apply(r,i)!==!1)){if(!n&&!c.noBubble&&!mt.isWindow(r)){for(l=c.delegateType||p,Ae.test(l+p)||(o=o.parentNode);o;o=o.parentNode)d.push(o),a=o;a===(r.ownerDocument||rt)&&d.push(a.defaultView||a.parentWindow||t)}for(s=0;(o=d[s++])&&!e.isPropagationStopped();)e.type=s>1?l:c.bindType||p,u=(Ot.get(o,"events")||{})[e.type]&&Ot.get(o,"handle"),u&&u.apply(o,i),u=h&&o[h],u&&u.apply&&Ft(o)&&(e.result=u.apply(o,i),e.result===!1&&e.preventDefault());return e.type=p,n||e.isDefaultPrevented()||c._default&&c._default.apply(d.pop(),i)!==!1||!Ft(r)||h&&mt.isFunction(r[p])&&!mt.isWindow(r)&&(a=r[h],a&&(r[h]=null),mt.event.triggered=p,r[p](),mt.event.triggered=void 0,a&&(r[h]=a)),e.result}},simulate:function(t,e,i){var r=mt.extend(new mt.Event,i,{type:t,isSimulated:!0});mt.event.trigger(r,null,e)}}),mt.fn.extend({trigger:function(t,e){return this.each(function(){mt.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return mt.event.trigger(t,e,i,!0)}}),mt.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,e){mt.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),mt.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),ft.focusin="onfocusin"in t,ft.focusin||mt.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){mt.event.simulate(e,t.target,mt.event.fix(t))};mt.event.special[e]={setup:function(){var r=this.ownerDocument||this,n=Ot.access(r,e);n||r.addEventListener(t,i,!0),Ot.access(r,e,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=Ot.access(r,e)-1;n?Ot.access(r,e,n):(r.removeEventListener(t,i,!0),Ot.remove(r,e))}}});var Ie=t.location,Se=mt.now(),Me=/\?/;mt.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||mt.error("Invalid XML: "+e),i};var ke=/\[\]$/,Ee=/\r?\n/g,Pe=/^(?:submit|button|image|reset|file)$/i,Re=/^(?:input|select|textarea|keygen)/i;mt.param=function(t,e){var i,r=[],n=function(t,e){var i=mt.isFunction(e)?e():e;r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(Array.isArray(t)||t.jquery&&!mt.isPlainObject(t))mt.each(t,function(){n(this.name,this.value)});else for(i in t)K(i,t[i],e,n);return r.join("&")},mt.fn.extend({serialize:function(){return mt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=mt.prop(this,"elements");return t?mt.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!mt(this).is(":disabled")&&Re.test(this.nodeName)&&!Pe.test(t)&&(this.checked||!qt.test(t))}).map(function(t,e){var i=mt(this).val();return null==i?null:Array.isArray(i)?mt.map(i,function(t){return{name:e.name,value:t.replace(Ee,"\r\n")}}):{name:e.name,value:i.replace(Ee,"\r\n")}}).get()}});var De=/%20/g,Ne=/#.*$/,Le=/([?&])_=[^&]*/,Fe=/^(.*?):[ \t]*([^\r\n]*)$/gm,Oe=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Be=/^(?:GET|HEAD)$/,Ue=/^\/\//,ze={},je={},Ge="*/".concat("*"),He=rt.createElement("a");He.href=Ie.href,mt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ie.href,type:"GET",isLocal:Oe.test(Ie.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ge,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":mt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?$($(t,mt.ajaxSettings),e):$(mt.ajaxSettings,t)},ajaxPrefilter:J(ze),ajaxTransport:J(je),ajax:function(e,i){function r(e,i,r,a){var h,d,p,x,_,w=i;u||(u=!0,l&&t.clearTimeout(l),n=void 0,o=a||"",C.readyState=e>0?4:0,h=e>=200&&e<300||304===e,r&&(x=tt(f,C,r)),x=et(f,x,C,h),h?(f.ifModified&&(_=C.getResponseHeader("Last-Modified"),_&&(mt.lastModified[s]=_),_=C.getResponseHeader("etag"),_&&(mt.etag[s]=_)),204===e||"HEAD"===f.type?w="nocontent":304===e?w="notmodified":(w=x.state,d=x.data,p=x.error,h=!p)):(p=w,!e&&w||(w="error",e<0&&(e=0))),C.status=e,C.statusText=(i||w)+"",h?v.resolveWith(g,[d,w,C]):v.rejectWith(g,[C,w,p]),C.statusCode(b),b=void 0,c&&m.trigger(h?"ajaxSuccess":"ajaxError",[C,f,h?d:p]),y.fireWith(g,[C,w]),c&&(m.trigger("ajaxComplete",[C,f]),--mt.active||mt.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=void 0),i=i||{};var n,s,o,a,l,h,u,c,d,p,f=mt.ajaxSetup({},i),g=f.context||f,m=f.context&&(g.nodeType||g.jquery)?mt(g):mt.event,v=mt.Deferred(),y=mt.Callbacks("once memory"),b=f.statusCode||{},x={},_={},w="canceled",C={readyState:0,getResponseHeader:function(t){var e;if(u){if(!a)for(a={};e=Fe.exec(o);)a[e[1].toLowerCase()]=e[2];e=a[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return u?o:null},setRequestHeader:function(t,e){return null==u&&(t=_[t.toLowerCase()]=_[t.toLowerCase()]||t,x[t]=e),this},overrideMimeType:function(t){return null==u&&(f.mimeType=t),this},statusCode:function(t){var e;if(t)if(u)C.always(t[C.status]);else for(e in t)b[e]=[b[e],t[e]];return this},abort:function(t){var e=t||w;return n&&n.abort(e),r(0,e),this}};if(v.promise(C),f.url=((e||f.url||Ie.href)+"").replace(Ue,Ie.protocol+"//"),f.type=i.method||i.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(Rt)||[""],null==f.crossDomain){h=rt.createElement("a");try{h.href=f.url,h.href=h.href,f.crossDomain=He.protocol+"//"+He.host!=h.protocol+"//"+h.host}catch(t){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=mt.param(f.data,f.traditional)),Q(ze,f,i,C),u)return C;c=mt.event&&f.global,c&&0===mt.active++&&mt.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Be.test(f.type),s=f.url.replace(Ne,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(De,"+")):(p=f.url.slice(s.length),f.data&&(s+=(Me.test(s)?"&":"?")+f.data,delete f.data),f.cache===!1&&(s=s.replace(Le,"$1"),p=(Me.test(s)?"&":"?")+"_="+Se++ +p),f.url=s+p),f.ifModified&&(mt.lastModified[s]&&C.setRequestHeader("If-Modified-Since",mt.lastModified[s]),mt.etag[s]&&C.setRequestHeader("If-None-Match",mt.etag[s])),(f.data&&f.hasContent&&f.contentType!==!1||i.contentType)&&C.setRequestHeader("Content-Type",f.contentType),C.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Ge+"; q=0.01":""):f.accepts["*"]);for(d in f.headers)C.setRequestHeader(d,f.headers[d]);if(f.beforeSend&&(f.beforeSend.call(g,C,f)===!1||u))return C.abort();if(w="abort",y.add(f.complete),C.done(f.success),C.fail(f.error),n=Q(je,f,i,C)){if(C.readyState=1,c&&m.trigger("ajaxSend",[C,f]),u)return C;f.async&&f.timeout>0&&(l=t.setTimeout(function(){C.abort("timeout")},f.timeout));try{u=!1,n.send(x,r)}catch(t){if(u)throw t;r(-1,t)}}else r(-1,"No Transport");return C},getJSON:function(t,e,i){return mt.get(t,e,i,"json")},getScript:function(t,e){return mt.get(t,void 0,e,"script")}}),mt.each(["get","post"],function(t,e){mt[e]=function(t,i,r,n){return mt.isFunction(i)&&(n=n||r,r=i,i=void 0),mt.ajax(mt.extend({url:t,type:e,dataType:n,data:i,success:r},mt.isPlainObject(t)&&t))}}),mt._evalUrl=function(t){return mt.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},mt.fn.extend({wrapAll:function(t){var e;return this[0]&&(mt.isFunction(t)&&(t=t.call(this[0])),e=mt(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(t){return mt.isFunction(t)?this.each(function(e){mt(this).wrapInner(t.call(this,e))}):this.each(function(){var e=mt(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=mt.isFunction(t);return this.each(function(i){mt(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){mt(this).replaceWith(this.childNodes)}),this}}),mt.expr.pseudos.hidden=function(t){return!mt.expr.pseudos.visible(t)},mt.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},mt.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var We={0:200,1223:204},Ye=mt.ajaxSettings.xhr();ft.cors=!!Ye&&"withCredentials"in Ye,ft.ajax=Ye=!!Ye,mt.ajaxTransport(function(e){var i,r;if(ft.cors||Ye&&!e.crossDomain)return{send:function(n,s){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(o in n)a.setRequestHeader(o,n[o]);i=function(t){return function(){i&&(i=r=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(We[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),r=a.onerror=i("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout(function(){i&&r()})},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}}),mt.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),mt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return mt.globalEval(t),t}}}),mt.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),mt.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(r,n){e=mt("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&n("error"===t.type?404:200,t.type)}),rt.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Ve=[],qe=/(=)\?(?=&|$)|\?\?/;mt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ve.pop()||mt.expando+"_"+Se++;return this[t]=!0,t}}),mt.ajaxPrefilter("json jsonp",function(e,i,r){var n,s,o,a=e.jsonp!==!1&&(qe.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&qe.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=mt.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(qe,"$1"+n):e.jsonp!==!1&&(e.url+=(Me.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return o||mt.error(n+" was not called"),o[0]},e.dataTypes[0]="json",s=t[n],t[n]=function(){o=arguments},r.always(function(){void 0===s?mt(t).removeProp(n):t[n]=s,e[n]&&(e.jsonpCallback=i.jsonpCallback,Ve.push(n)),o&&mt.isFunction(s)&&s(o[0]),o=s=void 0}),"script"}),ft.createHTMLDocument=function(){var t=rt.implementation.createHTMLDocument("").body;return t.innerHTML="<form></form><form></form>",2===t.childNodes.length}(),mt.parseHTML=function(t,e,i){if("string"!=typeof t)return[];"boolean"==typeof e&&(i=e,e=!1);var r,n,s;return e||(ft.createHTMLDocument?(e=rt.implementation.createHTMLDocument(""),r=e.createElement("base"),r.href=rt.location.href,e.head.appendChild(r)):e=rt),n=At.exec(t),s=!i&&[],n?[e.createElement(n[1])]:(n=_([t],e,s),s&&s.length&&mt(s).remove(),mt.merge([],n.childNodes))},mt.fn.load=function(t,e,i){var r,n,s,o=this,a=t.indexOf(" ");return a>-1&&(r=X(t.slice(a)),t=t.slice(0,a)),mt.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(n="POST"),o.length>0&&mt.ajax({url:t,type:n||"GET",dataType:"html",data:e}).done(function(t){s=arguments,o.html(r?mt("<div>").append(mt.parseHTML(t)).find(r):t)}).always(i&&function(t,e){o.each(function(){i.apply(this,s||[t.responseText,e,t])})}),this},mt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){mt.fn[e]=function(t){return this.on(e,t)}}),mt.expr.pseudos.animated=function(t){return mt.grep(mt.timers,function(e){return t===e.elem}).length},mt.offset={setOffset:function(t,e,i){var r,n,s,o,a,l,h,u=mt.css(t,"position"),c=mt(t),d={};"static"===u&&(t.style.position="relative"),a=c.offset(),s=mt.css(t,"top"),l=mt.css(t,"left"),h=("absolute"===u||"fixed"===u)&&(s+l).indexOf("auto")>-1,h?(r=c.position(),o=r.top,n=r.left):(o=parseFloat(s)||0,n=parseFloat(l)||0),mt.isFunction(e)&&(e=e.call(t,i,mt.extend({},a))),null!=e.top&&(d.top=e.top-a.top+o),null!=e.left&&(d.left=e.left-a.left+n),"using"in e?e.using.call(t,d):c.css(d)}},mt.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){mt.offset.setOffset(this,t,e)});var e,i,r,n,s=this[0];return s?s.getClientRects().length?(r=s.getBoundingClientRect(),e=s.ownerDocument,i=e.documentElement,n=e.defaultView,{top:r.top+n.pageYOffset-i.clientTop,left:r.left+n.pageXOffset-i.clientLeft}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i=this[0],r={top:0,left:0};return"fixed"===mt.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),s(t[0],"html")||(r=t.offset()),r={top:r.top+mt.css(t[0],"borderTopWidth",!0),left:r.left+mt.css(t[0],"borderLeftWidth",!0)}),{top:e.top-r.top-mt.css(i,"marginTop",!0),left:e.left-r.left-mt.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===mt.css(t,"position");)t=t.offsetParent;return t||Qt})}}),mt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;mt.fn[t]=function(r){return Lt(this,function(t,r,n){var s;return mt.isWindow(t)?s=t:9===t.nodeType&&(s=t.defaultView),void 0===n?s?s[e]:t[r]:void(s?s.scrollTo(i?s.pageXOffset:n,i?n:s.pageYOffset):t[r]=n)},t,r,arguments.length)}}),mt.each(["top","left"],function(t,e){mt.cssHooks[e]=N(ft.pixelPosition,function(t,i){if(i)return i=D(t,e),le.test(i)?mt(t).position()[e]+"px":i})}),mt.each({Height:"height",Width:"width"},function(t,e){mt.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,r){mt.fn[r]=function(n,s){var o=arguments.length&&(i||"boolean"!=typeof n),a=i||(n===!0||s===!0?"margin":"border");return Lt(this,function(e,i,n){var s;return mt.isWindow(e)?0===r.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===n?mt.css(e,i,a):mt.style(e,i,n,a)},e,o?n:void 0,o)}})}),mt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,r){return this.on(e,t,i,r)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}}),mt.holdReady=function(t){t?mt.readyWait++:mt.ready(!0)},mt.isArray=Array.isArray,mt.parseJSON=JSON.parse,mt.nodeName=s,"function"==typeof r&&r.amd&&r("jquery",[],function(){return mt});var Xe=t.jQuery,Ze=t.$;return mt.noConflict=function(e){return t.$===mt&&(t.$=Ze),e&&t.jQuery===mt&&(t.jQuery=Xe),mt},e||(t.jQuery=t.$=mt),mt}),function(){function t(t){function e(e,i,r,n,s,o){for(;s>=0&&o>s;s+=t){var a=n?n[s]:s;r=i(r,e[a],a,e)}return r}return function(i,r,n,s){r=x(r,s,4);var o=!S(i)&&b.keys(i),a=(o||i).length,l=t>0?0:a-1;return arguments.length<3&&(n=i[o?o[l]:l],l+=t),e(i,r,n,o,l,a)}}function e(t){return function(e,i,r){i=_(i,r);for(var n=I(e),s=t>0?0:n-1;s>=0&&n>s;s+=t)if(i(e[s],s,e))return s;return-1}}function i(t,e,i){return function(r,n,s){var o=0,a=I(r);if("number"==typeof s)t>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(i&&s&&a)return s=i(r,n),r[s]===n?s:-1;if(n!==n)return s=e(c.call(r,o,a),b.isNaN),s>=0?s+o:-1;for(s=t>0?o:a-1;s>=0&&a>s;s+=t)if(r[s]===n)return s;return-1}}function n(t,e){var i=R.length,r=t.constructor,n=b.isFunction(r)&&r.prototype||l,s="constructor";for(b.has(t,s)&&!b.contains(e,s)&&e.push(s);i--;)s=R[i],s in t&&t[s]!==n[s]&&!b.contains(e,s)&&e.push(s)}var s=this,o=s._,a=Array.prototype,l=Object.prototype,h=Function.prototype,u=a.push,c=a.slice,d=l.toString,p=l.hasOwnProperty,f=Array.isArray,g=Object.keys,m=h.bind,v=Object.create,y=function(){},b=function(t){return t instanceof b?t:this instanceof b?void(this._wrapped=t):new b(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports._=b):s._=b,b.VERSION="1.8.3";var x=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)};case 4:return function(i,r,n,s){return t.call(e,i,r,n,s)}}return function(){return t.apply(e,arguments)}},_=function(t,e,i){return null==t?b.identity:b.isFunction(t)?x(t,e,i):b.isObject(t)?b.matcher(t):b.property(t)};b.iteratee=function(t,e){return _(t,e,1/0)};var w=function(t,e){return function(i){var r=arguments.length;if(2>r||null==i)return i;for(var n=1;r>n;n++)for(var s=arguments[n],o=t(s),a=o.length,l=0;a>l;l++){var h=o[l];e&&void 0!==i[h]||(i[h]=s[h])}return i}},C=function(t){if(!b.isObject(t))return{};if(v)return v(t);y.prototype=t;var e=new y;return y.prototype=null,e},T=function(t){return function(e){return null==e?void 0:e[t]}},A=Math.pow(2,53)-1,I=T("length"),S=function(t){var e=I(t);return"number"==typeof e&&e>=0&&A>=e};b.each=b.forEach=function(t,e,i){e=x(e,i);var r,n;if(S(t))for(r=0,n=t.length;n>r;r++)e(t[r],r,t);else{var s=b.keys(t);for(r=0,n=s.length;n>r;r++)e(t[s[r]],s[r],t)}return t},b.map=b.collect=function(t,e,i){e=_(e,i);for(var r=!S(t)&&b.keys(t),n=(r||t).length,s=Array(n),o=0;n>o;o++){var a=r?r[o]:o;s[o]=e(t[a],a,t)}return s},b.reduce=b.foldl=b.inject=t(1),b.reduceRight=b.foldr=t(-1),b.find=b.detect=function(t,e,i){var r;return r=S(t)?b.findIndex(t,e,i):b.findKey(t,e,i),void 0!==r&&r!==-1?t[r]:void 0},b.filter=b.select=function(t,e,i){var r=[];return e=_(e,i),b.each(t,function(t,i,n){e(t,i,n)&&r.push(t)}),r},b.reject=function(t,e,i){return b.filter(t,b.negate(_(e)),i)},b.every=b.all=function(t,e,i){e=_(e,i);for(var r=!S(t)&&b.keys(t),n=(r||t).length,s=0;n>s;s++){var o=r?r[s]:s;if(!e(t[o],o,t))return!1}return!0},b.some=b.any=function(t,e,i){e=_(e,i);for(var r=!S(t)&&b.keys(t),n=(r||t).length,s=0;n>s;s++){var o=r?r[s]:s;if(e(t[o],o,t))return!0}return!1},b.contains=b.includes=b.include=function(t,e,i,r){return S(t)||(t=b.values(t)),("number"!=typeof i||r)&&(i=0),b.indexOf(t,e,i)>=0},b.invoke=function(t,e){var i=c.call(arguments,2),r=b.isFunction(e);return b.map(t,function(t){var n=r?e:t[e];return null==n?n:n.apply(t,i)})},b.pluck=function(t,e){return b.map(t,b.property(e))},b.where=function(t,e){return b.filter(t,b.matcher(e))},b.findWhere=function(t,e){return b.find(t,b.matcher(e))},b.max=function(t,e,i){var r,n,s=-1/0,o=-1/0;if(null==e&&null!=t){t=S(t)?t:b.values(t);for(var a=0,l=t.length;l>a;a++)r=t[a],r>s&&(s=r)}else e=_(e,i),b.each(t,function(t,i,r){n=e(t,i,r),(n>o||n===-1/0&&s===-1/0)&&(s=t,o=n)});return s},b.min=function(t,e,i){var r,n,s=1/0,o=1/0;if(null==e&&null!=t){t=S(t)?t:b.values(t);for(var a=0,l=t.length;l>a;a++)r=t[a],s>r&&(s=r)}else e=_(e,i),b.each(t,function(t,i,r){n=e(t,i,r),(o>n||1/0===n&&1/0===s)&&(s=t,o=n)});return s},b.shuffle=function(t){for(var e,i=S(t)?t:b.values(t),r=i.length,n=Array(r),s=0;r>s;s++)e=b.random(0,s),e!==s&&(n[s]=n[e]),n[e]=i[s];return n},b.sample=function(t,e,i){return null==e||i?(S(t)||(t=b.values(t)),t[b.random(t.length-1)]):b.shuffle(t).slice(0,Math.max(0,e))},b.sortBy=function(t,e,i){return e=_(e,i),b.pluck(b.map(t,function(t,i,r){return{value:t,index:i,criteria:e(t,i,r)}}).sort(function(t,e){var i=t.criteria,r=e.criteria;if(i!==r){if(i>r||void 0===i)return 1;if(r>i||void 0===r)return-1}return t.index-e.index}),"value")};var M=function(t){return function(e,i,r){var n={};return i=_(i,r),b.each(e,function(r,s){var o=i(r,s,e);t(n,r,o)}),n}};b.groupBy=M(function(t,e,i){b.has(t,i)?t[i].push(e):t[i]=[e]}),b.indexBy=M(function(t,e,i){t[i]=e}),b.countBy=M(function(t,e,i){b.has(t,i)?t[i]++:t[i]=1}),b.toArray=function(t){return t?b.isArray(t)?c.call(t):S(t)?b.map(t,b.identity):b.values(t):[]},b.size=function(t){return null==t?0:S(t)?t.length:b.keys(t).length},b.partition=function(t,e,i){e=_(e,i);var r=[],n=[];return b.each(t,function(t,i,s){(e(t,i,s)?r:n).push(t)}),[r,n]},b.first=b.head=b.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:b.initial(t,t.length-e)},b.initial=function(t,e,i){return c.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},b.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:b.rest(t,Math.max(0,t.length-e))},b.rest=b.tail=b.drop=function(t,e,i){return c.call(t,null==e||i?1:e)},b.compact=function(t){return b.filter(t,b.identity)};var k=function(t,e,i,r){for(var n=[],s=0,o=r||0,a=I(t);a>o;o++){var l=t[o];if(S(l)&&(b.isArray(l)||b.isArguments(l))){e||(l=k(l,e,i));var h=0,u=l.length;for(n.length+=u;u>h;)n[s++]=l[h++]}else i||(n[s++]=l)}return n};b.flatten=function(t,e){return k(t,e,!1)},b.without=function(t){return b.difference(t,c.call(arguments,1))},b.uniq=b.unique=function(t,e,i,r){b.isBoolean(e)||(r=i,i=e,e=!1),null!=i&&(i=_(i,r));for(var n=[],s=[],o=0,a=I(t);a>o;o++){var l=t[o],h=i?i(l,o,t):l;e?(o&&s===h||n.push(l),s=h):i?b.contains(s,h)||(s.push(h),n.push(l)):b.contains(n,l)||n.push(l)}return n},b.union=function(){return b.uniq(k(arguments,!0,!0))},b.intersection=function(t){
for(var e=[],i=arguments.length,r=0,n=I(t);n>r;r++){var s=t[r];if(!b.contains(e,s)){for(var o=1;i>o&&b.contains(arguments[o],s);o++);o===i&&e.push(s)}}return e},b.difference=function(t){var e=k(arguments,!0,!0,1);return b.filter(t,function(t){return!b.contains(e,t)})},b.zip=function(){return b.unzip(arguments)},b.unzip=function(t){for(var e=t&&b.max(t,I).length||0,i=Array(e),r=0;e>r;r++)i[r]=b.pluck(t,r);return i},b.object=function(t,e){for(var i={},r=0,n=I(t);n>r;r++)e?i[t[r]]=e[r]:i[t[r][0]]=t[r][1];return i},b.findIndex=e(1),b.findLastIndex=e(-1),b.sortedIndex=function(t,e,i,r){i=_(i,r,1);for(var n=i(e),s=0,o=I(t);o>s;){var a=Math.floor((s+o)/2);i(t[a])<n?s=a+1:o=a}return s},b.indexOf=i(1,b.findIndex,b.sortedIndex),b.lastIndexOf=i(-1,b.findLastIndex),b.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var r=Math.max(Math.ceil((e-t)/i),0),n=Array(r),s=0;r>s;s++,t+=i)n[s]=t;return n};var E=function(t,e,i,r,n){if(!(r instanceof e))return t.apply(i,n);var s=C(t.prototype),o=t.apply(s,n);return b.isObject(o)?o:s};b.bind=function(t,e){if(m&&t.bind===m)return m.apply(t,c.call(arguments,1));if(!b.isFunction(t))throw new TypeError("Bind must be called on a function");var i=c.call(arguments,2),r=function(){return E(t,r,e,this,i.concat(c.call(arguments)))};return r},b.partial=function(t){var e=c.call(arguments,1),i=function(){for(var r=0,n=e.length,s=Array(n),o=0;n>o;o++)s[o]=e[o]===b?arguments[r++]:e[o];for(;r<arguments.length;)s.push(arguments[r++]);return E(t,i,this,this,s)};return i},b.bindAll=function(t){var e,i,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(e=1;r>e;e++)i=arguments[e],t[i]=b.bind(t[i],t);return t},b.memoize=function(t,e){var i=function(r){var n=i.cache,s=""+(e?e.apply(this,arguments):r);return b.has(n,s)||(n[s]=t.apply(this,arguments)),n[s]};return i.cache={},i},b.delay=function(t,e){var i=c.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},b.defer=b.partial(b.delay,b,1),b.throttle=function(t,e,i){var r,n,s,o=null,a=0;i||(i={});var l=function(){a=i.leading===!1?0:b.now(),o=null,s=t.apply(r,n),o||(r=n=null)};return function(){var h=b.now();a||i.leading!==!1||(a=h);var u=e-(h-a);return r=this,n=arguments,0>=u||u>e?(o&&(clearTimeout(o),o=null),a=h,s=t.apply(r,n),o||(r=n=null)):o||i.trailing===!1||(o=setTimeout(l,u)),s}},b.debounce=function(t,e,i){var r,n,s,o,a,l=function(){var h=b.now()-o;e>h&&h>=0?r=setTimeout(l,e-h):(r=null,i||(a=t.apply(s,n),r||(s=n=null)))};return function(){s=this,n=arguments,o=b.now();var h=i&&!r;return r||(r=setTimeout(l,e)),h&&(a=t.apply(s,n),s=n=null),a}},b.wrap=function(t,e){return b.partial(e,t)},b.negate=function(t){return function(){return!t.apply(this,arguments)}},b.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,r=t[e].apply(this,arguments);i--;)r=t[i].call(this,r);return r}},b.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},b.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),1>=t&&(e=null),i}},b.once=b.partial(b.before,2);var P=!{toString:null}.propertyIsEnumerable("toString"),R=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];b.keys=function(t){if(!b.isObject(t))return[];if(g)return g(t);var e=[];for(var i in t)b.has(t,i)&&e.push(i);return P&&n(t,e),e},b.allKeys=function(t){if(!b.isObject(t))return[];var e=[];for(var i in t)e.push(i);return P&&n(t,e),e},b.values=function(t){for(var e=b.keys(t),i=e.length,r=Array(i),n=0;i>n;n++)r[n]=t[e[n]];return r},b.mapObject=function(t,e,i){e=_(e,i);for(var r,n=b.keys(t),s=n.length,o={},a=0;s>a;a++)r=n[a],o[r]=e(t[r],r,t);return o},b.pairs=function(t){for(var e=b.keys(t),i=e.length,r=Array(i),n=0;i>n;n++)r[n]=[e[n],t[e[n]]];return r},b.invert=function(t){for(var e={},i=b.keys(t),r=0,n=i.length;n>r;r++)e[t[i[r]]]=i[r];return e},b.functions=b.methods=function(t){var e=[];for(var i in t)b.isFunction(t[i])&&e.push(i);return e.sort()},b.extend=w(b.allKeys),b.extendOwn=b.assign=w(b.keys),b.findKey=function(t,e,i){e=_(e,i);for(var r,n=b.keys(t),s=0,o=n.length;o>s;s++)if(r=n[s],e(t[r],r,t))return r},b.pick=function(t,e,i){var r,n,s={},o=t;if(null==o)return s;b.isFunction(e)?(n=b.allKeys(o),r=x(e,i)):(n=k(arguments,!1,!1,1),r=function(t,e,i){return e in i},o=Object(o));for(var a=0,l=n.length;l>a;a++){var h=n[a],u=o[h];r(u,h,o)&&(s[h]=u)}return s},b.omit=function(t,e,i){if(b.isFunction(e))e=b.negate(e);else{var r=b.map(k(arguments,!1,!1,1),String);e=function(t,e){return!b.contains(r,e)}}return b.pick(t,e,i)},b.defaults=w(b.allKeys,!0),b.create=function(t,e){var i=C(t);return e&&b.extendOwn(i,e),i},b.clone=function(t){return b.isObject(t)?b.isArray(t)?t.slice():b.extend({},t):t},b.tap=function(t,e){return e(t),t},b.isMatch=function(t,e){var i=b.keys(e),r=i.length;if(null==t)return!r;for(var n=Object(t),s=0;r>s;s++){var o=i[s];if(e[o]!==n[o]||!(o in n))return!1}return!0};var D=function(t,e,i,r){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof b&&(t=t._wrapped),e instanceof b&&(e=e._wrapped);var n=d.call(t);if(n!==d.call(e))return!1;switch(n){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var s="[object Array]"===n;if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var o=t.constructor,a=e.constructor;if(o!==a&&!(b.isFunction(o)&&o instanceof o&&b.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],r=r||[];for(var l=i.length;l--;)if(i[l]===t)return r[l]===e;if(i.push(t),r.push(e),s){if(l=t.length,l!==e.length)return!1;for(;l--;)if(!D(t[l],e[l],i,r))return!1}else{var h,u=b.keys(t);if(l=u.length,b.keys(e).length!==l)return!1;for(;l--;)if(h=u[l],!b.has(e,h)||!D(t[h],e[h],i,r))return!1}return i.pop(),r.pop(),!0};b.isEqual=function(t,e){return D(t,e)},b.isEmpty=function(t){return null==t||(S(t)&&(b.isArray(t)||b.isString(t)||b.isArguments(t))?0===t.length:0===b.keys(t).length)},b.isElement=function(t){return!(!t||1!==t.nodeType)},b.isArray=f||function(t){return"[object Array]"===d.call(t)},b.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},b.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){b["is"+t]=function(e){return d.call(e)==="[object "+t+"]"}}),b.isArguments(arguments)||(b.isArguments=function(t){return b.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(b.isFunction=function(t){return"function"==typeof t||!1}),b.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},b.isNaN=function(t){return b.isNumber(t)&&t!==+t},b.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===d.call(t)},b.isNull=function(t){return null===t},b.isUndefined=function(t){return void 0===t},b.has=function(t,e){return null!=t&&p.call(t,e)},b.noConflict=function(){return s._=o,this},b.identity=function(t){return t},b.constant=function(t){return function(){return t}},b.noop=function(){},b.property=T,b.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},b.matcher=b.matches=function(t){return t=b.extendOwn({},t),function(e){return b.isMatch(e,t)}},b.times=function(t,e,i){var r=Array(Math.max(0,t));e=x(e,i,1);for(var n=0;t>n;n++)r[n]=e(n);return r},b.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},b.now=Date.now||function(){return(new Date).getTime()};var N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},L=b.invert(N),F=function(t){var e=function(e){return t[e]},i="(?:"+b.keys(t).join("|")+")",r=RegExp(i),n=RegExp(i,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(n,e):t}};b.escape=F(N),b.unescape=F(L),b.result=function(t,e,i){var r=null==t?void 0:t[e];return void 0===r&&(r=i),b.isFunction(r)?r.call(t):r};var O=0;b.uniqueId=function(t){var e=++O+"";return t?t+e:e},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,U={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},z=/\\|'|\r|\n|\u2028|\u2029/g,j=function(t){return"\\"+U[t]};b.template=function(t,e,i){!e&&i&&(e=i),e=b.defaults({},e,b.templateSettings);var r=RegExp([(e.escape||B).source,(e.interpolate||B).source,(e.evaluate||B).source].join("|")+"|$","g"),n=0,s="__p+='";t.replace(r,function(e,i,r,o,a){return s+=t.slice(n,a).replace(z,j),n=a+e.length,i?s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),e}),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(e.variable||"obj","_",s)}catch(t){throw t.source=s,t}var a=function(t){return o.call(this,t,b)},l=e.variable||"obj";return a.source="function("+l+"){\n"+s+"}",a},b.chain=function(t){var e=b(t);return e._chain=!0,e};var G=function(t,e){return t._chain?b(e).chain():e};b.mixin=function(t){b.each(b.functions(t),function(e){var i=b[e]=t[e];b.prototype[e]=function(){var t=[this._wrapped];return u.apply(t,arguments),G(this,i.apply(b,t))}})},b.mixin(b),b.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];b.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],G(this,i)}}),b.each(["concat","join","slice"],function(t){var e=a[t];b.prototype[t]=function(){return G(this,e.apply(this._wrapped,arguments))}}),b.prototype.value=function(){return this._wrapped},b.prototype.valueOf=b.prototype.toJSON=b.prototype.value,b.prototype.toString=function(){return""+this._wrapped},"function"==typeof r&&r.amd&&r("underscore",[],function(){return b})}.call(this),r("underscore-min",function(t){return function(){var e,i;return i=function(){return _.noConflict()},e=i.apply(t,arguments),e||t._}}(this)),r("Utils/Constants",[],function(){var t=function(){};return t.ANIMATION={Inertia:"Inertia",Interpolated:"Interpolated",Path:"Path",Segmented:"Segmented"},t.CONTEXT={Planet:"Planet",Sky:"Sky"},t.GLOBE={Planet:"Planet",Sky:"Sky"},t.LAYER={WMS:"WMS",WMTS:"WMTS",WMSElevation:"WMSElevation",WCSElevation:"WCSElevation",GeoJSON:"GeoJSON",Vector:"Vector",Atmosphere:"Atmosphere",Bing:"Bing",GroundOverlay:"GroundOverlay",OSM:"OSM",TileWireframe:"TileWireframe",HipsGrid:"HipsGrid",CoordinateGrid:"CoordinateGrid",HipsFits:"HipsFits",Hips:"Hips",HipsCat:"HipsCat",Moc:"Moc",OpenSearch:"OpenSearch",Planet:"Planet"},t.GEOMETRY={Point:"Point",MultiPoint:"MultiPoint",LineString:"LineString",MultiLineString:"MultiLineString",Polygon:"Polygon",MultiPolygon:"MultiPolygon",GeometryCollection:"GeometryCollection"},t.PROJECTION={Aitoff:"Aitoff",August:"August",Mercator:"Mercator",Mollweide:"Mollweide",Plate:"Plate",Azimuth:"Azimuth"},t.CRS={Equatorial:"Equatorial",Galactic:"Galactic",WGS84:"EPSG:4326",Mars_2000:"IAU2000:49901",Mars_2000_old:"IAU2000:49900"},t.NAVIGATION={AstroNavigation:"AstroNavigation",PlanetNavigation:"PlanetNavigation",FlatNavigation:"FlatNavigation"},t.SERVICE={FitsVisu:"FitsVisu",Histogram:"Histogram",ImageProcessing:"ImageProcessing",MeasureToolSky:"MeasureToolSky",MeasureToolPlanet:"MeasureToolPlanet",MocBase:"MocBase",MollweideViewer:"MollweideViewer",PickingManager:"PickingManager",Samp:"Samp",SelectionTool:"SelectionTool",NameResolver:"NameResolver",ReverseNameResolver:"ReverseNameResolver",ExportTool:"ExportTool"},t.HANDLER={Touch:"Touch",Keyboard:"Keyboard",Mouse:"Mouse",GoogleMouse:"GoogleMouse"},t.PROVIDER={Constellation:"Constellation",OpenSearch:"OpenSearch",Planet:"Planet",Star:"Star",Crater:"Crater"},t.MappingCrsHips2Mizar={equatorial:"Equatorial",galactic:"Galactic",ecliptic:"Ecliptic"},t.UTILITY={Fits:"Fits",Intersection:"Intersection",Numeric:"Numeric",CreateStyle:"CreateStyle",FeatureStyle:"FeatureStyle"},t.ANIMATION_STATUS={STOPPED:"STOPPED",RUNNING:"RUNNING",PAUSED:"PAUSED"},t}),r("Utils/Utils",[],function(){function t(t,e,i){var r,n,s,o=Math.floor(6*t),a=6*t-o,l=i*(1-e),h=i*(1-a*e),u=i*(1-(1-a)*e);switch(o){case 0:r=i,n=u,s=l;break;case 1:r=h,n=i,s=l;break;case 2:r=l,n=i,s=u;break;case 3:r=l,n=h,s=i;break;case 4:r=u,n=l,s=i;break;case 5:r=i,n=l,s=h;break;default:r=1,n=1,s=1}return[r,n,s]}var e={};return e.inherits=function(t,e){function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},e.generateColor=function(){var e=.618033988749895,i=Math.random();return i+=e,i%=1,t(i,.5,.95)},e}),r("Utils/Event",[],function(){var t=function(){this.callbacks={}};return t.prototype.subscribe=function(t,e){this.callbacks[t]?this.callbacks[t].push(e):this.callbacks[t]=[e]},t.prototype.unsubscribe=function(t,e){if(this.callbacks[t]){var i=this.callbacks[t].indexOf(e);i!==-1&&this.callbacks[t].splice(i,1)}},t.prototype.publish=function(t,e){if(this.callbacks[t])for(var i=this.callbacks[t],r=0;r<i.length;r++)i[r](e)},t}),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};t="undefined"!=typeof exports&&null!==exports&&this||(this.WCS={}),t.Math={},t.Math.R2D=180/Math.PI,t.Math.D2R=Math.PI/180,t.Math.WCSTRIG_TOL=1e-10,t.Math.cosd=function(e){var i;if(e%90===0)switch(i=Math.abs(Math.floor(e/90+.5))%4){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}return Math.cos(e*t.Math.D2R)},t.Math.sind=function(e){var i;if(e%90===0)switch(i=Math.abs(Math.floor(e/90-.5))%4){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}return Math.sin(e*t.Math.D2R)},t.Math.sincosd=function(e){var i,r,n,s,o;if(e%90===0){switch(r=Math.abs(Math.floor(e/90+.5))%4){case 0:n=0,i=1;break;case 1:n=null!=(s=e>0)?s:{1:-1},i=0;break;case 2:n=0,i=-1;break;case 3:n=null!=(o=e>0)?o:-{1:1},i=0}return n*i}return n=Math.sin(e*t.Math.D2R),i=Math.cos(e*t.Math.D2R),n*i},t.Math.tand=function(e){var i;return i=360&e,0===i||180===Math.abs(i)?0:45===i||225===i?1:i===-135||i===-315?-1:Math.tan(e*t.Math.D2R)},t.Math.acosd=function(e){if(e>=1){if(e-1<t.Math.WCSTRIG_TOL)return 0}else{if(0===e)return 90;if(e<=-1&&e+1>-t.Math.WCSTRIG_TOL)return 180}return Math.acos(e)*t.Math.R2D},t.Math.asind=function(e){if(e<=-1){if(e+1>-t.Math.WCSTRIG_TOL)return-90;if(0===e)return 0;if(e>=1&&e-1<t.Math.WCSTRIG_TOL)return 90}return Math.asin(e)*t.Math.R2D},t.Math.atand=function(e){return e===-1?-45:0===e?0:1===e?45:Math.atan(e)*t.Math.R2D},t.Math.atan2d=function(e,i){if(0===e){if(i>=0)return 0;if(i<0)return 180}else if(0===i){if(e>0)return 90;if(e<0)return-90}return Math.atan2(e,i)*t.Math.R2D},t.Math.toRightTriangular=function(t){var e,i,r,n,s,o,a,l,h;for(a=t.length,n=a,s=t[0].length;;){if(i=n-a,0===t[i][i])for(r=i+1;r<n;){if(0!==t[r][i]){for(e=[],l=s;;)if(h=s-l,e.push(t[i][h]+t[r][h]),!--l)break;t[i]=e;break}r+=1}if(0!==t[i][i])for(r=i+1;r<n;){for(o=t[r][i]/t[i][i],e=[],l=s;;)if(h=s-l,e.push(h<=i?0:t[r][h]-t[i][h]*o),!--l)break;t[r]=e,r+=1}if(!--a)break}return t},t.Math.determinant=function(e){var i,r,n,s,o;for(s=t.Math.toRightTriangular(e),i=s[0][0],o=s.length-1,n=o;;)if(r=n-o+1,i*=s[r][r],!--o)break;return i},t.Math.matrixInverse=function(e){var i,r,n,s,o,a,l,h;for(h=e[0].length,r=e.length,i=new Array(r),s=new Array(r),l=[],a=[],o=0;o<r;){for(a[o]=[],n=0;n<h;)a[o][n]=e[o][n],n+=1;o+=1}for(o=0;o<r;){for(i[o]=new Array(h),s[o]=new Array(h),n=0;n<h;)i[o][n]=n===o?1:0,n+=1;l[o]=a[o].concat(i[o]),o+=1}for(t.Math.gaussJordan(l),o=0;o<r;)s[o]=l[o].slice(h,2*h),o+=1;return s},t.Math.gaussJordan=function(t,e){e||(e=1e-10);var i,r,n,s,o,a,l,h;for(i=t.length,r=t[0].length,n=-1;++n<i;){for(a=n,s=n;++s<i;)Math.abs(t[s][n])>Math.abs(t[a][n])&&(a=s);if(l=t[n],t[n]=t[a],t[a]=l,Math.abs(t[n][n])<=e)return!1;for(s=n;++s<i;)for(h=t[s][n]/t[n][n],o=n-1;++o<r;)t[s][o]-=t[n][o]*h}for(n=i;--n>=0;){for(h=t[n][n],s=-1;++s<n;)for(o=r;--o>=n;)t[s][o]-=t[n][o]*t[s][n]/h;for(t[n][n]/=h,o=i-1;++o<r;)t[n][o]/=h}return!0},t.Mapper=function(){function r(t){this.coordinateToPixel=e(this.coordinateToPixel,this),this.pixelToCoordinate=e(this.pixelToCoordinate,this),this.fromCelestial=e(this.fromCelestial,this),this.toCelestial=e(this.toCelestial,this),this.fromIntermediate=e(this.fromIntermediate,this),this.toIntermediate=e(this.toIntermediate,this),this.computeCelestialParameters=e(this.computeCelestialParameters,this),this.getSipCoefficients=e(this.getSipCoefficients,this),this.setProjection=e(this.setProjection,this),this.derivePC=e(this.derivePC,this),this.checkCard=e(this.checkCard,this),this.verifyHeader=e(this.verifyHeader,this),this.wcsobj={},this.projection=void 0,this.longitudeAxis=void 0,this.latitudeAxis=void 0,this.sip=void 0,this.verifyHeader(t),this.setProjection(t)}return r.prototype.verifyHeader=function(e){var i,r,n,s,o,a,l,h,u,c,d;for(this.wcsobj.naxis=a=e.NAXIS||e.WCSAXES||2,this.wcsobj.radesys=e.RADESYS||"ICRS",l=["CRPIX","CRVAL","CTYPE"],this.wcsobj.crpix=[],this.wcsobj.crval=[],this.wcsobj.ctype=[],r=h=1;1<=a?h<=a:h>=a;r=1<=a?++h:--h)for(s=u=0,d=l.length-1;0<=d?u<=d:u>=d;s=0<=d?++u:--u){if(o=l[s]+r,!e.hasOwnProperty(o))throw"Not enough information to compute WCS, missing required keyword "+o;i=l[s].toLowerCase(),this.wcsobj[i].push(e[o])}for(this.wcsobj.cunit=[],this.wcsobj.cdelt=[],r=c=1;1<=a?c<=a:c>=a;r=1<=a?++c:--c)o="CUNIT"+r,this.wcsobj.cunit.push(e[o]||"deg"),o="CDELT"+r,this.wcsobj.cdelt.push(e[o]||1);if(this.wcsobj.lonpole=e.LONPOLE||0,this.wcsobj.latpole=e.LATPOLE||0,this.wcsobj.equinox=e.EQUINOX||2e3,n=new Date,this.wcsobj.dateObs=e.DATE_OBS||n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),this.wcsobj.dateObs=e.DATE_OBS||""+n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),this.wcsobj.pc=this.checkCard(e,"PC",a)||this.derivePC(e),this.wcsobj.pcInv=t.Math.matrixInverse(this.wcsobj.pc),this.wcsobj.cd=this.checkCard(e,"CD",a),null!=this.wcsobj.cd)return this.wcsobj.cdInv=t.Math.matrixInverse(this.wcsobj.cd)},r.prototype.checkCard=function(t,e,i){var r,n,s,o,a,l;for(o=[],n=a=1;1<=i?a<=i:a>=i;n=1<=i?++a:--a)for(o[n-1]=[],s=l=1;1<=i?l<=i:l>=i;s=1<=i?++l:--l){if(r=""+e+n+"_"+s,!t.hasOwnProperty(r))return;o[n-1].push(t[r])}return o},r.prototype.derivePC=function(t){var e,i,r,n,s,o,a,l,h,u,c;return t.hasOwnProperty("CROTA2")?(a=t.CROTA2,l=this.wcsobj.cdelt[1]/this.wcsobj.cdelt[0]):(e=this.checkCard(t,"CD",this.wcsobj.naxis),null==e?(c=[0,1],a=c[0],l=c[1]):(i=e[0][0],r=e[0][1],n=e[1][0],s=e[1][1],h=n>0?Math.atan2(n,i):0===n?0:Math.atan2(-n,-i),u=r>0?Math.atan2(r,-s):0===r?0:Math.atan2(-n,s),a=.5*(h+u),o=Math.cos(a),this.wcsobj.cdelt1=i/o,this.wcsobj.cdelt2=s/o,l=this.wcsobj.cdelt2/this.wcsobj.cdelt1)),e},r.prototype.setProjection=function(e){var r,n,s,o,a,l,h,u,c,d,p,f,g,m,v,y,b,x,_=this;if(c=["AIR","ARC","AZP","NCP","SIN","STG","SZP","TAN","TAN-SIP","ZEA","ZPN"],n=["CYP","CEA","CAR","MER","SFL","PAR","MOL","AIT"],r=["COP","COE","COD","COO"],h=["BON","PCO"],u=["TSC","CSC","QSC"],this.projection=this.wcsobj.ctype[0].slice(5),this.longitudeAxis=this.wcsobj.ctype[0].match("RA|GLON|ELON|HLON|SLON")?1:2,this.latitudeAxis=this.wcsobj.ctype[1].match("DEC|GLAT|ELAT|HLAT|SLAT")?2:1,d=this.projection,i.call(c,d)>=0)switch(this.wcsobj.phi0=0,this.wcsobj.theta0=90,this.wcsobj.alphaP=this.wcsobj.crval[0],this.wcsobj.deltaP=this.wcsobj.crval[1],this.wcsobj.lonpole=this.wcsobj.crval[1]>=this.wcsobj.theta0?0:180,this.projection){case"AIR":s="PV"+this.latitudeAxis+"_1",this.wcsobj.thetaB=e.hasOwnProperty(s)?parseFloat(e[s]):90,this.wcsobj.etaB=(90-this.wcsobj.thetaB)/2;break;case"ARC":this.toSpherical=function(e,i){var r,n,s;return n=Math.sqrt(e*e+i*i),s=_.wcsobj.theta0-n,r=t.Math.atan2d(e,-i),[r,s]},this.fromSpherical=function(e,i){var r,n,s;return r=90-i,n=r*t.Math.sind(e),s=-r*t.Math.cosd(e),[n,s]};break;case"AZP":p=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2"],o=p[0],a=p[1],this.wcsobj.mu=e.hasOwnProperty(o)?parseFloat(e[o]):0,this.wcsobj.gamma=e.hasOwnProperty(a)?parseFloat(e[a]):0,this.toSpherical=function(t,e){throw"Sorry, not yet implemented!"},this.fromSpherical=function(t,e){throw"Sorry, not yet implemented!"};break;case"NCP":this.toSpherical=function(t,e){throw"Sorry, not yet implemented!"},this.fromSpherical=function(t,e){throw"Sorry, not yet implemented!"};break;case"SIN":f=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2"],o=f[0],a=f[1],this.wcsobj.eta=e.hasOwnProperty(o)?parseFloat(e[o]):0,this.wcsobj.nu=e.hasOwnProperty(a)?parseFloat(e[a]):0,this.toSpherical=function(e,i){var r,n,s;return n=Math.sqrt(e*e+i*i),s=t.Math.acosd(Math.PI*n/180),r=t.Math.atan2d(e,-i),[r,s]},this.fromSpherical=function(e,i){var r,n,s;return r=180/Math.PI*t.Math.cosd(i),n=r*t.Math.sind(e),s=-r*t.Math.cosd(e),[n,s]};break;case"STG":this.toSpherical=function(e,i){var r,n,s;return n=Math.sqrt(e*e+i*i),s=_.wcsobj.theta0-2*t.Math.atand(Math.PI*n/360),r=t.Math.atan2d(e,-i),[r,s]},this.fromSpherical=function(e,i){var r,n,s;return r=360/Math.PI*t.Math.tand((90-i)/2),n=r*t.Math.sind(e),s=-r*t.Math.cosd(e),[n,s]};break;case"SZP":g=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2","PV"+this.latitudeAxis+"_3"],o=g[0],a=g[1],l=g[2],this.wcsobj.mu=e.hasOwnProperty(o)?parseFloat(e[o]):0,this.wcsobj.phiC=e.hasOwnProperty(a)?parseFloat(e[a]):0,this.wcsobj.thetaC=e.hasOwnProperty(l)?parseFloat(e[l]):90,this.wcsobj.xp=-this.wcsobj.mu*t.Math.cosd(this.wcsobj.thetaC)*t.Math.sind(this.wcsobj.phiC),this.wcsobj.yp=this.wcsobj.mu*t.Math.cosd(this.wcsobj.thetaC)*t.Math.cosd(this.wcsobj.phiC),this.wcsobj.zp=this.wcsobj.mu*t.Math.sind(this.wcsobj.thetaC)+1,this.toSpherical=function(t,e){throw"Sorry, not yet implemented"},this.fromSpherical=function(e,i){var r,n,s;throw"Sorry, not yet implemented";return r=_.wcsobj.zp-1+t.Math.sind(i),n=180/Math.PI*(_.wcsobj.zp*t.Math.cosd(i)*t.Math.sind(e)-_.wcsobj.xp*(1-t.Math.sind(i)))/r,s=-180/Math.PI*(_.wcsobj.zp*t.Math.cosd(i)*t.Math.cosd(e)+_.wcsobj.yp*(1-t.Math.sind(i)))/r,[n,s]};break;case"TAN":this.toSpherical=function(e,i){var r,n,s;return n=Math.sqrt(e*e+i*i),s=t.Math.atand(180/(Math.PI*n)),r=t.Math.atan2d(e,-i),[r,s]},this.fromSpherical=function(e,i){var r,n,s;return r=180/(Math.PI*t.Math.tand(i)),n=r*t.Math.sind(e),s=-r*t.Math.cosd(e),[n,s]};break;case"TAN-SIP":this.getSipCoefficients(e),this.f=function(t,e,i){var r,n,s,o,a,l;for(o=0,r=i[0].length-1,n=a=0;0<=r?a<=r:a>=r;n=0<=r?++a:--a)for(s=l=0;0<=r?l<=r:l>=r;s=0<=r?++l:--l)o+=i[n][s]*Math.pow(t,n)*Math.pow(e,s);return o},this.toIntermediate=function(t){var e,i,r,n,s,o,a,l,h,u,c;for(s=[],o=t[0]-_.wcsobj.crpix[0],a=t[1]-_.wcsobj.crpix[1],e=i=0,e=_.f(o,a,_.sip.aCoeffs),i=_.f(o,a,_.sip.bCoeffs),t[0]=t[0]+e,t[1]=t[1]+i,r=l=0,u=_.wcsobj.naxis-1;0<=u?l<=u:l>=u;r=0<=u?++l:--l)for(s[r]=0,t[r]-=_.wcsobj.crpix[r],n=h=0,c=_.wcsobj-1;0<=c?h<=c:h>=c;n=0<=c?++h:--h)s[r]+=_.wcsobj.cd[r][n]*t[n];return s},this.fromIntermediate=function(t){var e,i,r,n,s,o,a,l,h,u;for(o=[],r=a=0,h=_.wcsobj.naxis-1;0<=h?a<=h:a>=h;r=0<=h?++a:--a){for(o[r]=0,n=l=0,u=_.wcsobj.naxis-1;0<=u?l<=u:l>=u;n=0<=u?++l:--l)o[r]+=_.wcsobj.cdInv[r][n]*t[n];o[r]+=_.wcsobj.crpix[r]}return e=i=0,e=_.f(o[0],o[1],_.sip.apCoeffs),i=_.f(o[0],o[1],_.sip.bpCoeffs),s=[],s[0]=o[0]+e,s[1]=o[1]+i,s[0]+=_.wcsobj.crpix[0],s[1]+=_.wcsobj.crpix[1],s},this.toSpherical=function(e,i){var r,n,s;return n=Math.sqrt(e*e+i*i),s=t.Math.atand(180/(Math.PI*n)),r=t.Math.atan2d(e,-i),[r,s]},this.fromSpherical=function(e,i){var r,n,s;return r=180/(Math.PI*t.Math.tand(i)),n=r*t.Math.sind(e),s=-r*t.Math.cosd(e),[n,s]};break;case"ZEA":this.toSpherical=function(e,i){var r,n,s;return n=Math.sqrt(e*e+i*i),s=_.wcsobj.theta0-2*t.Math.asind(Math.PI*n/360),r=t.Math.atan2d(e,-i),[r,s]},this.fromSpherical=function(e,i){var r,n,s;return r=360/Math.PI*t.Math.sind((90-i)/2),n=r*t.Math.sind(e),s=-r*t.Math.cosd(e),[n,s]};break;case"ZPN":this.toSpherical=function(t,e){throw"Sorry, not yet implemented!"},this.fromSpherical=function(t,e){throw"Sorry, not yet implemented!"}}if(m=this.projection,i.call(n,m)>=0)switch(this.wcsobj.phi0=0,this.wcsobj.theta0=0,this.computeCelestialParameters(this.wcsobj.phi0,this.wcsobj.theta0),this.projection){case"CYP":v=["PV"+this.latitudeAxis+"_1,","PV"+this.latitudeAxis+"_2"],o=v[0],a=v[1],this.wcsobj.mu=e.hasOwnProperty(o)?parseFloat(e[o]):1,this.wcsobj.lambda=e.hasOwnProperty(a)?parseFloat(e[a]):1,this.wcsobj.mu+this.wcsobj.lambda===0&&raise("Divide by zero error"),this.toSpherical=function(e,i){var r,n,s;return r=Math.PI*i/(180*(_.wcsobj.mu+_.wcsobj.lambda)),s=t.Math.atan2d(r,1)+t.Math.asind(r*_.wcsobj.mu/Math.sqrt(r*r+1)),n=e/_.wcsobj.lambda,[n,s]},this.fromSpherical=function(e,i){var r,n;return r=_.wcsobj.lambda*e,n=180/Math.PI*((_.wcsobj.mu+_.wcsobj.lambda)/(_.wcsobj.mu+t.Math.cosd(i)))*t.Math.sind(i),[r,n]};break;case"CEA":s="PV"+this.latitudeAxis+"_1",this.wcsobj.lambda=e.hasOwnProperty(s)?parseFloat(e[s]):1,this.toSpherical=function(e,i){var r;return r=t.Math.asind(Math.PI*_.wcsobj.lambda*i/180),[e,r]},this.fromSpherical=function(e,i){var r;return r=180/Math.PI*t.Math.sind(i)/_.wcsobj.lambda,[e,r]};break;case"CAR":this.toSpherical=function(t,e){return[t,e]},this.fromSpherical=function(t,e){return[t,e]};break;case"MER":this.toSpherical=function(e,i){var r;return r=2*t.Math.atand(Math.exp(i*Math.PI/180))-90,[e,r]},this.fromSpherical=function(e,i){var r;return r=180/Math.PI*Math.log(t.Math.tand((90+i)/2)),[e,r]};break;case"SFL":this.toSpherical=function(e,i){var r;return r=e/t.Math.cosd(i),[r,i]},this.fromSpherical=function(e,i){var r;return r=e*t.Math.cosd(i),[r,i]};break;case"PAR":this.toSpherical=function(e,i){var r,n;return n=3*t.Math.asind(i/180),r=e/(1-4*Math.pow(i/180,2)),[r,n]},this.fromSpherical=function(e,i){var r,n;return r=e*(2*t.Math.cosd(2*i/3)-1),n=180*t.Math.sind(i/3),[r,n]};break;case"MOL":this.toSpherical=function(e,i){var r,n;return n=t.Math.asind(t.Math.asind(Math.PI*i/(180*Math.sqrt(2)))/90+i/180*Math.sqrt(2-Math.pow(Math.PI*i/180,2))),r=Math.PI*e/(2*Math.sqrt(2-Math.pow(Math.PI*i/180,2))),[r,n]},this.fromSpherical=function(e,i){var r,n;throw"Sorry, not yet implemented!";return r=2*Math.sqrt(2)/Math.PI*e*t.Math.cosd(gamma),n=180*Math.sqrt(2)/Math.PI*t.Math.sind(gamma),[r,n]};break;case"AIT":this.toSpherical=function(e,i){var r,n,s,o,a;return s=Math.pow(Math.PI*e/720,2),o=Math.pow(Math.PI*i/360,2),a=Math.sqrt(1-s-o),n=t.Math.asind(Math.PI*i*a/180),r=2*t.Math.atan2d(Math.PI*a*e/360,2*a*a-1),[r,n]},this.fromSpherical=function(e,i){var r,n,s;return r=180/Math.PI*Math.sqrt(2/(1+t.Math.cosd(i)*t.Math.cosd(e/2))),n=2*r*t.Math.cosd(i)*t.Math.sind(e/2),s=r*t.Math.sind(i),[n,s]}}if(y=this.projection,i.call(r,y)>=0)throw s="PV"+this.latitudeAxis+"_1",this.wcsobj.phi0=0,this.wcsobj.theta0=e.hasOwnProperty(s)?e[s]:0,"Sorry, not yet implemented!";if(b=this.projection,i.call(h,b)>=0)throw this.wcsobj.phi0=0,this.wcsobj.theta0=0,"Sorry, not yet implemented!";if(x=this.projection,i.call(u,x)>=0)throw this.wcsobj.phi0=0,this.wcsobj.theta0=0,"Sorry, not yet implemented!"},r.prototype.getSipCoefficients=function(t){var e,i,r,n,s,o,a,l,h,u,c,d,p,f,g,m,v,y,b;if(!t.hasOwnProperty("A_ORDER")&&!t.hasOwnProperty("B_ORDER"))throw"What's the polynomial order, man!";for(this.sip={},this.sip.aOrder=t.A_ORDER,this.sip.bOrder=t.B_ORDER,this.sip.apOrder=t.AP_ORDER||0,this.sip.bpOrder=t.BP_ORDER||0,this.sip.aCoeffs=[],this.sip.bCoeffs=[],this.sip.apCoeffs=[],this.sip.bpCoeffs=[],e=n=0,d=this.sip.aOrder;0<=d?n<=d:n>=d;e=0<=d?++n:--n)for(this.sip.aCoeffs[e]=[],i=s=0,p=this.sip.aOrder;0<=p?s<=p:s>=p;i=0<=p?++s:--s)r="A_"+e+"_"+i,this.sip.aCoeffs[e][i]=t[r]||0;for(e=o=0,f=this.sip.bOrder;0<=f?o<=f:o>=f;e=0<=f?++o:--o)for(this.sip.bCoeffs[e]=[],i=a=0,g=this.sip.bOrder;0<=g?a<=g:a>=g;i=0<=g?++a:--a)r="B_"+e+"_"+i,this.sip.bCoeffs[e][i]=t[r]||0;for(e=l=0,m=this.sip.apOrder;0<=m?l<=m:l>=m;e=0<=m?++l:--l)for(this.sip.apCoeffs[e]=[],i=h=0,v=this.sip.apOrder;0<=v?h<=v:h>=v;i=0<=v?++h:--h)r="AP_"+e+"_"+i,this.sip.apCoeffs[e][i]=t[r]||0;for(e=u=0,y=this.sip.bpOrder;0<=y?u<=y:u>=y;e=0<=y?++u:--u)for(this.sip.bpCoeffs[e]=[],i=c=0,b=this.sip.bpOrder;0<=b?c<=b:c>=b;i=0<=b?++c:--c)r="BP_"+e+"_"+i,this.sip.bpCoeffs[e][i]=t[r]||0;if(!this.sip.aCoeffs&&!this.sip.bCoeffs)throw"Where are the coefficients dude!"},r.prototype.computeCelestialParameters=function(e,i){var r,n,s,o,a,l,h,u,c,d,p,f;return p=this.wcsobj.crval,r=p[0],n=p[1],f=[this.wcsobj.lonpole,this.wcsobj.latpole],h=f[0],d=f[1],s=t.Math.atan2d(t.Math.sind(this.wcsobj.theta0),t.Math.cosd(this.wcsobj.theta0*t.Math.cosd(h-this.wcsobj.phi0))),o=t.Math.acosd(t.Math.sind(n)/Math.sqrt(1-Math.pow(t.Math.cosd(this.wcsobj.theta0),2)*Math.pow(t.Math.sind(h-this.wcsobj.phi0),2))),u=c=!1,s+o>=-90&&s+o<=90&&(u=!0),s-o>=-90&&s-o<=90&&(c=!0),u&&c?(a=Math.abs(s+o-d),l=Math.abs(s-o-d),this.wcsobj.deltaP=a<l?s+o:s-o):u?this.wcsobj.deltaP=s+o:c?this.wcsobj.deltaP=s-o:this.wcsobj.deltaP=d,this.wcsobj.alphaP=90===Math.abs(n)?r:r-t.Math.asind(t.Math.sind(h-this.wcsobj.phi0)*t.Math.cosd(this.wcsobj.theta0)/t.Math.cosd(n))},r.prototype.toIntermediate=function(t){var e,i,r,n,s,o,a;for(r=[],e=n=0,o=this.wcsobj.naxis-1;0<=o?n<=o:n>=o;e=0<=o?++n:--n)for(r[e]=0,t[e]-=this.wcsobj.crpix[e],i=s=0,a=this.wcsobj.naxis-1;0<=a?s<=a:s>=a;i=0<=a?++s:--s)r[e]+=this.wcsobj.cdelt[e]*this.wcsobj.pc[e][i]*t[i];return r},r.prototype.fromIntermediate=function(t){var e,i,r,n,s,o,a;for(r=[],e=n=0,o=this.wcsobj.naxis-1;0<=o?n<=o:n>=o;e=0<=o?++n:--n){for(r[e]=0,i=s=0,a=this.wcsobj.naxis-1;0<=a?s<=a:s>=a;i=0<=a?++s:--s)r[e]+=this.wcsobj.pcInv[e][i]*t[i]/this.wcsobj.cdelt[e];r[e]+=this.wcsobj.crpix[e]}return r},r.prototype.toCelestial=function(e,i){var r,n,s,o,a,l,h,u,c,d,p;return u=t.Math.sind(i),s=t.Math.cosd(i),h=t.Math.sind(e-this.wcsobj.lonpole),n=t.Math.cosd(e-this.wcsobj.lonpole),l=t.Math.sind(this.wcsobj.deltaP),r=t.Math.cosd(this.wcsobj.deltaP),c=u*r-s*l*n,d=-s*h,p=u*l+s*r*n,a=t.Math.atan2d(d,c)+this.wcsobj.alphaP,a=(a+360)%360,o=t.Math.asind(p),[a,o]},r.prototype.fromCelestial=function(e,i){var r,n,s,o,a,l,h,u,c,d;return l=t.Math.sind(i),n=t.Math.cosd(i),h=t.Math.sind(this.wcsobj.deltaP),s=t.Math.cosd(this.wcsobj.deltaP),a=t.Math.sind(e-this.wcsobj.alphaP),r=t.Math.cosd(e-this.wcsobj.alphaP),c=l*s-n*h*r,d=-n*a,o=this.wcsobj.lonpole+t.Math.atan2d(d,c),u=t.Math.asind(l*h+n*s*r),[o,u]},r.prototype.pixelToCoordinate=function(){var t;return t=this.toIntermediate(arguments[0],arguments[1]),t=this.toSpherical(t[0],t[1]),t=this.toCelestial(t[0],t[1]),{ra:t[this.longitudeAxis-1],dec:t[this.latitudeAxis-1]}},r.prototype.coordinateToPixel=function(){var t;return t=this.fromCelestial(arguments[0],arguments[1]),t=this.fromSpherical(t[0],t[1]),t=this.fromIntermediate(t),{x:t[0],y:t[1]}},r}()}.call(this),r("wcs",function(){}),r("Utils/UtilsFits",["wcs"],function(t){function e(e,i){var r=t.pixelToCoordinate([e,i]);return[r.ra,r.dec]}var i={};return i.getPolygonCoordinatesFromFits=function(i){var r=i.getHDU(),n=r.data;t=new WCS.Mapper(r.header);var s=[];return s.push(e(0,n.height)),s.push(e(n.width,n.height)),s.push(e(n.width,0)),s.push(e(0,0)),s.push(s[0]),s},i}),r("Utils/Numeric",[],function(){var t={};return t.lerp=function(t,e,i){return e+(i-e)*t},t.coserp=function(t,e,i){var r=(1-Math.cos(t*Math.PI))/2;return e+(i-e)*r},t.cubicInterpolation=function(t,e,i,r,n){var s=t*t,o=s*t,a=2*e[0]-2*r[0]+i[0]+n[0],l=2*e[1]-2*r[1]+i[1]+n[1],h=2*e[2]-2*r[2]+i[2]+n[2],u=-3*e[0]+3*r[0]-2*i[0]-n[0],c=-3*e[1]+3*r[1]-2*i[1]-n[1],d=-3*e[2]+3*r[2]-2*i[2]-n[2],p=vec3.create();return p[0]=a*o+u*s+i[0]*t+e[0],p[1]=l*o+c*s+i[1]*t+e[1],p[2]=h*o+d*s+i[2]*t+e[2],p},t.cubicInterpolationDerivative=function(t,e,i,r,n){var s=t*t,o=6*e[0]-6*r[0]+3*i[0]+3*n[0],a=6*e[1]-6*r[1]+3*i[1]+3*n[1],l=6*e[2]-6*r[2]+3*i[2]+3*n[2],h=-6*e[0]+6*r[0]-4*i[0]-2*n[0],u=-6*e[1]+6*r[1]-4*i[1]-2*n[1],c=-6*e[2]+6*r[2]-4*i[2]-2*n[2],d=vec3.create();return d[0]=o*s+h*t+i[0],d[1]=a*s+u*t+i[1],d[2]=l*s+c*t+i[2],d},t.map01=function(t,e,i){return e!==i?(t-e)/(i-e):0},t.mapLinear=function(e,i,r,n,s){return t.lerp(t.map01(e,i,r),n,s)},t.easeInQuad=function(t){return t*t},t.easeOutQuad=function(t){var e=t-1;return 1-e*e},t.easeInOutQuad=function(t){
var e=t;return e<.5?(e+=e,e=.5*(e*e)):(e=e+e-2,e=.5*(1-e*e),e=.5+e),e},t.easeOutInQuad=function(t){var e=t;return e<.5?(e=e+e-1,e=.5*(1-e*e)):(e=e+e-1,e=.5*(e*e),e=.5+e),e},t.toRadian=function(t){return t*Math.PI/180},t.toDegree=function(t){return 180*t/Math.PI},t.lineIntersection=function(t,e,i,r,n,s,o,a){var l=(a-s)*(i-t)-(o-n)*(r-e);if(0===l)return[-1,-1];var h=(o-n)*(e-s)-(a-s)*(t-n),u=(i-t)*(e-s)-(r-e)*(t-n);return h/=l,u/=l,[h,u]},t.roundNumber=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},t.sign=function(t){return t<0?-1:t>0?1:0},t}),r("Tiling/HEALPixTables",[],function(){var t={ctab:[0,1,256,257,2,3,258,259,512,513,768,769,514,515,770,771,4,5,260,261,6,7,262,263,516,517,772,773,518,519,774,775,1024,1025,1280,1281,1026,1027,1282,1283,1536,1537,1792,1793,1538,1539,1794,1795,1028,1029,1284,1285,1030,1031,1286,1287,1540,1541,1796,1797,1542,1543,1798,1799,8,9,264,265,10,11,266,267,520,521,776,777,522,523,778,779,12,13,268,269,14,15,270,271,524,525,780,781,526,527,782,783,1032,1033,1288,1289,1034,1035,1290,1291,1544,1545,1800,1801,1546,1547,1802,1803,1036,1037,1292,1293,1038,1039,1294,1295,1548,1549,1804,1805,1550,1551,1806,1807,2048,2049,2304,2305,2050,2051,2306,2307,2560,2561,2816,2817,2562,2563,2818,2819,2052,2053,2308,2309,2054,2055,2310,2311,2564,2565,2820,2821,2566,2567,2822,2823,3072,3073,3328,3329,3074,3075,3330,3331,3584,3585,3840,3841,3586,3587,3842,3843,3076,3077,3332,3333,3078,3079,3334,3335,3588,3589,3844,3845,3590,3591,3846,3847,2056,2057,2312,2313,2058,2059,2314,2315,2568,2569,2824,2825,2570,2571,2826,2827,2060,2061,2316,2317,2062,2063,2318,2319,2572,2573,2828,2829,2574,2575,2830,2831,3080,3081,3336,3337,3082,3083,3338,3339,3592,3593,3848,3849,3594,3595,3850,3851,3084,3085,3340,3341,3086,3087,3342,3343,3596,3597,3852,3853,3598,3599,3854,3855],utab:[0,1,4,5,16,17,20,21,64,65,68,69,80,81,84,85,256,257,260,261,272,273,276,277,320,321,324,325,336,337,340,341,1024,1025,1028,1029,1040,1041,1044,1045,1088,1089,1092,1093,1104,1105,1108,1109,1280,1281,1284,1285,1296,1297,1300,1301,1344,1345,1348,1349,1360,1361,1364,1365,4096,4097,4100,4101,4112,4113,4116,4117,4160,4161,4164,4165,4176,4177,4180,4181,4352,4353,4356,4357,4368,4369,4372,4373,4416,4417,4420,4421,4432,4433,4436,4437,5120,5121,5124,5125,5136,5137,5140,5141,5184,5185,5188,5189,5200,5201,5204,5205,5376,5377,5380,5381,5392,5393,5396,5397,5440,5441,5444,5445,5456,5457,5460,5461,16384,16385,16388,16389,16400,16401,16404,16405,16448,16449,16452,16453,16464,16465,16468,16469,16640,16641,16644,16645,16656,16657,16660,16661,16704,16705,16708,16709,16720,16721,16724,16725,17408,17409,17412,17413,17424,17425,17428,17429,17472,17473,17476,17477,17488,17489,17492,17493,17664,17665,17668,17669,17680,17681,17684,17685,17728,17729,17732,17733,17744,17745,17748,17749,20480,20481,20484,20485,20496,20497,20500,20501,20544,20545,20548,20549,20560,20561,20564,20565,20736,20737,20740,20741,20752,20753,20756,20757,20800,20801,20804,20805,20816,20817,20820,20821,21504,21505,21508,21509,21520,21521,21524,21525,21568,21569,21572,21573,21584,21585,21588,21589,21760,21761,21764,21765,21776,21777,21780,21781,21824,21825,21828,21829,21840,21841,21844,21845],jrll:[2,2,2,2,3,3,3,3,4,4,4,4],jpll:[1,3,5,7,0,2,4,6,1,3,5,7],xoffset:[-1,-1,0,1,1,1,0,-1],yoffset:[0,1,1,1,0,-1,-1,-1],facearray:[[8,9,10,11,-1,-1,-1,-1,10,11,8,9],[5,6,7,4,8,9,10,11,9,10,11,8],[-1,-1,-1,-1,5,6,7,4,-1,-1,-1,-1],[4,5,6,7,11,8,9,10,11,8,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[1,2,3,0,0,1,2,3,5,6,7,4],[-1,-1,-1,-1,7,4,5,6,-1,-1,-1,-1],[3,0,1,2,3,0,1,2,4,5,6,7],[2,3,0,1,-1,-1,-1,-1,0,1,2,3]],swaparray:[[0,0,3],[0,0,6],[0,0,0],[0,0,5],[0,0,0],[5,0,0],[0,0,0],[6,0,0],[3,0,0]],swap_cycle:[[],[0,1,8,12,16,21,40],[0,1,2,40,114],[0,4,160,263],[0,4,30,49,51,87,526,1027,1105,1387,1807,2637],[0,8,10,18,39,74,146,307,452,4737],[0,1,2,7,9,17,80,410,1526,1921,32859,33566,38931],[0,5,6,10,12,24,27,95,372,494,924,1409,3492,4248,9137,66043,103369,156899],[0,1,2,3,4,45,125,351,697,24337,102940,266194,341855,419857],[0,1,2,3,9,16,1705,2082,2126,8177,12753,15410,52642,80493,83235,88387,99444,1675361,2495125],[0,2,6,8,9,11,20,50,93,152,183,2137,13671,44794,486954,741908,4803258,5692573],[0,1,5,6,44,53,470,2847,3433,4906,13654,14710,400447,1797382,2744492,18775974,23541521],[0,4,9,10,16,33,83,117,318,451,5759,10015,128975,171834,211256,347608,1278690,2154097,2590798,3427694,5581717,21012301,27023976,72522811,95032729,139166747,171822389],[0,5,10,267,344,363,2968,3159,9083,18437,76602,147614,1246902,1593138,2035574,6529391,9511830,11340287,29565945,281666026,677946848]]};return t}),r("Utils/Long",[],function(){var t=function(t,e){this.low_=0|t,this.high_=0|e};return t.IntCache_={},t.fromInt=function(e){if(-128<=e&&e<128){var i=t.IntCache_[e];if(i)return i}var r=new t(0|e,e<0?-1:0);return-128<=e&&e<128&&(t.IntCache_[e]=r),r},t.fromNumber=function(e){return isNaN(e)||!isFinite(e)?t.ZERO:e<=-t.TWO_PWR_63_DBL_?t.MIN_VALUE:e+1>=t.TWO_PWR_63_DBL_?t.MAX_VALUE:e<0?t.fromNumber(-e).negate():new t(e%t.TWO_PWR_32_DBL_|0,e/t.TWO_PWR_32_DBL_|0)},t.fromBits=function(e,i){return new t(e,i)},t.TWO_PWR_16_DBL_=65536,t.TWO_PWR_24_DBL_=1<<24,t.TWO_PWR_32_DBL_=t.TWO_PWR_16_DBL_*t.TWO_PWR_16_DBL_,t.TWO_PWR_64_DBL_=t.TWO_PWR_32_DBL_*t.TWO_PWR_32_DBL_,t.TWO_PWR_63_DBL_=t.TWO_PWR_64_DBL_/2,t.ZERO=t.fromInt(0),t.ONE=t.fromInt(1),t.MAX_VALUE=t.fromBits(-1,2147483647),t.MIN_VALUE=t.fromBits(0,-2147483648),t.TWO_PWR_24_=t.fromInt(1<<24),t.prototype.toInt=function(){return this.low_},t.prototype.toNumber=function(){return this.high_*t.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},t.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:t.TWO_PWR_32_DBL_+this.low_},t.prototype.isZero=function(){return 0===this.high_&&0===this.low_},t.prototype.isNegative=function(){return this.high_<0},t.prototype.isOdd=function(){return 1===(1&this.low_)},t.prototype.equals=function(t){return this.high_===t.high_&&this.low_===t.low_},t.prototype.lessThan=function(t){return this.compare(t)<0},t.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},t.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.subtract(t).isNegative()?-1:1},t.prototype.negate=function(){return this.equals(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.add=function(e){var i=this.high_>>>16,r=65535&this.high_,n=this.low_>>>16,s=65535&this.low_,o=e.high_>>>16,a=65535&e.high_,l=e.low_>>>16,h=65535&e.low_,u=0,c=0,d=0,p=0;return p+=s+h,d+=p>>>16,p&=65535,d+=n+l,c+=d>>>16,d&=65535,c+=r+a,u+=c>>>16,c&=65535,u+=i+o,u&=65535,t.fromBits(d<<16|p,u<<16|c)},t.prototype.subtract=function(t){return this.add(t.negate())},t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(e.isZero())return t.ZERO;if(this.equals(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.equals(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(t.TWO_PWR_24_)&&e.lessThan(t.TWO_PWR_24_))return t.fromNumber(this.toNumber()*e.toNumber());var i=this.high_>>>16,r=65535&this.high_,n=this.low_>>>16,s=65535&this.low_,o=e.high_>>>16,a=65535&e.high_,l=e.low_>>>16,h=65535&e.low_,u=0,c=0,d=0,p=0;return p+=s*h,d+=p>>>16,p&=65535,d+=n*h,c+=d>>>16,d&=65535,d+=s*l,c+=d>>>16,d&=65535,c+=r*h,u+=c>>>16,c&=65535,c+=n*l,u+=c>>>16,c&=65535,c+=s*a,u+=c>>>16,c&=65535,u+=i*h+r*l+n*a+s*o,u&=65535,t.fromBits(d<<16|p,u<<16|c)},t.prototype.not=function(){return t.fromBits(~this.low_,~this.high_)},t.prototype.and=function(e){return t.fromBits(this.low_&e.low_,this.high_&e.high_)},t.prototype.or=function(e){return t.fromBits(this.low_|e.low_,this.high_|e.high_)},t.prototype.shiftRightUnsigned=function(e){if(e&=63,0===e)return this;var i=this.high_;if(e<32){var r=this.low_;return t.fromBits(r>>>e|i<<32-e,i>>>e)}return 32===e?t.fromBits(i,0):t.fromBits(i>>>e-32,0)},t}),r("Utils/CircleFinder",[],function(){var t,e,r=function(r){for(np=r.length,t=vec3.add2(r[0],r[1]),t=vec3.normalize2(t),e=vec3.dot2(r[0],t),i=2;i<np;++i)vec3.dot2(r[i],t)<e&&this.getCircle(r,i)};return r.prototype.getCircle=function(r,n,s){for(t=vec3.add2(r[n],r[s]),t=vec3.normalize2(t),e=vec3.dot2(r[n],t),i=0;i<n;++i)if(vec3.dot2(r[i],t)<e){var o=vec3.subtract2(r[n],r[i]),a=vec3.subtract2(r[s],r[i]);t=vec3.cross2(o,a),t=vec3.normalize2(t),e=vec3.dot2(r[n],t),e<0&&(t=vec3.flip(t),e=-e)}},r.prototype.getCircle=function(r,n){for(t=vec3.add2(r[0],r[n]),t=vec3.normalize2(t),e=vec3.dot2(r[0],t),i=1;i<n;++i)vec3.dot2(r[i],t)<e&&this.getCircle(r,i,n)},r.prototype.getCenter=function(){return t},r.prototype.getCosRad=function(){return e},r}),r("Tiling/HEALPixBase",["./HEALPixTables","../Utils/Long","../Utils/CircleFinder"],function(t,e,i){var r=1.570796325,n=function(t,e){t<0&&(t+=360);var i=t*Math.PI/180,r=(-e+90)*Math.PI/180;return[i,r]},s=function(t,e){if(t>=0)return t<e?t:t%e;var i=t%e+e;return i===e?0:i},o=function(e){return t.utab[255&e]|t.utab[e>>>8&255]<<16|t.utab[e>>>16&255]<<32|t.utab[e>>>24&255]<<48},a=function(t,e,i,r){return(i<<2*r)+o(t)+(o(e)<<1)},l=function(t,i,r){var n=Math.pow(2,t),o=Math.cos(r),l={phi:i,theta:r,z:o};Math.abs(o)>.9&&(l.sth=Math.sin(r),l.have_sth=!0);var h,u,c,d=2/Math.PI,p=s(i*d,4),f=Math.abs(o);if(f<=2/3){var g=n*(.5+p),m=n*(.75*o);h=e.fromNumber(g-m),u=e.fromNumber(g+m);var v,y=h.shiftRightUnsigned(t),b=u.shiftRightUnsigned(t);v=y.equals(b)?y.or(e.fromInt(4)):y.lessThan(b)?y:b.add(e.fromInt(8)),c=e.fromNumber(n-1);var x=u.and(c),_=c.subtract(h.and(c));return a(x.toInt(),_.toInt(),v.toInt(),t)}var w=parseInt(Math.min(3,parseInt(p,10)),10),C=p-w,T=f<.9||!l.have_sth?n*Math.sqrt(3*(1-f)):n*l.sth/Math.sqrt((1+f)/3);h=e.fromNumber(C*T),u=e.fromNumber((1-C)*T);var A=e.fromNumber(n);c=e.fromNumber(n-1);var I=e.fromInt(1);return h.greaterThanOrEqual(A)&&(h=c),u.greaterThanOrEqual(A)&&(u=c),o>=0?a(A.subtract(u).subtract(I).toInt(),A.subtract(h).subtract(I).toInt(),w,t):a(h.toInt(),u.toInt(),w+8,t)},h=function(t){this.p=new Array(t),this.o=new Array(t);for(var e=0;e<this.p.length;e++)this.p[e]=0,this.o[e]=0;this.s=this.m=0};h.prototype.push=function(t,e){this.p[this.s]=t,this.o[this.s]=e,++this.s},h.prototype.otop=function(){return this.o[this.s-1]},h.prototype.ptop=function(){return this.p[this.s-1]},h.prototype.pop=function(){this.s--},h.prototype.popToMark=function(){this.s=this.m},h.prototype.mark=function(){this.m=this.s},h.prototype.size=function(){return this.s};var u={init:function(t){this.order_max=29,this.bn=[],this.nside=null;try{for(var e=0;e<=this.order_max;++e)this.bn[e]=this.createBoundaries(1<<e,"NESTED")}catch(t){}},createBoundaries:function(t,e){return this.nside=t-1,this.calculateBoundaries(t,e)},compress_bits:function(i){var r=e.fromNumber(i),n=e.fromNumber(0x5555555555555),s=r.and(n),o=s.shiftRightUnsigned(15);s=s.or(o);var a=s.and(e.fromNumber(65535)).toInt(),l=s.shiftRightUnsigned(32),h=l.and(e.fromNumber(65535)).toInt();return t.ctab[255&a]|t.ctab[a>>>8]<<4|t.ctab[255&h]<<16|t.ctab[h>>>8]<<20},fxyf:function(e,i,n){var s,o,a=t.jrll[n]-e-i,l=0,h=0,u=0,c=!1;a<1?(s=a,o=s*s/3,l=1-o,l>.99&&(u=Math.sqrt(o*(2-o)),c=!0)):a>3?(s=4-a,o=s*s/3,l=o-1,l<-.99&&(u=Math.sqrt(o*(2-o)),c=!0)):(s=1,l=2*(2-a)/3),o=t.jpll[n]*s+e-i,o<0&&(o+=8),o>=8&&(o-=8),h=s<1e-15?0:.5*r*o/s;var d=c?u:Math.sqrt((1-l)*(1+l));return[d*Math.cos(h),d*Math.sin(h),l]},maxPixrad:function(t,e){var i=Math.pow(2,t),r=vec3.createZPhi(2/3,Math.PI/e),n=1-1/i;n*=n;var s=vec3.createZPhi(1-n/3,0);return vec3.angle2(r,s)},pix2vec:function(t,e){var i=this.pix2loc(t,e),r=i.have_sth?i.sth:Math.sqrt((1-i.z)*(1+i.z));return vec3.createFrom(r*Math.cos(i.phi),r*Math.sin(i.phi),i.z)},pix2loc:function(e,i){var n,s,o={phi:null,sth:0,have_sth:!1,z:null},a=this.nest2xyf(e,i.npface,i.order),l=(t.jrll[a.face]<<i.order)-a.ix-a.iy-1;return l<i.nside?(n=l,s=n*n*i.fact2,o.z=1-s,o.z>.99&&(o.sth=Math.sqrt(s*(2-s)),o.have_sth=!0)):l>i.nl3?(n=i.nl4-l,s=n*n*i.fact2,o.z=s-1,o.z<-.99&&(o.sth=Math.sqrt(s*(2-s)),o.have_sth=!0)):(n=i.nside,o.z=(i.nl2-l)*i.fact1),s=t.jpll[a.face]*n+a.ix-a.iy,s<0&&(s+=8*n),o.phi=n===i.nside?.75*r*s*i.fact1:.5*r*s/n,o},nest2xyf:function(t,e,i){var r=t&e-1,n=u.compress_bits(r),s=u.compress_bits(r>>>1),o=t>>>2*i;return{ix:n,iy:s,face:o}},nside2order:function(t){for(var e=0;t>65535;)e+=16,t>>>=16;return t>255&&(e|=8,t>>>=8),t>15&&(e|=4,t>>>=4),t>3&&(e|=2,t>>>=2),t>1&&(e|=1),e},calculateBoundaries:function(t,e){if(this.nside!==t){this.nside=t;var i=this.nside2order(t);if("NESTED"===e&&i<0)throw new Exception("Nside must be a power of 2 for NESTED scheme");var r=2*this.nside,n=3*this.nside,s=4*this.nside,o=this.nside*this.nside,a=2*this.nside*(this.nside-1),l=12*o,h=4/l,u=(this.nside<<1)*h;return{order:i,nside:this.nside,scheme:e,nl2:r,nl3:n,nl4:s,npface:o,ncap:a,npix:l,fact1:u,fact2:h}}},convertPolygonToHealpixOrder:function(t,e,i){var r=[],n=e||4,s=i||5;return _.each(t,function(t){var e=Math.PI/180,i=Math.cos(t[1]*e),n=Math.cos(t[0]*e)*i,s=Math.sin(t[0]*e)*i,o=Math.sin(t[1]*e),a=Math.atan2(Math.sqrt(n*n+s*s),o),l=Math.atan2(s,n);l<0&&(l+=2*Math.PI),l>=2*Math.PI&&(l-=2*Math.PI),r.push({theta:a,phi:l})}),this.queryPolygonInclusive(r,n,s)},queryPolygonInclusive:function(t,e,r){Math.PI=3.141592653589793;var n=Math.PI/2,s=0!==e,o=t.length,a=s?o+1:o;if(o<3)return void console.error("not enough vertices in polygon");var l,h=new Array(o);for(l=0;l<o;++l)h[l]=vec3.createPhiTheta(t[l].phi,t[l].theta);var u=new Array(a),c=0;for(l=0;l<o;++l){u[l]=vec3.cross2(h[l],h[(l+1)%o]);var d=vec3.dot2(u[l],h[(l+2)%o]);0===l&&(c=d<0?-1:1),u[l]=vec3.scale2(u[l],c/vec3.length2(u[l]))}var p=new Array(a);if(this.fill(p,n),s){var f=new i(h);u[o]=f.getCenter(),p[o]=Math.acos(f.getCosRad())}var g=this.queryMultiDisc(u,p,e,r);return console.dir(g),g},fill:function(t,e){for(var i=0,r=t.length;i<r;i++)t[i]=e},queryMultiDisc:function(t,e,i,r){var n=r,s=0!==i,o=t.length,a=[],l=0;s&&(l=this.ilog2(i));for(var c,d=n+l,p=new Array(d+1),f=0;f<d+1;f++){p[f]=new Array(o);for(var g=0;g<o;g++)p[f][g]=new Array(3)}var m={order:n};u.init(m);var v;for(v=0;v<=d;++v){c=u.bn[v];var y=u.maxPixrad(v,c.nl4);for(f=0;f<o;++f)p[v][f][0]=e[f]+y>Math.PI?-1:Math.cos(e[f]+y),p[v][f][1]=0===v?Math.cos(e[f]):p[0][f][1],p[v][f][2]=e[f]-y<0?1:Math.cos(e[f]-y)}var b=new h(12+3*d);for(f=0;f<12;f++)b.push(11-f,0);for(;b.size()>0;){var x=b.ptop();v=b.otop(),b.pop(),c=u.bn[v];var _=u.pix2vec(x,c),w=3;for(f=0;f<o&&w>0;++f)for(var C=vec3.dot2(_,t[f]),T=0;T<w;++T)C<p[v][f][T]&&(w=T);w>0&&this.check_pixel(v,d,w,a,x,b,s,r)}return a},check_pixel:function(t,e,i,r,n,s,o,a){var l,h=a;if(0!==i)if(t<h)if(i>=3){var u=2*(h-t),c=n<<u,d=n+1<<u;for(l=c;l<=d;l++)r.push(l)}else for(l=0;l<4;++l)s.push(4*n+3-l,t+1);else if(t>h)if(i>=2)r.push(n>>>2*(t-h)),s.popToMark();else if(t<e)for(l=0;l<4;++l)s.push(4*n+3-l,t+1);else r.push(n>>>2*(t-h)),s.popToMark();else if(i>=2)r.push(n);else if(o)if(h<e)for(s.mark(),l=0;l<4;++l)s.push(4*n+3-l,t+1);else r.push(n)},ilog2:function(t){for(var e=0;t>65535;)e+=16,t>>>=16;return t>255&&(e|=8,t>>>=8),t>15&&(e|=4,t>>>=4),t>3&&(e|=2,t>>>=2),t>1&&(e|=1),e},lonLat2pix:function(t,e,i){var r=n(e,i);return l(t,r[0],r[1])},getChildren:function(t){return[4*t,4*t+1,4*t+2,4*t+3]},uniq2hpix:function(t,e){null===e&&(e=[]),e[0]=u.log2(t/4)/2;var i=u.pow2(e[0]);return e[1]=t-4*i*i,e[0]=parseInt(e[0],10),e},log2:function(t){for(var e=0;t>>>++e>0;);return--e},pow2:function(t){return 1<<t},getPixRes:function(t){var e=648e3/Math.PI;return e*Math.sqrt(4*Math.PI/(12*t*t))}};return u}),r("Utils/UtilsIntersection",["./Numeric","../Tiling/HEALPixBase"],function(t,e){function i(t){var e=t[0]*Math.PI/180,i=t[1]*Math.PI/180,r=Math.cos(i)*Math.cos(e),n=Math.cos(i)*Math.sin(e),s=Math.sin(i);return[r,n,s]}function r(e,i,r,n){var s=vec3.cross(e,i,[]),o=vec3.cross(r,n,[]),a=vec3.normalize(vec3.cross(s,o,[])),l=vec3.dot(vec3.cross(e,s,[]),a),h=vec3.dot(vec3.cross(i,s,[]),a),u=vec3.dot(vec3.cross(r,o,[]),a),c=vec3.dot(vec3.cross(n,o,[]),a),d=t.sign(-l)+t.sign(h)+t.sign(-u)+t.sign(c);return 4===Math.abs(d)}var n={};return n.convertPolygonToHealpixOrder=function(t,i,r){return e.convertPolygonToHealpixOrder(t,i,r)},n.pointInLine=function(t,e,i){var r,n,s=i[0]-e[0],o=!1;return 0===s?o=t[0]===e[0]:(n=(t[0]-e[0])/s,o=n>=0&&n<=1),!!o&&(r=i[1]-e[1],0===s?t[1]===e[1]:(n=(t[1]-e[1])/r,n>=0&&n<=1))},n.pointInSphere=function(t,e,i,r){var n=[],s=[],o=t.getRenderContext().computePixelSizeVector();t.getCoordinateSystem().get3DFromWorld(e,n),t.getCoordinateSystem().get3DFromWorld(i,s);var a=r*(o[0]*s[0]+o[1]*s[1]+o[2]*s[2]+o[3]),l=[];return vec3.subtract(n,s,l),l=vec3.dot(l,l),l<a*a},n.pointInRing=function(t,e){for(var n=e.length,s=0,o=i(t),a=i([t[0],t[1]+90]),l=0;l<n-1;l++)r(i(e[l]),i(e[l+1]),o,a)&&s++;return s%2===1},n}),r("Renderer/FeatureStyle",[],function(){var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},e=/^(\w{2})(\w{2})(\w{2})$/,i=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,r=/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3},\s*(\d{1,3}))\)$/,n=function(t){if(this.strokeColor=[1,0,0,1],this.fillColor=[1,0,0,1],this.fillTextureUrl=null,this.fillTexture=null,this.fillShader=null,this.strokeWidth=1,this.iconUrl=null,this.icon=null,this.label=null,this.textColor=[1,1,1,1],this.fill=!1,this.pointMaxSize=40,this.opacity=1,this.zIndex=0,this.extrusionScale=1,t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])};return n.fromStringToColor=function(n){var s,o=0,a=0,l=0,h=255;return n=n.trim(),n=n.toLowerCase(),"#"===n.charAt(0)&&(n=n.substr(1,6)),t.hasOwnProperty(n)&&(n=t[n]),s=e.exec(n),s&&(o=parseInt(s[1],16),a=parseInt(s[2],16),l=parseInt(s[3],16)),s=i.exec(n),s&&(o=parseInt(s[1],10),a=parseInt(s[2],10),l=parseInt(s[3],10)),s=r.exec(n),s&&(o=parseInt(s[1],10),a=parseInt(s[2],10),l=parseInt(s[3],10),h=parseInt(s[4],10)),o=o<0?0:o>255?255:o,a=a<0?0:a>255?255:a,l=l<0?0:l>255?255:l,h=h<0?0:h>255?255:h,[o/255,a/255,l/255,h/255]},n.fromColorToString=function(t){for(var e="#",i=0;i<3;i++){var r=parseInt(255*t[i],10).toString(16);e+=r<10?"0"+r:r}return e},n.prototype.getExtrusionScale=function(){return this.extrusionScale},n.prototype.setExtrusionScale=function(t){this.extrusionScale=t},n}),r("Utils/UtilityFactory",["./Constants","./UtilsFits","./Numeric","./UtilsIntersection","../Renderer/FeatureStyle"],function(t,e,i,r,n){return{create:function(s,o){var a;switch(s){case t.UTILITY.Fits:a=e;break;case t.UTILITY.Intersection:a=r;break;case t.UTILITY.Numeric:a=i;break;case t.UTILITY.CreateStyle:a=new n(o);break;case t.UTILITY.FeatureStyle:a=n;break;default:throw"Cannot create the utility "+s}return a}}}),r("Layer/AbstractLayer",["underscore-min","../Utils/Event","../Utils/Utils","../Utils/Constants","../Utils/UtilityFactory"],function(t,e,i,r,n){function s(t){var e;return e=t.hasOwnProperty("availableServices")?t.availableServices:[]}function o(t,e,i,s,o){var a;return a=t.hasOwnProperty("style")?"FeatureStyle"===t.style?t.style:n.create(r.UTILITY.CreateStyle,t.style):n.create(r.UTILITY.CreateStyle,{rendererHint:"Basic",opacity:e,iconUrl:i,fillColor:s,strokeColor:s,visible:o})}function a(t){var e;return e=t.hasOwnProperty("opacity")?t.opacity/100:1}function l(t){var e;if(t.hasOwnProperty("color"))e=t.color instanceof Array?t.color:n.create(r.UTILITY.FeatureStyle).fromStringToColor(t.color);else{var s=i.generateColor();e=s.concat([1])}return e}var h=function(i,r){e.prototype.constructor.call(this,r),this.globe=null,this.options=r||{},this.ID="URN:Mizar:Layer:"+t.uniqueId(this.constructor.name+":"),this.name=this.options.hasOwnProperty("name")?this.options.name:"",this.attribution=this.options.hasOwnProperty("attribution")?this.options.attribution:"",this.copyrightUrl=this.options.hasOwnProperty("copyrightUrl")?this.options.copyrightUrl:"",this.ack=this.options.hasOwnProperty("ack")?this.options.ack:"",this.icon=this.options.hasOwnProperty("icon")?this.options.icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBQkVBRMIQtMAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAvklEQVQY012QMWpCURBFz3yfG7CIwSatpLGwsJJsQEHssr2UttapkkK0zRJEFPKLj5UYPGme8vgDt5l7uNwZKEYNdaZO1FR6VQkBT8AbMAGe1e7dTwXUB8bAFPgF9sBWPUXENbWgBTAELkCTw7bqMdR5kTQCehlogB/gE/iqcs9OVhT9I8v7EZU6UJfqh3pWa3WlvqsvakoRcVOPwCYnvQI1sM67Q0T8JYAWvAEOwDewj4jr4z0teJdf84AA/gF1uG92uhcfoAAAAABJRU5ErkJggg==",this.description=this.options.hasOwnProperty("description")?this.options.description:"",this.visible=!!this.options.hasOwnProperty("visible")&&this.options.visible,this.properties=this.options.hasOwnProperty("properties")?this.options.properties:{},this.type=i,this.pickable=!!this.options.hasOwnProperty("pickable")&&this.options.pickable,this.services=this.options.hasOwnProperty("services")?this.options.services:[],this.dataType=this.options.dataType||"",this.background=r.background,this.category=this.options.background?"background":this.options.category,this.coordinateSystem=r.coordinateSystem,this.format=this.options.format||"",this.baseUrl=this.options.baseUrl||"",this.deletable=this.options.deletable||!1,this.fitsSupported=!1,this.color=l.call(this,this.options),this.opacity=a.call(this,this.options),this.style=o.call(this,this.options,this.opacity,this.icon,this.color,this.visible),this.attribution&&this.attribution.search("<a")>=0&&this.attribution.search("target=")<0&&(this.attribution=this.attribution.replace(" "," target=_blank ")),this.availableServices=s(this.options)};return i.inherits(e,h),h.prototype.getGlobe=function(){return this.globe},h.prototype.getID=function(){return this.ID},h.prototype.getName=function(){return this.name},h.prototype.getAttribution=function(){return this.attribution},h.prototype.getCopyrightUrl=function(){return this.copyrightUrl},h.prototype.getAck=function(){return this.ack},h.prototype.getIcon=function(){return this.icon},h.prototype.getDescription=function(){return this.description},h.prototype.isVisible=function(){return this.visible},h.prototype.setVisible=function(t){if("boolean"!=typeof t)throw new TypeError("the parameter of setVisible should be a boolean","AbstractLayer.js");this.visible!==t&&this.globe.attributionHandler&&this.globe.attributionHandler.toggleAttribution(this),this.visible=t,this.globe&&this.globe.renderContext.requestFrame(),this.publish("visibility:changed",this)},h.prototype.getOpacity=function(){return this.opacity},h.prototype.setOpacity=function(t){if(!("number"==typeof t&&t>=0&&t<=1))throw new TypeError("opacity value should be a value in [0..1]","AbstractLayer.js");this.opacity=t,this.globe&&this.globe.renderContext.requestFrame(),this.publish("opacity:changed",this)},h.prototype.getProperties=function(){return this.properties},h.prototype.getType=function(){return this.type},h.prototype.isPickable=function(){return this.pickable},h.prototype.isType=function(t){return this.type===t},h.prototype.getServices=function(){return this.services},h.prototype.getCoordinateSystem=function(){return this.coordinateSystem},h.prototype._attach=function(t){this.globe=t,this.attribution&&this.globe.attributionHandler&&this.isVisible()&&this.globe.attributionHandler.addAttribution(this)},h.prototype._detach=function(){this.attribution&&this.globe.attributionHandler&&this.globe.attributionHandler.removeAttribution(this),this.globe=null},h.prototype.getBaseURl=function(){return this.baseUrl},h.prototype.getDataType=function(){return this.dataType},h.prototype.getFormat=function(){return this.format},h.prototype.isDeletable=function(){return this.deletable},h.prototype.getColor=function(){return this.color},h.prototype.getStyle=function(){return this.style},h.prototype.getAvailableServices=function(){return this.availableServices},h.prototype.isBackground=function(){return this.background},h}),r("Renderer/Program",[],function(){var t=function(t){this.renderContext=t,this.glProgram=null,this.attributes={},this.uniforms={},this.numActiveAttribArray=0};return t.prototype.createShader=function(t,e){var i=this.renderContext.gl,r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)?r:(console.log("Shader compilation error: "+i.getShaderInfoLog(r)),console.log(e),i.deleteShader(r),null)},t.prototype.createFromSource=function(t,e){var i=this.renderContext.gl,r=this.createShader(i.VERTEX_SHADER,t),n=this.createShader(i.FRAGMENT_SHADER,e);if(null===r||null===n)return!1;var s;if(this.glProgram=i.createProgram(),i.attachShader(this.glProgram,r),i.attachShader(this.glProgram,n),i.linkProgram(this.glProgram),!i.getProgramParameter(this.glProgram,i.LINK_STATUS))return console.log("Program link error: "+i.getProgramInfoLog(this.glProgram)),i.deleteShader(r),i.deleteShader(n),i.deleteProgram(this.glProgram),this.glProgram=null,!1;var o=i.getProgramParameter(this.glProgram,i.ACTIVE_ATTRIBUTES);for(this.numActiveAttribArray=0,s=0;s<o;++s){var a=i.getActiveAttrib(this.glProgram,s),l=i.getAttribLocation(this.glProgram,a.name);this.attributes[a.name]=l,l+1>this.numActiveAttribArray&&(this.numActiveAttribArray=l+1)}var h=i.getProgramParameter(this.glProgram,i.ACTIVE_UNIFORMS);for(s=0;s<h;++s){var u=i.getActiveUniform(this.glProgram,s);this.uniforms[u.name]=i.getUniformLocation(this.glProgram,u.name)}return!0},t.prototype.loadFromFile=function(t,e){var i=new XMLHttpRequest;i.open("get",this.renderContext.shadersPath+t,!1),i.send(null);var r=i.responseText;i.open("get",this.renderContext.shadersPath+e,!1),i.send(null);var n=i.responseText;return this.createFromSource(r,n)},t.prototype.apply=function(){var t,e=this.renderContext,i=e.gl;for(i.useProgram(this.glProgram),t=e.numActiveAttribArray;t<this.numActiveAttribArray;t++)i.enableVertexAttribArray(t);for(t=this.numActiveAttribArray;t<e.numActiveAttribArray;t++)i.disableVertexAttribArray(t);e.numActiveAttribArray=this.numActiveAttribArray},t.prototype.dispose=function(){this.renderContext.gl.deleteProgram(this.glProgram)},t}),r("Renderer/BoundingBox",[],function(){var t=function(t,e){t&&(this.min=vec3.create(t)),e&&(this.max=vec3.create(e))};return t.prototype.extend=function(t,e,i){this.min?(t<this.min[0]&&(this.min[0]=t),e<this.min[1]&&(this.min[1]=e),i<this.min[2]&&(this.min[2]=i),t>this.max[0]&&(this.max[0]=t),e>this.max[1]&&(this.max[1]=e),i>this.max[2]&&(this.max[2]=i)):(this.min=vec3.create(),this.max=vec3.create(),this.min[0]=t,this.min[1]=e,this.min[2]=i,this.max[0]=t,this.max[1]=e,this.max[2]=i)},t.prototype.compute=function(t,e,i){this.min||(this.min=vec3.create(),this.max=vec3.create()),this.min[0]=t[0],this.min[1]=t[1],this.min[2]=t[2],this.max[0]=t[0],this.max[1]=t[1],this.max[2]=t[2];var r,n,s=i||3,o=e||t.length;for(r=s;r<o;r+=s)for(n=0;n<3;n++)t[r+n]<this.min[n]&&(this.min[n]=t[r+n]),t[r+n]>this.max[n]&&(this.max[n]=t[r+n])},t.prototype.getCorner=function(t){return[1&t?this.max[0]:this.min[0],2&t?this.max[1]:this.min[1],4&t?this.max[2]:this.min[2]]},t.prototype.getCenter=function(){return[.5*(this.max[0]+this.min[0]),.5*(this.max[1]+this.min[1]),.5*(this.max[2]+this.min[2])]},t.prototype.getRadius=function(){var t=vec3.create();return vec3.subtract(this.max,this.min,t),.5*vec3.length(t)},t}),r("Renderer/glMatrix",[],function(){var t=1e-6,e=Array,i={};i.create=function(t){var i=new e(3);return t?(i[0]=t[0],i[1]=t[1],i[2]=t[2]):i[0]=i[1]=i[2]=0,i},i.createFrom=function(t,i,r){var n=new e(3);return n[0]=t,n[1]=i,n[2]=r,n},i.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.equal=function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t},i.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},i.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},i.multiply=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i):(t[0]*=e[0],t[1]*=e[1],t[2]*=e[2],t)},i.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},i.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},i.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],s=Math.sqrt(i*i+r*r+n*n);return s?1===s?(e[0]=i,e[1]=r,e[2]=n,e):(s=1/s,e[0]=i*s,e[1]=r*s,e[2]=n*s,e):(e[0]=0,e[1]=0,e[2]=0,e)},i.cross=function(t,e,i){i||(i=t);var r=t[0],n=t[1],s=t[2],o=e[0],a=e[1],l=e[2];return i[0]=n*l-s*a,i[1]=s*o-r*l,i[2]=r*a-n*o,i},i.length=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)},i.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},i.lerp=function(t,e,i,r){return r||(r=t),r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r[2]=t[2]+i*(e[2]-t[2]),r},i.dist=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)},i.angle=function(t,e){return Math.atan2(i.length(i.cross(t,e)),i.dot(t,e))},i.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},i.createZPhi=function(t,e){var r=Math.sqrt((1-t)*(1+t)),n=r*Math.cos(e),s=r*Math.sin(e);return i.createFrom(n,s,t)},i.createPhiTheta=function(t,e){var r=Math.sin(e),n=r*Math.cos(t),s=r*Math.sin(t),o=r*Math.cos(e);return i.createFrom(n,s,o)},i.add2=function(t,e){var i=t[0],r=t[1],n=t[2],s=e[0],o=e[1],a=e[2];return[i+s,r+o,n+a]},i.subtract2=function(t,e){var i=t[0],r=t[1],n=t[2],s=e[0],o=e[1],a=e[2];
return[i-s,r-o,n-a]},i.flip=function(t){var e=t[0],i=t[1],r=t[2];return[e=-e,i=-i,r=-r]},i.scale2=function(t,e){var i=t.x,r=t.y,n=t.z;return{x:i*e,y:r*=e,z:n*=e}},i.normalize2=function(t){var e=t[0],i=t[1],r=t[2],n=1/Math.sqrt(e*e+i*i+r*r);return[e*=n,i*=n,r*=n]},i.cross2=function(t,e){return{x:t[1]*e[2]-e[1]*t[2],y:t[2]*e[0]-e[2]*t[0],z:t[0]*e[1]-e[0]*t[1]}},i.length2=function(t){var e=t.x,i=t.y,r=t.z;return Math.sqrt(e*e+i*i+r*r)},i.dot2=function(t,e){var i=void 0!==t.x?t.x:t[0],r=void 0!==t.y?t.y:t[1],n=void 0!==t.z?t.z:t[2],s=void 0!==e.x?e.x:e[0],o=void 0!==e.y?e.y:e[1],a=void 0!==e.z?e.z:e[2];return i*s+r*o+n*a},i.angle2=function(t,e){return Math.atan2(i.length2(i.cross2(t,e)),i.dot2(t,e))};var r={};r.create=function(t){var i=new e(9);return t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8]),i};var n={};n.create=function(t){var i=new e(16);return t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},n.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.identity=function(t){return t||(t=n.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[3],s=t[6],o=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=s,t[11]=t[14],t[12]=n,t[13]=o,t[14]=a,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},n.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],d=t[11],p=t[12],f=t[13],g=t[14],m=t[15];return p*u*a*n-h*f*a*n-p*o*c*n+s*f*c*n+h*o*g*n-s*u*g*n-p*u*r*l+h*f*r*l+p*i*c*l-e*f*c*l-h*i*g*l+e*u*g*l+p*o*r*d-s*f*r*d-p*i*a*d+e*f*a*d+s*i*g*d-e*o*g*d-h*o*r*m+s*u*r*m+h*i*a*m-e*u*a*m-s*i*c*m+e*o*c*m},n.inverse=function(t,e){e||(e=t);var i,r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],p=t[10],f=t[11],g=t[12],m=t[13],v=t[14],y=t[15],b=r*l-n*a,x=r*h-s*a,_=r*u-o*a,w=n*h-s*l,C=n*u-o*l,T=s*u-o*h,A=c*m-d*g,I=c*v-p*g,S=c*y-f*g,M=d*v-p*m,k=d*y-f*m,E=p*y-f*v,P=b*E-x*k+_*M+w*S-C*I+T*A;return P?(i=1/P,e[0]=(l*E-h*k+u*M)*i,e[1]=(-n*E+s*k-o*M)*i,e[2]=(m*T-v*C+y*w)*i,e[3]=(-d*T+p*C-f*w)*i,e[4]=(-a*E+h*S-u*I)*i,e[5]=(r*E-s*S+o*I)*i,e[6]=(-g*T+v*_-y*x)*i,e[7]=(c*T-p*_+f*x)*i,e[8]=(a*k-l*S+u*A)*i,e[9]=(-r*k+n*S-o*A)*i,e[10]=(g*C-m*_+y*b)*i,e[11]=(-c*C+d*_-f*b)*i,e[12]=(-a*M+l*I-h*A)*i,e[13]=(r*M-n*I+s*A)*i,e[14]=(-g*w+m*x-v*b)*i,e[15]=(c*w-d*x+p*b)*i,e):null},n.toRotationMat=function(t,e){return e||(e=n.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.toMat3=function(t,e){return e||(e=r.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},n.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],p=t[10],f=t[11],g=t[12],m=t[13],v=t[14],y=t[15],b=e[0],x=e[1],_=e[2],w=e[3];return i[0]=b*r+x*a+_*c+w*g,i[1]=b*n+x*l+_*d+w*m,i[2]=b*s+x*h+_*p+w*v,i[3]=b*o+x*u+_*f+w*y,b=e[4],x=e[5],_=e[6],w=e[7],i[4]=b*r+x*a+_*c+w*g,i[5]=b*n+x*l+_*d+w*m,i[6]=b*s+x*h+_*p+w*v,i[7]=b*o+x*u+_*f+w*y,b=e[8],x=e[9],_=e[10],w=e[11],i[8]=b*r+x*a+_*c+w*g,i[9]=b*n+x*l+_*d+w*m,i[10]=b*s+x*h+_*p+w*v,i[11]=b*o+x*u+_*f+w*y,b=e[12],x=e[13],_=e[14],w=e[15],i[12]=b*r+x*a+_*c+w*g,i[13]=b*n+x*l+_*d+w*m,i[14]=b*s+x*h+_*p+w*v,i[15]=b*o+x*u+_*f+w*y,i},n.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],s=e[2];return i[0]=t[0]*r+t[4]*n+t[8]*s+t[12],i[1]=t[1]*r+t[5]*n+t[9]*s+t[13],i[2]=t[2]*r+t[6]*n+t[10]*s+t[14],i},n.multiplyVec4=function(t,e,i){i||(i=e);var r=e[0],n=e[1],s=e[2],o=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*s+t[12]*o,i[1]=t[1]*r+t[5]*n+t[9]*s+t[13]*o,i[2]=t[2]*r+t[6]*n+t[10]*s+t[14]*o,i[3]=t[3]*r+t[7]*n+t[11]*s+t[15]*o,i},n.project=function(t,e,i){i||(i=e),n.multiplyVec4(t,e,i);var r=1/i[3];return i[0]*=r,i[1]*=r,i[2]*=r,i},n.rotateVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],s=e[2];return i[0]=t[0]*r+t[4]*n+t[8]*s,i[1]=t[1]*r+t[5]*n+t[9]*s,i[2]=t[2]*r+t[6]*n+t[10]*s,i},n.translate=function(t,e,i){var r,n,s,o,a,l,h,u,c,d,p,f,g=e[0],m=e[1],v=e[2];return i&&t!==i?(r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],p=t[10],f=t[11],i[0]=r,i[1]=n,i[2]=s,i[3]=o,i[4]=a,i[5]=l,i[6]=h,i[7]=u,i[8]=c,i[9]=d,i[10]=p,i[11]=f,i[12]=r*g+a*m+c*v+t[12],i[13]=n*g+l*m+d*v+t[13],i[14]=s*g+h*m+p*v+t[14],i[15]=o*g+u*m+f*v+t[15],i):(t[12]=t[0]*g+t[4]*m+t[8]*v+t[12],t[13]=t[1]*g+t[5]*m+t[9]*v+t[13],t[14]=t[2]*g+t[6]*m+t[10]*v+t[14],t[15]=t[3]*g+t[7]*m+t[11]*v+t[15],t)},n.scale=function(t,e,i){var r=e[0],n=e[1],s=e[2];return i&&t!==i?(i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*s,i[9]=t[9]*s,i[10]=t[10]*s,i[11]=t[11]*s,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=s,t[9]*=s,t[10]*=s,t[11]*=s,t)},n.rotate=function(t,e,i,r){var n,s,o,a,l,h,u,c,d,p,f,g,m,v,y,b,x,_,w,C,T,A,I,S,M=i[0],k=i[1],E=i[2],P=Math.sqrt(M*M+k*k+E*E);return P?(1!==P&&(P=1/P,M*=P,k*=P,E*=P),n=Math.sin(e),s=Math.cos(e),o=1-s,a=t[0],l=t[1],h=t[2],u=t[3],c=t[4],d=t[5],p=t[6],f=t[7],g=t[8],m=t[9],v=t[10],y=t[11],b=M*M*o+s,x=k*M*o+E*n,_=E*M*o-k*n,w=M*k*o-E*n,C=k*k*o+s,T=E*k*o+M*n,A=M*E*o+k*n,I=k*E*o-M*n,S=E*E*o+s,r?t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=a*b+c*x+g*_,r[1]=l*b+d*x+m*_,r[2]=h*b+p*x+v*_,r[3]=u*b+f*x+y*_,r[4]=a*w+c*C+g*T,r[5]=l*w+d*C+m*T,r[6]=h*w+p*C+v*T,r[7]=u*w+f*C+y*T,r[8]=a*A+c*I+g*S,r[9]=l*A+d*I+m*S,r[10]=h*A+p*I+v*S,r[11]=u*A+f*I+y*S,r):null},n.rotateX=function(t,e,i){var r=Math.sin(e),n=Math.cos(e),s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],d=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=s*n+h*r,i[5]=o*n+u*r,i[6]=a*n+c*r,i[7]=l*n+d*r,i[8]=s*-r+h*n,i[9]=o*-r+u*n,i[10]=a*-r+c*n,i[11]=l*-r+d*n,i},n.rotateY=function(t,e,i){var r=Math.sin(e),n=Math.cos(e),s=t[0],o=t[1],a=t[2],l=t[3],h=t[8],u=t[9],c=t[10],d=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*n+h*-r,i[1]=o*n+u*-r,i[2]=a*n+c*-r,i[3]=l*n+d*-r,i[8]=s*r+h*n,i[9]=o*r+u*n,i[10]=a*r+c*n,i[11]=l*r+d*n,i},n.rotateZ=function(t,e,i){var r=Math.sin(e),n=Math.cos(e),s=t[0],o=t[1],a=t[2],l=t[3],h=t[4],u=t[5],c=t[6],d=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*n+h*r,i[1]=o*n+u*r,i[2]=a*n+c*r,i[3]=l*n+d*r,i[4]=s*-r+h*n,i[5]=o*-r+u*n,i[6]=a*-r+c*n,i[7]=l*-r+d*n,i},n.frustum=function(t,e,i,r,s,o,a){a||(a=n.create());var l=e-t,h=r-i,u=o-s;return a[0]=2*s/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*s/h,a[6]=0,a[7]=0,a[8]=(e+t)/l,a[9]=(r+i)/h,a[10]=-(o+s)/u,a[11]=-1,a[12]=0,a[13]=0,a[14]=-(o*s*2)/u,a[15]=0,a},n.perspective=function(t,e,i,r,s){var o=i*Math.tan(t*Math.PI/360),a=o*e;return n.frustum(-a,a,-o,o,i,r,s)},n.ortho=function(t,e,i,r,s,o,a){a||(a=n.create());var l=e-t,h=r-i,u=o-s;return a[0]=2/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/h,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/u,a[11]=0,a[12]=-(t+e)/l,a[13]=-(r+i)/h,a[14]=-(o+s)/u,a[15]=1,a},n.lookAt=function(t,e,i,r){r||(r=n.create());var s,o,a,l,h,u,c,d,p,f,g=t[0],m=t[1],v=t[2],y=i[0],b=i[1],x=i[2],_=e[0],w=e[1],C=e[2];return g===_&&m===w&&v===C?n.identity(r):(c=g-_,d=m-w,p=v-C,f=1/Math.sqrt(c*c+d*d+p*p),c*=f,d*=f,p*=f,s=b*p-x*d,o=x*c-y*p,a=y*d-b*c,f=Math.sqrt(s*s+o*o+a*a),f?(f=1/f,s*=f,o*=f,a*=f):(s=0,o=0,a=0),l=d*a-p*o,h=p*s-c*a,u=c*o-d*s,f=Math.sqrt(l*l+h*h+u*u),f?(f=1/f,l*=f,h*=f,u*=f):(l=0,h=0,u=0),r[0]=s,r[1]=l,r[2]=c,r[3]=0,r[4]=o,r[5]=h,r[6]=d,r[7]=0,r[8]=a,r[9]=u,r[10]=p,r[11]=0,r[12]=-(s*g+o*m+a*v),r[13]=-(l*g+h*m+u*v),r[14]=-(c*g+d*m+p*v),r[15]=1,r)},n.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"};var s={};return s.create=function(t){var i=new e(4);return t?(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3]):i[0]=i[1]=i[2]=i[3]=0,i},s.createFrom=function(t,i,r,n){var s=new e(4);return s[0]=t,s[1]=i,s[2]=r,s[3]=n,s},s.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},s.equal=function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t&&Math.abs(e[3]-i[3])<t},s.identity=function(t){return t||(t=s.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.calculateW=function(t,e){var i=t[0],r=t[1],n=t[2];return e&&t!==e?(e[0]=i,e[1]=r,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t)},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},s.inverse=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return e&&t!==e?(e[0]=-t[0]*a,e[1]=-t[1]*a,e[2]=-t[2]*a,e[3]=t[3]*a,e):(t[0]*=-a,t[1]*=-a,t[2]*=-a,t[3]*=a,t)},s.conjugate=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},s.length=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)},s.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],s=t[3],o=Math.sqrt(i*i+r*r+n*n+s*s);return 0===o?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(o=1/o,e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=s*o,e)},s.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[3],t)},s.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],s=t[2],o=t[3],a=e[0],l=e[1],h=e[2],u=e[3];return i[0]=r*u+o*a+n*h-s*l,i[1]=n*u+o*l+s*a-r*h,i[2]=s*u+o*h+r*l-n*a,i[3]=o*u-r*a-n*l-s*h,i},s.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],s=e[2],o=t[0],a=t[1],l=t[2],h=t[3],u=h*r+a*s-l*n,c=h*n+l*r-o*s,d=h*s+o*n-a*r,p=-o*r-a*n-l*s;return i[0]=u*h+p*-o+c*-l-d*-a,i[1]=c*h+p*-a+d*-o-u*-l,i[2]=d*h+p*-l+u*-a-c*-o,i},s.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t)},s.toMat4=function(t,e){e||(e=n.create());var i=t[0],r=t[1],s=t[2],o=t[3],a=i+i,l=r+r,h=s+s,u=i*a,c=i*l,d=i*h,p=r*l,f=r*h,g=s*h,m=o*a,v=o*l,y=o*h;return e[0]=1-(p+g),e[1]=c+y,e[2]=d-v,e[3]=0,e[4]=c-y,e[5]=1-(u+g),e[6]=f+m,e[7]=0,e[8]=d+v,e[9]=f-m,e[10]=1-(u+p),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},s.slerp=function(t,e,i,r){r||(r=t);var n,s,o,a,l=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return Math.abs(l)>=1?(r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r):(n=Math.acos(l),s=Math.sqrt(1-l*l),Math.abs(s)<.001?(r[0]=.5*t[0]+.5*e[0],r[1]=.5*t[1]+.5*e[1],r[2]=.5*t[2]+.5*e[2],r[3]=.5*t[3]+.5*e[3],r):(o=Math.sin((1-i)*n)/s,a=Math.sin(i*n)/s,r[0]=t[0]*o+e[0]*a,r[1]=t[1]*o+e[1]*a,r[2]=t[2]*o+e[2]*a,r[3]=t[3]*o+e[3]*a,r))},s.fromRotationMatrix=function(t,e){e||(e=s.create());var i,r=t[0]+t[4]+t[8];if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[7]-t[5])*i,e[1]=(t[2]-t[6])*i,e[2]=(t[3]-t[1])*i;else{var n=s.fromRotationMatrix.s_iNext=s.fromRotationMatrix.s_iNext||[1,2,0],o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var a=n[o],l=n[a];i=Math.sqrt(t[3*o+o]-t[3*a+a]-t[3*l+l]+1),e[o]=.5*i,i=.5/i,e[3]=(t[3*l+a]-t[3*a+l])*i,e[a]=(t[3*a+o]+t[3*o+a])*i,e[l]=(t[3*l+o]+t[3*o+l])*i}return e},s.identity=function(t){return t||(t=s.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.fromAngleAxis=function(t,e,i){i||(i=s.create());var r=.5*t,n=Math.sin(r);return i[3]=Math.cos(r),i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i},s.toAngleAxis=function(t,e){e||(e=t);var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){e[3]=2*Math.acos(t[3]);var r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}else e[3]=0,e[0]=1,e[1]=0,e[2]=0;return e},s.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},window.vec3=i,window.mat4=n,window.quat4=s,n}),r("Tiling/Tile",["../Renderer/BoundingBox","../Renderer/glMatrix"],function(t){var e=function(){this.parent=null,this.parentIndex=-1,this.children=null,this.vertices=null,this.texture=null,this.vertexBuffer=null,this.texTransform=[1,1,0,0],this.matrix=null,this.inverseMatrix=null,this.bbox=new t,this.radius=0,this.distance=0,this.closestPointToEye=[0,0,0],this.extension={},this.state=e.State.NONE,this.config=null,this.imageSize=256};return e.State={ERROR:-10,NONE:0,REQUESTED:1,LOADING:2,LOADED:3},e.prototype.computePosition=function(t,e){var i=this.config.tesselation;t=Math.min(i-1,Math.max(0,t)),e=Math.min(i-1,Math.max(0,e));for(var r=Math.floor(e),n=e-r,s=Math.floor(t),o=t-s,a=this.config.vertexSize,l=a*(r*i+s),h=[0,0,0],u=0;u<3;u++)h[u]=(1-n)*(1-o)*this.vertices[l+u]+n*(1-o)*this.vertices[l+a*i+u]+n*o*this.vertices[l+a*i+a+u]+(1-n)*o*this.vertices[l+a+u];return h},e.prototype.initFromParent=function(t,e,i){this.parent=t,this.parentIndex=2*i+e,this.matrix=t.matrix,this.inverseMatrix=t.inverseMatrix,this.texture=t.texture,this.config=t.config,this.vertexBuffer=t.vertexBuffer;for(var r=this.config.tesselation,n=(r-1)/2,s=0;s<=n;s++)for(var o=this.config.vertexSize*((s+i*n)*r+e*n),a=0;a<=n;a++)this.bbox.extend(t.vertices[o],t.vertices[o+1],t.vertices[o+2]),o+=this.config.vertexSize;this.radius=this.bbox.getRadius();for(var l in t.extension)if(t.extension.hasOwnProperty(l)){var h=t.extension[l];h.initChild&&h.initChild(this,e,i)}},e.prototype.needsToBeRefined=function(t){if(this.distance<this.radius)return!0;var e=.25*(this.bbox.max[0]-this.bbox.min[0]+(this.bbox.max[1]-this.bbox.min[1]))/this.imageSize,i=this.matrix,r=this.closestPointToEye,n=i[0]*r[0]+i[4]*r[1]+i[8]*r[2]+i[12],s=i[1]*r[0]+i[5]*r[1]+i[9]*r[2]+i[13],o=i[2]*r[0]+i[6]*r[1]+i[10]*r[2]+i[14],a=t.pixelSizeVector,l=e/(n*a[0]+s*a[1]+o*a[2]+a[3]);return Math.abs(l)>t.tileErrorTreshold},e.prototype.isCulled=function(t){var e=this.inverseMatrix,i=t.eyePosition,r=e[0]*i[0]+e[4]*i[1]+e[8]*i[2]+e[12],n=e[1]*i[0]+e[5]*i[1]+e[9]*i[2]+e[13],s=e[2]*i[0]+e[6]*i[1]+e[10]*i[2]+e[14];if(this.distance=Math.sqrt(r*r+n*n+s*s),this.distance<this.radius)return this.distance=0,!1;var o=this.closestPointToEye;if(o[0]=Math.min(Math.max(r,this.bbox.min[0]),this.bbox.max[0]),o[1]=Math.min(Math.max(n,this.bbox.min[1]),this.bbox.max[1]),o[2]=Math.min(Math.max(s,this.bbox.min[2]),this.bbox.max[2]),s<0&&!this.config.coordinateSystem.isFlat()){var a=o[0],l=o[1],h=o[2]+this.config.coordinateSystem.geoide.radius,u=Math.sqrt(a*a+l*l+h*h);a/=u,l/=u,h/=u;var c=r-a*this.config.coordinateSystem.geoide.radius,d=n-l*this.config.coordinateSystem.geoide.radius,p=s-(h-1)*this.config.coordinateSystem.geoide.radius,f=Math.sqrt(c*c+d*d+p*p),g=(c*a+d*l+p*h)/f;if(g*=this.config.cullSign,g<-.05)return!0}var m=t.localFrustum;return m.inverseTransform(t.worldFrustum,this.matrix),!m.containsBoundingBox(this.bbox)},e.prototype.dispose=function(t,i){for(var r in this.extension)this.extension[r].dispose&&this.extension[r].dispose(t,i);this.state===e.State.LOADED&&(i.disposeGLBuffer(this.vertexBuffer),this.texture&&i.disposeGLTexture(this.texture),this.vertexBuffer=null,this.texture=null,this.parent=null,this.state=e.State.NONE)},e.prototype.deleteChildren=function(t,e){if(this.children){for(var i=0;i<4;i++)this.children[i].deleteChildren(t,e),this.children[i].dispose(t,e);this.children=null}},e.prototype.buildSkirtVertices=function(t,e,i,r){for(var n=this.vertices,s=.05*this.radius,o=this.config.tesselation,a=0;a<o;a++){var l=n[e]-t[0],h=n[e+1]-t[1],u=n[e+2]-t[2],c=s/Math.sqrt(l*l+h*h+u*u);l*=c,h*=c,u*=c,n[r]=n[e]-l,n[r+1]=n[e+1]-h,n[r+2]=n[e+2]-u;for(var d=3;d<this.config.vertexSize;d++)n[r+d]=n[e+d];r+=this.config.vertexSize,e+=i}},e.prototype.generateNormals=function(){for(var t=this.config.tesselation,e=this.config.vertexSize,i=e*t,r=0,n=0;n<t;n++)for(var s=n===t-1?0:i,o=0===n?0:-i,a=0;a<t;a++){var l=a===t-1?0:e,h=0===a?0:-e,u=[this.vertices[r+l]-this.vertices[r+h],this.vertices[r+l+1]-this.vertices[r+h+1],this.vertices[r+l+2]-this.vertices[r+h+2]],c=[this.vertices[r+s]-this.vertices[r+o],this.vertices[r+s+1]-this.vertices[r+o+1],this.vertices[r+s+2]-this.vertices[r+o+2]],d=vec3.cross(u,c,[]);vec3.normalize(d),this.vertices[r+3]=d[0],this.vertices[r+4]=d[1],this.vertices[r+5]=d[2],r+=e}},e.prototype.generate=function(t,i,r){this.vertices=this.generateVertices(r);var n=this.config.tesselation,s=this.config.vertexSize;if(this.bbox.compute(this.vertices,s*n*n,s),this.radius=this.bbox.getRadius(),this.config.normals&&this.generateNormals(),this.config.skirt){var o=[0,0,0];mat4.multiplyVec3(this.inverseMatrix,o);var a=s*(n*n);this.buildSkirtVertices(o,0,s,a),a+=s*n,this.buildSkirtVertices(o,s*(n*(n-1)),s,a),a+=s*n,this.buildSkirtVertices(o,0,s*n,a),a+=s*n,this.buildSkirtVertices(o,s*(n-1),s*n,a),a+=s*n,this.buildSkirtVertices(o,s*(n*(n-1)/2),s,a),a+=s*n,this.buildSkirtVertices(o,s*((n-1)/2),s*n,a)}null!==this.vertexBuffer&&null===this.parent&&t.disposeGLBuffer(this.vertexBuffer),this.vertexBuffer=t.createGLBuffer(this.vertices),i&&(this.texture=t.createGLTexture(i),this.imageSize=this.config.imageSize),this.state=e.State.LOADED},e}),r("Utils/ImageRequest",[],function(){var t=function(t){this.successCallback=t.successCallback,this.failCallback=t.failCallback,this.abortCallback=t.abortCallback,this.image=null};return t.prototype.send=function(t,e){this.image=new Image,this.image.crossOrigin=e,this.image.dataType="byte";var i=this;this.image.onload=function(){var t=0!==i.image.naturalWidth&&i.image.complete;t&&i.successCallback(i)},this.image.onerror=this.failCallback.bind(this),this.image.src=t},t.prototype.abort=function(){this.abortCallback&&this.abortCallback(this),this.image.src=""},t}),r("Renderer/RendererTileData",[],function(){var t=function(t){this.manager=t,this.renderables=[]};return t.prototype.initChild=function(e,i,r){for(var n,s=0;s<this.renderables.length;s++)if(this.renderables[s].initChild){var o=this.renderables[s].initChild(i,r,e);o&&(n||(n=e.extension.renderer=new t(this.manager)),n.renderables.push(o))}},t.prototype.traverse=function(t,e){for(var i=0;i<this.renderables.length;i++){var r=this.renderables[i],n=r.bucket;if(n.layer.isVisible()&&n.layer.opacity>0)if(r.traverse)r.traverse(this.manager,t,e);else{if(r.hasChildren&&!e)continue;this.manager.renderables.push(r)}}},t.prototype.getRenderable=function(t){for(var e=0;e<this.renderables.length;e++)if(t===this.renderables[e].bucket)return this.renderables[e];return null},t.prototype.dispose=function(t,e){for(var i=0;i<this.renderables.length;i++)this.renderables[i].dispose(t,e);this.renderables.length=0},t}),r("Renderer/RasterOverlayRenderer",["./Program","../Tiling/Tile","../Utils/ImageRequest","./RendererTileData"],function(t,e,i,r){var n=function(t){this.vertexShader="attribute vec3 vertex;\n",this.vertexShader+="attribute vec2 tcoord;\n",this.vertexShader+="uniform mat4 modelViewMatrix;\n",this.vertexShader+="uniform mat4 projectionMatrix;\n",this.vertexShader+="uniform vec4 textureTransform; \n",this.vertexShader+="varying vec2 texCoord;\n",this.vertexShader+="void main(void) \n",this.vertexShader+="{\n",this.vertexShader+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",this.vertexShader+="\ttexCoord = tcoord * textureTransform.xy + textureTransform.zw;\n",this.vertexShader+="}\n",this.fragmentShader="precision lowp float;\n",this.fragmentShader+="varying vec2 texCoord;\n",this.fragmentShader+="uniform sampler2D overlayTexture;\n",this.fragmentShader+="uniform float opacity; \n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor.rgba = texture2D(overlayTexture, texCoord.xy); \n",this.fragmentShader+="\tgl_FragColor.a *= opacity; \n",this.fragmentShader+="}\n",this.rendererManager=t.vectorRendererManager,this.tileManager=t.tileManager,this.programs=[],this.program=this.createProgram({vertexCode:this.vertexShader,fragmentCode:this.fragmentShader,updateUniforms:null}),this.buckets=[],this.imageRequests=[],this.frameNumber=0;for(var e=this,r=0;r<4;r++){var n=new i({successCallback:function(){this.renderable&&(this.renderable.bucket.layer.handleImage&&this.renderable.bucket.layer.handleImage(this),this.renderable.ownTexture=e.tileManager.tilePool.createGLTexture(this.image),this.renderable.texture=this.renderable.ownTexture,this.renderable.uvScale=1,this.renderable.uTrans=0,this.renderable.vTrans=0,this.renderable.updateChildrenTexture(),this.renderable.onRequestFinished(!0),this.renderable=null,e.tileManager.renderContext.requestFrame())},failCallback:function(){this.renderable&&(this.renderable.onRequestFinished(!0),this.renderable=null)},abortCallback:function(){this.renderable&&(this.renderable.onRequestFinished(!1),this.renderable=null)}});this.imageRequests.push(n)}},s=function(t){this.bucket=t,this.ownTexture=null,this.texture=null,this.request=null,this.requestFinished=!1,this.tile=null,this.uvScale=1,this.uTrans=0,this.vTrans=0};s.prototype.onRequestStarted=function(t){this.request=t,this.requestFinished=!1;var e=this.bucket.layer;0===e._numRequests&&e.globe.publishEvent("startLoad",e),e._numRequests++},s.prototype.onRequestFinished=function(t){this.request=null,this.requestFinished=t;var e=this.bucket.layer;e._numRequests--,e.globe&&0===e._numRequests&&e.globe.publishEvent("endLoad",e)},s.prototype.initChild=function(t,e,i){var r=this.bucket.createRenderable();return r.tile=i,this.texture&&(r.texture=this.texture,r.uvScale=this.uvScale,r.uTrans=this.uTrans,r.vTrans=this.vTrans),r},s.prototype.generateChild=function(t){var e=this.bucket.renderer;e.addOverlayToTile(t,this.bucket,this)},s.prototype.updateChildrenTexture=function(){if(this.tile.children)for(var t=0;t<4;t++){var e=this.tile.children[t].extension.renderer;if(e){var i=e.getRenderable(this.bucket);i&&!i.ownTexture&&(i.updateTextureFromParent(this),i.updateChildrenTexture())}}},s.prototype.updateTextureFromParent=function(t){this.tile.state===e.State.LOADED?(this.texture=t.texture,this.uvScale=.5*t.uvScale,this.uTrans=t.uTrans,this.vTrans=t.vTrans,this.uTrans+=1&this.tile.parentIndex?this.uvScale:0,this.vTrans+=2&this.tile.parentIndex?this.uvScale:0):(this.texture=t.texture,this.uvScale=t.uvScale,this.uTrans=t.uTrans,this.vTrans=t.vTrans)},s.prototype.traverse=function(t,i,r){r&&this.texture&&t.renderables.push(this),this.requestFinished||this.tile.state!==e.State.LOADED||this.bucket.renderer.requestOverlayTextureForTile(this)},s.prototype.dispose=function(t,e){this.ownTexture&&(e.disposeGLTexture(this.ownTexture),this.ownTexture=null)};var o=function(t){this.layer=t,this.renderer=null,this.style=t};o.prototype.createRenderable=function(){return new s(this)},n.prototype.addOverlay=function(t){t._numRequests=0;var i=new o(t);i.renderer=this,i.id=this.rendererManager.bucketId++,this.buckets.push(i),t._bucket=i;for(var r=0;r<this.tileManager.level0Tiles.length;r++){var n=this.tileManager.level0Tiles[r];n.state===e.State.LOADED&&this.addOverlayToTile(n,i)}},n.prototype.removeOverlay=function(t){var e=this.buckets.indexOf(t._bucket);this.buckets.splice(e,1);var i=this.tileManager.renderContext,r=this.tileManager.tilePool;this.tileManager.visitTiles(function(e){var n=e.extension.renderer,s=n?n.getRenderable(t._bucket):null;if(s){var o=n.renderables.indexOf(s);n.renderables.splice(o,1),s.dispose(i,r),0===n.renderables.length&&delete e.extension.renderer}})},n.prototype.addOverlayToTile=function(t,i,n){if(this.overlayIntersects(t.geoBound,i.layer)){t.extension.renderer||(t.extension.renderer=new r(this.rendererManager));var s=i.createRenderable();if(s.tile=t,t.extension.renderer.renderables.push(s),n&&n.texture&&s.updateTextureFromParent(n),t.children)for(var o=0;o<4;o++)t.children[o].state===e.State.LOADED&&this.addOverlayToTile(t.children[o],i,s)}};var a=function(t,e,i){return[e[0]+t*(i[0]-e[0]),e[1]+t*(i[1]-e[1])]};return n.prototype.clipPolygonToSide=function(t,e,i,r){for(var n,s,o=[],l=0;l<r.length;l++){var h=r[l],u=r[(l+1)%r.length],c=h[t],d=u[t],p=(c-i)*e>=0,f=(d-i)*e>=0;!p&&f?(n=(i-c)/(d-c),s=a(n,h,u),o.push(s),o.push(u)):p&&f?o.push(u):p&&!f&&(n=(i-c)/(d-c),s=a(n,h,u),o.push(s))}return o},n.prototype.overlayIntersects=function(t,e){if(e.coordinates){var i;return i=this.clipPolygonToSide(0,1,t.west,e.coordinates),i=this.clipPolygonToSide(0,-1,t.east,i),i=this.clipPolygonToSide(1,1,t.south,i),i=this.clipPolygonToSide(1,-1,t.north,i),i.length>0}return!e.geoBound||e.geoBound.intersects(t)},n.prototype.generateLevelZero=function(t){for(var e=0;e<this.buckets.length;e++)this.addOverlayToTile(t,this.buckets[e])},n.prototype.requestOverlayTextureForTile=function(t){if(t.request)t.request.frameNumber=this.frameNumber;else{for(var e,i=0;i<this.imageRequests.length;i++)if(!this.imageRequests[i].renderable){e=this.imageRequests[i];break}e&&(t.onRequestStarted(e),e.renderable=t,e.frameNumber=this.frameNumber,e.send(t.bucket.layer.getUrl(t.tile),t.bucket.layer.crossOrigin))}},n.prototype.createProgram=function(e){var i=new t(this.tileManager.renderContext);return i.createFromSource(this.vertexShader,e.fragmentCode),i.id=this.programs.length,this.programs.push({fragmentCode:e.fragmentCode,program:i}),i},n.prototype.getProgram=function(t){for(var e,i=0;i<this.programs.length;i++)this.programs[i].fragmentCode===t.fragmentCode&&(e=this.programs[i].program);return e||(e=this.createProgram(t)),e},n.prototype.render=function(t,i,r){var n=this.tileManager.renderContext,s=n.gl;s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.depthFunc(s.LEQUAL);for(var o=mat4.create(),a=null,l=null,h=i;h<r;h++){var u,c,d=t[h],p=d.bucket,f=p.layer;f.customShader?(c=this.getProgram(f.customShader),u=f.customShader.updateUniforms):c=this.getProgram({vertexCode:this.vertexShader,fragmentCode:this.fragmentShader,updateUniforms:null}),c!==l&&(l=c,c.apply(),s.uniformMatrix4fv(c.uniforms.projectionMatrix,!1,n.projectionMatrix),s.uniform1i(c.uniforms.overlayTexture,0),s.bindBuffer(s.ARRAY_BUFFER,this.tileManager.tcoordBuffer),s.vertexAttribPointer(c.attributes.tcoord,2,s.FLOAT,!1,0,0)),u&&u(s,c),s.bindBuffer(s.ARRAY_BUFFER,d.tile.vertexBuffer),s.vertexAttribPointer(c.attributes.vertex,3,s.FLOAT,!1,4*d.tile.config.vertexSize,0);var g=d.tile.state===e.State.LOADED?this.tileManager.tileIndexBuffer.getSolid():this.tileManager.tileIndexBuffer.getSubSolid(d.tile.parentIndex);a!==g&&(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,g),a=g),mat4.multiply(n.viewMatrix,d.tile.matrix,o),s.uniformMatrix4fv(c.uniforms.modelViewMatrix,!1,o),s.uniform1f(c.uniforms.opacity,f.opacity),s.uniform4f(c.uniforms.textureTransform,d.uvScale,d.uvScale,d.uTrans,d.vTrans),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,d.texture),s.drawElements(s.TRIANGLES,a.numIndices,s.UNSIGNED_SHORT,0)}s.disable(s.BLEND),s.depthFunc(s.LESS)},n.prototype.canApply=function(t,e){return!1},n}),r("Utils/Cache",[],function(){var t=function(t){this.layer=t.layer,this.cacheLevel=t.hasOwnProperty("cacheLevel")?t.cacheLevel:1,localStorage.getItem(this.layer.name)||localStorage.setItem(this.layer.name,JSON.stringify({})),this._cacheMap=JSON.parse(localStorage.getItem(this.layer.name)),this.imgCanvas=document.createElement("canvas"),this.imgCanvas.width=t.tilePixelSize||256,this.imgCanvas.height=t.tilePixelSize||256,this.imgContext=this.imgCanvas.getContext("2d")};return t.prototype.getFromCache=function(t){var e=null;if(this.cacheLevel>=t.level){var i=this.layer.getUrl(t),r=this._cacheMap[i];if(r){r.lastAccess=Date.now();var n=new Image;n.src=r.dataUrl,n.dataType="byte",e={image:n,elevations:r.elevations}}}return e},t.prototype._createDataURL=function(t){return this.imgContext.drawImage(t,0,0,t.width,t.height),this.imgCanvas.toDataURL("image/png")},t.prototype.storeInCache=function(t){var e=t.tile;if(this.cacheLevel>=e.level){var i=this.layer.getUrl(e);this._cacheMap[i]={dataUrl:this._createDataURL(t.image),elevations:t.elevations,lastAccess:Date.now()},console.log("Stored for "+t.image.src),localStorage.setItem(this.layer.name,JSON.stringify(this._cacheMap))}},t}),r("Layer/AbstractRasterLayer",["../Utils/Utils","./AbstractLayer","../Renderer/RasterOverlayRenderer","../Utils/Cache"],function(t,e,i,r){var n=function(t,i){e.prototype.constructor.call(this,t,i),this.tilePixelSize=i.tilePixelSize,this.tiling=i.tiling,this.numberOfLevels=i.numberOfLevels,this.geoBound=i.geoBound||null,this.coordinates=i.coordinates||null,this.zIndex=i.zIndex||0,this.crossOrigin=i.crossOrigin||"anonymous",this.baseUrl=i.baseUrl,i.cache&&(i.cache.layer=this,this.cache=new r(i.cache)),this._overlay=!0,this._ready=!0};return t.inherits(e,n),n.prototype._attach=function(t){if(this._overlay||(this.id=0),e.prototype._attach.call(this,t),this._overlay){if(!t.rasterOverlayRenderer){var r=new i(t);t.vectorRendererManager.renderers.push(r),t.rasterOverlayRenderer=r}t.rasterOverlayRenderer.addOverlay(this)}},n.prototype._detach=function(){this._overlay&&this.globe.rasterOverlayRenderer&&this.globe.rasterOverlayRenderer.removeOverlay(this),e.prototype._detach.call(this)},n}),r("Renderer/GeoBound",["../Utils/Constants"],function(t){function e(t,e,i){for(var r=t.length,n=new Array(r),s=0;s<r;++s)n[s]=t[s].slice(0);n[0][0]=i.convert(t[0][0],e,i.getGeoideName()),n[0][1]=i.convert(t[0][1],e,i.getGeoideName());for(var o=1;o<t.length;o++)n[o][0]=i.convert(t[o][0],e,i.getGeoideName()),n[o][1]=i.convert(t[o][1],e,i.getGeoideName());return n}var i=function(t,e,i,r){this.south=e,this.west=t,this.north=r,this.east=i};return i.prototype.getCenter=function(){return[.5*(this.east+this.west),.5*(this.south+this.north),0]},i.prototype.getNorth=function(){return this.north},i.prototype.setNorth=function(t){this.north=t},i.prototype.getSouth=function(){return this.south},i.prototype.setSouth=function(t){this.south=t},i.prototype.getWest=function(){return this.west},i.prototype.setWest=function(t){this.west=t},i.prototype.getEast=function(){return this.east},i.prototype.setEast=function(t){this.east=t},i.prototype.computeFromCoordinates=function(t){this.west=t[0][0],this.east=t[0][0],this.south=t[0][1],this.north=t[0][1];for(var e=1;e<t.length;e++)this.west=Math.min(this.west,t[e][0]),this.east=Math.max(this.east,t[e][0]),this.south=Math.min(this.south,t[e][1]),this.north=Math.max(this.north,t[e][1])},i.prototype.computeFromCoordinatesInCrsTo=function(t,i,r){var n;return n=i===r.getGeoideName()?t:e(t,i,r),this.computeFromCoordinates(n),n},i.prototype.isPointInside=function(t){return t[0]>=this.west&&t[0]<=this.east&&t[1]>=this.south&&t[1]<=this.north},i.prototype.intersects=function(t){return!(this.west>=t.east||this.east<=t.west)&&!(this.south>=t.north||this.north<=t.south)},i.prototype.intersectsGeometry=function(e){var r,n,s=!1,o=new i,a=e.coordinates;switch(e.type){case t.GEOMETRY.LineString:o.computeFromCoordinates(a),s|=this.intersects(o);break;case t.GEOMETRY.Polygon:for(r=0;r<a.length&&!s;r++)o.computeFromCoordinates(a[r]),s|=this.intersects(o);break;case t.GEOMETRY.MultiLineString:for(r=0;r<a.length&&!s;r++)o.computeFromCoordinates(a[r]),s|=this.intersects(o);break;case t.GEOMETRY.MultiPolygon:for(r=0;r<a.length&&!s;r++)for(n=0;n<a[r].length&&!s;n++)o.computeFromCoordinates(a[r][n]),s|=this.intersects(o)}return s},i}),r("Tiling/GeoTiling",["../Utils/Utils","../Utils/Constants","./Tile","../Renderer/GeoBound","./HEALPixBase","../Renderer/glMatrix"],function(t,e,i,r,n){var s=function(t,e,r,n){i.prototype.constructor.call(this),this.bound=this.geoBound=t,this.level=e,this.x=r,this.y=n};s.prototype=new i,s.prototype.getElevation=function(t,e){var r=(t-this.geoBound.getWest())/(this.geoBound.getEast()-this.geoBound.getWest()),n=(e-this.geoBound.getNorth())/(this.geoBound.getSouth()-this.geoBound.getNorth()),s=2*(n>=1?1:Math.floor(2*n))+Math.floor(2*r);if(this.children&&this.children[s].state===i.State.LOADED)return this.children[s].getElevation(t,e);var o=this.config.tesselation,a=Math.floor(r*o),l=Math.floor(n*o),h=this.config.vertexSize*(l*o+a),u=[this.vertices[h],this.vertices[h+1],this.vertices[h+2]];
mat4.multiplyVec3(this.matrix,u);var c=this.config.coordinateSystem.getWorldFrom3D(u);return c[2]},s.prototype.createChildren=function(){var t=.5*(this.geoBound.getEast()+this.geoBound.getWest()),e=.5*(this.geoBound.getNorth()+this.geoBound.getSouth()),i=this.level+1,n=new s(new r(this.geoBound.getWest(),e,t,this.geoBound.getNorth()),i,2*this.x,2*this.y),o=new s(new r(t,e,this.geoBound.getEast(),this.geoBound.getNorth()),i,2*this.x+1,2*this.y),a=new s(new r(this.geoBound.getWest(),this.geoBound.getSouth(),t,e),i,2*this.x,2*this.y+1),l=new s(new r(t,this.geoBound.getSouth(),this.geoBound.getEast(),e),i,2*this.x+1,2*this.y+1);n.initFromParent(this,0,0),o.initFromParent(this,1,0),a.initFromParent(this,0,1),l.initFromParent(this,1,1),this.children=[n,o,a,l]},s.prototype.lonlat2tile=function(t){for(var e=this.geoBound.getEast()-this.geoBound.getWest(),i=this.geoBound.getSouth()-this.geoBound.getNorth(),r=this.config.tesselation-1,n=[],s=0;s<t.length;s++){var o=r*(t[s][0]-this.geoBound.getWest())/e,a=r*(t[s][1]-this.geoBound.getNorth())/i;n.push([o,a])}return n},s.prototype.generateVertices=function(t){this.matrix=this.config.coordinateSystem.getLHVTransform(this.geoBound.getCenter());var e=mat4.create();mat4.inverse(this.matrix,e),this.inverseMatrix=e;for(var i=this.config.vertexSize,r=this.config.tesselation,n=new Float32Array(i*r*(r+6)),s=(this.geoBound.getEast()-this.geoBound.getWest())/(r-1),o=(this.geoBound.getSouth()-this.geoBound.getNorth())/(r-1),a=(this.config.coordinateSystem.getGeoide().getRadius(),this.config.coordinateSystem.getGeoide().getHeightScale(),0),l=this.geoBound.getNorth(),h=[0,0,0],u=0;u<r;u++){for(var c=this.geoBound.getWest(),d=0;d<r;d++){var p=t?t[a]:0;this.config.coordinateSystem.get3DFromWorld([c,l,p],h);var f=h[0],g=h[1],m=h[2],v=a*i;n[v]=e[0]*f+e[4]*g+e[8]*m+e[12],n[v+1]=e[1]*f+e[5]*g+e[9]*m+e[13],n[v+2]=e[2]*f+e[6]*g+e[10]*m+e[14],a++,c+=s}l+=o}return n};var o=function(t,e){this.level0NumTilesX=t,this.level0NumTilesY=e};o.prototype.generateLevelZeroTiles=function(t){t.skirt=!t.coordinateSystem.isFlat(),t.cullSign=1,t.srs="EPSG:4326";for(var e=[],i=(t.coordinateSystem.getGeoBound().getNorth()-t.coordinateSystem.getGeoBound().getSouth())/this.level0NumTilesY,n=(t.coordinateSystem.getGeoBound().getEast()-t.coordinateSystem.getGeoBound().getWest())/this.level0NumTilesX,o=0;o<this.level0NumTilesY;o++)for(var a=0;a<this.level0NumTilesX;a++){var l=new r(t.coordinateSystem.getGeoBound().getWest()+a*n,t.coordinateSystem.getGeoBound().getNorth()-(o+1)*i,t.coordinateSystem.getGeoBound().getWest()+(a+1)*n,t.coordinateSystem.getGeoBound().getNorth()-o*i),h=new s(l,0,a,o);h.config=t,e.push(h)}return e};var a=function(t){var i,r=!0;switch(t.type){case e.GEOMETRY.Point:return i=t.coordinates,[i[0],i[1],i[0],i[1]];case e.GEOMETRY.MultiPoint:i=t.coordinates,r=!1;break;case e.GEOMETRY.Polygon:i=t.coordinates[0];break;case e.GEOMETRY.MultiPolygon:i=t.coordinates[0][0];break;case e.GEOMETRY.LineString:i=t.coordinates;break;case e.GEOMETRY.MultiLineString:i=t.coordinates[0]}if(i&&0!==i.length){for(var n=i[0][0],s=i[0][1],o=i[0][0],a=i[0][1],l=t.type===e.GEOMETRY.MultiPolygon||t.type===e.GEOMETRY.MultiLineString?t.coordinates.length:1,h=0;h<l;h++){switch(t.type){case e.GEOMETRY.MultiPolygon:i=t.coordinates[h][0];break;case e.GEOMETRY.MultiLineString:i=t.coordinates[h]}for(var u=0;u<i.length;u++)n=Math.min(n,i[u][0]),s=Math.min(s,i[u][1]),o=Math.max(o,i[u][0]),a=Math.max(a,i[u][1]),r&&u>0&&Math.abs(i[u-1][0]-i[u][0])>180&&(n=-180,o=180)}return[n,s,o,a]}};return o.prototype._lon2LevelZeroIndex=function(t){return Math.min(this.level0NumTilesX-1,Math.floor((t+180)*this.level0NumTilesX/360))},o.prototype._lat2LevelZeroIndex=function(t){return Math.min(this.level0NumTilesY-1,Math.floor((90-t)*this.level0NumTilesY/180))},o.prototype.lonlat2LevelZeroIndex=function(t,e){return this._lat2LevelZeroIndex(e)*this.level0NumTilesX+this._lon2LevelZeroIndex(t)},o.prototype.getOverlappedLevelZeroTiles=function(t){var e=[],i=a(t);if(i)for(var r=this._lon2LevelZeroIndex(i[0]),n=this._lat2LevelZeroIndex(i[3]),s=this._lon2LevelZeroIndex(i[2]),o=this._lat2LevelZeroIndex(i[1]),l=n;l<=o;l++)for(var h=r;h<=s;h++)e.push(l*this.level0NumTilesX+h);return e},o.prototype.findInsideTile=function(t,e,i){for(var r=0;r<i.length;r++){var s=i[r],o=n.lonLat2pix(s.order,t,e);if(o===s.pixelIndex)return s}return null},o}),r("Layer/WMSLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/GeoTiling"],function(t,e,i,r){var n=function(t){t.tilePixelSize=t.tilePixelSize||256,t.tiling=new r(4,2),t.numberOfLevels=t.numberOfLevels||21,e.prototype.constructor.call(this,i.LAYER.WMS,t);var n=this.baseUrl;n+=n.indexOf("?",0)===-1?"?service=wms":"&service=wms",n+="&version=",n+=t.hasOwnProperty("version")?t.version:"1.1.1",n+="&request=GetMap",n+="&layers="+t.layers,n+="&styles=",t.hasOwnProperty("styles")&&(n+=t.styles),n+="&format=",this.format=t.hasOwnProperty("format")?t.format:"image/jpeg",n+=this.format,t.hasOwnProperty("transparent")&&(n+="&transparent="+t.transparent),n+="&width=",n+=this.tilePixelSize,n+="&height=",n+=this.tilePixelSize,t.hasOwnProperty("time")&&(n+="&time="+t.time),this.getMapBaseUrl=n};return t.inherits(e,n),n.prototype.getUrl=function(t){var e=t.bound,i=this.getMapBaseUrl;return i+="&srs="+t.config.srs,i+="&bbox=",i+=e.west,i+=",",i+=e.south,i+=",",i+=e.east,i+=",",i+=e.north},n.prototype.getBaseURl=function(){return this.getMapBaseUrl},n}),r("Layer/WMTSLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,i.LAYER.WMTS,t),this.startLevel=t.startLevel||1;var r=this.baseUrl;r+=r.indexOf("?",0)===-1?"?service=wmts":"&service=wmts",r+="&version=",r+=t.version||"1.0.0",r+="&request=GetTile",r+="&layer="+t.layer,r+="&tilematrixset="+t.matrixSet,t.style&&(r+="&style="+t.style),r+="&format=",this.format=t.hasOwnProperty("format")?t.format:"image/png",r+=this.format,t.time&&(r+="&time="+t.time),this.getTileBaseUrl=r};return t.inherits(e,r),r.prototype.getUrl=function(t){var e=this.getTileBaseUrl;return e+="&tilematrix=",e+=t.level+this.startLevel,e+="&tilecol="+t.x,e+="&tilerow="+t.y},r.prototype.getBaseURl=function(){return this.getTileBaseUrl},r}),r("Layer/WCSElevationLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/GeoTiling"],function(t,e,i,r){var n=function(t){t.tilePixelSize=t.tilePixelSize||33,t.tiling=new r(4,2),t.numberOfLevels=t.numberOfLevels||21,e.prototype.constructor.call(this,i.LAYER.WMSElevation,t),this.version=t.version||"2.0.0",this.format=t.format||"image/x-aaigrid",this.minElevation=t.minElevation||0,this.scale=t.scale||1;var n=this.baseUrl;switch(n+=n.indexOf("?",0)===-1?"?service=wcs":"&service=wcs",n+="&version="+this.version,n+="&request=GetCoverage",this.version.substring(0,3)){case"2.0":this.crs=t.outputCRS||t.crs||"http://www.opengis.net/def/crs/EPSG/0/4326",n+="&outputCRS="+this.crs,n+="&size=x("+this.tilePixelSize+")",n+="&size=y("+this.tilePixelSize+")",n+="&coverageid="+t.coverage;break;case"1.0":n+="&width="+this.tilePixelSize,n+="&height="+this.tilePixelSize,n+="&crs="+(t.crs||"EPSG:4326"),n+="&coverage="+t.coverage}n+="&format="+this.format,this.getCoverageBaseUrl=n};return t.inherits(e,n),n.prototype.parseElevations=function(t){if(null===t)return this._returnZeroElevations();switch(this.format){case"image/x-aaigrid":return this._parseAAIGrid(t);default:return console.log("Format '"+this.format+"' could not be parsed."),this._returnZeroElevations()}},n.prototype._returnZeroElevations=function(){for(var t=[],e=0;e<this.tilePixelSize*this.tilePixelSize;++e)t.push(0);return t},n.prototype._parseAAIGrid=function(t){var e,i=[],r=t.trim().split("\n"),n=0;for(e=0;e<r.length;++e)if(" "===r[e].substring(0,1)){n=e;break}for(e=n;e<r.length;e++)for(var s=r[e].trim().split(/\s+/),o=0;o<s.length;o++){var a=parseInt(s[o],10);a<this.minElevation&&(a=this.minElevation),i.push(a*this.scale)}return i},n.prototype.getBaseURl=function(){return this.getCoverageBaseUrl},n.prototype.getUrl=function(t){var e=t.geoBound,i=this.getCoverageBaseUrl;return"2.0"===this.version.substring(0,3)?(i+="&subset=x,"+this.crs+"("+e.west+","+e.east+")",i+="&subset=y,"+this.crs+"("+e.south+","+e.north+")"):"1.0"===this.version.substring(0,3)&&(i+="&bbox=",i+=e.west,i+=",",i+=e.south,i+=",",i+=e.east,i+=",",i+=e.north),i},n}),r("Layer/VectorLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/FeatureStyle"],function(t,e,i,r){var n=function(t){e.prototype.constructor.call(this,i.LAYER.Vector,t),t&&t.url?this.url=t.url:this.url=null,t&&t.callback?this.callback=t.callback:this.callback=null,this.minLevel=t&&t.hasOwnProperty("minLevel")?t.minLevel:0,this.maxLevel=t&&t.hasOwnProperty("maxLevel")?t.maxLevel:15,this.features=[]};return t.inherits(e,n),n.prototype._attach=function(t){e.prototype._attach.call(this,t);for(var i=0;i<this.features.length;i++)this._addFeatureToRenderers(this.features[i])},n.prototype._detach=function(){for(var t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);e.prototype._detach.call(this)},n.prototype.addFeatureCollection=function(t){var e=t.features;if(e)for(var i=0;i<e.length;i++)this.addFeature(e[i])},n.prototype.removeFeatureCollection=function(t){var e=t.features;if(e)for(var i=0;i<e.length;i++)this.removeFeature(e[i])},n.prototype._addFeatureToRenderers=function(t){var e=t.geometry,i=this.style,r=t.properties;if(r&&r.style&&(i=r.style),"GeometryCollection"===e.type)for(var n=e.geometries,s=0;s<n.length;s++)this.globe.vectorRendererManager.addGeometry(this,n[s],i);else this.globe.vectorRendererManager.addGeometry(this,e,i)},n.prototype._removeFeatureFromRenderers=function(t){var e=t.geometry;if("GeometryCollection"===e.type){var i=e.geometries,r=!1;if(this.globe&&this.globe.vectorRendererManager)for(var n=0;n<i.length;n++)r=this.globe.vectorRendererManager.removeGeometry(i[n],this);return r}if(this.globe&&this.globe.vectorRendererManager)return this.globe.vectorRendererManager.removeGeometry(e,this)},n.prototype.addFeature=function(t){var e=t.geometry;e&&e.type&&(this.features.push(t),this.globe&&(this._addFeatureToRenderers(t),this.isVisible()&&this.globe.renderContext.requestFrame()))},n.prototype.removeFeature=function(t){var e=this.features.indexOf(t);this.features.splice(e,1),this.globe&&(this._removeFeatureFromRenderers(t),this.isVisible()&&this.globe.renderContext.requestFrame())},n.prototype.removeAllFeatures=function(){if(this.globe)for(var t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);this.features.length=0,this.globe&&this.isVisible()&&this.globe.renderContext.requestFrame()},n.prototype.modifyFeatureStyle=function(t,e){this._removeFeatureFromRenderers(t)&&(t.properties.style=e,this._addFeatureToRenderers(t))},n.prototype.modifyStyle=function(t){var e;for(e=0;e<this.features.length;e++)this._removeFeatureFromRenderers(this.features[e]);for(this.style=t,e=0;e<this.features.length;e++)this._addFeatureToRenderers(this.features[e])},n.prototype.getStyle=function(){return this.style},n.prototype.setStyle=function(t){this.style=t},n}),r("Layer/AtmosphereLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/Program"],function(t,e,i,r){var n=function(t){e.prototype.constructor.call(this,i.LAYER.Atmosphere,t),this.name||(this.name="Atmosphere"),this.kr=t&&t.kr||.0025,this.km=t&&t.km||.0015,this.sunBrightness=t&&t.sunBrightness||15,this.exposure=t&&t.exposure||2,this.wavelength=t&&t.wavelength||[.65,.57,.475],this.lightDir=t&&t.lightDir||[1,0,0],this._skyProgram=null,this._groundProgram=null,this._originalProgram=null,this._isValid=!1,this.zIndex=-1};return t.inherits(e,n),n.prototype._attach=function(t){this.globe=t,this._innerRadius=this.globe.getCoordinateSystem().getGeoide().getRadius(),this._outerRadius=1.005*this._innerRadius;var e=t.renderContext;if(this._skyFromSpaceProgram=new r(e),this._skyFromSpaceProgram.loadFromFile("SkyFromSpaceVert.glsl","SkyFrag.glsl"),this._skyFromAtmosphereProgram=new r(e),this._skyFromAtmosphereProgram.loadFromFile("SkyFromAtmosphereVert.glsl","SkyFrag.glsl"),this._groundFromSpaceProgram=new r(e),this._groundFromSpaceProgram.loadFromFile("GroundFromSpaceVert.glsl","GroundFrag.glsl"),this._groundFromAtmosphereProgram=new r(e),this._groundFromAtmosphereProgram.loadFromFile("GroundFromAtmosphereVert.glsl","GroundFrag.glsl"),this._isValid=null!==this._skyFromSpaceProgram.glProgram&&null!==this._skyFromAtmosphereProgram.glProgram&&null!==this._groundFromSpaceProgram.glProgram&&null!==this._groundFromAtmosphereProgram.glProgram,this._isValid){this._skyFromSpaceProgram.apply(),this._initUniforms(this._skyFromSpaceProgram.uniforms),this._skyFromAtmosphereProgram.apply(),this._initUniforms(this._skyFromAtmosphereProgram.uniforms),this._groundFromSpaceProgram.apply(),this._initUniforms(this._groundFromSpaceProgram.uniforms),this._groundFromAtmosphereProgram.apply(),this._initUniforms(this._groundFromAtmosphereProgram.uniforms);var i,n,s=[],o=[],a=72,l=144;for(i=-a;i<=a;i++){var h=i*(.5*Math.PI)/a;for(n=-l;n<=l;n++){var u=n*Math.PI/l,c=this._outerRadius*Math.cos(u)*Math.cos(h),d=this._outerRadius*Math.sin(u)*Math.cos(h),p=this._outerRadius*Math.sin(h);s.push(c),s.push(d),s.push(p)}}for(i=0;i<2*a;i++)for(n=0;n<2*l;n++)o.push(i*(2*l+1)+n),o.push((i+1)*(2*l+1)+n+1),o.push(i*(2*l+1)+n+1),o.push((i+1)*(2*l+1)+n+1),o.push(i*(2*l+1)+n),o.push((i+1)*(2*l+1)+n);var f=e.gl;this._vertexBuffer=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,this._vertexBuffer),f.bufferData(f.ARRAY_BUFFER,new Float32Array(s),f.STATIC_DRAW),this._indexBuffer=f.createBuffer(),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this._indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(o),f.STATIC_DRAW),this._numIndices=o.length,this._originalProgram=t.tileManager.program,t.preRenderers.push(this),t.tileManager.addPostRenderer(this)}},n.prototype._initUniforms=function(t){var e=this.globe.renderContext.gl,i=-.95,r=1/(this._outerRadius-this._innerRadius),n=.25;vec3.normalize(this.lightDir),e.uniform1f(t.fKrESun,this.kr*this.sunBrightness),e.uniform1f(t.fKmESun,this.kr*this.sunBrightness),e.uniform1f(t.fKr4PI,4*this.kr*Math.PI),e.uniform1f(t.fKm4PI,4*this.km*Math.PI),e.uniform1f(t.fExposure,this.exposure);var s=[Math.pow(this.wavelength[0],4),Math.pow(this.wavelength[1],4),Math.pow(this.wavelength[2],4)];e.uniform3f(t.v3InvWavelength,1/s[0],1/s[1],1/s[2]),e.uniform3f(t.v3LightPos,this.lightDir[0],this.lightDir[1],this.lightDir[2]),e.uniform1f(t.fInnerRadius,this._innerRadius),e.uniform1f(t.fInnerRadius2,this._innerRadius*this._innerRadius),e.uniform1f(t.fOuterRadius,this._outerRadius),e.uniform1f(t.fOuterRadius2,this._outerRadius*this._outerRadius),e.uniform1f(t.fScale,r),e.uniform1f(t.fScaleDepth,n),e.uniform1f(t.fScaleOverScaleDepth,r/n),e.uniform1f(t.g,i),e.uniform1f(t.g2,i*i)},n.prototype.preRender=function(){if(this._isValid){var t=this.globe.tileManager;if(!this.isVisible())return void(t.program=this._originalProgram);var e,i,r,n=this.globe.renderContext,s=n.gl,o=n.viewMatrix;e=o[12],i=o[13],r=o[14];var a=[-(o[0]*e+o[1]*i+o[2]*r),-(o[4]*e+o[5]*i+o[6]*r),-(o[8]*e+o[9]*i+o[10]*r)],l=vec3.length(a);this._skyProgram=l<this._outerRadius?this._skyFromAtmosphereProgram:this._skyFromSpaceProgram,this._groundProgram=l<this._outerRadius?this._groundFromAtmosphereProgram:this._groundFromSpaceProgram,this._skyProgram.apply(),s.uniform3f(this._skyProgram.uniforms.v3CameraPos,a[0],a[1],a[2]),s.uniform1f(this._skyProgram.uniforms.fCameraHeight2,l*l),s.uniform1f(this._skyProgram.uniforms.fCameraHeight,l),this._groundProgram.apply();var h=[0,0,0];mat4.multiplyVec3(n.viewMatrix,h),s.uniform3f(this._groundProgram.uniforms.earthCenter,h[0],h[1],h[2]),vec3.normalize(this.lightDir),e=this.lightDir[0],i=this.lightDir[1],r=this.lightDir[2];var u=n.viewMatrix,c=[];c[0]=u[0]*e+u[4]*i+u[8]*r,c[1]=u[1]*e+u[5]*i+u[9]*r,c[2]=u[2]*e+u[6]*i+u[10]*r,s.uniform3f(this._groundProgram.uniforms.lightDir,c[0],c[1],c[2]),s.uniform3f(this._groundProgram.uniforms.v3CameraPos,a[0],a[1],a[2]),s.uniform1f(this._groundProgram.uniforms.fCameraHeight2,l*l),s.uniform1f(this._groundProgram.uniforms.fCameraHeight,l),t.program=this._groundProgram}},n.prototype.render=function(){if(this._isValid&&this.isVisible()&&this.globe){var t=this.globe.renderContext,e=t.gl;e.enable(e.CULL_FACE),this._skyProgram.apply(),e.uniformMatrix4fv(this._skyProgram.uniforms.projectionMatrix,!1,t.projectionMatrix),e.uniformMatrix4fv(this._skyProgram.uniforms.viewMatrix,!1,t.viewMatrix),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.vertexAttribPointer(this._skyProgram.attributes.vertex,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.drawElements(e.TRIANGLES,this._numIndices,e.UNSIGNED_SHORT,0),e.disable(e.CULL_FACE)}},n}),r("Tiling/MercatorTiling",["./Tile","../Renderer/GeoBound","./GeoTiling"],function(t,e,i){var r=function(t){return 20037508.34*t/180},n=function(t){var e=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return 20037508.34*e/180},s=function(t,e){return t/Math.pow(2,e)*360-180},o=function(t,e){var i=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))},a=function(i,a,l){t.prototype.constructor.call(this),this.level=i,this.x=a,this.y=l,this.geoBound=new e(s(a,i),o(l+1,i),s(a+1,i),o(l,i)),this.bound=new e(r(this.geoBound.west),n(this.geoBound.south),r(this.geoBound.east),n(this.geoBound.north))};a.prototype=new t,a.prototype.getElevation=function(t,e){return 0},a.prototype.createChildren=function(){var t=new a(this.level+1,2*this.x,2*this.y),e=new a(this.level+1,2*this.x+1,2*this.y),i=new a(this.level+1,2*this.x,2*this.y+1),r=new a(this.level+1,2*this.x+1,2*this.y+1);t.initFromParent(this,0,0),e.initFromParent(this,1,0),i.initFromParent(this,0,1),r.initFromParent(this,1,1),this.children=[t,e,i,r]},a.prototype.lonlat2tile=function(t){for(var e=Math.pow(2,this.level),i=this.config.tesselation-1,r=[],n=0;n<t.length;n++){var s=(t[n][0]+180)/360,o=Math.sin(t[n][1]*Math.PI/180),a=.5-Math.log((1+o)/(1-o))/(4*Math.PI);r.push([i*(s*e-this.x),i*(a*e-this.y)])}return r},a.prototype.generateVertices=function(t){this.matrix=this.config.coordinateSystem.getLHVTransform(this.geoBound.getCenter());var e=mat4.create();mat4.inverse(this.matrix,e),this.inverseMatrix=e;for(var i=this.config.tesselation,r=new Float32Array(3*i*(i+6)),n=1/(i-1),s=(this.config.coordinateSystem.geoide.radius,this.config.coordinateSystem.geoide.heightScale),o=0,a=Math.pow(2,this.level),l=[0,0,0],h=this.y,u=0;u<i;u++){var c=Math.PI*(1-2*h/a),d=Math.atan(.5*(Math.exp(c)-Math.exp(-c)));d=180*d/Math.PI;for(var p=(Math.cos(d),Math.sin(d),this.x),f=0;f<i;f++){var g=180*(2*p/a-1),m=t?s*t[o]:0;this.config.coordinateSystem.fromGeoTo3D([g,d,m],l);var v=l[0],y=l[1],b=l[2],x=3*o;r[x]=e[0]*v+e[4]*y+e[8]*b+e[12],r[x+1]=e[1]*v+e[5]*y+e[9]*b+e[13],r[x+2]=e[2]*v+e[6]*y+e[10]*b+e[14],o++,p+=n}h+=n}return r},a.prototype.buildSkirtVertices=function(e,i,r,n){var s=this.config.tesselation,o=this.config.vertexSize,a=Math.pow(2,this.level),l=0===this.y&&n===o*(s*s),h=this.y===a-1&&n===o*((s+1)*s);if(l||h){var u=this.vertices,c=this.config.coordinateSystem.fromGeoTo3D(l?[0,90,0]:[0,-90,0]);mat4.multiplyVec3(this.inverseMatrix,c);for(var d=0;d<s;d++){u[n]=c[0],u[n+1]=c[1],u[n+2]=c[2];for(var p=3;p<o;p++)u[n+p]=u[i+p];n+=o}}else t.prototype.buildSkirtVertices.call(this,e,i,r,n)};var l=function(t){this.startLevel=t,this.level0NumTilesX=Math.pow(2,this.startLevel)};return l.prototype=new i,l.prototype.generateLevelZeroTiles=function(t){t.skirt=!t.coordinateSystem.isFlat(),t.cullSign=1,t.srs="EPSG:3857",t.project=function(t){return[r(t[0]),n(t[1])]};for(var e=[],i=Math.pow(2,this.startLevel),s=Math.pow(2,this.startLevel),o=0;o<s;o++)for(var l=0;l<i;l++){var h=new a(this.startLevel,l,o);h.config=t,e.push(h)}return e},l.prototype._lon2LevelZeroIndex=function(t){var e=(t+180)/360;return Math.min(this.level0NumTilesX-1,Math.floor(e*this.level0NumTilesX))},l.prototype._lat2LevelZeroIndex=function(t){var e=Math.sin(t*Math.PI/180),i=.5-Math.log((1+e)/(1-e))/(4*Math.PI);return Math.min(this.level0NumTilesX-1,Math.floor(i*this.level0NumTilesX))},l}),r("Layer/BingLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/MercatorTiling"],function(t,e,i,r){var n=function(){function t(t,e,i){return Math.min(Math.max(t,e),i)}function e(t){return 256<<t}function i(i,r,l){i=t(i,n,s),r=t(r,o,a);var h=(r+180)/360,u=Math.sin(i*Math.PI/180),c=.5-Math.log((1+u)/(1-u))/(4*Math.PI),d=e(l),p=t(h*d+.5,0,d-1),f=t(c*d+.5,0,d-1);return[Math.floor(p),Math.floor(f)]}function r(t,e,i){for(var r="",n=i;n>0;n--){var s="0",o=1<<n-1;0!==(t&o)&&s++,0!==(e&o)&&(s++,s++),r+=s}return r}var n=-85.05112878,s=85.05112878,o=-180,a=180;return{tileXYToQuadKey:r,latLongToPixelXY:i}}(),s=function(t){e.prototype.constructor.call(this,i.LAYER.Bing,t),this.tilePixelSize=256,this.tiling=new r(t.baseLevel||2),this.numberOfLevels=18,this.baseUrl="",this.baseUrlSubDomains=[],this._ready=!1;var n=this;window._bingTileProviderCallback=function(e){n.baseUrl=e.resourceSets[0].resources[0].imageUrl,n.baseUrlSubDomains=e.resourceSets[0].resources[0].imageUrlSubdomains,n._ready=!0,t.onready&&t.onready instanceof Function&&t.onready(n),n.globe&&n.globe.renderContext.requestFrame()};var s=document.createElement("script");s.type="text/javascript",s.src="http://dev.virtualearth.net/REST/V1/Imagery/Metadata/"+t.imageSet+"?jsonp=_bingTileProviderCallback&key="+t.key,s.id="_bingTileProviderCallback",document.getElementsByTagName("head")[0].appendChild(s)};return t.inherits(e,s),s.prototype.getUrl=function(t){var e=this.baseUrl.replace("{quadkey}",n.tileXYToQuadKey(t.x,t.y,t.level));return e.replace("{subdomain}",this.baseUrlSubDomains[Math.floor(Math.random()*this.baseUrlSubDomains.length)])},s}),r("Renderer/GroundOverlayRenderer",["./Program","../Tiling/Tile"],function(t,e){var i=function(e){this.renderContext=e.renderContext,this.tileManager=e;var i="attribute vec3 vertex;\n";i+="attribute vec2 tcoord;\n",i+="uniform mat4 modelViewMatrix;\n",i+="uniform mat4 projectionMatrix;\n",i+="uniform vec4 extent; \n",i+="varying vec2 texCoord;\n",i+="void main(void) \n",i+="{\n",i+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",i+="\ttexCoord.x = tcoord.x * (extent[1] - extent[0]) + extent[0];\n",i+="\ttexCoord.y = tcoord.y * (extent[3] - extent[2]) + extent[2];\n",i+="}\n";var r="#ifdef GL_ES\n";r+="precision highp float;\n",r+="#endif\n",r+="\n",r+="varying vec2 texCoord;\n",r+="uniform sampler2D overlayTexture;\n",r+="uniform mat3 transform;\n",r+="uniform float opacity; \n",r+="\n",r+="void main(void)\n",r+="{\n",r+="\tvec3 tc = transform * vec3(texCoord,1.0); \n",r+="\ttc.xy /= tc.z; \n",r+="\tgl_FragColor.rgba = texture2D(overlayTexture, tc.xy); \n",r+="\tgl_FragColor.a = (tc.x >= 0.0 && tc.x <= 1.0 && tc.y >= 0.0 && tc.y <= 1.0) ? opacity * gl_FragColor.a  : 0.0; \n",r+="}\n",this.program=new t(this.renderContext),this.program.createFromSource(i,r),this.groundOverlays=[]};return i.prototype.render=function(t){var i=this.renderContext.gl;this.program.apply();var r=this.program.attributes;i.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,this.renderContext.projectionMatrix),i.uniform1i(this.program.uniforms.overlayTexture,0),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.depthFunc(i.LEQUAL),i.depthMask(!1);for(var n=mat4.create(),s=null,o=0;o<this.groundOverlays.length;o++){var a=this.groundOverlays[o];if(a.image.complete){a.texture||(a.texture=this.renderContext.createNonPowerOfTwoTextureFromImage(a.image,a.flipY));for(var l=!1,h=0;h<t.length;h++){var u=t[h];if(a.geoBound.intersects(u.geoBound)){l||(i.uniformMatrix3fv(this.program.uniforms.transform,!1,a.inverseTransform),i.uniform1f(this.program.uniforms.opacity,a.opacity),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.texture),i.bindBuffer(i.ARRAY_BUFFER,this.tileManager.tcoordBuffer),i.vertexAttribPointer(r.tcoord,2,i.FLOAT,!1,0,0),l=!0);var c=u.state===e.State.LOADED?u.bound:u.parent.bound;i.uniform4f(this.program.uniforms.extent,c.west,c.east,c.north,c.south),mat4.multiply(this.renderContext.viewMatrix,u.matrix,n),i.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,n),i.bindBuffer(i.ARRAY_BUFFER,u.vertexBuffer),i.vertexAttribPointer(r.vertex,3,i.FLOAT,!1,0,0);var d=u.state===e.State.LOADED?this.tileManager.tileIndexBuffer.getSolid():this.tileManager.tileIndexBuffer.getSubSolid(u.parentIndex);s!==d&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,d),s=d),i.drawElements(i.TRIANGLES,d.numIndices,i.UNSIGNED_SHORT,0)}}}}i.disable(i.BLEND),i.depthMask(!0)},i}),r("Layer/GroundOverlayLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/GeoBound","../Renderer/GroundOverlayRenderer"],function(t,e,i,r,n){var s=function(t){e.prototype.constructor.call(this,i.LAYER.GroundOverlay,t),this.quad=t.quad,"undefined"==typeof t.flipY?this.flipY=!0:this.flipY=t.flipY,this.geoBound=new r,this.geoBound.computeFromCoordinates(this.quad),"string"==typeof t.image?(this.image=new Image,this.image.crossOrigin="",this.image.src=t.image):t.image instanceof HTMLImageElement&&(this.image=t.image),this.globe=null};return t.inherits(e,s),s.prototype._attach=function(t){var e=t.groundOverlayRenderer;e||(e=new n(t.tileManager),t.tileManager.addPostRenderer(e),t.groundOverlayRenderer=e),e.groundOverlays.push(this),this.globe=t,this.computeTransform()},s.prototype._detach=function(t){var e=this.globe.groundOverlayRenderer;if(e){var i=e.groundOverlays.indexOf(this);i!==-1&&(e.groundOverlays.splice(i,1),0===e.groundOverlays.length&&(this.globe.tileManager.removePostRenderer(e),this.globe.groundOverlayRenderer=null))}},s.prototype.computeInverse=function(){var t,e,i,r,n,s,o,a,l,h=this.transform[0]*(this.transform[8]*this.transform[4]-this.transform[5]*this.transform[7])-this.transform[3]*(this.transform[8]*this.transform[1]-this.transform[7])*this.transform[3]+this.transform[6]*(this.transform[5]*this.transform[1]-this.transform[4]*this.transform[2]);t=this.transform[4]*this.transform[8]-this.transform[5]*this.transform[7],r=this.transform[5]*this.transform[6]-this.transform[3]*this.transform[8],o=this.transform[3]*this.transform[7]-this.transform[4]*this.transform[6],e=this.transform[2]*this.transform[7]-this.transform[1]*this.transform[8],n=this.transform[0]*this.transform[8]-this.transform[2]*this.transform[6],a=this.transform[1]*this.transform[6]-this.transform[0]*this.transform[7],i=this.transform[1]*this.transform[5]-this.transform[2]*this.transform[4],s=this.transform[2]*this.transform[3]-this.transform[0]*this.transform[5],l=this.transform[0]*this.transform[4]-this.transform[1]*this.transform[3],this.inverseTransform=[t/h,e/h,i/h,r/h,n/h,s/h,o/h,a/h,l/h]},s.prototype.computeTransform=function(){var t=this.quad[0],e=this.quad[1],i=this.quad[2],r=this.quad[3],n=this.globe.tileManager.tileConfig;"EPSG:4326"!==n.srs&&(t=n.project(t),e=n.project(e),i=n.project(i),r=n.project(r));var s=t[0],o=e[0],a=i[0],l=r[0],h=t[1],u=e[1],c=i[1],d=r[1],p=s-o+a-l,f=h-u+c-d;if(p||f){var g,m,v,y,b,x,_,w,C=o-a,T=l-a,A=u-c,I=d-c,S=p*I-T*f,M=C*f-p*A,k=C*I-T*A;if(!k)return;_=S/k,w=M/k,g=o-s+_*o,m=l-s+w*l,v=s,y=u-h+_*u,b=d-h+w*d,x=h,this.transform=[g,y,_,m,b,w,v,x,1]}else this.transform=[o-s,u-h,0,a-o,c-u,0,s,h,1];this.computeInverse()},s}),r("Layer/OSMLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/MercatorTiling"],function(t,e,i,r){var n=function(t){t.tilePixelSize=t.tilePixelSize||256,t.tiling=new r(t.baseLevel||2),t.numberOfLevels=t.numberOfLevels||21,e.prototype.constructor.call(this,i.LAYER.OSM,t)};return t.inherits(e,n),n.prototype.getUrl=function(t){return this.baseUrl+"/"+t.level+"/"+t.x+"/"+t.y+".png"},n}),r("Layer/TileWireframeLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/Program","../Tiling/Tile"],function(t,e,i,r,n){var s=function(t){e.prototype.constructor.call(this,i.LAYER.TileWireframe,t),this.outline=!(!t||!t.outline)&&t.outline,this.globe=null,this.program=null,this.indexBuffer=null,this.subIndexBuffer=[null,null,null,null],this.zIndex=-1};return t.inherits(e,s),s.prototype.buildIndexBuffer=function(){var t,e,i,r,n,s,o=this.globe.renderContext.gl,a=this.globe.tileManager.tileConfig.tesselation,l=[],h=this.outline?a-1:1;for(e=0;e<a;e+=h)for(t=0;t<a-1;t++)l.push(e*a+t),l.push(e*a+t+1);for(e=0;e<a;e+=h)for(t=0;t<a-1;t++)l.push(t*a+e),l.push((t+1)*a+e);s=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),o.STATIC_DRAW),s.numIndices=l.length,this.indexBuffer=s;var u=(a-1)/2;for(h=this.outline?u:1,i=0;i<4;i++){for(t=i%2,e=Math.floor(i/2),l=[],r=u*e;r<u*(e+1)+1;r+=h)for(n=u*t;n<u*(t+1);n++)l.push(r*a+n),l.push(r*a+n+1);for(r=u*t;r<u*(t+1)+1;r+=h)for(n=u*e;n<u*(e+1);n++)l.push(n*a+r),l.push((n+1)*a+r);s=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),o.STATIC_DRAW),s.numIndices=l.length,this.subIndexBuffer[i]=s}},s.prototype._attach=function(t){if(e.prototype._attach.call(this,t),this.isVisible()&&this.globe.tileManager.addPostRenderer(this),!this.program){var i="attribute vec3 vertex;\n";i+="uniform mat4 modelViewMatrix;\n",i+="uniform mat4 projectionMatrix;\n",i+="void main(void) \n",i+="{\n",i+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",i+="}\n";var n="precision highp float; \n";n+="uniform vec3 color; \n",n+="uniform float alpha; \n",n+="void main(void)\n",n+="{\n",n+="\tgl_FragColor = vec4(color,alpha);\n",n+="}\n",this.program=new r(this.globe.renderContext),this.program.createFromSource(i,n),this.buildIndexBuffer()}},s.prototype._detach=function(){this.globe.tileManager.removePostRenderer(this),e.prototype._detach.call(this)},s.prototype.render=function(t){var e=this.globe.renderContext,i=e.gl;i.enable(i.BLEND),this.program.apply(),i.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,e.projectionMatrix);for(var r=this.program.attributes.vertex,s=null,o=0;o<t.length;o++){var a=t[o],l=a.state===n.State.LOADED,h=a.parentIndex===-1;mat4.multiply(e.viewMatrix,a.matrix,e.modelViewMatrix),i.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,e.modelViewMatrix),i.uniform3f(this.program.uniforms.color,this.color[0],this.color[1],this.color[2]),i.uniform1f(this.program.uniforms.alpha,this.getOpacity()),i.bindBuffer(i.ARRAY_BUFFER,a.vertexBuffer),i.vertexAttribPointer(r,3,i.FLOAT,!1,4*a.config.vertexSize,0);var u=l||h?this.indexBuffer:this.subIndexBuffer[a.parentIndex];s!==u&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,u),s=u);var c=s.numIndices;i.drawElements(i.LINES,c,i.UNSIGNED_SHORT,0)}i.disable(i.BLEND)},s.prototype.setVisible=function(t){return e.prototype.setVisible.call(this,t),"boolean"==typeof t&&(this.isVisible()?this.globe.tileManager.addPostRenderer(this):this.globe.tileManager.removePostRenderer(this)),this.isVisible()},s}),r("Renderer/Ray",["./glMatrix"],function(){var t=function(t,e){this.orig=t,this.dir=e};t.createFromPixel=function(e,i,r){var n=i/e.canvas.width*2-1,s=-(r/e.canvas.height*2-1),o=mat4.create();mat4.multiply(e.projectionMatrix,e.viewMatrix,o),mat4.inverse(o);var a=mat4.multiplyVec4(o,[n,s,-1,1]);a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];var l=mat4.create();mat4.inverse(e.viewMatrix,l),vec3.set([0,0,0],e.eyePosition),mat4.multiplyVec3(l,e.eyePosition);var h=vec3.create(e.eyePosition),u=vec3.subtract(a,e.eyePosition,vec3.create());return vec3.normalize(u),new t(h,u)},t.createFromEvent=function(e,i){var r=e.getXYRelativeToCanvas(i);return t.createFromPixel(r[0],r[1])},t.Intersection=function(t){this.t=t,this.geometry=null},t.prototype.computePoint=function(t){var e=vec3.create();return vec3.scale(this.dir,t,e),vec3.add(e,this.orig),e},t.prototype.planeIntersect=function(t,e){var i=vec3.dot(e,this.dir),r=1e-6;if(Math.abs(i)>r){var n=vec3.create();vec3.subtract(t,this.orig,n);var s=vec3.dot(n,e)/i;return s}return-1},t.prototype.sphereIntersect=function(t,e){
var i=vec3.subtract(this.orig,t,vec3.create()),r=2*vec3.dot(this.dir,i),n=vec3.dot(i,i)-e*e,s=r*r-4*n;if(s<0)return-1;s=Math.sqrt(s);var o=(-r-s)/2,a=(-r+s)/2;if(o>a){var l=o;o=a,a=l}return a<0?-1:o<0?a:o};var e=1e-6;return t.prototype.triangleIntersectOptimized=function(i,r,n,s){var o=i[n]-i[r],a=i[n+1]-i[r+1],l=i[n+2]-i[r+2],h=i[s]-i[r],u=i[s+1]-i[r+1],c=i[s+2]-i[r+2],d=this.dir[1]*c-this.dir[2]*u,p=this.dir[2]*h-this.dir[0]*c,f=this.dir[0]*u-this.dir[1]*h,g=o*d+a*p+l*f;if(g>-e&&g<e)return null;var m=1/g,v=this.orig[0]-i[r],y=this.orig[1]-i[r+1],b=this.orig[2]-i[r+2],x=(v*d+y*p+b*f)*m;if(x<0||x>1)return null;var _=y*l-b*a,w=b*o-v*l,C=v*a-y*o,T=(this.dir[0]*_+this.dir[1]*w+this.dir[2]*C)*m;if(T<0||x+T>1)return null;var A=(h*_+u*w+c*C)*m;return A>=0?new t.Intersection(A):null},t.prototype.nodeIntersect=function(t,e){var i;for(e=e||[],i=0;i<t.children.length;i++)t.children[i].intersectWith(this,e);for(i=0;i<t.geometries.length;i++)this.geometryIntersect(t.geometries[i],e);return e.sort(function(t,e){return t.t-e.t}),e},t.prototype.lodNodeIntersect=function(t,e){var i;if(e=e||[],this.sphereIntersect(t.center,t.radius)>=0)if(t.children.length>0&&0===t.childToLoad)for(i=0;i<t.children.length;i++)this.lodNodeIntersect(t.children[i],e);else for(i=0;i<t.geometries.length;i++)this.geometryIntersect(t.geometries[i],e);return e},t.prototype.geometryIntersect=function(t,e){for(var i=t.mesh.indices,r=0;r<i.length;r+=3){var n=this.triangleIntersectOptimized(t.mesh.vertices,t.mesh.numElements*i[r],t.mesh.numElements*i[r+1],t.mesh.numElements*i[r+2]);n&&(n.geometry=t,e.push(n))}},t}),r("Tiling/Mesh",[],function(){var t=function(t){this.renderContext=t,this.vertexBuffer=null,this.tcoordBuffer=null,this.indexBuffer=null,this.colorBuffer=null,this.numVertices=0,this.mode=t.gl.TRIANGLES};return t.prototype.setVertices=function(t){var e=this.renderContext.gl;null===this.vertexBuffer&&(this.vertexBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),this.numVertices=t.length},t.prototype.setTexCoords=function(t){var e=this.renderContext.gl;null===this.tcoordBuffer&&(this.tcoordBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.tcoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW)},t.prototype.setColors=function(t){var e=this.renderContext.gl;null===this.colorBuffer&&(this.colorBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW)},t.prototype.setIndices=function(t){var e=this.renderContext.gl;null===this.indexBuffer&&(this.indexBuffer=e.createBuffer()),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),e.STATIC_DRAW),this.numIndices=t.length},t.prototype.setIndicesToWireframe=function(t){this.mode=this.renderContext.gl.LINES;var e=[];e.length=2*t.length;for(var i=0;i<t.length;i+=3)e[2*i]=t[i],e[2*i+1]=t[i+1],e[2*i+2]=t[i+1],e[2*i+3]=t[i+2],e[2*i+4]=t[i+2],e[2*i+5]=t[i];this.setIndices(e)},t.prototype.render=function(t){var e=this.renderContext.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.vertexAttribPointer(t.vertex,3,e.FLOAT,!1,0,0),t.hasOwnProperty("tcoord")&&(e.bindBuffer(e.ARRAY_BUFFER,this.tcoordBuffer),e.vertexAttribPointer(t.tcoord,2,e.FLOAT,!1,0,0)),t.hasOwnProperty("color")&&(e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.vertexAttribPointer(t.color,4,e.FLOAT,!1,0,0)),this.indexBuffer?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(this.mode,this.numIndices,e.UNSIGNED_SHORT,0)):e.drawArrays(this.mode,0,this.numVertices/3)},t.prototype.dispose=function(){var t=this.renderContext.gl;this.indexBuffer&&t.deleteBuffer(this.indexBuffer),this.vertexBuffer&&t.deleteBuffer(this.vertexBuffer),this.tcoordBuffer&&t.deleteBuffer(this.tcoordBuffer),this.colorBuffer&&t.deleteBuffer(this.colorBuffer),this.indexBuffer=null,this.vertexBuffer=null,this.tcoordBuffer=null,this.colorBuffer=null},t}),r("Crs/AstroCoordTransform",[],function(){var t=2*Math.PI,e=4*Math.PI,i=180/Math.PI,r=[[.57595865315,4.9261918136,0,0,.11129056012,4.7005372834],[.574770433,4.9368292465,0,0,.11142137093,4.71279419371]],n=[[.88781538514,-.88781538514,.39788119938,-.39788119938,.86766174755,-.86766174755],[.88998808748,-.88998808748,.39777715593,-.39777715593,.86766622025,-.86766622025]],s=[[.46019978478,.46019978478,.9174369467,.9174369467,.49715499774,.49715499774],[.45598377618,.45598377618,.91748206207,.91748206207,.49714719172,.49714719172]],o=[[4.9261918136,.57595865315,0,0,4.7005372834,.11129056012],[4.9368292465,.574770433,0,0,4.71279419371,.11142137093]],a={transform:function(i,a){var l,h,u,c,d,p,f,g=1;return u=i[0]-o[g][a],c=i[1],d=Math.sin(c),p=Math.cos(c),f=p*Math.sin(u),c=-n[g][a]*f+s[g][a]*d,c=Math.max(-1,Math.min(c,1)),h=Math.asin(c),u=Math.atan2(s[g][a]*f+n[g][a]*d,p*Math.cos(u)),l=(u+r[g][a]+e)%t,[l,h]},transformInDeg:function(a,l){var h,u,c,d,p,f,g,m=1;return c=a[0]/i-o[m][l],d=a[1]/i,p=Math.sin(d),f=Math.cos(d),g=f*Math.sin(c),d=-n[m][l]*g+s[m][l]*p,d=Math.max(-1,Math.min(d,1)),u=Math.asin(d)*i,c=Math.atan2(s[m][l]*g+n[m][l]*p,f*Math.cos(c)),h=(c+r[m][l]+e)%t*i,[h,u]}};return a.Type={EQ2GAL:0,GAL2EQ:1,EQ2ECL:2,ECL2EQ:3,ECL2GAL:4,GAL2ECL:5},a}),r("Crs/Geoide",[],function(){var t=function(t){if(this.radius=t&&t.hasOwnProperty("radius")?t.radius:null,this.realPlanetRadius=t&&t.hasOwnProperty("realPlanetRadius")?t.realPlanetRadius:null,null===this.radius||null===this.realPlanetRadius)throw new ReferenceError("Radius and realPlanetRadius must be set to define a geoide","Geoide.js");this.heightScale=1/this.realPlanetRadius};return t.prototype.getRealPlanetRadius=function(){return this.realPlanetRadius},t.prototype.getRadius=function(){return this.radius},t.prototype.getHeightScale=function(){return this.heightScale},t}),r("Crs/AbstractCrs",["../Utils/Numeric","./Geoide","../Utils/Constants","./AstroCoordTransform","../Renderer/glMatrix"],function(t,e,i,r){var n=function(t){if(this.flat=!1,this.geoide=null,this.type=null,this.geoBound=null,!(t&&t.geoideName&&t.type&&t.geoBound))throw new ReferenceError("The geoide's parameters, the geoBound and the type of context must be defined",n.js);this.geoide=new e(t),this.geoideName=t.geoideName,this.type=t.type,this.geoBound=t.geoBound};return n.prototype.isFlat=function(){return this.flat},n.prototype.getVerticalAt3D=function(t,e){return e||(e=new Array(3)),this.isFlat()?(e[0]=0,e[1]=0,e[2]=1):vec3.normalize(t,e),e},n.prototype.fromGeoTo3D=function(e,i){if(i||(i=new Array(3)),!e||e.length<2)return console.log("Erreur !"),i[0]=0,i[1]=0,i[2]=0,i;var r=t.toRadian(e[0]),n=t.toRadian(e[1]),s=Math.cos(n),o=e.length>2?this.geoide.getHeightScale()*e[2]:0,a=this.geoide.getRadius()+o;return i[0]=a*Math.cos(r)*s,i[1]=a*Math.sin(r)*s,i[2]=a*Math.sin(n),i},n.prototype.from3DToGeo=function(e,i){i||(i=new Array(3));var r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=Math.atan2(e[1]/r,e[0]/r),s=Math.asin(e[2]/r);return i[0]=t.toDegree(n),i[1]=t.toDegree(s),i[2]=this.geoide.getRealPlanetRadius()*(r-this.geoide.getRadius()),i},n.prototype.getLocalTransform=function(t,e){e||(e=mat4.create());var i=t[0]*Math.PI/180,r=t[1]*Math.PI/180,n=[Math.cos(i)*Math.cos(r),Math.sin(i)*Math.cos(r),Math.sin(r)],s=[-Math.sin(i),Math.cos(i),0],o=vec3.create();return vec3.cross(n,s,o),e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=0,e[4]=o[0],e[5]=o[1],e[6]=o[2],e[7]=0,e[8]=n[0],e[9]=n[1],e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.prototype.getLHVTransform=function(t,e){e||(e=mat4.create());var i=t[0]*Math.PI/180,r=t[1]*Math.PI/180,n=[Math.cos(i)*Math.cos(r),Math.sin(i)*Math.cos(r),Math.sin(r)],s=[-Math.sin(i),Math.cos(i),0],o=vec3.create();vec3.cross(n,s,o);var a=this.get3DFromWorld(t);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=0,e[4]=o[0],e[5]=o[1],e[6]=o[2],e[7]=0,e[8]=n[0],e[9]=n[1],e[10]=n[2],e[11]=0,e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=1,e},n.prototype.getSideVector=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.prototype.getFrontVector=function(t,e){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e},n.prototype.getUpVector=function(t,e){return e[0]=t[8],e[1]=t[9],e[2]=t[10],e},n.prototype.formatCoordinates=function(t){throw"Not implemented"},n.prototype.getGeoide=function(){return this.geoide},n.prototype.getGeoideName=function(){return this.geoideName},n.prototype.getType=function(){return this.type},n.prototype.getElevation=function(t,e){return t.getElevation(e.coordinates[0],e.coordinates[1])},n.prototype.getWorldFrom3D=function(t,e){e||(e=new Array(3));var i=this.from3DToGeo(t);return this._setupPosAfterTrans(i),e[0]=i[0],e[1]=i[1],e[2]=i.length>2?i[2]:this.geoide.getRealPlanetRadius(),e},n.prototype.get3DFromWorld=function(t,e){e||(e=vec3.create());var i=t.slice(0);return this._setupPosBeforeTrans(i),this.fromGeoTo3D(i,e),e},n.prototype.get3DFromWorldInCrs=function(t,e,i){i||(i=vec3.create());var r=this.convert(t,e,this.getGeoideName());return this.get3DFromWorld(r,i),i},n.prototype.getSexagesimalFromDeg=function(t,e){e=e||[];var i=t[0];return i<0&&(i+=360),e[0]=this.fromDegreesToHMS(i),e[1]=this.fromDegreesToDMS(t[1]),e},n.prototype.getDecimalDegFromSexagesimal=function(t,e){function i(t){return"-"===t[0]?-1:1}e=e||[];var r=t[0].split(" "),n=parseFloat(r[0]),s=parseFloat(r[1]),o=parseFloat(r[2]);e[0]=15*(n+s/60+o/3600);var a=t[1].split(" ");return n=parseFloat(a[0]),s=parseFloat(a[1]),o=parseFloat(a[2]),e[1]=i(a[0])*(Math.abs(n)+s/60+o/3600),e},n.prototype.convert=function(t,e,n){if(e===n)return t;var s=null,o=null;switch(e+"2"+n){case i.CRS.Galactic+"2"+i.CRS.Equatorial:o=r.Type.GAL2EQ,s=r.transformInDeg(t,o);break;case i.CRS.Equatorial+"2"+i.CRS.Galactic:o=r.Type.EQ2GAL,s=r.transformInDeg(t,o),s[0]<0&&(console.warn("EQ2GAL transformation returned negative value"),s[0]+=360);break;case i.CRS.Mars_2000+"2"+i.CRS.Mars_2000_old:case i.CRS.Mars_2000_old+"2"+i.CRS.Mars_2000:s=t;break;default:throw"Conversion "+e+" to "+n+" is not implemented"}return s},n.prototype.fromDegreesToHMS=function(e){var i=e/15,r=Math.abs(i),n=Math.floor(r),s=60*(r-n),o=Math.floor(s),a=60*(s-o);return n+"h "+o+"m "+t.roundNumber(a,2)+"s"},n.prototype.fromDegreesToDMS=function(e){function i(t){return t>=0?"+":"-"}var r=Math.abs(e),n=Math.floor(r),s=60*(r-n),o=Math.floor(s),a=60*(s-o);return i(e)+n+String.fromCharCode(176)+" "+o+"' "+t.roundNumber(a,2)+'"'},n.prototype._setupPosBeforeTrans=function(t){throw"Not implemented"},n.prototype._setupPosAfterTrans=function(t){throw"Not implemented"},n.prototype.getGeoBound=function(){return this.geoBound},n}),r("Crs/WGS84Crs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(t,e,i,r,n){var s=function(i){t.prototype.constructor.call(this,{geoideName:r.CRS.WGS84,radius:1,realPlanetRadius:6378137,type:r.CONTEXT.Planet,geoBound:new e(-180,-90,180,90)})};return i.inherits(t,s),s.prototype.formatCoordinates=function(t){var e=[];return e[0]=n.roundNumber(t[0],3),e[0]+="&deg;",e[1]=n.roundNumber(t[1],3),e[1]+="&deg;",e},s.prototype._setupPosAfterTrans=function(t){},s.prototype._setupPosBeforeTrans=function(t){},s}),r("Crs/Mars2000Crs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(t,e,i,r,n){var s=function(i){t.prototype.constructor.call(this,{geoideName:r.CRS.Mars_2000,radius:1,realPlanetRadius:3396190,type:r.CONTEXT.Planet,geoBound:new e(-180,-90,180,90)})};return i.inherits(t,s),s.prototype.formatCoordinates=function(t){var e=[],i=n.roundNumber(t[0],3),r=n.roundNumber(t[1],3);return e[0]=r>=0?r+" N":-1*r+" S",e[1]=i>=0?i+" E":-1*i+" W",e},s.prototype._setupPosAfterTrans=function(t){},s.prototype._setupPosBeforeTrans=function(t){},s}),r("Crs/EquatorialCrs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(t,e,i,r){var n=function(i){t.prototype.constructor.call(this,{geoideName:r.CRS.Equatorial,radius:10,realPlanetRadius:1,type:r.CONTEXT.Sky,geoBound:new e(0,-90,360,90)})};return i.inherits(t,n),n.prototype.transformVec=function(t){var e=this.computeTransformMatrix(),i=[];return mat4.multiplyVec3(e,t,i),i},n.prototype.computeTransformMatrix=function(){var t=[],e=this.convert([0,90],r.CRS.Galactic,r.CRS.Equatorial),i=this.fromGeoTo3D(e),n=this.convert([0,0],r.CRS.Galactic,r.CRS.Equatorial),s=this.fromGeoTo3D(n),o=this.convert([90,0],r.CRS.Galactic,r.CRS.Equatorial),a=this.fromGeoTo3D(o);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=0,t[4]=a[0],t[5]=a[1],t[6]=a[2],t[7]=0,t[8]=i[0],t[9]=i[1],t[10]=i[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.prototype.formatCoordinates=function(t){return this.getSexagesimalFromDeg(t)},n.prototype._setupPosAfterTrans=function(t){t[0]<0&&(t[0]+=360)},n.prototype._setupPosBeforeTrans=function(t){t[0]>180&&(t[0]-=360)},n}),r("Crs/GalacticCrs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(t,e,i,r,n){var s=function(i){t.prototype.constructor.call(this,{geoideName:r.CRS.Galactic,radius:10,realPlanetRadius:1,type:r.CONTEXT.Sky,geoBound:new e(0,-90,360,90)})};return i.inherits(t,s),s.prototype.formatCoordinates=function(t){var e=[];return e[0]=n.roundNumber(t[0],3),e[0]+="&deg;",e[1]=n.roundNumber(t[1],3),e[1]+="&deg;",e},s.prototype._setupPosAfterTrans=function(t){t[0]<0&&(t[0]+=360),[t[0],t[1]]=this.convert(t,r.CRS.Equatorial,r.CRS.Galactic)},s.prototype._setupPosBeforeTrans=function(t){[t[0],t[1]]=this.convert(t,r.CRS.Galactic,r.CRS.Equatorial),t[0]>180&&(t[0]-=360)},s}),r("Projection/AbstractProjection",["../Renderer/GeoBound"],function(t){var e=function(e,i,r){this.geoBound=new t(i[0],i[1],i[2],i[3]),this.projectionCenter=e,this.options=r||{}};return e.prototype.getProjectionCenter=function(){return this.projectionCenter},e.prototype.getGeoBound=function(){return this.geoBound},e.prototype.unProject=function(t,e){throw"Not implemented"},e.prototype.project=function(t,e){throw"Not implemented"},e}),r("Projection/AitoffProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){t.prototype.constructor.call(this,[0,0],[-180,-90,180,90],e)};e.inherits(t,i);var r=function(t){return t?t/Math.sin(t):1};return i.prototype.unProject=function(t,e){e||(e=new Array(3));var i,r,n=.005;if(!(t[0]*t[0]+4*t[1]*t[1]>Math.PI*Math.PI+n)){var s=t[0],o=t[1],a=25;do{var l,h=Math.sin(s),u=Math.sin(s/2),c=Math.cos(s/2),d=Math.sin(o),p=Math.cos(o),f=Math.sin(2*o),g=d*d,m=p*p,v=u*u,y=1-m*c*c,b=y?Math.acos(p*c)*Math.sqrt(l=1/y):l=0,x=2*b*p*u-t[0],_=b*d-t[1],w=l*(m*v+b*p*c*g),C=l*(.5*h*f-2*b*d*u),T=.25*l*(f*u-b*d*m*h),A=l*(g*c+b*v*p),I=C*T-A*w;if(!I)break;i=(_*C-x*A)/I,r=(x*T-_*w)/I,s-=i,o-=r}while((Math.abs(i)>n||Math.abs(r)>n)&&--a>0);return e[0]=180*s/Math.PI,e[1]=180*o/Math.PI,e[2]=t[2],e}},i.prototype.project=function(t,e){e||(e=new Array(3));var i=t[0]*Math.PI/180,n=t[1]*Math.PI/180,s=Math.cos(n),o=r(Math.acos(s*Math.cos(i/=2)));return e[0]=2*s*Math.sin(i)*o,e[1]=Math.sin(n)*o,e[2]=t[2],e},i}),r("Projection/AugustProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){t.prototype.constructor.call(this,[0,0],[-180,-90,180,90],e)};return e.inherits(t,i),i.prototype.unProject=function(t,e){throw"must be implemented"},i.prototype.project=function(t,e){e||(e=new Array(3));var i=t[0]*Math.PI/180,r=t[1]*Math.PI/180,n=Math.tan(r/2),s=Math.sqrt(1-n*n),o=1+s*Math.cos(i/=2),a=Math.sin(i)*s/o,l=n/o,h=a*a,u=l*l;return e[0]=4/3*a*(3+h-3*u),e[1]=4/3*l*(3+3*h-u),e[2]=t[2],e},i}),r("Projection/MercatorProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){t.prototype.constructor.call(this,[0,0],[-180,-80,180,84],e),this.lambda0=e&&e.lambda0?e.lambda0:0};e.inherits(t,i);var r=function(t){var e=Math.exp(t);return(e-1/e)/2};return i.prototype.unProject=function(t,e){return e||(e=new Array(3)),e[0]=this.lambda0+180*t[0]/Math.PI,e[1]=180*Math.atan(r(t[1]))/Math.PI,e[2]=t[2],Math.abs(e[1])>85.05?null:e},i.prototype.project=function(t,e){e||(e=new Array(3)),t[1]>85.05&&(t[1]=85.05),t[1]<-85.05&&(t[1]=-85.05);var i=t[0]*Math.PI/180,r=t[1]*Math.PI/180,n=i-this.lambda0*Math.PI/180,s=Math.log(Math.tan(r)+1/Math.cos(r));return e[0]=n,e[1]=s,e[2]=t[2],e},i}),r("Projection/MollweideProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){function i(t){if(Math.abs(t)===Math.PI/2)return t;var e,i=.001,r=t;do{var n=2*r;r=e,r||(r=t),e=n/2-(n+Math.sin(n)-Math.PI*Math.sin(t))/(2+2*Math.cos(n))}while(Math.abs(e-r)>=i);return e}var r=function(e){t.prototype.constructor.call(this,[0,0],[-180,-90,180,90],e)};return e.inherits(t,r),r.prototype.unProject=function(t,e){e||(e=new Array(3));var i=Math.asin(t[1]/Math.sqrt(2)),r=Math.asin((2*i+Math.sin(2*i))/Math.PI),n=Math.PI*t[0]/(2*Math.sqrt(2)*Math.cos(i));return e[0]=180*n/Math.PI,e[1]=180*r/Math.PI,e[2]=t[2],e},r.prototype.project=function(t,e){e||(e=new Array(3));var r=t[0]*Math.PI/180,n=t[1]*Math.PI/180,s=i(n),o=2*Math.sqrt(2)/Math.PI*r*Math.cos(s),a=Math.sqrt(2)*Math.sin(s);return e[0]=o,e[1]=a,e[2]=t[2],e},r}),r("Projection/PlateProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){t.prototype.constructor.call(this,[0,0],[-180,-90,180,90],e)};return e.inherits(t,i),i.prototype.unProject=function(t,e){return e||(e=new Array(3)),e[0]=180*t[0]/Math.PI,e[1]=180*t[1]/Math.PI,e[2]=t[2],e},i.prototype.project=function(t,e){return e||(e=new Array(3)),e[0]=t[0]*Math.PI/180,e[1]=t[1]*Math.PI/180,e[2]=t[2],e},i}),r("Projection/AzimuthProjection",["./AbstractProjection","../Utils/Utils","../Renderer/glMatrix"],function(t,e){var i=function(e){this.pole=e&&e.pole||"north";var i,r;"south"===this.pole?(i=[-180,-90,180,0],r=[0,-90]):(i=[-180,0,180,90],r=[0,90],this.pole="north"),t.prototype.constructor.call(this,r,i,e)};return e.inherits(t,i),i.prototype.unProject=function(t,e){var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]),r=Math.atan2(t[0],-t[1]);return i=180*i/Math.PI,r=180*r/Math.PI,r*="south"===this.pole?-1:1,i>90?null:(e||(e=new Array(3)),e[0]=r,e[1]="south"===this.pole?i-90:90-i,e[2]=t[2],e)},i.prototype.project=function(t,e){e||(e=new Array(3));var i="south"===this.pole?90+t[1]:90-t[1];i=i*Math.PI/180;var r=t[0]*Math.PI/180;return r*="south"===this.pole?-1:1,e[0]=i*Math.sin(r),e[1]=-i*Math.cos(r),e[2]=t[2],e},i}),r("Projection/ProjectionFactory",["../Utils/Constants","./AitoffProjection","./AugustProjection","./MercatorProjection","./MollweideProjection","./PlateProjection","./AzimuthProjection"],function(t,e,i,r,n,s,o){function a(a,l){var h;switch(a){case t.PROJECTION.Aitoff:h=new e(l);break;case t.PROJECTION.August:h=new i(l);break;case t.PROJECTION.Azimuth:h=new o(l);break;case t.PROJECTION.Mercator:h=new r(l);break;case t.PROJECTION.Mollweide:h=new n(l);break;case t.PROJECTION.Plate:h=new s(h,l);break;default:throw new RangeError("Unable to create the projection "+l.projectionName,"ProjectionFactory.js")}return h}return{create:function(t){var e;if(!t||!t.projectionName)throw new ReferenceError("Unable to get options.projectionName","ProjectionFactory.js");return e=a(t.projectionName,t)}}}),r("Crs/ProjectedCrs",["./AbstractCrs","../Utils/Utils","../Projection/ProjectionFactory","../Renderer/glMatrix"],function(t,e,i){var r=function(e,r){t.prototype.constructor.call(this,{geoideName:e.getGeoideName(),radius:e.getGeoide().getRadius(),realPlanetRadius:e.getGeoide().getRealPlanetRadius(),type:e.getType(),geoBound:e.getGeoBound()}),this.cs=e,this.projection=i.create(r),this.geoBound.setWest(this.projection.getGeoBound().getWest()),this.geoBound.setSouth(this.projection.getGeoBound().getSouth()),this.geoBound.setEast(this.projection.getGeoBound().getEast()),this.geoBound.setNorth(this.projection.getGeoBound().getNorth()),this.flat=!0};return e.inherits(t,r),r.prototype.formatCoordinates=function(t){return this.cs.formatCoordinates(t)},r.prototype.getWorldFrom3D=function(t,e){return e||(e=new Array(3)),this.projection.unProject(t,e),this.cs._setupPosAfterTrans(e),e[2]=e[2]/this.geoide.getHeightScale(),e},r.prototype.get3DFromWorld=function(t,e){e||(e=vec3.create());var i=t.slice(0);return this.cs._setupPosBeforeTrans(i),this.projection.project(i,e),e[2]=e[2]?e[2]*this.geoide.getHeightScale():0,e},r.prototype.getLocalTransform=function(t,e){return e||(e=mat4.create()),mat4.identity(e),e},r.prototype.getLHVTransform=function(t,e){e||(e=mat4.create());var i=this.projection.project(t);return mat4.identity(e),e[12]=i[0],e[13]=i[1],e[14]=i[2]?i[2]*this.geoide.getHeightScale():0,e[15]=1,e},r}),r("Crs/CoordinateSystemFactory",["../Utils/Constants","./WGS84Crs","./Mars2000Crs","./EquatorialCrs","./GalacticCrs","./ProjectedCrs"],function(t,e,i,r,n,s){function o(s,o){var a;switch(s){case t.CRS.Equatorial:a=new r(o);break;case t.CRS.Galactic:a=new n(o);break;case t.CRS.WGS84:a=new e(o);break;case t.CRS.Mars_2000_old:case t.CRS.Mars_2000:a=new i(o);break;default:throw new RangeError("Datum "+o.geoideName+" not implemented","CoordinateSystemFactory.js")}return a}return{create:function(t){var e;if(!t||!t.geoideName)throw new ReferenceError("geoideName not defined in "+JSON.stringify(t),"CoordinateSystemFactory.js");return e=o(t.geoideName,t),t&&t.projectionName&&(e=new s(e,t)),e}}}),r("Layer/CoordinateGridLayer",["./AbstractLayer","../Utils/Utils","../Renderer/Ray","../Renderer/Program","../Tiling/Mesh","../Crs/AstroCoordTransform","../Renderer/FeatureStyle","../Utils/Constants","../Crs/CoordinateSystemFactory"],function(t,e,i,r,n,s,o,a,l){var h=function(t){var e=t,i=[],r=function(t){var i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i},n=function(t){var r=i.pop();return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),r};this.createGLTexture=function(t){return i.length>0?n(t):r(t)},this.disposeGLTexture=function(t){i.push(t)},this.disposeAll=function(){for(var t=0;t<i.length;t++)e.deleteTexture(i[t]);i.length=0}},u=function(e){t.prototype.constructor.call(this,a.LAYER.CoordinateGrid,e),this.globe=null,this.labels={},this.texturePool=null,this.longitudeSample=e.longitudeSample||15,this.latitudeSample=e.latitudeSample||10,this.canvas2d=document.createElement("canvas"),this.canvas2d.width=100,this.canvas2d.height=20,this.vertexBuffer=null,this.indexBuffer=null,this.gridCrs=l.create(e.coordinateSystem),this.longFormat=e.longFormat?e.longFormat:"Deg",this.latFormat=e.latFormat?e.latFormat:"Deg",this.geoBound={},this.tesselation=e.tesselation||2};return e.inherits(t,u),u.prototype.generateImageData=function(t){var e=this.canvas2d.getContext("2d");e.clearRect(0,0,this.canvas2d.width,this.canvas2d.height),e.fillStyle=o.fromColorToString(this.color),e.font="18px sans-serif",e.textBaseline="top",e.textAlign="center";var i=this.canvas2d.width/2;return e.fillText(t,i,0),e.getImageData(0,0,this.canvas2d.width,this.canvas2d.height)},u.prototype._attach=function(e){if(t.prototype._attach.call(this,e),this.isVisible()&&this.globe.tileManager.addPostRenderer(this),!this.gridProgram){var i="attribute vec3 vertex;\n";i+="uniform mat4 viewProjectionMatrix;\n",i+="void main(void) \n",i+="{\n",i+="gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n",i+="}\n";var s="precision highp float; \n";s+="uniform float alpha; \n",s+="uniform vec3 color; \n",s+="void main(void)\n",s+="{\n",s+="gl_FragColor = vec4(color,alpha);\n",s+="}\n";var o="attribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \n";o+="uniform mat4 viewProjectionMatrix; \n",o+="uniform vec3 poiPosition; // world position \n",o+="uniform vec2 poiScale; // x,y scale \n",o+="\n",o+="varying vec2 texCoord; \n",o+="\n",o+="void main(void)  \n",o+="{ \n",o+="// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n",o+="texCoord = vertex.xy + vec2(0.5); \n",o+="// Invert y \n",o+="texCoord.y = 1.0 - texCoord.y; \n",o+="\n",o+="// Compute poi position in clip coordinate \n",o+="gl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n",o+="gl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n",o+="} \n";var a="#ifdef GL_ES \n";a+="precision highp float; \n",a+="#endif \n",a+="\n",a+="varying vec2 texCoord; \n",a+="uniform sampler2D texture; \n",a+="uniform float alpha; \n",a+="\n",a+="void main(void) \n",a+="{ \n",a+="\tvec4 textureColor = texture2D(texture, texCoord); \n",a+="\tgl_FragColor = vec4(textureColor.rgb, textureColor.a * alpha); \n",a+="} \n",this.gridProgram=new r(this.globe.renderContext),this.labelProgram=new r(this.globe.renderContext),this.gridProgram.createFromSource(i,s),this.labelProgram.createFromSource(o,a)}this.labelMesh=new n(this.globe.renderContext);var l=[-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0],u=[0,3,1,1,3,2];this.labelMesh.setVertices(l),this.labelMesh.setIndices(u);var c=this.globe.renderContext.gl;this.vertexBuffer=c.createBuffer(),this.indexBuffer=c.createBuffer(),this.texturePool||(this.texturePool=new h(c))},u.prototype._detach=function(){var e=this.globe.renderContext.gl;e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),this.texturePool.disposeAll();for(var i in this.labels)this.labels.hasOwnProperty(i)&&delete this.labels[i];this.globe.tileManager.removePostRenderer(this),t.prototype._detach.call(this)},u.prototype.clampGeoBound=function(t){return t.west=Math.floor(t.west/this.longitudeSample)*this.longitudeSample,t.east=Math.ceil(t.east/this.longitudeSample)*this.longitudeSample,t.north=Math.ceil(t.north/this.latitudeSample)*this.latitudeSample,t.south=Math.floor(t.south/this.latitudeSample)*this.latitudeSample,t},u.prototype.render=function(t){var e=this.globe.renderContext,i=e.gl;i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA);var r,n=this;r=this.globe.getViewportGeoBound(function(t){return n.globe.getCoordinateSystem().convert(t,a.CRS.Equatorial,n.gridCrs.getGeoideName())}),r=this.clampGeoBound(r),this.geoBound.west!==r.west||this.geoBound.east!==r.east||this.geoBound.north!==r.north||this.geoBound.south!==r.south?(this.geoBound=r,this.computeSamples(),this.generateGridBuffers(),this.generateLabels()):this.updateLabels(),this.gridProgram.apply(),mat4.multiply(e.projectionMatrix,e.viewMatrix,e.modelViewMatrix),i.uniformMatrix4fv(this.gridProgram.uniforms.viewProjectionMatrix,!1,e.modelViewMatrix),i.uniform1f(this.gridProgram.uniforms.alpha,this.opacity),i.uniform3f(this.gridProgram.uniforms.color,this.color[0],this.color[1],this.color[2]),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.vertexAttribPointer(this.gridProgram.attributes.vertex,this.vertexBuffer.itemSize,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i.drawElements(i.LINES,this.indexBuffer.numItems,i.UNSIGNED_SHORT,0),this.labelProgram.apply(),mat4.multiply(e.projectionMatrix,e.viewMatrix,e.modelViewMatrix),i.uniformMatrix4fv(this.labelProgram.uniforms.viewProjectionMatrix,!1,e.modelViewMatrix),i.uniform1i(this.labelProgram.uniforms.texture,0);var s=e.computePixelSizeVector();for(var o in this.labels)if(this.labels.hasOwnProperty(o)){var l=this.labels[o];i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,l.texture);var h=[2*l.textureWidth/e.canvas.width,2*l.textureHeight/e.canvas.height];i.uniform2fv(this.labelProgram.uniforms.poiScale,h);var u=l.pos3d,c=l.vertical;h=l.textureHeight*(s[0]*u[0]+s[1]*u[1]+s[2]*u[2]+s[3]);var d=c[0]*h+u[0],p=c[1]*h+u[1],f=c[2]*h+u[2];i.uniform3f(this.labelProgram.uniforms.poiPosition,d,p,f),i.uniform1f(this.labelProgram.uniforms.alpha,1),this.labelMesh.render(this.labelProgram.attributes),l.needed=!1}i.enable(i.DEPTH_TEST),i.disable(i.BLEND)},u.prototype.setVisible=function(e){t.prototype.setVisible.call(this,e),"boolean"==typeof e&&(this.isVisible()?this.globe.tileManager.addPostRenderer(this):this.globe.tileManager.removePostRenderer(this))},u.prototype.computeSamples=function(){var t=this.geoBound.east-this.geoBound.west;for(this.geoBound.north-this.geoBound.south;t/this.longitudeSample<3&&this.longitudeSample>1;)this.longitudeSample/=2,this.latitudeSample/=2;for(;t/this.longitudeSample>7&&this.longitudeSample<15;)this.longitudeSample*=2,this.latitudeSample*=2},u.prototype.generateGridBuffers=function(){var t,e,i,r,n;this.geoBound.east-this.geoBound.west>180?(t=0,e=360):(t=this.geoBound.west,e=this.geoBound.east);var s=[],o=180/this.latitudeSample;for(i=0;i<=o;i++){var l=i*Math.PI/o,h=Math.sin(l),u=Math.cos(l);for(r=t;r<=e;r+=this.longitudeSample){var c=this.longitudeSample/this.tesselation;for(n=0;n<this.tesselation;n++){var d=(r+n*c)*Math.PI/180,p=Math.sin(d),f=Math.cos(d),g=f*h*this.globe.getCoordinateSystem().getGeoide().getRadius(),m=p*h*this.globe.getCoordinateSystem().getGeoide().getRadius(),v=u*this.globe.getCoordinateSystem().getGeoide().getRadius();if(this.gridCrs.getGeoideName()!==a.CRS.Equatorial){var y=this.globe.getCoordinateSystem().from3DToGeo([g,m,v]);y=this.globe.getCoordinateSystem().convert(y,this.gridCrs.getGeoideName(),a.CRS.Equatorial);var b=this.globe.getCoordinateSystem().fromGeoTo3D(y);s.push(b[0],b[1],b[2])}else s.push(g,m,v)}}}var x=this.globe.renderContext.gl;x.bindBuffer(x.ARRAY_BUFFER,this.vertexBuffer),x.bufferData(x.ARRAY_BUFFER,new Float32Array(s),x.STATIC_DRAW),this.vertexBuffer.itemSize=3,this.vertexBuffer.numItems=s.length/3;var _=[],w=(e-t)/this.longitudeSample+1;for(w*=this.tesselation,i=0;i<o;i++)for(r=t,longNumber=0;r<e;r+=this.longitudeSample,longNumber+=this.tesselation){var C=i*w+longNumber%(w-1),T=C+w;for(n=0;n<this.tesselation;n++)_.push(C+n),_.push(C+n+1);_.push(C+this.tesselation),_.push(T+this.tesselation),_.push(T),_.push(C)}x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,this.indexBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,new Uint16Array(_),x.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=_.length},u.prototype.buildAngle=function(t,e){var i;switch(t){case"Deg":i=e+"°";break;case"HMS":i=this.globe.getCoordinateSystem().fromDegreesToHMS(e);break;case"DMS":i=this.globe.getCoordinateSystem().fromDegreesToDMS(e);break;default:return console.error(t+" : format not supported"),null}return i},u.prototype.computeGeoCenter=function(){var t=i.createFromPixel(this.globe.getRenderContext(),this.globe.getRenderContext().canvas.width/2,this.globe.getRenderContext().canvas.height/2),e=t.computePoint(t.sphereIntersect([0,0,0],this.globe.getCoordinateSystem().getGeoide().getRadius())),r=[];return this.globe.getCoordinateSystem().from3DToGeo(e,r),r=this.globe.getCoordinateSystem().convert(r,a.CRS.Equatorial,this.gridCrs.getGeoideName())},u.prototype.updateLabel=function(t,e){e=this.globe.getCoordinateSystem().convert(e,this.gridCrs.getGeoideName(),a.CRS.Equatorial);var i=this.globe.getCoordinateSystem().fromGeoTo3D(e),r=vec3.create();vec3.normalize(i,r),this.labels[t].pos3d=i,this.labels[t].vertical=r,this.labels[t].needed=!0},u.prototype.updateLabels=function(){var t=this.computeGeoCenter();for(var e in this.labels)if(this.labels.hasOwnProperty(e)){var i;"lat"===this.labels[e].type?i=[this.labels[e].angle,t[1]]:"long"===this.labels[e].type&&(i=[t[0],this.labels[e].angle]),this.updateLabel(e,i)}},u.prototype.generateLabels=function(){var t,e,i,r,n,s,o,a;this.geoBound.east-this.geoBound.west>180?(e=0,t=360):(e=this.geoBound.west,t=this.geoBound.east);var l,h=this.computeGeoCenter();for(r=e;r<t;r+=this.longitudeSample)o=r<0?r+360:r,l=this.buildAngle(this.longFormat,o),this.labels["lat_"+l]||(this.labels["lat_"+l]={angle:r,type:"lat"},i=this.generateImageData(l),this._buildTextureFromImage(this.labels["lat_"+l],i)),s=[r,h[1]],this.updateLabel("lat_"+l,s);for(thetaStart=Math.min(this.geoBound.north,this.geoBound.south),thetaStop=Math.max(this.geoBound.north,this.geoBound.south),
a=thetaStart;a<=thetaStop;a+=this.latitudeSample)l=this.buildAngle(this.latFormat,a),this.labels["long_"+l]||(this.labels["long_"+l]={angle:a,type:"long"},i=this.generateImageData(l),this._buildTextureFromImage(this.labels["long_"+l],i)),s=[h[0],a],this.updateLabel("long_"+l,s);for(n in this.labels)this.labels[n].needed||(this.texturePool.disposeGLTexture(this.labels[n].texture),delete this.labels[n])},u.prototype._buildTextureFromImage=function(t,e){t.texture=this.texturePool.createGLTexture(e),t.textureWidth=e.width,t.textureHeight=e.height},u}),r("Tiling/HEALPixTiling",["./Tile","./HEALPixBase","../Renderer/GeoBound","../Utils/Numeric","../Utils/Constants"],function(t,e,i,r,n){var s=function(e,i,r){t.prototype.constructor.call(this),this.order=e,this.nside=Math.pow(2,this.order),this.pixelIndex=i,this.face=r,this.geoBound=null};s.prototype=new t,s.prototype.createChildren=function(){var t=new s(this.order+1,4*this.pixelIndex,this.face),e=new s(this.order+1,4*this.pixelIndex+2,this.face),i=new s(this.order+1,4*this.pixelIndex+1,this.face),r=new s(this.order+1,4*this.pixelIndex+3,this.face);t.initFromParent(this,0,0),e.initFromParent(this,1,0),i.initFromParent(this,0,1),r.initFromParent(this,1,1),this.children=[t,e,i,r]},s.prototype.computeLocalMatrix=function(t){for(var e=mat4.create(),i=vec3.create(),r=vec3.create(),n=vec3.create(),s=0,o=0,a=0,l=0;l<t.length;l++)s+=t[l][0],o+=t[l][1],a+=t[l][2];var h=vec3.create([s/t.length,o/t.length,a/t.length]);return vec3.set(h,n),vec3.normalize(n),vec3.subtract(t[0],t[3],r),vec3.cross(n,r,i),vec3.normalize(i),vec3.cross(n,i,r),vec3.normalize(r),e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=0,e[4]=r[0],e[5]=r[1],e[6]=r[2],e[7]=0,e[8]=n[0],e[9]=n[1],e[10]=n[2],e[11]=0,e[12]=h[0],e[13]=h[1],e[14]=h[2],e[15]=1,e},s.prototype.generateVertices=function(){for(var t=this.config.tesselation,r=[],s=1/(t-1),o=this.pixelIndex&this.nside*this.nside-1,a=e.compress_bits(o),l=e.compress_bits(o>>>1),h=this.config.coordinateSystem,u=0;u<t;u++)for(var c=0;c<t;c++){var d=e.fxyf((a+u*s)/this.nside,(l+c*s)/this.nside,this.face);if(d[0]*=h.getGeoide().getRadius(),d[1]*=h.getGeoide().getRadius(),d[2]*=h.getGeoide().getRadius(),h.getGeoideName()!==n.CRS.Equatorial){var p=h.getWorldFrom3D(d),f=h.convert(p,h.getGeoideName(),n.CRS.Equatorial);r[u*t+c]=h.get3DFromWorld(f)}else r[u*t+c]=d}this.geoBound=new i;var g=[];g.push(h.getWorldFrom3D(r[0])),g.push(h.getWorldFrom3D(r[t-1])),g.push(h.getWorldFrom3D(r[t*(t-1)])),g.push(h.getWorldFrom3D(r[t*t-1])),this.geoBound.computeFromCoordinates(g),this.matrix=this.computeLocalMatrix(r);var m=mat4.create();mat4.inverse(this.matrix,m),this.inverseMatrix=m;for(var v=new Float32Array(3*t*t),y=0,b=0;b<r.length;b++)v[y]=m[0]*r[b][0]+m[4]*r[b][1]+m[8]*r[b][2]+m[12],v[y+1]=m[1]*r[b][0]+m[5]*r[b][1]+m[9]*r[b][2]+m[13],v[y+2]=m[2]*r[b][0]+m[6]*r[b][1]+m[10]*r[b][2]+m[14],y+=3;return v};var o=function(t,e){this.order=t,this.nside=Math.pow(2,this.order),this.coordinateSystem=e.coordinateSystem};o.prototype.generateLevelZeroTiles=function(t,e){t.skirt=!1,t.cullSign=-1,t.tesselation=5,t.coordinateSystem=this.coordinateSystem,this.coordinateSystem=t.coordinateSystem;for(var i=[],r=Math.pow(this.nside,2),n=12,o=n*r,a=0;a<o;a++){var l=Math.floor(a/r),h=new s(this.order,a,l);h.config=t,i.push(h)}return i};var a=function(t){var e,i;switch(t.type){case n.GEOMETRY.Point:e=[],e.push(t.coordinates);break;case n.GEOMETRY.MultiPoint:case n.GEOMETRY.LineString:e=t.coordinates;break;case n.GEOMETRY.MultiLineString:for(e=[],i=0;i<t.coordinates.length;i++)e=e.concat(t.coordinates[i]);break;case n.GEOMETRY.Polygon:e=t.coordinates[0];break;case n.GEOMETRY.MultiPolygon:for(e=[],i=0;i<t.coordinates.length;i++)e=e.concat(t.coordinates[i][0]);break;case n.GEOMETRY.GeometryCollection:for(e=[],i=0;i<t.geometries.length;i++)e=e.concat(a(t.geometries[i]))}return e};return o.prototype.getOverlappedLevelZeroTiles=function(t){var e=[],i=a(t);if(!i)return console.log("Invalid geometry type or not supported."),e;for(var r={},n=0;n<i.length;n++){var s=this.lonlat2LevelZeroIndex(i[n][0],i[n][1]);r[s]||(r[s]=!0,e.push(s))}return e},o.prototype.lonlat2LevelZeroIndex=function(t,i){return e.lonLat2pix(this.order,t,i)},o.prototype.findInsideTile=function(t,i,r){for(var n=0;n<r.length;n++){var s=r[n],o=e.lonLat2pix(s.order,t,i);if(o===s.pixelIndex)return s}return null},o}),r("Layer/HipsMetadata",["jquery","../Utils/Constants"],function(t,e){function i(t,e,i,r,n){"R"!==e||t.hasOwnProperty(i)||("creator_did"===i&&"1.2"===t.hips_version?t.creator_did=t.publisher_did:n.push(i+" ("+r+") is not present. "))}function r(t,e,i){t&&i.hasOwnProperty(e)&&(i[e]=i[e].split(/\s+/))}function n(t,e,i,r,n,s){if(null!==r&&n.hasOwnProperty(t))if(e){for(var o in n[t])if(n[t].hasOwnProperty(o)){var a=n[t][o];if(!r.hasOwnProperty(a)){s.push('The value "'+n[t]+'" of '+t+" ("+i+") is not correct. ");break}}}else r.hasOwnProperty(n[t])||s.push('The value "'+n[t]+'" of '+t+" ("+i+") is not correct. ")}function s(t,e,i){null===e||i.hasOwnProperty(t)||(i[t]=e)}function o(t){var e,o,a,l,h,u,c=[],d=[];for(var p in v)v.hasOwnProperty(p)&&(e=v[p],o=e[0],a=e[1],l=e[3],h=e[4],u=e[5],i.call(this,t,p,a,c),r.call(this,u,p,t),n.call(this,p,u,a,h,t,d),s.call(this,p,l,t));if(c.length>0||d.length>0)throw"unvalid hips metadata : \n"+c.toString()+"\n"+d.toString()}function a(e){var i=t.ajax({type:"GET",url:e+"/properties",async:!1}).responseText;if("undefined"==typeof i)throw"Unable to load the Hips at "+e;var r=l.call(this,i);return o.call(this,r),r}function l(e){var i={},r=e.split(/\r?\n/),n="";return t.each(r,function(t,e){if(!/^\s*(\#|\!|$)/.test(e))if(e=e.replace(/^\s*/,""),n+=e,/(\\\\)*\\$/.test(n))n=n.replace(/\\$/,"");else{/^\s*((?:[^\s:=\\]|\\.)+)\s*[:=\s]\s*(.*)$/.test(n);var r=RegExp.$1,s=RegExp.$2;i.hasOwnProperty(r)?i[r]=i[r].isPrototypeOf(Array)?i[r].push(s):[i[r],s]:i[r]=s,n=""}}),i}var h={Radio:"Radio",Millimeter:"Millimeter",Infrared:"Infrared",Optical:"Optical",UV:"UV",EUV:"EUV","X-ray":"X-ray","Gamma-ray":"Gamma-ray"},u={equatorial:e.CRS.Equatorial,galactic:e.CRS.Galactic,ecliptic:"ecliptic"},c={jpeg:"jpeg",png:"png",fits:"fits",tsv:"tsv"},d={none:"non",nearest:"nearest",bilinear:"bilinear"},p={add:"add",mean:"mean",first:"first",border_fading:"border_fading",custom:"custom"},f={none:"none",hips_estimation:"hips_estimation",fits_keyword:"fits_keyword"},g={image:"image",cube:"cube",catalog:"catalog",meta:"meta"},m={color:"color",live:"live"},v={creator_did:["R","Unique ID of the HiPS - Format: IVOID - Ex : ivo://CDS/P/2MASS/J",!1,null,null,!1],publisher_id:[null,"Unique ID of the HiPS publisher – Format: IVOID - Ex : ivo://CDS",!1,null,null,!1],obs_collection:[null,"Short name of original data set – Format: one word – Ex : 2MASS",!1,null,null,!1],obs_title:["R","Data set title – Format: free text, one line – Ex : HST F110W observations",!1,null,null,!1],obs_description:["S","Data set description – Format: free text, longer free text description of the dataset",!1,null,null,!1],obs_ack:[null,"Acknowledgment mention",!1,null,null,!1],prov_progenitor:["S","Provenance of the original data – Format: free text",!0,null,null,!1],bib_reference:[null,"Bibliographic reference",!0,null,null,!1],bib_reference_url:[null,"URL to bibliographic reference",!0,null,null,!1],obs_copyright:[null,"Copyright mention – Format: free text",!1,null,null,!1],obs_copyright_url:[null,"URL to a copyright mention",!1,null,null,!1],obs_regime:["S","General wavelength – Format: word",!0,null,h,!1],data_ucd:[null,"UCD describing data contents",!0,null,null,!1],hips_version:["R","Number of HiPS version – Format: number",!1,"1.4",null,!1],hips_builder:[null,"Name and version of the tool used for building the HiPS – Format: free text",!1,null,null,!1],hips_publisher:[null,"Institute or person who built the HiPS – Format: free text – Ex : CDS (T.Boch)",!1,null,null,!1],hips_creation_date:["S","HiPS first creation date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ",!1,null,null,!1],hips_release_date:["R","Last HiPS update date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ",!1,null,null,!1],hips_service_url:[null,"HiPS access url – Format: URL",!1,null,null,!1],hips_status:["R","HiPS status",!1,"public master clonableOnce",null,!0],hips_estsize:[null,"HiPS size estimation – Format: positive integer – Unit : KB",!1,null,null,!1],hips_frame:["R","Coordinate frame reference",!1,null,u,!1],hips_order:["R","Deepest HiPS order – Format: positive integer",!1,null,null,!1],hips_tile_width:[null,"Tiles width in pixels – Format: positive integer",!1,512,null,!1],hips_tile_format:["R","List of available tile formats. The first one is the default suggested to the client",!1,null,c,!0],hips_pixel_cut:[null,"Suggested pixel display cut range (physical values) – Format: min max",null,null,null,!0],hips_data_range:[null,"Pixel data range taken into account during the HiPS generation (physical values) – Format: min max – Ex : -18.5 510.5",!1,null,null,!0],hips_sampling:[null,"Sampling applied for the HiPS generation",!1,null,d,!1],hips_overlay:[null,"Pixel composition method applied on the image overlay region during HiPS generation",!1,null,p,!1],hips_skyval:[null,"Sky background subtraction method applied during HiPS generation",!1,null,f,!1],hips_pixel_bitpix:[null,"Fits tile BITPIX code",!1,null,null,!1],data_pixel_bitpix:[null,"Original data BITPIX code",!1,null,null],dataproduct_type:["R","Type of data",!1,null,g,!1],dataproduct_subtype:["RD","Subtype of data",!1,null,m,!1],hips_progenitor_url:[null,"URL to an associated progenitor HiPS",!1,null,null,!1],hips_cat_nrows:["S","Number of rows of the HiPS catalog",!1,null,null,!1],hips_cube_depth:["RD","Number of frames of the HiPS cube",!1,null,null,!1],hips_cube_firstframe:[null,"Initial first index frame to display for a HiPS cube",!1,0,null,!1],data_cube_crpix3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_crval3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_cdelt3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_bunit3:[null,"Third axis unit (see FITS doc)",!1,null,null,!1],hips_initial_ra:["S","Default RA display position (ICRS frame) – Unit : degrees",!1,null,null,!1],hips_initial_dec:["S","Default DEC display position (ICRS frame) – Unit : degrees",!1,null,null,!1],hips_initial_fov:["S","Default display size – Unit : degrees",!1,null,null,!1],hips_pixel_scale:[null,"HiPS pixel angular resolution at the highest order – Unit : degrees",!1,null,null,!1],s_pixel_scale:[null,"Best pixel angular resolution of the original images – Unit : degrees",!1,null,null,!1],t_min:["S","Start time of the observations - Representation: MJD",!1,null,null,!1],t_max:["S","Stop time of the observations - Representation: MJD",!1,null,null,!1],em_min:["S","Start in spectral coordinates – Unit: meters",!1,null,null,!1],em_max:["S","Stop in spectral coordinates – Unit: meters",!1,null,null,!1],client_category:[null,"/ separated keywords suggesting a display hierarchy to the client – Ex : Image/InfraRed",!1,null,null,!1],client_sort_key:[null,"Sort key suggesting a display order to the client inside a client_category – Sort : alphanumeric",!1,null,null,!1],addendum_did:[null,"In case of “live” HiPS, creator_did of the added HiPS",!0,null,null,!1],moc_sky_fraction:[null,"Fraction of the sky covers by the MOC associated to the HiPS – Format: real between 0 and 1",!1,null,null,!1]},y=function(t){"string"==typeof t?(this.baseUrl=t,this.hipsMetadata=a.call(this,t)):this.hipsMetadata=t};return y.prototype.GeneralWavelength=h,y.prototype.HipsFrame=u,y.prototype.HipsTileFormat=c,y.prototype.Sampling=d,y.prototype.PixelOverlay=p,y.prototype.SkyVal=f,y.prototype.DataProductType=g,y.prototype.SubTypeData=m,y.prototype.getHipsMetadata=function(){return this.hipsMetadata},y.prototype.getBaseUrl=function(){return this.baseUrl},y}),r("Layer/AbstractHipsLayer",["./AbstractRasterLayer","../Utils/Utils","../Utils/Constants","../Tiling/HEALPixTiling","../Crs/CoordinateSystemFactory","./HipsMetadata"],function(t,e,i,r,n,s){function o(t){if(!t)throw"Some required parameters are missing"}function a(t,e){var i=t;if("undefined"==typeof i){var r=new s(e);i=r.getHipsMetadata()}return i}function l(t,e){t.coordinateSystem=t.hasOwnProperty("coordinateSystem")?n.create(t.coordinateSystem):n.create({geoideName:i.MappingCrsHips2Mizar[e.hips_frame]}),t.tilePixelSize=t.hasOwnProperty("tilePixelSize")?t.tilePixelSize:e.hips_tile_width,t.baseLevel=t.hasOwnProperty("baseLevel")?t.baseLevel:e.hasOwnProperty("hips_order_min")?e.hips_order_min:2,t.numberOfLevels=t.hasOwnProperty("numberOfLevels")?t.numberOfLevels:e.hips_order,t.name=t.hasOwnProperty("name")?t.name:e.obs_title,t.attribution=t.hasOwnProperty("attribution")?t.attribution:'<a href="'+e.obs_copyright_url+'" target="_blank">'+e.obs_copyright+"</a>",t.copyrightUrl=t.hasOwnProperty("copyrightUrl")?t.copyrightUrl:e.obs_copyright_url,t.ack=t.hasOwnProperty("ack")?t.ack:e.obs_ack,t.description=t.hasOwnProperty("description")?t.description:e.obs_description,t.format=t.hasOwnProperty("format")?t.format:e.hips_tile_format,t.baseUrl=t.hasOwnProperty("baseUrl")?t.baseUrl:e.hips_service_url,t.properties=t.hasOwnProperty("properties")?t.properties:{},e.hasOwnProperty("obs_initial_ra")&&(t.properties.initialRa=parseFloat(e.obs_initial_ra)),e.hasOwnProperty("obs_initial_dec")&&(t.properties.initialDec=parseFloat(e.obs_initial_dec)),e.hasOwnProperty("obs_initial_fov")&&(t.properties.initialFov=parseFloat(e.obs_initial_fov)),e.hasOwnProperty("moc_sky_fraction")&&(t.properties.moc_sky_fraction=parseFloat(e.moc_sky_fraction))}var h=function(e,n){o.call(this,n),this.hipsMetadata=a.call(this,e,n.baseUrl),l.call(this,n,this.hipsMetadata),n.tiling=new r(n.baseLevel||2,{coordinateSystem:n.coordinateSystem}),n.icon=n.hasOwnProperty("icon")?n.icon:n.mizarBaseUrl?n.mizarBaseUrl+"css/images/star.png":"",n.visible=!!n.hasOwnProperty("visible")&&n.visible,n.properties=n.hasOwnProperty("properties")?n.properties:{},n.pickable=!!n.hasOwnProperty("pickable")&&n.pickable,n.services=n.hasOwnProperty("services")?n.services:[],n.category="Image",n.availableServices={},this.hipsMetadata.hasOwnProperty("moc_access_url")&&(n.availableServices.Moc={serviceURL:this.hipsMetadata.moc_access_url,skyFraction:this.hipsMetadata.moc_sky_fraction}),n.coordinateSystem.getGeoideName()===i.CRS.Galactic&&(n.background=!0),t.prototype.constructor.call(this,i.LAYER.Hips,n),this._overlay=!n.background};return e.inherits(t,h),h.prototype.getHipsMetadata=function(){return this.hipsMetadata},h}),r("Renderer/ColorMap",["../Utils/Numeric"],function(t){function e(t,e,i,r,n,s){var o;if(r===t.UNSIGNED_BYTE)o=new Uint8Array(e);else{if(r!==t.FLOAT)return null;o=new Float32Array(e)}var a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,i,n,s,0,i,r,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),a}var i={linear:[],asin:[],sqrt:[],sqr:[],log:[]},r=function(){for(var t in i)if(i.hasOwnProperty(t)){for(var e,r=Number.MAX_VALUE,n=Number.MIN_VALUE,s=[],o=0;o<256;o++){switch(e=o,t){case"linear":s[o]=e;break;case"asin":s[o]=Math.log(e+Math.sqrt(Math.pow(e,2)+1));break;case"log":s[o]=Math.log(e/10+1);break;case"sqrt":s[o]=Math.sqrt(e/10);break;case"sqr":s[o]=e*e}s[o]<r&&(r=s[o]),s[o]>n&&(n=s[o])}for(o=0;o<256;o++)e=256*((s[o]-r)/(n-r)),e>256?e=256:e<0&&(e=0),i[t][o]=Math.floor(e)}};r();var n={fire:{red:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,7,10,13,16,19,22,25,28,31,34,37,40,43,46,49,52,55,58,61,64,67,70,73,76,79,82,85,88,91,94,98,101,104,107,110,113,116,119,122,125,128,131,134,137,140,143,146,148,150,152,154,156,158,160,162,163,164,166,167,168,170,171,173,174,175,177,178,179,181,182,184,185,186,188,189,190,192,193,195,196,198,199,201,202,204,205,207,208,209,210,212,213,214,215,217,218,220,221,223,224,226,227,229,230,231,233,234,235,237,238,240,241,243,244,246,247,249,250,252,252,252,253,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,8,10,12,14,16,19,21,24,27,29,32,35,37,40,43,46,48,51,54,57,59,62,65,68,70,73,76,79,81,84,87,90,92,95,98,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,134,136,138,140,141,143,145,147,148,150,152,154,155,157,159,161,162,164,166,168,169,171,173,175,176,178,180,182,184,186,188,190,191,193,195,197,199,201,203,205,206,208,210,212,213,215,217,219,220,222,224,226,228,230,232,234,235,237,239,241,242,244,246,248,248,249,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],blue:[0,7,15,22,30,38,45,53,61,65,69,74,78,82,87,91,96,100,104,108,113,117,121,125,130,134,138,143,147,151,156,160,165,168,171,175,178,181,185,188,192,195,199,202,206,209,213,216,220,220,221,222,223,224,225,226,227,224,222,220,218,216,214,212,210,206,202,199,195,191,188,184,181,177,173,169,166,162,158,154,151,147,143,140,136,132,129,125,122,118,114,111,107,103,100,96,93,89,85,82,78,74,71,67,64,60,56,53,49,45,42,38,35,31,27,23,20,16,12,8,5,4,3,3,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,13,17,21,26,30,35,42,50,58,66,74,82,90,98,105,113,121,129,136,144,152,160,167,175,183,191,199,207,215,223,227,231,235,239,243,247,251,255,255,255,255,255,255,255,255]},eosb:{red:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,18,27,36,45,49,57,72,81,91,100,109,118,127,136,131,139,163,173,182,191,200,209,218,227,213,221,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,253,251,249,247,245,243,241,215,214,235,234,232,230,228,226,224,222,198,196,216,215,213,211,209,207,205,203,181,179,197,196,194,192,190,188,186,184,164,162,178,176,175,173,171,169,167,165,147,145,159,157,156,154,152,150,148,146,130,128,140,138,137,135,133,131,129,127,113,111,121,119,117,117],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,15,23,31,39,47,55,57,64,79,87,95,103,111,119,127,135,129,136,159,167,175,183,191,199,207,215,200,207,239,247,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,250,246,242,238,233,229,225,198,195,212,208,204,199,195,191,187,182,160,156,169,165,161,157,153,148,144,140,122,118,127,125,123,121,119,116,114,112,99,97,106,104,102,99,97,95,93,91,80,78,84,82,80,78,76,74,72,70,61,59,63,61,59,57,55,53,50,48,42,40,42,40,38,36,33,31,29,27,22,21,21,19,16,14,12,13,8,6,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],blue:[116,121,127,131,136,140,144,148,153,157,145,149,170,174,178,182,187,191,195,199,183,187,212,216,221,225,229,233,238,242,221,225,255,247,239,231,223,215,207,199,172,164,175,167,159,151,143,135,127,119,100,93,95,87,79,71,63,55,47,39,28,21,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},stern:{red:[0,18,36,54,72,90,108,127,145,163,199,217,235,254,249,244,239,234,229,223,218,213,208,203,197,192,187,182,177,172,161,156,151,146,140,135,130,125,120,115,109,104,99,94,89,83,78,73,68,63,52,47,42,37,32,26,21,16,11,6,64,65,66,67,68,69,70,71,72,73,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,117,118,119,120,121,122,123,124,125,126,128,129,130,131,132,133,134,135,136,137,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,181,182,183,184,185,186,187,188,189,190,192,193,194,195,196,197,198,199,200,201,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,245,246,247,248,249,250,251,252,253,254],green:[0,1,2,3,4,5,6,7,8,9,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,53,54,55,56,57,58,59,60,61,62,64,65,66,67,68,69,70,71,72,73,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,117,118,119,120,121,122,123,124,125,126,128,129,130,131,132,133,134,135,136,137,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,181,182,183,184,185,186,187,188,189,190,192,193,194,195,196,197,198,199,200,201,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,245,246,247,248,249,250,251,252,253,254],blue:[0,1,3,5,7,9,11,13,15,17,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,105,107,109,111,113,115,117,119,121,123,127,129,131,133,135,137,139,141,143,145,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,233,235,237,239,241,243,245,247,249,251,255,251,247,243,238,234,230,226,221,217,209,204,200,196,192,187,183,179,175,170,166,162,158,153,149,145,141,136,132,128,119,115,111,107,102,98,94,90,85,81,77,73,68,64,60,56,51,47,43,39,30,26,22,17,13,9,5,0,3,7,15,19,22,26,30,34,38,41,45,49,57,60,64,68,72,76,79,83,87,91,95,98,102,106,110,114,117,121,125,129,137,140,144,148,152,156,159,163,167,171,175,178,182,186,190,194,197,201,205,209,216,220,224,228,232,235,239,243,247,251]},rainbow:{red:[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0],blue:[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},grey:{red:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255],green:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255],blue:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]}};return{addCustomColormap:function(e,i){if(i.length<2)return console.error("Colors length must be >= 2"),null;for(var r=256,s={red:[],green:[],blue:[]},o=i.length-1,a=0;a<o;a++)for(var l=i[a],h=i[a+1],u=r/(i.length-1),c=s.red.length,d=Math.floor((a+1)*u),p=c;p<d;p++)s.red.push(t.lerp(p/d,l[0],h[0])),s.green.push(t.lerp(p/d,l[1],h[1])),s.blue.push(t.lerp(p/d,l[2],h[2]));n[e]=s},generateColormap:function(t,r,s,o){var a,l,h,u=i[r],c=[];a=n[s].red,l=n[s].green,h=n[s].blue;for(var d=a.length-1,p=0;p<256;p++){var f=u[p];f>d?f=d:f<0&&(f=0),o&&(f=d-f),c[3*p]=a[f]/256,c[3*p+1]=l[f]/256,c[3*p+2]=h[f]/256}return e(t,c,t.RGB,t.FLOAT,c.length/3,1)}}}),r("Renderer/DynamicImage",["./ColorMap"],function(t){var e="precision highp float; \n";e+="varying vec2 vTextureCoord;\n",e+="uniform sampler2D texture; \n",e+="uniform sampler2D colormap; \n",e+="uniform float min; \n",e+="uniform float max; \n",e+="uniform vec4 color; \n",e+="void main(void)\n",e+="{\n",e+="\tfloat i = texture2D(texture,vTextureCoord).r;\n",e+="\tfloat d = clamp( ( i - min ) / (max - min), 0.0, 1.0 );\n",e+="\tvec4 cmValue = texture2D(colormap, vec2(d,0.));\n",e+="\tgl_FragColor = vec4(cmValue.r,cmValue.g,cmValue.b,color.a);\n",e+="}\n";var i=function(t,e,i){i||(i=e.polygonProgram),t.uniform1f(i.uniforms.max,e.style.uniformValues.tmax),t.uniform1f(i.uniforms.min,e.style.uniformValues.tmin),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,e.style.uniformValues.colormapTex),t.uniform1i(i.uniforms.colormap,1)},r=function(t,r,n,s,o,a,l){e=l&&l.fragmentCode?l.fragmentCode:e,i=l&&l.updateUniforms?l.updateUniforms:i,this.fragmentCode=e,this.updateUniforms=i,this.tmin=0,this.tmax=1,this.colormapTex=null,this.renderContext=t,this.pixels=r,this.transferFn="raw",this.inverse=!1;var h=t.gl,u=h.createTexture();if(h.bindTexture(h.TEXTURE_2D,u),h.texImage2D(h.TEXTURE_2D,0,n,o,a,0,n,s,r),s===h.FLOAT){var c=h.getExtension("OES_texture_float_linear"),d=c?h.LINEAR:h.NEAREST;h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,d),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,d)}else h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this.texture=u,this.width=o,this.height=a,this.computeMinMax(r),t.requestFrame()};return r.prototype.computeMinMax=function(t){for(var e=Number.MIN_VALUE,i=Number.MAX_VALUE,r=1;r<t.length;r++){var n=t[r];isNaN(n)||(e<n&&(e=n),i>n&&(i=n))}this.min=i,this.max=e,this.tmax=e,this.tmin=i},r.prototype.updateColormap=function(r,n,s){var o=this.renderContext.gl;"raw"!==r?(this.fragmentCode=e,this.updateUniforms=i,this.colormapTex&&o.deleteTexture(this.colormapTex),this.colormapTex=t.generateColormap(o,r,n,s)):(this.fragmentCode=null,this.updateUniforms=null),this.transferFn=r,this.inverse=s},r.prototype.dispose=function(){var t=this.renderContext.gl;this.colormapTex&&t.deleteTexture(this.colormapTex),this.texture&&t.deleteTexture(this.texture),this.colormapTex=null,this.texture=null},r}),function(){var t,e,i,r,n,s,o,a,l,h,u,c,d,p,f,g=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},m={}.hasOwnProperty,v=function(t,e){function i(){this.constructor=t}for(var r in e)m.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},y=[].slice,b=function(t,e){return function(){return t.apply(e,arguments)}};null==this.astro&&(this.astro={}),n={},n.version="0.2.3",this.astro.FITS=n,f=["included","extended"],c=function(){function t(){}return t.include=function(t){var e,i,r;if(!t)throw"include(obj) requires obj";
for(e in t)i=t[e],g.call(f,e)<0&&(this.prototype[e]=i);return null!=(r=t.included)&&r.apply(this),this},t.extend=function(t){var e,i,r;if(!t)throw"extend(obj) requires obj";for(e in t)i=t[e],g.call(f,e)<0&&(this[e]=i);return null!=(r=t.extended)&&r.apply(this),this},t.proxy=function(t){var e=this;return function(){return t.apply(e,arguments)}},t.prototype.proxy=function(t){var e=this;return function(){return t.apply(e,arguments)}},t}(),this.astro.FITS.Module=c,i=function(t){function e(t,e){this.view=t,this.begin=this.current=t.tell(),this.length=void 0}return v(e,t),e}(c),this.astro.FITS.DataUnit=i,l={verifyOrder:function(t,e){if(e!==this.cardIndex)return console.warn(""+t+" should appear at index "+this.cardIndex+" in the FITS header")},verifyBetween:function(t,e,i,r){if(!(e>=i&&e<=r))throw"The "+t+" value of "+e+" is not between "+i+" and "+r},verifyBoolean:function(t){return"T"===t},Functions:{SIMPLE:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e=arguments[0],this.primary=!0,this.verifyOrder("SIMPLE",0),this.verifyBoolean(e)},XTENSION:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e=arguments[0],this.extension=!0,this.extensionType=e,this.verifyOrder("XTENSION",0),e},BITPIX:function(){var t,e,i;if(t=1<=arguments.length?y.call(arguments,0):[],e="BITPIX",i=parseInt(arguments[0]),this.verifyOrder(e,1),8!==i&&16!==i&&32!==i&&64!==i&&i!==-32&&i!==-64)throw""+e+" value "+i+" is not permitted";return i},NAXIS:function(){var t,e,i,r,n,s;if(t=1<=arguments.length?y.call(arguments,0):[],i="NAXIS",n=parseInt(arguments[0]),e=arguments[1],!e&&(this.verifyOrder(i,2),this.verifyBetween(i,n,0,999),this.isExtension()&&("TABLE"===(s=this.extensionType)||"BINTABLE"===s)&&(r=2,n!==r)))throw""+i+" must be "+r+" for TABLE and BINTABLE extensions";return n},PCOUNT:function(){var t,e,i,r,n,s;if(t=1<=arguments.length?y.call(arguments,0):[],e="PCOUNT",n=parseInt(arguments[0]),i=3+this.NAXIS,this.verifyOrder(e,i),this.isExtension()&&("IMAGE"===(s=this.extensionType)||"TABLE"===s)&&(r=0,n!==r))throw""+e+" must be "+r+" for the "+this.extensionType+" extensions";return n},GCOUNT:function(){var t,e,i,r,n,s;if(t=1<=arguments.length?y.call(arguments,0):[],e="GCOUNT",n=parseInt(arguments[0]),i=3+this.NAXIS+1,this.verifyOrder(e,i),this.isExtension()&&("IMAGE"===(s=this.extensionType)||"TABLE"===s||"BINTABLE"===s)&&(r=1,n!==r))throw""+e+" must be "+r+" for the "+this.extensionType+" extensions";return n},EXTEND:function(){var t,e,i;if(t=1<=arguments.length?y.call(arguments,0):[],e="EXTEND",i=arguments[0],!this.isPrimary())throw""+e+" must only appear in the primary header";return this.verifyBoolean(i)},BSCALE:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},BZERO:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},BLANK:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="BLANK",i=arguments[0],parseInt(i)},DATAMIN:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},DATAMAX:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},EXTVER:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="EXTVER",i=arguments[0],i=parseInt(i)},EXTLEVEL:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="EXTLEVEL",i=arguments[0],i=parseInt(i)},TFIELDS:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="TFIELDS",i=arguments[0],i=parseInt(i),this.verifyBetween(e,i,0,999),i},TBCOL:function(){var t,e,i,r;return t=1<=arguments.length?y.call(arguments,0):[],i="TBCOL",r=arguments[0],e=arguments[2],this.verifyBetween(i,e,0,this.TFIELDS),r},ZIMAGE:function(){var t,e,i;return t=1<=arguments.length?y.call(arguments,0):[],e="ZIMAGE",i=arguments[0],this.verifyBoolean(i)},ZCMPTYPE:function(){var t,e,i;if(t=1<=arguments.length?y.call(arguments,0):[],e="ZCMPTYPE",i=arguments[0],"GZIP_1"!==i&&"RICE_1"!==i&&"PLIO_1"!==i&&"HCOMPRESS_1"!==i)throw""+e+" value "+i+" is not permitted";if("RICE_1"!==i&&"GZIP_1"!==i)throw"Compress type "+i+" is not yet implement";return i},ZBITPIX:function(){var t,e,i;if(t=1<=arguments.length?y.call(arguments,0):[],e="ZBITPIX",i=parseInt(arguments[0]),8!==i&&16!==i&&32!==i&&64!==i&&i!==-32&&i!==-64)throw""+e+" value "+i+" is not permitted";return i},ZNAXIS:function(){var t,e,i,r;return t=1<=arguments.length?y.call(arguments,0):[],i="ZNAXIS",r=parseInt(arguments[0]),e=arguments[1],r=r,e||this.verifyBetween(i,r,0,999),r},ZTILE:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e="ZTILE",parseInt(arguments[0])},ZSIMPLE:function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],"T"===arguments[0]},ZPCOUNT:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e="ZPCOUNT",parseInt(arguments[0])},ZGCOUNT:function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e="ZGCOUNT",parseInt(arguments[0])}}},this.astro.FITS.HeaderVerify=l,a=function(t){function e(){this.init=b(this.init,this);var t,e,i;this.primary=!1,this.extension=!1,this.verifyCard={},i=this.Functions;for(e in i)t=i[e],this.verifyCard[e]=this.proxy(t);this.cards={},this.cardIndex=0}return v(e,t),e.keywordPattern=/^([A-Z0-9_-]+)\s*=\s*(.*)/,e.nonStringPattern=/([^\/]*)\s*\/*(.*)/,e.stringPattern=/'(.*)'\s*\/*(.*)/,e.arrayPattern=/([A-Za-z]+)(\d+)/,e.include(l),e.prototype.get=function(t){return this.contains(t)?this.cards[t]:console.warn("Header does not contain the key "+t)},e.prototype.getIndex=function(t){return this.contains(t)?this.cards[t][0]:console.warn("Header does not contain the key "+t)},e.prototype.getComment=function(t){return this.contains(t)?null!=this.cards[t][2]?this.cards[t][2]:console.warn(""+t+" does not contain a comment"):console.warn("Header does not contain the key "+t)},e.prototype.getComments=function(){return this.contains("COMMENT")?this.cards.COMMENT:console.warn("Header does not contain any COMMENT fields")},e.prototype.getHistory=function(){return this.contains("HISTORY")?this.cards.HISTORY:console.warn("Header does not contain any HISTORY fields")},e.prototype.set=function(t,e,i){return this.cards[t]=i?[this.cardIndex,e,i]:[this.cardIndex,e],this.cardIndex+=1},e.prototype.setComment=function(t){return this.contains("COMMENT")||(this.cards.COMMENT=[],this.cardIndex+=1),this.cards.COMMENT.push(t)},e.prototype.setHistory=function(t){return this.contains("HISTORY")||(this.cards.HISTORY=[],this.cardIndex+=1),this.cards.HISTORY.push(t)},e.prototype.contains=function(t){return this.cards.hasOwnProperty(t)},e.prototype.readCard=function(t){var i,r,n,s,o,a,l,h,u,c,d,p;if(a=t.match(e.keywordPattern),null!=a)switch(h=a.slice(1),s=h[0],l=h[1],"COMMENT"===s||"HISTORY"===s?a[1]=l.trim():"'"===l[0]?(a=l.match(e.stringPattern),a[1]=a[1].trim()):(a=l.match(e.nonStringPattern),a[1]="T"===(u=a[1][0])||"F"===u?a[1].trim():parseFloat(a[1])),a[2]=a[2].trim(),c=a.slice(1),l=c[0],r=c[1],o=s,d=[!1,void 0],i=d[0],n=d[1],a=s.match(e.arrayPattern),null!=a&&(o=a[1],p=[!0,a[2]],i=p[0],n=p[1]),this.verifyCard.hasOwnProperty(o)&&(l=this.verifyCard[o](l,i,n)),s){case"COMMENT":return this.setComment(l);case"HISTORY":return this.setHistory(l);default:return this.set(s,l,r),this.__defineGetter__(s,function(){return this.cards[s][1]})}},e.prototype.init=function(t){var e,i,r,n,s,o,a,l;for(r=80,s=t.length/r,n=600,s=s<n?s:n,l=[],e=o=0,a=s-1;0<=a?o<=a:o>=a;e=0<=a?++o:--o)i=t.slice(e*r,(e+1)*r),l.push(this.readCard(i));return l},e.prototype.hasDataUnit=function(){return 0!==this.NAXIS},e.prototype.isPrimary=function(){return this.primary},e.prototype.isExtension=function(){return this.extension},e}(c),this.astro.FITS.Header=a,u={initArray:function(t){return this.data=new t(this.width*this.height)},getExtremes:function(){var t,e,i,r,n,s;if(null!=this.min&&null!=this.max)return[this.min,this.max];for(t=this.data.length;t--;)if(r=this.data[t],!isNaN(r)){n=[r,r],i=n[0],e=n[1];break}for(;t--;)r=this.data[t],isNaN(r)||(r<i&&(i=r),r>e&&(e=r));return s=[i,e],this.min=s[0],this.max=s[1],[this.min,this.max]},getPixel:function(t,e){return this.data[e*this.width+t]}},this.astro.FITS.ImageUtils=u,h=function(t){function e(t,i){var r,n,s,o,a=this;for(e.__super__.constructor.apply(this,arguments),s=i.NAXIS,r=i.BITPIX,this.naxis=[],n=o=1;1<=s?o<=s:o>=s;n=1<=s?++o:--o)this.naxis.push(i["NAXIS"+n]);switch(this.width=i.NAXIS1,this.height=i.NAXIS2||1,this.bzero=i.BZERO||0,this.bscale=i.BSCALE||1,this.rowByteSize=this.width*Math.abs(r)/8,this.totalRowsRead=0,this.length=this.naxis.reduce(function(t,e){return t*e})*Math.abs(r)/8,this.data=void 0,this.frame=0,r){case 8:this.bscale%1===0?(this.arrayType=Uint8Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint8()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint8()});break;case 16:this.bscale%1===0?(this.arrayType=Int16Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getInt16()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getInt16()});break;case 32:this.bscale%1===0?(this.arrayType=Int32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint32()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint32()});break;case 64:this.arrayType=this.bscale%1===0?Int32Array:Float32Array,console.warn("Unusual behaviour with 64 bit integers."),this.accessor=function(){var t,e,i,r,n;return e=Math.abs(a.view.getInt32()),i=Math.abs(a.view.getInt32()),r=e%10,t=r?-1:1,e-=r,n=t*(e<<32|i),a.bzero+a.bscale*n};break;case-32:this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getFloat32()};break;case-64:this.arrayType=Float64Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getFloat64()};break;default:throw"Invalid BITPIX."}}return v(e,t),e.include(u),e.prototype.getRow=function(){var t,e,i;for(this.current=this.begin+this.totalRowsRead*this.rowByteSize,this.view.seek(this.current),t=e=0,i=this.width-1;0<=i?e<=i:e>=i;t=0<=i?++e:--e)this.data[this.width*this.rowsRead+t]=this.accessor();return this.rowsRead+=1,this.totalRowsRead+=1},e.prototype.getFrame=function(t){var e;for(this.frame=null!=t?t:this.frame,null==this.data&&this.initArray(this.arrayType),this.totalRowsRead=this.width*this.frame,this.rowsRead=0,e=this.height;e--;)this.getRow();return this.frame+=1,this.data},e.prototype.seek=function(t){return null==t&&(t=0),2===this.naxis.length?(this.totalRowsRead=0,this.frame=0):(this.totalRowsRead=this.height*t,this.frame=this.height/this.totalRowsRead-1)},e.prototype.isDataCube=function(){return this.naxis.length>2},e}(i),this.astro.FITS.Image=h,p=function(t){function e(t,i){this.getRow=b(this.getRow,this),e.__super__.constructor.apply(this,arguments),this.rowByteSize=i.NAXIS1,this.rows=i.NAXIS2,this.cols=i.TFIELDS,this.length=this.tableLength=this.rowByteSize*this.rows,this.rowsRead=0,this.columns=this.getColumnNames(i),this.accessors=[]}return v(e,t),e.dataAccessors={L:function(t){return 84===t.getInt8()},X:function(t){throw"Data type not yet implemented"},B:function(t){return t.getUint8()},I:function(t){return t.getInt16()},J:function(t){return t.getInt32()},K:function(t){var e,i,r,n,s;return i=Math.abs(t.getInt32()),r=Math.abs(t.getInt32()),n=i%10,e=n?-1:1,i-=n,s=e*(i<<32|r),console.warn("Something funky happens here when dealing with 64 bit integers.  Be wary!!!"),s},A:function(t){return t.getChar()},E:function(t){return t.getFloat32()},D:function(t){return t.getFloat64()},C:function(t){return[t.getFloat32(),t.getFloat32()]},M:function(t){return[t.getFloat64(),t.getFloat64()]}},e.prototype.getRow=function(t){var e,i,r,n,s;for(null==t&&(t=null),null!=t&&(this.rowsRead=t),this.current=this.begin+this.rowsRead*this.rowByteSize,this.view.seek(this.current),t={},s=this.accessors,i=r=0,n=s.length;r<n;i=++r)e=s[i],t[this.columns[i]]=e();return this.rowsRead+=1,t},e.prototype.getColumnNames=function(t){var e,i,r,n,s;for(e=[],i=n=1,s=this.cols;1<=s?n<=s:n>=s;i=1<=s?++n:--n){if(r="TTYPE"+i,!t.contains(r))return null;e.push(t[r])}return e},e}(i),this.astro.FITS.Tabular=p,d=function(t){function e(t,i){this.getRow=b(this.getRow,this);var r,n,s,o,a,l,h=this;for(e.__super__.constructor.apply(this,arguments),o=function(){var t,i,r,n,o;return o=s.slice(1),i=o[0],n=o[1],r=o[2],t=function(t){return e.dataAccessors[i](t)},h.accessors.push(t)},n=a=1,l=this.cols;1<=l?a<=l:a>=l;n=1<=l?++a:--a)r=i["TFORM"+n],s=r.match(e.formPattern),o()}return v(e,t),e.formPattern=/([AIFED])(\d+)\.*(\d+)*/,e.dataAccessors={A:function(t){return t.trim()},I:function(t){return parseInt(t)},F:function(t){return parseFloat(t)},E:function(t){return parseFloat(t)},D:function(t){return parseFloat(t)}},e.prototype.getRow=function(t){var e,i,r,n,s,o,a,l;for(null==t&&(t=null),null!=t&&(this.rowsRead=t),this.current=this.begin+this.rowsRead*this.rowByteSize,this.view.seek(this.current),r="",e=s=1,l=this.rowByteSize;1<=l?s<=l:s>=l;e=1<=l?++s:--s)r+=this.view.getChar();for(r=r.trim().split(/\s+/),t={},i=o=0,a=r.length;o<a;i=++o)n=r[i],t[this.columns[i]]=this.accessors[i](n);return this.rowsRead+=1,t},e}(p),this.astro.FITS.Table=d,t=function(t){function e(t,i){var r,n,s,o,a,l,h,u,c,d=this;for(e.__super__.constructor.apply(this,arguments),n=h=1,u=this.cols;1<=u?h<=u:h>=u;n=1<=u?++h:--h)s="TFORM"+n,l=i[s],a=l.match(e.arrayDescriptorPattern),null!=a?!function(){var t,i;return i=a[1],t=function(){var t,r,s,o;for(r=d.view.getInt32(),s=d.view.getInt32(),d.current=d.view.tell(),d.view.seek(d.begin+d.tableLength+s),t=[],n=o=1;1<=r?o<=r:o>=r;n=1<=r?++o:--o)t.push(e.dataAccessors[i](d.view));return d.view.seek(d.current),t},d.accessors.push(t)}():(a=l.match(e.dataTypePattern),c=a.slice(1),o=c[0],r=c[1],o=o?parseInt(o):0,0===o||1===o?!function(t){var i;return i=function(){var i;return i=e.dataAccessors[t](d.view)},d.accessors.push(i)}(r):!function(t,i){var r,s;return"X"===t?(s=Math.log(i)/Math.log(2),r=function(){var t,e,r,o,a,l,h,u;for(o=function(t){var e;for(e=[],n=128;n>=1;)e.push(t&n?1:0),n/=2;return e},a=[],n=l=1;1<=s?l<=s:l>=s;n=1<=s?++l:--l)for(r=d.view.getUint8(),e=o(r),h=0,u=e.length;h<u;h++)t=e[h],a.push(t);return a.slice(0,+(i-1)+1||9e9)}):r="A"===t?function(){var r,s;for(r="",n=s=1;1<=i?s<=i:s>=i;n=1<=i?++s:--s)r+=e.dataAccessors[t](d.view);return r.trim()}:function(){var r,s;for(r=[],n=s=1;1<=i?s<=i:s>=i;n=1<=i?++s:--s)r.push(e.dataAccessors[t](d.view));return r},d.accessors.push(r)}(r,o))}return v(e,t),e.dataTypePattern=/(\d*)([L|X|B|I|J|K|A|E|D|C|M])/,e.arrayDescriptorPattern=/[0,1]*P([L|X|B|I|J|K|A|E|D|C|M])\((\d*)\)/,e}(p),this.astro.FITS.BinaryTable=t,r={Rice:function(t,e,i,r,n,s){var o,a,l,h,u,c,d,p,f,g,m,v,y,b,x,_;for(a=1<<u,x=this.RiceSetup[r](t),u=x[0],c=x[1],g=x[2],b=x[3],v=new Uint8Array(256),y=8,_=[128,255],f=_[0],d=_[1];d>=0;){for(;d>=f;)v[d]=y,d-=1;f/=2,y-=1}for(v[0]=0,o=t[b],b+=1,m=8,d=0;d<s;){for(m-=u;m<0;)o=o<<8|t[b],b+=1,m+=8;if(h=(o>>m)-1,o&=(1<<m)-1,p=d+i,p>s&&(p=s),h<0)for(;d<p;)t[d]=g,d++;else if(h===c)for(;d<p;){for(f=a-m,l=o<<f,f-=8;f>=0;)o=t[b],b+=1,l|=o<<f,f-=8;m>0?(o=t[b],b+=1,l|=o>>-f,o&=(1<<m)-1):o=0,0===(1&l)?l>>=1:l=~(l>>1),t[d]=l+g,g=t[d],d++}else for(;d<p;){for(;0===o;)m+=8,o=t[b],b+=1;for(y=m-v[o],m-=y+1,o^=1<<m,m-=h;m<0;)o=o<<8|t[b],b+=1,m+=8;l=y<<h|o>>m,o&=(1<<m)-1,0===(1&l)?l>>=1:l=~(l>>1),n[d]=l+g,g=n[d],d++}}return n},RiceSetup:{1:function(t){var e,i,r,n;return n=0,e=3,i=6,r=t[n],n+=1,[e,i,r,n]},2:function(t){var e,i,r,n,s;return s=0,i=4,r=14,n=0,e=t[s],s+=1,n|=e<<8,e=t[s],s+=1,n|=e,[i,r,n,s]},4:function(t){var e,i,r,n,s;return s=0,i=5,r=25,n=0,e=t[s],s+=1,n|=e<<24,e=t[s],s+=1,n|=e<<16,e=t[s],s+=1,n|=e<<8,e=t[s],s+=1,n|=e,[i,r,n,s]}},gzip:function(t){throw"Not yet implemented"},plio:function(t,e){throw"Not yet implemented"},hcompress:function(t,e){throw"Not yet implemented"}},this.astro.FITS.Decompress=r,e=function(t){function e(t,i){var r,n,s,o,a,l;for(e.__super__.constructor.apply(this,arguments),this.length+=i.PCOUNT,this.zcmptype=i.ZCMPTYPE,this.zbitpix=i.ZBITPIX,this.znaxis=i.ZNAXIS,this.zblank=e.setValue(i,"ZBLANK",void 0),this.blank=e.setValue(i,"BLANK",void 0),this.ztile=[],r=a=1,l=this.znaxis;1<=l?a<=l:a>=l;r=1<=l?++a:--a)o=i.contains("ZTILE"+r)?i["ZTILE"+r]:1===r?i.ZNAXIS1:1,this.ztile.push(o);for(this.width=i.ZNAXIS1,this.height=i.ZNAXIS2||1,this.algorithmParameters={},r=1;;){if(n="ZNAME"+r,!i.contains(n))break;s="ZVAL"+r,this.algorithmParameters[i[n]]=i[s],r+=1}"RICE_1"===this.zcmptype&&this.setRiceDefaults(),this.zmaskcmp=e.setValue(i,"ZMASKCMP",void 0),this.zquantiz=e.setValue(i,"ZQUANTIZ","LINEAR_SCALING"),this.bzero=e.setValue(i,"BZERO",0),this.bscale=e.setValue(i,"BSCALE",1),this.defineColumnAccessors(i),this.defineGetRow()}return v(e,t),e.dataTypePattern=/(\d*)([L|X|B|I|J|K|A|E|D|C|M])/,e.arrayDescriptorPattern=/[0,1]*P([L|X|B|I|J|K|A|E|D|C|M])\((\d*)\)/,e.include(u),e.extend(r),e.typedArray={B:Uint8Array,I:Int16Array,J:Int32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint8Array,4:Int16Array,8:Int32Array},e.prototype.defineColumnAccessors=function(t){var i,r,n,s,o,a,l,h,u,c,d,p=this;for(this.columnNames={},d=[],n=h=1,u=this.cols;1<=u?h<=u:h>=u;n=1<=u?++h:--h){if(l=t["TFORM"+n],o=l.match(e.arrayDescriptorPattern),a=t["TTYPE"+n].toUpperCase(),this.columnNames[a]=n-1,i=null,null!=o)switch(r=o[1],a){case"COMPRESSED_DATA":!function(t){return i=function(){var i,r;return i=p._accessor(t),null==i?new Float32Array(p.ztile[0]):(r=new e.typedArray[p.algorithmParameters.BYTEPIX](p.ztile[0]),e.Rice(i,s,p.algorithmParameters.BLOCKSIZE,p.algorithmParameters.BYTEPIX,r,p.ztile[0]),r)}}(r);break;case"UNCOMPRESSED_DATA":!function(t){return i=p._accessor(t)}(r);break;case"GZIP_COMPRESSED_DATA":!function(t){return i=function(){var e,i,r,n,s;if(e=p._accessor(t),null!=e){for(e=new Float32Array(p.width),i=n=0,s=e.length;n<s;i=++n)r=e[i],e[i]=NaN;return e}return null}}(r);break;default:!function(t){return i=p._accessor(t)}(r)}else o=l.match(e.dataTypePattern),c=o.slice(1),s=c[0],r=c[1],s=null!=s?parseInt(s):0,0===s||1===s?!function(t){return i=function(){return e.dataAccessors[t](p.view)}}(r):!function(t,r){return i=function(){var i,s,o;for(i=new e.typedArray[r](t),n=s=0,o=t-1;0<=o?s<=o:s>=o;n=0<=o?++s:--s)i[n]=e.dataAccessors[r](p.view);return i}}(s,r);d.push(this.accessors.push(i))}return d},e.prototype.defineGetRow=function(){var t;return this.totalRowsRead=0,t=null!=this.zblank||null!=this.blank||this.columnNames.hasOwnProperty("ZBLANK"),this.getRow=t?this.getRowHasBlanks:this.getRowNoBlanks},e.prototype.setRiceDefaults=function(){if(this.algorithmParameters.hasOwnProperty("BLOCKSIZE")||(this.algorithmParameters.BLOCKSIZE=32),!this.algorithmParameters.hasOwnProperty("BYTEPIX"))return this.algorithmParameters.BYTEPIX=4},e.setValue=function(t,e,i){return t.contains(e)?t[e]:i},e.prototype.getRowHasBlanks=function(){var t,e,i,r,n,s,o,a,l,h;for(h=this._getRow(),e=h[0],t=h[1],n=h[2],o=h[3],i=a=0,l=e.length;a<l;i=++a)s=e[i],r=this.totalRowsRead*this.width+i,this.data[r]=s===t?NaN:o+n*s;return this.rowsRead+=1,this.totalRowsRead+=1},e.prototype.getRowNoBlanks=function(){var t,e,i,r,n,s,o,a,l,h;for(h=this._getRow(),e=h[0],t=h[1],n=h[2],o=h[3],i=a=0,l=e.length;a<l;i=++a)s=e[i],r=this.totalRowsRead*this.width+i,this.data[r]=o+n*s;return this.rowsRead+=1,this.totalRowsRead+=1},e.prototype.getFrame=function(){var t;for(null==this.data&&this.initArray(Float32Array),this.totalRowsRead=0,this.rowsRead=0,t=this.height;t--;)this.getRow();return this.data},e.prototype._accessor=function(t){var i,r,n,s,o,a,l;if(a=[this.view.getInt32(),this.view.getInt32()],n=a[0],s=a[1],0===n)return null;for(i=new e.typedArray[t](n),this.current=this.view.tell(),this.view.seek(this.begin+this.tableLength+s),r=o=0,l=n-1;0<=l?o<=l:o>=l;r=0<=l?++o:--o)i[r]=e.dataAccessors[t](this.view);return this.view.seek(this.current),i},e.prototype._getRow=function(){var t,e,i,r,n,s,o,a,l;for(this.current=this.begin+this.totalRowsRead*this.rowByteSize,this.view.seek(this.current),r=[],l=this.accessors,o=0,a=l.length;o<a;o++)t=l[o],r.push(t());return i=r[this.columnNames.COMPRESSED_DATA]||r[this.columnNames.UNCOMPRESSED_DATA]||r[this.columnNames.GZIP_COMPRESSED_DATA],e=r[this.columnNames.ZBLANK]||this.zblank,n=r[this.columnNames.ZSCALE]||this.bscale,s=r[this.columnNames.ZZERO]||this.bzero,[i,e,n,s]},e.subtractiveDither1=function(){throw"Not yet implemented"},e.linearScaling=function(){throw"Not yet implemented"},e}(p),this.astro.FITS.CompressedImage=e,o=function(){function t(t,e){this.header=t,this.data=e}return t.prototype.hasData=function(){return null!=this.data},t.prototype.getCard=function(t){return this.header[t]},t}(),this.astro.FITS.HDU=o,s=function(){function i(t){var e;switch(e=i.getType(t)){case"arraybuffer":this.initFromBuffer(t);break;case"object":this.initFromObject(t);break;default:throw"fitsjs cannot initialize object"}}return i.LINEWIDTH=80,i.BLOCKLENGTH=2880,i.getType=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},i.excessBytes=function(t){return(i.BLOCKLENGTH-t%i.BLOCKLENGTH)%i.BLOCKLENGTH},i.extendDataView=function(t){var e,i,r,n,s,o,a,l;return DataView.prototype.getString=function(t){var e,i,r,n,s;for(r="",i=n=0,s=t-1;0<=s?n<=s:n>=s;i=0<=s?++n:--n)e=this.getUint8(),r+=String.fromCharCode(e>127?65533:e);return r},DataView.prototype.getChar=function(){return this.getString(1)},t.offset=0,s=t.getInt8,l=t.getUint8,r=t.getInt16,o=t.getUint16,n=t.getInt32,a=t.getUint32,e=t.getFloat32,i=t.getFloat64,t.getInt8=function(){var t;return t=s.apply(this,[this.offset]),this.offset+=1,t},t.getUint8=function(){var t;return t=l.apply(this,[this.offset]),this.offset+=1,t},t.getInt16=function(){var t;return t=r.apply(this,[this.offset,!1]),this.offset+=2,t},t.getUint16=function(){var t;return t=o.apply(this,[this.offset,!1]),this.offset+=2,t},t.getInt32=function(){var t;return t=n.apply(this,[this.offset,!1]),this.offset+=4,t},t.getUint32=function(){var t;return t=a.apply(this,[this.offset,!1]),this.offset+=4,t},t.getFloat32=function(){var t;return t=e.apply(this,[this.offset,!1]),this.offset+=4,t},t.getFloat64=function(){var t;return t=i.apply(this,[this.offset,!1]),this.offset+=8,t},t.seek=function(t){return this.offset=t},t.tell=function(){return this.offset}},i.prototype.initFromBuffer=function(t){var e,r,n,s;for(this.length=t.byteLength,this.view=new DataView(t),this.hdus=[],this.eof=!1,i.extendDataView(this.view),s=[];;){if(n=this.readHeader(),e=this.readData(n),r=new o(n,e),this.hdus.push(r),this.eof)break;s.push(void 0)}return s},i.prototype.initFromObject=function(t){return this.length=t.length,this.view=null,this.hdus=t.hdus,this.eof=!0},i.prototype.readHeader=function(){var t,e,r,n,s,o,l,h,u,c,d,p;for(p=/\s{80}/,o=/^END\s/,t=this.view.tell(),r=!1;;){if(r)break;for(e=this.view.getString(i.BLOCKLENGTH),h=0;;){if(d=i.BLOCKLENGTH-i.LINEWIDTH*(h+1),n=i.BLOCKLENGTH-i.LINEWIDTH*h,u=e.slice(d,n),c=u.match(p),!c){if(c=u.match(o))return s=this.view.tell(),this.view.seek(t),e=this.view.getString(s-t),l=new a,l.init(e),r=!0,this.checkEOF(),l;break}h+=1}}},i.prototype.readData=function(r){var n,s;if(r.hasDataUnit())return r.isPrimary()?n=new h(this.view,r):r.isExtension()&&("BINTABLE"===r.extensionType?n=r.contains("ZIMAGE")?new e(this.view,r):new t(this.view,r):"TABLE"===r.extensionType?n=new d(this.view,r):"IMAGE"===r.extensionType&&(n=new h(this.view,r))),s=i.excessBytes(n.length),this.view.seek(this.view.tell()+n.length+s),this.checkEOF(),n},i.prototype.checkEOF=function(){if(this.view.offset>=this.length)return this.eof=!0},i.prototype.count=function(){return this.hdus.length},i.prototype.getHDU=function(t){var e,i,r,n;if(null==t&&(t=void 0),null!=t&&null!=this.hdus[t])return this.hdus[t];for(n=this.hdus,i=0,r=n.length;i<r;i++)if(e=n[i],e.hasData())return e},i.prototype.getHeader=function(t){return null==t&&(t=void 0),this.getHDU(t).header},i.prototype.getDataUnit=function(t){return null==t&&(t=void 0),this.getHDU(t).data},i.prototype.getData=function(t){return null==t&&(t=void 0),this.getHDU(t).data.getFrame()},i}(),this.astro.FITS.File=s}.call(this),r("fits",function(){}),r("Layer/FitsLoader",["fits"],function(){function t(t){var e,i=astro.FITS,r=new i.File(t),n=r.getHDU(),s=n.data,o=new Uint8Array(s.view.buffer,s.begin,s.length);e=s.arrayType?s.arrayType.BYTES_PER_ELEMENT:Math.abs(n.header.BITPIX)/8;for(var a=0;a<o.length;a+=e)for(var l,h=0;h<e/2;h++)l=o[a+h],o[a+h]=o[a+e-1-h],o[a+e-1-h]=l;return r}var e=function(e,i,r,n){var s=new XMLHttpRequest;return s.onreadystatechange=function(n){if(4===s.readyState)if(200===s.status){if(s.response){var o=t(s.response);i&&i(o)}}else console.log("Error while loading "+e),r&&r()},s.onprogress=function(t){},s.open("GET",e),s.responseType="arraybuffer",s.send(),s};return{loadFits:e,parseFits:t}}),function(){"use strict";function t(t,e){var i=t.split("."),r=g;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(var n;i.length&&(n=i.shift());)i.length||e===p?r=r[n]?r[n]:r[n]={}:r[n]=e}function e(t,e){if(this.index="number"==typeof e?e:0,this.f=0,this.buffer=t instanceof(m?Uint8Array:Array)?t:new(m?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&i(this)}function i(t){var e,i=t.buffer,r=i.length,n=new(m?Uint8Array:Array)(r<<1);if(m)n.set(i);else for(e=0;e<r;++e)n[e]=i[e];return t.buffer=n}function r(t,e,i){var r,n="number"==typeof e?e:e=0,s="number"==typeof i?i:t.length;for(r=-1,n=7&s;n--;++e)r=r>>>8^T[255&(r^t[e])];for(n=s>>3;n--;e+=8)r=r>>>8^T[255&(r^t[e])],r=r>>>8^T[255&(r^t[e+1])],r=r>>>8^T[255&(r^t[e+2])],r=r>>>8^T[255&(r^t[e+3])],r=r>>>8^T[255&(r^t[e+4])],r=r>>>8^T[255&(r^t[e+5])],r=r>>>8^T[255&(r^t[e+6])],r=r>>>8^T[255&(r^t[e+7])];return(4294967295^r)>>>0}function n(t){this.buffer=new(m?Uint16Array:Array)(2*t),this.length=0}function s(t,e){this.h=I,this.j=0,this.input=m&&t instanceof Array?new Uint8Array(t):t,this.c=0,e&&(e.lazy&&(this.j=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=m&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.c=e.outputIndex)),this.a||(this.a=new(m?Uint8Array:Array)(32768))}function o(t,e){this.length=t,this.k=e}function a(t,e){function i(t,e){var i,r=t.k,n=[],s=0;i=k[t.length],n[s++]=65535&i,n[s++]=i>>16&255,n[s++]=i>>24;var o;switch(f){case 1===r:o=[0,r-1,0];break;case 2===r:o=[1,r-2,0];break;case 3===r:o=[2,r-3,0];break;case 4===r:o=[3,r-4,0];break;case 6>=r:o=[4,r-5,1];break;case 8>=r:o=[5,r-7,1];break;case 12>=r:o=[6,r-9,2];break;case 16>=r:o=[7,r-13,2];break;case 24>=r:o=[8,r-17,3];break;case 32>=r:o=[9,r-25,3];break;case 48>=r:o=[10,r-33,4];break;case 64>=r:o=[11,r-49,4];break;case 96>=r:o=[12,r-65,5];break;case 128>=r:o=[13,r-97,5];break;case 192>=r:o=[14,r-129,6];break;case 256>=r:o=[15,r-193,6];break;case 384>=r:o=[16,r-257,7];break;case 512>=r:o=[17,r-385,7];break;case 768>=r:o=[18,r-513,8];break;case 1024>=r:o=[19,r-769,8];break;case 1536>=r:o=[20,r-1025,9];break;case 2048>=r:o=[21,r-1537,9];break;case 3072>=r:o=[22,r-2049,10];break;case 4096>=r:o=[23,r-3073,10];break;case 6144>=r:o=[24,r-4097,11];break;case 8192>=r:o=[25,r-6145,11];break;case 12288>=r:o=[26,r-8193,12];break;case 16384>=r:o=[27,r-12289,12];break;case 24576>=r:o=[28,r-16385,13];break;case 32768>=r:o=[29,r-24577,13];break;default:throw"invalid distance"}i=o,n[s++]=i[0],n[s++]=i[1],n[s++]=i[2];var a,l;for(a=0,l=n.length;a<l;++a)v[y++]=n[a];x[n[0]]++,_[n[3]]++,b=t.length+e-1,c=null}var r,n,s,o,a,h,u,c,d,g={},v=m?new Uint16Array(2*e.length):[],y=0,b=0,x=new(m?Uint32Array:Array)(286),_=new(m?Uint32Array:Array)(30),w=t.j;if(!m){for(s=0;285>=s;)x[s++]=0;for(s=0;29>=s;)_[s++]=0}for(x[256]=1,r=0,n=e.length;r<n;++r){for(s=a=0,o=3;s<o&&r+s!==n;++s)a=a<<8|e[r+s];if(g[a]===p&&(g[a]=[]),h=g[a],!(0<b--)){for(;0<h.length&&32768<r-h[0];)h.shift();if(r+3>=n){for(c&&i(c,-1),s=0,o=n-r;s<o;++s)d=e[r+s],v[y++]=d,++x[d];break}0<h.length?(u=l(e,r,h),c?c.length<u.length?(d=e[r-1],v[y++]=d,++x[d],i(u,0)):i(c,-1):u.length<w?c=u:i(u,0)):c?i(c,-1):(d=e[r],v[y++]=d,++x[d])}h.push(r)}return v[y++]=256,x[256]++,t.n=x,t.m=_,m?v.subarray(0,y):v}function l(t,e,i){var r,n,s,a,l,h,u=0,c=t.length;a=0,h=i.length;t:for(;a<h;a++){if(r=i[h-a-1],s=3,3<u){for(l=u;3<l;l--)if(t[r+l-1]!==t[e+l-1])continue t;s=u}for(;258>s&&e+s<c&&t[r+s]===t[e+s];)++s;if(s>u&&(n=r,u=s),258===s)break}return new o(u,e-n)}function h(t,e){var i,r,s,o,a,l=t.length,h=new n(572),c=new(m?Uint8Array:Array)(l);if(!m)for(o=0;o<l;o++)c[o]=0;for(o=0;o<l;++o)0<t[o]&&h.push(o,t[o]);if(i=Array(h.length/2),r=new(m?Uint32Array:Array)(h.length/2),1===i.length)return c[h.pop().index]=1,c;for(o=0,a=h.length/2;o<a;++o)i[o]=h.pop(),r[o]=i[o].value;for(s=u(r,r.length,e),o=0,a=i.length;o<a;++o)c[i[o].index]=s[o];return c}function u(t,e,i){function r(t){var i=p[t][f[t]];i===e?(r(t+1),r(t+1)):--c[i],++f[t]}var n,s,o,a,l,h=new(m?Uint16Array:Array)(i),u=new(m?Uint8Array:Array)(i),c=new(m?Uint8Array:Array)(e),d=Array(i),p=Array(i),f=Array(i),g=(1<<i)-e,v=1<<i-1;for(h[i-1]=e,s=0;s<i;++s)g<v?u[s]=0:(u[s]=1,g-=v),g<<=1,h[i-2-s]=(h[i-1-s]/2|0)+e;for(h[0]=u[0],d[0]=Array(h[0]),p[0]=Array(h[0]),s=1;s<i;++s)h[s]>2*h[s-1]+u[s]&&(h[s]=2*h[s-1]+u[s]),d[s]=Array(h[s]),p[s]=Array(h[s]);for(n=0;n<e;++n)c[n]=i;for(o=0;o<h[i-1];++o)d[i-1][o]=t[o],p[i-1][o]=o;for(n=0;n<i;++n)f[n]=0;for(1===u[i-1]&&(--c[0],++f[i-1]),s=i-2;0<=s;--s){for(a=n=0,l=f[s+1],o=0;o<h[s];o++)a=d[s+1][l]+d[s+1][l+1],a>t[n]?(d[s][o]=a,p[s][o]=e,l+=2):(d[s][o]=t[n],p[s][o]=n,++n);f[s]=0,1===u[s]&&r(s)}return c}function c(t){var e,i,r,n,s=new(m?Uint16Array:Array)(t.length),o=[],a=[],l=0;for(e=0,i=t.length;e<i;e++)o[t[e]]=(0|o[t[e]])+1;for(e=1,i=16;e<=i;e++)a[e]=l,l+=0|o[e],l<<=1;for(e=0,i=t.length;e<i;e++)for(l=a[t[e]],a[t[e]]+=1,r=s[e]=0,n=t[e];r<n;r++)s[e]=s[e]<<1|1&l,l>>>=1;return s}function d(t,e){this.input=t,this.c=this.i=0,this.d={},e&&(e.flags&&(this.d=e.flags),"string"==typeof e.filename&&(this.filename=e.filename),"string"==typeof e.comment&&(this.l=e.comment),e.deflateOptions&&(this.e=e.deflateOptions)),this.e||(this.e={})}var p=void 0,f=!0,g=this,m="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;e.prototype.b=function(t,e,r){var n,s=this.buffer,o=this.index,a=this.f,l=s[o];if(r&&1<e&&(t=8<e?(w[255&t]<<24|w[t>>>8&255]<<16|w[t>>>16&255]<<8|w[t>>>24&255])>>32-e:w[t]>>8-e),8>e+a)l=l<<e|t,a+=e;else for(n=0;n<e;++n)l=l<<1|t>>e-n-1&1,8===++a&&(a=0,s[o++]=w[l],l=0,o===s.length&&(s=i(this)));s[o]=l,this.buffer=s,this.f=a,this.index=o},e.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.f&&(e[i]<<=8-this.f,e[i]=w[e[i]],i++),m?t=e.subarray(0,i):(e.length=i,t=e),t};var v,y=new(m?Uint8Array:Array)(256);for(v=0;256>v;++v){for(var b=v,x=b,_=7,b=b>>>1;b;b>>>=1)x<<=1,x|=1&b,--_;y[v]=(x<<_&255)>>>0}var w=y,C=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],T=m?new Uint32Array(C):C;
n.prototype.getParent=function(t){return 2*((t-2)/4|0)},n.prototype.push=function(t,e){var i,r,n,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;0<i&&(r=this.getParent(i),s[i]>s[r]);)n=s[i],s[i]=s[r],s[r]=n,n=s[i+1],s[i+1]=s[r+1],s[r+1]=n,i=r;return this.length},n.prototype.pop=function(){var t,e,i,r,n,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],n=0;(r=2*n+2,!(r>=this.length))&&(r+2<this.length&&s[r+2]>s[r]&&(r+=2),s[r]>s[n]);)i=s[n],s[n]=s[r],s[r]=i,i=s[n+1],s[n+1]=s[r+1],s[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var A,I=2,S=[];for(A=0;288>A;A++)switch(f){case 143>=A:S.push([A+48,8]);break;case 255>=A:S.push([A-144+400,9]);break;case 279>=A:S.push([A-256+0,7]);break;case 287>=A:S.push([A-280+192,8]);break;default:throw"invalid literal: "+A}s.prototype.g=function(){var t,i,r,n,s=this.input;switch(this.h){case 0:for(r=0,n=s.length;r<n;){i=m?s.subarray(r,r+65535):s.slice(r,r+65535),r+=i.length;var o=i,l=r===n,u=p,d=p,g=p,v=p,y=p,b=this.a,x=this.c;if(m){for(b=new Uint8Array(this.a.buffer);b.length<=x+o.length+5;)b=new Uint8Array(b.length<<1);b.set(this.a)}if(u=l?1:0,b[x++]=0|u,d=o.length,g=~d+65536&65535,b[x++]=255&d,b[x++]=d>>>8&255,b[x++]=255&g,b[x++]=g>>>8&255,m)b.set(o,x),x+=o.length,b=b.subarray(0,x);else{for(v=0,y=o.length;v<y;++v)b[x++]=o[v];b.length=x}this.c=x,this.a=b}break;case 1:var _=new e(m?new Uint8Array(this.a.buffer):this.a,this.c);_.b(1,1,f),_.b(1,2,f);var w,C,T,A=a(this,s);for(w=0,C=A.length;w<C;w++)if(T=A[w],e.prototype.b.apply(_,S[T]),256<T)_.b(A[++w],A[++w],f),_.b(A[++w],5),_.b(A[++w],A[++w],f);else if(256===T)break;this.a=_.finish(),this.c=this.a.length;break;case I:var M,k,E,P,R,D,N,L,F,O,B,U,z,j,G,H=new e(m?new Uint8Array(this.a.buffer):this.a,this.c),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=Array(19);for(M=I,H.b(1,1,f),H.b(M,2,f),k=a(this,s),D=h(this.n,15),N=c(D),L=h(this.m,7),F=c(L),E=286;257<E&&0===D[E-1];E--);for(P=30;1<P&&0===L[P-1];P--);var V,q,X,Z,K,J,Q=E,$=P,tt=new(m?Uint32Array:Array)(Q+$),et=new(m?Uint32Array:Array)(316),it=new(m?Uint8Array:Array)(19);for(V=q=0;V<Q;V++)tt[q++]=D[V];for(V=0;V<$;V++)tt[q++]=L[V];if(!m)for(V=0,Z=it.length;V<Z;++V)it[V]=0;for(V=K=0,Z=tt.length;V<Z;V+=q){for(q=1;V+q<Z&&tt[V+q]===tt[V];++q);if(X=q,0===tt[V])if(3>X)for(;0<X--;)et[K++]=0,it[0]++;else for(;0<X;)J=138>X?X:138,J>X-3&&J<X&&(J=X-3),10>=J?(et[K++]=17,et[K++]=J-3,it[17]++):(et[K++]=18,et[K++]=J-11,it[18]++),X-=J;else if(et[K++]=tt[V],it[tt[V]]++,X--,3>X)for(;0<X--;)et[K++]=tt[V],it[tt[V]]++;else for(;0<X;)J=6>X?X:6,J>X-3&&J<X&&(J=X-3),et[K++]=16,et[K++]=J-3,it[16]++,X-=J}for(t=m?et.subarray(0,K):et.slice(0,K),O=h(it,7),j=0;19>j;j++)Y[j]=O[W[j]];for(R=19;4<R&&0===Y[R-1];R--);for(B=c(O),H.b(E-257,5,f),H.b(P-1,5,f),H.b(R-4,4,f),j=0;j<R;j++)H.b(Y[j],3,f);for(j=0,G=t.length;j<G;j++)if(U=t[j],H.b(B[U],O[U],f),16<=U){switch(j++,U){case 16:z=2;break;case 17:z=3;break;case 18:z=7;break;default:throw"invalid code: "+U}H.b(t[j],z,f)}var rt,nt,st,ot,at,lt,ht,ut,ct=[N,D],dt=[F,L];for(at=ct[0],lt=ct[1],ht=dt[0],ut=dt[1],rt=0,nt=k.length;rt<nt;++rt)if(st=k[rt],H.b(at[st],lt[st],f),256<st)H.b(k[++rt],k[++rt],f),ot=k[++rt],H.b(ht[ot],ut[ot],f),H.b(k[++rt],k[++rt],f);else if(256===st)break;this.a=H.finish(),this.c=this.a.length;break;default:throw"invalid compression type"}return this.a};var M=function(){function t(t){switch(f){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}var e,i,r=[];for(e=3;258>=e;e++)i=t(e),r[e]=i[2]<<24|i[1]<<16|i[0];return r}(),k=m?new Uint32Array(M):M;d.prototype.g=function(){var t,e,i,n,o,a,l,h,u=new(m?Uint8Array:Array)(32768),c=0,d=this.input,f=this.i,g=this.filename,v=this.l;if(u[c++]=31,u[c++]=139,u[c++]=8,t=0,this.d.fname&&(t|=R),this.d.fcomment&&(t|=D),this.d.fhcrc&&(t|=P),u[c++]=t,e=(Date.now?Date.now():+new Date)/1e3|0,u[c++]=255&e,u[c++]=e>>>8&255,u[c++]=e>>>16&255,u[c++]=e>>>24&255,u[c++]=0,u[c++]=E,this.d.fname!==p){for(l=0,h=g.length;l<h;++l)a=g.charCodeAt(l),255<a&&(u[c++]=a>>>8&255),u[c++]=255&a;u[c++]=0}if(this.d.comment){for(l=0,h=v.length;l<h;++l)a=v.charCodeAt(l),255<a&&(u[c++]=a>>>8&255),u[c++]=255&a;u[c++]=0}return this.d.fhcrc&&(i=65535&r(u,0,c),u[c++]=255&i,u[c++]=i>>>8&255),this.e.outputBuffer=u,this.e.outputIndex=c,o=new s(d,this.e),u=o.g(),c=o.c,m&&(c+8>u.buffer.byteLength?(this.a=new Uint8Array(c+8),this.a.set(new Uint8Array(u.buffer)),u=this.a):u=new Uint8Array(u.buffer)),n=r(d,p,p),u[c++]=255&n,u[c++]=n>>>8&255,u[c++]=n>>>16&255,u[c++]=n>>>24&255,h=d.length,u[c++]=255&h,u[c++]=h>>>8&255,u[c++]=h>>>16&255,u[c++]=h>>>24&255,this.i=f,m&&c<u.length&&(this.a=u=u.subarray(0,c)),u};var E=255,P=2,R=8,D=16;t("Zlib.Gzip",d),t("Zlib.Gzip.prototype.compress",d.prototype.g)}.call(this),r("gzip",function(){}),r("Layer/FitsRequest",["../Utils/ImageRequest"],function(t){t.prototype.send=function(t,e,i){var r=this;if(i)return void r.failCallback(r);if(t.search("fits")>0){var n=new XMLHttpRequest;n.onreadystatechange=function(e){n&&4===n.readyState&&(200===n.status?n.response&&(r.image=n.response,r.successCallback&&r.successCallback(r)):0!==n.status&&(console.log("Error while loading "+t),r.failCallback&&r.failCallback(r)),n=null)},n.onabort=function(t){r.abortCallback&&r.abortCallback(r),r.xhr=null},n.open("GET",t),n.responseType="arraybuffer",n.send(),this.xhr=n}else this.image=new Image,this.image.aborted=!1,this.image.crossOrigin="",this.image.dataType="byte",this.image.onload=function(){var t=0!==r.image.naturalWidth&&r.image.complete;t&&!this.aborted&&r.successCallback(r)},this.image.onerror=function(){r.failCallback&&!this.aborted&&r.failCallback(r)},this.image.src=t},t.prototype.abort=function(){this.xhr?this.xhr.abort():(this.abortCallback&&this.abortCallback(this),this.image.aborted=!0,this.image.src="")}}),r("Layer/HipsFitsLayer",["../Utils/Constants","../Utils/Utils","../Utils/Constants","../Tiling/HEALPixTiling","./AbstractHipsLayer","../Renderer/DynamicImage","./FitsLoader","gzip","../Utils/ImageRequest","./FitsRequest"],function(t,e,i,r,n,s,o,a,l){var h=function(t,e){n.prototype.constructor.call(this,t,e),this._ready=!1,this.fitsSupported=!0,this.levelZeroImage=null,this.rawFragShader="precision lowp float; \n",this.rawFragShader+="varying vec2 texCoord;\n",this.rawFragShader+="uniform sampler2D colorTexture; \n",this.rawFragShader+="uniform float opacity; \n",this.rawFragShader+="uniform float inversed; \n",this.rawFragShader+="bool isnan(float val) {\n",this.rawFragShader+="\t\treturn (val <= 0.0 || 0.0 <= val) ? ((val == 5e-324) ? true : false) : true;\n",this.rawFragShader+="}\n",this.rawFragShader+="void main(void)\n",this.rawFragShader+="{\n",this.rawFragShader+="\tvec4 color = texture2D(colorTexture, vec2(texCoord.x, (inversed == 1.) ? 1.0 - texCoord.y : texCoord.y));\n",this.rawFragShader+="\tgl_FragColor = vec4(color.r,color.g,color.b, color.a*opacity);\n",this.rawFragShader+="\tif (isnan( (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3. ) )\n",this.rawFragShader+="\t{\n",this.rawFragShader+="\t\tgl_FragColor.a = 0.;\n",this.rawFragShader+="\t}\n",this.rawFragShader+="}\n",this.colormapFragShader="precision lowp float; \n",this.colormapFragShader+="varying vec2 texCoord;\n",this.colormapFragShader+="uniform sampler2D colorTexture; \n",this.colormapFragShader+="uniform sampler2D colormap; \n",this.colormapFragShader+="uniform float min; \n",this.colormapFragShader+="uniform float max; \n",this.colormapFragShader+="uniform float opacity; \n",this.colormapFragShader+="bool isnan(float val) {\n",this.colormapFragShader+="\treturn (val <= 0.0 || 0.0 <= val) ? false : true;\n",this.colormapFragShader+="}\n",this.colormapFragShader+="void main(void)\n",this.colormapFragShader+="{\n",this.colormapFragShader+="\tfloat i = texture2D(colorTexture,vec2(texCoord.x, 1.0 - texCoord.y)).r;\n",this.colormapFragShader+="\tfloat d = clamp( ( i - min ) / (max - min), 0.0, 1.0 );\n",this.colormapFragShader+="\tvec4 cmValue = texture2D(colormap, vec2(d,0.));\n",this.colormapFragShader+="\tgl_FragColor = vec4(cmValue.r,cmValue.g,cmValue.b, cmValue.a*opacity);\n",this.colormapFragShader+="\tif (isnan( i ) )\n",this.colormapFragShader+="\t{\n",this.colormapFragShader+="\t\t gl_FragColor.a = 0.;\n",this.colormapFragShader+="\t}\n",this.colormapFragShader+="}\n";var i=this;this.customShader={fragmentCode:this.rawFragShader,updateUniforms:function(t,e){t.uniform1f(e.uniforms.inversed,i.inversed),i.levelZeroImage&&(t.uniform1f(e.uniforms.max,i.levelZeroImage.tmax),t.uniform1f(e.uniforms.min,i.levelZeroImage.tmin),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,i.levelZeroImage.colormapTex),t.uniform1i(e.uniforms.colormap,1),t.uniform1f(e.uniforms.opacity,i.getOpacity()))}},this.imageRequest=new l({successCallback:function(){var t,r;if(i._ready=!0,"fits"===i.format){try{t=new Uint8Array(i.imageRequest.image),r=a.unzip(t),i.imageRequest.image=new Uint8Array(r).buffer}catch(e){if("Not a GZIP file"!==e)return console.error(e),void this.failCallback();console.log("not gzipped"),t=null}i.handleImage(i.imageRequest);var n=i.imageRequest.image;if(i.globe){var o=i.globe.renderContext.gl;i.levelZeroImage=new s(i.globe.renderContext,n.typedArray,o.LUMINANCE,o.FLOAT,n.width,n.height),i.getLevelZeroTexture=function(){return i.levelZeroImage.texture}}}else i.levelZeroImage=this.image,i.getLevelZeroTexture=null;e.onready&&e.onready instanceof Function&&e.onready(i),i.globe&&i.globe.renderContext.requestFrame()},failCallback:function(){i.globe&&(i.globe.publishEvent("baseLayersError",i),i._ready=!1,console.log("Error while loading background"))},abortCallback:function(t){i._ready=!1,console.log("Background image request has been aborted")}})};return e.inherits(n,h),h.prototype._attach=function(t){n.prototype._attach.call(this,t);var e=this.globe.renderContext.gl;this.requestLevelZeroImage();var i=e.getExtension("OES_texture_float");i||(console.error("no OES_texture_float"),this.fitsSupported=!1)},h.prototype._detach=function(){this._ready||this.imageRequest.abort(),this._ready=!1,this.disposeResources(),n.prototype._detach.call(this)},h.prototype.getUrl=function(t){var e=this.baseUrl;return e+="/Norder",e+=t.order,e+="/Dir",e+=1e4*Math.floor(t.pixelIndex/1e4),e+="/Npix",e+=t.pixelIndex,e+="."+this.format},h.prototype.extractFitsData=function(t,e,i,r){for(var n,s=64,o=(this.levelZeroImage.height,this.levelZeroImage.width),a=this.levelZeroImage.pixels,l=s*o*(28-Math.floor(t/27))+t%27*s,h=0;h<s;h++)n=a.subarray(l+h*o,l+h*o+s),e.set(n,r+128*h+i)},h.prototype.generateLevel0Textures=function(t,e){var i,r,n,s,o,a,l;if("fits"!==this.format){var h=document.createElement("canvas");h.width=128,h.height=128;var u=h.getContext("2d");for(o=0;o<t.length;o++)a=t[o],r=4*a.pixelIndex,n=r%27*64,s=64*Math.floor(r/27),u.drawImage(this.levelZeroImage,n,s,64,64,0,0,64,64),r=4*a.pixelIndex+2,n=r%27*64,s=64*Math.floor(r/27),u.drawImage(this.levelZeroImage,n,s,64,64,64,0,64,64),r=4*a.pixelIndex+1,n=r%27*64,s=64*Math.floor(r/27),u.drawImage(this.levelZeroImage,n,s,64,64,0,64,64,64),r=4*a.pixelIndex+3,n=r%27*64,s=64*Math.floor(r/27),u.drawImage(this.levelZeroImage,n,s,64,64,64,64,64,64),l=u.getImageData(0,0,128,128),l.dataType="byte",a.texture=e.createGLTexture(l),a.imageSize=128}else for(o=0;o<t.length;o++)a=t[o],i=new Float32Array(16384),r=4*a.pixelIndex,this.extractFitsData(r,i,0,8192),r=4*a.pixelIndex+2,this.extractFitsData(r,i,64,8192),r=4*a.pixelIndex+1,this.extractFitsData(r,i,0,0),r=4*a.pixelIndex+3,this.extractFitsData(r,i,64,0),l={typedArray:i,width:128,height:128,dataType:"float"},a.texture=e.createGLTexture(l),a.imageSize=128},h.prototype.handleImage=function(t){if(!(t.image instanceof Image)){var e,i,r,n=o.parseFits(t.image),s=n.getHDU().data,a=s.arrayType.BYTES_PER_ELEMENT;if("Float64Array"===s.arrayType.name)for(i=new Float64Array(s.view.buffer,s.begin,s.length/a),e=new Float32Array(s.length/a),r=0;r<i.length;r++)e[r]=i[r];else e=new Float32Array(s.view.buffer,s.begin,s.length/a);t.image={typedArray:e,width:s.width,height:s.height,dataType:"float"}}},h.prototype.requestLevelZeroImage=function(){this.fitsSupported||(this.format="jpg"),this.customShader.fragmentCode=this.rawFragShader,"fits"===this.format?this.inversed=1:this.inversed=0;var t=this.baseUrl+"/Norder3/Allsky."+this.format;this.imageRequest.send(t)},h.prototype.disposeResources=function(){this.levelZeroImage&&this.levelZeroImage.dispose&&this.levelZeroImage.dispose(),this.levelZeroTexture&&this.globe.renderContext.gl.deleteTexture(this.levelZeroTexture),this.levelZeroImage=null,this.levelZeroTexture=null},h.prototype.setFormat=function(t){this.format=isFits?"fits":"jpg"},h}),r("Layer/HipsGraphicLayer",["../Utils/Utils","../Tiling/HEALPixTiling","./AbstractHipsLayer"],function(t,e,i){var r=function(t,e){i.prototype.constructor.call(this,t,e),this.levelZeroImage=new Image;var r=this;this.levelZeroImage.crossOrigin="",this.levelZeroImage.onload=function(){r._ready=!0,e.onready&&e.onready instanceof Function&&e.onready(r),r.globe&&r.globe.renderContext.requestFrame()},this.levelZeroImage.onerror=function(t){r.globe.publishEvent("baseLayersError",r),r._ready=!1,console.log("Cannot load "+r.levelZeroImage.src)},this._ready=!1};return t.inherits(i,r),r.prototype._attach=function(t){i.prototype._attach.call(this,t),this._overlay||(this.levelZeroImage.src=this.baseUrl+"/Norder3/Allsky."+this.format)},r.prototype.getUrl=function(t){var e=this.baseUrl;e+="/Norder",e+=t.order,e+="/Dir";var i=1e4*Math.floor(t.pixelIndex/1e4);return e+=i,e+="/Npix",e+=t.pixelIndex,e+="."+this.format},r.prototype.generateLevel0Textures=function(t,e){var i=document.createElement("canvas");i.width=128,i.height=128;var r,n,s,o,a,l=i.getContext("2d");for(r=0;r<t.length;r++){a=t[r],n=4*a.pixelIndex,s=n%27*64,o=64*Math.floor(n/27),l.drawImage(this.levelZeroImage,s,o,64,64,0,0,64,64),n=4*a.pixelIndex+2,s=n%27*64,o=64*Math.floor(n/27),l.drawImage(this.levelZeroImage,s,o,64,64,64,0,64,64),n=4*a.pixelIndex+1,s=n%27*64,o=64*Math.floor(n/27),l.drawImage(this.levelZeroImage,s,o,64,64,0,64,64,64),n=4*a.pixelIndex+3,s=n%27*64,o=64*Math.floor(n/27),l.drawImage(this.levelZeroImage,s,o,64,64,64,64,64,64);var h=l.getImageData(0,0,128,128);h.dataType="byte",a.texture=e.createGLTexture(h),a.imageSize=128}},r}),r("Layer/MocLayer",["jquery","./AbstractLayer","../Utils/Constants","../Renderer/FeatureStyle","../Utils/Utils","../Tiling/HEALPixBase","./FitsLoader"],function(t,e,i,r,n,s,o){var a=function(t){t.dataType=i.GEOMETRY.LineString,e.prototype.constructor.call(this,i.LAYER.Moc,t),this.serviceUrl=t.serviceUrl,this.startOrder=t.startOrder||2,t&&t.style?this.style=new r(t.style):this.style=new r,this.featuresSet=null};return n.inherits(e,a),a.prototype._attach=function(i){e.prototype._attach.call(this,i);var r,n=this;String(n.serviceUrl).endsWith(".fits")?o.loadFits(n.serviceUrl,function(t){var e={},i=t.getHDU(1).data;for(r=0;r<i.rows;r++){var o=i.getRow(r),a=s.uniq2hpix(o[i.columns[0]]),l=a[0];void 0===e[l]&&(e[l]=[]),e[l].push(a[1])}if(e.hasOwnProperty("0")||e.hasOwnProperty("1")||e.hasOwnProperty("2"))for(r=0;r<3;r++)if(e.hasOwnProperty(r)){var h=e[r];_.each(h,function(t){var i=s.getChildren(t);e.hasOwnProperty(r+1)||(e[r+1]=[]),e[r+1].push(i[0]),e[r+1].push(i[1]),e[r+1].push(i[2]),e[r+1].push(i[3])}),delete e[r]}n.moc=e,n.handleDistribution(e)}):t.ajax({type:"GET",url:n.serviceUrl,dataType:"json",success:function(t){n.handleDistribution(t)},error:function(e,i,r){t("#addLayer_"+n.id).find("label").css("color","red"),console.error(e.responseText)}}),i.tileManager.addPostRenderer(this)},a.prototype.generate=function(t){if(this.featuresSet&&t.order===this.startOrder){var e=this.featuresSet[t.pixelIndex];if(e)for(var i=0;i<e.length;i++)this.globe.vectorRendererManager.addGeometryToTile(this,e[i],this.style,t)}},a.prototype.render=function(){},a.prototype._detach=function(){for(var t in this.featuresSet)if(this.featuresSet.hasOwnProperty(t))for(var i=this.globe.tileManager.level0Tiles[t],r=0;r<this.featuresSet[t].length;r++)this.globe.vectorRendererManager.removeGeometryFromTile(this.featuresSet[t][r],i);this.featuresSet=null,this.globe.tileManager.removePostRenderer(this),e.prototype._detach.call(this)},a.prototype.findChildIndices=function(t,e){for(var i=this.startOrder,r=i-e,n=Math.pow(4,r),s=t*n,o=[],a=s;a<s+n;a++)o.push(a);return o},a.prototype.findParentIndex=function(t,e){var i=this.startOrder,r=e-i;return Math.floor(t/Math.pow(4,r))},a.prototype.handleDistribution=function(t){this.globe.tileManager.renderContext.gl;this.featuresSet={};var e,r,n,o;for(var a in t)if(t.hasOwnProperty(a)){var l=parseInt(a,10);for(r=0;r<t[a].length;r++){var h=t[a][r];if(l>this.startOrder)e=this.findParentIndex(h,l);else{if(l!==this.startOrder){var u=this.findChildIndices(h,l);void 0===t[this.startOrder.toString()]?t[this.startOrder.toString()]=t[0].concat(u):t[this.startOrder.toString()]=t[this.startOrder.toString()].concat(u);continue}e=h}var c={type:i.GEOMETRY.Polygon,gid:"moc"+this.id+"_"+l+"_"+h,coordinates:[[]]},d=2,p=1;l<5&&(d=5,p=1/(d-1));var f,g,m=Math.pow(2,l),v=h&m*m-1,y=s.compress_bits(v),b=s.compress_bits(v>>>1),x=h>>>2*l;for(n=0;n<2;n++)for(o=0;o<d;o++)f=s.fxyf((y+n*(d-1)*p)/m,(b+o*p)/m,x),g=this.globe.getCoordinateSystem().getWorldFrom3D(f),0===n?c.coordinates[0][2*n*d+(d-1)-o]=[g[0],g[1]]:c.coordinates[0][2*n*d+o]=[g[0],g[1]];for(o=0;o<2;o++)for(n=0;n<d;n++)f=s.fxyf((y+n*p)/m,(b+o*(d-1)*p)/m,x),g=this.globe.getCoordinateSystem().getWorldFrom3D(f),1===o?c.coordinates[0][d+2*o*d+(d-1)-n]=[g[0],g[1]]:c.coordinates[0][d+2*o*d+n]=[g[0],g[1]];var _=this.globe.tileManager.level0Tiles[e];this.featuresSet[e]||(this.featuresSet[e]=[]),this.featuresSet[e].push(c),this.globe.vectorRendererManager.addGeometryToTile(this,c,this.style,_)}}},a}),r("Renderer/VectorRendererManager",[],function(){var t=function(e){this.renderers=[];for(var i=0;i<t.factory.length;i++)this.renderers.push(t.factory[i](e));this.renderables=[],this.bucketId=0};t.factory=[],t.prototype.getRenderer=function(t,e){for(var i=0;i<this.renderers.length;i++)if(this.renderers[i].canApply(t.type,e))return this.renderers[i];return null},t.prototype.generate=function(t){var e;if(t.parent){var i=t.parent.extension.renderer;if(i)for(delete t.extension.renderer,e=0;e<i.renderables.length;e++){var r=i.renderables[e];r.generateChild&&r.generateChild(t)}}else for(e=0;e<this.renderers.length;e++)this.renderers[e].generateLevelZero(t)},t.prototype.addGeometry=function(t,e,i){var r=this.getRenderer(e,i);r?r.addGeometry(t,e,i):console.log("No renderer for VectorRendererManager")},t.prototype.removeGeometry=function(t,e){var i=t._bucket;return!(!i||i.layer!==e)&&(i.renderer.removeGeometry(t),!0)},t.prototype.addGeometryToTile=function(t,e,i,r){var n=this.getRenderer(e,i);n.addGeometryToTile(t,e,i,r)},t.prototype.removeGeometryFromTile=function(t,e){var i=t._bucket;i.renderer.removeGeometryFromTile(t,e)};var e=function(t,e){var i=t.bucket.style.zIndex-e.bucket.style.zIndex;return 0===i?t.bucket.id-e.bucket.id:i};return t.prototype.render=function(){var t,i;for(i=0;i<this.renderers.length;i++){var r=this.renderers[i].buckets;for(t=0;t<r.length;t++)r[t].layer.isVisible()&&r[t].mainRenderable&&this.renderables.push(r[t].mainRenderable)}for(this.renderables.sort(e),t=0;t<this.renderables.length;){i=t+1;for(var n=this.renderables[t].bucket.renderer;i<this.renderables.length&&this.renderables[i].bucket.renderer===n;)i++;n.render(this.renderables,t,i),t=i}this.renderables.length=0},t}),r("Layer/OpenSearchLayer",["../Renderer/FeatureStyle","../Renderer/VectorRendererManager","../Utils/Utils","./AbstractLayer","../Renderer/RendererTileData","../Tiling/Tile","../Utils/Constants"],function(t,e,i,r,n,s,o){function a(t,e){return t.tile.distance-e.tile.distance}var l=function(t){t.dataType=o.GEOMETRY.Point,r.prototype.constructor.call(this,o.LAYER.OpenSearch,t),this.serviceUrl=t.serviceUrl,this.minOrder=t.minOrder||5,this.maxRequests=t.maxRequests||2,this.requestProperties="",this.invertY=t.invertY||!1,this.coordSystemRequired=!t.hasOwnProperty("coordSystemRequired")||t.coordSystemRequired,this.extId="os",this.features=[],this.featuresSet={},this.freeRequests=[],this.tilesToLoad=[];for(var e=0;e<this.maxRequests;e++){var i=new XMLHttpRequest;this.freeRequests.push(i)}};i.inherits(r,l);var h=function(t,e,i){this.layer=t,this.parent=i,this.tile=e,this.featureIds=[],this.state=l.TileState.NOT_LOADED,this.complete=!1,this.childrenCreated=!1};return l.prototype._attach=function(t){r.prototype._attach.call(this,t),this.extId+=this.id,t.tileManager.addPostRenderer(this)},l.prototype._detach=function(){this.globe.tileManager.removePostRenderer(this),r.prototype._detach.call(this)},l.prototype.launchRequest=function(t,e){var i=t.extension[this.extId];if(0!==this.freeRequests.length){i.state=l.TileState.LOADING,""!==this.requestProperties&&(e+="&"+this.requestProperties),this.maxRequests===this.freeRequests.length&&this.globe.publishEvent("startLoad",this);var r=this.freeRequests.pop(),n=this;r.onreadystatechange=function(e){var s,o,a,h;if(4===r.readyState){if(200===r.status){for(a=JSON.parse(r.response),i.complete=a.totalResults===a.features.length,n.updateFeatures(a.features),s=a.features.length-1;s>=0;s--)o=a.features[s],o.hasOwnProperty("id")||(o.id=o.properties.identifier),h=n.featuresSet.hasOwnProperty(o.id),h&&a.features.splice(s,1),n.addFeature(o,t);n.globe.refresh()}else if(r.status>=400)return i.complete=!0,void console.error(r.responseText);i.state=l.TileState.LOADED,n.freeRequests.push(r),void 0!==a&&null!==a.features&&a.features.length>0&&n.globe.publishEvent("features:added",{layer:n,features:a.features}),n.maxRequests===n.freeRequests.length&&n.globe.publishEvent("endLoad",n)}},r.open("GET",e),r.send()}},l.prototype.setRequestProperties=function(t){for(var e in this.featuresSet)if(this.featuresSet.hasOwnProperty(e))for(var i=this.featuresSet[e],r=0;r<i.tiles.length;r++){var n=i.tiles[r],s=this.features[i.index];this.globe.vectorRendererManager.removeGeometryFromTile(this,s.geometry,n)}var o=this;this.globe.tileManager.visitTiles(function(t){t.extension[o.extId]&&(t.extension[o.extId].dispose(),t.extension[o.extId].featureIds=[],t.extension[o.extId].state=l.TileState.NOT_LOADED,t.extension[o.extId].complete=!1)}),this.featuresSet={},this.features=[],this.requestProperties="";for(var a in t)""!==this.requestProperties&&(this.requestProperties+="&"),this.requestProperties+=a+"="+t[a]},l.prototype.addFeature=function(t,e){var i,r=e.extension[this.extId];this.featuresSet.hasOwnProperty(t.id)?(i=this.featuresSet[t.id],i.tiles.push(e),t=this.features[i.index]):(this.features.push(t),i={index:this.features.length-1,tiles:[e]},this.featuresSet[t.properties.identifier]=i,this.featuresSet[t.id]=i),r.featureIds.push(t.id),t.geometry.gid=t.id;var n=t.properties.style?t.properties.style:this.style;this.globe.vectorRendererManager.addGeometryToTile(this,t.geometry,n,e)},l.prototype.removeFeature=function(t,e){var i=this.featuresSet[t];if(i){var r=i.tiles.indexOf(e);if(r>=0?i.tiles.splice(r,1):console.log("OpenSearchLayer internal error : tile not found when removing feature"),0===i.tiles.length){delete this.featuresSet[t];var n=this.features.pop();i.index<this.features.length&&(this.features[i.index]=n,this.featuresSet[n.id].index=i.index)}}},l.prototype.modifyFeatureStyle=function(t,e){t.properties.style=e;var i=this.featuresSet[t.id];if(i)for(var r=0;r<i.tiles.length;r++){var n=i.tiles[r];this.globe.vectorRendererManager.removeGeometryFromTile(t.geometry,n),this.globe.vectorRendererManager.addGeometryToTile(this,t.geometry,e,n)}},l.TileState={LOADING:0,LOADED:1,NOT_LOADED:2,INHERIT_PARENT:3},l.prototype.generate=function(t){t.order===this.minOrder&&(t.extension[this.extId]=new h(this,t,null))},h.prototype.traverse=function(t){if(this.layer.isVisible()&&t.state===s.State.LOADED&&(this.state===l.TileState.NOT_LOADED&&this.layer.tilesToLoad.push(this),this.state===l.TileState.LOADED&&!this.complete&&t.state===s.State.LOADED&&t.children&&!this.childrenCreated)){var e;for(e=0;e<4;e++)t.children[e].extension[this.layer.extId]||(t.children[e].extension[this.layer.extId]=new h(this.layer,t.children[e],this));this.childrenCreated=!0;var i=t.extension.renderer?t.extension.renderer.renderables:[];for(e=0;e<i.length;e++)i[e].bucket.layer===this.layer&&(i[e].hasChildren=!0)}},h.prototype.dispose=function(t,e){var i;if(this.parent&&this.parent.childrenCreated){this.parent.childrenCreated=!1;var r=this.parent.tile.extension.renderer?this.parent.tile.extension.renderer.renderables:[];for(i=0;i<r.length;i++)r[i].bucket.layer===this.layer&&(r[i].hasChildren=!1)}for(i=0;i<this.featureIds.length;i++)this.layer.removeFeature(this.featureIds[i],this.tile);this.tile=null,this.parent=null},l.prototype.buildUrl=function(t){var e=this.serviceUrl+"/search?order="+t.order+"&healpix="+t.pixelIndex;return this.coordSystemRequired&&(e+="&coordSystem=EQUATORIAL"),e+="&media=json"},l.prototype.render=function(t){if(this.isVisible()){this.tilesToLoad.sort(a);for(var e=0;e<this.tilesToLoad.length&&this.freeRequests.length>0;e++){var i=this.tilesToLoad[e].tile,r=this.buildUrl(i);r&&this.launchRequest(i,r)}this.tilesToLoad.length=0}},l.prototype.updateFeatures=function(t){for(var e=0;e<t.length;e++){var i=t[e];switch(i.geometry.type){case o.GEOMETRY.Point:i.geometry.coordinates[0]>180&&(i.geometry.coordinates[0]-=360);break;case o.GEOMETRY.Polygon:for(var r=i.geometry.coordinates[0],n=0;n<r.length;n++)r[n][0]>180&&(r[n][0]-=360)}}},l}),r("Services/FitsVisu",["jquery","../Renderer/FeatureStyle","../Renderer/DynamicImage","../Layer/FitsLoader","fits"],function(t,e,i,r){function n(t,e,i){t.xhr=r.loadFits(e,function(e){delete t.xhr;var r=e.getHDU().data;i&&i(t,e),s(r,t)}),h.publish("image:download",t)}function s(t,r){var n,s=new Float32Array(t.view.buffer,t.begin,t.length/4),o=h.getRenderContext().gl,a=new i(h.getRenderContext(),s,o.LUMINANCE,o.FLOAT,t.width,t.height),l=r.feature,u=r.layer;return n=new e(l.properties.style?l.properties.style:u.style),n.fillTexture=a.texture,n.uniformValues=a,n.fill=!0,u.modifyFeatureStyle(l,n),l.services&&(a.url=l.services.download.url),a}function o(t){return r.parseFits(t)}function a(t){t.xhr&&(t.xhr.abort(),delete t.xhr);var i=h.getRenderContext().gl;t.feature.properties.style.uniformValues&&t.feature.properties.style.uniformValues.dispose();var r=t.feature.properties.style.fillTexture;r&&i.deleteTexture(r);var n=new e(t.feature.properties.style);n.fillTexture=null,n.fill=!1,n.fillShader={fragmentCode:null,updateUniforms:null},delete n.uniformValues,t.layer.modifyFeatureStyle(t.feature,n)}var l,h;return{init:function(t,e){h=t,l=e.sitoolsBaseUrl;h.getRenderContext().gl.getExtension("OES_texture_float")},hideImage:function(t){var i=new e(t.feature.properties.style);i.fill=!1,t.layer.modifyFeatureStyle(t.feature,i)},showImage:function(t){var i=new e(t.feature.properties.style);i.fill=!0,t.layer.modifyFeatureStyle(t.feature,i)},removeImage:function(e){if(h.publish("image:remove",e),e.isFits)a(e),t("#quicklookFits").removeClass("selected");else{var i=e.feature.properties.style;i.fill=!1,i.fillTextureUrl=null,e.layer.modifyFeatureStyle(e.feature,i),t("#quicklook").removeClass("selected")}h.getActivatedContext().refresh()},addImage:function(i){var r=i.feature,n=new e(r.properties.style);if(n.fill=!0,h.publish("image:add",i),i.isFits){var s=l+"/proxy?external_url="+encodeURIComponent(r.services.download.url);this.computeFits(i,s),t("#quicklookFits").addClass("selected")}else n.fillTextureUrl=l+"/proxy?external_url="+r.properties.quicklook+"&rewrite_redirection=true",t("#quicklook").addClass("selected");i.layer.modifyFeatureStyle(r,n),h.getActivatedContext().refresh()},computeFits:n,handleFits:s,parseFits:o}}),r("Services/Triangle",[],function(){function t(t,e,i,r){var n=[],s=[],o=[],a=[],l=[];return vec3.cross(vec3.subtract(r,i,n),vec3.subtract(t,i,s),a),vec3.cross(n,vec3.subtract(e,i,o),l),vec3.dot(a,l)>=0}function e(e,i,r,n){return t(e,i,r,n)&&t(e,r,i,n)&&t(e,n,i,r)}var i=function(t,e,i){this.initA=t.slice(0),this.initB=e.slice(0),this.initC=i.slice(0),this.a=t,this.b=e,this.c=i,this.dragging=!1,this.hover=!1,this.halfWidth=Math.abs((i[0]-e[0])/2)};return i.prototype.reset=function(){this.a=this.initA.slice(0),this.b=this.initB.slice(0),this.c=this.initC.slice(0)},i.prototype.contains=function(t){return e(t,this.a,this.b,this.c)},i.prototype.draw=function(t,e){this.dragging?t.fillStyle="#FF0"|e.draggingColor:t.fillStyle="#F00"|e.noDraggingColor,t.beginPath(),t.moveTo(this.a[0],this.a[1]),t.lineTo(this.b[0],this.b[1]),t.lineTo(this.c[0],this.c[1]),t.closePath(),t.fill(),!this.dragging&&this.hover&&(t.strokeStyle="#FF0"|e.draggingColor,t.stroke())},i.prototype.modifyPosition=function(t){this.a[0]=t[0],this.b[0]=t[0]-this.halfWidth,this.c[0]=t[0]+this.halfWidth},i}),r("Services/HistogramCore",["./Triangle"],function(t){function e(){o=n.height-l,a=i+s>n.width?n.width:i+s,this.minThreshold=new t([s,o+1,0],[s-h,o+l-1,0],[s+h,o+l-1,0]),this.maxThreshold=new t([a,o+1,0],[a-h,o+l-1,0],[a+h,o+l-1,0])}var i,r,n,s,o,a,l,h;return{init:function(t){this.image=t.image,this.onUpdate=t.onUpdate,this.accuracy=t.accuracy||6,r=this,i=t.nbBins||256,l=t.paddingBottom||15,s=t.originX||5,h=t.triangleHalfWidth||5,n=document.getElementById(t.canvas),this.ctx=n.getContext("2d"),this.initThresholds()},initThresholds:e}}),function(t){"function"==typeof r&&r.amd?r("jquery.ui",["jquery"],t):t(jQuery)}(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function r(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,
shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,s)}function s(){t.datepicker._isDisabledDatepicker(m.inline?m.dpDiv.parent()[0]:m.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function o(e,i){t.extend(e,i);for(var r in i)null==i[r]&&(e[r]=i[r]);return e}function a(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var l=0,h=Array.prototype.slice;t.cleanData=function(e){return function(i){var r,n,s;for(s=0;null!=(n=i[s]);s++)try{r=t._data(n,"events"),r&&r.remove&&t(n).triggerHandler("remove")}catch(t){}e(i)}}(t.cleanData),t.widget=function(e,i,r){var n,s,o,a={},l=e.split(".")[0];e=e.split(".")[1];var h=l+"-"+e;return r||(r=i,i=t.Widget),t.isArray(r)&&(r=t.extend.apply(null,[{}].concat(r))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],s=t[l][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new s(t,e)},t.extend(s,n,{version:r.version,_proto:t.extend({},r),_childConstructors:[]}),o=new i,o.options=t.widget.extend({},o.options),t.each(r,function(e,r){return t.isFunction(r)?void(a[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,s=this._superApply;return this._super=t,this._superApply=n,e=r.apply(this,arguments),this._super=i,this._superApply=s,e}}()):void(a[e]=r)}),s.prototype=t.widget.extend(o,{widgetEventPrefix:n?o.widgetEventPrefix||e:e},a,{constructor:s,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var r=i.prototype;t.widget(r.namespace+"."+r.widgetName,s,i._proto)}),delete n._childConstructors):i._childConstructors.push(s),t.widget.bridge(e,s),s},t.widget.extend=function(e){for(var i,r,n=h.call(arguments,1),s=0,o=n.length;o>s;s++)for(i in n[s])r=n[s][i],n[s].hasOwnProperty(i)&&void 0!==r&&(e[i]=t.isPlainObject(r)?t.isPlainObject(e[i])?t.widget.extend({},e[i],r):t.widget.extend({},r):r);return e},t.widget.bridge=function(e,i){var r=i.prototype.widgetFullName||e;t.fn[e]=function(n){var s="string"==typeof n,o=h.call(arguments,1),a=this;return s?this.length||"instance"!==n?this.each(function(){var i,s=t.data(this,r);return"instance"===n?(a=s,!1):s?t.isFunction(s[n])&&"_"!==n.charAt(0)?(i=s[n].apply(s,o),i!==s&&void 0!==i?(a=i&&i.jquery?a.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):a=void 0:(o.length&&(n=t.widget.extend.apply(null,[n].concat(o))),this.each(function(){var e=t.data(this,r);e?(e.option(n||{}),e._init&&e._init()):t.data(this,r,new i(n,this))})),a}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var r,n,s,o=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(o={},r=e.split("."),e=r.shift(),r.length){for(n=o[e]=t.widget.extend({},this.options[e]),s=0;r.length-1>s;s++)n[r[s]]=n[r[s]]||{},n=n[r[s]];if(e=r.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];o[e]=i}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,r,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(r=t(n.get()),this._removeClass(n,i),r.addClass(this._classes({element:r,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,s){var o,a;for(a=0;i.length>a;a++)o=n.classesElementLookup[i[a]]||t(),o=t(e.add?t.unique(o.get().concat(e.element.get())):o.not(e.element).get()),n.classesElementLookup[i[a]]=o,r.push(i[a]),s&&e.classes[i[a]]&&r.push(e.classes[i[a]])}var r=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),r.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(r,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[r]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,r){r="boolean"==typeof r?r:i;var n="string"==typeof t||null===t,s={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:r};return s.element.toggleClass(this._classes(s),r),this},_on:function(e,i,r){var n,s=this;"boolean"!=typeof e&&(r=i,i=e,e=!1),r?(i=n=t(i),this.bindings=this.bindings.add(i)):(r=i,i=this.element,n=this.widget()),t.each(r,function(r,o){function a(){return e||s.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof o?s[o]:o).apply(s,arguments):void 0}"string"!=typeof o&&(a.guid=o.guid=o.guid||a.guid||t.guid++);var l=r.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+s.eventNamespace,u=l[2];u?n.on(h,u,a):i.on(h,a)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?r[t]:t).apply(r,arguments)}var r=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,r){var n,s,o=this.options[e];if(r=r||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],s=i.originalEvent)for(n in s)n in i||(i[n]=s[n]);return this.element.trigger(i,r),!(t.isFunction(o)&&o.apply(this.element[0],[i].concat(r))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(r,n,s){"string"==typeof n&&(n={effect:n});var o,a=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),o=!t.isEmptyObject(n),n.complete=s,n.delay&&r.delay(n.delay),o&&t.effects&&t.effects.effect[a]?r[e](n):a!==e&&r[a]?r[a](n.duration,n.easing,s):r.queue(function(i){t(this)[e](),s&&s.call(r[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(c.test(t[0])?e/100:1),parseFloat(t[1])*(c.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function r(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,s=Math.max,o=Math.abs,a=/left|center|right/,l=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,c=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,r=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=r.children()[0];return t("body").append(r),e=s.offsetWidth,r.css("overflow","scroll"),i=s.offsetWidth,e===i&&(i=r[0].clientWidth),r.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),r=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,s="scroll"===r||"auto"===r&&e.height<e.element[0].scrollHeight;return{width:s?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),r=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,s=!r&&!n;return{element:i,isWindow:r,isDocument:n,offset:s?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var c,p,f,g,m,v,y=t(n.of),b=t.position.getWithinInfo(n.within),x=t.position.getScrollInfo(b),_=(n.collision||"flip").split(" "),w={};return v=r(y),y[0].preventDefault&&(n.at="left top"),p=v.width,f=v.height,g=v.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=a.test(i[0])?i.concat(["center"]):l.test(i[0])?["center"].concat(i):["center","center"]),i[0]=a.test(i[0])?i[0]:"center",i[1]=l.test(i[1])?i[1]:"center",t=h.exec(i[0]),e=h.exec(i[1]),w[this]=[t?t[0]:0,e?e[0]:0],n[this]=[u.exec(i[0])[0],u.exec(i[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),c=e(w.at,p,f),m.left+=c[0],m.top+=c[1],this.each(function(){var r,a,l=t(this),h=l.outerWidth(),u=l.outerHeight(),d=i(this,"marginLeft"),v=i(this,"marginTop"),C=h+d+i(this,"marginRight")+x.width,T=u+v+i(this,"marginBottom")+x.height,A=t.extend({},m),I=e(w.my,l.outerWidth(),l.outerHeight());"right"===n.my[0]?A.left-=h:"center"===n.my[0]&&(A.left-=h/2),"bottom"===n.my[1]?A.top-=u:"center"===n.my[1]&&(A.top-=u/2),A.left+=I[0],A.top+=I[1],r={marginLeft:d,marginTop:v},t.each(["left","top"],function(e,i){t.ui.position[_[e]]&&t.ui.position[_[e]][i](A,{targetWidth:p,targetHeight:f,elemWidth:h,elemHeight:u,collisionPosition:r,collisionWidth:C,collisionHeight:T,offset:[c[0]+I[0],c[1]+I[1]],my:n.my,at:n.at,within:b,elem:l})}),n.using&&(a=function(t){var e=g.left-A.left,i=e+p-h,r=g.top-A.top,a=r+f-u,c={target:{element:y,left:g.left,top:g.top,width:p,height:f},element:{element:l,left:A.left,top:A.top,width:h,height:u},horizontal:0>i?"left":e>0?"right":"center",vertical:0>a?"top":r>0?"bottom":"middle"};h>p&&p>o(e+i)&&(c.horizontal="center"),u>f&&f>o(r+a)&&(c.vertical="middle"),c.important=s(o(e),o(i))>s(o(r),o(a))?"horizontal":"vertical",n.using.call(this,t,c)}),l.offset(t.extend(A,{using:a}))})},t.ui.position={fit:{left:function(t,e){var i,r=e.within,n=r.isWindow?r.scrollLeft:r.offset.left,o=r.width,a=t.left-e.collisionPosition.marginLeft,l=n-a,h=a+e.collisionWidth-o-n;e.collisionWidth>o?l>0&&0>=h?(i=t.left+l+e.collisionWidth-o-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+o-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=s(t.left-a,t.left)},top:function(t,e){var i,r=e.within,n=r.isWindow?r.scrollTop:r.offset.top,o=e.within.height,a=t.top-e.collisionPosition.marginTop,l=n-a,h=a+e.collisionHeight-o-n;e.collisionHeight>o?l>0&&0>=h?(i=t.top+l+e.collisionHeight-o-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+o-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=s(t.top-a,t.top)}},flip:{left:function(t,e){var i,r,n=e.within,s=n.offset.left+n.scrollLeft,a=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,u=h-l,c=h+e.collisionWidth-a-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>u?(i=t.left+d+p+f+e.collisionWidth-a-s,(0>i||o(u)>i)&&(t.left+=d+p+f)):c>0&&(r=t.left-e.collisionPosition.marginLeft+d+p+f-l,(r>0||c>o(r))&&(t.left+=d+p+f))},top:function(t,e){var i,r,n=e.within,s=n.offset.top+n.scrollTop,a=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,u=h-l,c=h+e.collisionHeight-a-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>u?(r=t.top+p+f+g+e.collisionHeight-a-s,(0>r||o(u)>r)&&(t.top+=p+f+g)):c>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,(i>0||c>o(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,r){return!!t.data(e,r[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var u="ui-effects-",c="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var r=c[e.type]||{};return null==t?i||!e.def?null:e.def:(t=r.floor?~~t:parseFloat(t),isNaN(t)?e.def:r.mod?(t+r.mod)%r.mod:0>t?0:t>r.max?r.max:t)}function r(i){var r=h(),n=r._rgba=[];return i=i.toLowerCase(),f(l,function(t,s){var o,a=s.re.exec(i),l=a&&s.parse(a),h=s.space||"rgba";return l?(o=r[h](l),r[u[h].cache]=o[u[h].cache],n=r._rgba=o._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,s.transparent),r):s[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var s,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",a=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],h=t.Color=function(e,i,r,n){return new t.Color.fn.parse(e,i,r,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),h.fn=t.extend(h.prototype,{parse:function(n,o,a,l){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(o),o=e);var c=this,d=t.type(n),p=this._rgba=[];return o!==e&&(n=[n,o,a,l],d="array"),"string"===d?this.parse(r(n)||s._default):"array"===d?(f(u.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof h?f(u,function(t,e){n[e.cache]&&(c[e.cache]=n[e.cache].slice())}):f(u,function(e,r){var s=r.cache;f(r.props,function(t,e){if(!c[s]&&r.to){if("alpha"===t||null==n[t])return;c[s]=r.to(c._rgba)}c[s][e.idx]=i(n[t],e,!0)}),c[s]&&0>t.inArray(null,c[s].slice(0,3))&&(c[s][3]=1,r.from&&(c._rgba=r.from(c[s])))}),this):e},is:function(t){var i=h(t),r=!0,n=this;return f(u,function(t,s){var o,a=i[s.cache];return a&&(o=n[s.cache]||s.to&&s.to(n._rgba)||[],f(s.props,function(t,i){return null!=a[i.idx]?r=a[i.idx]===o[i.idx]:e})),r}),r},_space:function(){var t=[],e=this;return f(u,function(i,r){e[r.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var r=h(t),n=r._space(),s=u[n],o=0===this.alpha()?h("transparent"):this,a=o[s.cache]||s.to(o._rgba),l=a.slice();return r=r[s.cache],f(s.props,function(t,n){var s=n.idx,o=a[s],h=r[s],u=c[n.type]||{};null!==h&&(null===o?l[s]=h:(u.mod&&(h-o>u.mod/2?o+=u.mod:o-h>u.mod/2&&(o-=u.mod)),l[s]=i((h-o)*e+o,n)))}),this[n](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),r=i.pop(),n=h(e)._rgba;return h(t.map(i,function(t,e){return(1-r)*n[e]+r*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),r=i.pop();return e&&i.push(~~(255*r)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,u.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,r=t[0]/255,n=t[1]/255,s=t[2]/255,o=t[3],a=Math.max(r,n,s),l=Math.min(r,n,s),h=a-l,u=a+l,c=.5*u;return e=l===a?0:r===a?60*(n-s)/h+360:n===a?60*(s-r)/h+120:60*(r-n)/h+240,i=0===h?0:.5>=c?h/u:h/(2-u),[Math.round(e)%360,i,c,null==o?1:o]},u.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],r=t[2],s=t[3],o=.5>=r?r*(1+i):r+i-r*i,a=2*r-o;return[Math.round(255*n(a,o,e+1/3)),Math.round(255*n(a,o,e)),Math.round(255*n(a,o,e-1/3)),s]},f(u,function(r,n){var s=n.props,o=n.cache,l=n.to,u=n.from;h.fn[r]=function(r){if(l&&!this[o]&&(this[o]=l(this._rgba)),r===e)return this[o].slice();var n,a=t.type(r),c="array"===a||"object"===a?r:arguments,d=this[o].slice();return f(s,function(t,e){var r=c["object"===a?t:e.idx];null==r&&(r=d[e.idx]),d[e.idx]=i(r,e)}),u?(n=h(u(d)),n[o]=d,n):h(d)},f(s,function(e,i){h.fn[e]||(h.fn[e]=function(n){var s,o=t.type(n),l="alpha"===e?this._hsla?"hsla":"rgba":r,h=this[l](),u=h[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=t.type(n)),null==n&&i.empty?this:("string"===o&&(s=a.exec(n),s&&(n=u+parseFloat(s[2])*("+"===s[1]?1:-1))),h[i.idx]=n,this[l](h)))})})}),h.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var s,o,a="";if("transparent"!==n&&("string"!==t.type(n)||(s=r(n)))){if(n=h(s||n),!d.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?e.parentNode:e;(""===a||"transparent"===a)&&o&&o.style;)try{a=t.css(o,"backgroundColor"),o=o.parentNode}catch(t){}n=n.blend(a&&"transparent"!==a?a:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(t){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=h(e.elem,i),e.end=h(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},h.hook(o),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,r){e["border"+r+"Color"]=t}),e}},s=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,r,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,s={};if(n&&n.length&&n[0]&&n[n[0]])for(r=n.length;r--;)i=n[r],"string"==typeof n[i]&&(s[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(s[i]=n[i]);return s}function i(e,i){var r,s,o={};for(r in i)s=i[r],e[r]!==s&&(n[r]||(t.fx.step[r]||!isNaN(parseFloat(s)))&&(o[r]=s));return o}var r=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,s,o,a){var l=t.speed(s,o,a);return this.queue(function(){var s,o=t(this),a=o.attr("class")||"",h=l.children?o.find("*").addBack():o;h=h.map(function(){var i=t(this);return{el:i,start:e(this)}}),s=function(){t.each(r,function(t,e){n[e]&&o[e+"Class"](n[e])})},s(),h=h.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",a),h=h.map(function(){var e=this,i=t.Deferred(),r=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,r),i.promise()}),t.when.apply(t,h.get()).done(function(){s(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(o[0])})})},t.fn.extend({addClass:function(e){return function(i,r,n,s){return r?t.effects.animateClass.call(this,{add:i},r,n,s):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,r,n,s){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},r,n,s):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,r,n,s,o){return"boolean"==typeof r||void 0===r?n?t.effects.animateClass.call(this,r?{add:i}:{remove:i},n,s,o):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},r,n,s)}}(t.fn.toggleClass),switchClass:function(e,i,r,n,s){return t.effects.animateClass.call(this,{add:i,remove:e},r,n,s)}})}(),function(){function e(e,i,r,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,r=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=r,r=i,i={}),t.isFunction(r)&&(n=r,r=null),i&&t.extend(e,i),r=r||i.duration,e.duration=t.fx.off?0:"number"==typeof r?r:r in t.fx.speeds?t.fx.speeds[r]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!(e&&"number"!=typeof e&&!t.fx.speeds[e])||("string"==typeof e&&!t.effects.effect[e]||(!!t.isFunction(e)||"object"==typeof e&&!e.effect))}function r(t,e){var i=e.outerWidth(),r=e.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,s=n.exec(t)||["",0,i,r,0];return{top:parseFloat(s[1])||0,right:"auto"===s[2]?i:parseFloat(s[2]),bottom:"auto"===s[3]?r:parseFloat(s[3]),left:parseFloat(s[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),t.uiBackCompat!==!1&&t.extend(t.effects,{save:function(t,e){for(var i=0,r=e.length;r>i;i++)null!==e[i]&&t.data(u+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,r=0,n=e.length;n>r;r++)null!==e[r]&&(i=t.data(u+e[r]),t.css(e[r],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),float:e.css("float")},r=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},s=document.activeElement;try{s.id}catch(t){s=document.body}return e.wrap(r),(e[0]===s||t.contains(e[0],s))&&t(s).trigger("focus"),r=e.parent(),"static"===e.css("position")?(r.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,r){i[r]=e.css(r),isNaN(parseInt(i[r],10))&&(i[r]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),r.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,r){return r||(r=i,i="effect"),t.effects.effect[e]=r,t.effects.effect[e].mode=i,r},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var r="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*r,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*r}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var r=t.queue();e>1&&r.splice.apply(r,[1,0].concat(r.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(c,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(c)||"",t.removeData(c)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,r;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=t[1]/e.width}return{x:r,y:i}},createPlaceholder:function(e){var i,r=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(r)&&(r="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),float:e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(u+"placeholder",i)),e.css({position:r,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=u+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,r,n){return n=n||{},t.each(i,function(t,i){var s=e.cssUnit(i);s[0]>0&&(n[i]=s[0]*r+s[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){a.removeData(d),t.effects.cleanUp(a),"hide"===r.mode&&a.hide(),o()}function o(){t.isFunction(l)&&l.call(a[0]),t.isFunction(e)&&e()}var a=t(this);r.mode=u.shift(),t.uiBackCompat===!1||s?"none"===r.mode?(a[h](),o()):n.call(a[0],r,i):(a.is(":hidden")?"hide"===h:"show"===h)?(a[h](),o()):n.call(a[0],r,o)}var r=e.apply(this,arguments),n=t.effects.effect[r.effect],s=n.mode,o=r.queue,a=o||"fx",l=r.complete,h=r.mode,u=[],c=function(e){var i=t(this),r=t.effects.mode(i,h)||s;i.data(d,!0),u.push(r),s&&("show"===r||r===s&&"hide"===r)&&i.show(),s&&"none"===r||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?h?this[h](r.duration,l):this.each(function(){l&&l.call(this)}):o===!1?this.each(c).each(i):this.queue(a,c).queue(a,i)},show:function(t){return function(r){if(i(r))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(r){if(i(r))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(r){if(i(r)||"boolean"==typeof r)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),r=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(r=[parseFloat(i),e])}),r},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):r(this.css("clip"),this)},transfer:function(e,i){var r=t(this),n=t(e.to),s="fixed"===n.css("position"),o=t("body"),a=s?o.scrollTop():0,l=s?o.scrollLeft():0,h=n.offset(),u={top:h.top-a,left:h.left-l,height:n.innerHeight(),width:n.innerWidth()},c=r.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:c.top-a,left:c.left-l,height:r.innerHeight(),width:r.innerWidth(),position:s?"fixed":"absolute"}).animate(u,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=r(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);
return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();var f=t.effects;t.effects.define("blind","hide",function(e,i){var r={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),s=e.direction||"up",o=n.cssClip(),a={clip:t.extend({},o)},l=t.effects.createPlaceholder(n);a.clip[r[s][0]]=a.clip[r[s][1]],"show"===e.mode&&(n.cssClip(a.clip),l&&l.css(t.effects.clipToBox(a)),a.clip=o),l&&l.animate(t.effects.clipToBox(a),e.duration,e.easing),n.animate(a,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var r,n,s,o=t(this),a=e.mode,l="hide"===a,h="show"===a,u=e.direction||"up",c=e.distance,d=e.times||5,p=2*d+(h||l?1:0),f=e.duration/p,g=e.easing,m="up"===u||"down"===u?"top":"left",v="up"===u||"left"===u,y=0,b=o.queue().length;for(t.effects.createPlaceholder(o),s=o.css(m),c||(c=o["top"===m?"outerHeight":"outerWidth"]()/3),h&&(n={opacity:1},n[m]=s,o.css("opacity",0).css(m,v?2*-c:2*c).animate(n,f,g)),l&&(c/=Math.pow(2,d-1)),n={},n[m]=s;d>y;y++)r={},r[m]=(v?"-=":"+=")+c,o.animate(r,f,g).animate(n,f,g),c=l?2*c:c/2;l&&(r={opacity:0},r[m]=(v?"-=":"+=")+c,o.animate(r,f,g)),o.queue(i),t.effects.unshift(o,b,p+1)}),t.effects.define("clip","hide",function(e,i){var r,n={},s=t(this),o=e.direction||"vertical",a="both"===o,l=a||"horizontal"===o,h=a||"vertical"===o;r=s.cssClip(),n.clip={top:h?(r.bottom-r.top)/2:r.top,right:l?(r.right-r.left)/2:r.right,bottom:h?(r.bottom-r.top)/2:r.bottom,left:l?(r.right-r.left)/2:r.left},t.effects.createPlaceholder(s),"show"===e.mode&&(s.cssClip(n.clip),n.clip=r),s.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var r,n=t(this),s=e.mode,o="show"===s,a=e.direction||"left",l="up"===a||"down"===a?"top":"left",h="up"===a||"left"===a?"-=":"+=",u="+="===h?"-=":"+=",c={opacity:0};t.effects.createPlaceholder(n),r=e.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,c[l]=h+r,o&&(n.css(c),c[l]=u+r,c.opacity=1),n.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function r(){b.push(this),b.length===c*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),i()}var s,o,a,l,h,u,c=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=c,p=t(this),f=e.mode,g="show"===f,m=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/d),y=Math.ceil(p.outerHeight()/c),b=[];for(s=0;c>s;s++)for(l=m.top+s*y,u=s-(c-1)/2,o=0;d>o;o++)a=m.left+o*v,h=o-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*v,top:-s*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:a+(g?h*v:0),top:l+(g?u*y:0),opacity:g?0:1}).animate({left:a+(g?0:h*v),top:l+(g?0:u*y),opacity:g?1:0},e.duration||500,e.easing,r)}),t.effects.define("fade","toggle",function(e,i){var r="show"===e.mode;t(this).css("opacity",r?0:1).animate({opacity:r?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var r=t(this),n=e.mode,s="show"===n,o="hide"===n,a=e.size||15,l=/([0-9]+)%/.exec(a),h=!!e.horizFirst,u=h?["right","bottom"]:["bottom","right"],c=e.duration/2,d=t.effects.createPlaceholder(r),p=r.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[u[0]],p[u[1]]],v=r.queue().length;l&&(a=parseInt(l[1],10)/100*m[o?0:1]),f.clip[u[0]]=a,g.clip[u[0]]=a,g.clip[u[1]]=0,s&&(r.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),r.queue(function(i){d&&d.animate(t.effects.clipToBox(f),c,e.easing).animate(t.effects.clipToBox(g),c,e.easing),i()}).animate(f,c,e.easing).animate(g,c,e.easing).queue(i),t.effects.unshift(r,v,4)}),t.effects.define("highlight","show",function(e,i){var r=t(this),n={backgroundColor:r.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(r),r.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var r,n,s,o=t(this),a=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],u=e.mode,c="effect"!==u,d=e.scale||"both",p=e.origin||["middle","center"],f=o.css("position"),g=o.position(),m=t.effects.scaledDimensions(o),v=e.from||m,y=e.to||t.effects.scaledDimensions(o,0);t.effects.createPlaceholder(o),"show"===u&&(s=v,v=y,y=s),n={from:{y:v.height/m.height,x:v.width/m.width},to:{y:y.height/m.height,x:y.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(v=t.effects.setTransition(o,l,n.from.y,v),y=t.effects.setTransition(o,l,n.to.y,y)),n.from.x!==n.to.x&&(v=t.effects.setTransition(o,h,n.from.x,v),y=t.effects.setTransition(o,h,n.to.x,y))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(v=t.effects.setTransition(o,a,n.from.y,v),y=t.effects.setTransition(o,a,n.to.y,y)),p&&(r=t.effects.getBaseline(p,m),v.top=(m.outerHeight-v.outerHeight)*r.y+g.top,v.left=(m.outerWidth-v.outerWidth)*r.x+g.left,y.top=(m.outerHeight-y.outerHeight)*r.y+g.top,y.left=(m.outerWidth-y.outerWidth)*r.x+g.left),o.css(v),("content"===d||"both"===d)&&(l=l.concat(["marginTop","marginBottom"]).concat(a),h=h.concat(["marginLeft","marginRight"]),o.find("*[width]").each(function(){var i=t(this),r=t.effects.scaledDimensions(i),s={height:r.height*n.from.y,width:r.width*n.from.x,outerHeight:r.outerHeight*n.from.y,outerWidth:r.outerWidth*n.from.x},o={height:r.height*n.to.y,width:r.width*n.to.x,outerHeight:r.height*n.to.y,outerWidth:r.width*n.to.x};n.from.y!==n.to.y&&(s=t.effects.setTransition(i,l,n.from.y,s),o=t.effects.setTransition(i,l,n.to.y,o)),n.from.x!==n.to.x&&(s=t.effects.setTransition(i,h,n.from.x,s),o=t.effects.setTransition(i,h,n.to.x,o)),c&&t.effects.saveStyle(i),i.css(s),i.animate(o,e.duration,e.easing,function(){c&&t.effects.restoreStyle(i)})})),o.animate(y,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=o.offset();0===y.opacity&&o.css("opacity",v.opacity),c||(o.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(o)),i()}})}),t.effects.define("scale",function(e,i){var r=t(this),n=e.mode,s=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),o=t.extend(!0,{from:t.effects.scaledDimensions(r),to:t.effects.scaledDimensions(r,s,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(o.from.opacity=1,o.to.opacity=0),t.effects.effect.size.call(this,o,i)}),t.effects.define("puff","hide",function(e,i){var r=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,r,i)}),t.effects.define("pulsate","show",function(e,i){var r=t(this),n=e.mode,s="show"===n,o="hide"===n,a=s||o,l=2*(e.times||5)+(a?1:0),h=e.duration/l,u=0,c=1,d=r.queue().length;for((s||!r.is(":visible"))&&(r.css("opacity",0).show(),u=1);l>c;c++)r.animate({opacity:u},h,e.easing),u=1-u;r.animate({opacity:u},h,e.easing),r.queue(i),t.effects.unshift(r,d,l+1)}),t.effects.define("shake",function(e,i){var r=1,n=t(this),s=e.direction||"left",o=e.distance||20,a=e.times||3,l=2*a+1,h=Math.round(e.duration/l),u="up"===s||"down"===s?"top":"left",c="up"===s||"left"===s,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[u]=(c?"-=":"+=")+o,p[u]=(c?"+=":"-=")+2*o,f[u]=(c?"-=":"+=")+2*o,n.animate(d,h,e.easing);a>r;r++)n.animate(p,h,e.easing).animate(f,h,e.easing);n.animate(p,h,e.easing).animate(d,h/2,e.easing).queue(i),t.effects.unshift(n,g,l+1)}),t.effects.define("slide","show",function(e,i){var r,n,s=t(this),o={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},a=e.mode,l=e.direction||"left",h="up"===l||"down"===l?"top":"left",u="up"===l||"left"===l,c=e.distance||s["top"===h?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(s),r=s.cssClip(),n=s.position()[h],d[h]=(u?-1:1)*c+n,d.clip=s.cssClip(),d.clip[o[l][1]]=d.clip[o[l][0]],"show"===a&&(s.cssClip(d.clip),s.css(h,d[h]),d.clip=r,d[h]=n),s.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});var f;t.uiBackCompat!==!1&&(f=t.effects.define("transfer",function(e,i){t(this).transfer(e,i)})),t.ui.focusable=function(i,r){var n,s,o,a,l,h=i.nodeName.toLowerCase();return"area"===h?(n=i.parentNode,s=n.name,!(!i.href||!s||"map"!==n.nodeName.toLowerCase())&&(o=t("img[usemap='#"+s+"']"),o.length>0&&o.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(h)?(a=!i.disabled,a&&(l=t(i).closest("fieldset")[0],l&&(a=!l.disabled))):a="a"===h?i.href||r:r,a&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function r(e,i,r,s){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,r&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),s&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),o={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?o["inner"+i].call(this):this.each(function(){t(this).css(s,r(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?o["outer"+i].call(this,e):this.each(function(){t(this).css(s,r(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,r,n,s;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),r=this.attr("id"),r&&(e=this.eq(0).parents().last(),s=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(r)+"']",n=n.add(s.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),r="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,s=this.parents().filter(function(){var e=t(this);return(!r||"static"!==e.css("position"))&&n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&s.length?s:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),r=null!=i;return(!r||i>=0)&&t.ui.focusable(e,r)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,r=this.options.icons;r&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+r.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,r.header)._addClass(i,null,r.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),void("icons"===t&&(this._destroyIcons(),e&&this._createIcons())))},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,r=this.headers.length,n=this.headers.index(e.target),s=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:s=this.headers[(n+1)%r];break;case i.LEFT:case i.UP:s=this.headers[(n-1+r)%r];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:s=this.headers[0];break;case i.END:s=this.headers[r-1]}s&&(t(e.target).attr("tabIndex",-1),t(s).attr("tabIndex",0),t(s).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,r=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),r=e.next(),n=r.uniqueId().attr("id");e.attr("aria-controls",n),r.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===r?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),r=i.css("position");"absolute"!==r&&"fixed"!==r&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===r&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,r,n=this.options,s=this.active,o=t(e.currentTarget),a=o[0]===s[0],l=a&&n.collapsible,h=l?t():o.next(),u=s.next(),c={oldHeader:s,oldPanel:u,newHeader:l?t():o,newPanel:h};e.preventDefault(),a&&!n.collapsible||this._trigger("beforeActivate",e,c)===!1||(n.active=!l&&this.headers.index(o),this.active=a?t():o,this._toggle(c),this._removeClass(s,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=s.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),a||(this._removeClass(o,"ui-accordion-header-collapsed")._addClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(r=o.children(".ui-accordion-header-icon"),this._removeClass(r,null,n.icons.header)._addClass(r,null,n.icons.activeHeader)),this._addClass(o.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,r=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=r,this.options.animate?this._animate(i,r,e):(r.hide(),i.show(),this._toggleComplete(e)),r.attr({"aria-hidden":"true"}),r.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&r.length?r.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var r,n,s,o=this,a=0,l=t.css("box-sizing"),h=t.length&&(!e.length||t.index()<e.index()),u=this.options.animate||{},c=h&&u.down||u,d=function(){o._toggleComplete(i)};return"number"==typeof c&&(s=c),"string"==typeof c&&(n=c),n=n||c.easing||u.easing,s=s||c.duration||u.duration,e.length?t.length?(r=t.show().outerHeight(),e.animate(this.hideProps,{duration:s,easing:n,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(this.showProps,{duration:s,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===l&&(a+=i.now):"content"!==o.options.heightStyle&&(i.now=Math.round(r-e.outerHeight()-a),a=0)}})):e.animate(this.hideProps,s,n,d):t.animate(this.showProps,s,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),r=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&r.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),r=t(e.currentTarget);i[0]===r[0]&&(this._removeClass(r.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,r))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,r,n,s,o=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:o=!1,r=this.previousFilter||"",s=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===r?s=!0:n=r+n,i=this._filterMenuItems(n),i=s&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}o&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i,r,n,s,o=this,a=this.options.icons.submenu,l=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),r=l.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),r=t("<span>").data("ui-menu-submenu-caret",!0);o._addClass(r,"ui-menu-icon","ui-icon "+a),i.attr("aria-haspopup","true").prepend(r),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(r,"ui-menu","ui-widget ui-widget-content ui-front"),e=l.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);o._isDivider(e)&&o._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),s=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(s,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,r,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),r=this.active.children(".ui-menu-item-wrapper"),this._addClass(r,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,r,n,s,o,a;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-r,s=this.activeMenu.scrollTop(),o=this.activeMenu.height(),a=e.outerHeight(),0>n?this.activeMenu.scrollTop(s+n):n+a>o&&this.activeMenu.scrollTop(s+n-o+a))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var r=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(e),this._removeClass(r.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=r},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var r;this.active&&(r="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),r&&r.length&&this.active||(r=this.activeMenu.find(this.options.items)[e]()),this.focus(i,r)},nextPage:function(e){var i,r,n;return this.active?void(this.isLastItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-r-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,r,n;return this.active?void(this.isFirstItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-r+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),r=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return r.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,r,n=this.element[0].nodeName.toLowerCase(),s="textarea"===n,o="input"===n;this.isMultiLine=s||!o&&this._isContentEditable(this.element),this.valueMethod=this.element[s||o?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,r=!0,void(i=!0);e=!1,r=!1,i=!1;var s=t.ui.keyCode;switch(n.keyCode){case s.PAGE_UP:e=!0,this._move("previousPage",n);break;case s.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case s.UP:e=!0,this._keyEvent("previous",n);break;case s.DOWN:e=!0,this._keyEvent("next",n);break;case s.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case s.TAB:this.menu.active&&this.menu.select(n);break;case s.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(r){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&r.preventDefault());if(!i){var n=t.ui.keyCode;switch(r.keyCode){case n.PAGE_UP:this._move("previousPage",r);break;case n.PAGE_DOWN:this._move("nextPage",r);break;case n.UP:this._keyEvent("previous",r);break;case n.DOWN:this._keyEvent("next",r)}}},input:function(t){return r?(r=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus");
})},menufocus:function(e,i){var r,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)})):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),r=i.item.attr("aria-label")||n.value,void(r&&t.trim(r).length&&(this.liveRegion.children().hide(),t("<div>").text(r).appendTo(this.liveRegion))))},menuselect:function(e,i){var r=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=r})),!1!==this._trigger("select",e,{item:r})&&this._value(r.value),this.term=this._value(),this.close(e),this.selectedItem=r}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,r=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,r){r(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){r.xhr&&r.xhr.abort(),r.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),r=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!r)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var r=this;t.each(i,function(t,i){r._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var r=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return r.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(r,n){var s,o={};return n?"controlgroupLabel"===r?(s=e.element.find(n),s.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(s,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(s.get()))):void(t.fn[r]&&(o=e["_"+r+"Options"]?e["_"+r+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),s=n[r]("instance"),a=t.widget.extend({},o);if("button"!==r||!n.parent(".ui-spinner").length){s||(s=n[r]()[r]("instance")),s&&(a.classes=e._resolveClassesValues(a.classes,s)),n[r](a);var l=n[r]("widget");t.data(l[0],"ui-controlgroup-data",s?s:n[r]("instance")),i.push(l[0])}}))):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),r=i.data("ui-controlgroup-data");r&&r[e]&&r[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",r=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,r)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,r={classes:{}};return r.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],r},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:!!e&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var r={};return t.each(e,function(n){var s=i.options.classes[n]||"";s=t.trim(s.replace(g,"")),r[n]=(s+" "+e[n]).replace(/\s+/g," ")}),r},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?void this._callChildMethod(e?"disable":"enable"):void this.refresh()},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,r){var n=e[r]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var s=i["_"+n.widgetName+"Options"](1===e.length?"only":r);s.classes=i._resolveClassesValues(s.classes,n),n.element[n.widgetName](s)}else i._updateCornerClass(e[r](),r)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,r=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){r.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,r="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(r):t(r).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),void(this.element[0].disabled=e)):void this.refresh()):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var r="iconPosition"!==e,n=r?this.options.iconPosition:i,s="top"===n||"bottom"===n;this.icon?r&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),r&&this._addClass(this.icon,null,i),this._attachIcon(n),s?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?void this._super("showLabel",e):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var m;t.extend(r.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return o(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var r,n,s;r=e.nodeName.toLowerCase(),n="div"===r||"span"===r,e.id||(this.uuid+=1,e.id="dp"+this.uuid),s=this._newInst(t(e),n),s.settings=t.extend({},i||{}),"input"===r?this._connectDatepicker(e,s):n&&this._inlineDatepicker(e,s)},_newInst:function(e,i){var r=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var r=t(e);i.append=t([]),i.trigger=t([]),r.hasClass(this.markerClassName)||(this._attachments(r,i),r.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var r,n,s,o=this._get(i,"appendText"),a=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=t("<span class='"+this._appendClass+"'>"+o+"</span>"),e[a?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),r=this._get(i,"showOn"),("focus"===r||"both"===r)&&e.on("focus",this._showDatepicker),("button"===r||"both"===r)&&(n=this._get(i,"buttonText"),s=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:s,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(s?t("<img/>").attr({src:s,alt:n,title:n}):n)),e[a?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,r,n,s=new Date(2009,11,20),o=this._get(t,"dateFormat");o.match(/[DM]/)&&(e=function(t){for(i=0,r=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,r=n);return r},s.setMonth(e(this._get(t,o.match(/MM/)?"monthNames":"monthNamesShort"))),s.setDate(e(this._get(t,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())),t.input.attr("size",this._formatDate(t,s).length)}},_inlineDatepicker:function(e,i){var r=t(e);r.hasClass(this.markerClassName)||(r.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,r,n,s){var a,l,h,u,c,d=this._dialogInst;return d||(this.uuid+=1,a="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+a+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),o(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=s?s.length?s:[s.pageX,s.pageY]:null,this._pos||(l=document.documentElement.clientWidth,h=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+u,h/2-150+c]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=r,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,r=t(e),n=t.data(e,"datepicker");r.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),r.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&r.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,r,n=t(e),s=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,s.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(r=n.children("."+this._inlineClass),r.children().removeClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,r,n=t(e),s=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,s.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(r=n.children("."+this._inlineClass),r.children().addClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,r){var n,s,a,l,h=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):h?"all"===i?t.extend({},h.settings):this._get(h,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=r),void(h&&(this._curInst===h&&this._hideDatepicker(),s=this._getDateDatepicker(e,!0),a=this._getMinMaxDate(h,"min"),l=this._getMinMaxDate(h,"max"),o(h.settings,n),null!==a&&void 0!==n.dateFormat&&void 0===n.minDate&&(h.settings.minDate=this._formatDate(h,a)),null!==l&&void 0!==n.dateFormat&&void 0===n.maxDate&&(h.settings.maxDate=this._formatDate(h,l)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),h),this._autoSize(h),this._setDate(h,s),this._updateAlternate(h),this._updateDatepicker(h))))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,r,n,s=t.datepicker._getInst(e.target),o=!0,a=s.dpDiv.is(".ui-datepicker-rtl");if(s._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),o=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",s.dpDiv),n[0]&&t.datepicker._selectDay(e.target,s.selectedMonth,s.selectedYear,n[0]),i=t.datepicker._get(s,"onSelect"),i?(r=t.datepicker._formatDate(s),i.apply(s.input?s.input[0]:null,[r,s])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(s,"stepBigMonths"):-t.datepicker._get(s,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(s,"stepBigMonths"):+t.datepicker._get(s,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),o=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),o=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,a?1:-1,"D"),o=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(s,"stepBigMonths"):-t.datepicker._get(s,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),o=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,a?-1:1,"D"),o=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(s,"stepBigMonths"):+t.datepicker._get(s,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),o=e.ctrlKey||e.metaKey;break;default:o=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):o=!1;o&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,r,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),r=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">r||!i||i.indexOf(r)>-1):void 0},_doKeyUp:function(e){var i,r=t.datepicker._getInst(e.target);if(r.input.val()!==r.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(r,"dateFormat"),r.input?r.input.val():null,t.datepicker._getFormatConfig(r)),i&&(t.datepicker._setDateFromField(r),t.datepicker._updateAlternate(r),t.datepicker._updateDatepicker(r))}catch(t){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var r,n,s,a,l,h,u;r=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==r&&(t.datepicker._curInst.dpDiv.stop(!0,!0),r&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(r,"beforeShow"),s=n?n.apply(e,[e,r]):{},s!==!1&&(o(r.settings,s),r.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(r),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),a=!1,t(e).parents().each(function(){return a|="fixed"===t(this).css("position"),!a}),l={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,r.dpDiv.empty(),r.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(r),l=t.datepicker._checkOffset(r,l,a),r.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":a?"fixed":"absolute",display:"none",left:l.left+"px",top:l.top+"px"}),r.inline||(h=t.datepicker._get(r,"showAnim"),u=t.datepicker._get(r,"duration"),r.dpDiv.css("z-index",i(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[h]?r.dpDiv.show(h,t.datepicker._get(r,"showOptions"),u):r.dpDiv[h||"show"](h?u:null),t.datepicker._shouldFocusInput(r)&&r.input.trigger("focus"),t.datepicker._curInst=r))}},_updateDatepicker:function(e){this.maxRows=4,m=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,r=this._getNumberOfMonths(e),n=r[1],o=17,a=e.dpDiv.find("."+this._dayOverClass+" a");a.length>0&&s.apply(a.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",o*n+"em"),e.dpDiv[(1!==r[0]||1!==r[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,r){var n=e.dpDiv.outerWidth(),s=e.dpDiv.outerHeight(),o=e.input?e.input.outerWidth():0,a=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(r?0:t(document).scrollLeft()),h=document.documentElement.clientHeight+(r?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-o:0,i.left-=r&&i.left===e.input.offset().left?t(document).scrollLeft():0,
i.top-=r&&i.top===e.input.offset().top+a?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+s>h&&h>s?Math.abs(s+a):0),i},_findPos:function(e){for(var i,r=this._getInst(e),n=this._get(r,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,r,n,s,o=this._curInst;!o||e&&o!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),r=this._get(o,"duration"),n=function(){t.datepicker._tidyDialog(o)},t.effects&&(t.effects.effect[i]||t.effects[i])?o.dpDiv.hide(i,t.datepicker._get(o,"showOptions"),r,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?r:null,n),i||n(),this._datepickerShowing=!1,s=this._get(o,"onClose"),s&&s.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),r=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==r)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,r){var n=t(e),s=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(s,i+("M"===r?this._get(s,"showCurrentAtPos"):0),r),this._updateDatepicker(s))},_gotoToday:function(e){var i,r=t(e),n=this._getInst(r[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(r)},_selectMonthYear:function(e,i,r){var n=t(e),s=this._getInst(n[0]);s["selected"+("M"===r?"Month":"Year")]=s["draw"+("M"===r?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(s),this._adjustDate(n)},_selectDay:function(e,i,r,n){var s,o=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(s=this._getInst(o[0]),s.selectedDay=s.currentDay=t("a",n).html(),s.selectedMonth=s.currentMonth=i,s.selectedYear=s.currentYear=r,this._selectDate(e,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var r,n=t(e),s=this._getInst(n[0]);i=null!=i?i:this._formatDate(s),s.input&&s.input.val(i),this._updateAlternate(s),r=this._get(s,"onSelect"),r?r.apply(s.input?s.input[0]:null,[i,s]):s.input&&s.input.trigger("change"),s.inline?this._updateDatepicker(s):(this._hideDatepicker(),this._lastInput=s.input[0],"object"!=typeof s.input[0]&&s.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,r,n,s=this._get(e,"altField");s&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),r=this._getDate(e),n=this.formatDate(i,r,this._getFormatConfig(e)),t(s).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,r){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,s,o,a,l=0,h=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),c=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,d=(r?r.dayNames:null)||this._defaults.dayNames,p=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,f=(r?r.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,v=-1,y=-1,b=!1,x=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},_=function(t){var e=x(t),r="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?r:1,s=RegExp("^\\d{"+n+","+r+"}"),o=i.substring(l).match(s);if(!o)throw"Missing number at position "+l;return l+=o[0].length,parseInt(o[0],10)},w=function(e,r,n){var s=-1,o=t.map(x(e)?n:r,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(o,function(t,e){var r=e[1];return i.substr(l,r.length).toLowerCase()===r.toLowerCase()?(s=e[0],l+=r.length,!1):void 0}),-1!==s)return s+1;throw"Unknown name at position "+l},C=function(){if(i.charAt(l)!==e.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||x("'")?C():b=!1;else switch(e.charAt(n)){case"d":v=_("d");break;case"D":w("D",c,d);break;case"o":y=_("o");break;case"m":m=_("m");break;case"M":m=w("M",p,f);break;case"y":g=_("y");break;case"@":a=new Date(_("@")),g=a.getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"!":a=new Date((_("!")-this._ticksTo1970)/1e4),g=a.getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"'":x("'")?C():b=!0;break;default:C()}if(i.length>l&&(o=i.substr(l),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=g?0:-100)),y>-1)for(m=1,v=y;s=this._getDaysInMonth(g,m-1),!(s>=v);)m++,v-=s;if(a=this._daylightSavingAdjust(new Date(g,m-1,v)),a.getFullYear()!==g||a.getMonth()+1!==m||a.getDate()!==v)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var r,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,s=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=function(e){var i=t.length>r+1&&t.charAt(r+1)===e;return i&&r++,i},h=function(t,e,i){var r=""+e;if(l(t))for(;i>r.length;)r="0"+r;return r},u=function(t,e,i,r){return l(t)?r[e]:i[e]},c="",d=!1;if(e)for(r=0;t.length>r;r++)if(d)"'"!==t.charAt(r)||l("'")?c+=t.charAt(r):d=!1;else switch(t.charAt(r)){case"d":c+=h("d",e.getDate(),2);break;case"D":c+=u("D",e.getDay(),n,s);break;case"o":c+=h("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=h("m",e.getMonth()+1,2);break;case"M":c+=u("M",e.getMonth(),o,a);break;case"y":c+=l("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":c+=e.getTime();break;case"!":c+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?c+="'":d=!0;break;default:c+=t.charAt(r)}return c},_possibleChars:function(t){var e,i="",r=!1,n=function(i){var r=t.length>e+1&&t.charAt(e+1)===i;return r&&e++,r};for(e=0;t.length>e;e++)if(r)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):r=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":r=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),r=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),s=n,o=this._getFormatConfig(t);try{s=this.parseDate(i,r,o)||n}catch(t){r=e?"":r}t.selectedDay=s.getDate(),t.drawMonth=t.selectedMonth=s.getMonth(),t.drawYear=t.selectedYear=s.getFullYear(),t.currentDay=r?s.getDate():0,t.currentMonth=r?s.getMonth():0,t.currentYear=r?s.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,r){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},s=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(t){}for(var r=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,n=r.getFullYear(),s=r.getMonth(),o=r.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=a.exec(i);l;){switch(l[2]||"d"){case"d":case"D":o+=parseInt(l[1],10);break;case"w":case"W":o+=7*parseInt(l[1],10);break;case"m":case"M":s+=parseInt(l[1],10),o=Math.min(o,t.datepicker._getDaysInMonth(n,s));break;case"y":case"Y":n+=parseInt(l[1],10),o=Math.min(o,t.datepicker._getDaysInMonth(n,s))}l=a.exec(i)}return new Date(n,s,o)},o=null==i||""===i?r:"string"==typeof i?s(i):"number"==typeof i?isNaN(i)?r:n(i):new Date(i.getTime());return o=o&&"Invalid Date"==""+o?r:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var r=!e,n=t.selectedMonth,s=t.selectedYear,o=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=o.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=o.getMonth(),t.drawYear=t.selectedYear=t.currentYear=o.getFullYear(),n===t.selectedMonth&&s===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(r?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),r="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(r,-i,"M")},next:function(){t.datepicker._adjustDate(r,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(r)},selectDay:function(){return t.datepicker._selectDay(r,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(r,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(r,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,r,n,s,o,a,l,h,u,c,d,p,f,g,m,v,y,b,x,_,w,C,T,A,I,S,M,k,E,P,R,D,N,L,F,O,B,U,z=new Date,j=this._daylightSavingAdjust(new Date(z.getFullYear(),z.getMonth(),z.getDate())),G=this._get(t,"isRTL"),H=this._get(t,"showButtonPanel"),W=this._get(t,"hideIfNoPrevNext"),Y=this._get(t,"navigationAsDateFormat"),V=this._getNumberOfMonths(t),q=this._get(t,"showCurrentAtPos"),X=this._get(t,"stepMonths"),Z=1!==V[0]||1!==V[1],K=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(t,"min"),Q=this._getMinMaxDate(t,"max"),$=t.drawMonth-q,tt=t.drawYear;if(0>$&&($+=12,tt--),Q)for(e=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-V[0]*V[1]+1,Q.getDate())),e=J&&J>e?J:e;this._daylightSavingAdjust(new Date(tt,$,1))>e;)$--,0>$&&($=11,tt--);for(t.drawMonth=$,t.drawYear=tt,i=this._get(t,"prevText"),i=Y?this.formatDate(i,this._daylightSavingAdjust(new Date(tt,$-X,1)),this._getFormatConfig(t)):i,r=this._canAdjustMonth(t,-1,tt,$)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"e":"w")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=Y?this.formatDate(n,this._daylightSavingAdjust(new Date(tt,$+X,1)),this._getFormatConfig(t)):n,s=this._canAdjustMonth(t,1,tt,$)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"w":"e")+"'>"+n+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"w":"e")+"'>"+n+"</span></a>",o=this._get(t,"currentText"),a=this._get(t,"gotoCurrent")&&t.currentDay?K:j,o=Y?this.formatDate(o,a,this._getFormatConfig(t)):o,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",h=H?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(G?l:"")+(this._isInRange(t,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(G?"":l)+"</div>":"",u=parseInt(this._get(t,"firstDay"),10),u=isNaN(u)?0:u,c=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),y=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),x="",w=0;V[0]>w;w++){for(C="",this.maxRows=4,T=0;V[1]>T;T++){if(A=this._daylightSavingAdjust(new Date(tt,$,t.selectedDay)),I=" ui-corner-all",S="",Z){if(S+="<div class='ui-datepicker-group",V[1]>1)switch(T){case 0:S+=" ui-datepicker-group-first",I=" ui-corner-"+(G?"right":"left");break;case V[1]-1:S+=" ui-datepicker-group-last",I=" ui-corner-"+(G?"left":"right");break;default:S+=" ui-datepicker-group-middle",I=""}S+="'>"}for(S+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===w?G?s:r:"")+(/all|right/.test(I)&&0===w?G?r:s:"")+this._generateMonthYearHeader(t,$,tt,J,Q,w>0||T>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",M=c?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",_=0;7>_;_++)k=(_+u)%7,M+="<th scope='col'"+((_+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[k]+"'>"+p[k]+"</span></th>";for(S+=M+"</tr></thead><tbody>",E=this._getDaysInMonth(tt,$),tt===t.selectedYear&&$===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,E)),P=(this._getFirstDayOfMonth(tt,$)-u+7)%7,R=Math.ceil((P+E)/7),D=Z&&this.maxRows>R?this.maxRows:R,this.maxRows=D,N=this._daylightSavingAdjust(new Date(tt,$,1-P)),L=0;D>L;L++){for(S+="<tr>",F=c?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(N)+"</td>":"",_=0;7>_;_++)O=m?m.apply(t.input?t.input[0]:null,[N]):[!0,""],B=N.getMonth()!==$,U=B&&!y||!O[0]||J&&J>N||Q&&N>Q,F+="<td class='"+((_+u+6)%7>=5?" ui-datepicker-week-end":"")+(B?" ui-datepicker-other-month":"")+(N.getTime()===A.getTime()&&$===t.selectedMonth&&t._keyEvent||b.getTime()===N.getTime()&&b.getTime()===A.getTime()?" "+this._dayOverClass:"")+(U?" "+this._unselectableClass+" ui-state-disabled":"")+(B&&!v?"":" "+O[1]+(N.getTime()===K.getTime()?" "+this._currentClass:"")+(N.getTime()===j.getTime()?" ui-datepicker-today":""))+"'"+(B&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(U?"":" data-handler='selectDay' data-event='click' data-month='"+N.getMonth()+"' data-year='"+N.getFullYear()+"'")+">"+(B&&!v?"&#xa0;":U?"<span class='ui-state-default'>"+N.getDate()+"</span>":"<a class='ui-state-default"+(N.getTime()===j.getTime()?" ui-state-highlight":"")+(N.getTime()===K.getTime()?" ui-state-active":"")+(B?" ui-priority-secondary":"")+"' href='#'>"+N.getDate()+"</a>")+"</td>",N.setDate(N.getDate()+1),N=this._daylightSavingAdjust(N);S+=F+"</tr>"}$++,$>11&&($=0,tt++),S+="</tbody></table>"+(Z?"</div>"+(V[0]>0&&T===V[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),C+=S}x+=C}return x+=h,t._keyEvent=!1,x},_generateMonthYearHeader:function(t,e,i,r,n,s,o,a){var l,h,u,c,d,p,f,g,m=this._get(t,"changeMonth"),v=this._get(t,"changeYear"),y=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",x="";if(s||!m)x+="<span class='ui-datepicker-month'>"+o[e]+"</span>";else{for(l=r&&r.getFullYear()===i,h=n&&n.getFullYear()===i,x+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!l||u>=r.getMonth())&&(!h||n.getMonth()>=u)&&(x+="<option value='"+u+"'"+(u===e?" selected='selected'":"")+">"+a[u]+"</option>");x+="</select>"}if(y||(b+=x+(!s&&m&&v?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",s||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(c=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(c[0]),g=Math.max(f,p(c[1]||"")),f=r?Math.max(f,r.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),y&&(b+=(!s&&m&&v?"":"&#xa0;")+x),b+="</div>"},_adjustInstDate:function(t,e,i){var r=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),s=Math.min(t.selectedDay,this._getDaysInMonth(r,n))+("D"===i?e:0),o=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(r,n,s)));t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),r=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return r&&n>r?r:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,r){var n=this._getNumberOfMonths(t),s=this._daylightSavingAdjust(new Date(i,r+(0>e?e:n[0]*n[1]),1));return 0>e&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(t,s)},_isInRange:function(t,e){var i,r,n=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),o=null,a=null,l=this._get(t,"yearRange");return l&&(i=l.split(":"),r=(new Date).getFullYear(),o=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=r),i[1].match(/[+\-].*/)&&(a+=r)),(!n||e.getTime()>=n.getTime())&&(!s||e.getTime()<=s.getTime())&&(!o||e.getFullYear()>=o)&&(!a||a>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,r){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(r,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new r,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var v=!1;t(document).on("mouseup",function(){v=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!v){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,r=1===e.which,n=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return!(r&&!n&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),v=!0,!0))}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,v=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,r){var n,s=t.ui[e].prototype;for(n in r)s.plugins[n]=s.plugins[n]||[],s.plugins[n].push([i,r[n]])},call:function(t,e,i,r){var n,s=t.plugins[e];if(s&&(r||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;s.length>n;n++)t.options[s[n][0]]&&s[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.options;return!(this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(e),!!this.handle&&(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),r=t(e.target);r.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var r=this._uiHash();if(this._trigger("drag",e,r)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=r.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,r=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(r=t.ui.ddmanager.drop(this,e)),this.dropped&&(r=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,r=t.isFunction(i.helper),n=r?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),r&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,r,n=this.options,s=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===n.containment?void(this.containment=[0,0,t(s).width()-this.helperProportions.width-this.margins.left,(t(s).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):n.containment.constructor===Array?void(this.containment=n.containment):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),r=i[0],void(r&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],
this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,r=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,r,n,s,o=this.options,a=this._isRootNode(this.scrollParent[0]),l=t.pageX,h=t.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(r=this.relativeContainer.offset(),i=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,s=o.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,l=i?s-this.offset.click.left>=i[0]||s-this.offset.click.left>i[2]?s:s-this.offset.click.left>=i[0]?s-o.grid[0]:s+o.grid[0]:s),"y"===o.axis&&(l=this.originalPageX),"x"===o.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,r){return r=r||this._uiHash(),t.ui.plugin.call(this,e,[i,r,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),r.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,r){var n=t.extend({},i,{item:r.element});r.sortables=[],t(r.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(r.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,r){var n=t.extend({},i,{item:r.element});r.cancelHelperRemoval=!1,t.each(r.sortables,function(){var t=this;t.isOver?(t.isOver=0,r.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,r){t.each(r.sortables,function(){var n=!1,s=this;s.positionAbs=r.positionAbs,s.helperProportions=r.helperProportions,s.offset.click=r.offset.click,s._intersectsWith(s.containerCache)&&(n=!0,t.each(r.sortables,function(){return this.positionAbs=r.positionAbs,this.helperProportions=r.helperProportions,this.offset.click=r.offset.click,this!==s&&this._intersectsWith(this.containerCache)&&t.contains(s.element[0],this.element[0])&&(n=!1),n})),n?(s.isOver||(s.isOver=1,r._parent=i.helper.parent(),s.currentItem=i.helper.appendTo(s.element).data("ui-sortable-item",!0),s.options._helper=s.options.helper,s.options.helper=function(){return i.helper[0]},e.target=s.currentItem[0],s._mouseCapture(e,!0),s._mouseStart(e,!0,!0),s.offset.click.top=r.offset.click.top,s.offset.click.left=r.offset.click.left,s.offset.parent.left-=r.offset.parent.left-s.offset.parent.left,s.offset.parent.top-=r.offset.parent.top-s.offset.parent.top,r._trigger("toSortable",e),r.dropped=s.element,t.each(r.sortables,function(){this.refreshPositions()}),r.currentItem=r.element,s.fromOutside=r),s.currentItem&&(s._mouseDrag(e),i.position=s.position)):s.isOver&&(s.isOver=0,s.cancelHelperRemoval=!0,s.options._revert=s.options.revert,s.options.revert=!1,s._trigger("out",e,s._uiHash(s)),s._mouseStop(e,!0),s.options.revert=s.options._revert,s.options.helper=s.options._helper,s.placeholder&&s.placeholder.remove(),i.helper.appendTo(r._parent),r._refreshOffsets(e),i.position=r._generatePosition(e,!0),r._trigger("fromSortable",e),r.dropped=!1,t.each(r.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,r){var n=t("body"),s=r.options;n.css("cursor")&&(s._cursor=n.css("cursor")),n.css("cursor",s.cursor)},stop:function(e,i,r){var n=r.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,r){var n=t(i.helper),s=r.options;n.css("opacity")&&(s._opacity=n.css("opacity")),n.css("opacity",s.opacity)},stop:function(e,i,r){var n=r.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,r){var n=r.options,s=!1,o=r.scrollParentNotHidden[0],a=r.document[0];o!==a&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(r.overflowOffset.top+o.offsetHeight-e.pageY<n.scrollSensitivity?o.scrollTop=s=o.scrollTop+n.scrollSpeed:e.pageY-r.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=s=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(r.overflowOffset.left+o.offsetWidth-e.pageX<n.scrollSensitivity?o.scrollLeft=s=o.scrollLeft+n.scrollSpeed:e.pageX-r.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=s=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(a).scrollTop()<n.scrollSensitivity?s=t(a).scrollTop(t(a).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(a).scrollTop())<n.scrollSensitivity&&(s=t(a).scrollTop(t(a).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(a).scrollLeft()<n.scrollSensitivity?s=t(a).scrollLeft(t(a).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(a).scrollLeft())<n.scrollSensitivity&&(s=t(a).scrollLeft(t(a).scrollLeft()+n.scrollSpeed)))),s!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(r,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,r){var n=r.options;r.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==r.element[0]&&r.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,r){var n,s,o,a,l,h,u,c,d,p,f=r.options,g=f.snapTolerance,m=i.offset.left,v=m+r.helperProportions.width,y=i.offset.top,b=y+r.helperProportions.height;for(d=r.snapElements.length-1;d>=0;d--)l=r.snapElements[d].left-r.margins.left,h=l+r.snapElements[d].width,u=r.snapElements[d].top-r.margins.top,c=u+r.snapElements[d].height,l-g>v||m>h+g||u-g>b||y>c+g||!t.contains(r.snapElements[d].item.ownerDocument,r.snapElements[d].item)?(r.snapElements[d].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,e,t.extend(r._uiHash(),{snapItem:r.snapElements[d].item})),r.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(u-b),s=g>=Math.abs(c-y),o=g>=Math.abs(l-v),a=g>=Math.abs(h-m),n&&(i.position.top=r._convertPositionTo("relative",{top:u-r.helperProportions.height,left:0}).top),s&&(i.position.top=r._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.left=r._convertPositionTo("relative",{top:0,left:l-r.helperProportions.width}).left),a&&(i.position.left=r._convertPositionTo("relative",{top:0,left:h}).left)),p=n||s||o||a,"outer"!==f.snapMode&&(n=g>=Math.abs(u-y),s=g>=Math.abs(c-b),o=g>=Math.abs(l-m),a=g>=Math.abs(h-v),n&&(i.position.top=r._convertPositionTo("relative",{top:u,left:0}).top),s&&(i.position.top=r._convertPositionTo("relative",{top:c-r.helperProportions.height,left:0}).top),o&&(i.position.left=r._convertPositionTo("relative",{top:0,left:l}).left),a&&(i.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left)),!r.snapElements[d].snapping&&(n||s||o||a||p)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,e,t.extend(r._uiHash(),{snapItem:r.snapElements[d].item})),r.snapElements[d].snapping=n||s||o||a||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,r){var n,s=r.options,o=t.makeArray(t(s.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(t(o[0]).css("zIndex"),10)||0,t(o).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+o.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,r){var n=t(i.helper),s=r.options;n.css("zIndex")&&(s._zIndex=n.css("zIndex")),n.css("zIndex",s.zIndex)},stop:function(e,i,r){var n=r.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var r=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[r]>0||(e[r]=1,n=e[r]>0,e[r]=0,n)},_create:function(){var e,i=this.options,r=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(r._removeClass("ui-resizable-autohide"),r._handles.show())}).on("mouseleave",function(){i.disabled||r.resizing||(r._addClass("ui-resizable-autohide"),r._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var e,i,r,n,s,o=this.options,a=this;if(this.handles=o.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),r=this.handles.split(","),this.handles={},i=0;r.length>i;i++)e=t.trim(r[i]),n="ui-resizable-"+e,s=t("<div>"),this._addClass(s,"ui-resizable-handle "+n),s.css({zIndex:o.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(s);this._renderAxis=function(e){var i,r,n,s;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(r=t(this.handles[i],this.element),s=/sw|ne|nw|se|n|s/.test(i)?r.outerHeight():r.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,s),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){a.resizing||(this.className&&(s=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=s&&s[1]?s[1]:"se")}),o.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,r,n=!1;for(i in this.handles)r=t(this.handles[i])[0],(r===e.target||t.contains(r,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,r,n,s=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),r=this._num(this.helper.css("top")),s.containment&&(i+=t(s.containment).scrollLeft()||0,r+=t(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:r},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:r},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,r,n=this.originalMousePosition,s=this.axis,o=e.pageX-n.left||0,a=e.pageY-n.top||0,l=this._change[s];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[e,o,a]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),r=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(r)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1)},_mouseStop:function(e){this.resizing=!1;var i,r,n,s,o,a,l,h=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,r=i.length&&/textarea/i.test(i[0].nodeName),n=r&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,s=r?0:u.sizeDiff.width,o={width:u.helper.width()-s,height:u.helper.height()-n},a=parseFloat(u.element.css("left"))+(u.position.left-u.originalPosition.left)||null,l=parseFloat(u.element.css("top"))+(u.position.top-u.originalPosition.top)||null,h.animate||this.element.css(t.extend(o,{top:l,left:a})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,r,n,s,o=this.options;s={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||t)&&(e=s.minHeight*this.aspectRatio,r=s.minWidth/this.aspectRatio,i=s.maxHeight*this.aspectRatio,n=s.maxWidth/this.aspectRatio,e>s.minWidth&&(s.minWidth=e),r>s.minHeight&&(s.minHeight=r),s.maxWidth>i&&(s.maxWidth=i),s.maxHeight>n&&(s.maxHeight=n)),this._vBoundaries=s},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,r=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===r&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===r&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,r=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,s=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,o=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,a=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,h=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return s&&(t.width=e.minWidth),o&&(t.height=e.minHeight),r&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),s&&h&&(t.left=a-e.minWidth),r&&h&&(t.left=a-e.maxWidth),o&&u&&(t.top=l-e.minHeight),n&&u&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],r=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(r[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,r=this.originalPosition;return{left:r.left+e,width:i.width-e}},n:function(t,e,i){var r=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:r.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,r){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,r]))},sw:function(e,i,r){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,r]))},ne:function(e,i,r){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,r]))},nw:function(e,i,r){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,r]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),r=i.options,n=i._proportionallyResizeElements,s=n.length&&/textarea/i.test(n[0].nodeName),o=s&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,a=s?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-o},h=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,u=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,u&&h?{top:u,left:h}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:r.width,height:r.height}),i._updateCache(r),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,r,n,s,o,a,l=t(this).resizable("instance"),h=l.options,u=l.element,c=h.containment,d=c instanceof t?c.get(0):/parent/.test(c)?u.parent().get(0):c;d&&(l.containerElement=t(d),/document/.test(c)||c===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,r){i[t]=l._num(e.css("padding"+r))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},r=l.containerOffset,n=l.containerSize.height,s=l.containerSize.width,o=l._hasScroll(d,"left")?d.scrollWidth:s,a=l._hasScroll(d)?d.scrollHeight:n,l.parentData={element:d,left:r.left,top:r.top,width:o,height:a}))},resize:function(e){var i,r,n,s,o=t(this).resizable("instance"),a=o.options,l=o.containerOffset,h=o.position,u=o._aspectRatio||e.shiftKey,c={top:0,left:0},d=o.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(c=l),h.left<(o._helper?l.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-l.left:o.position.left-c.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=a.helper?l.left:0),h.top<(o._helper?l.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-l.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?l.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),n&&s?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-c.left:o.offset.left-l.left)),r=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-c.top:o.offset.top-l.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,r=e.containerOffset,n=e.containerPosition,s=e.containerElement,o=t(e.helper),a=o.offset(),l=o.outerWidth()-e.sizeDiff.width,h=o.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(s.css("position"))&&t(this).css({left:a.left-n.left-r.left,width:l,height:h}),e._helper&&!i.animate&&/static/.test(s.css("position"))&&t(this).css({left:a.left-n.left-r.left,width:l,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var r=t(this).resizable("instance"),n=r.options,s=r.originalSize,o=r.originalPosition,a={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0};t(n.alsoResize).each(function(){var e=t(this),r=t(this).data("ui-resizable-alsoresize"),n={},s=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(s,function(t,e){var i=(r[e]||0)+(a[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),r=i.options,n=i.size,s=i.originalSize,o=i.originalPosition,a=i.axis,l="number"==typeof r.grid?[r.grid,r.grid]:r.grid,h=l[0]||1,u=l[1]||1,c=Math.round((n.width-s.width)/h)*h,d=Math.round((n.height-s.height)/u)*u,p=s.width+c,f=s.height+d,g=r.maxWidth&&p>r.maxWidth,m=r.maxHeight&&f>r.maxHeight,v=r.minWidth&&r.minWidth>p,y=r.minHeight&&r.minHeight>f;r.grid=l,v&&(p+=h),y&&(f+=u),g&&(p-=h),m&&(f-=u),/^(se|s|e)$/.test(a)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(a)?(i.size.width=p,i.size.height=f,i.position.top=o.top-d):/^(sw)$/.test(a)?(i.size.width=p,i.size.height=f,i.position.left=o.left-c):((0>=f-u||0>=p-h)&&(e=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-d):(f=u-e.height,i.size.height=f,i.position.top=o.top+s.height-f),p-h>0?(i.size.width=p,i.position.left=o.left-c):(p=h-e.width,i.size.width=p,i.position.left=o.left+s.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var r=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),s=Math.max.apply(null,n);return s>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",s+1),r=!0),r&&!i&&this._trigger("focus",e),r},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),
this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),r=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==r[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){r.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(t.each(i,function(i,r){var n,s;r=t.isFunction(r)?{click:r,text:i}:r,r=t.extend({type:"button"},r),n=r.click,s={icon:r.icon,iconPosition:r.iconPosition,showLabel:r.showLabel,icons:r.icons,text:r.text},delete r.click,delete r.icon,delete r.iconPosition,delete r.showLabel,delete r.icons,"boolean"==typeof r.text&&delete r.text,t("<button></button>",r).button(s).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,r=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(r,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",r,e(n))},drag:function(t,r){i._trigger("drag",t,e(r))},stop:function(n,s){var o=s.offset.left-i.document.scrollLeft(),a=s.offset.top-i.document.scrollTop();r.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" top"+(a>=0?"+":"")+a,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(s))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,r=this.options,n=r.resizable,s=this.uiDialog.css("position"),o="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:this._minHeight(),handles:o,start:function(r,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",r,e(n))},resize:function(t,r){i._trigger("resize",t,e(r))},stop:function(n,s){var o=i.uiDialog.offset(),a=o.left-i.document.scrollLeft(),l=o.top-i.document.scrollTop();r.height=i.uiDialog.height(),r.width=i.uiDialog.width(),r.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(l>=0?"+":"")+l,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(s))}}).css("position",s)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,r=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(r=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),r&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var r,n,s=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(r=s.is(":data(ui-draggable)"),r&&!i&&s.draggable("destroy"),!r&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=s.is(":data(ui-resizable)"),n&&!i&&s.resizable("destroy"),n&&"string"==typeof i&&s.resizable("option","handles",i),n||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),t=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),e=Math.max(0,r.minHeight-t),i="number"==typeof r.maxHeight?Math.max(0,r.maxHeight-t):"none","auto"===r.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,r.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,r=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(r)?r:function(t){return t.is(r)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var r=t.ui.ddmanager.droppables[this.options.scope];this._splice(r),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var r=i||t.ui.ddmanager.current,n=!1;return!(!r||(r.currentItem||r.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===r.options.scope&&i.accept.call(i.element[0],r.currentItem||r.element)&&y(r,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),!n&&(!!this.accept.call(this.element[0],r.currentItem||r.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(r)),this.element)))},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var y=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,r,n){if(!i.offset)return!1;var s=(e.positionAbs||e.position.absolute).left+e.margins.left,o=(e.positionAbs||e.position.absolute).top+e.margins.top,a=s+e.helperProportions.width,l=o+e.helperProportions.height,h=i.offset.left,u=i.offset.top,c=h+i.proportions().width,d=u+i.proportions().height;switch(r){case"fit":return s>=h&&c>=a&&o>=u&&d>=l;case"intersect":return s+e.helperProportions.width/2>h&&c>a-e.helperProportions.width/2&&o+e.helperProportions.height/2>u&&d>l-e.helperProportions.height/2;case"pointer":return t(n.pageY,u,i.proportions().height)&&t(n.pageX,h,i.proportions().width);case"touch":return(o>=u&&d>=o||l>=u&&d>=l||u>o&&l>d)&&(s>=h&&c>=s||a>=h&&c>=a||h>s&&a>c);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,i){var r,n,s=t.ui.ddmanager.droppables[e.options.scope]||[],o=i?i.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(r=0;s.length>r;r++)if(!(s[r].options.disabled||e&&!s[r].accept.call(s[r].element[0],e.currentItem||e.element))){for(n=0;a.length>n;n++)if(a[n]===s[r].element[0]){s[r].proportions().height=0;continue t}s[r].visible="none"!==s[r].element.css("display"),s[r].visible&&("mousedown"===o&&s[r]._activate.call(s[r],i),s[r].offset=s[r].element.offset(),s[r].proportions({width:s[r].element[0].offsetWidth,height:s[r].element[0].offsetHeight}))}},drop:function(e,i){var r=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&y(e,this,this.options.tolerance,i)&&(r=this._drop.call(this,i)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),r},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,n,s,o=y(e,this,this.options.tolerance,i),a=!o&&this.isover?"isout":o&&!this.isover?"isover":null;a&&(this.options.greedy&&(n=this.options.scope,s=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),s.length&&(r=t(s[0]).droppable("instance"),r.greedyChild="isover"===a)),r&&"isover"===a&&(r.isover=!1,r.isout=!0,r._out.call(r,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),r&&"isout"===a&&(r.isout=!1,r.isover=!0,r._over.call(r,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),void this._refreshValue())},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),r=i.offset(),n={left:r.left-e.elementPos.left,top:r.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,r=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(r.filter,this.element[0]),this._trigger("start",e),t(r.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=t.data(this,"selectable-item");r.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(r.$element,"ui-selected"),r.selected=!1,i._addClass(r.$element,"ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",e,{unselecting:r.element}))}),t(e.target).parents().addBack().each(function(){var r,n=t.data(this,"selectable-item");return n?(r=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,r?"ui-unselecting":"ui-selected")._addClass(n.$element,r?"ui-selecting":"ui-unselecting"),n.unselecting=!r,n.selecting=r,n.selected=r,r?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,r=this,n=this.options,s=this.opos[0],o=this.opos[1],a=e.pageX,l=e.pageY;return s>a&&(i=a,a=s,s=i),o>l&&(i=l,l=o,o=i),this.helper.css({left:s,top:o,width:a-s,height:l-o}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1,u={};i&&i.element!==r.element[0]&&(u.left=i.left+r.elementPos.left,u.right=i.right+r.elementPos.left,u.top=i.top+r.elementPos.top,u.bottom=i.bottom+r.elementPos.top,"touch"===n.tolerance?h=!(u.left>a||s>u.right||u.top>l||o>u.bottom):"fit"===n.tolerance&&(h=u.left>s&&a>u.right&&u.top>o&&l>u.bottom),h?(i.selected&&(r._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(r._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(r._addClass(i.$element,"ui-selecting"),i.selecting=!0,r._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(r._removeClass(i.$element,"ui-selecting"),i.selecting=!1,r._addClass(i.$element,"ui-selected"),i.selected=!0):(r._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(r._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),r._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(r._removeClass(i.$element,"ui-selected"),i.selected=!1,r._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var r=t.data(this,"selectable-item");i._removeClass(r.$element,"ui-unselecting"),r.unselecting=!1,r.startselected=!1,i._trigger("unselected",e,{unselected:r.element})}),t(".ui-selecting",this.element[0]).each(function(){var r=t.data(this,"selectable-item");i._removeClass(r.$element,"ui-selecting")._addClass(r.$element,"ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,i._trigger("selected",e,{selected:r.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,r=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(r).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var r=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&r.index!==e.focusIndex&&(e._trigger("focus",t,{item:r}),e.isOpen||e._select(r,t)),e.focusIndex=r.index,e.button.attr("aria-activedescendant",e.menuItems.eq(r.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var r=this,n="";t.each(i,function(i,s){var o;s.optgroup!==n&&(o=t("<li>",{text:s.optgroup}),r._addClass(o,"ui-selectmenu-optgroup","ui-menu-divider"+(s.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),o.appendTo(e),n=s.optgroup),r._renderItemData(e,s)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var r=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(r,null,"ui-state-disabled"),this._setText(n,i.label),r.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,r,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),r="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),r.length&&this.menuInstance.focus(e,r)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return t===!1?void this.button.css("width",""):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),void this.button.outerWidth(t))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,r=[];e.each(function(e,n){r.push(i._parseOption(t(n),e))}),this.items=r},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,r=this.options,n=this.element.find(".ui-slider-handle"),s="<span tabindex='0'></span>",o=[];for(i=r.values&&r.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)o.push(s);this.handles=n.add(t(o.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles);
},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,r,n,s,o,a,l,h,u=this,c=this.options;return!c.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},r=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(r-u.values(e));(n>i||n===i&&(e===u._lastChangedValue||u.values(e)===c.min))&&(n=i,s=t(this),o=e)}),a=this._start(e,o),a!==!1&&(this._mouseSliding=!0,this._handleIndex=o,this._addClass(s,null,"ui-state-active"),s.trigger("focus"),l=s.offset(),h=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-s.width()/2,top:e.pageY-l.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,r,n,s;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=i/e,r>1&&(r=1),0>r&&(r=0),"vertical"===this.orientation&&(r=1-r),n=this._valueMax()-this._valueMin(),s=this._valueMin()+r*n,this._trimAlignValue(s)},_uiHash:function(t,e,i){var r={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(r.value=void 0!==e?e:this.values(t),r.values=i||this.values()),r},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var r,n,s=this.value(),o=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),s=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),o[e]=i),i!==s&&(r=this._trigger("slide",t,this._uiHash(e,i,o)),r!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var r,n,s;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(r=this.options.values,n=arguments[0],s=0;r.length>s;s+=1)r[s]=this._trimAlignValue(n[s]),this._change(null,s);this._refreshValue()},_setOption:function(e,i){var r,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=n-1;r>=0;r--)this._change(null,r);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,r;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),r=0;i.length>r;r+=1)i[r]=this._trimAlignValue(i[r]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,r=t-i;return 2*Math.abs(i)>=e&&(r+=i>0?e:-e),parseFloat(r.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,r=Math.round((t-e)/i)*i;t=r+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,r,n,s,o=this.options.range,a=this.options,l=this,h=!this._animateOff&&a.animate,u={};this._hasMultipleValues()?this.handles.each(function(r){i=100*((l.values(r)-l._valueMin())/(l._valueMax()-l._valueMin())),u["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](u,a.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===r&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},a.animate),1===r&&l.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:a.animate})):(0===r&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},a.animate),1===r&&l.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:a.animate}))),e=i}):(r=this.value(),n=this._valueMin(),s=this._valueMax(),i=s!==n?100*((r-n)/(s-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](u,a.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},a.animate),"max"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:100-i+"%"},a.animate),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},a.animate),"max"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:100-i+"%"},a.animate))},_handleEvents:{keydown:function(e){var i,r,n,s,o=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,o),i===!1))return}switch(s=this.options.step,r=n=this._hasMultipleValues()?this.values(o):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(r+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(r-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(r===this._valueMax())return;n=this._trimAlignValue(r+s);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(r===this._valueMin())return;n=this._trimAlignValue(r-s)}this._slide(e,o,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var r=null,n=!1,s=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,s.widgetName+"-item")===s?(r=t(this),!1):void 0}),t.data(e.target,s.widgetName+"-item")===s&&(r=t(e.target)),!!r&&(!(this.options.handle&&!i&&(t(this.options.handle,r).find("*").addBack().each(function(){this===e.target&&(n=!0)}),!n))&&(this.currentItem=r,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,r){var n,s,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(s=this.document.find("body"),this.storedCursor=s.css("cursor"),s.css("cursor",o.cursor),this.storedStylesheet=t("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(s)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,r,n,s,o=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+o.scrollSpeed:e.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+o.scrollSpeed:e.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(e.pageY-this.document.scrollTop()<o.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<o.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),e.pageX-this.document.scrollLeft()<o.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),a!==!1&&t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(r=this.items[i],n=r.item[0],s=this._intersectsWithPointer(r),s&&r.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===s?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],n))){if(this.direction=1===s?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(e,r),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var r=this,n=this.placeholder.offset(),s=this.options.axis,o={};s&&"x"!==s||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),s&&"y"!==s||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){r._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&r.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!r.length&&e.key&&r.push(e.key+"="),r.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},i.each(function(){r.push(t(e.item||this).attr(e.attribute||"id")||"")}),r},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,r=this.positionAbs.top,n=r+this.helperProportions.height,s=t.left,o=s+t.width,a=t.top,l=a+t.height,h=this.offset.click.top,u=this.offset.click.left,c="x"===this.options.axis||r+h>a&&l>r+h,d="y"===this.options.axis||e+u>s&&o>e+u,p=c&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>s&&o>i-this.helperProportions.width/2&&r+this.helperProportions.height/2>a&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,r="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),s=r&&n;return!!s&&(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:r&&("down"===r&&e||"up"===r&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){a.push(this)}var r,n,s,o,a=[],l=[],h=this._connectWith();if(h&&e)for(r=h.length-1;r>=0;r--)for(s=t(h[r],this.document[0]),n=s.length-1;n>=0;n--)o=t.data(s[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&l.push([t.isFunction(o.options.items)?o.options.items.call(o.element):t(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=l.length-1;r>=0;r--)l[r][0].each(i);return t(a)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,r,n,s,o,a,l,h,u=this.items,c=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),r=n.length-1;r>=0;r--)s=t.data(n[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&(c.push([t.isFunction(s.options.items)?s.options.items.call(s.element[0],e,{item:this.currentItem}):t(s.options.items,s.element),s]),this.containers.push(s));for(i=c.length-1;i>=0;i--)for(o=c[i][1],a=c[i][0],r=0,h=a.length;h>r;r++)l=t(a[r]),l.data(this.widgetName+"-item",o),u.push({item:l,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,r,n,s;for(i=this.items.length-1;i>=0;i--)r=this.items[i],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,r.item):r.item,e||(r.width=n.outerWidth(),r.height=n.outerHeight()),s=n.offset(),r.left=s.left,r.top=s.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)s=this.containers[i].element.offset(),this.containers[i].containerCache.left=s.left,this.containers[i].containerCache.top=s.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,r=e.options;r.placeholder&&r.placeholder.constructor!==String||(i=r.placeholder,r.placeholder={element:function(){var r=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+r+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===r?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===r?e._createTrPlaceholder(e.currentItem,n):"img"===r&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||r.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(r.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),r.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var r=this;e.children().each(function(){t("<td>&#160;</td>",r.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,r,n,s,o,a,l,h,u,c,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,s=null,u=d.floating||this._isFloating(this.currentItem),o=u?"left":"top",a=u?"width":"height",c=u?"pageX":"pageY",r=this.items.length-1;r>=0;r--)t.contains(this.containers[p].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(l=this.items[r].item.offset()[o],h=!1,e[c]-l>this.items[r][a]/2&&(h=!0),n>Math.abs(e[c]-l)&&(n=Math.abs(e[c]-l),s=this.items[r],this.direction=h?"up":"down"));if(!s&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));s?this._rearrange(e,s,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,r=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||i.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||i.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,r,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),r="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(r?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(r?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var r="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())*r}},_generatePosition:function(e){var i,r,n=this.options,s=e.pageX,o=e.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,r=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0],s=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-n.grid[0]:r+n.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(t,e,i,r){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!r)})},_clear:function(t,e){function i(t,e,i){return function(r){i._trigger(t,r,e._uiHash(e))}}this.reverting=!1;var r,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)("auto"===this._storedCSS[r]||"static"===this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--)e||n.push(i("deactivate",this,this.containers[r])),this.containers[r].containerCache.over&&(n.push(i("out",this,this.containers[r])),
this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(r=0;n.length>r;r++)n[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,r){var n=i.attr(r);null!=n&&n.length&&(e[r]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=r,this._delay(function(){this.previous=r}))}var r;r=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)!==!1&&void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,r=t.ui.keyCode;switch(e.keyCode){case r.UP:return this._repeat(null,1,e),!0;case r.DOWN:return this._repeat(null,-1,e),!0;case r.PAGE_UP:return this._repeat(null,i.page,e),!0;case r.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return!(!this.spinning&&this._trigger("start",t)===!1)&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,r=this.options;return e=null!==r.min?r.min:0,i=t-e,i=Math.round(i/r.step)*r.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==r.max&&t>r.max?r.max:null!==r.min&&r.min>t?r.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,r,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,void this.element.val(this._format(i))):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(r=this.buttons.first().find(".ui-icon"),this._removeClass(r,null,this.options.icons.up),this._addClass(r,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),void this._super(t,e))},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:a(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null!==t&&t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:a(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:a(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:a(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:a(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void a(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,r;i=e.href.replace(t,""),r=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(t){}try{r=decodeURIComponent(r)}catch(t){}return e.hash.length>1&&i===r}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,r=location.hash.substring(1);return null===e&&(r&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===r?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=!!this.tabs.length&&0)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=!i&&0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),r=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:r++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,r--;break;case t.ui.keyCode.END:r=this.anchors.length-1;break;case t.ui.keyCode.HOME:r=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(r);case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(r!==this.options.active&&r);default:return}e.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function r(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(r(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?void this._activate(e):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),void("heightStyle"===t&&this._setupHeightStyle(e)))},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,r=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,r){var n,s,o,a=t(r).uniqueId().attr("id"),l=t(r).closest("li"),h=l.attr("aria-controls");e._isLocal(r)?(n=r.hash,o=n.substring(1),s=e.element.find(e._sanitizeSelector(n))):(o=l.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+o,s=e.element.find(n),s.length||(s=e._createPanel(o),s.insertAfter(e.panels[i-1]||e.tablist)),s.attr("aria-live","polite")),s.length&&(e.panels=e.panels.add(s)),h&&l.data("ui-tabs-aria-controls",h),l.attr({"aria-controls":o,"aria-labelledby":a}),s.attr("aria-labelledby",a)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(r.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,r,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;r=this.tabs[n];n++)i=t(r),e===!0||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,e===!0)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,r=this.element.parent();"fill"===e?(i=r.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),r=e.css("position");"absolute"!==r&&"fixed"!==r&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,r=this.active,n=t(e.currentTarget),s=n.closest("li"),o=s[0]===r[0],a=o&&i.collapsible,l=a?t():this._getPanelForTab(s),h=r.length?this._getPanelForTab(r):t(),u={oldTab:r,oldPanel:h,newTab:a?t():s,newPanel:l};e.preventDefault(),s.hasClass("ui-state-disabled")||s.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||this._trigger("beforeActivate",e,u)===!1||(i.active=!a&&this.tabs.index(s),this.active=o?t():s,this.xhr&&this.xhr.abort(),h.length||l.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(s),e),this._toggle(e,u))},_toggle:function(e,i){function r(){s.running=!1,s._trigger("activate",e,i)}function n(){s._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),o.length&&s.options.show?s._show(o,s.options.show,r):(o.show(),r())}var s=this,o=i.newPanel,a=i.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){s._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),a.hide(),n()),a.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),o.length&&a.length?i.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),o.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,r=this._findActive(e);r[0]!==this.active[0]&&(r.length||(r=this.active),i=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var r=this,n=this.tabs.eq(e),s=n.find(".ui-tabs-anchor"),o=this._getPanelForTab(n),a={tab:n,panel:o},l=function(t,e){"abort"===e&&r.panels.stop(!1,!0),r._removeClass(n,"ui-tabs-loading"),o.removeAttr("aria-busy"),t===r.xhr&&delete r.xhr};this._isLocal(s[0])||(this.xhr=t.ajax(this._ajaxSettings(s,i,a)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),o.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){o.html(t),r._trigger("load",i,a),l(n,e)},1)}).fail(function(t,e){setTimeout(function(){l(t,e)},1)})))},_ajaxSettings:function(e,i,r){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,s){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:s},r))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.uiBackCompat!==!1&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var r=(e.attr("aria-describedby")||"").split(/\s+/);r.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(r.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),r=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,r);-1!==n&&r.splice(n,1),e.removeData("ui-tooltip-id"),r=t.trim(r.join(" ")),r?e.attr("aria-describedby",r):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var r=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){r._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,r){var n=t.Event("blur");n.target=n.currentTarget=r.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,r=t(e?e.target:this.element).closest(this.options.items);r.length&&!r.data("ui-tooltip-id")&&(r.attr("title")&&r.data("ui-tooltip-title",r.attr("title")),r.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&r.parents().each(function(){var e,r=t(this);r.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),r.attr("title")&&(r.uniqueId(),i.parents[this.id]={element:this,title:r.attr("title")},r.attr("title",""))}),this._registerCloseHandlers(e,r),this._updateContent(r,e))},_updateContent:function(t,e){var i,r=this.options.content,n=this,s=e?e.type:null;return"string"==typeof r||r.nodeType||r.jquery?this._open(e,t,r):(i=r.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=s),this._open(e,t,i))})}),void(i&&this._open(e,t,i)))},_open:function(e,i,r){function n(t){h.of=t,o.is(":hidden")||o.position(h)}var s,o,a,l,h=t.extend({},this.options.position);if(r){if(s=this._find(i))return void s.tooltip.find(".ui-tooltip-content").html(r);i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),s=this._tooltip(i),o=s.tooltip,this._addDescribedBy(i,o.attr("id")),o.find(".ui-tooltip-content").html(r),this.liveRegion.children().hide(),l=t("<div>").html(o.find(".ui-tooltip-content").html()),l.removeAttr("name").find("[name]").removeAttr("name"),l.removeAttr("id").find("[id]").removeAttr("id"),l.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):o.position(t.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(a=this.delayedShow=setInterval(function(){o.is(":visible")&&(n(h.of),clearInterval(a))},t.fx.interval)),this._trigger("open",e,{tooltip:o})}},_registerCloseHandlers:function(e,i){var r={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var r=t.Event(e);r.currentTarget=i[0],this.close(r,!0)}}};i[0]!==this.element[0]&&(r.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(r.mouseleave="close"),e&&"focusin"!==e.type||(r.focusout="close"),this._on(!0,i,r)},close:function(e){var i,r=this,n=t(e?e.currentTarget:this.element),s=this._find(n);return s?(i=s.tooltip,void(s.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),s.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){r._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete r.parents[e]}),s.closing=!0,this._trigger("close",e,{tooltip:i}),s.hiding||(s.closing=!1)))):void n.removeData("ui-tooltip-open")},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),r=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(r,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,r){var n=t.Event("blur"),s=r.element;n.target=n.currentTarget=s[0],e.close(n,!0),t("#"+i).remove(),s.data("ui-tooltip-title")&&(s.attr("title")||s.attr("title",s.data("ui-tooltip-title")),s.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),t.uiBackCompat!==!1&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip}),r("Services/ImageProcessingCore",["jquery","../Renderer/FeatureStyle","jquery.ui"],function(t,e){function i(){h.dialog("isOpen")?h.dialog("close"):h.dialog("open")}function r(e){s&&s.properties.identifier===e.feature.properties.identifier?this.toggle():h.dialog("isOpen")||this.toggle(),s=e.feature,o=e.layer,e.feature.services&&c.setUrl(e.feature.services.download.url);var i=e.feature.properties.style.uniformValues;i?this.setImage(i):h.find(".histogramContent").children("div").fadeOut(function(){t(this).siblings("p").fadeIn()})}function n(e){u.setImage(e),e.url&&c.setUrl(e.url),h.find(".histogramContent").children("p").fadeOut(function(){t(this).siblings("div").fadeIn()})}var s,o,a,l,h,u,c;return{init:function(t,e,i,r){t&&(s=t.feature||null,o=t.layer||null,a=t.disable||null,l=t.unselect||null),h=e,u=i,c=r},setData:r,setImage:n,toggle:i}}),r("Services/MeasureToolPlanetCore",["jquery","underscore-min","../Utils/Constants","../Layer/VectorLayer","../Renderer/Ray","../Utils/Numeric","../Renderer/FeatureStyle","../Renderer/glMatrix"],function(t,e,i,r,n,s,o){function a(t){if(t.preventDefault(),I.activated){_.stop(),S=!0,I.elevations=[],t.type.search("touch")>=0?I.pickPoint=[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:I.pickPoint=[t.layerX,t.layerY];var e=w.getActivatedContext().getLonLatFromPixel(I.pickPoint[0],I.pickPoint[1]);return null===e?null:(I.geoPickPoint=w.getActivatedContext().getLonLatFromPixel(I.pickPoint[0],I.pickPoint[1]),I.geoPickPoint)}}function l(t){t.preventDefault();var i;if(i=t.type.search("touch")>=0?w.getActivatedContext().getLonLatFromPixel(t.changedTouches[0].clientX,t.changedTouches[0].clientY):w.getActivatedContext().getLonLatFromPixel(t.layerX,t.layerY),!e.isEmpty(i)){var r=vec3.dot(vec3.normalize(w.getCrs().get3DFromWorld(i)),vec3.normalize(w.getCrs().get3DFromWorld(I.geoPickPoint))),n=Math.acos(r);I.geoDistance=s.toDegree(n),C&&C()}_.start(),S=!1}function h(t){if(t.preventDefault(),I.activated&&S){t.type.search("touch")>=0?I.secondPickPoint=[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:I.secondPickPoint=[t.layerX,t.layerY];var e=w.getActivatedContext().getLonLatFromPixel(I.secondPickPoint[0],I.secondPickPoint[1]);if(null!==e){I.secondGeoPickPoint=w.getActivatedContext().getLonLatFromPixel(I.secondPickPoint[0],I.secondPickPoint[1]),I.distance=Math.sqrt(Math.pow(I.secondPickPoint[0]-I.pickPoint[0],2)+Math.pow(I.secondPickPoint[1]-I.pickPoint[1],2));var i;i=void 0===I.secondGeoPickPoint?vec3.dot(vec3.normalize(w.getCrs().get3DFromWorld(I.secondPickPoint)),vec3.normalize(w.getCrs().get3DFromWorld(I.geoPickPoint))):vec3.dot(vec3.normalize(w.getCrs().get3DFromWorld(I.secondGeoPickPoint)),vec3.normalize(w.getCrs().get3DFromWorld(I.geoPickPoint)));var r=Math.acos(i);I.geoDistance=s.toDegree(r),g()}}}function u(t){var e=I.renderContext,i=mat4.create();mat4.inverse(e.viewMatrix,i);var r=[i[12],i[13],i[14]];mat4.multiply(e.projectionMatrix,e.viewMatrix,i),mat4.inverse(i);for(var s=[0,0,0],o=0;o<t.length;o++){mat4.multiplyVec4(i,t[o]),vec3.scale(t[o],1/t[o][3]),vec3.subtract(t[o],r,t[o]),vec3.normalize(t[o]);var a=new n(r,t[o]),l=a.computePoint(a.sphereIntersect(s,w.getCrs().getGeoide().getRadius()));t[o]=w.getCrs().getWorldFrom3D(l)}return t}function c(t,e){e=e*Math.PI/180;var i=Math.cos(e),r=Math.sin(e);return[t[0]*i-t[1]*r,t[0]*r+t[1]*i]}function d(t,e){e||(e=t);var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return e[0]=t[0]/i,e[1]=t[1]/i,e}function p(){var t,e=I.renderContext,r=2/e.canvas.width,n=2/e.canvas.height;if(w.getActivatedContext().getNavigation().getType()===i.NAVIGATION.FlatNavigation)return t=[[I.geoPickPoint[0],I.geoPickPoint[1],1],[I.secondGeoPickPoint[0],I.secondGeoPickPoint[1],1]];var s=[I.secondPickPoint[0]-I.pickPoint[0],I.secondPickPoint[1]-I.pickPoint[1]];d(s);var o=c(s,30),a=c(s,-30);o=[I.pickPoint[0]+10*o[0],I.pickPoint[1]+10*o[1]],a=[I.pickPoint[0]+10*a[0],I.pickPoint[1]+10*a[1]];var l=[-s[0],-s[1]],h=c(l,30),u=c(l,-30);return h=[I.secondPickPoint[0]+10*h[0],I.secondPickPoint[1]+10*h[1]],u=[I.secondPickPoint[0]+10*u[0],I.secondPickPoint[1]+10*u[1]],t=[[o[0]*r-1,(e.canvas.height-o[1])*n-1,1,1],[I.pickPoint[0]*r-1,(e.canvas.height-I.pickPoint[1])*n-1,1,1],[a[0]*r-1,(e.canvas.height-a[1])*n-1,1,1],[I.pickPoint[0]*r-1,(e.canvas.height-I.pickPoint[1])*n-1,1,1]],t.push([I.secondPickPoint[0]*r-1,(e.canvas.height-I.secondPickPoint[1])*n-1,1,1],[h[0]*r-1,(e.canvas.height-h[1])*n-1,1,1],[I.secondPickPoint[0]*r-1,(e.canvas.height-I.secondPickPoint[1])*n-1,1,1],[u[0]*r-1,(e.canvas.height-u[1])*n-1,1,1]),I.computeIntersection(t),t}function f(){I.clear(),w.getPlanetContext().removeDraw(A)}function g(){I.clear();var t=I.computeMeasure();I.measureFeature={geometry:{gid:"measureShape",coordinates:t,type:i.GEOMETRY.LineString,crs:{type:"name",properties:{name:w.getCrs().getGeoideName()}}},properties:{style:new o({fillColor:[1,0,0,1]})},type:"Feature"};var e=[(I.secondPickPoint[0]+I.pickPoint[0])/2,(I.secondPickPoint[1]+I.pickPoint[1])/2],r=w.getActivatedContext().getLonLatFromPixel(e[0],e[1]),n=I.calculateDistanceElevation(I.geoPickPoint,I.secondGeoPickPoint);n=s.roundNumber(n.toFixed(3),2),I.measureLabel={geometry:{type:i.GEOMETRY.Point,gid:"measureShape",coordinates:r,crs:{type:"name",properties:{name:w.getCrs().getGeoideName()}}},properties:{style:new o({label:n+" km",fillColor:[1,1,1,1],pointMaxSize:600,extrusionScale:-1e5})}},A.addFeature(I.measureFeature),A.addFeature(I.measureLabel)}function m(){I.measureFeature&&A.removeFeature(I.measureFeature),I.measureLabel&&A.removeFeature(I.measureLabel)}function v(t,e,i){var r,n=50|t.scale,s=e[0]-i[0];s>180?(s=360-s,r=-s/n):s<-180?(s=360+s,r=s/n):r=s/n;var o=(e[1]-i[1])/n,a=[];a[0]=e;for(var l=1;l<n;l++){var h=a[l-1][0]-r;h>180?h-=360:h<-180&&(h+=360);var u=a[l-1][1]-o;a[l]=[h,u]}return a[n]=i,a}function y(t,e){var i=w.getCrs().getGeoide().getRealPlanetRadius(),r=s.toRadian(t[1]),n=s.toRadian(e[1]),o=s.toRadian(e[1]-t[1]),a=s.toRadian(e[0]-t[0]),l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(r)*Math.cos(n)*Math.sin(a/2)*Math.sin(a/2),h=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),u=i*h;return u/1e3}function b(t,e){var i=I.calculateDistanceElevation(t,e);i=s.roundNumber(i.toFixed(3),2);var r=w.getActivatedContext().getElevation(e[0],e[1]);r=s.roundNumber(r/T,0);var n=[i,r];I.elevations.push(n)}function x(t){w=t,
_=w.getActivatedContext().getNavigation(),T=w.getActivatedContext().planetLayer.elevationLayer.scale,S=!1,A||(A=new r),w.getPlanetContext().addDraw(A),this.activated=!1,this.renderContext=w.getRenderContext(),this.elevations=[],this.measureFeature=null}var _,w,C,T,A,I,S;return{init:function(t){w=t.mizar,_=w.getActivatedContext().getNavigation(),C=t.onselect,T=w.getActivatedContext().planetLayer.elevationLayer.scale,I=this,S=!1,A=w.LayerFactory.create({type:i.LAYER.Vector,visible:!0}),w.getPlanetContext().addDraw(A),this.activated=!1,this.renderContext=w.getRenderContext(),this.elevations=[],this.measureFeature=null},_handleMouseDown:a,_handleMouseUp:l,_handleMouseMove:h,clear:m,remove:f,updateContext:x,calculateIntermediateElevationPoint:v,calculateDistanceElevation:y,computeMeasure:p,computeIntersection:u,storeDistanceAndElevation:b}}),r("Services/MeasureToolSkyCore",["jquery","underscore-min","../Utils/Numeric","../Utils/Constants","../Layer/VectorLayer","../Renderer/Ray","../Renderer/FeatureStyle","../Renderer/glMatrix"],function(t,e,i,r,n,s,o){function a(t){t.preventDefault(),_.activated&&(_.distance=0,y.stop(),w=!0,_.elevations=[],t.type.search("touch")>=0?_.pickPoint=[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:_.pickPoint=[t.layerX,t.layerY],_.geoPickPoint=v.getActivatedContext().getLonLatFromPixel(_.pickPoint[0],_.pickPoint[1]))}function l(t){if(t.preventDefault(),_.activated){var e;e=t.type.search("touch")>=0?v.getActivatedContext().getLonLatFromPixel(t.changedTouches[0].clientX,t.changedTouches[0].clientY):v.getActivatedContext().getLonLatFromPixel(t.layerX,t.layerY);var r=vec3.dot(vec3.normalize(v.getCrs().get3DFromWorld(e)),vec3.normalize(v.getCrs().get3DFromWorld(_.geoPickPoint))),n=Math.acos(r);_.geoDistance=i.toDegree(n),b&&b(),y.start(),w=!1}}function h(t){if(t.preventDefault(),_.activated&&w){t.type.search("touch")>=0?_.secondPickPoint=[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:_.secondPickPoint=[t.layerX,t.layerY],_.secondGeoPickPoint=v.getActivatedContext().getLonLatFromPixel(_.secondPickPoint[0],_.secondPickPoint[1]),_.distance=Math.sqrt(Math.pow(_.secondPickPoint[0]-_.pickPoint[0],2)+Math.pow(_.secondPickPoint[1]-_.pickPoint[1],2));var e=vec3.dot(vec3.normalize(v.getCrs().get3DFromWorld(_.secondGeoPickPoint)),vec3.normalize(v.getCrs().get3DFromWorld(_.geoPickPoint))),r=Math.acos(e);_.geoDistance=i.toDegree(r),_.updateMeasure()}}function u(t){var e=_.renderContext,i=mat4.create();mat4.inverse(e.viewMatrix,i);var r=[i[12],i[13],i[14]];mat4.multiply(e.projectionMatrix,e.viewMatrix,i),mat4.inverse(i);for(var n=[0,0,0],o=0;o<t.length;o++){mat4.multiplyVec4(i,t[o]),vec3.scale(t[o],1/t[o][3]),vec3.subtract(t[o],r,t[o]),vec3.normalize(t[o]);var a=new s(r,t[o]),l=a.computePoint(a.sphereIntersect(n,v.getCrs().getGeoide().getRadius()));t[o]=v.getCrs().getWorldFrom3D(l)}return t}function c(t,e){e=e*Math.PI/180;var i=Math.cos(e),r=Math.sin(e);return[t[0]*i-t[1]*r,t[0]*r+t[1]*i]}function d(t,e){e||(e=t);var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return e[0]=t[0]/i,e[1]=t[1]/i,e}function p(){var t=_.renderContext,e=2/t.canvas.width,i=2/t.canvas.height,r=[_.secondPickPoint[0]-_.pickPoint[0],_.secondPickPoint[1]-_.pickPoint[1]];d(r);var n=c(r,30),s=c(r,-30);n=[_.pickPoint[0]+10*n[0],_.pickPoint[1]+10*n[1]],s=[_.pickPoint[0]+10*s[0],_.pickPoint[1]+10*s[1]];var o=[-r[0],-r[1]],a=c(o,30),l=c(o,-30);a=[_.secondPickPoint[0]+10*a[0],_.secondPickPoint[1]+10*a[1]],l=[_.secondPickPoint[0]+10*l[0],_.secondPickPoint[1]+10*l[1]];var h=[[_.pickPoint[0]*e-1,(t.canvas.height-_.pickPoint[1])*i-1,1,1],[n[0]*e-1,(t.canvas.height-n[1])*i-1,1,1],[_.pickPoint[0]*e-1,(t.canvas.height-_.pickPoint[1])*i-1,1,1],[s[0]*e-1,(t.canvas.height-s[1])*i-1,1,1],[_.pickPoint[0]*e-1,(t.canvas.height-_.pickPoint[1])*i-1,1,1],[_.secondPickPoint[0]*e-1,(t.canvas.height-_.secondPickPoint[1])*i-1,1,1],[a[0]*e-1,(t.canvas.height-a[1])*i-1,1,1],[_.secondPickPoint[0]*e-1,(t.canvas.height-_.secondPickPoint[1])*i-1,1,1],[l[0]*e-1,(t.canvas.height-l[1])*i-1,1,1],[_.secondPickPoint[0]*e-1,(t.canvas.height-_.secondPickPoint[1])*i-1,1,1]];return this.computeIntersection(h),h}function f(){_.clear();var t=_.computeMeasure();t.push(t[0]),_.measureFeature={geometry:{gid:"measureShape",coordinates:[t],type:r.GEOMETRY.Polygon,crs:{type:"name",properties:{name:v.getCrs().getGeoideName()}}},properties:{style:new o({zIndex:2,fillColor:[1,0,0,1]})},type:"Feature"};var e=[(_.secondPickPoint[0]+_.pickPoint[0])/2,(_.secondPickPoint[1]+_.pickPoint[1])/2],i=v.getActivatedContext().getLonLatFromPixel(e[0],e[1]);_.measureLabel={geometry:{type:r.GEOMETRY.Point,gid:"measureShape",coordinates:i,crs:{type:"name",properties:{name:v.getCrs().getGeoideName()}}},properties:{style:new o({label:v.getCrs().fromDegreesToDMS(_.geoDistance),fillColor:[1,1,1,1],zIndex:2})}},x.addFeature(_.measureFeature),x.addFeature(_.measureLabel)}function g(){_.measureFeature&&x.removeFeature(_.measureFeature),_.measureLabel&&x.removeFeature(_.measureLabel)}function m(){_.clear(),v.getSkyContext().removeDraw(x)}var v,y,b,x,_,w;return{init:function(t){v=t.mizar,y=v.getActivatedContext().getNavigation(),b=t.onselect,_=this,w=!1,x=v.LayerFactory.create({type:r.LAYER.Vector,visible:!0}),v.getSkyContext().addDraw(x),this.activated=!1,this.renderContext=v.getRenderContext(),this.elevations=[],this.measureFeature=null},_handleMouseDown:a,_handleMouseUp:l,_handleMouseMove:h,updateMeasure:f,clear:g,remove:m,computeMeasure:p,computeIntersection:u}}),r("Services/MocBase",["jquery","../Renderer/FeatureStyle","../Layer/MocLayer","../Utils/Numeric","../Layer/FitsLoader","../Tiling/HEALPixBase"],function(t,e,i,r,n,s){function o(e,i,r){e.serviceUrl&&1!==e.serviceUrl.search(/[\/.fits]+$/g)?(e.describeUrl=e.serviceUrl,i(e)):t.ajax({type:"GET",url:e.serviceUrl,success:function(n){var s=t(n).find('Url[rel="mocdesc"]'),o=t(s).attr("template");if(o){var a=o.indexOf("?q=");a!==-1&&(o=o.substring(0,a)),e.describeUrl=o,i(e)}else e.describeUrl="Not available",e.coverage="Not available",r&&r(e)},error:function(t){e.describeUrl="Not available",e.coverage="Not available",r&&r(e)}})}function a(t,e,i){if("Not available"!==t.coverage){var r="?media=txt";t.describeUrl?(t.describeUrl.lastIndexOf("?")>0&&(r="&media=txt"),l(t,t.describeUrl+r,e)):o(t,function(t){t.describeUrl.lastIndexOf("?")>0&&(r="&media=txt"),l(t,t.describeUrl+r,e)},i)}else i(t)}function l(t,e){this.getSkyCoverage(t,function(t){e(t.coverage)},function(t){e(t.coverage)})}function h(t,e,i){if("Not available"!==t.describeUrl)if(t.describeUrl){u(t,t.describeUrl);var r=t.describeUrl;String(r).endsWith(".fits")||(r+="?media=txt"),l(t,r,e)}else o(t,function(t){u(t,t.describeUrl);var i=t.describeUrl;String(i).endsWith(".fits")||(i+="?media=txt"),l(t,i,e)},i);else i(t)}function l(e,i,o){e.hasOwnProperty("properties")&&e.properties.hasOwnProperty("mocCoverage")&&(e.coverage=r.roundNumber(100*parseFloat(e.properties.mocCoverage),5)+"%"),e.coverage?o(e):String(i).endsWith(".fits")?n.loadFits(i,function(t){for(var i={},n=t.getHDU(1).data,a=0;a<n.rows;a++){var l=n.getRow(a),h=s.uniq2hpix(l[n.columns[0]]),u=h[0];void 0===i[u]&&(i[u]=[]),i[u].push(h[1])}var c;_.each(i,function(t,e){c=parseInt(e,10)});var d=c+1;_.isNumber(response)?e.coverage=r.roundNumber(100*p(d,i),5)+"%":e.coverage="Not available",o&&o(e)}):t.ajax({type:"GET",url:i,success:function(t){_.isNumber(t)?e.coverage=r.roundNumber(parseFloat(t),5)+"%":e.coverage="Not available",o&&o(e)}})}function u(t,e){var r=(t.style,new i({serviceUrl:e,style:t.style,visible:!1}));r.style.fill=!0,r.style.fillColor[3]=.3,t.globe.addLayer(r),t.subLayers||(t.subLayers=[]),t.subLayers.push(r)}function c(t){if(t.subLayers)for(var e=0;e<t.subLayers.length;e++)if(t.subLayers[e]instanceof i)return t.subLayers[e];return null}function d(t){for(var r=b,n="",s=0;s<t.length;s++){var o=t[s];n+=o.name,r+=o.describeUrl,s!==t.length-1&&(r+=";",n+=" x ")}return intersectionLayer=new i({name:"Intersection( "+n+" )",serviceUrl:r+"&media=json",style:new e({rendererHint:"Basic",fill:!0,fillColor:[1,0,0,.3]}),visible:!1}),y.getSkyContext().globe.addLayer(intersectionLayer),intersectionLayer.describeUrl=r,intersectionLayer}function p(t,e){var i=g(t);return 0===i?0:f(t,e)/i}function f(t,e){for(var i=0,r=1,n=t-1;n>=0;n--,r*=4)i+=m(n,e)*r;return i}function g(t){if(0===t)return 0;var e=v(t-1);return 12*e*e}function m(t,e){return e[t]?e[t].length:0}function v(t){return 1<<t}var y,b;return{init:function(t,e){y=t,b="TODO must use AbstractLayer to get info"},createMocSublayer:h,findMocSublayer:c,getSkyCoverage:a,requestSkyCoverage:l,intersectLayers:d}}),r("Services/MollweideViewerCore",["jquery","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(t,e,i){function r(t){if(Math.abs(t)===Math.PI/2)return t;var e,i,r=.001;do{e=i,e||(e=t);var n=2*e;i=n/2-(n+Math.sin(n)-Math.PI*Math.sin(t))/(2+2*Math.cos(n))}while(Math.abs(i-e)>=r);return i}function n(t){var e=l.getCrs(),i=e.getWorldFrom3D(t);i[0]>180&&(i[0]-=360);var n=i[0]*Math.PI/180,s=i[1]*Math.PI/180,o=r(s),a=2*Math.sqrt(2)/Math.PI*n*Math.cos(o),h=Math.sqrt(2)*Math.sin(o),u=-a*f/2.8+f+c,g=-h*p/1.38+p+d;return[u,g]}function s(t){m.x=2.8*-(t[0]-f-c)/f,m.y=1.38*-(t[1]-p-d)/p;var e=Math.asin(m.y/Math.sqrt(2)),i=Math.asin((2*e+Math.sin(2*e))/Math.PI),r=Math.PI*m.x/(2*Math.sqrt(2)*Math.cos(e)),n=[180*r/Math.PI,180*i/Math.PI];l.getCrs().get3DFromWorld(n,u.center3d),u.computeViewMatrix()}function o(){y.clearRect(0,0,y.canvas.width,y.canvas.height),y.drawImage(x,0,0),y.fillStyle="rgb(255,0,0)";for(var r,s,o,a=l.getRenderContext().canvas.clientWidth/(g-1),h=l.getRenderContext().canvas.clientHeight/(g-1),c=0;c<g;c++)for(var d=0;d<g;d++)r=i.createFromPixel(l.getRenderContext(),c*a,d*h),s=r.computePoint(r.sphereIntersect([0,0,0],l.getCrs().getGeoide().getRadius())),o=n(s),y.fillRect(o[0],o[1],2,2);y.fillStyle=m.color,o=n(u.center3d),m.x=o[0]-m.size/2,m.y=o[1]-m.size/2,y.fillRect(o[0]-m.size/2,o[1]-m.size/2,m.size,m.size);var p=u.getFov(),f=e.roundNumber(p[0],2);f=l.getCrs().fromDegreesToDMS(f);var v=e.roundNumber(p[1],2);v=l.getCrs().fromDegreesToDMS(v),t("#fov").html("Fov : "+f+" x "+v)}function a(e){t(b.getImageObj()).attr("src",h+"css/images/MollweideSky_"+e.getGeoideName()+".png")}var l,h,u,c,d,p,f,g,m,v,y,b,x,_=function(t){this.x=0|t.x,this.y=0|t.y,this.color="rgb(255,0,0)"|t.color,this.size=2|t.size;for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])};return{init:function(t){l=t.mizar,h=t.mizarBaseUrl,u=l.getActivatedContext().getNavigation(),c=16,d=8,p=50,f=100,g=9,m=new _({size:5,color:"rgb(255,255,0)"}),v=document.getElementById("mollweideCanvas"),y=v.getContext("2d"),b=this,x=new Image,x.onload=function(){y.drawImage(x,0,0),o(x)}},getImageObj:function(){return x},_findTheta:r,computeMollweidePosition:n,updateNavigation:s,updateMollweideFov:o,updateGalaxyProjection:a}}),r("Services/PickingManagerCore",["../Renderer/FeatureStyle","../Layer/OpenSearchLayer","../Utils/Utils","../Utils/UtilsIntersection","../Utils/Constants"],function(t,e,i,r,n){function s(t){w.indexOf(t)===-1?w.push(t):console.log("WARN:"+t.name+" has been already added")}function o(t){for(var e=0;e<w.length;e++)t.id===w[e].id&&w.splice(e,1)}function a(){return w}function l(){var e=this.getSelection()[this.stackSelectionIndex];if(e){var i=new t(e.feature.properties.style);switch(e.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:i.strokeColor=e.layer.style.strokeColor;break;case n.GEOMETRY.Point:i.fillColor=e.feature.properties.style.strokeColor}i.zIndex=e.layer.style.zIndex,e.layer.modifyFeatureStyle(e.feature,i)}}function h(e,i){i&&i.isExclusive&&c();var r=i.color?t.fromStringToColor(i.color):this.selectedStyle.strokeColor,s=i.color?t.fromStringToColor(i.color):this.selectedStyle.fillColor,o=this.getSelection()[e];if(o){this.stackSelectionIndex=e;var a=new t(o.feature.properties.style);switch(o.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:a.strokeColor=r;break;case n.GEOMETRY.Point:a.fillColor=s}a.zIndex=this.selectedStyle.zIndex,o.layer.modifyFeatureStyle(o.feature,a)}_.refresh()}function u(){return C}function c(){for(var e=0;e<this.getSelection().length;e++){var i=this.getSelection()[e],r=new t(i.feature.properties.style);switch(i.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:r.strokeColor=i.layer.style.strokeColor;break;case n.GEOMETRY.Point:r.fillColor=i.feature.properties.style.strokeColor}r.zIndex=i.layer.style.zIndex,i.layer.globe&&i.layer.modifyFeatureStyle(i.feature,r)}}function d(e){for(var i,r=0;r<e.length;r++){var s=e[r];switch(i=new t(s.feature.properties.style?s.feature.properties.style:s.layer.style),s.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:i.strokeColor=this.selectedStyle.strokeColor;break;case n.GEOMETRY.Point:i.fillColor=this.selectedStyle.fillColor}i.zIndex=this.selectedStyle.zIndex,s.layer.modifyFeatureStyle(s.feature,i)}}function p(){this.blurSelection(),this.setSelection([])}function f(t,e){for(var i=!1,r=e[0][0],n=1;n<e.length&&!i;n++){var s=Math.abs(e[n][0]-r);s>180&&(i=!0)}var o;if(i){var a=[];if(t[0]<0)for(o=0;o<e.length;o++)e[o][0]>0?a[o]=[e[o][0]-360,e[o][1]]:a[o]=[e[o][0],e[o][1]];else for(o=0;o<e.length;o++)e[o][0]<0?a[o]=[e[o][0]+360,e[o][1]]:a[o]=[e[o][0],e[o][1]];return a}return e}function g(t,e){var i,s,o,a,l,h;switch(t.geometry.type){case n.GEOMETRY.LineString:for(i=0;i<t.geometry.coordinates.length-1;i++)if(a=t.geometry.coordinates[i],l=t.geometry.coordinates[i+1],r.pointInLine(e,a,l))return!0;break;case n.GEOMETRY.MultiLineString:for(i=0;i<t.geometry.coordinates.length;i++)for(s=0;s<t.geometry.coordinates[i].length-1;s++)if(a=t.geometry.coordinates[i][s],l=t.geometry.coordinates[i][s+1],r.pointInLine(e,a,l))return!0;break;case n.GEOMETRY.Polygon:return h=this.fixDateLine(e,t.geometry.coordinates[0]),r.pointInRing(e,h);case n.GEOMETRY.MultiPolygon:for(o=0;o<t.geometry.coordinates.length;o++)if(h=this.fixDateLine(e,t.geometry.coordinates[o][0]),r.pointInRing(e,h))return!0;return!1;case n.GEOMETRY.Point:var u=t.geometry.coordinates,c=t.properties.style&&t.properties.style.label;return r.pointInSphere(x,e,u,t.geometry._bucket.textureHeight)&&!c;default:return console.log("Picking for "+t.geometry.type+" is not implemented yet"),!1}}function m(t){if(!t)return[];var i,r,n,s=[];for(i=0;i<this.getPickableLayers().length;i++){var o=_.tileManager.getVisibleTile(t[0],t[1]),a=this.getPickableLayers()[i];if(a.isVisible()&&a.globe===_)if(a instanceof e){var l=o,h=l.extension[a.extId];if(!h||h.state!==e.TileState.LOADED)for(;l.parent&&(!h||h.state!==e.TileState.LOADED);)l=l.parent,h=l.extension[a.extId];if(h)for(r=0;r<h.featureIds.length;r++)n=a.features[a.featuresSet[h.featureIds[r]].index],this.featureIsPicked(n,t)&&s.push({feature:n,layer:a})}else for(r=0;r<a.features.length;r++)n=a.features[r],this.featureIsPicked(n,t)&&s.push({feature:n,layer:a});s.selectedTile=o}return s}function v(t){return C=t}function y(t,e){C.push(t),h(C-1,e)}function b(t){x=t,_=t.globe}var x,_,w=[],C=[],T=-1,A=new t({strokeColor:[1,1,0,1],fillColor:[1,1,0,1],zIndex:1});return{selectedStyle:A,stackSelectionIndex:T,init:function(t){x=t,_=t.globe},addPickableLayer:s,removePickableLayer:o,getPickableLayers:a,blurSelectedFeature:l,focusFeatureByIndex:h,getSelection:u,blurSelection:c,focusSelection:d,clearSelection:p,fixDateLine:f,featureIsPicked:g,computePickSelection:m,setSelection:v,highlightObservation:y,updateContext:b}}),r("Parser/JsonProcessor",["../Layer/HipsGraphicLayer","../Utils/Constants","../Crs/CoordinateSystemFactory"],function(t,e,i){function r(i,r){console.log("hop",i);for(var n in r.services){var s=r.services[n];switch(i.subLayers||(i.subLayers=[]),s.type){case e.LAYER.Hips:s.layer=new t({format:s.format,baseUrl:s.url,name:s.name,visible:!1,coordinates:r.geometry.coordinates[0]}),i.subLayers.push(s.layer),i.planet&&i.visible()&&i.planet.addLayer(s.layer)}}}var n=0;return{handleFeatureCollection:function(t,s){var o={type:"name",properties:{name:e.CRS.WGS84}};if(null===s||void 0===s)throw"Error, featureCollection is null";var a=s.crs?s.crs:o;t.coordinateSystem=i.create({geoideName:a.properties.name});var l=s.features;if(null===l||void 0===l)return void console.log("Error, no feature in featureCollection : ",s);var h;for(h=0;h<l.length;h++){var u=l[h];switch(u.geometry.type){case e.GEOMETRY.Point:t.dataType?"point"!==t.dataType&&(t.dataType="none"):t.dataType="point";break;case e.GEOMETRY.Polygon:case e.GEOMETRY.MultiPolygon:t.dataType?"line"!==t.dataType&&(t.dataType="none"):t.dataType="line",u.properties._imageCoordinates&&(u.geometry._imageCoordinates=u.properties._imageCoordinates)}u.geometry.crs||(u.geometry.crs=a),u.geometry.gid="jsonProc_"+n,n++,u.services&&r(t,u)}}}}),r("Gui/dialog/ErrorDialog",["jquery","jquery.ui"],function(t){var e='<div id="errorDiv" style="text-align: justify" title="Error"></div>',i=t(e).appendTo("body").dialog({autoOpen:!1,resizable:!1,draggable:!1,width:"300px",minHeight:"auto",dialogClass:"errorBox"});return{open:function(t){i.html(t).dialog("open")}}});var n=function(){var t=21012,e="/",i="samp.webhub.",r="";TYPE_STRING="string",TYPE_LIST="list",TYPE_MAP="map";var s=function(t){function e(){}return e.prototype=t,new e},o=function(t){if("string"==typeof t)return TYPE_STRING;if(t instanceof Array)return TYPE_LIST;if(t instanceof Object&&null!==t)return TYPE_MAP;throw new Error("Not legal SAMP object type: "+t)},a=function(t,e){var i,r,n=t.childNodes,s=[];for(r=0;r<n.length;r++)if(i=n[r],1===i.nodeType){if(e&&i.tagName!==e)throw new Error("Child <"+n[r].tagName+"> of <"+t.tagName+"> is not a <"+e+">");s.push(i)}return s},l=function(t,e){var i=a(t,e);if(1===i.length)return i[0];throw new Error("No sole child of <"+t.tagName+">")},h=function(t){var e,i,r="";for(e=0;e<t.childNodes.length;e++){if(i=t.childNodes[e],1===i.nodeType)throw new Error("Element found in text content");3!==i.nodeType&&4!==i.nodeType||(r+=i.nodeValue)}return r},u=function(t){return"undefined"==typeof JSON?"...":JSON.stringify(t)},c={};c.escapeXml=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},c.checkParams=function(t,e){var i;for(i=0;i<e.length;i++)if(e[i]!==TYPE_STRING&&e[i]!==TYPE_LIST&&e[i]!==TYPE_MAP)throw new Error("Unknown type "+e[i]+" in check list");var r=t.length,n=[],s=!0;for(i=0;i<r;i++)n.push(o(t[i]));for(s=s&&e.length===r,i=0;s&&i<r;i++)s=s&&e[i]===n[i];if(!s)throw new Error("Param type list mismatch: ["+e+"] != ["+n+"]")},c.valueToXml=function t(e,i){i=i||"";var r,n,s=o(e);if(s===TYPE_STRING)return i+"<value><string>"+c.escapeXml(e)+"</string></value>";if(s===TYPE_LIST){for(n=[],n.push(i+"<value>",i+"  <array>",i+"    <data>"),r=0;r<e.length;r++)n.push(t(e[r],i+"      "));return n.push(i+"    </data>",i+"  </array>",i+"</value>"),n.join("\n")}if(s===TYPE_MAP){n=[],n.push(i+"<value>"),n.push(i+"  <struct>");for(r in e)n.push(i+"    <member>"),n.push(i+"      <name>"+c.escapeXml(r)+"</name>"),n.push(t(e[r],i+"      ")),n.push(i+"    </member>");return n.push(i+"  </struct>"),n.push(i+"</value>"),n.join("\n")}throw new Error("bad type")},c.xmlToValue=function t(e,i){var r,n,s,o,u=a(e);if(0===u.length)return h(e);if(1===u.length){if(s=u[0],o=s.tagName,"string"===o)return h(s);if("array"===o){var c=a(l(s,"data"),"value"),d=[];for(r=0;r<c.length;r++)d.push(t(c[r],i));return d}if("struct"===o){var p,f,g,m=a(s,"member"),v={};for(r=0;r<m.length;r++){for(p=void 0,f=void 0,n=0;n<m[r].childNodes.length;n++)g=m[r].childNodes[n],1==g.nodeType&&("name"===g.tagName?p=h(g):"value"===g.tagName&&(f=t(g,i)));if(void 0===p||void 0===f)throw new Error("No <name> and/or <value> in <member>?");v[p]=f}return v}if(!i||"int"!==o&&"i4"!==o)throw new Error("Non SAMP-friendly value content: <"+o+">");return h(s)}throw new Error("Bad XML-RPC <value> content - multiple elements")},c.decodeParams=function(t){var e,i=a(t,"param"),r=[];for(e=0;e<i.length;e++)r.push(c.xmlToValue(l(i[e],"value")));return r},c.decodeFault=function(t){var e=c.xmlToValue(l(t,"value"),!0);return new c.Fault(e.faultString,e.faultCode)},c.decodeResponse=function(t){var e=t.documentElement;if("methodResponse"!==e.tagName)throw new Error("Response element is not <methodResponse>");var i=l(e);if("fault"===i.tagName)return c.decodeFault(i);if("params"===i.tagName)return c.decodeParams(i)[0];throw new Error("Bad XML-RPC response - unknown element <"+i.tagName+">")},c.Fault=function(t,e){this.faultString=t,this.faultCode=e},c.Fault.prototype.toString=function(){return"XML-RPC Fault ("+this.faultCode+"): "+this.faultString};var d=function(t,e){this.methodName=t,this.params=e||[]};d.prototype.toString=function(){return this.methodName+"("+u(this.params)+")"},d.prototype.addParam=function(t){return this.params.push(t),this},d.prototype.addParams=function(t){var e;for(e=0;e<t.length;e++)this.params.push(t[e]);return this},d.prototype.checkParams=function(t){c.checkParams(this.params,t)},d.prototype.toXml=function(){var t=[];t.push("<?xml version='1.0'?>","<methodCall>","  <methodName>"+this.methodName+"</methodName>","  <params>");for(var e=0;e<this.params.length;e++)t.push("    <param>",c.valueToXml(this.params[e],"      "),"    </param>");return t.push("  </params>","</methodCall>"),t.join("\n")};var p=function(i){this.endpoint=i||"http://localhost:"+t+e};p.createXHR=function(){var t=function(t){this.xhr=t,t.onreadystatechange=function(e){return function(){4===t.readyState&&(e.completed||200===+t.status&&(e.completed=!0,e.responseText=t.responseText,e.responseXML=t.responseXML,e.onload&&e.onload()))}}(this),t.onerror=function(t){return function(e){t.completed||(t.completed=!0,t.onerror&&(e?e.toString=function(){return"No hub?"}:e="No hub?",t.onerror(e)))}}(this),t.ontimeout=function(t){return function(e){t.completed||(t.completed=!0,t.onerror&&t.onerror("timeout"))}}(this)};t.prototype.open=function(t,e){this.xhr.open(t,e)},t.prototype.send=function(t){this.xhr.send(t)},t.prototype.abort=function(){this.xhr.abort()},t.prototype.setContentType=function(t){"setRequestHeader"in this.xhr&&this.xhr.setRequestHeader("Content-Type",t)};var e=function(t){this.xdr=t,t.onload=function(e){return function(){if(e.responseText=t.responseText,"text/xml"===t.contentType||"application/xml"===t.contentType||/\/x-/.test(t.contentType))try{var i=new ActiveXObject("Microsoft.XMLDOM");i.loadXML(t.responseText),e.responseXML=i}catch(t){e.responseXML=t}e.onload&&e.onload()}}(this),t.onerror=function(t){return function(e){t.onerror&&t.onerror(e)}}(this),t.ontimeout=function(t){return function(e){t.onerror&&t.onerror(e)}}(this)};if(e.prototype.open=function(t,e){this.xdr.open(t,e)},e.prototype.send=function(t){this.xdr.send(t)},e.prototype.abort=function(){this.xdr.abort()},e.prototype.setContentType=function(t){},"undefined"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;if("withCredentials"in i)return new t(i)}if("undefined"!=typeof XDomainRequest)return new e(new XDomainRequest);if("undefined"!=typeof flensed.flXHR)return new t(new flensed.flXHR({instancePooling:!0}));throw new Error("no cross-origin mechanism available")},p.prototype.execute=function(t,e,i){!function(r){var n;try{n=p.createXHR(),n.open("POST",r.endpoint),n.setContentType("text/xml")}catch(t){throw i(t),t}return n.onload=function(){var t,r=n.responseXML;if(!r)return void(i&&i("no XML response"));try{t=c.decodeResponse(r)}catch(t){return void(i&&i(t))}t instanceof c.Fault?i&&i(t):e&&e(t)},n.onerror=function(t){t?t.toString=function(){return"No hub?"}:t="No hub",i&&i(t)},n.send(t.toXml()),n}(this)};var f=function(t,e){this["samp.mtype"]=t,this["samp.params"]=e},g=function(t){if(this.regInfo=t,this.privateKey=t["samp.private-key"],"string"===(this.privateKey,!1))throw new Error("Bad registration object");this.xClient=new p};!function(){var t,e={call:[TYPE_STRING,TYPE_STRING,TYPE_MAP],callAll:[TYPE_STRING,TYPE_MAP],callAndWait:[TYPE_STRING,TYPE_MAP,TYPE_STRING],declareMetadata:[TYPE_MAP],declareSubscriptions:[TYPE_MAP],getMetadata:[TYPE_STRING],getRegisteredClients:[],getSubscribedClients:[TYPE_STRING],getSubscriptions:[TYPE_STRING],notify:[TYPE_STRING,TYPE_MAP],notifyAll:[TYPE_MAP],ping:[],reply:[TYPE_STRING,TYPE_MAP]};for(t in e)!function(t,e){g.prototype[t]=function(r,n,s){var o=function(t){return function(){t.close()}}(this);s=s||o,c.checkParams(r,e);var a=new d(i+t);return a.addParam(this.privateKey),a.addParams(r),this.xClient.execute(a,n,s)}}(t,e[t])}(),g.prototype.unregister=function(){if(this.callbackRequest)try{this.callbackRequest.abort()}catch(t){}var t=new d(i+"unregister");t.addParam(this.privateKey);try{this.xClient.execute(t)}catch(t){}delete this.regInfo,delete this.privateKey},g.prototype.close=function(){if(!this.closed){this.closed=!0;try{this.regInfo&&this.unregister()}catch(t){}if(this.onclose){oc=this.onclose,delete this.onclose;try{oc()}catch(t){}}}},g.prototype.setCallable=function(t,e){if(this.callbackRequest)try{this.callbackRequest.abort()}catch(t){}finally{delete this.callbackRequest}if(t||this.regInfo){var n=new d(i+"allowReverseCallbacks");n.addParam(this.privateKey),n.addParam(t?"1":"0");var s=function(t){return function(){t.close()}}(this);t?!function(a){var l,h=function(e){var i=e["samp.methodName"],n=e["samp.params"],s=void 0;i===r+"receiveNotification"?s=t.receiveNotification:i===r+"receiveCall"?s=t.receiveCall:i===r+"receiveResponse"&&(s=t.receiveResponse),s&&s.apply(t,n)},u=function(t){if(o(t)!=TYPE_LIST)return void c(new Error("pullCallbacks result not List"));var e;for(e=0;e<t.length;e++)try{h(t[e])}catch(t){}p()},c=function(t){var e=(new Date).getTime()-l;e<1e3?a.close():p()},p=function(){if(a.regInfo){var t=new d(i+"pullCallbacks");t.addParam(a.privateKey),t.addParam("600"),l=(new Date).getTime(),a.callbackRequest=a.xClient.execute(t,u,c)}},f=function(){p(),e()};a.xClient.execute(n,f,s)}(this):this.xClient.execute(n,e,s)}},g.prototype.translateUrl=function(t){var e=this.regInfo["samp.url-translator"]||"";return e+t},g.Action=function(t,e,i){this.actName=t,this.actArgs=e,this.resultKey=i};var m=function(t){this.callHandler={},this.replyHandler={}};m.prototype.init=function(t){},m.prototype.receiveNotification=function(t,e){var i=e["samp.mtype"],r=!1;if(i in this.callHandler){try{this.callHandler[i](t,e,!1)}catch(t){}r=!0}return r},m.prototype.receiveCall=function(t,e,i){var r,n,s=i["samp.mtype"],o=!1;if(s in this.callHandler)try{n=this.callHandler[s](t,i,!0)||{},r={"samp.status":"samp.ok","samp.result":n},o=!0}catch(t){r={"samp.status":"samp.error","samp.error":{"samp.errortxt":t.toString()}}}else r={"samp.status":"samp.warning","samp.result":{},"samp.error":{"samp.errortxt":"no action"}};return this.connection.reply([e,r]),o},m.prototype.receiveResponse=function(t,e,i){var r=!1;if(e in this.replyHandler)try{this.replyHandler[e](t,e,i),r=!0}catch(t){}return r},m.prototype.calculateSubscriptions=function(){var t,e={};for(t in this.callHandler)e[t]={};return e};var v=function(){var t=this;this.ids={},this.metas={},this.subs={},this.replyHandler={},this.callHandler={"samp.hub.event.shutdown":function(e,i){t.connection.close()},"samp.hub.disconnect":function(e,i){t.connection.close()},"samp.hub.event.register":function(e,i){var r=i["samp.params"].id;t.ids[r]=!0,t.changed(r,"register",null)},"samp.hub.event.unregister":function(e,i){var r=i["samp.params"].id;delete t.ids[r],delete t.metas[r],delete t.subs[r],t.changed(r,"unregister",null)},"samp.hub.event.metadata":function(e,i){var r=i["samp.params"].id,n=i["samp.params"].metadata;t.metas[r]=n,t.changed(r,"meta",n)},"samp.hub.event.subscriptions":function(e,i){var r=i["samp.params"].id,n=i["samp.params"].subscriptions;t.subs[r]=n,t.changed(r,"subs",n)}}};v.prototype=s(m.prototype),v.prototype.changed=function(t,e,i){this.onchange&&this.onchange(t,e,i)},v.prototype.init=function(t){var e=this;this.connection=t;var i=function(i,r,n,s){t[n]([i],function(t){s[i]=t,e.changed(i,r,t)})};t.getRegisteredClients([],function(t){var r,n;for(e.ids={},r=0;r<t.length;r++)n=t[r],e.ids[n]=!0,i(n,"meta","getMetadata",e.metas),i(n,"subs","getSubscriptions",e.subs);e.changed(null,"ids",null)})},v.prototype.getName=function(t){var e=this.metas[t];return e&&e["samp.name"]?e["samp.name"]:"["+t+"]"};var y=function(t,e,i,r){this.name=t,this.meta=e,this.callableClient=i,this.subs=r,this.regTextNodes=[],this.whenRegs=[],this.whenUnregs=[],this.connection=void 0,this.onreg=void 0,this.onunreg=void 0},b=function(t,e){var i,r,n=t.regTextNodes;for(i=0;i<n.length;i++)r=n[i],r.innerHTML="",r.appendChild(document.createTextNode(e))};y.prototype.setConnection=function(t){var e=this;if(this.connection&&(this.connection.close(),this.onunreg))try{this.onunreg()}catch(t){}if(this.connection=t,t&&(t.onclose=function(){if(e.connection=null,e.onunreg)try{e.onunreg()}catch(t){}e.update()},this.meta&&t.declareMetadata([this.meta]),this.callableClient&&(this.callableClient.init&&this.callableClient.init(t),t.setCallable(this.callableClient,function(){t.declareSubscriptions([e.subs])})),this.onreg))try{this.onreg(t)}catch(t){}this.update()},y.prototype.register=function(){var t=this,e=function(e){b(t,"no ("+e.toString()+")")},i=function(e){t.setConnection(e),b(t,e?"Yes":"No")};_(this.name,i,e)},y.prototype.unregister=function(){this.connection&&(this.connection.unregister([]),this.setConnection(null))},y.prototype.createRegButtons=function(){var t=this,e=document.createElement("button");e.setAttribute("type","button"),e.appendChild(document.createTextNode("Register")),e.onclick=function(){t.register()},this.whenUnregs.push(e);var i=document.createElement("button");i.setAttribute("type","button"),i.appendChild(document.createTextNode("Unregister")),i.onclick=function(){t.unregister()},this.whenRegs.push(i);var r=document.createElement("span");this.regTextNodes.push(r);var n=document.createDocumentFragment();n.appendChild(e),n.appendChild(document.createTextNode(" ")),n.appendChild(i);var s=document.createElement("span");return s.innerHTML=" <strong>Registered: </strong>",n.appendChild(s),n.appendChild(r),this.update(),n},y.prototype.update=function(){var t,e=!!this.connection,i=e?this.whenRegs:this.whenUnregs,r=e?this.whenUnregs:this.whenRegs;for(t=0;t<i.length;t++)i[t].removeAttribute("disabled");for(t=0;t<r.length;t++)r[t].setAttribute("disabled","disabled");b(this,"No")},y.prototype.runWithConnection=function(t,e){var i=this,r=function(e){i.setConnection(e),t(e)},n=function(t){i.setConnection(void 0),e(t)},s=function(e){t(i.connection)},o=function(t){_(this.name,r,n)};this.connection?this.connection.getRegisteredClients([],s,o):_(this.name,r,n)},y.prototype.onHubAvailability=function(t,e){return n.ping(t),setInterval(function(){n.ping(t)},e)};var x=function(t,e){var i,r=function(t,e){if(t==e)return!0;if("*"===t)return!0;var r,n=/^(.*)\.\*$/.exec(i);return!(!n||(r=n[1],r!==e.substring(0,r.length)))};for(i in t)if(r(i,e))return!0;return!1},_=function(t,e,r){var n=new p,s=new d(i+"register"),o={"samp.name":t};s.addParam(o),s.checkParams([TYPE_MAP]);var a=function(t){var i;try{i=new g(t)}catch(t){return void r(t)}e(i)};n.execute(s,a,r)},w=function(t){var e=new p,r=new d(i+"ping"),n=function(e){t(!0)},s=function(e){t(!1)};e.execute(r,n,s)},C={};return C.XmlRpcRequest=d,C.XmlRpcClient=p,C.Message=f,C.TYPE_STRING=TYPE_STRING,C.TYPE_LIST=TYPE_LIST,C.TYPE_MAP=TYPE_MAP,C.register=_,C.ping=w,C.isSubscribed=x,C.Connector=y,C.CallableClient=m,C.ClientTracker=v,C}();r("samp",function(){}),r("Services/SampCore",["jquery","underscore-min","../Parser/JsonProcessor","../Gui/dialog/ErrorDialog","samp","jquery.ui"],function(t,e,i,r){function s(){var e=new n.ClientTracker,i=e.callHandler;return i["samp.app.ping"]=function(t,i,r){if(r)return{text:"ping to you, "+e.getName(t)}},i["table.load.votable"]=function(t,e,i){u||r.open("votable2geojson plugin base url isn't defined")},
i["image.load.fits"]=function(t,e,i){},i["coord.pointAt.sky"]=function(t,e,i){c=!0;var r=e["samp.params"],n=parseFloat(r.ra),s=parseFloat(r.dec),o=[n,s],h=[];a.getCoordinateSystem().get3DFromWorld(o,h),l.center3d=h,l.computeViewMatrix(),a.getRenderContext().requestFrame()},i["samp.hub.event.unregister"]=function(e,i,r){t("#registerSamp").removeAttr("disabled").button("refresh"),t("#unregisterSamp").attr("disabled","disabled").button("refresh"),t("#sampInvoker").toggleClass("selected")},e}function o(){var e=s(),i={receiveNotification:function(i,r){e.receiveNotification(i,r);"samp.hub.event.subscriptions"===r["samp.mtype"]&&(t("#unregisterSamp").removeAttr("disabled").button("refresh"),t("#registerSamp").attr("disabled","disabled").button("refresh"),t("#sampInvoker").addClass("selected"))},receiveCall:function(t,i,r){e.receiveCall(t,i,r)},receiveResponse:function(t,i,r){e.receiveResponse(t,i,r)},init:function(t){e.init(t)}},r={"samp.name":"Mizar","samp.description.text":"Module for Interactive visualiZation from Astronomical Repositories","mizar.version":"v0.1","author.affiliation":"CNES/TPZ","home.page":"http://github.com/TPZF/RTWeb3D"},o=e.calculateSubscriptions();return h=new n.Connector("Mizar",r,i,o),h.regTextNodes.push(t("#sampResult")[0]),h}var a,l,h,u,c=!1;return{initSamp:o,sendImage:function(t){if(this.isConnected()){var e=new n.Message("image.load.fits",{url:t});return h.connection.notifyAll([e]),"Image has been sent"}return"Connect to SAMP Hub first"},sendVOTable:function(t,e){if(this.isConnected()){var i=new n.Message("table.load.votable",{url:e+"&media=votable"});return h.connection.notifyAll([i]),"VOTable has been sent"}return"Connect to SAMP Hub first"},highlightFeature:function(t,e){},isConnected:function(){return h.connection}}}),r("Services/SelectionToolCore",["jquery","../Utils/UtilsIntersection","../Utils/Numeric","../Layer/VectorLayer","../Renderer/FeatureStyle","../Renderer/Ray","../Renderer/glMatrix"],function(t,e,i,r,n,s){var o,a,l,h=function(t){o=t.ctx,a=o.getNavigation(),l=t.onselect,this.activated=t.activated||!1,this.renderContext=o.getRenderContext(),this.coordinateSystem=o.getCoordinateSystem();var i;i=t&&t.style?t.style:new n,i.zIndex=2,this.selectionLayer=new r({style:i,visible:!0}),o.addDraw(this.selectionLayer),this.selectionFeature=null,this.radius=null,this.pickPoint=null,this.geoRadius=null,this.geoPickPoint=null;var s,h=this,u=!1;this.renderContext.canvas.addEventListener("mousedown",function(t){var i=[t.layerX,t.layerY],r=o.getLonLatFromPixel(t.layerX,t.layerY);if(h.activated||h.selectionFeature)if(h.activated)a.stop(),u=!0,h.pickPoint=i,h.geoPickPoint=r,h.radius=0,s="resize";else{var n=e.pointInRing(r,h.selectionFeature.geometry.coordinates[0]);if(!n)return;a.stop(),u=!0;for(var l=!1,c=0;c<h.selectionFeature.geometry.coordinates[0].length;c++){var d=h.selectionFeature.geometry.coordinates[0][c];l|=e.pointInSphere(o,r,d,20)}s=l?"resize":"move"}}),this.renderContext.canvas.addEventListener("mousemove",function(t){if(u){var e=o.getLonLatFromPixel(t.layerX,t.layerY);"resize"===s?(h.radius=Math.sqrt(Math.pow(t.layerX-h.pickPoint[0],2)+Math.pow(t.layerY-h.pickPoint[1],2)),h.computeGeoRadius(e)):"move"===s&&(h.pickPoint=[t.layerX,t.layerY],h.geoPickPoint=o.getLonLatFromPixel(t.layerX,t.layerY)),h.updateSelection()}}),this.renderContext.canvas.addEventListener("mouseup",function(t){if(u){var e=(o.getLonLatFromPixel(t.layerX,t.layerY),h.computeSelection());h.activated&&l&&l(e),a.start(),u=!1}})};return h.prototype.computeGeoRadius=function(t){var e=vec3.dot(vec3.normalize(this.coordinateSystem.get3DFromWorld(t)),vec3.normalize(this.coordinateSystem.get3DFromWorld(this.geoPickPoint))),r=Math.acos(e);this.geoRadius=i.toDegree(r)},h.prototype.computeSelection=function(){var t=this.renderContext,e=mat4.create();mat4.inverse(t.viewMatrix,e);var i=[e[12],e[13],e[14]];mat4.multiply(t.projectionMatrix,t.viewMatrix,e),mat4.inverse(e);for(var r=2/t.canvas.width,n=2/t.canvas.height,o=[[(this.pickPoint[0]-this.radius)*r-1,(t.canvas.height-this.pickPoint[1]-this.radius)*n-1,1,1],[(this.pickPoint[0]-this.radius)*r-1,(t.canvas.height-this.pickPoint[1]+this.radius)*n-1,1,1],[(this.pickPoint[0]+this.radius)*r-1,(t.canvas.height-this.pickPoint[1]+this.radius)*n-1,1,1],[(this.pickPoint[0]+this.radius)*r-1,(t.canvas.height-this.pickPoint[1]-this.radius)*n-1,1,1]],a=[0,0,0],l=0;l<4;l++){mat4.multiplyVec4(e,o[l]),vec3.scale(o[l],1/o[l][3]),vec3.subtract(o[l],i,o[l]),vec3.normalize(o[l]);var h=new s(i,o[l]),u=h.computePoint(h.sphereIntersect(a,this.coordinateSystem.getGeoide().getRadius()));o[l]=this.coordinateSystem.getWorldFrom3D(u)}return o},h.prototype.updateSelection=function(){this.selectionFeature&&this.selectionLayer.removeFeature(this.selectionFeature);var t=this.computeSelection();t.push(t[0]),this.selectionFeature={geometry:{gid:"selectionShape",coordinates:[t],type:"Polygon",crs:{type:"name",properties:{name:o.getCoordinateSystem().getGeoideName()}}},type:"Feature"},this.selectionLayer.addFeature(this.selectionFeature)},h.prototype.toggle=function(){this.activated=!this.activated,this.activated?t(this.renderContext.canvas).css("cursor","url(css/images/selectionCursor.png)"):t(this.renderContext.canvas).css("cursor","default")},h.prototype.clear=function(){this.selectionFeature&&this.selectionLayer.removeFeature(this.selectionFeature),this.pickPoint=null,this.radius=null,this.geoPickPoint=null,this.geoRadius=null},h}),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof r&&r.amd)r("jszip",[],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.JSZip=t()}}(function(){return function t(i,r,n){function s(a,l){if(!r[a]){if(!i[a]){var h="function"==typeof e&&e;if(!l&&h)return h(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};i[a][0].call(c.exports,function(t){var e=i[a][1][t];return s(e?e:t)},c,c.exports,t,i,r,n)}return r[a].exports}for(var o="function"==typeof e&&e,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(t,e,i){"use strict";var r=t("./utils"),n=t("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,n,o,a,l,h,u=[],c=0,d=t.length,p=d,f="string"!==r.getTypeOf(t);c<t.length;)p=d-c,f?(e=t[c++],i=c<d?t[c++]:0,n=c<d?t[c++]:0):(e=t.charCodeAt(c++),i=c<d?t.charCodeAt(c++):0,n=c<d?t.charCodeAt(c++):0),o=e>>2,a=(3&e)<<4|i>>4,l=p>1?(15&i)<<2|n>>6:64,h=p>2?63&n:64,u.push(s.charAt(o)+s.charAt(a)+s.charAt(l)+s.charAt(h));return u.join("")},i.decode=function(t){var e,i,r,o,a,l,h,u=0,c=0,d="data:";if(t.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");var p=3*t.length/4;if(t.charAt(t.length-1)===s.charAt(64)&&p--,t.charAt(t.length-2)===s.charAt(64)&&p--,p%1!==0)throw new Error("Invalid base64 input, bad content length.");var f;for(f=n.uint8array?new Uint8Array(0|p):new Array(0|p);u<t.length;)o=s.indexOf(t.charAt(u++)),a=s.indexOf(t.charAt(u++)),l=s.indexOf(t.charAt(u++)),h=s.indexOf(t.charAt(u++)),e=o<<2|a>>4,i=(15&a)<<4|l>>2,r=(3&l)<<6|h,f[c++]=e,64!==l&&(f[c++]=i),64!==h&&(f[c++]=r);return f}},{"./support":30,"./utils":32}],2:[function(t,e,i){"use strict";function r(t,e,i,r,n){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=r,this.compressedContent=n}var n=t("./external"),s=t("./stream/DataWorker"),o=t("./stream/DataLengthProbe"),a=t("./stream/Crc32Probe"),o=t("./stream/DataLengthProbe");r.prototype={getContentWorker:function(){var t=new s(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new s(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},r.createWorkerFrom=function(t,e,i){return t.pipe(new a).pipe(new o("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new o("compressedSize")).withStreamInfo("compression",e)},e.exports=r},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){"use strict";var r=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(t){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){"use strict";function r(){for(var t,e=[],i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}function n(t,e,i,r){var n=a,s=r+i;t^=-1;for(var o=r;o<s;o++)t=t>>>8^n[255&(t^e[o])];return t^-1}function s(t,e,i,r){var n=a,s=r+i;t^=-1;for(var o=r;o<s;o++)t=t>>>8^n[255&(t^e.charCodeAt(o))];return t^-1}var o=t("./utils"),a=r();e.exports=function(t,e){if("undefined"==typeof t||!t.length)return 0;var i="string"!==o.getTypeOf(t);return i?n(0|e,t,t.length,0):s(0|e,t,t.length,0)}},{"./utils":32}],5:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){"use strict";var r=null;r="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:r}},{lie:58}],7:[function(t,e,i){"use strict";function r(t,e){a.call(this,"FlateWorker/"+t),this._pako=new s[t]({raw:!0,level:e.level||-1}),this.meta={};var i=this;this._pako.onData=function(t){i.push({data:t,meta:i.meta})}}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,s=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),l=n?"uint8array":"array";i.magic="\b\0",o.inherits(r,a),r.prototype.processChunk=function(t){this.meta=t.meta,this._pako.push(o.transformTo(l,t.data),!1)},r.prototype.flush=function(){a.prototype.flush.call(this),this._pako.push([],!0)},r.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},i.compressWorker=function(t){return new r("Deflate",t)},i.uncompressWorker=function(){return new r("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(t,e,i){"use strict";function r(t,e,i,r){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var n=t("../utils"),s=t("../stream/GenericWorker"),o=t("../utf8"),a=t("../crc32"),l=t("../signature"),h=function(t,e){var i,r="";for(i=0;i<e;i++)r+=String.fromCharCode(255&t),t>>>=8;return r},u=function(t,e){var i=t;return t||(i=e?16893:33204),(65535&i)<<16},c=function(t,e){return 63&(t||0)},d=function(t,e,i,r,s,d){var p,f,g=t.file,m=t.compression,v=d!==o.utf8encode,y=n.transformTo("string",d(g.name)),b=n.transformTo("string",o.utf8encode(g.name)),x=g.comment,_=n.transformTo("string",d(x)),w=n.transformTo("string",o.utf8encode(x)),C=b.length!==g.name.length,T=w.length!==x.length,A="",I="",S="",M=g.dir,k=g.date,E={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(E.crc32=t.crc32,E.compressedSize=t.compressedSize,E.uncompressedSize=t.uncompressedSize);var P=0;e&&(P|=8),v||!C&&!T||(P|=2048);var R=0,D=0;M&&(R|=16),"UNIX"===s?(D=798,R|=u(g.unixPermissions,M)):(D=20,R|=c(g.dosPermissions,M)),p=k.getUTCHours(),p<<=6,p|=k.getUTCMinutes(),p<<=5,p|=k.getUTCSeconds()/2,f=k.getUTCFullYear()-1980,f<<=4,f|=k.getUTCMonth()+1,f<<=5,f|=k.getUTCDate(),C&&(I=h(1,1)+h(a(y),4)+b,A+="up"+h(I.length,2)+I),T&&(S=h(1,1)+h(a(_),4)+w,A+="uc"+h(S.length,2)+S);var N="";N+="\n\0",N+=h(P,2),N+=m.magic,N+=h(p,2),N+=h(f,2),N+=h(E.crc32,4),N+=h(E.compressedSize,4),N+=h(E.uncompressedSize,4),N+=h(y.length,2),N+=h(A.length,2);var L=l.LOCAL_FILE_HEADER+N+y+A,F=l.CENTRAL_FILE_HEADER+h(D,2)+N+h(_.length,2)+"\0\0\0\0"+h(R,4)+h(r,4)+y+A+_;return{fileRecord:L,dirRecord:F}},p=function(t,e,i,r,s){var o="",a=n.transformTo("string",s(r));return o=l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+h(t,2)+h(t,2)+h(e,4)+h(i,4)+h(a.length,2)+a},f=function(t){var e="";return e=l.DATA_DESCRIPTOR+h(t.crc32,4)+h(t.compressedSize,4)+h(t.uncompressedSize,4)};n.inherits(r,s),r.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,s.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-r-1))/i:100}}))},r.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=d(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},r.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=d(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:f(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},r.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,r=p(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},r.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},r.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},r.prototype.error=function(t){var e=this._sources;if(!s.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},r.prototype.lock=function(){s.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=r},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){"use strict";var r=t("../compressions"),n=t("./ZipFileWorker"),s=function(t,e){var i=t||e,n=r[i];if(!n)throw new Error(i+" is not a valid compression method !");return n};i.generateWorker=function(t,e,i){var r=new n(e.streamFiles,i,e.platform,e.encodeFileName),o=0;try{t.forEach(function(t,i){o++;var n=s(i.options.compression,e.compression),a=i.options.compressionOptions||e.compressionOptions||{},l=i.dir,h=i.date;i._compressWorker(n,a).withStreamInfo("file",{name:t,dir:l,date:h,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(r)}),r.entriesCount=o}catch(t){r.error(t)}return r}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new r;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}r.prototype=t("./object"),r.prototype.loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.1.3",r.loadAsync=function(t,e){return(new r).loadAsync(t,e)},r.external=t("./external"),e.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){"use strict";function r(t){return new s.Promise(function(e,i){var r=t.decompressed.getContentWorker().pipe(new l);r.on("error",function(t){i(t)}).on("end",function(){r.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}var n=t("./utils"),s=t("./external"),o=t("./utf8"),n=t("./utils"),a=t("./zipEntries"),l=t("./stream/Crc32Probe"),h=t("./nodejsUtils");e.exports=function(t,e){var i=this;return e=n.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(t)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var i=new a(e);return i.load(t),i}).then(function(t){var i=[s.Promise.resolve(t)],n=t.files;if(e.checkCRC32)for(var o=0;o<n.length;o++)i.push(r(n[o]));return s.Promise.all(i)}).then(function(t){for(var r=t.shift(),n=r.files,s=0;s<n.length;s++){var o=n[s];i.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:e.createFolders})}return r.zipComment.length&&(i.comment=r.zipComment),i})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){"use strict";function r(t,e){s.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}var n=t("../utils"),s=t("../stream/GenericWorker");n.inherits(r,s),r.prototype._bindStream=function(t){var e=this;this._stream=t,t.pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},r.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){"use strict";function r(t,e,i){n.call(this,e),this._helper=t;var r=this;t.on("data",function(t,e){r.push(t)||r._helper.pause(),i&&i(e)}).on("error",function(t){r.emit("error",t)}).on("end",function(){r.push(null)})}var n=t("readable-stream").Readable,s=t("util");s.inherits(r,n),r.prototype._read=function(){this._helper.resume()},e.exports=r},{"readable-stream":16,util:void 0}],14:[function(t,e,i){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBuffer:function(t,e){return new Buffer(t,e)},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){"use strict";function r(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var n=t("./utf8"),s=t("./utils"),o=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),l=t("./defaults"),h=t("./compressedObject"),u=t("./zipObject"),c=t("./generate"),d=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),f=function(t,e,i){var r,n=s.getTypeOf(e),a=s.extend(i||{},l);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(t=m(t)),a.createFolders&&(r=g(t))&&v.call(this,r,!0);var c="string"===n&&a.binary===!1&&a.base64===!1;i&&"undefined"!=typeof i.binary||(a.binary=!c);var f=e instanceof h&&0===e.uncompressedSize;(f||a.dir||!e||0===e.length)&&(a.base64=!1,a.binary=!0,e="",a.compression="STORE",n="string");var y=null;y=e instanceof h||e instanceof o?e:d.isNode&&d.isStream(e)?new p(t,e):s.prepareContent(t,e,a.binary,a.optimizedBinaryString,a.base64);var b=new u(t,y,a);this.files[t]=b},g=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},m=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},v=function(t,e){return e="undefined"!=typeof e?e:l.createFolders,t=m(t),this.files[t]||f.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]},y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,r;for(e in this.files)this.files.hasOwnProperty(e)&&(r=this.files[e],i=e.slice(this.root.length,e.length),i&&e.slice(0,this.root.length)===this.root&&t(i,r))},filter:function(t){var e=[];return this.forEach(function(i,r){t(i,r)&&e.push(r)}),e},file:function(t,e,i){if(1===arguments.length){if(r(t)){var n=t;return this.filter(function(t,e){return!e.dir&&n.test(t)})}var s=this.files[this.root+t];return s&&!s.dir?s:null}return t=this.root+t,f.call(this,t,e,i),this},folder:function(t){if(!t)return this;if(r(t))return this.filter(function(e,i){return i.dir&&t.test(e)});var e=this.root+t,i=v.call(this,e),n=this.clone();return n.root=i.name,n},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter(function(e,i){return i.name.slice(0,t.length)===t}),r=0;r<i.length;r++)delete this.files[i[r].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if(i=s.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode}),i.type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");s.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var r=i.comment||this.comment||"";e=c.generateWorker(this,i,r)}catch(t){e=new o("error"),e.error(t)}return new a(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return t=t||{},t.type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){"use strict";function r(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}var n=t("./DataReader"),s=t("../utils");s.inherits(r,n),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),r=t.charCodeAt(2),n=t.charCodeAt(3),s=this.length-4;s>=0;--s)if(this.data[s]===e&&this.data[s+1]===i&&this.data[s+2]===r&&this.data[s+3]===n)return s-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),r=t.charCodeAt(2),n=t.charCodeAt(3),s=this.readData(4);return e===s[0]&&i===s[1]&&r===s[2]&&n===s[3]},r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){"use strict";function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}var n=t("../utils");r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC((t>>25&127)+1980,(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=r},{"../utils":32}],19:[function(t,e,i){"use strict";function r(t){n.call(this,t)}var n=t("./Uint8ArrayReader"),s=t("../utils");s.inherits(r,n),r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){"use strict";function r(t){n.call(this,t)}var n=t("./DataReader"),s=t("../utils");s.inherits(r,n),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){var e=this.readData(4);return t===e},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){"use strict";function r(t){n.call(this,t)}var n=t("./ArrayReader"),s=t("../utils");s.inherits(r,n),r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){"use strict";var r=t("../utils"),n=t("../support"),s=t("./ArrayReader"),o=t("./StringReader"),a=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=r.getTypeOf(t);return r.checkSupport(e),"string"!==e||n.uint8array?"nodebuffer"===e?new a(t):n.uint8array?new l(r.transformTo("uint8array",t)):new s(r.transformTo("array",t)):new o(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){"use strict";function r(t){n.call(this,"ConvertWorker to "+t),this.destType=t}var n=t("./GenericWorker"),s=t("../utils");s.inherits(r,n),r.prototype.processChunk=function(t){this.push({data:s.transformTo(this.destType,t.data),meta:t.meta})},e.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){"use strict";function r(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var n=t("./GenericWorker"),s=t("../crc32"),o=t("../utils");o.inherits(r,n),r.prototype.processChunk=function(t){this.streamInfo.crc32=s(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){"use strict";function r(t){s.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}var n=t("../utils"),s=t("./GenericWorker");n.inherits(r,s),r.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}s.prototype.processChunk.call(this,t)},e.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){"use strict";function r(t){s.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}var n=t("../utils"),s=t("./GenericWorker"),o=16384;n.inherits(r,s),r.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=o,e=null,i=Math.min(this.max,this.index+t);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,i);break;case"uint8array":e=this.data.subarray(this.index,i);break;case"array":case"nodebuffer":e=this.data.slice(this.index,i)}return this.index=i,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){"use strict";function r(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=r},{}],29:[function(t,e,i){"use strict";function r(t,e,i,r){var s=null;switch(t){case"blob":return a.newBlob(i,r);case"base64":return s=n(e,i),u.encode(s);default:return s=n(e,i),a.transformTo(t,s)}}function n(t,e){var i,r=0,n=null,s=0;for(i=0;i<e.length;i++)s+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(n=new Uint8Array(s),i=0;i<e.length;i++)n.set(e[i],r),r+=e[i].length;return n;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}function s(t,e){return new d.Promise(function(i,n){var s=[],o=t._internalType,a=t._outputType,l=t._mimeType;t.on("data",function(t,i){
s.push(t),e&&e(i)}).on("error",function(t){s=[],n(t)}).on("end",function(){try{var t=r(a,o,s,l);i(t)}catch(t){n(t)}s=[]}).resume()})}function o(t,e,i){var r=e;switch(e){case"blob":r="arraybuffer";break;case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=e,this._mimeType=i,a.checkSupport(r),this._worker=t.pipe(new l(r)),t.lock()}catch(t){this._worker=new h("error"),this._worker.error(t)}}var a=t("../utils"),l=t("./ConvertWorker"),h=t("./GenericWorker"),u=t("../base64"),c=t("../support"),d=t("../external"),p=null;if(c.nodestream)try{p=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}o.prototype={accumulate:function(t){return s(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,function(t){e.call(i,t.data,t.meta)}):this._worker.on(t,function(){a.delay(e,arguments,i)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(a.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=o},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=0===new Blob([r],{type:"application/zip"}).size}catch(t){try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,s=new n;s.append(r),i.blob=0===s.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){"use strict";function r(){l.call(this,"utf-8 decode"),this.leftOver=null}function n(){l.call(this,"utf-8 encode")}for(var s=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),u=0;u<256;u++)h[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;h[254]=h[254]=1;var c=function(t){var e,i,r,n,s,a=t.length,l=0;for(n=0;n<a;n++)i=t.charCodeAt(n),55296===(64512&i)&&n+1<a&&(r=t.charCodeAt(n+1),56320===(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),n++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=o.uint8array?new Uint8Array(l):new Array(l),s=0,n=0;s<l;n++)i=t.charCodeAt(n),55296===(64512&i)&&n+1<a&&(r=t.charCodeAt(n+1),56320===(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),n++)),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},d=function(t,e){var i;for(e=e||t.length,e>t.length&&(e=t.length),i=e-1;i>=0&&128===(192&t[i]);)i--;return i<0?e:0===i?e:i+h[t[i]]>e?i:e},p=function(t){var e,i,r,n,o=t.length,a=new Array(2*o);for(i=0,e=0;e<o;)if(r=t[e++],r<128)a[i++]=r;else if(n=h[r],n>4)a[i++]=65533,e+=n-1;else{for(r&=2===n?31:3===n?15:7;n>1&&e<o;)r=r<<6|63&t[e++],n--;n>1?a[i++]=65533:r<65536?a[i++]=r:(r-=65536,a[i++]=55296|r>>10&1023,a[i++]=56320|1023&r)}return a.length!==i&&(a.subarray?a=a.subarray(0,i):a.length=i),s.applyFromCharCode(a)};i.utf8encode=function(t){return o.nodebuffer?a.newBuffer(t,"utf-8"):c(t)},i.utf8decode=function(t){return o.nodebuffer?s.transformTo("nodebuffer",t).toString("utf-8"):(t=s.transformTo(o.uint8array?"uint8array":"array",t),p(t))},s.inherits(r,l),r.prototype.processChunk=function(t){var e=s.transformTo(o.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var r=e;e=new Uint8Array(r.length+this.leftOver.length),e.set(this.leftOver,0),e.set(r,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var n=d(e),a=e;n!==e.length&&(o.uint8array?(a=e.subarray(0,n),this.leftOver=e.subarray(n,e.length)):(a=e.slice(0,n),this.leftOver=e.slice(n,e.length))),this.push({data:i.utf8decode(a),meta:t.meta})},r.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=r,s.inherits(n,l),n.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=n},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,i){"use strict";function r(t){var e=null;return e=l.uint8array?new Uint8Array(t.length):new Array(t.length),s(t,e)}function n(t){return t}function s(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}function o(t){var e=65536,r=i.getTypeOf(t),n=!0;if("uint8array"===r?n=p.applyCanBeUsed.uint8array:"nodebuffer"===r&&(n=p.applyCanBeUsed.nodebuffer),n)for(;e>1;)try{return p.stringifyByChunk(t,r,e)}catch(t){e=Math.floor(e/2)}return p.stringifyByChar(t)}function a(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}var l=t("./support"),h=t("./base64"),u=t("./nodejsUtils"),c=t("core-js/library/fn/set-immediate"),d=t("./external");i.newBlob=function(t,e){i.checkSupport("blob");try{return new Blob(t,{type:e})}catch(i){try{for(var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=new r,s=0;s<t.length;s++)n.append(t[s]);return n.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(t,e,i){var r=[],n=0,s=t.length;if(s<=i)return String.fromCharCode.apply(null,t);for(;n<s;)"array"===e||"nodebuffer"===e?r.push(String.fromCharCode.apply(null,t.slice(n,Math.min(n+i,s)))):r.push(String.fromCharCode.apply(null,t.subarray(n,Math.min(n+i,s)))),n+=i;return r.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return l.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return l.nodebuffer&&1===String.fromCharCode.apply(null,u.newBuffer(1)).length}catch(t){return!1}}()}};i.applyFromCharCode=o;var f={};f.string={string:n,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return f.string.uint8array(t).buffer},uint8array:function(t){return s(t,new Uint8Array(t.length))},nodebuffer:function(t){return s(t,u.newBuffer(t.length))}},f.array={string:o,array:n,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return u.newBuffer(t)}},f.arraybuffer={string:function(t){return o(new Uint8Array(t))},array:function(t){return a(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:n,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return u.newBuffer(new Uint8Array(t))}},f.uint8array={string:o,array:function(t){return a(t,new Array(t.length))},arraybuffer:function(t){var e=new Uint8Array(t.length);return t.length&&e.set(t,0),e.buffer},uint8array:n,nodebuffer:function(t){return u.newBuffer(t)}},f.nodebuffer={string:o,array:function(t){return a(t,new Array(t.length))},arraybuffer:function(t){return f.nodebuffer.uint8array(t).buffer},uint8array:function(t){return a(t,new Uint8Array(t.length))},nodebuffer:n},i.transformTo=function(t,e){if(e||(e=""),!t)return e;i.checkSupport(t);var r=i.getTypeOf(e),n=f[r][t](e);return n},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":l.nodebuffer&&u.isBuffer(t)?"nodebuffer":l.uint8array&&t instanceof Uint8Array?"uint8array":l.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){var e=l[t.toLowerCase()];if(!e)throw new Error(t+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,r="";for(i=0;i<(t||"").length;i++)e=t.charCodeAt(i),r+="\\x"+(e<16?"0":"")+e.toString(16).toUpperCase();return r},i.delay=function(t,e,i){c(function(){t.apply(i||null,e||[])})},i.inherits=function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&"undefined"==typeof i[e]&&(i[e]=arguments[t][e]);return i},i.prepareContent=function(t,e,n,s,o){var a=d.Promise.resolve(e).then(function(t){var e=l.blob&&(t instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t))!==-1);return e&&"undefined"!=typeof FileReader?new d.Promise(function(e,i){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){i(t.target.error)},r.readAsArrayBuffer(t)}):t});return a.then(function(e){var a=i.getTypeOf(e);return a?("arraybuffer"===a?e=i.transformTo("uint8array",e):"string"===a&&(o?e=h.decode(e):n&&s!==!0&&(e=r(e))),e):d.Promise.reject(new Error("The data of '"+t+"' is in an unsupported format !"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(t,e,i){"use strict";function r(t){this.files=[],this.loadOptions=t}var n=t("./reader/readerFor"),s=t("./utils"),o=t("./signature"),a=t("./zipEntry"),l=(t("./utf8"),t("./support"));r.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug : unexpected signature ("+s.pretty(e)+", expected "+s.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var r=this.reader.readString(4),n=r===e;return this.reader.setIndex(i),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=l.uint8array?"uint8array":"array",i=s.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,r=this.zip64EndOfCentralSize-44,n=0;n<r;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)t=new a({zip64:this.zip64},this.loadOptions),t.readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(t<0){var e=!this.isSignature(0,o.LOCAL_FILE_HEADER);throw e?new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip : can't find end of central directory")}this.reader.setIndex(t);var i=t;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,t=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),t<0)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=i-r;if(n>0)this.isSignature(i,o.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=r},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){"use strict";function r(t,e){this.options=t,this.loadOptions=e}var n=t("./reader/readerFor"),s=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),l=t("./utf8"),h=t("./compressions"),u=t("./support"),c=0,d=3,p=function(t){for(var e in h)if(h.hasOwnProperty(e)&&h[e].magic===t)return h[e];return null};r.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(e=p(this.compressionMethod),null===e)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),t===c&&(this.dosPermissions=63&this.externalFileAttributes),t===d&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,i,r,n=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<n;)e=t.readInt(2),i=t.readInt(2),r=t.readData(i),this.extraFields[e]={id:e,length:i,value:r}},handleUTF8:function(){var t=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=s.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var n=s.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:l.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:l.utf8decode(e.readData(t.length-5))}return null}},e.exports=r},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){"use strict";var r=t("./stream/StreamHelper"),n=t("./stream/DataWorker"),s=t("./utf8"),o=t("./compressedObject"),a=t("./stream/GenericWorker"),l=function(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}};l.prototype={internalStream:function(t){var e=t.toLowerCase(),i="string"===e||"text"===e;"binarystring"!==e&&"text"!==e||(e="string");var n=this._decompressWorker(),o=!this._dataBinary;return o&&!i&&(n=n.pipe(new s.Utf8EncodeWorker)),!o&&i&&(n=n.pipe(new s.Utf8DecodeWorker)),new r(n,e,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof o&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new s.Utf8EncodeWorker)),o.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof a?this._data:new n(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<h.length;c++)l.prototype[h[c]]=u;e.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,i){t("../modules/web.immediate"),e.exports=t("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(t,e,i){e.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},{}],38:[function(t,e,i){var r=t("./_is-object");e.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},{"./_is-object":51}],39:[function(t,e,i){var r={}.toString;e.exports=function(t){return r.call(t).slice(8,-1)}},{}],40:[function(t,e,i){var r=e.exports={version:"2.3.0"};"number"==typeof __e&&(__e=r)},{}],41:[function(t,e,i){var r=t("./_a-function");e.exports=function(t,e,i){if(r(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}}},{"./_a-function":37}],42:[function(t,e,i){e.exports=!t("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(t,e,i){var r=t("./_is-object"),n=t("./_global").document,s=r(n)&&r(n.createElement);e.exports=function(t){return s?n.createElement(t):{}}},{"./_global":46,"./_is-object":51}],44:[function(t,e,i){var r=t("./_global"),n=t("./_core"),s=t("./_ctx"),o=t("./_hide"),a="prototype",l=function(t,e,i){var h,u,c,d=t&l.F,p=t&l.G,f=t&l.S,g=t&l.P,m=t&l.B,v=t&l.W,y=p?n:n[e]||(n[e]={}),b=y[a],x=p?r:f?r[e]:(r[e]||{})[a];p&&(i=e);for(h in i)u=!d&&x&&void 0!==x[h],u&&h in y||(c=u?x[h]:i[h],y[h]=p&&"function"!=typeof x[h]?i[h]:m&&u?s(c,r):v&&x[h]==c?function(t){var e=function(e,i,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,r)}return t.apply(this,arguments)};return e[a]=t[a],e}(c):g&&"function"==typeof c?s(Function.call,c):c,g&&((y.virtual||(y.virtual={}))[h]=c,t&l.R&&b&&!b[h]&&o(b,h,c)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(t,e,i){e.exports=function(t){try{return!!t()}catch(t){return!0}}},{}],46:[function(t,e,i){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],47:[function(t,e,i){var r=t("./_object-dp"),n=t("./_property-desc");e.exports=t("./_descriptors")?function(t,e,i){return r.f(t,e,n(1,i))}:function(t,e,i){return t[e]=i,t}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(t,e,i){e.exports=t("./_global").document&&document.documentElement},{"./_global":46}],49:[function(t,e,i){e.exports=!t("./_descriptors")&&!t("./_fails")(function(){return 7!=Object.defineProperty(t("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(t,e,i){e.exports=function(t,e,i){var r=void 0===i;switch(e.length){case 0:return r?t():t.call(i);case 1:return r?t(e[0]):t.call(i,e[0]);case 2:return r?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},{}],51:[function(t,e,i){e.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},{}],52:[function(t,e,i){var r=t("./_an-object"),n=t("./_ie8-dom-define"),s=t("./_to-primitive"),o=Object.defineProperty;i.f=t("./_descriptors")?Object.defineProperty:function(t,e,i){if(r(t),e=s(e,!0),r(i),n)try{return o(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(t,e,i){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],54:[function(t,e,i){var r,n,s,o=t("./_ctx"),a=t("./_invoke"),l=t("./_html"),h=t("./_dom-create"),u=t("./_global"),c=u.process,d=u.setImmediate,p=u.clearImmediate,f=u.MessageChannel,g=0,m={},v="onreadystatechange",y=function(){var t=+this;if(m.hasOwnProperty(t)){var e=m[t];delete m[t],e()}},b=function(t){y.call(t.data)};d&&p||(d=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return m[++g]=function(){a("function"==typeof t?t:Function(t),e)},r(g),g},p=function(t){delete m[t]},"process"==t("./_cof")(c)?r=function(t){c.nextTick(o(y,t,1))}:f?(n=new f,s=n.port2,n.port1.onmessage=b,r=o(s.postMessage,s,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(r=function(t){u.postMessage(t+"","*")},u.addEventListener("message",b,!1)):r=v in h("script")?function(t){l.appendChild(h("script"))[v]=function(){l.removeChild(this),y.call(t)}}:function(t){setTimeout(o(y,t,1),0)}),e.exports={set:d,clear:p}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(t,e,i){var r=t("./_is-object");e.exports=function(t,e){if(!r(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!r(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(t,e,i){var r=t("./_export"),n=t("./_task");r(r.G+r.B,{setImmediate:n.set,clearImmediate:n.clear})},{"./_export":44,"./_task":54}],57:[function(t,e,i){(function(t){"use strict";function i(){u=!0;for(var t,e,i=c.length;i;){for(e=c,c=[],t=-1;++t<i;)e[t]();i=c.length}u=!1}function r(t){1!==c.push(t)||u||n()}var n,s=t.MutationObserver||t.WebKitMutationObserver;if(s){var o=0,a=new s(i),l=t.document.createTextNode("");a.observe(l,{characterData:!0}),n=function(){l.data=o=++o%2}}else if(t.setImmediate||"undefined"==typeof t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){i(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(i,0)};else{var h=new t.MessageChannel;h.port1.onmessage=i,n=function(){h.port2.postMessage(0)}}var u,c=[];e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(t,e,i){"use strict";function r(){}function n(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=y,this.queue=[],this.outcome=void 0,t!==r&&l(this,t)}function s(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function o(t,e,i){f(function(){var r;try{r=e(i)}catch(e){return g.reject(t,e)}r===t?g.reject(t,new TypeError("Cannot resolve promise with itself")):g.resolve(t,r)})}function a(t){var e=t&&t.then;if(t&&"object"==typeof t&&"function"==typeof e)return function(){e.apply(t,arguments)}}function l(t,e){function i(e){s||(s=!0,g.reject(t,e))}function r(e){s||(s=!0,g.resolve(t,e))}function n(){e(r,i)}var s=!1,o=h(n);"error"===o.status&&i(o.value)}function h(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}function u(t){return t instanceof this?t:g.resolve(new this(r),t)}function c(t){var e=new this(r);return g.reject(e,t)}function d(t){function e(t,e){function r(t){o[e]=t,++a!==n||s||(s=!0,g.resolve(h,o))}i.resolve(t).then(r,function(t){s||(s=!0,g.reject(h,t))})}var i=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,s=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,l=-1,h=new this(r);++l<n;)e(t[l],l);return h}function p(t){function e(t){i.resolve(t).then(function(t){s||(s=!0,g.resolve(a,t))},function(t){s||(s=!0,g.reject(a,t))})}var i=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,s=!1;if(!n)return this.resolve([]);for(var o=-1,a=new this(r);++o<n;)e(t[o]);return a}var f=t("immediate"),g={},m=["REJECTED"],v=["FULFILLED"],y=["PENDING"];e.exports=n,n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,e){if("function"!=typeof t&&this.state===v||"function"!=typeof e&&this.state===m)return this;var i=new this.constructor(r);if(this.state!==y){var n=this.state===v?t:e;o(i,n,this.outcome)}else this.queue.push(new s(i,t,e));return i},s.prototype.callFulfilled=function(t){g.resolve(this.promise,t)},s.prototype.otherCallFulfilled=function(t){o(this.promise,this.onFulfilled,t)},s.prototype.callRejected=function(t){g.reject(this.promise,t)},s.prototype.otherCallRejected=function(t){o(this.promise,this.onRejected,t)},g.resolve=function(t,e){var i=h(a,e);if("error"===i.status)return g.reject(t,i.value);var r=i.value;if(r)l(t,r);else{t.state=v,t.outcome=e;for(var n=-1,s=t.queue.length;++n<s;)t.queue[n].callFulfilled(e)}return t},g.reject=function(t,e){t.state=m,t.outcome=e;for(var i=-1,r=t.queue.length;++i<r;)t.queue[i].callRejected(e);return t},n.resolve=u,n.reject=c,n.all=d,n.race=p},{immediate:57}],59:[function(t,e,i){"use strict";var r=t("./lib/utils/common").assign,n=t("./lib/deflate"),s=t("./lib/inflate"),o=t("./lib/zlib/constants"),a={};r(a,n,s,o),e.exports=a},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(t,e,i){"use strict";function r(t){if(!(this instanceof r))return new r(t);this.options=l.assign({level:y,method:x,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==g)throw new Error(u[i]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var n;if(n="string"==typeof e.dictionary?h.string2buf(e.dictionary):"[object ArrayBuffer]"===d.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=a.deflateSetDictionary(this.strm,n),i!==g)throw new Error(u[i]);this._dict_set=!0}}function n(t,e){var i=new r(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}function s(t,e){return e=e||{},e.raw=!0,n(t,e)}function o(t,e){return e=e||{},e.gzip=!0,n(t,e)}var a=t("./zlib/deflate"),l=t("./utils/common"),h=t("./utils/strings"),u=t("./zlib/messages"),c=t("./zlib/zstream"),d=Object.prototype.toString,p=0,f=4,g=0,m=1,v=2,y=-1,b=0,x=8;r.prototype.push=function(t,e){var i,r,n=this.strm,s=this.options.chunkSize;if(this.ended)return!1;r=e===~~e?e:e===!0?f:p,"string"==typeof t?n.input=h.string2buf(t):"[object ArrayBuffer]"===d.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new l.Buf8(s),n.next_out=0,n.avail_out=s),i=a.deflate(n,r),i!==m&&i!==g)return this.onEnd(i),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||r!==f&&r!==v)||("string"===this.options.to?this.onData(h.buf2binstring(l.shrinkBuf(n.output,n.next_out))):this.onData(l.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&i!==m);return r===f?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===g):r!==v||(this.onEnd(g),n.avail_out=0,!0)},r.prototype.onData=function(t){this.chunks.push(t)},r.prototype.onEnd=function(t){t===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=r,i.deflate=n,i.deflateRaw=s,i.gzip=o},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(t,e,i){"use strict";function r(t){if(!(this instanceof r))return new r(t);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=o.inflateInit2(this.strm,e.windowBits);if(i!==h.Z_OK)throw new Error(u[i]);this.header=new d,o.inflateGetHeader(this.strm,this.header)}function n(t,e){var i=new r(e);if(i.push(t,!0),i.err)throw i.msg;
return i.result}function s(t,e){return e=e||{},e.raw=!0,n(t,e)}var o=t("./zlib/inflate"),a=t("./utils/common"),l=t("./utils/strings"),h=t("./zlib/constants"),u=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),p=Object.prototype.toString;r.prototype.push=function(t,e){var i,r,n,s,u,c,d=this.strm,f=this.options.chunkSize,g=this.options.dictionary,m=!1;if(this.ended)return!1;r=e===~~e?e:e===!0?h.Z_FINISH:h.Z_NO_FLUSH,"string"==typeof t?d.input=l.binstring2buf(t):"[object ArrayBuffer]"===p.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new a.Buf8(f),d.next_out=0,d.avail_out=f),i=o.inflate(d,h.Z_NO_FLUSH),i===h.Z_NEED_DICT&&g&&(c="string"==typeof g?l.string2buf(g):"[object ArrayBuffer]"===p.call(g)?new Uint8Array(g):g,i=o.inflateSetDictionary(this.strm,c)),i===h.Z_BUF_ERROR&&m===!0&&(i=h.Z_OK,m=!1),i!==h.Z_STREAM_END&&i!==h.Z_OK)return this.onEnd(i),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&i!==h.Z_STREAM_END&&(0!==d.avail_in||r!==h.Z_FINISH&&r!==h.Z_SYNC_FLUSH)||("string"===this.options.to?(n=l.utf8border(d.output,d.next_out),s=d.next_out-n,u=l.buf2string(d.output,n),d.next_out=s,d.avail_out=f-s,s&&a.arraySet(d.output,d.output,n,s,0),this.onData(u)):this.onData(a.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&i!==h.Z_STREAM_END);return i===h.Z_STREAM_END&&(r=h.Z_FINISH),r===h.Z_FINISH?(i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h.Z_OK):r!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),d.avail_out=0,!0)},r.prototype.onData=function(t){this.chunks.push(t)},r.prototype.onEnd=function(t){t===h.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=r,i.inflate=n,i.inflateRaw=s,i.ungzip=n},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(t,e,i){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,i,r,n){if(e.subarray&&t.subarray)return void t.set(e.subarray(i,i+r),n);for(var s=0;s<r;s++)t[n+s]=e[i+s]},flattenChunks:function(t){var e,i,r,n,s,o;for(r=0,e=0,i=t.length;e<i;e++)r+=t[e].length;for(o=new Uint8Array(r),n=0,e=0,i=t.length;e<i;e++)s=t[e],o.set(s,n),n+=s.length;return o}},s={arraySet:function(t,e,i,r,n){for(var s=0;s<r;s++)t[n+s]=e[i+s]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,s))},i.setTyped(r)},{}],63:[function(t,e,i){"use strict";function r(t,e){if(e<65537&&(t.subarray&&o||!t.subarray&&s))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",r=0;r<e;r++)i+=String.fromCharCode(t[r]);return i}var n=t("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new n.Buf8(256),l=0;l<256;l++)a[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;a[254]=a[254]=1,i.string2buf=function(t){var e,i,r,s,o,a=t.length,l=0;for(s=0;s<a;s++)i=t.charCodeAt(s),55296===(64512&i)&&s+1<a&&(r=t.charCodeAt(s+1),56320===(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),s++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(l),o=0,s=0;o<l;s++)i=t.charCodeAt(s),55296===(64512&i)&&s+1<a&&(r=t.charCodeAt(s+1),56320===(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),s++)),i<128?e[o++]=i:i<2048?(e[o++]=192|i>>>6,e[o++]=128|63&i):i<65536?(e[o++]=224|i>>>12,e[o++]=128|i>>>6&63,e[o++]=128|63&i):(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63,e[o++]=128|i>>>6&63,e[o++]=128|63&i);return e},i.buf2binstring=function(t){return r(t,t.length)},i.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,n,s,o,l=e||t.length,h=new Array(2*l);for(n=0,i=0;i<l;)if(s=t[i++],s<128)h[n++]=s;else if(o=a[s],o>4)h[n++]=65533,i+=o-1;else{for(s&=2===o?31:3===o?15:7;o>1&&i<l;)s=s<<6|63&t[i++],o--;o>1?h[n++]=65533:s<65536?h[n++]=s:(s-=65536,h[n++]=55296|s>>10&1023,h[n++]=56320|1023&s)}return r(h,n)},i.utf8border=function(t,e){var i;for(e=e||t.length,e>t.length&&(e=t.length),i=e-1;i>=0&&128===(192&t[i]);)i--;return i<0?e:0===i?e:i+a[t[i]]>e?i:e}},{"./common":62}],64:[function(t,e,i){"use strict";function r(t,e,i,r){for(var n=65535&t|0,s=t>>>16&65535|0,o=0;0!==i;){o=i>2e3?2e3:i,i-=o;do n=n+e[r++]|0,s=s+n|0;while(--o);n%=65521,s%=65521}return n|s<<16|0}e.exports=r},{}],65:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(t,e,i){"use strict";function r(){for(var t,e=[],i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}function n(t,e,i,r){var n=s,o=r+i;t^=-1;for(var a=r;a<o;a++)t=t>>>8^n[255&(t^e[a])];return t^-1}var s=r();e.exports=n},{}],67:[function(t,e,i){"use strict";function r(t,e){return t.msg=N[e],e}function n(t){return(t<<1)-(t>4?9:0)}function s(t){for(var e=t.length;--e>=0;)t[e]=0}function o(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(E.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function a(t,e){P._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,o(t.strm)}function l(t,e){t.pending_buf[t.pending++]=e}function h(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function u(t,e,i,r){var n=t.avail_in;return n>r&&(n=r),0===n?0:(t.avail_in-=n,E.arraySet(e,t.input,t.next_in,n,i),1===t.state.wrap?t.adler=R(t.adler,e,n,i):2===t.state.wrap&&(t.adler=D(t.adler,e,n,i)),t.next_in+=n,t.total_in+=n,n)}function c(t,e){var i,r,n=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match,l=t.strstart>t.w_size-ct?t.strstart-(t.w_size-ct):0,h=t.window,u=t.w_mask,c=t.prev,d=t.strstart+ut,p=h[s+o-1],f=h[s+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,h[i+o]===f&&h[i+o-1]===p&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do;while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<d);if(r=ut-(d-s),s=d-ut,r>o){if(t.match_start=e,o=r,r>=a)break;p=h[s+o-1],f=h[s+o]}}while((e=c[e&u])>l&&0!==--n);return o<=t.lookahead?o:t.lookahead}function d(t){var e,i,r,n,s,o=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=o+(o-ct)){E.arraySet(t.window,t.window,o,o,0),t.match_start-=o,t.strstart-=o,t.block_start-=o,i=t.hash_size,e=i;do r=t.head[--e],t.head[e]=r>=o?r-o:0;while(--i);i=o,e=i;do r=t.prev[--e],t.prev[e]=r>=o?r-o:0;while(--i);n+=o}if(0===t.strm.avail_in)break;if(i=u(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=i,t.lookahead+t.insert>=ht)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+ht-1])&t.hash_mask,t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<ht)););}while(t.lookahead<ct&&0!==t.strm.avail_in)}function p(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(d(t),0===t.lookahead&&e===L)return xt;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+i;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,a(t,!1),0===t.strm.avail_out))return xt;if(t.strstart-t.block_start>=t.w_size-ct&&(a(t,!1),0===t.strm.avail_out))return xt}return t.insert=0,e===B?(a(t,!0),0===t.strm.avail_out?wt:Ct):t.strstart>t.block_start&&(a(t,!1),0===t.strm.avail_out)?xt:xt}function f(t,e){for(var i,r;;){if(t.lookahead<ct){if(d(t),t.lookahead<ct&&e===L)return xt;if(0===t.lookahead)break}if(i=0,t.lookahead>=ht&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-ct&&(t.match_length=c(t,i)),t.match_length>=ht)if(r=P._tr_tally(t,t.strstart-t.match_start,t.match_length-ht),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=ht){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=P._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(a(t,!1),0===t.strm.avail_out))return xt}return t.insert=t.strstart<ht-1?t.strstart:ht-1,e===B?(a(t,!0),0===t.strm.avail_out?wt:Ct):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?xt:_t}function g(t,e){for(var i,r,n;;){if(t.lookahead<ct){if(d(t),t.lookahead<ct&&e===L)return xt;if(0===t.lookahead)break}if(i=0,t.lookahead>=ht&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=ht-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-ct&&(t.match_length=c(t,i),t.match_length<=5&&(t.strategy===V||t.match_length===ht&&t.strstart-t.match_start>4096)&&(t.match_length=ht-1)),t.prev_length>=ht&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-ht,r=P._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-ht),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!==--t.prev_length);if(t.match_available=0,t.match_length=ht-1,t.strstart++,r&&(a(t,!1),0===t.strm.avail_out))return xt}else if(t.match_available){if(r=P._tr_tally(t,0,t.window[t.strstart-1]),r&&a(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return xt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=P._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<ht-1?t.strstart:ht-1,e===B?(a(t,!0),0===t.strm.avail_out?wt:Ct):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?xt:_t}function m(t,e){for(var i,r,n,s,o=t.window;;){if(t.lookahead<=ut){if(d(t),t.lookahead<=ut&&e===L)return xt;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=ht&&t.strstart>0&&(n=t.strstart-1,r=o[n],r===o[++n]&&r===o[++n]&&r===o[++n])){s=t.strstart+ut;do;while(r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&n<s);t.match_length=ut-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=ht?(i=P._tr_tally(t,1,t.match_length-ht),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=P._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(a(t,!1),0===t.strm.avail_out))return xt}return t.insert=0,e===B?(a(t,!0),0===t.strm.avail_out?wt:Ct):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?xt:_t}function v(t,e){for(var i;;){if(0===t.lookahead&&(d(t),0===t.lookahead)){if(e===L)return xt;break}if(t.match_length=0,i=P._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(a(t,!1),0===t.strm.avail_out))return xt}return t.insert=0,e===B?(a(t,!0),0===t.strm.avail_out?wt:Ct):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?xt:_t}function y(t,e,i,r,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=r,this.func=n}function b(t){t.window_size=2*t.w_size,s(t.head),t.max_lazy_match=k[t.level].max_lazy,t.good_match=k[t.level].good_length,t.nice_match=k[t.level].nice_length,t.max_chain_length=k[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=ht-1,t.match_available=0,t.ins_h=0}function x(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*at),this.dyn_dtree=new E.Buf16(2*(2*st+1)),this.bl_tree=new E.Buf16(2*(2*ot+1)),s(this.dyn_ltree),s(this.dyn_dtree),s(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(lt+1),this.heap=new E.Buf16(2*nt+1),s(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*nt+1),s(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function _(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=J,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?pt:yt,t.adler=2===e.wrap?0:1,e.last_flush=L,P._tr_init(e),z):r(t,G)}function w(t){var e=_(t);return e===z&&b(t.state),e}function C(t,e){return t&&t.state?2!==t.state.wrap?G:(t.state.gzhead=e,z):G}function T(t,e,i,n,s,o){if(!t)return G;var a=1;if(e===Y&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),s<1||s>$||i!==Q||n<8||n>15||e<0||e>9||o<0||o>Z)return r(t,G);8===n&&(n=9);var l=new x;return t.state=l,l.strm=t,l.wrap=a,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+ht-1)/ht),l.window=new E.Buf8(2*l.w_size),l.head=new E.Buf16(l.hash_size),l.prev=new E.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new E.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=o,l.method=i,w(t)}function A(t,e){return T(t,e,Q,tt,et,K)}function I(t,e){var i,a,u,c;if(!t||!t.state||e>U||e<0)return t?r(t,G):G;if(a=t.state,!t.output||!t.input&&0!==t.avail_in||a.status===bt&&e!==B)return r(t,0===t.avail_out?W:G);if(a.strm=t,i=a.last_flush,a.last_flush=e,a.status===pt)if(2===a.wrap)t.adler=0,l(a,31),l(a,139),l(a,8),a.gzhead?(l(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),l(a,255&a.gzhead.time),l(a,a.gzhead.time>>8&255),l(a,a.gzhead.time>>16&255),l(a,a.gzhead.time>>24&255),l(a,9===a.level?2:a.strategy>=q||a.level<2?4:0),l(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(l(a,255&a.gzhead.extra.length),l(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=D(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=ft):(l(a,0),l(a,0),l(a,0),l(a,0),l(a,0),l(a,9===a.level?2:a.strategy>=q||a.level<2?4:0),l(a,Tt),a.status=yt);else{var d=Q+(a.w_bits-8<<4)<<8,p=-1;p=a.strategy>=q||a.level<2?0:a.level<6?1:6===a.level?2:3,d|=p<<6,0!==a.strstart&&(d|=dt),d+=31-d%31,a.status=yt,h(a,d),0!==a.strstart&&(h(a,t.adler>>>16),h(a,65535&t.adler)),t.adler=1}if(a.status===ft)if(a.gzhead.extra){for(u=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>u&&(t.adler=D(t.adler,a.pending_buf,a.pending-u,u)),o(t),u=a.pending,a.pending!==a.pending_buf_size));)l(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>u&&(t.adler=D(t.adler,a.pending_buf,a.pending-u,u)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=gt)}else a.status=gt;if(a.status===gt)if(a.gzhead.name){u=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>u&&(t.adler=D(t.adler,a.pending_buf,a.pending-u,u)),o(t),u=a.pending,a.pending===a.pending_buf_size)){c=1;break}c=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,l(a,c)}while(0!==c);a.gzhead.hcrc&&a.pending>u&&(t.adler=D(t.adler,a.pending_buf,a.pending-u,u)),0===c&&(a.gzindex=0,a.status=mt)}else a.status=mt;if(a.status===mt)if(a.gzhead.comment){u=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>u&&(t.adler=D(t.adler,a.pending_buf,a.pending-u,u)),o(t),u=a.pending,a.pending===a.pending_buf_size)){c=1;break}c=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,l(a,c)}while(0!==c);a.gzhead.hcrc&&a.pending>u&&(t.adler=D(t.adler,a.pending_buf,a.pending-u,u)),0===c&&(a.status=vt)}else a.status=vt;if(a.status===vt&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&o(t),a.pending+2<=a.pending_buf_size&&(l(a,255&t.adler),l(a,t.adler>>8&255),t.adler=0,a.status=yt)):a.status=yt),0!==a.pending){if(o(t),0===t.avail_out)return a.last_flush=-1,z}else if(0===t.avail_in&&n(e)<=n(i)&&e!==B)return r(t,W);if(a.status===bt&&0!==t.avail_in)return r(t,W);if(0!==t.avail_in||0!==a.lookahead||e!==L&&a.status!==bt){var f=a.strategy===q?v(a,e):a.strategy===X?m(a,e):k[a.level].func(a,e);if(f!==wt&&f!==Ct||(a.status=bt),f===xt||f===wt)return 0===t.avail_out&&(a.last_flush=-1),z;if(f===_t&&(e===F?P._tr_align(a):e!==U&&(P._tr_stored_block(a,0,0,!1),e===O&&(s(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),o(t),0===t.avail_out))return a.last_flush=-1,z}return e!==B?z:a.wrap<=0?j:(2===a.wrap?(l(a,255&t.adler),l(a,t.adler>>8&255),l(a,t.adler>>16&255),l(a,t.adler>>24&255),l(a,255&t.total_in),l(a,t.total_in>>8&255),l(a,t.total_in>>16&255),l(a,t.total_in>>24&255)):(h(a,t.adler>>>16),h(a,65535&t.adler)),o(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?z:j)}function S(t){var e;return t&&t.state?(e=t.state.status,e!==pt&&e!==ft&&e!==gt&&e!==mt&&e!==vt&&e!==yt&&e!==bt?r(t,G):(t.state=null,e===yt?r(t,H):z)):G}function M(t,e){var i,r,n,o,a,l,h,u,c=e.length;if(!t||!t.state)return G;if(i=t.state,o=i.wrap,2===o||1===o&&i.status!==pt||i.lookahead)return G;for(1===o&&(t.adler=R(t.adler,e,c,0)),i.wrap=0,c>=i.w_size&&(0===o&&(s(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new E.Buf8(i.w_size),E.arraySet(u,e,c-i.w_size,i.w_size,0),e=u,c=i.w_size),a=t.avail_in,l=t.next_in,h=t.input,t.avail_in=c,t.next_in=0,t.input=e,d(i);i.lookahead>=ht;){r=i.strstart,n=i.lookahead-(ht-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+ht-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++;while(--n);i.strstart=r,i.lookahead=ht-1,d(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=ht-1,i.match_available=0,t.next_in=l,t.input=h,t.avail_in=a,i.wrap=o,z}var k,E=t("../utils/common"),P=t("./trees"),R=t("./adler32"),D=t("./crc32"),N=t("./messages"),L=0,F=1,O=3,B=4,U=5,z=0,j=1,G=-2,H=-3,W=-5,Y=-1,V=1,q=2,X=3,Z=4,K=0,J=2,Q=8,$=9,tt=15,et=8,it=29,rt=256,nt=rt+1+it,st=30,ot=19,at=2*nt+1,lt=15,ht=3,ut=258,ct=ut+ht+1,dt=32,pt=42,ft=69,gt=73,mt=91,vt=103,yt=113,bt=666,xt=1,_t=2,wt=3,Ct=4,Tt=3;k=[new y(0,0,0,0,p),new y(4,4,8,4,f),new y(4,5,16,8,f),new y(4,6,32,32,f),new y(4,4,16,16,g),new y(8,16,32,32,g),new y(8,16,128,128,g),new y(8,32,128,256,g),new y(32,128,258,1024,g),new y(32,258,258,4096,g)],i.deflateInit=A,i.deflateInit2=T,i.deflateReset=w,i.deflateResetKeep=_,i.deflateSetHeader=C,i.deflate=I,i.deflateEnd=S,i.deflateSetDictionary=M,i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(t,e,i){"use strict";function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=r},{}],69:[function(t,e,i){"use strict";var r=30,n=12;e.exports=function(t,e){var i,s,o,a,l,h,u,c,d,p,f,g,m,v,y,b,x,_,w,C,T,A,I,S,M;i=t.state,s=t.next_in,S=t.input,o=s+(t.avail_in-5),a=t.next_out,M=t.output,l=a-(e-t.avail_out),h=a+(t.avail_out-257),u=i.dmax,c=i.wsize,d=i.whave,p=i.wnext,f=i.window,g=i.hold,m=i.bits,v=i.lencode,y=i.distcode,b=(1<<i.lenbits)-1,x=(1<<i.distbits)-1;t:do{m<15&&(g+=S[s++]<<m,m+=8,g+=S[s++]<<m,m+=8),_=v[g&b];e:for(;;){if(w=_>>>24,g>>>=w,m-=w,w=_>>>16&255,0===w)M[a++]=65535&_;else{if(!(16&w)){if(0===(64&w)){_=v[(65535&_)+(g&(1<<w)-1)];continue e}if(32&w){i.mode=n;break t}t.msg="invalid literal/length code",i.mode=r;break t}C=65535&_,w&=15,w&&(m<w&&(g+=S[s++]<<m,m+=8),C+=g&(1<<w)-1,g>>>=w,m-=w),m<15&&(g+=S[s++]<<m,m+=8,g+=S[s++]<<m,m+=8),_=y[g&x];i:for(;;){if(w=_>>>24,g>>>=w,m-=w,w=_>>>16&255,!(16&w)){if(0===(64&w)){_=y[(65535&_)+(g&(1<<w)-1)];continue i}t.msg="invalid distance code",i.mode=r;break t}if(T=65535&_,w&=15,m<w&&(g+=S[s++]<<m,m+=8,m<w&&(g+=S[s++]<<m,m+=8)),T+=g&(1<<w)-1,T>u){t.msg="invalid distance too far back",i.mode=r;break t}if(g>>>=w,m-=w,w=a-l,T>w){if(w=T-w,w>d&&i.sane){t.msg="invalid distance too far back",i.mode=r;break t}if(A=0,I=f,0===p){if(A+=c-w,w<C){C-=w;do M[a++]=f[A++];while(--w);A=a-T,I=M}}else if(p<w){if(A+=c+p-w,w-=p,w<C){C-=w;do M[a++]=f[A++];while(--w);if(A=0,p<C){w=p,C-=w;do M[a++]=f[A++];while(--w);A=a-T,I=M}}}else if(A+=p-w,w<C){C-=w;do M[a++]=f[A++];while(--w);A=a-T,I=M}for(;C>2;)M[a++]=I[A++],M[a++]=I[A++],M[a++]=I[A++],C-=3;C&&(M[a++]=I[A++],C>1&&(M[a++]=I[A++]))}else{A=a-T;do M[a++]=M[A++],M[a++]=M[A++],M[a++]=M[A++],C-=3;while(C>2);C&&(M[a++]=M[A++],C>1&&(M[a++]=M[A++]))}break}}break}}while(s<o&&a<h);C=m>>3,s-=C,m-=C<<3,g&=(1<<m)-1,t.next_in=s,t.next_out=a,t.avail_in=s<o?5+(o-s):5-(s-o),t.avail_out=a<h?257+(h-a):257-(a-h),i.hold=g,i.bits=m}},{}],70:[function(t,e,i){"use strict";function r(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new y.Buf16(320),this.work=new y.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=O,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new y.Buf32(gt),e.distcode=e.distdyn=new y.Buf32(mt),e.sane=1,e.back=-1,k):R}function o(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,s(t)):R}function a(t,e){var i,r;return t&&t.state?(r=t.state,e<0?(i=0,e=-e):(i=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?R:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=i,r.wbits=e,o(t))):R}function l(t,e){var i,r;return t?(r=new n,t.state=r,r.window=null,i=a(t,e),i!==k&&(t.state=null),i):R}function h(t){return l(t,yt)}function u(t){if(bt){var e;for(m=new y.Buf32(512),v=new y.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(w(T,t.lens,0,288,m,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;w(A,t.lens,0,32,v,0,t.work,{bits:5}),bt=!1}t.lencode=m,t.lenbits=9,t.distcode=v,t.distbits=5}function c(t,e,i,r){var n,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new y.Buf8(s.wsize)),r>=s.wsize?(y.arraySet(s.window,e,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>r&&(n=r),y.arraySet(s.window,e,i-r,n,s.wnext),r-=n,r?(y.arraySet(s.window,e,i-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0}function d(t,e){var i,n,s,o,a,l,h,d,p,f,g,m,v,gt,mt,vt,yt,bt,xt,_t,wt,Ct,Tt,At,It=0,St=new y.Buf8(4),Mt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return R;i=t.state,i.mode===X&&(i.mode=Z),a=t.next_out,s=t.output,h=t.avail_out,o=t.next_in,n=t.input,l=t.avail_in,d=i.hold,p=i.bits,f=l,g=h,Ct=k;t:for(;;)switch(i.mode){case O:if(0===i.wrap){i.mode=Z;break}for(;p<16;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(2&i.wrap&&35615===d){i.check=0,St[0]=255&d,St[1]=d>>>8&255,i.check=x(i.check,St,2,0),d=0,p=0,i.mode=B;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&d)<<8)+(d>>8))%31){t.msg="incorrect header check",i.mode=dt;break}if((15&d)!==F){t.msg="unknown compression method",i.mode=dt;break}if(d>>>=4,p-=4,wt=(15&d)+8,0===i.wbits)i.wbits=wt;else if(wt>i.wbits){t.msg="invalid window size",i.mode=dt;break}i.dmax=1<<wt,t.adler=i.check=1,i.mode=512&d?V:X,d=0,p=0;break;case B:for(;p<16;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(i.flags=d,(255&i.flags)!==F){t.msg="unknown compression method",i.mode=dt;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=dt;break}i.head&&(i.head.text=d>>8&1),512&i.flags&&(St[0]=255&d,St[1]=d>>>8&255,i.check=x(i.check,St,2,0)),d=0,p=0,i.mode=U;case U:for(;p<32;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}i.head&&(i.head.time=d),512&i.flags&&(St[0]=255&d,St[1]=d>>>8&255,St[2]=d>>>16&255,St[3]=d>>>24&255,i.check=x(i.check,St,4,0)),d=0,p=0,i.mode=z;case z:for(;p<16;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}i.head&&(i.head.xflags=255&d,i.head.os=d>>8),512&i.flags&&(St[0]=255&d,St[1]=d>>>8&255,i.check=x(i.check,St,2,0)),d=0,p=0,i.mode=j;case j:if(1024&i.flags){for(;p<16;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}i.length=d,i.head&&(i.head.extra_len=d),512&i.flags&&(St[0]=255&d,St[1]=d>>>8&255,i.check=x(i.check,St,2,0)),d=0,p=0}else i.head&&(i.head.extra=null);i.mode=G;case G:if(1024&i.flags&&(m=i.length,m>l&&(m=l),m&&(i.head&&(wt=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),y.arraySet(i.head.extra,n,o,m,wt)),512&i.flags&&(i.check=x(i.check,n,m,o)),l-=m,o+=m,i.length-=m),i.length))break t;i.length=0,i.mode=H;case H:if(2048&i.flags){if(0===l)break t;m=0;do wt=n[o+m++],i.head&&wt&&i.length<65536&&(i.head.name+=String.fromCharCode(wt));while(wt&&m<l);if(512&i.flags&&(i.check=x(i.check,n,m,o)),l-=m,o+=m,wt)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=W;case W:if(4096&i.flags){if(0===l)break t;m=0;do wt=n[o+m++],i.head&&wt&&i.length<65536&&(i.head.comment+=String.fromCharCode(wt));while(wt&&m<l);if(512&i.flags&&(i.check=x(i.check,n,m,o)),l-=m,o+=m,wt)break t}else i.head&&(i.head.comment=null);i.mode=Y;case Y:if(512&i.flags){for(;p<16;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(d!==(65535&i.check)){t.msg="header crc mismatch",i.mode=dt;break}d=0,p=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=X;break;case V:for(;p<32;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}t.adler=i.check=r(d),d=0,p=0,i.mode=q;case q:if(0===i.havedict)return t.next_out=a,t.avail_out=h,t.next_in=o,t.avail_in=l,i.hold=d,i.bits=p,P;t.adler=i.check=1,i.mode=X;case X:if(e===S||e===M)break t;case Z:if(i.last){d>>>=7&p,p-=7&p,i.mode=ht;break}for(;p<3;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}switch(i.last=1&d,d>>>=1,p-=1,3&d){case 0:i.mode=K;break;case 1:if(u(i),i.mode=it,e===M){d>>>=2,p-=2;break t}break;case 2:i.mode=$;break;case 3:t.msg="invalid block type",i.mode=dt}d>>>=2,p-=2;break;case K:for(d>>>=7&p,p-=7&p;p<32;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if((65535&d)!==(d>>>16^65535)){t.msg="invalid stored block lengths",i.mode=dt;break}if(i.length=65535&d,d=0,p=0,i.mode=J,e===M)break t;case J:i.mode=Q;case Q:if(m=i.length){if(m>l&&(m=l),m>h&&(m=h),0===m)break t;y.arraySet(s,n,o,m,a),l-=m,o+=m,h-=m,a+=m,i.length-=m;break}i.mode=X;break;case $:for(;p<14;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(i.nlen=(31&d)+257,d>>>=5,p-=5,i.ndist=(31&d)+1,d>>>=5,p-=5,i.ncode=(15&d)+4,d>>>=4,p-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=dt;break}i.have=0,i.mode=tt;case tt:for(;i.have<i.ncode;){for(;p<3;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}i.lens[Mt[i.have++]]=7&d,d>>>=3,p-=3}for(;i.have<19;)i.lens[Mt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Tt={bits:i.lenbits},Ct=w(C,i.lens,0,19,i.lencode,0,i.work,Tt),i.lenbits=Tt.bits,Ct){t.msg="invalid code lengths set",i.mode=dt;break}i.have=0,i.mode=et;case et:for(;i.have<i.nlen+i.ndist;){for(;It=i.lencode[d&(1<<i.lenbits)-1],mt=It>>>24,vt=It>>>16&255,yt=65535&It,!(mt<=p);){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(yt<16)d>>>=mt,p-=mt,i.lens[i.have++]=yt;else{if(16===yt){for(At=mt+2;p<At;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(d>>>=mt,p-=mt,0===i.have){t.msg="invalid bit length repeat",i.mode=dt;break}wt=i.lens[i.have-1],m=3+(3&d),d>>>=2,p-=2}else if(17===yt){for(At=mt+3;p<At;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}d>>>=mt,p-=mt,wt=0,m=3+(7&d),d>>>=3,p-=3}else{for(At=mt+7;p<At;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}d>>>=mt,p-=mt,wt=0,m=11+(127&d),d>>>=7,p-=7}if(i.have+m>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=dt;break}for(;m--;)i.lens[i.have++]=wt}}if(i.mode===dt)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=dt;break}if(i.lenbits=9,Tt={bits:i.lenbits},Ct=w(T,i.lens,0,i.nlen,i.lencode,0,i.work,Tt),i.lenbits=Tt.bits,Ct){t.msg="invalid literal/lengths set",i.mode=dt;break}if(i.distbits=6,i.distcode=i.distdyn,Tt={bits:i.distbits},Ct=w(A,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Tt),i.distbits=Tt.bits,Ct){t.msg="invalid distances set",i.mode=dt;break}if(i.mode=it,e===M)break t;case it:i.mode=rt;case rt:if(l>=6&&h>=258){t.next_out=a,t.avail_out=h,t.next_in=o,t.avail_in=l,i.hold=d,i.bits=p,_(t,g),a=t.next_out,s=t.output,h=t.avail_out,o=t.next_in,n=t.input,l=t.avail_in,d=i.hold,p=i.bits,i.mode===X&&(i.back=-1);break}for(i.back=0;It=i.lencode[d&(1<<i.lenbits)-1],mt=It>>>24,vt=It>>>16&255,yt=65535&It,!(mt<=p);){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(vt&&0===(240&vt)){for(bt=mt,xt=vt,_t=yt;It=i.lencode[_t+((d&(1<<bt+xt)-1)>>bt)],mt=It>>>24,vt=It>>>16&255,yt=65535&It,!(bt+mt<=p);){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}d>>>=bt,p-=bt,i.back+=bt}if(d>>>=mt,p-=mt,i.back+=mt,i.length=yt,0===vt){i.mode=lt;break}if(32&vt){i.back=-1,i.mode=X;break}if(64&vt){t.msg="invalid literal/length code",i.mode=dt;break}i.extra=15&vt,i.mode=nt;case nt:if(i.extra){for(At=i.extra;p<At;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}i.length+=d&(1<<i.extra)-1,d>>>=i.extra,p-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=st;case st:for(;It=i.distcode[d&(1<<i.distbits)-1],mt=It>>>24,vt=It>>>16&255,yt=65535&It,!(mt<=p);){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(0===(240&vt)){for(bt=mt,xt=vt,_t=yt;It=i.distcode[_t+((d&(1<<bt+xt)-1)>>bt)],mt=It>>>24,vt=It>>>16&255,yt=65535&It,!(bt+mt<=p);){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}d>>>=bt,p-=bt,i.back+=bt}if(d>>>=mt,p-=mt,i.back+=mt,64&vt){t.msg="invalid distance code",i.mode=dt;break}i.offset=yt,i.extra=15&vt,i.mode=ot;case ot:if(i.extra){for(At=i.extra;p<At;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}i.offset+=d&(1<<i.extra)-1,d>>>=i.extra,p-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=dt;break}i.mode=at;case at:if(0===h)break t;if(m=g-h,i.offset>m){if(m=i.offset-m,m>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=dt;break}m>i.wnext?(m-=i.wnext,v=i.wsize-m):v=i.wnext-m,m>i.length&&(m=i.length),gt=i.window}else gt=s,v=a-i.offset,m=i.length;m>h&&(m=h),h-=m,i.length-=m;do s[a++]=gt[v++];while(--m);0===i.length&&(i.mode=rt);break;case lt:if(0===h)break t;s[a++]=i.length,h--,i.mode=rt;break;
case ht:if(i.wrap){for(;p<32;){if(0===l)break t;l--,d|=n[o++]<<p,p+=8}if(g-=h,t.total_out+=g,i.total+=g,g&&(t.adler=i.check=i.flags?x(i.check,s,g,a-g):b(i.check,s,g,a-g)),g=h,(i.flags?d:r(d))!==i.check){t.msg="incorrect data check",i.mode=dt;break}d=0,p=0}i.mode=ut;case ut:if(i.wrap&&i.flags){for(;p<32;){if(0===l)break t;l--,d+=n[o++]<<p,p+=8}if(d!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=dt;break}d=0,p=0}i.mode=ct;case ct:Ct=E;break t;case dt:Ct=D;break t;case pt:return N;case ft:default:return R}return t.next_out=a,t.avail_out=h,t.next_in=o,t.avail_in=l,i.hold=d,i.bits=p,(i.wsize||g!==t.avail_out&&i.mode<dt&&(i.mode<ht||e!==I))&&c(t,t.output,t.next_out,g-t.avail_out)?(i.mode=pt,N):(f-=t.avail_in,g-=t.avail_out,t.total_in+=f,t.total_out+=g,i.total+=g,i.wrap&&g&&(t.adler=i.check=i.flags?x(i.check,s,g,t.next_out-g):b(i.check,s,g,t.next_out-g)),t.data_type=i.bits+(i.last?64:0)+(i.mode===X?128:0)+(i.mode===it||i.mode===J?256:0),(0===f&&0===g||e===I)&&Ct===k&&(Ct=L),Ct)}function p(t){if(!t||!t.state)return R;var e=t.state;return e.window&&(e.window=null),t.state=null,k}function f(t,e){var i;return t&&t.state?(i=t.state,0===(2&i.wrap)?R:(i.head=e,e.done=!1,k)):R}function g(t,e){var i,r,n,s=e.length;return t&&t.state?(i=t.state,0!==i.wrap&&i.mode!==q?R:i.mode===q&&(r=1,r=b(r,e,s,0),r!==i.check)?D:(n=c(t,e,s,s))?(i.mode=pt,N):(i.havedict=1,k)):R}var m,v,y=t("../utils/common"),b=t("./adler32"),x=t("./crc32"),_=t("./inffast"),w=t("./inftrees"),C=0,T=1,A=2,I=4,S=5,M=6,k=0,E=1,P=2,R=-2,D=-3,N=-4,L=-5,F=8,O=1,B=2,U=3,z=4,j=5,G=6,H=7,W=8,Y=9,V=10,q=11,X=12,Z=13,K=14,J=15,Q=16,$=17,tt=18,et=19,it=20,rt=21,nt=22,st=23,ot=24,at=25,lt=26,ht=27,ut=28,ct=29,dt=30,pt=31,ft=32,gt=852,mt=592,vt=15,yt=vt,bt=!0;i.inflateReset=o,i.inflateReset2=a,i.inflateResetKeep=s,i.inflateInit=h,i.inflateInit2=l,i.inflate=d,i.inflateEnd=p,i.inflateGetHeader=f,i.inflateSetDictionary=g,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(t,e,i){"use strict";var r=t("../utils/common"),n=15,s=852,o=592,a=0,l=1,h=2,u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,f,g,m,v,y){var b,x,_,w,C,T,A,I,S,M=y.bits,k=0,E=0,P=0,R=0,D=0,N=0,L=0,F=0,O=0,B=0,U=null,z=0,j=new r.Buf16(n+1),G=new r.Buf16(n+1),H=null,W=0;for(k=0;k<=n;k++)j[k]=0;for(E=0;E<f;E++)j[e[i+E]]++;for(D=M,R=n;R>=1&&0===j[R];R--);if(D>R&&(D=R),0===R)return g[m++]=20971520,g[m++]=20971520,y.bits=1,0;for(P=1;P<R&&0===j[P];P++);for(D<P&&(D=P),F=1,k=1;k<=n;k++)if(F<<=1,F-=j[k],F<0)return-1;if(F>0&&(t===a||1!==R))return-1;for(G[1]=0,k=1;k<n;k++)G[k+1]=G[k]+j[k];for(E=0;E<f;E++)0!==e[i+E]&&(v[G[e[i+E]]++]=E);if(t===a?(U=H=v,T=19):t===l?(U=u,z-=257,H=c,W-=257,T=256):(U=d,H=p,T=-1),B=0,E=0,k=P,C=m,N=D,L=0,_=-1,O=1<<D,w=O-1,t===l&&O>s||t===h&&O>o)return 1;for(var Y=0;;){Y++,A=k-L,v[E]<T?(I=0,S=v[E]):v[E]>T?(I=H[W+v[E]],S=U[z+v[E]]):(I=96,S=0),b=1<<k-L,x=1<<N,P=x;do x-=b,g[C+(B>>L)+x]=A<<24|I<<16|S|0;while(0!==x);for(b=1<<k-1;B&b;)b>>=1;if(0!==b?(B&=b-1,B+=b):B=0,E++,0===--j[k]){if(k===R)break;k=e[i+v[E]]}if(k>D&&(B&w)!==_){for(0===L&&(L=D),C+=P,N=k-L,F=1<<N;N+L<R&&(F-=j[N+L],!(F<=0));)N++,F<<=1;if(O+=1<<N,t===l&&O>s||t===h&&O>o)return 1;_=B&w,g[_]=D<<24|N<<16|C-m|0}}return 0!==B&&(g[C+B]=k-L<<24|64<<16|0),y.bits=D,0}},{"../utils/common":62}],72:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(t,e,i){"use strict";function r(t){for(var e=t.length;--e>=0;)t[e]=0}function n(t,e,i,r,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=t&&t.length}function s(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function o(t){return t<256?lt[t]:lt[256+(t>>>7)]}function a(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function l(t,e,i){t.bi_valid>Z-i?(t.bi_buf|=e<<t.bi_valid&65535,a(t,t.bi_buf),t.bi_buf=e>>Z-t.bi_valid,t.bi_valid+=i-Z):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function h(t,e,i){l(t,i[2*e],i[2*e+1])}function u(t,e){var i=0;do i|=1&t,t>>>=1,i<<=1;while(--e>0);return i>>>1}function c(t){16===t.bi_valid?(a(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function d(t,e){var i,r,n,s,o,a,l=e.dyn_tree,h=e.max_code,u=e.stat_desc.static_tree,c=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,f=e.stat_desc.max_length,g=0;for(s=0;s<=X;s++)t.bl_count[s]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<q;i++)r=t.heap[i],s=l[2*l[2*r+1]+1]+1,s>f&&(s=f,g++),l[2*r+1]=s,r>h||(t.bl_count[s]++,o=0,r>=p&&(o=d[r-p]),a=l[2*r],t.opt_len+=a*(s+o),c&&(t.static_len+=a*(u[2*r+1]+o)));if(0!==g){do{for(s=f-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[f]--,g-=2}while(g>0);for(s=f;0!==s;s--)for(r=t.bl_count[s];0!==r;)n=t.heap[--i],n>h||(l[2*n+1]!==s&&(t.opt_len+=(s-l[2*n+1])*l[2*n],l[2*n+1]=s),r--)}}function p(t,e,i){var r,n,s=new Array(X+1),o=0;for(r=1;r<=X;r++)s[r]=o=o+i[r-1]<<1;for(n=0;n<=e;n++){var a=t[2*n+1];0!==a&&(t[2*n]=u(s[a]++,a))}}function f(){var t,e,i,r,s,o=new Array(X+1);for(i=0,r=0;r<G-1;r++)for(ut[r]=i,t=0;t<1<<et[r];t++)ht[i++]=r;for(ht[i-1]=r,s=0,r=0;r<16;r++)for(ct[r]=s,t=0;t<1<<it[r];t++)lt[s++]=r;for(s>>=7;r<Y;r++)for(ct[r]=s<<7,t=0;t<1<<it[r]-7;t++)lt[256+s++]=r;for(e=0;e<=X;e++)o[e]=0;for(t=0;t<=143;)ot[2*t+1]=8,t++,o[8]++;for(;t<=255;)ot[2*t+1]=9,t++,o[9]++;for(;t<=279;)ot[2*t+1]=7,t++,o[7]++;for(;t<=287;)ot[2*t+1]=8,t++,o[8]++;for(p(ot,W+1,o),t=0;t<Y;t++)at[2*t+1]=5,at[2*t]=u(t,5);dt=new n(ot,et,H+1,W,X),pt=new n(at,it,0,Y,X),ft=new n(new Array(0),rt,0,V,K)}function g(t){var e;for(e=0;e<W;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Y;e++)t.dyn_dtree[2*e]=0;for(e=0;e<V;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*J]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function m(t){t.bi_valid>8?a(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function v(t,e,i,r){m(t),r&&(a(t,i),a(t,~i)),R.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}function y(t,e,i,r){var n=2*e,s=2*i;return t[n]<t[s]||t[n]===t[s]&&r[e]<=r[i]}function b(t,e,i){for(var r=t.heap[i],n=i<<1;n<=t.heap_len&&(n<t.heap_len&&y(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!y(e,r,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=r}function x(t,e,i){var r,n,s,a,u=0;if(0!==t.last_lit)do r=t.pending_buf[t.d_buf+2*u]<<8|t.pending_buf[t.d_buf+2*u+1],n=t.pending_buf[t.l_buf+u],u++,0===r?h(t,n,e):(s=ht[n],h(t,s+H+1,e),a=et[s],0!==a&&(n-=ut[s],l(t,n,a)),r--,s=o(r),h(t,s,i),a=it[s],0!==a&&(r-=ct[s],l(t,r,a)));while(u<t.last_lit);h(t,J,e)}function _(t,e){var i,r,n,s=e.dyn_tree,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=q,i=0;i<l;i++)0!==s[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):s[2*i+1]=0;for(;t.heap_len<2;)n=t.heap[++t.heap_len]=h<2?++h:0,s[2*n]=1,t.depth[n]=0,t.opt_len--,a&&(t.static_len-=o[2*n+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)b(t,s,i);n=l;do i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],b(t,s,1),r=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=r,s[2*n]=s[2*i]+s[2*r],t.depth[n]=(t.depth[i]>=t.depth[r]?t.depth[i]:t.depth[r])+1,s[2*i+1]=s[2*r+1]=n,t.heap[1]=n++,b(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],d(t,e),p(s,h,t.bl_count)}function w(t,e,i){var r,n,s=-1,o=e[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),e[2*(i+1)+1]=65535,r=0;r<=i;r++)n=o,o=e[2*(r+1)+1],++a<l&&n===o||(a<h?t.bl_tree[2*n]+=a:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[2*Q]++):a<=10?t.bl_tree[2*$]++:t.bl_tree[2*tt]++,a=0,s=n,0===o?(l=138,h=3):n===o?(l=6,h=3):(l=7,h=4))}function C(t,e,i){var r,n,s=-1,o=e[1],a=0,u=7,c=4;for(0===o&&(u=138,c=3),r=0;r<=i;r++)if(n=o,o=e[2*(r+1)+1],!(++a<u&&n===o)){if(a<c){do h(t,n,t.bl_tree);while(0!==--a)}else 0!==n?(n!==s&&(h(t,n,t.bl_tree),a--),h(t,Q,t.bl_tree),l(t,a-3,2)):a<=10?(h(t,$,t.bl_tree),l(t,a-3,3)):(h(t,tt,t.bl_tree),l(t,a-11,7));a=0,s=n,0===o?(u=138,c=3):n===o?(u=6,c=3):(u=7,c=4)}}function T(t){var e;for(w(t,t.dyn_ltree,t.l_desc.max_code),w(t,t.dyn_dtree,t.d_desc.max_code),_(t,t.bl_desc),e=V-1;e>=3&&0===t.bl_tree[2*nt[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function A(t,e,i,r){var n;for(l(t,e-257,5),l(t,i-1,5),l(t,r-4,4),n=0;n<r;n++)l(t,t.bl_tree[2*nt[n]+1],3);C(t,t.dyn_ltree,e-1),C(t,t.dyn_dtree,i-1)}function I(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return N;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return L;for(e=32;e<H;e++)if(0!==t.dyn_ltree[2*e])return L;return N}function S(t){gt||(f(),gt=!0),t.l_desc=new s(t.dyn_ltree,dt),t.d_desc=new s(t.dyn_dtree,pt),t.bl_desc=new s(t.bl_tree,ft),t.bi_buf=0,t.bi_valid=0,g(t)}function M(t,e,i,r){l(t,(O<<1)+(r?1:0),3),v(t,e,i,!0)}function k(t){l(t,B<<1,3),h(t,J,ot),c(t)}function E(t,e,i,r){var n,s,o=0;t.level>0?(t.strm.data_type===F&&(t.strm.data_type=I(t)),_(t,t.l_desc),_(t,t.d_desc),o=T(t),n=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=n&&(n=s)):n=s=i+5,i+4<=n&&e!==-1?M(t,e,i,r):t.strategy===D||s===n?(l(t,(B<<1)+(r?1:0),3),x(t,ot,at)):(l(t,(U<<1)+(r?1:0),3),A(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),x(t,t.dyn_ltree,t.dyn_dtree)),g(t),r&&m(t)}function P(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(ht[i]+H+1)]++,t.dyn_dtree[2*o(e)]++),t.last_lit===t.lit_bufsize-1}var R=t("../utils/common"),D=4,N=0,L=1,F=2,O=0,B=1,U=2,z=3,j=258,G=29,H=256,W=H+1+G,Y=30,V=19,q=2*W+1,X=15,Z=16,K=7,J=256,Q=16,$=17,tt=18,et=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],it=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],rt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],nt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],st=512,ot=new Array(2*(W+2));r(ot);var at=new Array(2*Y);r(at);var lt=new Array(st);r(lt);var ht=new Array(j-z+1);r(ht);var ut=new Array(G);r(ut);var ct=new Array(Y);r(ct);var dt,pt,ft,gt=!1;i._tr_init=S,i._tr_stored_block=M,i._tr_flush_block=E,i._tr_tally=P,i._tr_align=k},{"../utils/common":62}],74:[function(t,e,i){"use strict";function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=r},{}]},{},[10])(10)});var s=s||function(t){"use strict";if(!("undefined"==typeof t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,i=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in r,s=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},o=/constructor/i.test(t.HTMLElement)||t.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),l=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},h="application/octet-stream",u=4e4,c=function(t){var e=function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()};setTimeout(e,u)},d=function(t,e,i){e=[].concat(e);for(var r=e.length;r--;){var n=t["on"+e[r]];if("function"==typeof n)try{n.call(t,i||t)}catch(t){l(t)}}},p=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},f=function(e,l,u){u||(e=p(e));var f,g=this,m=e.type,v=m===h,y=function(){d(g,"writestart progress write writeend".split(" "))},b=function(){if((a||v&&o)&&t.FileReader){var r=new FileReader;return r.onloadend=function(){var e=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;"),i=t.open(e,"_blank");i||(t.location.href=e),e=void 0,g.readyState=g.DONE,y()},r.readAsDataURL(e),void(g.readyState=g.INIT)}if(f||(f=i().createObjectURL(e)),v)t.location.href=f;else{var n=t.open(f,"_blank");n||(t.location.href=f)}g.readyState=g.DONE,y(),c(f)};return g.readyState=g.INIT,n?(f=i().createObjectURL(e),void setTimeout(function(){r.href=f,r.download=l,s(r),y(),c(f),g.readyState=g.DONE})):void b()},g=f.prototype,m=function(t,e,i){return new f(t,e||t.name||"download",i)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=p(t)),navigator.msSaveOrOpenBlob(t,e)}:(g.abort=function(){},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,m)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);return"undefined"!=typeof module&&module.exports?module.exports.saveAs=s:"undefined"!=typeof r&&null!==r&&null!==r.amd&&r("FileSaver.js",[],function(){return s}),r("saveAs",function(){}),r("Services/ExportToolCore",["jquery","underscore-min","jszip","saveAs","../Gui/dialog/ErrorDialog","../Utils/Constants"],function(t,i,r,n,s,o){function a(){return g=[],i.each(f,function(t){t.isVisible()&&"Other"!==t.category&&"Solar System"!==t.category&&"SAMP"!==t.name&&"Planets"!==t.name&&(t.layerId=i.uniqueId("layer_"),g.push(t))}),g}function l(r){d.coordinates=r.data,t("body").mask("Exporting data...");var n=e("jszip"),a=new n,l=[],h=[];i.each(g,function(e){t("#"+e.layerId).is(":checked")&&(e.type===o.LAYER.OpenSearch||e.type===o.LAYER.GeoJSON?h.push(e):e.type!==o.LAYER.Hips&&e.type!==o.LAYER.HipsCat||l.push(e))});var u=[(d.coordinates[0][1]+d.coordinates[1][1])/2,(d.coordinates[0][0]+d.coordinates[3][0])/2,0];d.coordinates.push(u);var c=[];if(i.each(h,function(t,e){for(var r=0;r<d.coordinates.length;r++){var n=p.getActivatedContext().getTileManager().getVisibleTile(d.coordinates[r][0],d.coordinates[r][1]);if(i.isEmpty(n))return;var s=n.extension[t.extId];i.isEmpty(s)||i.isEmpty(s.featureIds)||i.each(s.featureIds,function(e){var r=t.featuresSet[e];if(!i.isEmpty(r)){var n=t.features[r.index],s=!0;switch(n.geometry.type){case o.GEOMETRY.Point:s=d.checkIfPointInBbox(n.geometry.coordinates,d.coordinates);break;case o.GEOMETRY.Polygon:for(var a=0;a<n.geometry.coordinates.length;a++){if(!s)return;s=d.checkIfPointInBbox(n.geometry.coordinates[0][a],d.coordinates)}}s&&(n.parentInformation={copyright:t.copyright||"",copyrightUrl:t.copyrightUrl||"",category:t.category,name:t.name},c.push(n))}})}}),i.each(c,function(t){var e=a.folder(t.parentInformation.category+"/"+t.parentInformation.name);if(!i.isEmpty(t.parentInformation.copyright)||!i.isEmpty(t.parentInformation.copyrightUrl)){var r="Copyright : "+t.parentInformation.copyright+" - link : "+t.parentInformation.copyrightUrl;e.file(t.parentInformation.name+".txt",r)}var n={geometry:{coordinates:t.geometry.coordinates,gid:t.geometry.gid,type:t.geometry.type,crs:{type:"name",properties:{name:p.getCrs().getGeoideName()}}},id:t.id,properties:t.properties,type:t.type};e.file(t.properties.identifier+".json",JSON.stringify(n,null,"\t"))}),0===l.length)d.downloadArchive(a);else{var f=0,m=!1;i.each(l,function(t,e){t.urlImages=[],t.images=[];for(var r=0;r<d.coordinates.length;r++){var n=p.getActivatedContext().getTileManager().getVisibleTile(d.coordinates[r][0],d.coordinates[r][1]);if(i.isEmpty(n))return;f++;var o=t.getUrl(n),l=new Image;l.aborted=!1,l.crossOrigin="",l.backgroundName=t.name,l.parentFolder=t.category+"/"+t.name+"/images",l.imageName=o.substring(o.lastIndexOf("/")+1,o.length),l.onload=function(){d.addImageToArchive(this,a),f--,0==f&&d.downloadArchive(a)},l.onerror=function(){m=!0,console.dir("Error while retrieving image : "+this.imageName),f--,0==f&&(m&&s.open("Some images not found. Change zoom level and retry downloading"),d.downloadArchive(a))},l.src=o}})}}function h(i){var r=e("saveAs"),n=new Date,s=t.datepicker.formatDate("yy/mm/dd "+n.getHours()+":"+n.getMinutes(),n),o="Date : "+s+"\nQuery :"+JSON.stringify(d.coordinates,null,"\t")+"\nCopyright : Generated by MIZAR";i.file("README.txt",o);var a=i.generate({type:"blob"});r(a,"archive_"+s+".zip"),t("body").unmask()}function u(t,e){var i=e.folder(t.parentFolder);i.file(t.imageName,d.getBase64Image(t),{base64:!0})}function c(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var i=e.getContext("2d");i.drawImage(t,0,0);var r=e.toDataURL("image/png");return r.replace(/^data:image\/(png|jpg);base64,/,"")}var d,p,f,g;return{init:function(t,e){p=t,f=p.getLayers(o.CONTEXT.Sky),d=this},exportSelection:l,addImageToArchive:u,downloadArchive:h,getBase64Image:c,filterServicesAvailableOnLayers:a}}),r("NameResolver/AbstractNameResolver",[],function(){var t=function(t){this.ctx=t};return t.prototype.handle=function(t){throw"handle from NameResolver not implemented"},t.prototype.remove=function(){throw"remove from NameResolver not implemented"},t}),r("NameResolver/CDSNameResolver",["jquery","underscore-min","../Utils/Constants","../Utils/Utils","./AbstractNameResolver"],function(t,e,i,r,n){var s=function(t){n.prototype.constructor.call(this,t)};return r.inherits(n,s),s.prototype.handle=function(r){var n=(this.ctx,r.objectName),s=r.onError,o=r.onComplete,a=r.onSuccess,l=r.searchLayer,h=r.zoomTo,u="http://cdsweb.u-strasbg.fr/cgi-bin/nph-sesame/-oxp/A?"+n;t.ajax({type:"GET",url:u,dataType:"xml",success:function(r){var o=t(r).find("Target"),u=t(o).find("name").text(),c=[];t(o).find("Resolver").each(function(i){var r=this,n=t(r).find("jradeg"),s=t(r).find("jdedeg");if(!e.isEmpty(n.text())&&!e.isEmpty(s.text())){n=parseFloat(n.text()),s=parseFloat(s.text());var o={};o.ra=n,o.dec=s,o.credit=t(r).attr("name"),c.push(o)}});var d={totalResults:c.length,type:"FeatureCollection",features:[]};if(e.each(c,function(t){d.features.push({type:"Feature",geometry:{coordinates:[t.ra,t.dec],type:i.GEOMETRY.Point,crs:{type:"name",properties:{name:i.CRS.Equatorial}}},properties:{identifier:"CDS0",name:u,credits:'Powered by <a href="http://cdsweb.u-strasbg.fr/cgi-bin/Sesame">Sesame API</a> ('+t.credit+")"}})}),"FeatureCollection"===d.type&&d.features.length>0){var p=d.features[0],f=function(){l(n,a,s,d)};h(p.geometry.coordinates[0],p.geometry.coordinates[1],i.CRS.Equatorial,f,d)}else l(n,a,s,d)},error:function(t){l(n,a,s),console.error(t.responseText)},complete:function(t,e){o&&o(t)}})},s.prototype.remove=function(){},s}),r("NameResolver/DictionaryNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver","../Layer/VectorLayer","../Renderer/FeatureStyle","../Utils/Constants"],function(t,e,i,r,n,s,o){var a,l=function(e){var i=e.getContextConfiguration().nameResolver.baseUrl.indexOf("json")>=0;if(i){var r=e.getContextConfiguration().nameResolver.baseUrl;t.ajax({type:"GET",dataType:"json",url:r,success:function(t){a=t},error:function(t){console.error(t)}})}else a=null},h=function(t){r.prototype.constructor.call(this,t),a=l(t)};return i.inherits(r,h),h.prototype.handle=function(t){var i=this.ctx,r=t.objectName,n=t.onError,s=(t.onComplete,t.onSuccess),l=t.searchLayer,h=t.zoomTo,u=e.find(a.features,function(t){return t.properties.Name.toLowerCase()===r.toLowerCase()});if(u){var c=parseFloat(u.properties.center_lon),d=parseFloat(u.properties.center_lat);u.geometry.crs={type:"name",properties:{name:i.getCoordinateSystem().getGeoideName()}};var p=function(){l(r,s,n,{features:[u]})};h(c,d,o.CRS.Mars_2000,p,{features:[u]})}else l(r,s,n)},h.prototype.remove=function(){a=null},h}),r("NameResolver/IMCCENameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver","../Utils/Constants"],function(t,e,i,r,n){var s=function(t){r.prototype.constructor.call(this,t)};return i.inherits(r,s),s.prototype.handle=function(i){var r=i.objectName,s=i.onError,o=i.onComplete,a=i.onSuccess,l=i.searchLayer,h=i.zoomTo,u="https://api.ssodnet.imcce.fr/quaero/1/sso?q="+r+"&from=Mizar";t.ajax({type:"GET",url:u,dataType:"json",success:function(i){function o(t,i){var r=[],n=0,o=t.length;0===o?s():e.each(t,function(t){u(t,function(t){n++,e.isEmpty(t)||r.push(t),n===o&&i(r)})})}function u(i,r){var n=i.type,s=i.id,o=i.name;if(t.inArray(n,["Planet","Asteroid","Satellite","Star","Comet"])!==-1){var a="https://api.ssodnet.imcce.fr/quaero/1/sso/"+s+"/resolver";t.ajax({type:"GET",url:a,dataType:"json",success:function(t){var i=t.geometry.coordinates,a=360*i[0]/24,l=i[1];if(e.isNumber(a)&&e.isNumber(l)){a=parseFloat(a),l=parseFloat(l);var h={};h.ra=a,h.dec=l,h.credits='Powered by <a href="http://vo.imcce.fr/webservices/ssodnet/?quaero" target="_blank">SsODNet/Quaero API</a>.',h.id=s,h.type=n,h.name=o,r(h)}},error:function(t){console.error(t.responseText)}})}else r()}function c(t){var i={totalResults:t.length,type:"FeatureCollection",features:[]};if(e.each(t,function(t){i.features.push({type:"Feature",geometry:{coordinates:[t.ra,t.dec],type:"Point",crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{identifier:t.id,type:t.type,name:t.name,credits:t.credits}})}),"FeatureCollection"===i.type&&i.features.length>0){var o=i.features[0],u=function(){l(r,a,s,i)};h(o.geometry.coordinates[0],o.geometry.coordinates[1],n.CRS.Equatorial,u,i)}else s()}var d=i.data;o(d,c)},error:function(t){l(r,a,s),console.error(t.responseText)},complete:function(t){o&&o(t)}})},s.prototype.remove=function(){},s}),r("NameResolver/DefaultNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver"],function(t,e,i,r){var n=function(t){r.prototype.constructor.call(this,t)};return i.inherits(r,n),n.prototype.handle=function(e){var i=this.ctx,r=e.objectName,n=e.onError,s=e.onComplete,o=e.onSuccess,a=e.searchLayer,l=e.zoomTo,h=i.getMizarConfiguration().nameResolver.baseUrl+"/"+r+"/EQUATORIAL";t.ajax({type:"GET",url:h,success:function(t){if("FeatureCollection"===t.type){var e=t.features[0],i=function(){a(r,o,n,t)};l(e.geometry.coordinates[0],e.geometry.coordinates[1],i,t)}else n()},error:function(t){a(r,o,n),console.error(t.responseText)},complete:function(t,e){s&&s(t)}})},n.prototype.remove=function(){},n}),r("NameResolver/NameResolver",["jquery","underscore-min","../Utils/Constants","../Renderer/FeatureStyle","../Layer/VectorLayer","../Tiling/HEALPixBase","jquery.ui","./CDSNameResolver","./DictionaryNameResolver","./IMCCENameResolver","./DefaultNameResolver"],function(t,i,r,n,s,o){function a(t,e,i){x={geometry:{coordinates:[t,e],type:r.GEOMETRY.Point,crs:{type:"name",properties:{name:i}}},type:"Feature"},b.addFeature(x)}function l(t,e){var i=parseInt(t[1],10),r=parseInt(t[2],10),n=Math.pow(2,i),s=r&n*n-1,a=o.compress_bits(s),l=o.compress_bits(s>>>1),h=r>>>2*i,u=.5,c=.5,d=o.fxyf((a+u)/n,(l+c)/n,h),f=[];g.getCrs().getWorldFrom3D(d,f),p(f[0],f[1],g.getCrs().getGeoideName(),e)}function h(t,e){var i=t.split(" ");i[0]=i[0].replace(/h|m|:/g," "),i[0]=i[0].replace("s",""),i[1]=i[1].replace(/°|'|:/g," "),i[1]=i[1].replace('"',"");var r=[];g.getCrs().getDecimalDegFromSexagesimal([i[0],i[1]],r),p(r[0],r[1],g.getCrs().getGeoideName(),e)}function u(t,e){var i=parseFloat(t[1]),r=parseFloat(t[3]),n=[i,r];p(n[0],n[1],g.getCrs().getGeoideName(),e)}function c(t,e,i,r){t=t.replace(/\s{2,}/g," ");var n=new RegExp("\\d{1,2}[h|:]\\d{1,2}[m|:]\\d{1,2}([\\.]\\d+)?s?\\s[-+]?[\\d]+[°|:]\\d{1,2}['|:]\\d{1,2}([\\.]\\d+)?\"?","g"),s=/^healpix\((\d)+,(\d+)\)/,o=/^(-?\d+(\.\d+)?),?\s(-?\d+(\.\d+)?)/,a=/^layer:(.)*?/,c=s.exec(t),f=o.exec(t);a.exec(t);if(c)l(c,e);else if(t.match(n))h(t,n,e);else if(f)u(f,e);else{var m={objectName:t,onError:i,onComplete:r,onSuccess:e,searchLayer:d,zoomTo:p};_?_.handle(m):g.publish("plugin:not_found","No name resolver found")}}function d(t,e,r,n){var s=g.searchOnLayerDescription(t,g.getActivatedContext().getMode());if(0===s.length&&(!n||0===n.totalResults))return void(r&&r());s=i.sortBy(s,function(t){return"background"===t.category?0:1});var o;n&&"FeatureCollection"===n.type?o=n:(o={},o.type="FeatureCollection",o.features=[]),i.each(s,function(t){o.features.push({type:"Feature",properties:{type:"layer",name:t.name,description:t.description,layerType:t.type,visible:t.visible,background:"background"===t.category}})}),e(o)}function p(t,e,i,n,s){if(null!==s&&"undefined"!=typeof s)for(var o=0;o<s.features.length;)s.features[o].geometry.coordinates=g.getCrs().convert(s.features[o].geometry.coordinates,i,g.getCrs().getGeoideName()),s.features[o].geometry.crs.properties.name=i,o++;var l=function(){a(t,e,i),n&&n.call(this,s)};if([t,e]=g.getCrs().convert([t,e],i,g.getCrs().getGeoideName()),g.getActivatedContext().getMode()===r.CONTEXT.Sky)g.getActivatedContext().getNavigation().zoomTo([t,e],{fov:y,duration:v,callback:l});else{var h=g.getActivatedContext().getNavigation().getDistance();g.getActivatedContext().getNavigation().zoomTo([t,e],{distance:h,duration:v,callback:l})}}function f(){x&&(b.removeFeature(x),x=null)}var g,m,v,y,b,x,_=null;return{init:function(t){m?console.error("Name resolver is already initialized"):(g=t,this.setContext(g.getActivatedContext()))},remove:function(){m&&(g.getActivatedContext().removeDraw(b),void 0!==_&&_.remove(),g.getActivatedContext().unsubscribe("modifiedNavigation",f),m=null)},goTo:c,zoomTo:p,setContext:function(t){this.remove(),m=t;var i,r;"undefined"!=typeof m.getContextConfiguration().nameResolver?(r=e(m.getContextConfiguration().nameResolver.jsObject),i=!1):(r=e("gw/NameResolver/DefaultNameResolver"),i=!0),_=new r(m);var o=new n({iconUrl:t.getMizarConfiguration().mizarBaseUrl+"css/images/target.png",fillColor:[1,1,1,1]});b=new s({style:o,visible:!0}),g.getActivatedContext().addDraw(b),v=i?3e3:m.getContextConfiguration().nameResolver.duration,y=i?15:m.getContextConfiguration().nameResolver.zoomFov,t.subscribe("modifiedNavigation",f)}}}),r("ReverseNameResolver/AbstractReverseNameResolver",[],function(){var t=function(t){this.ctx=t};return t.prototype.handle=function(){throw"handle from AbstractReverseNameResolver not implemented"},t.prototype.remove=function(){throw"remove from AbstractReverseNameResolver not implemented"},t}),r("ReverseNameResolver/CDSReverseNameResolver",["jquery","underscore-min","../Utils/Constants","../Utils/Utils","./AbstractReverseNameResolver","../Tiling/HEALPixBase"],function(t,e,i,r,n,s){var o=15,a=null,l=6e3,h=function(t){n.prototype.constructor.call(this,t)};return r.inherits(n,h),h.prototype.handle=function(e){var r=Date.now(),n=r-l;if(null!==a&&n<=a)return void(e&&e.error&&e.error({status:503}));var o=this,h=e.maxOrder,u=e.pos,c=e.mizarAPI;u=c.getCrs().convert(u,c.getCrs().getGeoideName(),i.CRS.Equatorial);var d=[];c.getCrs().getSexagesimalFromDeg(u,d),d[0]=d[0].replace("h ",":"),d[0]=d[0].replace("m ",":"),d[0]=d[0].replace("s",""),d[1]=d[1].replace("° ",":"),d[1]=d[1].replace("' ",":"),d[1]=d[1].replace('"',"");var p=1/3600,f=1800,g=Math.pow(2,h),m=s.getPixRes(g),v=m>f?f:m/2;v*=p;var y=c.getActivatedContext().getContextConfiguration().reverseNameResolver.baseUrl;y=y.replace("{coordinates}",d[0]+" "+d[1]),y=y.replace("{radius}",v),t.ajax({type:"GET",url:y,success:function(t){a=Date.now();var r=t.indexOf("("),n=t.indexOf(","),s=t.indexOf("/"),l=t.substring(0,s),h=t.substring(s+1,r),u=parseFloat(t.substring(r+1,n)),c=t.substring(n+1,t.length-2),d=l.split(" "),p=parseFloat(d[0]),f=parseFloat(d[1]),g=parseFloat(d[2]),m=parseFloat(d[3]),v=parseFloat(d[4]),y=parseFloat(d[5]),b=o._parseRa(p,f,g),x=o._parseDec(m,v,y),_={totalResults:1,type:"FeatureCollection",features:[{type:"Feature",geometry:{coordinates:[b,x],type:i.GEOMETRY.Point,crs:{type:"name",properties:{name:i.CRS.Equatorial}}},properties:{title:h,magnitude:u,credits:"CDS",seeAlso:"http://simbad.u-strasbg.fr/simbad/sim-id?Ident="+h,type:c,identifier:h}}]};e&&e.success&&e.success(_)},error:function(t,i,r){e&&e.error&&e.error(t)}})},h.prototype._parseRa=function(t,e,i){var r=parseInt(t,10),n=(i/60+e)/60;return t<0||parseFloat(t)===-0?(n=t-n,r=-r):n=r+n,n*o},h.prototype._parseDec=function(t,e,i){var r=parseInt(t,10),n=(i/60+e)/60;return t<0||parseFloat(t)===-0?(n=t-n,r=-r):n=r+n,n},h.prototype.remove=function(){},h}),r("ReverseNameResolver/DefaultReverseNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractReverseNameResolver"],function(t,e,i,r){var n=function(t){r.prototype.constructor.call(this,t)};return i.inherits(r,n),n.prototype.handle=function(e){var i=e.maxOrder,r=e.equatorialCoordinates,n=e.context,s=n.getMizarConfiguration().reverseNameResolver.baseUrl+"/EQUATORIAL/"+r[0]+" "+r[1]+";"+i;t.ajax({type:"GET",url:s,success:function(t){e&&e.success&&e.success(t)},error:function(t,i,r){e&&e.error&&e.error(t)}})},n.prototype.remove=function(t){},n}),r("ReverseNameResolver/ReverseNameResolver",["jquery","../Utils/Constants","./CDSReverseNameResolver","./DefaultReverseNameResolver"],function(t,i){var r,n,s=null;return{init:function(t){r=t,this.setContext(r.getActivatedContext())},sendRequest:function(t,e){if(r.getActivatedContext().getMode()===i.CONTEXT.Sky){var n=3;r.getActivatedContext().getTileManager().visitTiles(function(t){n<t.order&&(n=t.order)}),e.maxOrder=n,e.pos=t,e.mizarAPI=r,s?s.handle(e):r.publish("plugin:not_found","No reserve name resolver found")}else console.error("Not implemented yet"),e&&e.error&&e.error()},setContext:function(t){n=t;var i;i=e("undefined"!=typeof n.getContextConfiguration().reverseNameResolver?n.getContextConfiguration().reverseNameResolver.jsObject:["./DefaultReverseNameResolver"]),s=new i(n)}}}),r("Services/ServiceFactory",["../Utils/Constants","../Services/FitsVisu","../Services/HistogramCore","../Services/ImageProcessingCore","../Services/MeasureToolPlanetCore","../Services/MeasureToolSkyCore","../Services/MocBase","../Services/MollweideViewerCore","../Services/PickingManagerCore","../Services/SampCore","../Services/SelectionToolCore","../Services/ExportToolCore","../NameResolver/NameResolver","../ReverseNameResolver/ReverseNameResolver"],function(t,e,i,r,n,s,o,a,l,h,u,c,d,p){return{create:function(f,g){var m;switch(f){case t.SERVICE.FitsVisu:m=e;break;case t.SERVICE.Histogram:m=i;break;case t.SERVICE.ImageProcessing:m=r;break;case t.SERVICE.MeasureToolPlanet:m=n;break;case t.SERVICE.MeasureToolSky:m=s;break;case t.SERVICE.MocBase:m=o;break;case t.SERVICE.MollweideViewer:m=a;break;case t.SERVICE.PickingManager:m=l;break;case t.SERVICE.Samp:m=h;break;case t.SERVICE.SelectionTool:m=new u(g);break;case t.SERVICE.NameResolver:m=d;break;case t.SERVICE.ReverseNameResolver:m=p;break;case t.SERVICE.ExportTool:m=c;break;default:throw"Cannot retrieve service "+f}return m}}}),r("Layer/PlanetLayer",["jquery","underscore-min","./AbstractLayer","../Crs/CoordinateSystemFactory","./WMSLayer","./WCSElevationLayer","../Utils/Utils","../Services/ServiceFactory","../Utils/Constants"],function(t,e,i,r,n,s,o,a,l){var h=function(e){e.coordinateSystem=e.hasOwnProperty("coordinateSystem")?r.create(e.coordinateSystem):r.create({geoideName:l.CRS.WGS84}),i.prototype.constructor.call(this,l.LAYER.Planet,e),this.name=e.name,this.baseImageries=[],this.layers=[],this.category="Planets",this.nameResolver=e.nameResolver,this.typeLayer="Planet";for(var o=0;o<e.baseImageries.length;o++){var a=e.baseImageries[o];a=t.extend({},e,a);var h=new n(a);h.background=!0,h.category="background",h.type="WMS",this.baseImageries.push(h)}e.elevation&&(this.elevationLayer=new s(e.elevation))};return o.inherits(i,h),h.prototype._attach=function(t){i.prototype._attach.call(this,t);var r=e.findWhere(this.baseImageries,{visible:!0});r||(r=this.baseImageries[0]),this.globe.setBaseImagery(r),this.elevationLayer&&this.globe.setBaseElevation(this.elevationLayer),r.setVisible(!0);for(var n=0;n<this.layers.length;n++)this.globe.addLayer(this.layers[n])},h.prototype._detach=function(){this.globe.setBaseImagery(null);for(var t=0;t<this.layers.length;t++)this.globe.removeLayer(this.layers[t]);i.prototype._detach.call(this)},h}),r("Layer/WMSElevationLayer",["../Utils/Utils","./WMSLayer"],function(t,e){
var i=function(t){t.format="image/x-aaigrid",t.tilePixelSize=t.tilePixelSize||33,e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.parseElevations=function(t){for(var e=[],i=t.trim().split("\n"),r=5;r<i.length;r++)for(var n=i[r].trim().split(/\s+/),s=0;s<n.length;s++)e.push(parseInt(n[s],10));return e},i}),r("Layer/JsVotable/utils",[],function(){var t={};return t.inherits=function(t,e){function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},t.makeHttpObject=function(){try{return new XMLHttpRequest}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}throw new Error("The object creation for making HTTP requests has failed.")},t.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.findValueByKeyword=function(t,e){var r=void 0;for(i=0;i<t.length;i++){var n=t[i];if(n[0]===e){r=n[1];break}}return r},t.parseXML=function(t){if(document.implementation&&document.implementation.createDocument)xmlDoc=(new DOMParser).parseFromString(t,"text/xml");else{if(!window.ActiveXObject)return alert("Your browser cannot handle this script"),null;xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.loadXML(t)}return xmlDoc},t}),r("Layer/JsVotable/cache",[],function(){var t=function(){this.nodeID={},this.nodeName={},this.warnings=[]};return t.prototype.getEltsByID=function(){return this.nodeID},t.prototype.getEltsByName=function(){return this.nodeName},t.prototype.getWarnings=function(){return this.warnings},t.prototype.addEntryID=function(t,e){this.nodeID[t]=e},t.prototype.addEntryName=function(t,e){this.nodeName.hasOwnProperty(t)?this.nodeName[t].push(e):(this.nodeName[t]=[],this.nodeName[t].push(e))},t.prototype.addWarning=function(t){this.warnings.push(t)},t}),r("Layer/JsVotable/abstractNode",["./utils","./cache"],function(t,e){var i=function(t){if(this.attributes={},null!=t&&1==t.nodeType){for(var e=0,i=t.attributes.length;e<i;e++){var n=t.attributes[e];this.attributes[n.name]=n.value}if(this.attributes.hasOwnProperty("ID")){var s=r.getInstance();s.addEntryID(this.attributes.ID,this)}if(this.attributes.hasOwnProperty("name")){var s=r.getInstance();s.addEntryName(this.attributes.name,this)}}};i.prototype.getAttributes=function(){return this.attributes},i.prototype.hasAttribute=function(t){return this.attributes.hasOwnProperty(t)},i.prototype.hasAttributes=function(){return 0!=Object.keys(this.attributes).length},i.prototype.getCache=function(){return r.getInstance()};var r=function(){function t(){var t=new e;return t}var i;return{getInstance:function(){return i||(i=t()),i}}}();return i}),r("Layer/JsVotable/description",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t),this.value;var i=t.childNodes[0];null!=i&&3==i.nodeType&&(this.value=null==i.textContent?null:i.textContent.trim())};return t.inherits(e,i),i.prototype.getContent=function(){return this.value},i}),r("Layer/JsVotable/fieldref",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.ref=function(){return this.attributes.ref},i.prototype.ucd=function(){return this.attributes.ucd},i.prototype.utype=function(){return this.attributes.utype},i}),r("Layer/JsVotable/paramref",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.ref=function(){return this.attributes.ref},i.prototype.ucd=function(){return this.attributes.ucd},i.prototype.utype=function(){return this.attributes.utype},i}),r("Layer/JsVotable/min",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.value=function(){return this.attributes.value},i.prototype.inclusive=function(){return this.attributes.inclusive},i}),r("Layer/JsVotable/max",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.value=function(){return this.attributes.value},i.prototype.inclusive=function(){return this.attributes.inclusive},i}),r("Layer/JsVotable/option",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t),this.options=r(t)},r=function(t){for(var e=[],r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType){var s=n.localName;"OPTION"==s?e.push(new i(n)):this.getCache().addWarning("unknown element "+s+" in Option node")}}return e};return t.inherits(e,i),i.prototype.name=function(){return this.attributes.name},i.prototype.value=function(){return this.attributes.value},i.prototype.getOptions=function(){return this.options},i}),r("Layer/JsVotable/values",["./utils","./abstractNode","./min","./max","./option"],function(t,e,i,r,n){var s=function(t){e.prototype.constructor.call(this,t);var i=o(t);this.min=i[0],this.max=i[1],this.options=i[2]},o=function(t){for(var e,s,o=[],a=0;null!=t&&a<t.childNodes.length;a++){var l=t.childNodes[a];if(1==l.nodeType){var h=l.localName;switch(h){case"MIN":e=new i(l);break;case"MAX":s=new r(l);break;case"OPTION":o.push(new n(l));break;default:this.getCache().addWarning("unknown element "+h+" in Values node")}}}return[e,s,o]};return t.inherits(e,s),s.prototype.ID=function(){return this.attributes.ID},s.prototype.type=function(){return this.attributes.type},s.prototype.null=function(){return this.attributes.null},s.prototype.ref=function(){return this.attributes.ref},s.prototype.getMin=function(){return this.min},s.prototype.getMax=function(){return this.max},s.prototype.getOptions=function(){return this.options},s}),r("Layer/JsVotable/link",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.ID=function(){return this.attributes.ID},i.prototype.content_role=function(){return this.attributes["content-role"]},i.prototype.content_type=function(){return this.attributes["content-type"]},i.prototype.title=function(){return this.attributes.title},i.prototype.value=function(){return this.attributes.value},i.prototype.href=function(){return this.attributes.href},i.prototype.gref=function(){return this.attributes.gref},i.prototype.action=function(){return this.attributes.action},i}),r("Layer/JsVotable/field",["./utils","./abstractNode","./description","./values","./link"],function(t,e,i,r,n){var s=function(t){e.prototype.constructor.call(this,t);var i=o(t);this.description=i[0],this.values=i[1],this.links=i[2]},o=function(t){for(var e,s,o=[],a=0;null!=t&&a<t.childNodes.length;a++){var l=t.childNodes[a];if(1==l.nodeType){var h=l.localName;switch(h){case"DESCRIPTION":e=new i(l);break;case"VALUES":s=new r(l);break;case"LINK":o.push(new n(l));break;default:this.getCache().addWarning("unknown element "+h+" in Field node")}}}return[e,s,o]};return t.inherits(e,s),s.prototype.ID=function(){return this.attributes.ID},s.prototype.unit=function(){return this.attributes.unit},s.prototype.datatype=function(){return this.attributes.datatype},s.prototype.precision=function(){return this.attributes.precision},s.prototype.width=function(){return this.attributes.width},s.prototype.xtype=function(){return this.attributes.xtype},s.prototype.ref=function(){return this.attributes.ref},s.prototype.name=function(){return this.attributes.name},s.prototype.ucd=function(){return this.attributes.ucd},s.prototype.utype=function(){return this.attributes.utype},s.prototype.arraysize=function(){return this.attributes.arraysize},s.prototype.type=function(){return this.attributes.type},s.prototype.getDescription=function(){return this.description},s.prototype.getValues=function(){return this.values},s.prototype.getLinks=function(){return this.links},s}),r("Layer/JsVotable/param",["./utils","./field"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t)};return t.inherits(e,i),i.prototype.value=function(){return this.attributes.value},i}),r("Layer/JsVotable/group",["./utils","./abstractNode","./description","./fieldref","./paramref","./param"],function(t,e,i,r,n,s){var o=function(t){e.prototype.constructor.call(this,t);var i=a(t);this.description=i[0],this.fieldrefs=i[1],this.paramrefs=i[2],this.params=i[3],this.groups=i[4]},a=function(t){for(var e,a=[],l=[],h=[],u=[],c=0;null!=t&&c<t.childNodes.length;c++){var d=t.childNodes[c];if(1==d.nodeType){var p=d.localName;switch(p){case"DESCRIPTION":e=new i(d);break;case"FIELDref":a.push(new r(d));break;case"PARAMref":l.push(new n(d));break;case"PARAM":h.push(new s(d));break;case"GROUP":u.push(new o(d));break;default:this.getCache().addWarning("unknown element "+p+" in Group node")}}}return[e,a,l,h,u]};return t.inherits(e,o),o.prototype.ID=function(){return this.attributes.ID},o.prototype.name=function(){return this.attributes.name},o.prototype.ref=function(){return this.attributes.ref},o.prototype.ucd=function(){return this.attributes.ucd},o.prototype.utype=function(){return this.attributes.utype},o.prototype.getDescription=function(){return this.description},o.prototype.getFieldrefs=function(){return this.fieldrefs},o.prototype.getParamrefs=function(){return this.paramrefs},o.prototype.getParams=function(){return this.params},o.prototype.getGroups=function(){return this.groups},o}),r("Layer/JsVotable/coosys",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t),this.value=r(t)};t.inherits(e,i);var r=function(t){for(var e,i=0;null!=t&&i<t.childNodes.length;i++){var r=t.childNodes[i];null!=r&&3==r.nodeType?e=null==r.textContent?null:r.textContent.trim():this.getCache().addWarning("unknown element "+r+" in Coosys node")}return e};return i.prototype.ID=function(){return this.attributes.ID},i.prototype.equinox=function(){return this.attributes.equinox},i.prototype.epoch=function(){return this.attributes.epoch},i.prototype.system=function(){return this.attributes.system},i.prototype.getContent=function(){return this.value},i}),r("Layer/JsVotable/definitions",["./utils","./abstractNode","./group","./param","./coosys"],function(t,e,i,r,n){var s=function(t){e.prototype.constructor.call(this,t);var i=o(t);this.coosys=i[0],this.param=i[1]},o=function(t){for(var e=[],i=[],s=0;null!=t&&s<t.childNodes.length;s++){var o=t.childNodes[s];if(1==o.nodeType){var a=o.localName;switch(a){case"COOSYS":e.push(new n(o));break;case"PARAM":i.push(new r(o));break;default:this.getCache().addWarning("unknown element "+a+" in Definitions node")}"COOSYS"==a?e.push(new n(o)):"PARAM"==a?i.push(new r(o)):this.getCache().addWarning("unknown element "+a+" in Definitions node")}}return[e,i]};return t.inherits(e,s),s.prototype.getCoosyss=function(){return this.coosys},s.prototype.getParams=function(){return this.param},s}),r("Layer/JsVotable/info",["./utils","./abstractNode"],function(t,e){var i=function(t){e.prototype.constructor.call(this,t);var i=t.childNodes[0];null!=i&&3==i.nodeType&&(this.value=null==i.textContent?null:i.textContent.trim())};return i.prototype.name=function(){return this.attributes.name},i.prototype.value=function(){return this.attributes.value},i.prototype.ID=function(){return this.attributes.ID},i.prototype.unit=function(){return this.attributes.unit},i.prototype.xtype=function(){return this.attributes.xtype},i.prototype.ref=function(){return this.attributes.ref},i.prototype.ucd=function(){return this.attributes.ucd},i.prototype.utype=function(){return this.attributes.utype},i.prototype.getContent=function(){return this.value},i}),r("Layer/JsVotable/td",["./utils","./abstractNode"],function(t,e){var i=function(t,i){e.prototype.constructor.call(this,t),null==i?this.value=null==t.textContent?"":t.textContent.trim():this.value=null==i?"":i.trim()};return t.inherits(e,i),i.prototype.encoding=function(){return this.attributes.encoding},i.prototype.getContent=function(){return this.value},i}),r("Layer/JsVotable/tr",["./utils","./abstractNode","./td"],function(t,e,i){var r=function(t,r){if(e.prototype.constructor.call(this,t),null==r)this.tds=n(t);else{this.tds=[];for(var s=0;s<r.length;s++)this.tds.push(new i(null,r[s]))}},n=function(t){for(var e=[],r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType){var s=n.localName;"TD"==s?e.push(new i(n)):this.getCache().addWarning("unknown element "+s+" in Tr node")}}return e};return t.inherits(e,r),r.prototype.ID=function(){return this.attributes.ID},r.prototype.getTds=function(){return this.tds},r}),r("Layer/JsVotable/abstractData",["./utils","./abstractNode"],function(t,e){var i=function(t,i){e.prototype.constructor.call(this,t),this.name=i};return t.inherits(e,i),i.prototype.getName=function(){return this.name},i}),r("Layer/JsVotable/tabledata",["./utils","./tr","./abstractData"],function(t,e,i){var r=function(t,r){if(i.prototype.constructor.call(this,t,"TableData"),null==r)this.trs=n(t);else{this.trs=[];for(var s=0;s<r.length;s++)this.trs.push(new e(null,r[s]))}},n=function(t){for(var i=[],r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType){var s=n.localName;"TR"==s?i.push(new e(n)):this.getCache().addWarning("unknown element "+s+" in TableData node")}}return i};return t.inherits(i,r),r.prototype.getTrs=function(){return this.trs},r}),r("Layer/JsVotable/converter/base64",[],function(){function t(t){"use strict";var e,i,r;return e=new ArrayBuffer(2),i=new DataView(e),r=t.join(""),i.setUint16(0,parseInt(r,2)),i.getInt16(0)}function e(t){"use strict";var e,i,r;return e=new ArrayBuffer(4),i=new DataView(e),r=t.join(""),i.setUint32(0,parseInt(r,2)),i.getInt32(0)}function i(t){"use strict";var e,i,r;return e=new ArrayBuffer(4),i=new DataView(e),r=t.join(""),i.setUint32(0,parseInt(r,2)),i.getFloat32(0)}function r(t){"use strict";var e,i,r;return e=new ArrayBuffer(8),i=new DataView(e),r=t.slice(0,32).join(""),i.setUint32(0,parseInt(r,2)),r="",r=t.slice(32,64).join(""),i.setUint32(4,parseInt(r,2)),i.getFloat64(0)}function n(t){"use strict";var e,i,r;return e=new ArrayBuffer(1),i=new DataView(e),r=t.join(""),i.setUint8(0,parseInt(r,2)),i.getUint8(0)}function s(t){"use strict";var e,i,r,s,o;for(e=t.length/8,i=[],o="",s=0,r=0;r<e;r+=1)i=t.slice(s,s+8),o=o.concat(String.fromCharCode(n(i))),i=[],s+=8;return o}function o(t){"use strict";var e,i,r;return e=new ArrayBuffer(4),i=new DataView(e),r=t.join(""),i.setUint32(0,parseInt(r,2)),i.getUint32(0)}function a(t){var e;return t>64&&t<91?e=t-65:t>96&&t<123?e=t-71:t>47&&t<58?e=t+4:43===t?e=62:47===t&&(e=63),e}var l={short:16,int:32,float:32,double:64,unsignedByte:8},h=function(t){this.ptrStream=0,this.bufferTabBits=[],this.fields=t};return h.prototype.computeDataSize=function(t,e,i){var r=0;if("char"===t)if(/\*/.test(this.fields[e].arraysize())){var n=this.streamB64(32,i);r=8*o(n),n=[]}else r=8*this.fields[e].arraysize();else r=l[t];return r},h.prototype.streamB64=function(t,e){for(var i=[],r=this.bufferTabBits.length,n=Math.ceil((t-r)/6),s=0;s<r;s+=1)i.push(this.bufferTabBits[s]);this.bufferTabBits=[];for(var s=0;s<n;s+=1){if(10==e.charCodeAt(this.ptrStream))s-=1;else for(var o=a(e.charCodeAt(this.ptrStream)),l=32;l>0;l>>=1)i.length!==t?i.push((o&l)===l?"1":"0"):this.bufferTabBits.push((o&l)===l?"1":"0");this.ptrStream+=1}return i},h.prototype.decodeValue=function(o,a,l,h){var u,c=[];switch("NULL"!=o&&(c=this.streamB64(a,h)),o){case"short":u=t(c);break;case"int":u=e(c);break;case"float":u=i(c),u=u.toFixed(this.fields[l].precision());break;case"double":u=r(c),u=u.toFixed(this.fields[l].precision());break;case"unsignedByte":u=n(c);break;case"char":u=s(c);break;case"NULL":u="NULL"}return"NaN"!==u&&"NULL"!==u&&0!==u||(u=""),u},h.prototype.decode=function(t){var e=[],i=0,r=t.length,n=this.fields.length,s=[];do{var o=this.fields[i].datatype(),a=this.computeDataSize(o,i,t);0==a&&(o="NULL");var l=this.decodeValue(o,a,i,t);s.push(l),i===n-1?(i=0,e.push(s),s=[]):i+=1}while(this.ptrStream<r);return e},h}),r("Layer/JsVotable/stream",["./utils","./abstractNode","./converter/base64","./tabledata"],function(t,e,i,r){var n=function(t){e.prototype.constructor.call(this,t),this.value=t.textContent};return t.inherits(e,n),n.prototype.type=function(){return this.attributes.type},n.prototype.href=function(){return this.attributes.href},n.prototype.actuate=function(){return this.attributes.actuate},n.prototype.encoding=function(){return this.attributes.encoding},n.prototype.expires=function(){return this.attributes.expires},n.prototype.rights=function(){return this.attributes.rights},n.prototype.getContent=function(t,e){var n;if(null==t||0==t)n=this.value;else{var s=new i(e);n=new r(null,s.decode(this.value))}return n},n}),r("Layer/JsVotable/binary",["./utils","./stream","./abstractData"],function(t,e,i){var r=function(t){i.prototype.constructor.call(this,t,"Binary"),this.stream=n(t)},n=function(t){for(var i,r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType){var s=n.localName;if("STREAM"!=s)throw"Unknown element";i=new e(n)}}return i};return t.inherits(i,r),r.prototype.getStream=function(){return this.stream},r}),r("Layer/JsVotable/binary2",["./utils","./stream","./abstractData"],function(t,e,i){var r=function(t){i.prototype.constructor.call(this,t,"Binary2"),this.stream=n(t)},n=function(t){for(var e,i=0;null!=t&&i<t.childNodes.length;i++){var r=t.childNodes[i];if(1==r.nodeType){var n=r.localName;"STREAM"==n?e=new Definitions(r):this.getCache().addWarning("unknown element "+n+" in Binary2 node")}}return e};return t.inherits(i,r),r.prototype.getStream=function(){return this.stream},r}),r("Layer/JsVotable/fits",["./utils","./abstractData","./stream"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,t,"Fits"),this.stream=n(t)},n=function(t){for(var e,i=0;null!=t&&i<t.childNodes.length;i++){var r=t.childNodes[i];if(1==r.nodeType){var n=r.localName;"STREAM"==n?e=new Definitions(r):this.getCache().addWarning("unknown element "+n+" in Fits node")}}return e};return t.inherits(e,r),r.prototype.getStream=function(){return this.stream},r.prototype.extnum=function(){return this.attributes.extnum},r}),r("Layer/JsVotable/data",["./utils","./abstractNode","./tabledata","./binary","./binary2","./fits","./info"],function(t,e,i,r,n,s,o){var a=function(t){e.prototype.constructor.call(this,t);var i=l(t);this.data=i[0],this.infos=i[1]},l=function(t){for(var e,a=[],l=0;null!=t&&l<t.childNodes.length;l++){var h=t.childNodes[l];if(1==h.nodeType){var u=h.localName;switch(u){case"TABLEDATA":e=new i(h);break;case"BINARY":e=new r(h);break;case"BINARY2":e=new n(h);break;case"FITS":e=new s(h);break;case"INFO":a.push(new o(h));break;default:this.getCache().addWarning("unknown element "+u+" in Data node")}}}return[e,a]};return t.inherits(e,a),a.prototype.getData=function(){return this.data},a.prototype.getDataImplementationName=function(){return this.data.getName()},a.prototype.getInfos=function(){return this.infos},a}),r("Layer/JsVotable/table",["./utils","./abstractNode","./description","./field","./param","./group","./link","./data","./info"],function(t,e,i,r,n,s,o,a,l){var h=function(t){e.prototype.constructor.call(this,t);var i=u(t);this.fields=i[0],this.params=i[1],this.groups=i[2],this.links=i[3],this.data=i[4],this.description=i[5],this.infos=i[6]},u=function(t){for(var e,h,u=[],c=[],d=[],p=[],f=[],g=0;null!=t&&g<t.childNodes.length;g++){var m=t.childNodes[g];if(1==m.nodeType){var v=m.localName;switch(v){case"DESCRIPTION":h=new i(m);break;case"FIELD":u.push(new r(m));break;case"PARAM":c.push(new n(m));break;case"GROUP":d.push(new s(m));break;case"LINK":p.push(new o(m));break;case"DATA":e=new a(m);break;case"INFO":f.push(new l(m));break;default:this.getCache().addWarning("unknown element "+v+" in Table node")}}}return[u,c,d,p,e,h,f]};return t.inherits(e,h),h.prototype.ID=function(){return this.attributes.ID},h.prototype.name=function(){return this.attributes.name},h.prototype.ref=function(){return this.attributes.ref},h.prototype.ucd=function(){return this.attributes.ucd},h.prototype.utype=function(){return this.attributes.utype},h.prototype.nrows=function(){return this.attributes.nrows},h.prototype.getFields=function(){return this.fields},h.prototype.getParams=function(){return this.params},h.prototype.getGroups=function(){return this.groups},h.prototype.getLinks=function(){return this.links},h.prototype.getData=function(){return this.data},h.prototype.getInfos=function(){return this.infos},h.prototype.getDescription=function(){return this.description},h}),r("Layer/JsVotable/resource",["./utils","./abstractNode","./description","./info","./table","./link","./coosys","./param","./group"],function(t,e,i,r,n,s,o,a,l){var h=function(t){e.prototype.constructor.call(this,t);var i=u(t);this.description=i[0],this.infos=i[1],this.coosyss=i[2],this.params=i[3],this.groups=i[4],this.abstractSequences=i[5]},u=function(t){for(var e,u=[],c=[],d=[],p=[],f=[],g=0,m=0;null!=t&&m<t.childNodes.length;m++){var v=t.childNodes[m];if(1==v.nodeType){var y=v.localName;switch(y){case"DESCRIPTION":e=new i(v);break;case"INFO":u.push(new r(v));break;case"COOSYS":c.push(new o);break;case"GROUP":d.push(new l);break;case"PARAM":p.push(new a);break;default:g=m}}if(0!=g)break}for(var b={},x=[],_=[],m=g;null!=t&&m<t.childNodes.length;m++){var v=t.childNodes[m];if(1==v.nodeType){var y=v.localName;switch(y){case"LINK":b.hasOwnProperty("TABLE")||b.hasOwnProperty("RESOURCE")?(b.LINKS=x,b.INFOS=_,f.push(b),b={},x=[],_=[]):x.push(new s(v));break;case"TABLE":b.TABLE=new n(v);break;case"RESOURCE":b.RESOURCE=new h(v);break;case"INFO":_.push(new r(v));break;default:this.getCache().addWarning("Unkknown element "+y+" in RESOURCE node")}}}return 0!=Object.keys(b).length&&f.push(b),[e,u,c,p,d,f]};return t.inherits(e,h),h.prototype.ID=function(){return this.attributes.ID},h.prototype.name=function(){return this.attributes.name},h.prototype.utype=function(){return this.attributes.utype},h.prototype.type=function(){return this.attributes.type},h.prototype.getDescription=function(){return this.description},h.prototype.getInfos=function(){return this.infos},h.prototype.getCoosyss=function(){return this.coosyss},h.prototype.getGroups=function(){return this.groups},h.prototype.getParams=function(){return this.params},h.prototype.getResourcesOrTables=function(){return this.abstractSequences},h}),r("Layer/JsVotable/converter/geojson",["../utils"],function(t){function e(t){function e(t){var e,i=t.getDefinitions();return null!=i&&(e=i.getCoosyss()[0]),null!=t.getCoosyss()[0]&&(e=t.getCoosyss()[0]),e}var r={type:"FeatureCollection",features:[]},n=e(t);null!=n&&(r.crs={type:"name",properties:{name:n}});for(var s=[],o=t.getResources(),a=0;a<o.length;a++)i(o[a],s);return r.features=s,r}function i(t,e){for(var n=t.getResourcesOrTables(),s=0;s<n.length;s++){var o=n[s];o.hasOwnProperty("RESOURCE")?i(o.RESOURCE,e):o.hasOwnProperty("TABLE")&&r(o.TABLE,e)}}function r(t,e){var i,r=t.getFields(),s=t.getData(),o=t.getInfos();switch(s.getDataImplementationName()){case"TableData":var a=s.getData();i=a.getTrs();break;case"Binary":var l=s.getData(),a=l.getStream().getContent(!0,r);i=a.getTrs();break;case"Binary2":s.getData();throw new Error("Binary2 not implemented");break;case"Fits":s.getData();throw new Error("Fits not implemented");break;default:throw new Error("Type of data not implemented")}n(r,o,i,e)}function n(t,e,i,r){for(var n=0;n<i.length;n++){var o=i[n].getTds();r.push(s(t,e,o))}}function s(e,i,r){function n(t){if(!(t.hasOwnProperty("RA")&&t.hasOwnProperty("DEC")&&t.hasOwnProperty("COOSYS")&&t.hasOwnProperty("ID")))throw new Error("core metadata missing "+JSON.stringify(t))}function s(t,e){var i;switch(e){case"short":case"int":case"long":i=Number.parseInt(t);break;case"float":case"double":i=Number.parseFloat(t);break;default:i=t}return i}function h(t,e){var i=t.filter(function(t){return t===e});return 0!=i.length}for(var u={type:"Feature",geometry:null,properties:{}},c={},d=0;d<r.length;d++){var p=r[d],f=e[d],g=f.getValues(),m=null!=g?g.null():null,v=f.ucd(),y=f.datatype(),b=p.getContent(),x=f.name();if(h(a,v))c.RA=Number.parseFloat(b),c.COOSYS=f.ref();else if(h(l,v))c.DEC=Number.parseFloat(b);else if(h(o,v))c.ID=b;else{var _=u.properties;b!=m&&(_[x]=s(b,y))}}c.hasOwnProperty("ID")||(c.ID=t.guid());for(var d=0;d<i.length;d++){var w=i[d];_[w.name()]=w.value()}n(c);var C={type:"Point",coordinates:[c.RA,c.DEC],crs:{type:"name",properties:{name:c.COOSYS}}};return u.geometry=C,u}var o=["meta.record","meta.id;meta.main","VOX:Image_Titleq"],a=["pos.eq.ra;meta.main","POS_EQ_RA_MAIN"],l=["pos.eq.dec;meta.main","POS_EQ_DEC_MAIN"],h=function(t){this.votable=t,this.featureCollection=e(this.votable)};return h.prototype.getGeoJSon=function(t){var e=t|!1;return JSON.stringify(this.featureCollection,null,e)},h}),r("Layer/JsVotable/votable",["./utils","./abstractNode","./definitions","./info","./resource","./description","./coosys","./group","./param","./converter/geojson"],function(t,e,i,r,n,s,o,a,l,h){function u(t){if(null==t)throw new Error("xml cannot be null");if("string"==typeof t){var e=new DOMParser;t=e.parseFromString(t,"application/xml")}else if(null==t.documentElement)throw new Error("This object is not supported");var i=t.documentElement.localName;if("VOTABLE"!=i)throw new Error("This input is not a VOTable");return t}var c=function(t){t=u(t);var i=t.documentElement;e.prototype.constructor.call(this,i);var r=d(i);this.definitions=r[0],this.infos=r[1],this.resources=r[2],this.description=r[3],this.coosyss=r[4],this.groups=r[5],this.params=r[6]},d=function(t){for(var e,h,u=t,c=[],d=[],p=[],f=[],g=[],m=0;m<u.childNodes.length;m++){var v=u.childNodes[m];if(1==v.nodeType){var y=v.localName;switch(y){case"DEFINITIONS":e=new i(v);break;case"INFO":c.push(new r(v));break;case"RESOURCE":d.push(new n(v));break;case"DESCRIPTION":h=new s(v);break;case"COOSYS":p.push(new o(v));break;case"GROUP":f.push(new a(v));break;case"PARAM":g.push(new l(v));break;default:this.getCache().addWarning("unknown element "+y+" in Votable node")}}}return[e,c,d,h,p,f,g]};return t.inherits(e,c),c.prototype.ID=function(){return this.attributes.ID},c.prototype.version=function(){return this.attributes.version},c.prototype.getInfos=function(){return this.infos},c.prototype.getDefinitions=function(){return this.definitions},c.prototype.getResources=function(){return this.resources},c.prototype.getCoosyss=function(){return this.coosyss},c.prototype.getGroups=function(){return this.groups},c.prototype.getParams=function(){return this.params},c.prototype.getDescription=function(){return this.description},c.prototype.getVotableEltByID=function(t){return this.getCache().getEltsByID()[t]},c.prototype.getVotableEltsByName=function(t){return this.getCache().getEltsByName()[t]},c.prototype.convertToGeoJSon=function(t){var e=new h(this);return e.getGeoJSon(t)},c}),r("Layer/JsVotable/JsVotable",["./votable","./binary","./binary2","./coosys","./data","./definitions","./description","./field","./fieldref","./fits","./group","./info","./link","./max","./min","./option","./param","./paramref","./resource","./stream","./table","./tabledata","./td","./tr","./values"],function(t,e,i,r,n,s,o,a,l,h,u,c,d,p,f,g,m,v,y,b,x,_,w,C,T){var A={};return A.Votable=t,A.Binary=e,A.Binary2=i,A.Coosys=r,A.Data=n,A.Definitions=s,A.Description=o,A.Field=a,A.Fieldref=l,A.Fits=h,A.Group=u,A.Info=c,A.Link=d,A.Max=p,A.Min=f,A.Option=g,A.Param=m,A.Paramref=v,A.Resource=y,A.Stream=b,A.Table=x,A.TableData=_,A.Td=w,A.Tr=C,A.Values=T,A.version={major:1,minor:1,patch:0,date:"2016-10-12",toString:function(){return this.major+"."+this.minor+"."+this.patch}},window.JsVotable=A,A}),r("Layer/JsCSV/csv",[],function(){function t(t){if(null==t)throw new Error("csv cannot be null");if("string"!=typeof t)throw new Error("This object is not supported");return t}function e(t,e,n){for(var s=t.split("\n"),o=0,a=0;a<s.length&&i(s[a],e,n.name);a++)o++;return r(s,o,e,n)}function i(t,e,i){return t.startsWith(o)||0==t.length||i.toString()==t.split(e).toString()}function r(t,e,i,r){for(var s=[],o=e;o<t.length;o++)0!==t[o].length&&s.push(n(t[o],i,r));return s}function n(t,e,i){for(var r={},n=t.split(e),o=0;o<n.length;o++)r[i.name[o]]=s(n[o],i.datatype[o]);return r}function s(t,e){var i;switch(e){case"short":case"int":case"long":i=Number.parseInt(t);break;case"float":case"double":i=Number.parseFloat(t);break;default:i=t}return i}var o="#",a=function(i,r,n){i=t(i),this.store=e(i,r,n)};return a.prototype.getStore=function(){return this.store},a.prototype.getGeoJSon=function(t,e){for(var i=t.RA,r=t.DEC,n=t.ID,s=[],o=0;o<this.store.length;o++){var a={type:"Feature",id:this.store[o][n],geometry:{type:"Point",coordinates:[this.store[o][i],this.store[o][r]],crs:{type:"name",properties:{name:e}}}},l=JSON.parse(JSON.stringify(this.store[o]));delete l[i],delete l[r],delete l[n],a.properties=l,s.push(a)}var h={type:"FeatureCollection",features:s};return h},a}),r("Layer/HipsCatLayer",["../Renderer/FeatureStyle","../Renderer/VectorRendererManager","../Utils/Utils","./AbstractLayer","../Renderer/RendererTileData","../Tiling/Tile","./JsVotable/JsVotable","./JsVotable/utils","./JsCSV/csv","../Utils/Constants"],function(t,e,i,r,n,s,o,a,l,h){function u(t,e){return t.tile.distance-e.tile.distance}var c=function(t){r.prototype.constructor.call(this,h.LAYER.HipsCat,t);var e,i=new d(t.serviceUrl+"/properties"),n=i.getProperties(),s=n.hips_order;this.serviceUrl=t.serviceUrl,this.minOrder=t.minOrder||2,this.maxOrder=Number.parseInt(s,10),this.maxRequests=t.maxRequests||4,this.invertY=t.invertY||!1;var l=a.makeHttpObject();l.open("GET",t.serviceUrl+"/metadata.xml",!1),l.send();var u=new o.Votable(l.responseXML),c=u.getResources()[0],p=c.getResourcesOrTables()[0].TABLE;for(this.fields=p.getFields(),this.raColNumber=null,this.decColNumber=null,this.sourceId=null,e=0;e<this.fields.length;e++){var f=this.fields[e].ucd();"pos.eq.ra"===f?this.raColNumber=this.fields[e].name():"pos.eq.dec"===f?this.decColNumber=this.fields[e].name():"meta.id;meta.main"===f&&(this.sourceId=this.fields[e].name())}for(this.extId="hipsCat",this.features=[],this.featuresSet={},this.freeRequests=[],this.tilesToLoad=[],e=0;e<this.maxRequests;e++)l=new XMLHttpRequest,this.freeRequests.push(l)};i.inherits(r,c);var d=function(t){this.properties={};var e,i=new XMLHttpRequest;i.open("GET",t,!1),i.send();var r=i.responseText;r.trim();var n=r.split("\n");for(e=0;null!==n&&e<n.length;e++){var s=n[e];if(null===s||!(s.indexOf("#")>-1)&&s.trim()){var o=s.split("="),a=o[0].replace(/^\s+|\s+$/g,""),l=o[1].replace(/^\s+|\s+$/g,"");this.properties[a]=l}}};d.prototype.getProperties=function(){return this.properties},c.prototype._attach=function(t){r.prototype._attach.call(this,t),this.extId+=this.id,t.tileManager.addPostRenderer(this)},c.prototype._detach=function(){this.globe.tileManager.removePostRenderer(this),r.prototype._detach.call(this)},c.prototype.launchRequest=function(t,e){var i=t.extension[this.extId];if(0!==this.freeRequests.length){i.state=c.TileState.LOADING,this.maxRequests===this.freeRequests.length&&this.globe.publishEvent("startLoad",this);var r=this.freeRequests.pop(),n=this;r.onreadystatechange=function(e){if(4===r.readyState){if(200===r.status){var s={},o={name:[],datatype:[]};n.fields.forEach(function(t){o.name.push(t.name()),o.datatype.push(t.datatype())});var a=new l(r.response,"\t",o),h=a.getGeoJSon({RA:n.raColNumber,DEC:n.decColNumber,ID:n.sourceId},"Equatorial"),u=h.features;s.features=u,s.totalResults=u.length,i.complete=s.totalResults===s.features.length;var d;for(d=s.features.length-1;d>=0;d--){var p=s.features[d],f=n.featuresSet.hasOwnProperty(p.id);f&&s.features.splice(d,1),p.properties.style=this.style,n.addFeature(p,t)}n.globe.refresh(),s.hasOwnProperty(u)&&s.features.length>0&&n.globe.publishEvent("features:added",{layer:n,features:s.features})}else r.status>=400&&(i.complete=!0,console.error(r.responseText));i.state=c.TileState.LOADED,n.freeRequests.push(r),n.maxRequests===n.freeRequests.length&&n.globe.publishEvent("endLoad",n);
}},r.open("GET",e),r.send()}},c.prototype.addFeature=function(t,e){var i,r=e.extension[this.extId];this.featuresSet.hasOwnProperty(t.id)?(i=this.featuresSet[t.id],i.tiles.push(e),t=this.features[i.index]):(this.features.push(t),i={index:this.features.length-1,tiles:[e]},this.featuresSet[t.id]=i),r.featureIds.push(t.id),t.geometry.gid=t.id;var n=t.properties.style?t.properties.style:this.style;this.globe.vectorRendererManager.addGeometryToTile(this,t.geometry,n,e)},c.prototype.removeFeature=function(t,e){var i=this.featuresSet[t];if(i){var r=i.tiles.indexOf(e);if(r>=0?i.tiles.splice(r,1):console.log("HipsCatLayer internal error : tile not found when removing feature"),0===i.tiles.length){delete this.featuresSet[t];var n=this.features.pop();i.index<this.features.length&&(this.features[i.index]=n,this.featuresSet[n.id].index=i.index)}}},c.prototype.modifyFeatureStyle=function(t,e){t.properties.style=e;var i=this.featuresSet[t.id];if(i){var r;for(r=0;r<i.tiles.length;r++){var n=i.tiles[r];this.globe.vectorRendererManager.removeGeometryFromTile(t.geometry,n),this.globe.vectorRendererManager.addGeometryToTile(this,t.geometry,e,n)}}},c.TileState={LOADING:0,LOADED:1,NOT_LOADED:2,INHERIT_PARENT:3},c.prototype.generate=function(t){this.minOrder<=t.order&&t.order<=this.maxOrder&&(t.extension[this.extId]=new p(this,t,null))};var p=function(t,e,i){this.layer=t,this.parent=i,this.tile=e,this.featureIds=[],this.state=c.TileState.NOT_LOADED,this.complete=!1,this.childrenCreated=!1};return p.prototype.traverse=function(t){var e;if(this.layer.visible&&t.state===s.State.LOADED&&(this.state===c.TileState.NOT_LOADED&&this.layer.tilesToLoad.push(this),this.state===c.TileState.LOADED&&!this.complete&&t.state===s.State.LOADED&&t.children&&!this.childrenCreated)){for(e=0;e<4;e++)t.children[e].extension[this.layer.extId]||(t.children[e].extension[this.layer.extId]=new p(this.layer,t.children[e],this));this.childrenCreated=!0;var i=t.extension.renderer?t.extension.renderer.renderables:[];for(e=0;e<i.length;e++)i[e].bucket.layer===this.layer&&(i[e].hasChildren=!0)}},p.prototype.dispose=function(t,e){var i;if(this.parent&&this.parent.childrenCreated){this.parent.childrenCreated=!1;var r=this.parent.tile.extension.renderer?this.parent.tile.extension.renderer.renderables:[];for(i=0;i<r.length;i++)r[i].bucket.layer===this.layer&&(r[i].hasChildren=!1)}for(i=0;i<this.featureIds.length;i++)this.layer.removeFeature(this.featureIds[i],this.tile);this.tile=null,this.parent=null},c.prototype.buildUrl=function(t){var e;if(t.order<=0)e=this.serviceUrl+"/Norder"+t.order+"/Allsky.xml";else{e=this.serviceUrl,e+="/Norder",e+=t.order,e+="/Dir";var i=1e4*Math.floor(t.pixelIndex/1e4);e+=i,e+="/Npix",e+=t.pixelIndex,e+=".tsv"}return e},c.prototype.getUrl=function(t){return this.buildUrl(t)},c.prototype.render=function(t){var e;if(this.visible){for(this.tilesToLoad.sort(u),e=0;e<this.tilesToLoad.length&&this.freeRequests.length>0;e++){var i=this.tilesToLoad[e].tile,r=this.buildUrl(i);r&&this.launchRequest(i,r)}this.tilesToLoad.length=0}},c}),r("Layer/GeoJsonLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants"],function(t,e,i){function r(t){var e=t.geometry;if(!e||!e.type)throw"Invalid GeoJson"}function n(t,e){return t.geometry.crs||(t.geometry.crs=e?e:{type:"name",properties:{name:i.CRS.WGS84}}),t}function s(t){return t.geometry.gid="GeoJSON_"+this.gid,this.gid++,t}var o=function(t){e.prototype.constructor.call(this,i.LAYER.GeoJSON,t),this.url=t.url,this.gid=0,t&&t.callback?this.callback=t.callback:this.callback=null,this.minLevel=t&&t.hasOwnProperty("minLevel")?t.minLevel:0,this.maxLevel=t&&t.hasOwnProperty("maxLevel")?t.maxLevel:15,this.features=[]};return t.inherits(e,o),o.prototype._attach=function(t){e.prototype._attach.call(this,t);for(var i=0;i<this.features.length;i++)this._addFeatureToRenderers(this.features[i])},o.prototype._detach=function(){for(var t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);this.features=[],e.prototype._detach.call(this)},o.prototype.addFeatureCollection=function(t){if(null===t||void 0===t)throw"Error, featureCollection is null";var e={type:"name",properties:{name:i.CRS.WGS84}},r=t.crs?t.crs:e,n=t.features;if(n)for(var s=0;s<n.length;s++)this.addFeature(n[s],r)},o.prototype.removeFeatureCollection=function(t){var e=t.features;if(e)for(var i=0;i<e.length;i++)this.removeFeature(e[i]);this.features=[]},o.prototype._addFeatureToRenderers=function(t){var e=t.geometry,i=this.style,r=t.properties;if(r&&r.style&&(i=r.style),"GeometryCollection"===e.type)for(var n=e.geometries,s=0;s<n.length;s++)this.globe.vectorRendererManager.addGeometry(this,n[s],i);else this.globe.vectorRendererManager.addGeometry(this,e,i)},o.prototype._removeFeatureFromRenderers=function(t){var e=t.geometry;if("GeometryCollection"===e.type){var i=e.geometries,r=!1;if(this.globe&&this.globe.vectorRendererManager)for(var n=0;n<i.length;n++)r=this.globe.vectorRendererManager.removeGeometry(i[n],this);return r}if(this.globe&&this.globe.vectorRendererManager)return this.globe.vectorRendererManager.removeGeometry(e,this)},o.prototype._setDataType=function(t){this.datatype||(t.geometry.type.startsWith(i.GEOMETRY.Point)?this.dataType=i.GEOMETRY.Point:this.dataType=i.GEOMETRY.LineString)},o.prototype.addFeature=function(t,e){r.call(this,t),t=n.call(this,t,e),t=s.call(this,t),this._setDataType(t),this.features.push(t),this.globe&&(this._addFeatureToRenderers(t),this.isVisible()&&this.globe.renderContext.requestFrame())},o.prototype.removeFeature=function(t){var e=this.features.indexOf(t);this.features.splice(e,1),this.globe&&(this._removeFeatureFromRenderers(t),this.isVisible()&&this.globe.renderContext.requestFrame())},o.prototype.removeAllFeatures=function(){if(this.globe)for(var t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);this.features.length=0,this.globe&&this.isVisible()&&this.globe.renderContext.requestFrame()},o.prototype.modifyFeatureStyle=function(t,e){this._removeFeatureFromRenderers(t)&&(t.properties.style=e,this._addFeatureToRenderers(t))},o.prototype.modifyStyle=function(t){var e;for(e=0;e<this.features.length;e++)this._removeFeatureFromRenderers(this.features[e]);for(this.style=t,e=0;e<this.features.length;e++)this._addFeatureToRenderers(this.features[e])},o.prototype.getStyle=function(){return this.style},o.prototype.setStyle=function(t){this.style=t},o}),r("Layer/LayerFactory",["jquery","../Utils/Constants","./WMSLayer","./WMTSLayer","./WCSElevationLayer","./VectorLayer","./AtmosphereLayer","./BingLayer","./GroundOverlayLayer","./OSMLayer","./TileWireframeLayer","./CoordinateGridLayer","./HipsFitsLayer","./HipsGraphicLayer","./MocLayer","./OpenSearchLayer","./PlanetLayer","./WMSElevationLayer","./HipsMetadata","./HipsCatLayer","./GeoJsonLayer"],function(t,e,i,r,n,s,o,a,l,h,u,c,d,p,f,g,m,v,y,b,x){function _(e,i){var r,n="undefined"==typeof e?new y(i.baseUrl):e,s=n.getHipsMetadata(),o=i.hasOwnProperty("hips_tile_format")?i.hips_tile_format:s.hips_tile_format,a=i.hasOwnProperty("dataproduct_type")?i.dataproduct_type:s.dataproduct_type;switch(a){case n.DataProductType.catalog:break;case n.DataProductType.cube:break;case n.DataProductType.image:var l=t.inArray(n.HipsTileFormat.png,o)!==-1;t.inArray(n.HipsTileFormat.jpeg,o)!==-1,t.inArray(n.HipsTileFormat.fits,o)!==-1;i.format=l?n.HipsTileFormat.png:"jpg",r=w(s,i);break;case n.DataProductType.meta:break;default:throw"Hips : Unknown dataproduct type"}return r}function w(t,e){return new p(t,e)}function C(t){t.style.fill=!0,t.style.fillColor[3]=.3;var e=new f(t);return e.dataType="line",e}function T(t){var e=new g(t);return t.displayProperties&&(e.displayProperties=t.displayProperties),e.pickable=!t.hasOwnProperty("pickable")||t.pickable,e.availableServices=t.availableServices,e}return{create:function(t){var d;switch(t.type){case e.LAYER.WMS:d=new i(t);break;case e.LAYER.WMTS:d=new r(t);break;case e.LAYER.WMSElevation:d=new v(t);break;case e.LAYER.WCSElevation:d=new n(t);break;case e.LAYER.GeoJSON:d=new x(t),d.pickable=!t.hasOwnProperty("pickable")||t.pickable;break;case e.LAYER.Vector:d=new s(t),d.pickable=!t.hasOwnProperty("pickable")||t.pickable,d.deletable=!!t.hasOwnProperty("deletable")&&t.deletable;break;case e.LAYER.Atmosphere:d=new o(t);break;case e.LAYER.Bing:d=new a(t);break;case e.LAYER.GroundOverlay:d=new l(t);break;case e.LAYER.OSM:d=new h(t);break;case e.LAYER.HipsGrid:case e.LAYER.TileWireframe:d=new u(t);break;case e.LAYER.HipsCat:t.background=!1,d=new b(t);break;case e.LAYER.CoordinateGrid:d=new c(t);break;case e.LAYER.Hips:d=_(t.hipsMetadata,t);break;case e.LAYER.Moc:d=C(t);break;case e.LAYER.OpenSearch:d=T(t);break;case e.LAYER.Planet:d=new m(t);break;default:throw"Unable to create the layer "+t.type}return d}}}),r("Gui/Tracker/AbstractTracker",[],function(){var t=function(t){this.options=t};return t.prototype.update=function(t){throw"update from AbstractTracker not implemented"},t.prototype.compute=function(t){throw"compute from AbstractTracker not implemented"},t.prototype.attachTo=function(t){throw"attachTo from AbstractTracker not implemented"},t.prototype.detach=function(){throw"detach from AbstractTracker not implemented"},t}),r("Gui/Tracker/PositionTracker",["jquery","./AbstractTracker","../../Utils/Utils"],function(t,e,i){var r,n,s,o=function(i){e.prototype.constructor.call(this,i),s=this,n=i.element,i.position&&t("#"+n).css(i.position,"2px")};return i.inherits(e,o),o.prototype.attachTo=function(t){r=t,r.renderContext.canvas.addEventListener("mousemove",s.update),this.options.isMobile&&r.renderContext.canvas.addEventListener("touchmove",s.update)},o.prototype.detach=function(){r.renderContext.canvas.removeEventListener("mousemove",s.update),this.options.isMobile&&r.renderContext.canvas.removeEventListener("touchmove",s.update)},o.prototype.update=function(t){if(t.type.search("touch")>=0&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),document.getElementById(n)){var e=r.getLonLatFromPixel(t.clientX,t.clientY);if(e){var i=s.compute([e[0],e[1]]);document.getElementById(n).innerHTML=i[0]+" x "+i[1]}else document.getElementById(n).innerHTML=""}},o.prototype.compute=function(t){return r.getCoordinateSystem().formatCoordinates([t[0],t[1]])},o}),r("Gui/Tracker/ElevationTracker",["jquery","./AbstractTracker","../../Utils/Utils","../../Utils/Numeric"],function(t,e,i,r){var n,s,o,a,l=function(i){e.prototype.constructor.call(this,i),a=this,s=i.element,i.position&&t("#"+s).css(i.position,"2px"),null!==i.elevationLayer&&void 0!==i.elevationLayer&&(o=i.elevationLayer.hasOwnProperty("scale")?i.elevationLayer.scale:1)};return i.inherits(e,l),l.prototype.setScaleLayer=function(t){o=t.hasOwnProperty("scale")?t.scale:1},l.prototype.attachTo=function(t){n=t,n.renderContext.canvas.addEventListener("mousemove",a.update),this.options.isMobile&&n.renderContext.canvas.addEventListener("touchmove",a.update)},l.prototype.detach=function(){n.renderContext.canvas.removeEventListener("mousemove",a.update),this.options.isMobile&&n.renderContext.canvas.removeEventListener("touchmove",a.update)},l.prototype.update=function(t){if(t.type.search("touch")>=0&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),document.getElementById(s)){var e=n.getLonLatFromPixel(t.clientX,t.clientY);if(e&&o){var i=a.compute([e[0],e[1]]);document.getElementById(s).innerHTML="Elevation : "+r.roundNumber(i/o,0)+" meters"}else document.getElementById(s).innerHTML=""}},l.prototype.compute=function(t){return n.getElevation(t[0],t[1])},l}),r("Utils/AttributionHandler",[],function(){var t=function(t,e){var i=e?e.element:void 0;i&&("string"==typeof i?this.element=document.getElementById(i):this.element=i),this.element&&(t.attributionHandler=this)};return t.prototype.removeAttribution=function(t){var e=document.getElementById(this.element.id+"_"+t.id);e&&this.element.removeChild(e)},t.prototype.addAttribution=function(t){var e,i=document.createElement("div"),r=void 0!==t.ack?t.ack:"";e=""!==t.copyrightUrl&&void 0!==t.copyrightUrl?'<a class="whiteLink" href="'+t.copyrightUrl+'" target="_blank" title="'+r+'">'+t.attribution+"</a>":t.attribution,i.innerHTML=e,i.id=this.element.id+"_"+t.id,0===t.id?this.element.insertBefore(i,this.element.firstChild):this.element.appendChild(i)},t.prototype.toggleAttribution=function(t){var e=document.getElementById(this.element.id+"_"+t.id);e?this.removeAttribution(t):this.addAttribution(t)},t}),r("Renderer/VectorRenderer",["./RendererTileData","../Tiling/Tile"],function(t,e){var i=function(t){this.tileManager=t.tileManager,this.globe=t,this.buckets=[],this.maxTilePerGeometry=100,this.levelZeroTiledGeometries=[]};return i.prototype.findBucket=function(t,e){for(var i=0;i<this.buckets.length;i++){var r=this.buckets[i];if(r.layer===t&&r.isCompatible(e))return r}return null},i.prototype.generateLevelZero=function(t){for(var e=0;e<this.levelZeroTiledGeometries.length;e++){for(var i=this.levelZeroTiledGeometries[e],r=!1,n=0;n<i._tileIndices.length&&!r;n++){var s=this.tileManager.level0Tiles[i._tileIndices[n]];r=s===t}r&&this._addGeometryToTile(i._bucket,i,t)}},i.prototype._recursiveAddGeometryToTile=function(t,i,r){var n=this._addGeometryToTile(t,i,r);if(n&&n.generateChild&&r.children)for(var s=0;s<4;s++)r.children[s].state===e.State.LOADED&&(n.hasChildren=!0,this._recursiveAddGeometryToTile(t,i,r.children[s]))},i.prototype.addGeometry=function(t,i,r){var n=this.getOrCreateBucket(t,i,r);i._bucket=n;var s=this.maxTilePerGeometry>0?this.tileManager.tiling.getOverlappedLevelZeroTiles(i):null;if(s&&s.length<this.maxTilePerGeometry){for(var o=0;o<s.length;o++){var a=this.tileManager.level0Tiles[s[o]];a&&a.state===e.State.LOADED&&this._recursiveAddGeometryToTile(n,i,a)}i._tileIndices=s,this.levelZeroTiledGeometries.push(i)}else n.mainRenderable||(n.mainRenderable=n.createRenderable()),n.mainRenderable.add(i)},i.prototype.removeGeometry=function(t){var e=t._tileIndices;if(e){for(var i=0;i<e.length;i++){var r=this.tileManager.level0Tiles[e[i]];this.removeGeometryFromTile(t,r)}this.levelZeroTiledGeometries.splice(this.levelZeroTiledGeometries.indexOf(t),1),t._tileIndices=null}else{var n=t._bucket;if(n.mainRenderable){var s=n.mainRenderable.remove(t);0===s&&(n.mainRenderable.dispose(this.renderContext),n.mainRenderable=null)}}},i.prototype.getOrCreateBucket=function(t,e,i){var r=this.findBucket(t,i);return r||(r=this.createBucket(t,i),r.renderer=this,r.id=this.globe.vectorRendererManager.bucketId++,this.buckets.push(r)),r},i.prototype.addGeometryToTile=function(t,e,i,r){var n=this.getOrCreateBucket(t,e,i);return e._bucket=n,this._addGeometryToTile(n,e,r)},i.prototype._addGeometryToTile=function(e,i,r){var n=r.extension.renderer;n||(n=r.extension.renderer=new t(this.globe.vectorRendererManager));var s=n.getRenderable(e),o=!1;return s||(s=e.createRenderable(),o=!0),s.add(i,r)?(o&&n.renderables.push(s),s):null},i.prototype.removeGeometryFromTile=function(t,i){var r=null;if(i&&i.extension&&(r=i.extension.renderer),r)for(var n=0;n<r.renderables.length;){var s=r.renderables[n],o=s.bucket.renderer;if(o===this){var a=s.remove(t);if(0===a?r.renderables.splice(n,1):n++,s.hasChildren&&i.children)for(var l=0;l<4;l++)i.children[l].state===e.State.LOADED&&this.removeGeometryFromTile(t,i.children[l])}else n++}},i}),r("Renderer/PointRenderer",["../Utils/Utils","../Utils/Constants","./VectorRenderer","./VectorRendererManager","./FeatureStyle","./Program","./GeoBound"],function(t,e,i,r,n,s,o){var a=function(){var t=18,e=1,i=null,r=function(){i=document.createElement("canvas"),i.width=512,i.height=t+2*e},s=function(s,o){i||r();var a=o;a?a instanceof Array&&(a=n.fromColorToString(o)):a="#fff";var l=i.getContext("2d");l.clearRect(0,0,i.width,i.height),l.fillStyle=a,l.font=t+"px sans-serif",l.textBaseline="top",l.shadowColor="#000",l.shadowOffsetX=1,l.shadowOffsetY=1,l.shadowBlur=2,l.fillText(s,e,e);var h=l.measureText(s);return l.getImageData(0,0,Math.floor(h.width)+2*e,i.height)};return{generateImageData:s}}(),l=function(t){i.prototype.constructor.call(this,t),this.renderContext=t.tileManager.renderContext,this.tileConfig=t.tileManager.tileConfig,this.numberOfRenderPoints=0;var e="attribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \n";e+="uniform mat4 viewProjectionMatrix; \n",e+="uniform vec3 poiPosition; // world position \n",e+="uniform vec2 poiScale; // x,y scale \n",e+="uniform vec2 tst; \n",e+="\n",e+="varying vec2 texCoord; \n",e+="\n",e+="void main(void)  \n",e+="{ \n",e+="\t// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n",e+="\ttexCoord = vertex.xy + vec2(0.5) + tst; \n",e+="\t// Invert y \n",e+="\ttexCoord.y = 1.0 - texCoord.y; \n",e+="\t\n",e+="\t// Compute poi position in clip coordinate \n",e+="\tgl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n",e+="\tgl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n",e+="} \n";var r="precision lowp float; \n";r+="varying vec2 texCoord; \n",r+="uniform sampler2D texture; \n",r+="uniform float alpha; \n",r+="uniform vec3 color; \n",r+="\n",r+="void main(void) \n",r+="{ \n",r+="\tvec4 textureColor = texture2D(texture, texCoord); \n",r+="\tgl_FragColor = vec4(textureColor.rgb * color, textureColor.a * alpha); \n",r+="\tif (gl_FragColor.a <= 0.0) discard; \n",r+="} \n",this.program=new s(this.renderContext),this.program.createFromSource(e,r);var n=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),o=this.renderContext.gl;this.vertexBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer),o.bufferData(o.ARRAY_BUFFER,n,o.STATIC_DRAW),this.defaultTexture=null};t.inherits(i,l),l.prototype._buildDefaultTexture=function(t){if(!this.defaultTexture){var e=this.renderContext.gl;this.defaultTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.defaultTexture);var i=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i)}t.texture=this.defaultTexture,t.textureWidth=10,t.textureHeight=10},l.prototype._buildTextureFromImage=function(t,e){t.texture=this.renderContext.createNonPowerOfTwoTextureFromImage(e),t.textureWidth=e.width,t.textureHeight=e.height};var h=function(t){this.bucket=t,this.points=[]};h.prototype.add=function(t){var e=this.bucket.layer.globe.getCoordinateSystem(),i=t.coordinates;i=e.convert(i,t.crs.properties.name,e.getGeoideName());var r=new o(e.getGeoBound().getWest(),e.getGeoBound().getSouth(),e.getGeoBound().getEast(),e.getGeoBound().getNorth());if(r.isPointInside(i)){var n=e.get3DFromWorld(i),s=e.getVerticalAt3D(n);return this.points.push({pos3d:n,vertical:s,geometry:t}),!0}return!1},h.prototype.remove=function(t){for(var e=0;e<this.points.length;e++)if(this.points[e].geometry===t)return this.points.splice(e,1),this.points.length;return this.points.length},h.prototype.dispose=function(t){};var u=function(t,e){this.layer=t,this.style=new n(e),this.renderer=null,this.texture=null};return u.prototype.createRenderable=function(){return new h(this)},u.prototype.isCompatible=function(t){return this.style.iconUrl===t.iconUrl&&this.style.icon===t.icon&&this.style.label===t.label},l.prototype.createBucket=function(t,e){var i=new u(t,e);if(e.label){var r=a.generateImageData(e.label,e.textColor);this._buildTextureFromImage(i,r)}else if(e.iconUrl){var n=new Image;n.crossOrigin="";var s=this;n.onload=function(){s._buildTextureFromImage(i,n),s.renderContext.requestFrame()},n.onerror=function(){s._buildDefaultTexture(i)},n.src=e.iconUrl}else e.icon?this._buildTextureFromImage(i,e.icon):this._buildDefaultTexture(i);return i},l.prototype.render=function(t,e,i){this.numberOfRenderPoints=0;var r=this.renderContext,n=this.renderContext.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.program.apply(),mat4.multiply(r.projectionMatrix,r.viewMatrix,r.modelViewMatrix),n.uniformMatrix4fv(this.program.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix),n.uniform1i(this.program.uniforms.texture,0),mat4.inverse(r.viewMatrix,r.modelViewMatrix);var s=[r.modelViewMatrix[8],r.modelViewMatrix[9],r.modelViewMatrix[10]];vec3.normalize(s),vec3.scale(s,this.tileConfig.cullSign,s);var o=r.computePixelSizeVector();n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(this.program.attributes.vertex,3,n.FLOAT,!1,0,0);for(var a,l=null,h=e;h<i;h++){var u=t[h],c=u.bucket;if(0!==u.points.length){c!==l&&(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,c.texture),a=[2*c.textureWidth/r.canvas.width,2*c.textureHeight/r.canvas.height],n.uniform2fv(this.program.uniforms.poiScale,a),n.uniform2fv(this.program.uniforms.tst,[.5/c.textureWidth,.5/c.textureHeight]));for(var d=0;d<u.points.length;d++){var p=u.points[d].pos3d,f=u.points[d].vertical;a=c.textureHeight*(o[0]*p[0]+o[1]*p[1]+o[2]*p[2]+o[3]),a*=this.tileConfig.cullSign;var g=a/this.globe.getCoordinateSystem().getGeoide().getHeightScale()*.001;if(!(g>c.style.pointMaxSize)&&vec3.dot(f,s)>0&&r.worldFrustum.containsSphere(p,a)>=0){var m=f[0]*a+p[0],v=f[1]*a+p[1],y=f[2]*a+p[2];n.uniform3f(this.program.uniforms.poiPosition,m,v,y),n.uniform1f(this.program.uniforms.alpha,c.layer.opacity);var b=c.style.fillColor;n.uniform3f(this.program.uniforms.color,b[0],b[1],b[2]),n.drawArrays(n.TRIANGLE_FAN,0,4),this.numberOfRenderPoints++}}}}n.disable(n.BLEND)},l.prototype.canApply=function(t,i){return t===e.GEOMETRY.Point&&null===i.iconUrl},r.factory.push(function(t){return new l(t)}),l}),r("Renderer/BatchRenderable",[],function(){var t=function(t){this.bucket=t,this.vertexBuffer=null,this.indexBuffer=null,this.vertices=[],this.triIndices=[],this.lineIndices=[],this.geometryInfos=[],this.bufferDirty=!0,this.vertexSize=3,this.indexType=0,this.vertexBufferShared=!1};return t.prototype.remove=function(t){for(var e,i=-1,r=0,n=0,s=0,o=0;o<this.geometryInfos.length;o++){var a=this.geometryInfos[o];if(a.geometry===t){this.vertices.splice(r,a.vertexCount),this.lineIndices.splice(n,a.lineIndexCount),this.triIndices.splice(s,a.triIndexCount);var l=a.vertexCount/this.vertexSize;for(e=n;e<this.lineIndices.length;e++)this.lineIndices[e]-=l;for(e=s;e<this.triIndices.length;e++)this.triIndices[e]-=l;i=o;break}r+=a.vertexCount,n+=a.lineIndexCount,s+=a.triIndexCount}return i>=0?(this.bufferDirty=!0,this.geometryInfos.splice(i,1),this.vertices.length):this.vertices.length},t.prototype.add=function(t,e){this.tile=e;var i=this.vertices.length,r=this.lineIndices.length,n=this.triIndices.length,s=this.build(t,e);return!!s&&(this.geometryInfos.push({geometry:t,vertexCount:this.vertices.length-i,lineIndexCount:this.lineIndices.length-r,triIndexCount:this.triIndices.length-n}),this.bufferDirty=!0,!0)},t.prototype.dispose=function(t){var e=t.gl;this.indexBuffer&&e.deleteBuffer(this.indexBuffer),this.indexBuffer=null,this.vertexBuffer&&!this.vertexBufferShared&&(e.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null)},t.prototype.bindBuffers=function(t){var e=t.gl;if(this.bufferDirty){this.dispose(t),this.vertexBuffer?e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer):(this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertices),e.STATIC_DRAW)),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=this.triIndices;i=this.triIndices.length>0?this.lineIndices.length>0?this.triIndices.concat(this.lineIndices):this.triIndices:this.lineIndices;var r=this.vertices.length/this.vertexSize;r>65535?(e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(i),e.STATIC_DRAW),this.indexType=e.UNSIGNED_INT):(e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),e.STATIC_DRAW),this.indexType=e.UNSIGNED_SHORT),this.bufferDirty=!1}else e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)},t}),r("Tiling/TiledVectorRenderable",["../Utils/Utils","../Renderer/BatchRenderable","../Utils/Constants"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,t),this.tile=null,this.hasChildren=!0};return t.inherits(e,r),r.prototype.initChild=function(t,e){var i=new r(this.bucket);return i.tile=this.tile,i.vertexBufferShared=!0,i.vertexBuffer=this.vertexBuffer,i.vertices=this.vertices,i.buildChildrenIndices(this,2*e+t),i},r.prototype.generateChild=function(t){for(var e=0;e<this.geometryInfos.length;e++)this.bucket.renderer._addGeometryToTile(this.bucket,this.geometryInfos[e].geometry,t)},r.prototype.buildChildrenIndices=function(t,e){var i,r,n,s,o,a,l,h,u,c,d,p;for(i=0;i<t.triIndices.length;i+=3)r=3*t.triIndices[i],n=3*t.triIndices[i+1],s=3*t.triIndices[i+2],o=t.vertices[r],a=t.vertices[n],l=t.vertices[s],h=0,(o>0||0===o&&a>0||0===o&&0===a&&l>0)&&(h=1),u=t.vertices[r+1],c=t.vertices[n+1],d=t.vertices[s+1],p=1,(u>0||0===u&&c>0||0===u&&0===c&&d>0)&&(p=0),e===2*p+h&&this.triIndices.push(t.triIndices[i],t.triIndices[i+1],t.triIndices[i+2]);for(i=0;i<t.lineIndices.length/2;i++)r=3*t.lineIndices[2*i],n=3*t.lineIndices[2*i+1],o=t.vertices[r],a=t.vertices[n],h=0,(o>0||0===o&&a>0)&&(h=1),u=t.vertices[r+1],c=t.vertices[n+1],p=1,(u>0||0===u&&c>0)&&(p=0),e===2*p+h&&this.lineIndices.push(t.lineIndices[2*i],t.lineIndices[2*i+1])},r.prototype.build=function(t,e){this.tile=e;var r,n,s=this.bucket.layer.minLevel<=e.level&&this.bucket.layer.maxLevel>e.level;if(s){var o=t.coordinates;switch(t.type){case i.GEOMETRY.LineString:this.buildVerticesAndIndices(e,o);break;case i.GEOMETRY.Polygon:for(r=0;r<o.length;r++)this.buildVerticesAndIndices(e,o[r]);break;case i.GEOMETRY.MultiLineString:for(r=0;r<o.length;r++)this.buildVerticesAndIndices(e,o[r]);break;case i.GEOMETRY.MultiPolygon:for(n=0;n<o.length;n++)for(r=0;r<o[n].length;r++)this.buildVerticesAndIndices(e,o[n][r])}}return e.geoBound.intersectsGeometry(t)},r}),r("Tiling/TiledVectorRenderer",["../Utils/Utils","../Renderer/VectorRenderer","../Renderer/Program"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this,t);var r="attribute vec3 vertex; \n";r+="uniform float zOffset; \n",r+="uniform mat4 modelViewMatrix;\n",r+="uniform mat4 projectionMatrix;\n",r+="\n",r+="void main(void)  \n",r+="{ \n",r+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex.x, vertex.y, vertex.z + zOffset, 1.0); \n",r+="} \n";var n="#ifdef GL_ES \n";n+="precision highp float; \n",n+="#endif \n",n+="uniform vec4 color; \n",n+="\n",n+="void main(void) \n",n+="{ \n",n+="\tgl_FragColor = color; \n",n+="} \n",this.program=new i(this.tileManager.renderContext),this.program.createFromSource(r,n)};return t.inherits(e,r),r.prototype.render=function(t,e,i){var r=this.tileManager.renderContext,n=r.gl,s=mat4.create();this.program.apply(),n.depthFunc(n.LEQUAL),n.depthMask(!1),n.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,r.projectionMatrix);for(var o=null,a=e;a<i;a++){var l=t[a],h=l.tile;if(mat4.multiply(r.viewMatrix,h.matrix,s),n.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,s),n.uniform1f(this.program.uniforms.zOffset,7e-4*h.radius),o=l.bucket.style,l.bindBuffers(r),n.vertexAttribPointer(this.program.attributes.vertex,3,n.FLOAT,!1,0,0),l.triIndices.length>0&&(n.uniform4f(this.program.uniforms.color,o.fillColor[0],o.fillColor[1],o.fillColor[2],o.fillColor[3]*l.bucket.layer.opacity),n.drawElements(n.TRIANGLES,l.triIndices.length,l.indexType,0)),l.lineIndices.length>0){n.lineWidth(o.strokeWidth),n.uniform4f(this.program.uniforms.color,o.strokeColor[0],o.strokeColor[1],o.strokeColor[2],o.strokeColor[3]*l.bucket.layer.opacity);var u=l.indexType===n.UNSIGNED_INT?4:2;n.drawElements(n.LINES,l.lineIndices.length,l.indexType,l.triIndices.length*u)}}n.depthMask(!0),n.depthFunc(n.LESS)},r}),r("Renderer/LineStringRenderable",["../Utils/Constants","../Utils/Utils","./FeatureStyle","./VectorRendererManager","../Tiling/TiledVectorRenderable","../Tiling/TiledVectorRenderer","../Utils/Numeric"],function(t,e,i,r,n,s,o){var a=function(t){n.prototype.constructor.call(this,t)};e.inherits(n,a),a.prototype._fixDateLine=function(t,e){for(var i=[],r=[i],n=0;n<e.length-1;n++){i.push(e[n]);var s=e[n][0],o=e[n][1],a=e[n+1][0],l=e[n+1][1];if(Math.abs(a-s)>180){s<0&&(s+=360),a<0&&(a+=360);var h=(180-s)/(a-s);if(h>0&&h<1){var u=o+h*(l-o),c=e[n][0]>0?180:-180;i.push([c,u]),i=[[-c,u]],r.push(i)}}}return i.push(e[e.length-1]),r},a.prototype.buildVerticesAndIndices=function(t,e){if(0!==e.length)for(var i=this._fixDateLine(t,e),r=0;r<i.length;r++)this._buildVerticesAndIndices(t,i[r])},a.prototype._buildVerticesAndIndices=function(t,e){var i=t.config.tesselation,r=t.config.vertexSize;e.push(e[e.length-1]);for(var n=t.lonlat2tile(e),s=0;s<e.length-1;s++){var a,l,h,u,c,d,p,f,g=n[s][0],m=n[s][1],v=n[s+1][0],y=n[s+1][1],b=[],x=Math.max(-1,Math.min(g,v)),_=Math.min(i-1,Math.max(g,v));for(a=Math.floor(x)+1;a<Math.floor(_)+1;a++)if(u=a,h=o.lineIntersection(g,m,v,y,u,0,u,i-1),h[0]>0&&h[0]<1&&h[1]>=0&&h[1]<=1){l=h[1]*(i-1);var w=Math.floor(l),C=l-w;c=r*(w*i+a),d=(1-C)*t.vertices[c]+C*t.vertices[c+r*i],p=(1-C)*t.vertices[c+1]+C*t.vertices[c+r*i+1],f=(1-C)*t.vertices[c+2]+C*t.vertices[c+r*i+2],b.push([h[0],d,p,f])}var T=Math.max(-1,Math.min(m,y)),A=Math.min(i-1,Math.max(m,y));for(a=Math.floor(T)+1;a<Math.floor(A)+1;a++)if(l=a,h=o.lineIntersection(g,m,v,y,0,l,i-1,l),h[0]>0&&h[0]<1&&h[1]>=0&&h[1]<=1){u=h[1]*(i-1);var I=Math.floor(u),S=u-I;c=r*(a*i+I),d=(1-S)*t.vertices[c]+S*t.vertices[c+r],p=(1-S)*t.vertices[c+1]+S*t.vertices[c+r+1],f=(1-S)*t.vertices[c+2]+S*t.vertices[c+r+2],b.push([h[0],d,p,f])}b.sort(function(t,e){return t[0]>e[0]});var M,k=this.vertices.length/3;for(g>=0&&g<=i-1&&m>=0&&m<=i-1&&(M=t.computePosition(g,m),this.vertices.push(M[0]),this.vertices.push(M[1]),this.vertices.push(M[2])),a=0;a<b.length;a++)this.vertices.push(b[a][1]),this.vertices.push(b[a][2]),this.vertices.push(b[a][3]);v>=0&&v<=i-1&&y>=0&&y<=i-1&&(M=t.computePosition(v,y),this.vertices.push(M[0]),this.vertices.push(M[1]),this.vertices.push(M[2]));var E=this.vertices.length/3;for(a=k;a<E-1;a++)this.lineIndices.push(a),this.lineIndices.push(a+1)}};var l=function(t){s.prototype.constructor.call(this,t)};e.inherits(s,l),l.prototype.canApply=function(e,i){return!this.globe.isSky()&&!(e!==t.GEOMETRY.LineString&&e!==t.GEOMETRY.MultiLineString&&(i.fill||e!==t.GEOMETRY.Polygon&&e!==t.GEOMETRY.MultiPolygon)||i.gradientLength)};var h=function(t,e){this.layer=t,this.style=new i(e),this.renderer=null};return h.prototype.createRenderable=function(){return new a(this)},h.prototype.isCompatible=function(t){return this.style.strokeColor[0]===t.strokeColor[0]&&this.style.strokeColor[1]===t.strokeColor[1]&&this.style.strokeColor[2]===t.strokeColor[2]&&this.style.strokeColor[3]===t.strokeColor[3]&&this.style.strokeWidth===t.strokeWidth},l.prototype.createBucket=function(t,e){return new h(t,e)},r.factory.push(function(t){return new l(t)}),a}),r("Renderer/pnltri",[],function(){var t={REVISION:"2.1.1"};return t.Math={random:Math.random,array_shuffle:function(e){for(var i=e.length-1;i>0;i--){var r=Math.floor(t.Math.random()*(i+1)),n=e[i];e[i]=e[r],e[r]=n}return e},compare_pts_yx:function(e,i){var r=e.y-i.y;if(r<t.Math.EPSILON_N)return-1;if(r>t.Math.EPSILON_P)return 1;var n=e.x-i.x;return n<t.Math.EPSILON_N?-1:n>t.Math.EPSILON_P?1:0},ptsCrossProd:function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)}},t.Math.EPSILON_P=Math.pow(2,-43),t.Math.EPSILON_N=-t.Math.EPSILON_P,t.PolygonData=function(t){if(this.vertices=[],this.segments=[],this.diagonals=[],this.idNextPolyChain=0,this.PolyLeftArr=[],this.monoSubPolyChains=[],this.triangles=[],t)for(var e=0,i=t.length;e<i;e++)this.addPolygonChain(t[e])},t.PolygonData.prototype={constructor:t.PolygonData,nbVertices:function(){return this.vertices.length},getSegments:function(){return this.segments},getFirstSegment:function(){return this.segments[0]},getMonoSubPolys:function(){return this.monoSubPolyChains},getTriangles:function(){return this.triangles.concat()},nbPolyChains:function(){return this.idNextPolyChain},get_PolyLeftArr:function(){return this.PolyLeftArr.concat()},set_PolyLeft_wrong:function(t){this.PolyLeftArr[t]=!1;
},isClockWise:function(t){var e=t,i=0;do i+=(e.vFrom.x-e.vTo.x)*(e.vFrom.y+e.vTo.y),e=e.snext;while(e!=t);return i<0},appendVertexEntry:function(t,e){var i={id:this.vertices.length,x:t,y:e};return this.vertices.push(i),i},createSegmentEntry:function(e,i){return{chainId:this.idNextPolyChain,vFrom:e,vTo:i,upward:1==t.Math.compare_pts_yx(i,e),sprev:null,snext:null,rootFrom:null,rootTo:null,is_inserted:!1,trLeft:null,trRight:null,mprev:null,mnext:null,marked:!1}},appendSegmentEntry:function(t){return this.segments.push(t),t},appendDiagonalsEntry:function(t){return this.diagonals.push(t),t},addVertexChain:function(e){function i(e,i){return Math.abs(e.x-i.x)<t.Math.EPSILON_P&&Math.abs(e.y-i.y)<t.Math.EPSILON_P}function r(e,i,r){if(Math.abs(t.Math.ptsCrossProd(i,e,r))>t.Math.EPSILON_P)return!1;var n,s,o;return Math.abs(e.y-i.y)<t.Math.EPSILON_P?(s=i.x,e.x<r.x?(n=e.x,o=r.x):(n=r.x,o=e.x)):(s=i.y,e.y<r.y?(n=e.y,o=r.y):(n=r.y,o=e.y)),n-s<t.Math.EPSILON_P&&s-o<t.Math.EPSILON_P}for(var n,s,o,a=[],l=0;l<e.length;l++)n=this.appendVertexEntry(e[l].x,e[l].y),s=!0,o=a.length-1,o>=0&&(i(n,a[o])?s=!1:o>0&&r(a[o-1],a[o],n)&&a.pop()),s&&a.push(n);return o=a.length-1,o>0&&i(a[o],a[0])&&(a.pop(),o--),o>1&&(r(a[o-1],a[o],a[0])&&(a.pop(),o--),o>1&&r(a[o],a[0],a[1])&&a.shift()),a},addPolygonChain:function(t){var e=this.addVertexChain(t);if(e.length<3)return console.log("Polygon has < 3 vertices!",e),0;for(var i,r,n,s=this.segments.length,o=0;o<e.length-1;o++)i=this.createSegmentEntry(e[o],e[o+1]),n?(i.sprev=n,n.snext=i):r=i,n=i,this.appendSegmentEntry(i);return i=this.createSegmentEntry(e[e.length-1],e[0]),i.sprev=n,n.snext=i,this.appendSegmentEntry(i),r.sprev=i,i.snext=r,this.PolyLeftArr[this.idNextPolyChain++]=!0,this.segments.length-s},create_mono_chains:function(){for(var t,e,i,r,n=0,s=this.segments.length;n<s;n++)t=this.segments[n],this.PolyLeftArr[t.chainId]?(e=t.vTo,t.mprev=t.sprev,t.mnext=t.snext):(e=t.vFrom,t=t.snext,t.mprev=t.snext,t.mnext=t.sprev),(r=t.vFrom.lastInDiag)&&(r.mnext=t,t.mprev=r,t.vFrom.lastInDiag=null),(i=e.firstOutDiag)&&(i.mprev=t,t.mnext=i,e.firstOutDiag=null)},unique_monotone_chains_max:function(){function e(e){var i,r,n,s=e;for(r=n=e.vFrom,e.marked=!0,e=e.mnext;i=e.vFrom;){if(e.marked){if(i==r)break;return console.log("ERR unique_monotone: segment in two chains",r,e),null}e.marked=!0,1==t.Math.compare_pts_yx(i,n)&&(n=i,s=e),e=e.mnext}return s}var i,r;this.monoSubPolyChains=[];for(var n=0,s=this.segments.length;n<s;n++)i=this.segments[n],i.marked||(r=e(i),r&&this.monoSubPolyChains.push(r));return this.monoSubPolyChains},clearTriangles:function(){this.triangles=[]},addTriangle:function(t,e,i){this.triangles.push([t.id,e.id,i.id])}},t.EarClipTriangulator=function(t){this.polyData=t},t.EarClipTriangulator.prototype={constructor:t.EarClipTriangulator,triangulate_polygon_no_holes:function(){function e(e){var i=e.mprev.vFrom.x,r=e.mprev.vFrom.y,n=e.vFrom.x,s=e.vFrom.y,o=e.mnext.vFrom.x,a=e.mnext.vFrom.y,l=o-n,h=a-s,u=i-o,c=r-a,d=n-i,p=s-r;if(t.Math.EPSILON_P>d*h-l*p)return!1;for(var f=e.mprev.mprev,g=e.mnext;g!=f;){g=g.mnext;var m=g.vFrom.x,v=g.vFrom.y,y=m-i,b=v-r;if(0!==y||0!==b){var x=m-n,_=v-s;if(0!==x||0!==_){var w=m-o,C=v-a;if((0!==w||0!==C)&&l*_-h*x>=t.Math.EPSILON_N&&d*b-p*y>=t.Math.EPSILON_N&&u*C-c*w>=t.Math.EPSILON_N)return!1}}}return!0}var i=this.polyData,r=i.getFirstSegment(),n=r;if(i.isClockWise(r)){do n.mprev=n.snext,n.mnext=n.sprev,n=n.sprev;while(n!=r);i.set_PolyLeft_wrong(0)}else do n.mprev=n.sprev,n.mnext=n.snext,n=n.snext;while(n!=r);for(var s=r,o=s;s.mnext!=s.mprev;)if(e(s))this.polyData.addTriangle(s.mprev.vFrom,s.vFrom,s.mnext.vFrom),s.mprev.mnext=s.mnext,s.mnext.mprev=s.mprev,s=s.mnext,o=s;else if(s=s.mnext,s==o)return!1;return!0}},t.Trapezoid=function(t,e,i,r){this.vHigh=t?t:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},this.vLow=e?e:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},this.lseg=i,this.rseg=r,this.depth=-1,this.monoDone=!1},t.Trapezoid.prototype={constructor:t.Trapezoid,clone:function(){var e=new t.Trapezoid(this.vHigh,this.vLow,this.lseg,this.rseg);return e.uL=this.uL,e.uR=this.uR,e.dL=this.dL,e.dR=this.dR,e.sink=this.sink,e},splitOffLower:function(t){var e=this.clone();return this.vLow=e.vHigh=t,this.dL=e,e.uL=this,this.dR=e.uR=null,e.dL&&(e.dL.uL=e),e.dR&&(e.dR.uR=e),e}},t.QsNode=function(t){this.trap=t,t.sink=this},t.QsNode.prototype={constructor:t.QsNode},t.QueryStructure=function(e){var i=new t.Trapezoid(null,null,null,null);if(this.trapArray=[],this.appendTrapEntry(i),this.root=new t.QsNode(i),e)for(var r=e.getSegments(),n=0;n<r.length;n++)r[n].rootFrom=r[n].rootTo=this.root,r[n].is_inserted=!1},t.QueryStructure.prototype={constructor:t.QueryStructure,getRoot:function(){return this.root},appendTrapEntry:function(t){t.trapID=this.trapArray.length,this.trapArray.push(t)},cloneTrap:function(t){var e=t.clone();return this.appendTrapEntry(e),e},splitNodeAtPoint:function(e,i,r){var n=e.trap;if(n.vHigh==i)return e;if(n.vLow==i)return e;var s=n.splitOffLower(i);return this.appendTrapEntry(s),e.yval=i,e.trap=null,e.right=new t.QsNode(n),e.left=new t.QsNode(s),r?n.sink:s.sink},fpEqual:function(e,i){return Math.abs(e-i)<t.Math.EPSILON_P},is_left_of:function(e,i,r){var n,s=e.vFrom.x-i.x,o=e.vTo.x-i.x,a=this.fpEqual(e.vFrom.y,i.y);if(this.fpEqual(e.vTo.y,i.y)){if(a)return 0;n=o}else{if(!a)return e.upward?t.Math.ptsCrossProd(e.vFrom,e.vTo,i):t.Math.ptsCrossProd(e.vTo,e.vFrom,i);n=s}return Math.abs(n)<t.Math.EPSILON_P?0:n},segNodes:function(t){this.ptNode(t,!0),this.ptNode(t,!1)},ptNode:function(e,i){var r,n,s;i?(r=e.vFrom,n=e.vTo,s=e.rootFrom):(r=e.vTo,n=e.vFrom,s=e.rootTo);for(var o,a;s;)if(s.yval)s=t.Math.compare_pts_yx(r==s.yval?n:r,s.yval)==-1?s.left:s.right;else{if(!s.seg)return s.trap||console.log("ptNode: unknown type",s),i?e.rootFrom=s:e.rootTo=s,s;if(r==s.seg.vFrom||r==s.seg.vTo){if(this.fpEqual(r.y,n.y)){this.fpEqual(s.seg.vFrom.y,s.seg.vTo.y)?r==s.seg.vFrom?(a=e.upward?n.x>=s.seg.vTo.x:n.x<s.seg.vTo.x,s=(a?e.sprev.upward:s.seg.snext.upward)?s.right:s.left):(a=e.upward?n.x<s.seg.vFrom.x:n.x>=s.seg.vFrom.x,s=(a?e.snext.upward:s.seg.sprev.upward)?s.left:s.right):s=n.x<r.x?s.left:s.right;continue}o=this.is_left_of(s.seg,n,!1),0===o&&(r==s.seg.vFrom?(a=e.upward?n.y>=s.seg.vTo.y:n.y<s.seg.vTo.y,o=a?this.is_left_of(s.seg,e.sprev.vFrom,!1):-this.is_left_of(s.seg,s.seg.snext.vTo,!1)):(a=e.upward?n.y<s.seg.vFrom.y:n.y>=s.seg.vFrom.y,o=a?this.is_left_of(s.seg,e.snext.vTo,!1):-this.is_left_of(s.seg,s.seg.sprev.vFrom,!1)))}else if(o=this.is_left_of(s.seg,r,!0),0===o&&(o=this.is_left_of(s.seg,n,!1),0===o)){var l=i?e.sprev.vFrom:e.snext.vTo;o=this.is_left_of(s.seg,l,!1)}if(o>0)s=s.left;else{if(!(o<0))return s;s=s.right}}},add_segment:function(e){function i(){var t=_.uL||_.uR;t.dL&&t.dR?_==t.dL?(m.uL=null,t.dL=g):(g.uR=null,t.dR=m):(m.uL=null,m.uR=t,t.dR=m)}function r(){_.usave?(_.uleft?(m.uL=_.uR,m.uR=_.usave,m.uL.dL=m,m.uR.dR=m):(g.uR=_.uL,g.uL=_.usave,g.uL.dL=g,g.uR.dR=g),g.usave=m.usave=null):_.vHigh==f.vHigh?(m.uR.dR=m,g.uR=m.uL=null):m==_?(m.uL=m.uR,m.uR=null,m.uL.dL=m):(g.uR=g.uL,g.uL=null)}function n(t){_.vLow==x.vLow?(h?_.dL?(t.uL=g,g.dL=t,m.dR=null):(t.uR=m,g.dL=null,m.dR=t):(t.uL=g,t.uR=m,g.dL=m.dR=t),g.dR=m.dL=null):(t.uL&&t.uR&&(t.uL==_?(t.usave=t.uR,t.uleft=!0):(t.usave=t.uL,t.uleft=!1)),t.uL=g,t.uR=m,g.dR=m.dL=t,g.dL=m.dR=null)}function s(){var t;if(_.vLow==x.vLow&&h)_.dL.uL=g,_.dR.uR=m,g.dL=_.dL,m.dR=_.dR,g.dR=m.dL=null,t=null;else{_.dL.uL=g,_.dR.uR=m;var i,r=o.is_left_of(e,_.vLow,!0);if(r>0)i=!0;else if(r<0)i=!1;else{var n=_.dL.rseg,s=n.upward,a=s?n.vFrom:n.vTo;r=o.is_left_of(e,a,!1),r>0?i=!0:r<0?i=!1:(n=s?n.snext:n.sprev,a=s?n.vTo:n.vFrom,r=o.is_left_of(e,a,!1),i=r>0)}i?(t=_.dR,_.dR.uL=g,g.dL=_.dL,m.dR=null):(t=_.dL,_.dL.uR=m,m.dR=_.dR,g.dL=null),g.dR=m.dL=t}return t}var o=this;this.segNodes(e);var a,l,h,u,c,d;if(e.upward?(a=e.vFrom,u=e.vTo,l=e.rootFrom,c=e.rootTo,h=e.sprev.is_inserted,d=e.snext.is_inserted):(a=e.vTo,u=e.vFrom,l=e.rootTo,c=e.rootFrom,h=e.snext.is_inserted,d=e.sprev.is_inserted),!d){var p=this.splitNodeAtPoint(c,u,!1);c==l&&(l=p),c=p}var f=c.trap;if(!f.uL&&!f.uR)return void console.log("ERR add_segment: missing trFirst.uX: ",f);if(f.vHigh!=u)return void console.log("ERR add_segment: trFirstHigh != segHigh: ",f);h||(l=this.splitNodeAtPoint(l,a,!0));for(var g,m,v,y,b,x=l.trap,_=f,w=this.trapArray.length+2;_;){if(--w<0)return void console.log("ERR add_segment: infinite loop",_,e,this);if(!_.dL&&!_.dR)return void console.log("ERR add_segment: missing successors",_,e,this);var C=_.sink;C.seg=e,C.trap=null,y&&y.rseg==_.rseg?(g=_,m=y,m.vLow=_.vLow,C.left=new t.QsNode(g),C.right=y.sink):v&&v.lseg==_.lseg?(m=_,g=v,g.vLow=_.vLow,C.left=v.sink,C.right=new t.QsNode(m)):(g=_,m=this.cloneTrap(_),C.left=new t.QsNode(g),C.right=new t.QsNode(m)),_.uL&&_.uR?r():i(),_.dL&&_.dR?b=s():(b=_.dL?_.dL:_.dR,n(b)),g.rseg&&(g.rseg.trLeft=m),m.lseg&&(m.lseg.trRight=g),g.rseg=m.lseg=e,e.trLeft=g,e.trRight=m,_.vLow!=x.vLow?(v=g,y=m,_=b):_=null}e.is_inserted=!0},assignDepths:function(t){var e,i,r=[this.trapArray[0]],n=[],s=0;do{for(var o=s%2==1;e=r.pop();)e.depth==-1&&(e.depth=s,e.uL&&r.push(e.uL),e.uR&&r.push(e.uR),e.dL&&r.push(e.dL),e.dR&&r.push(e.dR),(i=e.lseg)&&i.trLeft.depth==-1&&n.push(i.trLeft),(i=e.rseg)&&(i.trRight.depth==-1&&n.push(i.trRight),i.upward!=o&&t.set_PolyLeft_wrong(i.chainId)));r=n,n=[],s++}while(r.length>0)},create_visibility_map:function(t){var e,i,r=0,n=1,s=2,o=3,a=4,l=5,h=6,u=7,c=t.nbVertices(),d=new Array(c);for(e=0;e<c;e++)d[e]=new Array(u+1);var p=new Array(c);for(e=0,i=this.trapArray.length;e<i;e++){var f=this.trapArray[e],g=f.uL?f.uR?l:u:f.uR?a:h,m=f.dL?f.dR?n:r:f.dR?o:s;if(f.depth%2==1){if(g==l||m==n||g==u&&m==o||g==a&&m==r){var v=t.appendDiagonalsEntry({vFrom:f.vLow,vTo:f.vHigh,mprev:null,mnext:null,marked:!1}),y=t.appendDiagonalsEntry({vFrom:f.vHigh,vTo:f.vLow,revDiag:v,mprev:null,mnext:null,marked:!1});v.revDiag=y,d[f.vLow.id][m]=v,d[f.vHigh.id][g]=y}}else null!==f.vHigh.id&&(p[f.vHigh.id]=g),null!==f.vLow.id&&(p[f.vLow.id]=m)}var b,x,_,w,C;for(e=0;e<c;e++)if(x=d[e],_=p[e],null!=_){i=_,C=null;do i++>u&&(i=r),(b=x[i])&&(C?(b.mprev=C,C.mnext=b):(w=b.vFrom,w.firstOutDiag=b),C=b.revDiag);while(i!=_);C&&(w.lastInDiag=C)}}},t.Trapezoider=function(e){this.polyData=e,this.queryStructure=new t.QueryStructure(this.polyData)},t.Trapezoider.prototype={constructor:t.Trapezoider,optimise_randomlist:function(t){var e=0,i=this.polyData.nbPolyChains();if(1!=i)for(var r=new Array(i),n=t.concat(),s=0;s<n.length;s++){var o=n[s].chainId;r[o]?t[i++]=n[s]:(t[e++]=n[s],r[o]=!0)}},trapezoide_polygon:function(){var e=this.polyData.getSegments().concat();t.Math.array_shuffle(e),this.optimise_randomlist(e);for(var i,r=e.length,n=this.queryStructure,s=0,o=r;s<r;){o=Math.log(o)/Math.LN2;for(var a=o>1?Math.floor(r/o):r;s<a;s++)n.add_segment(e[s]);for(i=s;i<r;i++)this.queryStructure.segNodes(e[i])}for(n.assignDepths(this.polyData),i=0;i<r;i++)e[i].trLeft=e[i].trRight=null},create_visibility_map:function(){return this.queryStructure.create_visibility_map(this.polyData)}},t.MonoSplitter=function(t){this.polyData=t,this.trapezoider=null},t.MonoSplitter.prototype={constructor:t.MonoSplitter,monotonate_trapezoids:function(){this.trapezoider=new t.Trapezoider(this.polyData),this.trapezoider.trapezoide_polygon(),this.trapezoider.create_visibility_map(),this.polyData.create_mono_chains(),this.polyData.unique_monotone_chains_max()}},t.MonoTriangulator=function(t){this.polyData=t},t.MonoTriangulator.prototype={constructor:t.MonoTriangulator,triangulate_all_polygons:function(){var t=this.polyData.getMonoSubPolys();this.polyData.clearTriangles();for(var e=0;e<t.length;e++){var i=t[e],r=i.mprev,n=i.mnext;n.mnext==r?this.polyData.addTriangle(i.vFrom,n.vFrom,r.vFrom):this.triangulate_monotone_polygon(i)}},triangulate_monotone_polygon:function(e){function i(){for(console.log("ERR uni-y-monotone: only concave angles left",o);a>1;)a--,r.polyData.addTriangle(o[a-1],o[a],o[a+1])}var r=this,n=e.mnext,s=e.vFrom,o=[n.vFrom],a=0;n=n.mnext;var l=n.vFrom;if(l!=s){for(;l!=s||a>1;)if(a>0){var h=t.Math.ptsCrossProd(o[a],l,o[a-1]);Math.abs(h)<=t.Math.EPSILON_P&&(l!=s&&t.Math.compare_pts_yx(o[a],l)!=t.Math.compare_pts_yx(o[a],o[a-1])||(h=1)),h>0?(this.polyData.addTriangle(o[a-1],o[a],l),a--):(o[++a]=l,l==s?i():(n=n.mnext,l=n.vFrom))}else o[++a]=l,n=n.mnext,l=n.vFrom;this.polyData.addTriangle(o[a-1],o[a],l)}}},t.Triangulator=function(){this.lastPolyData=null},t.Triangulator.prototype={constructor:t.Triangulator,clear_lastData:function(){this.lastPolyData=null},get_PolyLeftArr:function(){return this.lastPolyData?this.lastPolyData.get_PolyLeftArr():null},triangulate_polygon:function(e,i){function r(){return!i&&1==s.nbPolyChains()}if(this.clear_lastData(),!e||0===e.length)return[];var n,s=new t.PolygonData(e),o=r();if(o&&(n=new t.EarClipTriangulator(s),o=n.triangulate_polygon_no_holes()),!o){var a=new t.MonoSplitter(s);a.monotonate_trapezoids(),n=new t.MonoTriangulator(s),n.triangulate_all_polygons()}return this.lastPolyData=s,s.getTriangles()}},t}),r("Renderer/PolygonRenderer",["../Utils/Constants","../Utils/Utils","./VectorRenderer","./VectorRendererManager","./FeatureStyle","./Program","./BatchRenderable","./pnltri","./GeoBound"],function(t,e,i,r,n,s,o,a,l){var h=function(t){i.prototype.constructor.call(this,t),this.maxTilePerGeometry=2,this.renderContext=t.renderContext,this.defaultVertexShader="attribute vec3 vertex;\n",this.defaultVertexShader+="uniform mat4 mvp;\n",this.defaultVertexShader+="void main(void) \n",this.defaultVertexShader+="{\n",this.defaultVertexShader+="\tgl_Position = mvp * vec4(vertex, 1.0);\n",this.defaultVertexShader+="}\n",this.extrudeVertexShader="attribute vec3 vertex;\n",this.extrudeVertexShader+="attribute vec4 normal;\n",this.extrudeVertexShader+="uniform float extrusionScale; \n",this.extrudeVertexShader+="uniform mat4 mvp;\n",this.extrudeVertexShader+="void main(void) \n",this.extrudeVertexShader+="{\n",this.extrudeVertexShader+="\tvec3 extrudedVertex = vertex + normal.w * vec3(normal.x, normal.y, normal.z) * extrusionScale;",this.extrudeVertexShader+="\tgl_Position = mvp * vec4(extrudedVertex, 1.0);\n",this.extrudeVertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="uniform vec4 u_color;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor = u_color;\n",this.fragmentShader+="\t//if (u_color.a == 0.0) discard;\n",this.fragmentShader+="}\n",this.program=new s(t.renderContext),this.program.createFromSource(this.defaultVertexShader,this.fragmentShader),this.extrudeProgram=new s(t.renderContext),this.extrudeProgram.createFromSource(this.extrudeVertexShader,this.fragmentShader)};e.inherits(i,h);var u=function(t){o.prototype.constructor.call(this,t),this.origin=null,this.vertexSize=t.style.extrude?7:3,this.matrix=mat4.create()};e.inherits(o,u);var c=function(t,e,i){return[e[0]+t*(i[0]-e[0]),e[1]+t*(i[1]-e[1])]},d=function(t,e,i,r){for(var n,s,o=[],a=0;a<r.length;a++){var l=r[a],h=r[(a+1)%r.length],u=l[t],d=h[t],p=(u-i)*e>=0,f=(d-i)*e>=0;!p&&f?(n=(i-u)/(d-u),s=c(n,l,h),o.push(s),o.push(h)):p&&f?o.push(h):p&&!f&&(n=(i-u)/(d-u),s=c(n,l,h),o.push(s))}return o},p=function(t,e){var i;return i=d(0,1,e.west,t),i=d(0,-1,e.east,i),i=d(1,1,e.south,i),i=d(1,-1,e.north,i)},f=function(t){for(var e=!1,i=1;i<t.length&&!e;i++){var r=Math.abs(t[i][0]-t[i-1][0]);r>180&&r<360&&(e=!0)}var n;if(e){var s=[];for(n=0;n<t.length;n++)t[n][0]>0?s[n]=[t[n][0]-360,t[n][1]]:s[n]=[t[n][0],t[n][1]];var o=[];for(n=0;n<t.length;n++)t[n][0]<0?o[n]=[t[n][0]+360,t[n][1]]:o[n]=[t[n][0],t[n][1]];return[o,s]}return[t]};u.prototype.build=function(e){var i=this.bucket.renderer,r=this.bucket.style,n=i.globe.getCoordinateSystem(),s=e.type===t.GEOMETRY.MultiPolygon?e.coordinates:[e.coordinates],o=new l,h=new l(n.getGeoBound().getWest(),n.getGeoBound().getSouth(),n.getGeoBound().getEast(),n.getGeoBound().getNorth()),u=o.computeFromCoordinatesInCrsTo(s[0][0],e.crs.properties.name,n);if(o.intersects(h)){var c,d,g=vec3.create();this.origin||(this.origin=vec3.create(),n.get3DFromWorld(u,this.origin),mat4.identity(this.matrix),mat4.translate(this.matrix,this.origin));var m,v,y=this.vertices.length/this.vertexSize,b=this.vertices.length,x=[];for(d=0;d<s.length;d++)x=x.concat(f(s[d][0]));for(d=0;d<x.length;d++){var _=p(x[d],h);b=this.vertices.length;var w=0;for(c=0;c<_.length;c++){if(n.get3DFromWorldInCrs([_[c][0],_[c][1],0],e.crs.properties.name,g),this.vertices[b]=g[0]-this.origin[0],this.vertices[b+1]=g[1]-this.origin[1],this.vertices[b+2]=g[2]-this.origin[2],c<_.length-1&&(w+=(_[c+1][0]-_[c][0])*(_[c+1][1]+_[c][1])),r.extrude){vec3.normalize(g),this.vertices[b+3]=g[0],this.vertices[b+4]=g[1],this.vertices[b+5]=g[2];var C;C="boolean"==typeof r.extrude?_[c][2]:r.extrude,this.vertices[b+6]=C*n.geoide.heightScale}b+=this.vertexSize}if(r.extrude){var T=y*this.vertexSize;for(this.vertices=this.vertices.concat(this.vertices.slice(T,b)),c=b;c<this.vertices.length;c+=this.vertexSize)this.vertices[c+6]=0}var A=new a.Triangulator,I=_.map(function(t){return{x:t[0],y:t[1]}}),S=A.triangulate_polygon([I]);for(c=0;c<S.length;c++)this.triIndices.push(y+S[c][0],y+S[c][1],y+S[c][2]);if(r.extrude)for(m=y,v=y+_.length,c=0;c<_.length-1;c++)w>0?(this.triIndices.push(m,m+1,v),this.triIndices.push(m+1,v+1,v)):(this.triIndices.push(m,v,m+1),this.triIndices.push(m+1,v,v+1)),m+=1,v+=1;for(c=0;c<_.length-1;c++)this.lineIndices.push(y+c,y+c+1);if(r.extrude)for(m=y,v=y+_.length,c=0;c<_.length-1;c++)this.lineIndices.push(m+c,v+c);y=this.vertices.length/this.vertexSize}return!0}};var g=function(t,e){this.layer=t,this.style=e,this.renderer=null};g.prototype.createRenderable=function(){return new u(this)},g.prototype.isCompatible=function(t){return this.style===t},h.prototype.render=function(t,e,i){var r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.depthFunc(n.LEQUAL);var s=null,o=mat4.create();mat4.multiply(r.projectionMatrix,r.viewMatrix,o);for(var a=mat4.create(),l=e;l<i;l++){var h=t[l],u=h.bucket.style,c=u.extrude?this.extrudeProgram:this.program;if(c!==s&&(c.apply(),s=c),mat4.multiply(o,h.matrix,a),n.uniformMatrix4fv(c.uniforms.mvp,!1,a),n.uniform4f(c.uniforms.u_color,u.fillColor[0],u.fillColor[1],u.fillColor[2],u.fillColor[3]*h.bucket.layer.opacity),h.bindBuffers(r),n.lineWidth(u.strokeWidth),n.vertexAttribPointer(c.attributes.vertex,3,n.FLOAT,!1,4*h.vertexSize,0),u.extrude&&(n.vertexAttribPointer(c.attributes.normal,4,n.FLOAT,!1,4*h.vertexSize,12),n.uniform1f(c.uniforms.extrusionScale,u.extrusionScale)),n.drawElements(n.TRIANGLES,h.triIndices.length,h.indexType,0),h.lineIndices.length>0){n.uniform4f(c.uniforms.u_color,u.strokeColor[0],u.strokeColor[1],u.strokeColor[2],u.strokeColor[3]*h.bucket.layer.opacity);var d=h.indexType===n.UNSIGNED_INT?4:2;n.drawElements(n.LINES,h.lineIndices.length,h.indexType,h.triIndices.length*d)}}n.lineWidth(1),n.depthFunc(n.LESS),n.disable(n.BLEND)},h.prototype.canApply=function(e,i){return(e===t.GEOMETRY.Polygon||e===t.GEOMETRY.MultiPolygon)&&i.fill},h.prototype.createBucket=function(t,e){return new g(t,e)},r.factory.push(function(t){return new h(t)})}),r("Renderer/LineRenderer",["../Utils/Constants","../Utils/Utils","../Utils/Numeric","./VectorRenderer","./VectorRendererManager","./Program","./BatchRenderable"],function(t,e,i,r,n,s,o){var a=function(t){r.prototype.constructor.call(this,t),this.maxTilePerGeometry=2,this.renderContext=t.getRenderContext(),this.defaultVertexShader="attribute vec4 vertex;\n",this.defaultVertexShader+="uniform mat4 mvp;\n",this.defaultVertexShader+="varying float s;\n",this.defaultVertexShader+="void main(void) \n",this.defaultVertexShader+="{\n",this.defaultVertexShader+="\ts = vertex.w;\n",this.defaultVertexShader+="\tgl_Position = mvp * vec4(vertex.xyz, 1.0);\n",this.defaultVertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="uniform vec4 u_color;\n",this.fragmentShader+="uniform float speed;\n",this.fragmentShader+="uniform float time;\n",this.fragmentShader+="uniform float gradientLength;\n",this.fragmentShader+="varying float s;\n",this.fragmentShader+="uniform sampler2D colorTexture;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\t// 0.5 is a time scale parameter, parametrize it ?\n",this.fragmentShader+="\tfloat m = speed * time * 0.5;\n",this.fragmentShader+="\tfloat u = (-s+m)/gradientLength;\n",this.fragmentShader+="\tgl_FragColor.rgb = texture2D(colorTexture, vec2(u,0.)).rgb;\n",this.fragmentShader+="\t// TODO: handle appereance of rivers\n",this.fragmentShader+="\tif ( s < m )\n",this.fragmentShader+="\t{\n",this.fragmentShader+="\t\tgl_FragColor.a = 1.0;\n",this.fragmentShader+="\t}\n",this.fragmentShader+="\telse\n",this.fragmentShader+="\t{\n",this.fragmentShader+="\t\tgl_FragColor.a = 0.0;\n",this.fragmentShader+="\t}\n",this.fragmentShader+="}\n",this.program=new s(t.renderContext),this.program.createFromSource(this.defaultVertexShader,this.fragmentShader),this.time=Date.now()/1e3,this.palette=null,this.colorTexture=this.generateTexture([[0,0,255],[0,200,255]])};e.inherits(r,a),a.prototype.generateTexture=function(t){var e,r,n,s,o=t[0],a=t[1],l=[],h=this.globe.renderContext.gl;for(this.colorTexture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.colorTexture),e=0;e<128;e++)r=i.coserp(e/128,o[0],a[0]),n=i.coserp(e/128,o[1],a[1]),s=i.coserp(e/128,o[2],a[2]),l.push(r),l.push(n),l.push(s),l.push(255);for(e=0;e<128;e++)r=i.coserp(e/128,a[0],o[0]),n=i.coserp(e/128,a[1],o[1]),s=i.coserp(e/128,a[2],o[2]),l.push(r),l.push(n),l.push(s),l.push(255);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,l.length/4,1,0,h.RGBA,h.UNSIGNED_BYTE,new Uint8Array(l)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),this.palette=t};var l=function(t){o.prototype.constructor.call(this,t),this.vertexSize=4,this.matrix=mat4.create(),mat4.identity(this.matrix)};e.inherits(o,l),l.prototype.build=function(e){var i,r,n=this.bucket.renderer,s=(this.bucket.style,e.type===t.GEOMETRY.MultiLineString?e.coordinates:[e.coordinates]),o=vec3.create(),a=vec3.create();for(r=0;r<s.length;r++){var l=s[r],h=this.vertices.length/4,u=n.globe.getCoordinateSystem(),c=4*h,d=0;for(i=0;i<l.length;i++){u.get3DFromWorldInCrs(l[i],e.crs.properties.name,o),this.vertices[c]=o[0],this.vertices[c+1]=o[1],this.vertices[c+2]=o[2],i>0&&(d+=vec3.dist(o,a));var p=a;a=o,o=p,this.vertices[c+3]=d,c+=4}for(i=0;i<l.length-1;i++)this.lineIndices.push(h+i,h+i+1)}return!0};var h=function(t,e){this.layer=t,this.style=e,this.renderer=null};h.prototype.createRenderable=function(){return new l(this)},h.prototype.isCompatible=function(t){return this.style===t},a.prototype.render=function(t,e,i){var r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.depthFunc(n.LEQUAL);var s=mat4.create();mat4.multiply(r.projectionMatrix,r.viewMatrix,s);var o=mat4.create();this.program.apply(),n.activeTexture(n.TEXTURE0),n.uniform1i(this.program.uniforms.colorTexture,0),n.bindTexture(n.TEXTURE_2D,this.colorTexture);for(var a=e;a<i;a++){var l=t[a],h=l.bucket.style;mat4.multiply(s,l.matrix,o),n.uniformMatrix4fv(this.program.uniforms.mvp,!1,o),h.palette&&h.palette!==this.palette&&(n.deleteTexture(this.colorTexture),this.generateTexture(h.palette)),n.lineWidth(h.strokeWidth),n.uniform4f(this.program.uniforms.u_color,h.strokeColor[0],h.strokeColor[1],h.strokeColor[2],h.strokeColor[3]*l.bucket.layer.opacity),n.uniform1f(this.program.uniforms.speed,h.hasOwnProperty("speed")?h.speed:1),n.uniform1f(this.program.uniforms.time,Date.now()/1e3-this.time),n.uniform1f(this.program.uniforms.gradientLength,h.hasOwnProperty("gradientLength")?h.gradientLength:10),l.bindBuffers(r),n.vertexAttribPointer(this.program.attributes.vertex,4,n.FLOAT,!1,0,0),n.drawElements(n.LINES,l.lineIndices.length,l.indexType,0)}n.lineWidth(1),n.depthFunc(n.LESS),n.disable(n.BLEND)},a.prototype.canApply=function(e,i){return(e===t.GEOMETRY.LineString||e===t.GEOMETRY.MultiLineString)&&i.gradientLength},a.prototype.createBucket=function(t,e){return new h(t,e)},n.factory.push(function(t){return new a(t)})}),r("Renderer/PointSpriteRenderer",["../Utils/Utils","./VectorRenderer","./Program","./FeatureStyle","./VectorRendererManager","../Utils/Constants"],function(t,e,i,r,n,s){var o=function(t){e.prototype.constructor.call(this,t),this.numberOfRenderPoints=0;var r="attribute vec3 vertex; \n";r+="uniform mat4 viewProjectionMatrix; \n",r+="uniform float pointSize; \n",r+="void main(void)  \n",r+="{ \n",r+="\tgl_Position = viewProjectionMatrix * vec4(vertex,1.0); \n",r+="\tgl_PointSize = pointSize; \n",r+="} \n";var n="precision lowp float; \n";n+="uniform sampler2D texture; \n",n+="uniform float alpha; \n",n+="uniform vec3 color; \n",n+="\n",n+="void main(void) \n",n+="{ \n",n+="\tvec4 textureColor = texture2D(texture, gl_PointCoord); \n",n+="\tgl_FragColor = vec4(textureColor.rgb * color, textureColor.a * alpha); \n",n+="\tif (gl_FragColor.a <= 0.0) discard; \n",n+="\t//gl_FragColor = vec4(1.0); \n",n+="} \n",this.program=new i(t.renderContext),this.program.createFromSource(r,n),this.defaultTexture=null};t.inherits(e,o);var a=function(t){this.bucket=t,this.geometry2vb={},this.vertices=[],this.vertexBuffer=null,this.vertexBufferDirty=!1};a.prototype.add=function(t){this.geometry2vb[t.gid]=this.vertices.length;var e=this.bucket.renderer.globe,i=e.getCoordinateSystem(),r=i.get3DFromWorldInCrs(t.coordinates,t.crs.properties.name),n=i.getGeoide().getRealPlanetRadius(),s=(i.getGeoide().getRadius(),this.bucket.renderer.globe.isSky()?.95:1.0005+i.getElevation(e,t)/n);return this.vertices.push(s*r[0],s*r[1],s*r[2]),this.vertexBufferDirty=!0,!0},a.prototype.remove=function(t){if(this.geometry2vb.hasOwnProperty(t.gid)){var e=this.geometry2vb[t.gid];delete this.geometry2vb[t.gid],this.vertices.splice(e,3),this.vertexBufferDirty=!0;for(var i in this.geometry2vb)i&&this.geometry2vb[i]>e&&(this.geometry2vb[i]-=3)}return this.vertices.length},a.prototype.dispose=function(t){this.vertexBuffer&&t.gl.deleteBuffer(this.vertexBuffer)},o.prototype._buildDefaultTexture=function(t){if(!this.defaultTexture){var e=this.globe.renderContext.gl;this.defaultTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.defaultTexture);var i=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i)}t.texture=this.defaultTexture,t.textureWidth=10,t.textureHeight=10},o.prototype._buildTextureFromImage=function(t,e){t.texture=this.globe.renderContext.createNonPowerOfTwoTextureFromImage(e),t.textureWidth=e.width,t.textureHeight=e.height},o.prototype.canApply=function(t,e){return t===s.GEOMETRY.Point&&!e.label};var l=function(t,e){this.layer=t,this.style=new r(e),this.texture=null,this.renderer=null};return l.prototype.createRenderable=function(){return new a(this)},l.prototype.isCompatible=function(t){return this.style.iconUrl===t.iconUrl&&this.style.icon===t.icon&&this.style.fillColor[0]===t.fillColor[0]&&this.style.fillColor[1]===t.fillColor[1]&&this.style.fillColor[2]===t.fillColor[2]},o.prototype.createBucket=function(t,e){var i=this.globe.renderContext.gl,r=(i.createBuffer(),new l(t,e));if(r.renderer=this,e.iconUrl){var n=new Image;n.crossOrigin="";var s=this;n.onload=function(){s._buildTextureFromImage(r,n),s.globe.renderContext.requestFrame()},n.onerror=function(){s._buildDefaultTexture(r)},n.src=e.iconUrl}else e.icon?this._buildTextureFromImage(r,e.icon):this._buildDefaultTexture(r);return r},o.prototype.render=function(t,e,i){var r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.program.apply(),mat4.multiply(r.projectionMatrix,r.viewMatrix,r.modelViewMatrix),n.uniformMatrix4fv(this.program.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix),n.uniform1i(this.program.uniforms.texture,0);for(var s=null,o=e;o<i;o++){var a=t[o],l=a.bucket;if(s!==l){n.uniform1f(this.program.uniforms.alpha,l.layer.opacity);var h=l.style.fillColor;n.uniform3f(this.program.uniforms.color,h[0],h[1],h[2]),n.uniform1f(this.program.uniforms.pointSize,l.textureWidth),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l.texture),s=l}a.vertexBuffer||(a.vertexBuffer=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,a.vertexBuffer),n.vertexAttribPointer(this.program.attributes.vertex,3,n.FLOAT,!1,0,0),a.vertexBufferDirty&&(n.bufferData(n.ARRAY_BUFFER,new Float32Array(a.vertices),n.STATIC_DRAW),a.vertexBufferDirty=!1),n.drawArrays(n.POINTS,0,a.vertices.length/3)}n.disable(n.BLEND)},n.factory.push(function(t){return new o(t)}),o}),r("Tiling/Triangulator",[],function(){var t=1e-10,e=function(t){for(var e=t.length,i=0,r=e-1,n=0;n<e;r=n++)i+=t[r][0]*t[n][1]-t[n][0]*t[r][1];return.5*i},i=function(t,e,i,r,n,s,o,a){var l,h,u,c,d,p,f,g,m,v,y,b,x,_,w;return l=n-i,h=s-r,u=t-n,c=e-s,d=i-t,p=r-e,f=o-t,g=a-e,m=o-i,v=a-r,y=o-n,b=a-s,w=l*v-h*m,x=d*g-p*f,_=u*b-c*y,w>=0&&_>=0&&x>=0},r=function(e,r,n,s,o,a){var l,h,u,c,d,p,f,g,m;if(h=e[a[r]][0],u=e[a[r]][1],c=e[a[n]][0],d=e[a[n]][1],p=e[a[s]][0],f=e[a[s]][1],t>(c-h)*(f-u)-(d-u)*(p-h))return!1;for(l=0;l<o;l++)if(l!==r&&l!==n&&l!==s&&(g=e[a[l]][0],m=e[a[l]][1],i(h,u,c,d,p,f,g,m)))return!1;return!0},n=function(t){var i=t.length;if(t[0][0]===t[i-1][0]&&t[0][1]===t[i-1][1]&&i--,i<3)return null;var n,s,o=new Array(i);if(0<e(t))for(s=0;s<i;s++)o[s]=s;else for(s=0;s<i;s++)o[s]=i-1-s;var a=i,l=[],h=2*a;for(n=0,s=a-1;a>2;){if(0>=h--)return null;var u=s;a<=u&&(u=0),s=u+1,a<=s&&(s=0);var c=s+1;if(a<=c&&(c=0),r(t,u,s,c,a,o)){var d,p,f,g,m;for(d=o[u],p=o[s],f=o[c],l.push(d),l.push(p),l.push(f),n++,g=s,m=s+1;m<a;g++,m++)o[g]=o[m];a--,h=2*a}}return l},s={process:n};return s}),r("Renderer/ConvexPolygonRenderer",["../Utils/Utils","../Utils/Constants","./VectorRenderer","./Program","./FeatureStyle","./VectorRendererManager","../Tiling/Triangulator","./glMatrix"],function(t,e,i,r,n,s,o){var a=function(t,e){this.layer=t,this.style=new n(e),this.texture=null,this.polygonProgram=null,this.renderer=null,this.mainRenderable=null};a.prototype.isCompatible=function(t){return this.style.strokeColor[0]===t.strokeColor[0]&&this.style.strokeColor[1]===t.strokeColor[1]&&this.style.strokeColor[2]===t.strokeColor[2]&&this.style.fill===t.fill&&this.style.fillTexture===t.fillTexture&&this.style.fillTextureUrl===t.fillTextureUrl&&this.style.fillShader===t.fillShader};var l=function(t){this.bucket=t,this.geometry2vb={},this.vertices=[],this.lineIndices=[],this.triangleIndices=[],this.vertexBuffer=null,this.lineIndexBuffer=null,this.triangleIndexBuffer=null,this.bufferDirty=!1,this.triBufferDirty=!1,this.tcoords=[]};l.prototype.add=function(t){var i,r,n,s=[],a=t.crs.properties.name;if(t.type===e.GEOMETRY.MultiPolygon)for(i=0;i<t.coordinates.length;i++)s.push(t.coordinates[i][0]);else if(t.type===e.GEOMETRY.LineString)s.push(t.coordinates);else if(t.type===e.GEOMETRY.MultiLineString)for(i=0;i<t.coordinates.length;i++)s.push(t.coordinates[i]);else s.push(t.coordinates[0]);for(r=0;r<s.length;r++){var l=s[r],h=l.length,u={vertexStart:this.vertices.length,vertexCount:3*h,lineIndexStart:this.lineIndices.length,lineIndexCount:2*h,triIndexStart:0,triIndexCount:0},c=this.bucket.renderer.globe.getCoordinateSystem();if(t._imageCoordinates){u.tcoordsStart=this.tcoords.length,u.tcoordsCount=2*h;var d=c.get3DFromWorldInCrs(t._imageCoordinates[0][0],a),p=c.get3DFromWorldInCrs(t._imageCoordinates[0][1],a),f=c.get3DFromWorldInCrs(t._imageCoordinates[0][3],a),g=[];vec3.subtract(p,d,g);var m=[];vec3.subtract(f,d,m);var v=vec3.length(g)*vec3.length(g),y=vec3.length(m)*vec3.length(m);for(i=0;i<h;i++){n=c.get3DFromWorldInCrs(l[i],a);var b=[];vec3.subtract(n,d,b);var x=vec3.dot(b,g),_=vec3.dot(b,m),w=x/v,C=_/y;this.tcoords.push(w),this.tcoords.push(C)}}var T=this.vertices.length/3;
for(i=0;i<h&&(n=c.get3DFromWorldInCrs(l[i],a),this.vertices.push(n[0],n[1],n[2]),t.type!==e.GEOMETRY.MultiLineString&&t.type!==e.GEOMETRY.LineString||i!==h-1);i++)this.lineIndices.push(T+i,T+(i+1)%h);if(this.bucket.style.fill){u.triIndexStart=this.triangleIndices.length,u.triIndexCount=3*(h-2);var A=o.process(l);if(null!==A)this.triangleIndices=A;else for(i=0;i<h-2;i++)this.triangleIndices.push(T,T+i+1,T+i+2)}this.geometry2vb[t.gid]?(this.geometry2vb[t.gid].vertexCount+=u.vertexCount,this.geometry2vb[t.gid].lineIndexCount+=u.lineIndexCount,this.geometry2vb[t.gid].triIndexCount+=u.triIndexCount):this.geometry2vb[t.gid]=u,this.bufferDirty=!0,this.triBufferDirty=!0}return!0},l.prototype.remove=function(t){var e;if(this.geometry2vb.hasOwnProperty(t.gid)){var i=this.geometry2vb[t.gid];for(delete this.geometry2vb[t.gid],this.vertices.splice(i.vertexStart,i.vertexCount),e=i.lineIndexStart+i.lineIndexCount;e<this.lineIndices.length;e++)this.lineIndices[e]-=i.vertexCount/3;for(e=i.triIndexStart+i.triIndexCount;e<this.triangleIndices.length;e++)this.triangleIndices[e]-=i.vertexCount/3;this.lineIndices.splice(i.lineIndexStart,i.lineIndexCount),this.triangleIndices.splice(i.triIndexStart,i.triIndexCount),i.tcoordsStart>=0&&this.tcoords.splice(i.tcoordsStart,i.tcoordsCount);for(var r in this.geometry2vb)if(r){var n=this.geometry2vb[r];n.vertexStart>i.vertexStart&&(n.vertexStart-=i.vertexCount,n.lineIndexStart-=i.lineIndexCount,n.triIndexStart-=i.triIndexCount,n.tcoordsStart>=0&&(n.tcoordsStart-=i.tcoordsCount))}this.bufferDirty=!0,this.triBufferDirty=!0}return this.vertices.length},l.prototype.dispose=function(t){this.vertexBuffer&&t.gl.deleteBuffer(this.vertexBuffer),this.lineIndexBuffer&&t.gl.deleteBuffer(this.lineIndexBuffer),this.triangleIndexBuffer&&t.gl.deleteBuffer(this.triangleIndexBuffer),this.tcoordBuffer&&t.gl.deleteBuffer(this.tcoordBuffer)},a.prototype.createRenderable=function(){return new l(this)};var h=function(t){i.prototype.constructor.call(this,t),this.maxTilePerGeometry=2,this.renderContext=t.tileManager.renderContext,this.tileConfig=t.tileManager.tileConfig,this.programs=[],this.basicVertexShader="attribute vec3 vertex;\n",this.basicVertexShader+="uniform mat4 viewProjectionMatrix;\n",this.basicVertexShader+="    \n",this.basicVertexShader+="    void main(void)\n",this.basicVertexShader+="    {\n",this.basicVertexShader+="        gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n",this.basicVertexShader+="    }\n",this.basicFragmentShader="precision lowp float; \n",this.basicFragmentShader+="    uniform vec4 color; \n",this.basicFragmentShader+="    \n",this.basicFragmentShader+="    void main(void) \n",this.basicFragmentShader+="    { \n",this.basicFragmentShader+="        gl_FragColor = color; \n",this.basicFragmentShader+="    } \n",this.texVertexShader="attribute vec3 vertex;\n",this.texVertexShader+="    attribute vec2 tcoord;\n",this.texVertexShader+="    uniform mat4 viewProjectionMatrix;\n",this.texVertexShader+="    \n",this.texVertexShader+="    varying vec2 vTextureCoord;\n",this.texVertexShader+="    \n",this.texVertexShader+="    void main(void) \n",this.texVertexShader+="    {\n",this.texVertexShader+="        vTextureCoord = tcoord;\n",this.texVertexShader+="        vTextureCoord.y = 1.0 - vTextureCoord.y; \n",this.texVertexShader+="        gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n",this.texVertexShader+="    }\n",this.texFragmentShader="precision lowp float; \n",this.texFragmentShader+="    uniform vec4 color;\n",this.texFragmentShader+="    varying vec2 vTextureCoord;\n",this.texFragmentShader+="    uniform sampler2D texture; \n",this.texFragmentShader+="    void main(void)\n",this.texFragmentShader+="    {\n",this.texFragmentShader+="        gl_FragColor = texture2D(texture, vTextureCoord) * color;\n",this.texFragmentShader+="    }\n",this.basicFillShader={vertexCode:this.basicVertexShader,fragmentCode:this.basicFragmentShader,updateUniforms:null},this.texFillShader={vertexCode:this.texVertexShader,fragmentCode:this.texFragmentShader,updateUniforms:null},this.basicProgram=this.createProgram(this.basicFillShader),this.texProgram=this.createProgram(this.texFillShader);var e=this.renderContext.gl;this.whiteTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.whiteTexture);var r=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r),this.tcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.tcoordBuffer);var n=[0,0,1,0,1,1,0,1,0,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),this.tcoordBuffer.itemSize=2,this.tcoordBuffer.numItems=5};return t.inherits(i,h),h.prototype.canApply=function(t,i){return!!this.globe.isSky()&&(t===e.GEOMETRY.Polygon||t===e.GEOMETRY.MultiPolygon||t===e.GEOMETRY.LineString||t===e.GEOMETRY.MultiLineString)},h.prototype.createProgram=function(t){var e=new r(this.renderContext);return e.createFromSource(t.vertexCode,t.fragmentCode),e.id=this.programs.length,this.programs.push({fillShader:t,program:e}),e},h.prototype.getProgram=function(t){for(var e,i=0;i<this.programs.length;i++)this.programs[i].fillShader===t&&(e=this.programs[i].program);return e||(e=this.createProgram(t)),e},h.prototype.createBucket=function(t,e){var i=this.renderContext.gl,r=(i.createBuffer(),new a(t,e)),n=this;if(e.fill){var s=!1;if(e.fillTextureUrl){var o=new Image;o.crossOrigin="",o.onload=function(){r.texture=n.renderContext.createNonPowerOfTwoTextureFromImage(o,t.invertY)},o.onerror=function(t){console.log("Cannot load "+o.src)},o.src=e.fillTextureUrl,s=!0}else e.fillTexture&&(r.texture=e.fillTexture,s=!0);e.fillShader&&e.fillShader.fragmentCode?(e.fillShader.vertexCode||(e.fillShader.vertexCode=this.texVertexShader),e.fillShader.vertexCode||(e.fillShader.fragmentCode=this.texFragmentShader),r.polygonProgram=this.getProgram(e.fillShader)):r.polygonProgram=s?this.texProgram:this.basicProgram}return r},h.prototype.render=function(t,e,i){var r=this.renderContext,n=this.renderContext.gl;n.disable(n.DEPTH_TEST),n.depthMask(!1),n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.basicProgram.apply(),mat4.multiply(r.projectionMatrix,r.viewMatrix,r.modelViewMatrix),n.uniformMatrix4fv(this.basicProgram.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix);for(var s=e;s<i;s++){var o=t[s],a=o.bucket,l=a.style.strokeColor;if(n.uniform4f(this.basicProgram.uniforms.color,l[0],l[1],l[2],l[3]*a.layer.getOpacity()),o.vertexBuffer||(o.vertexBuffer=n.createBuffer(),o.lineIndexBuffer=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,o.vertexBuffer),n.vertexAttribPointer(this.basicProgram.attributes.vertex,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.lineIndexBuffer),o.bufferDirty&&(n.bufferData(n.ARRAY_BUFFER,new Float32Array(o.vertices),n.STATIC_DRAW),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(o.lineIndices),n.STATIC_DRAW),o.bufferDirty=!1),n.drawElements(n.LINES,o.lineIndices.length,n.UNSIGNED_SHORT,0),a.polygonProgram){var h=a.polygonProgram;h.apply(),n.uniformMatrix4fv(h.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix),n.uniform1i(h.uniforms.texture,0),o.tcoords.length>0?(o.tcoordBuffer||(o.tcoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,o.tcoordBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o.tcoords),n.STATIC_DRAW),o.tcoordBuffer.itemSize=2,o.tcoordBuffer.numItems=o.tcoords.length/2),n.bindBuffer(n.ARRAY_BUFFER,o.tcoordBuffer)):n.bindBuffer(n.ARRAY_BUFFER,this.tcoordBuffer),n.vertexAttribPointer(h.attributes.tcoord,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,o.vertexBuffer),n.vertexAttribPointer(h.attributes.vertex,3,n.FLOAT,!1,0,0),a.style.fillShader&&a.style.fillShader.updateUniforms&&a.style.fillShader.updateUniforms(n,o.bucket,h),o.triangleIndexBuffer||(o.triangleIndexBuffer=n.createBuffer()),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.triangleIndexBuffer),o.triBufferDirty&&(n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(o.triangleIndices),n.STATIC_DRAW),o.triBufferDirty=!1),n.activeTexture(n.TEXTURE0),o.bucket.texture?(n.bindTexture(n.TEXTURE_2D,o.bucket.texture),n.uniform4f(h.uniforms.color,1,1,1,l[3]*a.layer.getOpacity())):(n.bindTexture(n.TEXTURE_2D,this.whiteTexture),l=o.bucket.style.fillColor,n.uniform4f(h.uniforms.color,l[0],l[1],l[2],l[3]*a.layer.getOpacity())),n.drawElements(n.TRIANGLES,o.triangleIndices.length,n.UNSIGNED_SHORT,0),this.basicProgram.apply()}}n.enable(n.DEPTH_TEST),n.depthMask(!0),n.disable(n.BLEND)},s.factory.push(function(t){return new h(t)}),h}),r("Context/AbstractContext",["jquery","underscore-min","../Utils/Event","../Utils/Utils","../Layer/LayerFactory","../Services/ServiceFactory","../Utils/Constants","../Gui/Tracker/PositionTracker","../Gui/Tracker/ElevationTracker","../Utils/AttributionHandler","../Renderer/PointRenderer","../Renderer/LineStringRenderable","../Renderer/PolygonRenderer","../Renderer/LineRenderer","../Renderer/PointSpriteRenderer","../Renderer/ConvexPolygonRenderer"],function(t,e,i,r,n,s,o,a,l,h){function u(t){return new a({element:t.positionTracker&&t.positionTracker.element?t.positionTracker.element:"posTracker",isMobile:!!t.isMobile,position:t.positionTracker&&t.positionTracker.position?t.positionTracker.position:"bottom"})}function c(t,e){return new l({element:t.elevationTracker&&t.elevationTracker.element?t.elevationTracker.element:"elevTracker",isMobile:!!t.isMobile,position:t.elevationTracker&&t.elevationTracker.elevation?t.elevationTracker.position:"bottom",elevationLayer:void 0!==e.planetLayer?e.planetLayer.elevationLayer:void 0})}function d(t){"background"===t.category&&t.isVisible()?this.globe.setBaseImagery(t):this.globe.addLayer(t)}var p=function(e,r,n){i.prototype.constructor.call(this);var s=this;this.globe=null,this.navigation=null,this.components={},this.dataProviders={},this.canvas=e.canvas,this.subscribe("baseLayersReady",function(e){t(s.canvas.parentElement).find("#loading").hide()}),this.mizarConfiguration=e.hasOwnProperty("configuration")?e.configuration:{},this.credits=!0,this.ctxOptions=n,this.mode=r,this.layers=[],this.initCanvas(this.canvas),this.positionTracker=u.call(this,this.mizarConfiguration),this.elevationTracker=c.call(this,this.mizarConfiguration,n)};return r.inherits(i,p),p.prototype._showUpError=function(t){console.error("Globe creation error : ",t),document.getElementById("MizarCanvas")&&(document.getElementById("MizarCanvas").style.display="none"),document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),document.getElementById("webGLNotAvailable")&&(document.getElementById("webGLNotAvailable").style.display="block")},p.prototype._fillDataProvider=function(t,e){if(e.data&&this.dataProviders[e.data.type]){var i=this.dataProviders[e.data.type];i(t,e.data)}},p.prototype.getTileManager=function(){return this.globe.getTileManager()},p.prototype.registerNoStandardDataProvider=function(t,e){this.dataProviders[t.toString()]=e},p.prototype.getContextConfiguration=function(){return this.ctxOptions},p.prototype.getMizarConfiguration=function(){return this.mizarConfiguration},p.prototype.getLonLatFromPixel=function(t,e){return this.globe.getLonLatFromPixel(t,e)},p.prototype.getPixelFromLonLat=function(t,e){return this.globe.getPixelFromLonLat(t,e)},p.prototype.getElevation=function(t,e){return this.globe.getElevation(t,e)},p.prototype.getPositionTracker=function(){return this.positionTracker},p.prototype.getElevationTracker=function(){return this.elevationTracker},p.prototype.getLayers=function(){return this.layers},p.prototype.getLayerByID=function(t){return e.find(e.union(this.getLayers()),function(e){return e.ID===t})},p.prototype.getLayerByName=function(t){return e.findWhere(this.getLayers(),{name:t})},p.prototype.addLayer=function(t){var e=n.create(t);"Planet"===e.type?this.layers.push(e):(this.layers.push(e),d.call(this,e)),this._fillDataProvider(e,t),e.pickable&&s.create(o.SERVICE.PickingManager).addPickableLayer(e);var i=this;e.subscribe("visibility:changed",function(t){if(t.isVisible()&&t.properties&&!t.background&&t.properties.hasOwnProperty("initialRa")&&t.properties.hasOwnProperty("initialDec")&&t.properties.hasOwnProperty("initialFov"))if(t.globe.getType()===o.GLOBE.Sky){var e=t.properties.initialFov?t.properties.initialFov:t.globe.getRenderContext().fov;i.getNavigation().zoomTo([t.properties.initialRa,t.properties.initialDec],{fov:e,duration:3e3})}else i.getNavigation().zoomTo([t.properties.initialRa,t.properties.initialDec],{distance:t.properties.initialFov,duration:3e3})});var r="background"===e.category?"backgroundLayer:add":"additionalLayer:add";return this.publish(r,e),e},p.prototype.removeLayer=function(e){var i=null,r=t.map(this.layers,function(t,i){if(t.ID===e)return i});if(r.length>0){var n=this.layers.splice(r[0],1);i=n[0];var a=this;i.unsubscribe("visibility:changed",function(t){if(t.isVisible()&&t.properties&&!t.background&&t.properties.hasOwnProperty("initialRa")&&t.properties.hasOwnProperty("initialDec")&&t.properties.hasOwnProperty("initialFov"))if(t.globe.getType()===o.GLOBE.Sky){var e=t.properties.initialFov?t.properties.initialFov:t.globe.getRenderContext().fov;a.getNavigation().zoomTo([t.properties.initialRa,t.properties.initialDec],{fov:e,duration:3e3})}else a.getNavigation().zoomTo([t.properties.initialRa,t.properties.initialDec],{distance:t.properties.initialFov,duration:3e3})}),s.create(o.SERVICE.PickingManager).removePickableLayer(i),i._detach()}return i},p.prototype.removeAllLayers=function(){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];this.removeLayer(e)}},p.prototype.addDraw=function(t){this.globe.addLayer(t)},p.prototype.removeDraw=function(t){this.globe.removeLayer(t)},p.prototype.initTouchNavigation=function(t){t.navigation.touch={inversed:this.globe.isSky(),zoomOnDblClick:!0};var e=this;window.addEventListener("orientationchange",function(){e.refresh()},!1)},p.prototype.refresh=function(){this.globe.refresh()},p.prototype.initCanvas=function(e){var i,r,n=t(e.parentElement);t(e.parentElement).find("#loading").show(),i=t(e).attr("width")?t(e).attr("width"):n.attr("width")?n.attr("width"):window.innerWidth,r=t(e).attr("height")?t(e).attr("height"):n.attr("height")?n.attr("height"):window.innerHeight,e.width=i,e.height=r,n&&n.css({position:"relative",overflow:"hidden"});var s,o=this,a=function(){n&&n.attr("height")&&n.attr("width")?(e.width=n.width(),e.height=n.height()):(e.width=window.innerWidth,e.height=window.innerHeight),o.refresh()};t(window).resize(function(){s&&clearTimeout(s),s=setTimeout(a,500)}),e.addEventListener("webglcontextlost",function(t){t.preventDefault(),document.getElementById("loading").style.display="none",document.getElementById("webGLContextLost").style.display="block"},!1)},p.prototype.initGlobeEvents=function(e){e&&(this.globe=e,new h(this.globe,{element:this.mizarConfiguration.attributionHandler&&this.mizarConfiguration.attributionHandler.element?this.mizarConfiguration.attributionHandler.element:"globeAttributions"}),this.mizarConfiguration.isMobile&&this.initTouchNavigation(options),this.positionTracker.attachTo(this.globe),this.elevationTracker.attachTo(this.globe));var i=this;this.subscribe("baseLayersError",function(e){t(i.canvas.parentElement).find("#loading").hide(),console.log("error")})},p.prototype.show=function(){this.navigation.start();for(var e in this.components)this.components.hasOwnProperty(e)&&this.components[e]&&t("#"+e).fadeIn(1e3)},p.prototype.showComponents=function(){for(var e in this.components)this.components.hasOwnProperty(e)&&this.components[e]&&t("#"+e).fadeIn(1e3)},p.prototype.hideComponents=function(e){for(var i in this.components)this.components.hasOwnProperty(i)&&t.inArray(i,e)===-1&&t("#"+i).fadeOut()},p.prototype.hide=function(){this.navigation.stopAnimations(),this.navigation.stop();for(var e in this.components)this.components.hasOwnProperty(e)&&t("#"+e).fadeOut()},p.prototype.setComponentVisibility=function(e,i){var r=t("#"+e);i?r.show():r.hide(),this.components[e]=i},p.prototype.showAdditionalLayers=function(){e.each(this.visibleLayers,function(t){t.setVisible(!0)})},p.prototype.hideAdditionalLayers=function(){var t=this;this.visibleLayers=[];var i=this.getAdditionalLayers();e.each(i,function(e){e.isVisible()&&(e.setVisible(!1),t.visibleLayers.push(e))})},p.prototype.setBackgroundLayer=function(t){var e=this.getLayerByName(t);return e?(this.globe.setBaseImagery(e),this.publish("backgroundLayer:change",e)):this.publish("backgroundSurveyError","Survey "+layerName+" hasn't been found"),e},p.prototype.setBackgroundLayerByID=function(t){var e=this.getLayerByID(t);return e&&this.globe.setBaseImagery(e),e},p.prototype.getAdditionalLayers=function(){return e.filter(this.layers,function(t){return"background"!==t.category})},p.prototype.getRenderContext=function(){return this.globe.getRenderContext()},p.prototype.disable=function(){for(var t=this.getRenderContext().renderers,e=0;e<t.length;e++)t[e].getType()===this.getMode()&&t[e].disable()},p.prototype.enable=function(){for(var t=this.getRenderContext().renderers,e=0;e<t.length;e++)t[e].getType()===this.getMode()&&t[e].enable()},p.prototype.setCompassVisible=function(t,e){throw"compass visible not implemented"},p.prototype.getMode=function(){return this.mode},p.prototype.setCoordinateSystem=function(t){throw"CRS not implemented"},p.prototype.getNavigation=function(){return this.navigation},p.prototype.getCoordinateSystem=function(){return this.globe.getCoordinateSystem()},p.prototype.addAnimation=function(t){this.globe.addAnimation(t)},p.prototype.removeAnimation=function(t){this.globe.removeAnimation(t)},p.prototype.render=function(){this.globe.render()},p.prototype.dispose=function(){this.globe.dispose()},p.prototype.destroy=function(){throw"destroy Not implemented"},p}),r("Tiling/TilePool",[],function(){var t=function(t){var e=t.gl,i={},r=[],n=this,s=e.getExtension("OES_texture_float_linear"),o=s?e.LINEAR:e.NEAREST;this.numCreatedTextures=0,this.numReusedTextures=0;var a=function(t,i){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),"byte"===t.dataType?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):(e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t.width,t.height,0,e.LUMINANCE,e.FLOAT,t.typedArray),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r.pool=i,n.numCreatedTextures++,r},l=function(t,i){var r=i.pop();return e.bindTexture(e.TEXTURE_2D,r),"byte"===t.dataType?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D)):e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t.width,t.height,0,e.LUMINANCE,e.FLOAT,t.typedArray),n.numReusedTextures++,r},h=function(t){var e=t.dataType+t.width;return i[e]||(i[e]=[]),i[e]};this.createGLTexture=function(t){var e=h(t);return e.length>0?l(t,e):a(t,e)},this.createGLBuffer=function(t){var i;return i=r.length>0?r.pop():e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),i},this.disposeGLTexture=function(t){t.pool.push(t)},this.disposeGLBuffer=function(t){r.push(t)},this.disposeAll=function(){var t;for(var n in i)if(i.hasOwnProperty(n)){var s=i[n];for(t=0;t<s.length;t++)e.deleteTexture(s[t])}for(i={},t=0;t<r.length;t++)e.deleteBuffer(r[t]);r.length=0}};return t}),r("Tiling/TileRequest",["./Tile","../Utils/ImageRequest"],function(t,e){var i=function(i){var r,n=!1,s=!0,o=new XMLHttpRequest;this.tile=null,this.elevations=null,this.image=null;var a=this,l=function(){a.elevations=i.elevationProvider.parseElevations(o.responseText),s=!0,n&&(i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame())},h=function(){a.elevations=null,s=!0,n&&(i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame())};o.onreadystatechange=function(t){4===o.readyState&&(200===o.status?l():h())};var u=function(){n||(n=!0,s&&(i.imageryProvider&&i.imageryProvider.handleImage&&i.imageryProvider.handleImage(r),i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame()),a.image=r.image)},c=function(){a.tile.state=t.State.ERROR,i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.availableRequests.push(a)},d=function(){a.tile.state=t.State.NONE,i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.availableRequests.push(a)};this.launch=function(l){if(l.state=t.State.LOADING,this.tile=l,i.pendingRequests.push(this),this.image=null,this.elevations=null,i.elevationProvider){s=!1,o.open("GET",i.elevationProvider.getUrl(l));var h="use-credentials"===i.elevationProvider.crossOrigin;o.withCredentials=h,o.send()}else s=!0;if(i.imageryProvider){r||(r=new e({successCallback:function(){u(),i.imageryProvider.cache&&i.imageryProvider.cache.storeInCache(a)},failCallback:c,abortCallback:d}));var p;i.imageryProvider.cache&&(p=p=i.imageryProvider.cache.getFromCache(l)),n=!1,p?(r.image=p.image,u()):r.send(i.imageryProvider.getUrl(l),i.imageryProvider.crossOrigin)}else n=!0;i.imageryProvider||i.elevationProvider||(i.pendingRequests.splice(i.pendingRequests.indexOf(this),1),i.completedRequests.push(this))},this.abort=function(){r&&r.abort()}};return i}),r("Tiling/TileIndexBuffer",[],function(){var t=function(t,e){this.renderContext=t,this.config=e,this.solidIndexBuffer=null,this.subSolidIndexBuffer=[null,null,null,null],this.subIndices=[null,null,null,null]};return t.prototype.reset=function(){for(var t=this.renderContext.gl,e=0;e<4;e++)this.subSolidIndexBuffer[e]&&(t.deleteBuffer(this.subSolidIndexBuffer[e]),this.subSolidIndexBuffer[e]=null);this.solidIndexBuffer&&(t.deleteBuffer(this.solidIndexBuffer),this.solidIndexBuffer=null)},t.prototype.getSubSolid=function(t){if(null===this.subSolidIndexBuffer[t]){var e,i,r=t%2,n=Math.floor(t/2),s=this.config.tesselation,o=(s-1)/2,a=[];for(e=o*n;e<o*(n+1);e++)for(i=o*r;i<o*(r+1);i++)a.push(e*s+i),a.push((e+1)*s+i),a.push(e*s+i+1),a.push(e*s+i+1),a.push((e+1)*s+i),a.push((e+1)*s+i+1);if(this.subIndices[t]=a,this.config.skirt){var l=0===n?s*s:s*s+4*s,h=0===n?0:o*s;for(e=o*r;e<o*(r+1);e++)a.push(l+e),a.push(h+e),a.push(l+e+1),a.push(l+e+1),a.push(h+e),a.push(h+e+1);for(l=0===n?s*s+4*s:s*s+s,h=0===n?o*s:(s-1)*s,e=o*r;e<o*(r+1);e++)a.push(h+e),a.push(l+e),a.push(h+e+1),a.push(h+e+1),a.push(l+e),a.push(l+e+1);for(l=0===r?s*s+2*s:s*s+5*s,h=0===r?0:o,i=o*n;i<o*(n+1);i++)a.push(l+i),a.push(l+i+1),a.push(h+i*s),a.push(h+i*s),a.push(l+i+1),a.push(h+(i+1)*s);for(l=0===r?s*s+5*s:s*s+3*s,h=0===r?o:s-1,i=o*n;i<o*(n+1);i++)a.push(i*s+h),a.push((i+1)*s+h),a.push(l+i),a.push(l+i),a.push((i+1)*s+h),a.push(l+i+1)}var u=this.renderContext.gl,c=u.createBuffer();u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,c),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),u.STATIC_DRAW),c.numIndices=a.length,this.subSolidIndexBuffer[t]=c}return this.subSolidIndexBuffer[t]},t.prototype.getSolid=function(){if(null===this.solidIndexBuffer){var t,e,i=this.config.tesselation,r=[];for(e=0;e<i-1;e++)for(t=0;t<i-1;t++)r.push(e*i+t),r.push((e+1)*i+t),r.push(e*i+t+1),r.push(e*i+t+1),r.push((e+1)*i+t),r.push((e+1)*i+t+1);if(this.config.skirt){var n=i*i;for(t=0;t<i-1;t++)r.push(n+t),r.push(t),r.push(n+t+1),r.push(n+t+1),r.push(t),r.push(t+1);for(n+=i,t=0;t<i-1;t++)r.push((i-1)*i+t),r.push(n+t),r.push((i-1)*i+t+1),r.push((i-1)*i+t+1),r.push(n+t),r.push(n+t+1);for(n+=i,e=0;e<i-1;e++)r.push(n+e),r.push(n+e+1),r.push(e*i),r.push(e*i),r.push(n+e+1),r.push((e+1)*i);for(n+=i,e=0;e<i-1;e++)r.push(e*i+i-1),r.push((e+1)*i+i-1),r.push(n+e),r.push(n+e),r.push((e+1)*i+i-1),r.push(n+e+1)}var s=this.renderContext.gl,o=s.createBuffer();s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),s.STATIC_DRAW),this.numIndices=r.length,this.solidIndexBuffer=o,this.solidIndexBuffer.numIndices=r.length}return this.solidIndexBuffer},t}),r("Tiling/TileManager",["./Tile","./GeoTiling","./TilePool","./TileRequest","./TileIndexBuffer","../Renderer/Program"],function(t,e,i,r,n,s){var o=function(t,o){this.parent=t,this.publishEvent=o.publishEvent,this.renderContext=this.parent.renderContext,this.tilePool=t.tilePool||new i(this.renderContext),this.tiling=new e(4,2),this.imageryProvider=null,this.elevationProvider=null,this.tilesToRender=[],this.visibleTiles=[],this.tilesToRequest=[],this.postRenderers=[];var a=this.renderContext.gl;this.defaultTexture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.defaultTexture);var l=o.defaultColor?o.defaultColor:[200,200,200,255],h=new Uint8Array(l);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,h),this.maxRequests=4,this.availableRequests=[];for(var u=0;u<this.maxRequests;u++)this.availableRequests[u]=new r(this);this.pendingRequests=[],this.completedRequests=[],this.level0TilesLoaded=!1,this.tileConfig={tesselation:9,skirt:!0,cullSign:1,imageSize:256,vertexSize:this.renderContext.lighting?6:3,normals:this.renderContext.lighting,coordinateSystem:this.parent.coordinateSystem},this.level0Tiles=this.tiling.generateLevelZeroTiles(this.tileConfig,this.tilePool),this.tcoordBuffer=null,this.tileIndexBuffer=new n(this.renderContext,this.tileConfig),this.renderTileWithoutTexture=!o.hasOwnProperty("renderTileWithoutTexture")||o.renderTileWithoutTexture,this.freeze=!1,this.numTilesGenerated=0,this.frameNumber=0,this.vertexShader="attribute vec3 vertex;\n",this.vertexShader+="attribute vec2 tcoord;\n",this.vertexShader+="uniform mat4 modelViewMatrix;\n",this.vertexShader+="uniform mat4 projectionMatrix;\n",this.vertexShader+="varying vec2 texCoord;\n",this.renderContext.lighting&&(this.vertexShader+="attribute vec3 normal;\nvarying vec3 color;\n"),this.vertexShader+="void main(void) \n",this.vertexShader+="{\n",this.vertexShader+="gl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",this.renderContext.lighting&&(this.vertexShader+="vec4 vn = modelViewMatrix * vec4(normal,0);\ncolor = max( vec3(-vn[2],-vn[2],-vn[2]), 0.0 );\n"),this.vertexShader+="texCoord = tcoord;\n",this.vertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="varying vec2 texCoord;\n",this.renderContext.lighting&&(this.fragmentShader+="varying vec3 color;\n"),this.fragmentShader+="uniform sampler2D colorTexture;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor.rgb = texture2D(colorTexture, texCoord).rgb;\n",this.renderContext.lighting&&(this.fragmentShader+="  gl_FragColor.rgb *= color;\n"),this.fragmentShader+="  gl_FragColor.a = 1.0;\n",this.fragmentShader+="}\n",this.program=new s(this.renderContext),this.program.createFromSource(this.vertexShader,this.fragmentShader)};o.prototype.addPostRenderer=function(t){this.postRenderers.push(t),this.postRenderers.sort(function(t,e){var i=0|t.zIndex,r=0|e.zIndex;return i-r}),t.generate&&this.visitTiles(function(e){t.generate(e)})},o.prototype.removePostRenderer=function(t){var e=this.postRenderers.indexOf(t);e!==-1&&(t.cleanupTile&&this.visitTiles(function(e){t.cleanupTile(e)}),this.postRenderers.splice(e,1))},o.prototype.setImageryProvider=function(t){this.reset(),this.imageryProvider=t,t&&(this.tilePool.disposeAll(),this.tiling=t.tiling,this.tileConfig.imageSize=t.tilePixelSize,this.level0Tiles=this.tiling.generateLevelZeroTiles(this.tileConfig,this.tilePool),t.customShader?(this.program.dispose(),this.program=new s(this.renderContext),this.currentFragmentShader=t.customShader.fragmentCode?t.customShader.fragmentCode:this.fragmentShader,this.program.createFromSource(t.customShader.vertexCode?t.customShader.vertexCode:this.vertexShader,this.currentFragmentShader)):null!==this.currentFragmentShader&&(this.program.dispose(),this.program=new s(this.renderContext),this.program.createFromSource(this.vertexShader,this.fragmentShader),this.currentFragmentShader=null))},o.prototype.setElevationProvider=function(t){this.reset(),this.elevationProvider=t;var e=t?t.tilePixelSize:9;if(e!==this.tileConfig.tesselation){this.tileConfig.tesselation=e;var i=this.renderContext.gl;this.tileIndexBuffer.reset(),i.deleteBuffer(this.tcoordBuffer),this.tcoordBuffer=null}},o.prototype.reset=function(){this.abortRequests();for(var t=0;t<this.level0Tiles.length;t++)this.level0Tiles[t].deleteChildren(this.renderContext,this.tilePool),this.level0Tiles[t].dispose(this.renderContext,this.tilePool);this.tileIndexBuffer.reset(),this.level0TilesLoaded=!1},o.prototype.abortRequests=function(){for(var t=this.pendingRequests.length-1;t>=0;t--)this.pendingRequests[t].abort()},o.prototype.visitTiles=function(t){for(var e=this.level0Tiles.concat([]);e.length>0;){var i=e.shift();t(i),i.children&&(e.push(i.children[0]),e.push(i.children[1]),e.push(i.children[2]),e.push(i.children[3]))}},o.prototype.traverseTiles=function(){this.tilesToRender.length=0,this.visibleTiles.length=0,this.tilesToRequest.length=0,this.numTraversedTiles=0;var e,i;if(!this.level0TilesLoaded){for(this.level0TilesLoaded=!0,e=0;e<this.level0Tiles.length;e++){i=this.level0Tiles[e];var r=i.state===t.State.LOADED;i.frameNumber=this.frameNumber,this.level0TilesLoaded=this.level0TilesLoaded&&r,r||(i.state===t.State.NONE?(i.state=t.State.REQUESTED,this.tilesToRequest.push(i)):i.state===t.State.ERROR&&this.imageryProvider&&this.publishEvent("baseLayersError",this.imageryProvider))}this.level0TilesLoaded&&this.imageryProvider&&this.publishEvent("baseLayersReady",this.imageryProvider)}if(this.level0TilesLoaded)for(e=0;e<this.level0Tiles.length;e++)i=this.level0Tiles[e],i.isCulled(this.renderContext)?i.deleteChildren(this.renderContext,this.tilePool):this.processTile(i,0)},o.prototype.processTile=function(e,i){this.numTraversedTiles++,e.frameNumber=this.frameNumber;var r=!0;if(e.state===t.State.NONE&&(e.state=t.State.REQUESTED,this.tilesToRequest.push(e)),e.state===t.State.LOADED&&(r=!!this.imageryProvider&&i>=this.imageryProvider.numberOfLevels,r|=!e.needsToBeRefined(this.renderContext)),r)(e.texture||this.renderTileWithoutTexture)&&this.tilesToRender.push(e),this.visibleTiles.push(e);else{null===e.children&&e.createChildren();for(var n=0;n<4;n++)e.children[n].isCulled(this.renderContext)?e.children[n].deleteChildren(this.renderContext,this.tilePool):this.processTile(e.children[n],i+1)}for(var s in e.extension)if(e.extension.hasOwnProperty(s)){var o=e.extension[s];o.traverse&&o.traverse(e,r)}},o.prototype.generateTile=function(t,e){t.generate(this.tilePool,e.image,e.elevations);for(var i=0;i<this.postRenderers.length;i++)this.postRenderers[i].generate&&this.postRenderers[i].generate(t);this.numTilesGenerated++,this.renderContext.requestFrame()},o.prototype.generateReceivedTiles=function(){for(;this.completedRequests.length>0;){var e=this.completedRequests.pop(),i=e.tile;i.frameNumber===this.frameNumber?this.generateTile(i,e):i.state=t.State.NONE,this.availableRequests.push(e)}this.availableRequests.length===this.maxRequests&&this.imageryProvider&&this.publishEvent("endBackgroundLoad")},o.prototype.renderTiles=function(){var e,i,r,n,o=this.renderContext,a=o.gl;if(this.tileConfig.cullSign<0)r=.2*this.tileConfig.coordinateSystem.geoide.radius,n=1.1*this.tileConfig.coordinateSystem.geoide.radius;else for(r=1e9,n=0,e=0;e<this.visibleTiles.length;e++)i=this.visibleTiles[e],r=Math.min(r,i.distance-1.5*i.radius),n=Math.max(n,i.distance+1.5*i.radius);if(o.near=Math.max(o.minNear,r),o.far=Math.max(o.minFar,n),0!==this.tilesToRender.length){this.tileConfig.cullSign<0?(a.depthMask(!1),a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE)):(a.enable(a.POLYGON_OFFSET_FILL),a.polygonOffset(0,4)),this.currentFragmentShader&&this.currentFragmentShader!==this.imageryProvider.customShader.fragmentCode&&(this.program.dispose(),this.program=new s(this.renderContext),this.imageryProvider&&this.imageryProvider.customShader&&(this.currentFragmentShader=this.imageryProvider.customShader.fragmentCode?this.imageryProvider.customShader.fragmentCode:this.fragmentShader,
this.program.createFromSource(this.imageryProvider.customShader.vertexShader?this.imageryProvider.customShader.vertexShader:this.vertexShader,this.currentFragmentShader))),this.program.apply();var l=this.program.attributes;mat4.perspective(o.fov,o.canvas.width/o.canvas.height,o.near,o.far,o.projectionMatrix),this.imageryProvider&&this.imageryProvider.customShader&&this.imageryProvider.customShader.updateUniforms(a,this.program),a.activeTexture(a.TEXTURE0),a.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,o.projectionMatrix),a.uniform1i(this.program.uniforms.colorTexture,0),this.tcoordBuffer||this.buildSharedTexCoordBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.tcoordBuffer),a.vertexAttribPointer(l.tcoord,2,a.FLOAT,!1,0,0);var h=null;for(e=0;e<this.tilesToRender.length;e++){i=this.tilesToRender[e];var u=i.state===t.State.LOADED,c=i.parentIndex===-1;i.texture?a.bindTexture(a.TEXTURE_2D,i.texture):a.bindTexture(a.TEXTURE_2D,this.defaultTexture),mat4.multiply(o.viewMatrix,i.matrix,o.modelViewMatrix),a.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,o.modelViewMatrix),a.bindBuffer(a.ARRAY_BUFFER,i.vertexBuffer),a.vertexAttribPointer(l.vertex,3,a.FLOAT,!1,4*this.tileConfig.vertexSize,0),this.tileConfig.normals&&a.vertexAttribPointer(l.normal,3,a.FLOAT,!1,4*this.tileConfig.vertexSize,12);var d=u||c?this.tileIndexBuffer.getSolid():this.tileIndexBuffer.getSubSolid(i.parentIndex);h!==d&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d),h=d),a.drawElements(a.TRIANGLES,h.numIndices,a.UNSIGNED_SHORT,0)}this.tileConfig.cullSign<0?(a.depthMask(!0),a.enable(a.DEPTH_TEST)):a.disable(a.POLYGON_OFFSET_FILL)}for(e=0;e<this.postRenderers.length;e++)this.postRenderers[e].render(this.visibleTiles)};var a=function(t,e){return t.distance-e.distance};return o.prototype.launchRequests=function(){this.tilesToRequest.sort(a);for(var e=this.tilesToRequest.length,i=0;i<e;i++){var r=this.tilesToRequest[i];if(this.availableRequests.length>0){this.availableRequests.length===this.maxRequests&&this.imageryProvider&&this.publishEvent("startBackgroundLoad");var n=this.availableRequests.pop();n.launch(r)}else r.state=t.State.NONE}},o.prototype.render=function(){if(!this.imageryProvider||this.imageryProvider._ready){if(!this.level0TilesLoaded&&this.imageryProvider&&this.imageryProvider.levelZeroImage){this.imageryProvider.generateLevel0Textures(this.level0Tiles,this.tilePool);for(var t=0;t<this.level0Tiles.length;t++){var e=this.level0Tiles[t];this.generateTile(e,{})}this.level0TilesLoaded=!0,this.publishEvent("baseLayersReady",this.parent.isSky())}var i=this.renderContext.stats;this.freeze||(i&&i.start("traverseTime"),this.traverseTiles(),i&&i.end("traverseTime")),!this.level0TilesLoaded&&this.imageryProvider||(i&&i.start("renderTime"),this.renderTiles(),i&&i.end("renderTime")),i&&i.start("generateTime"),this.generateReceivedTiles(),i&&i.end("generateTime"),i&&i.start("requestTime"),this.launchRequests(),i&&i.end("requestTime"),this.frameNumber++}},o.prototype.getVisibleTile=function(t,e){return this.tiling.findInsideTile(t,e,this.visibleTiles)},o.prototype.buildSharedTexCoordBuffer=function(){var t=this.tileConfig.tesselation,e=this.tileConfig.skirt,i=2*t*t;e&&(i+=2*t*6);var r,n,s,o,a=new Float32Array(i),l=1/(t-1),h=0;for(n=0,o=0;o<t;o++){for(r=0,s=0;s<t;s++)a[h]=r,a[h+1]=n,h+=2,r+=l;n+=l}if(e){for(r=0,n=0,s=0;s<t;s++)a[h]=r,a[h+1]=n,r+=l,h+=2;for(r=0,n=1,s=0;s<t;s++)a[h]=r,a[h+1]=n,r+=l,h+=2;for(r=0,n=0,s=0;s<t;s++)a[h]=r,a[h+1]=n,n+=l,h+=2;for(r=1,n=0,s=0;s<t;s++)a[h]=r,a[h+1]=n,n+=l,h+=2;for(r=0,n=.5,s=0;s<t;s++)a[h]=r,a[h+1]=n,r+=l,h+=2;for(r=.5,n=0,s=0;s<t;s++)a[h]=r,a[h+1]=n,n+=l,h+=2}var u=this.renderContext.gl,c=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,c),u.bufferData(u.ARRAY_BUFFER,a,u.STATIC_DRAW),this.tcoordBuffer=c},o.prototype.setFreeze=function(t){this.freeze=t},o.prototype.getFreeze=function(){return this.freeze},o}),r("Renderer/Frustum",["./glMatrix"],function(){var t=function(){this.normal=vec3.create([0,0,0]),this.d=0};t.prototype.init=function(t,e,i){var r=[],n=[];vec3.subtract(e,t,r),vec3.subtract(i,t,n),vec3.cross(r,n,this.normal),vec3.normalize(this.normal),this.d=-vec3.dot(t,this.normal)},t.prototype.transform=function(t){var e=[this.normal[0],this.normal[1],this.normal[2],this.d];mat4.multiplyVec4(t,e),this.normal[0]=e[0],this.normal[1]=e[1],this.normal[2]=e[2],this.d=e[3]},t.prototype.intersectSphere=function(t,e){var i=vec3.dot(t,this.normal)+this.d;return i>e?1:i<-e?-1:0},t.prototype.distance=function(t){return t[0]*this.normal[0]+t[1]*this.normal[1]+t[2]*this.normal[2]+this.d},t.prototype.intersectBoundingBox=function(t){var e=(this.normal[0]>=0?1:0)|(this.normal[1]>=0?2:0)|(this.normal[2]>=0?4:0),i=7&~e;return this.distance(t.getCorner(i))>0?1:this.distance(t.getCorner(e))<0?-1:0};var e=function(){this.planes=[new t,new t,new t,new t,new t]};return e.prototype.compute=function(t){var e=mat4.create();mat4.inverse(t,e);var i=mat4.project(e,[-1,-1,-1,1]),r=mat4.project(e,[-1,1,-1,1]),n=mat4.project(e,[1,1,-1,1]),s=mat4.project(e,[1,-1,-1,1]);this.planes[0].init([0,0,0],i,r),this.planes[1].init([0,0,0],r,n),this.planes[2].init([0,0,0],n,s),this.planes[3].init([0,0,0],s,i),this.planes[4].init(i,r,n)},e.prototype.transform=function(t,e){var i=mat4.create();mat4.inverse(e,i),this.inverseTransform(t,i)},e.prototype.inverseTransform=function(t,e){for(var i=0;i<t.planes.length;i++){var r=t.planes[i],n=r.normal[0],s=r.normal[1],o=r.normal[2],a=r.d;r=this.planes[i],r.normal[0]=e[0]*n+e[1]*s+e[2]*o+e[3]*a,r.normal[1]=e[4]*n+e[5]*s+e[6]*o+e[7]*a,r.normal[2]=e[8]*n+e[9]*s+e[10]*o+e[11]*a,r.d=e[12]*n+e[13]*s+e[14]*o+e[15]*a}},e.prototype.containsSphere=function(t,e){for(var i=1,r=0;r<this.planes.length;r++){var n=this.planes[r].normal,s=t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+this.planes[r].d;if(s<=e){if(s<-e)return-1;i=0}}return i},e.prototype.containsBoundingBox=function(t){for(var e=0;e<this.planes.length;e++){var i=this.planes[e],r=i.normal[0]>=0?t.max[0]:t.min[0],n=i.normal[1]>=0?t.max[1]:t.min[1],s=i.normal[2]>=0?t.max[2]:t.min[2],o=r*i.normal[0]+n*i.normal[1]+s*i.normal[2]+i.d;if(o<0)return!1}return!0},e.Plane=t,e}),r("Renderer/RenderContext",["./Frustum","./glMatrix"],function(t){var e=function(i){this.activeAnimations=[],this.shadersPath=i.shadersPath||"../shaders/",this.tileErrorTreshold=i.tileErrorTreshold||4,this.lighting=i.lighting||!1,this.continuousRendering=i.continuousRendering||!1,this.stats=null,this.isActive=!0;var r=null;if(!i.canvas)throw"Mizar : no canvas in options";if(r="string"==typeof i.canvas?$(i.canvas):i.canvas,!(r instanceof HTMLCanvasElement))throw"Mizar : invalid canvas";for(var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],s=null,o=0;o<n.length&&null===s;++o)try{s=r.getContext(n[o],e.contextAttributes)}catch(t){}if(null===s)throw"Mizar : WebGL context cannot be initialized";if(i.backgroundColor){var a=i.backgroundColor;s.clearColor(a[0],a[1],a[2],a[3])}else s.clearColor(0,0,0,1);s.getExtension("OES_element_index_uint"),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.enable(s.DEPTH_TEST),s.enable(s.CULL_FACE),this.viewMatrix=mat4.create(),this.modelViewMatrix=mat4.create(),this.projectionMatrix=mat4.create(),this.gl=s,this.canvas=r,this.frustum=new t,this.worldFrustum=new t,this.localFrustum=new t,this.eyePosition=vec3.create(),this.eyeDirection=vec3.create(),this.minNear=1e-4,this.minFar=i.minFar||0,this.near=e.minNear,this.far=6,this.numActiveAttribArray=0,this.frameRequested=!1,this.fov=45,this.renderers=[],window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}());var l=this;this.frameCallback=function(){l.frame()}};return e.contextAttributes={},e.prototype.requestFrame=function(){this.frameRequested||(window.requestAnimationFrame(this.frameCallback),this.frameRequested=!0)},e.prototype.deactivate=function(){this.isActive=!1,this.frameRequested=!1},e.prototype.activate=function(){this.isActive=!0},e.prototype.frame=function(){if(this.isActive){this.frameRequested=!1;var t,i=(this.stats,this.gl);if(this.stats&&this.stats.start("globalRenderTime"),this.activeAnimations.length>0){var r=Date.now();for(t=0;t<this.activeAnimations.length;t++)this.activeAnimations[t].update(r)}if(e.contextAttributes.stencil?i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT):i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),0===this.canvas.width||0===this.canvas.height)return;for(i.viewport(0,0,this.canvas.width,this.canvas.height),this.updateViewDependentProperties(),t=0;t<this.renderers.length;t++)this.renderers[t].render();this.stats&&this.stats.end("globalRenderTime"),this.continuousRendering?this.requestFrame():this.activeAnimations.length>0&&this.requestFrame()}},e.prototype.updateViewDependentProperties=function(){var t=mat4.create();mat4.inverse(this.viewMatrix,t),vec3.set([0,0,0],this.eyePosition),mat4.multiplyVec3(t,this.eyePosition),vec3.set([0,0,-1],this.eyeDirection),mat4.rotateVec3(t,this.eyeDirection),mat4.perspective(this.fov,this.canvas.width/this.canvas.height,this.minNear,this.far,this.projectionMatrix),this.frustum.compute(this.projectionMatrix),this.worldFrustum.inverseTransform(this.frustum,this.viewMatrix),this.pixelSizeVector=this.computePixelSizeVector()},e.prototype.getXYRelativeToCanvas=function(t){var e=[];t.pageX||t.pageY?(e[0]=t.pageX,e[1]=t.pageY):(e[0]=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e[1]=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);for(var i=this.canvas;i;)e[0]-=i.offsetLeft,e[1]-=i.offsetTop,i=i.offsetParent;return e},e.prototype.computePixelSizeVector=function(t){var e=this.canvas.width,i=this.canvas.height,r=this.projectionMatrix,n=t||this.viewMatrix,s=r[0]*e*.5,o=r[8]*e*.5+r[11]*e*.5,a=[n[0]*s+n[2]*o,n[4]*s+n[6]*o,n[8]*s+n[10]*o],l=r[5]*i*.5,h=r[9]*i*.5+r[11]*i*.5,u=[n[1]*l+n[2]*h,n[5]*l+n[6]*h,n[9]*l+n[10]*h],c=r[11],d=r[15],p=[n[2]*c,n[6]*c,n[10]*c,n[14]*c+n[15]*d],f=.7071067811/Math.sqrt(vec3.dot(a,a)+vec3.dot(u,u));return p[0]*=f,p[1]*=f,p[2]*=f,p[3]*=f,p},e.prototype.getPixelFrom3D=function(t,e,i){var r=mat4.create();mat4.multiply(this.projectionMatrix,this.viewMatrix,r);var n=[t,e,i,1];mat4.project(r,n);var s=Math.round(.5*(1+n[0])*this.canvas.width),o=Math.round(.5*(1-n[1])*this.canvas.height);return[s,o]},e.prototype.createNonPowerOfTwoTextureFromImage=function(t,e){var i=this.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),r},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getFov=function(){return this.fov},e.prototype.setFov=function(t){this.fov=t},e.prototype.getWorldFrustum=function(){return this.worldFrustum},e.prototype.getViewMatrix=function(){return this.viewMatrix},e.prototype.setViewMatrix=function(t){this.viewMatrix=t},e}),r("Globe/AbstractGlobe",["../Utils/Event","../Utils/Utils","../Tiling/TileManager","../Renderer/VectorRendererManager","../Renderer/Ray","../Renderer/GeoBound","../Crs/CoordinateSystemFactory","../Renderer/RenderContext","../Renderer/glMatrix"],function(t,e,i,r,n,s,o,a){function l(t){if(!t.coordinateSystem)throw new ReferenceError("coordinateSystem is not defined in "+JSON.stringify(t),"AbstractGLobe.js")}function h(t,e){var i;return i=e.isFlat()?t.planeIntersect([0,0,0],[0,0,1]):t.sphereIntersect([0,0,0],e.getGeoide().getRadius())}function u(t,e,i){if(e>=0){var r=i.getWorldFrom3D(t.computePoint(e)),n=i.getGeoBound();return!r||r[0]<n[0]||r[0]>n[2]||r[1]<n[1]||r[1]>n[3]||isNaN(r[0])||isNaN(r[1])?null:r}return null}var c=function(t,e){l(e),this.type=t,this.coordinateSystem=o.create(e.coordinateSystem),e.renderContext?this.renderContext=e.renderContext:this.renderContext=new a(e),this.publishEvent=e.publishEvent,this.isEnable=!0,this.sky=!0,this.continuousRendering=e.continuousRendering||!1,this.tileManager=new i(this,e),this.vectorRendererManager=new r(this),this.attributionHandler=null,this.baseImagery=null,this.preRenderers=[],this.nbCreatedLayers=0,this.tileManager.addPostRenderer(this.vectorRendererManager),this.renderContext.renderers.push(this),this.renderContext.requestFrame()};return c.prototype.getType=function(){return this.type},c.prototype.isSky=function(){return this.sky},c.prototype.dispose=function(){this.tileManager.tilePool.disposeAll(),this.tileManager.reset()},c.prototype.destroy=function(){this.dispose(),this.tileManager.removePostRenderer(this.vectorRendererManager),this.renderContext.renderers.splice(this.renderContext.renderers.indexOf(this.globe),1)},c.prototype.refresh=function(){this.renderContext.requestFrame()},c.prototype.setBaseImagery=function(t){throw"setBaseImagery Not implemented"},c.prototype.getBaseImagery=function(){return this.baseImagery},c.prototype.setBaseElevation=function(t){throw"setBaseElevation Not implemented"},c.prototype.getBaseElevation=function(){return this.tileManager.elevationProvider},c.prototype.addLayer=function(t){var e=this;t.url?$.ajax({url:t.url,success:function(i){t.addFeatureCollection(i),t.id=e.nbCreatedLayers,t._attach(e),e.renderContext.requestFrame(),e.nbCreatedLayers++,t.callback&&t.callback(i)}}):(t.id=this.nbCreatedLayers,t._attach(e),this.renderContext.requestFrame(),this.nbCreatedLayers++),this.publishEvent("layer:add",t)},c.prototype.removeLayer=function(t){t.background=!1,t._detach(),this.renderContext.requestFrame(),this.publishEvent("layer:remove",t)},c.prototype.addAnimation=function(t){t.renderContext=this.renderContext},c.prototype.removeAnimation=function(t){t.renderContext=null},c.prototype.getElevation=function(t,e){throw"getElevation Not implemented"},c.prototype.getViewportGeoBound=function(t){var e=this.renderContext,i=mat4.create();mat4.inverse(e.viewMatrix,i);var r=[i[12],i[13],i[14]];mat4.multiply(e.projectionMatrix,e.viewMatrix,i),mat4.inverse(i);for(var o=[[-1,-1,1,1],[1,-1,1,1],[-1,1,1,1],[1,1,1,1]],a=[0,0,0],l=0;l<4;l++){mat4.multiplyVec4(i,o[l]),vec3.scale(o[l],1/o[l][3]),vec3.subtract(o[l],r,o[l]),vec3.normalize(o[l]);var h=new n(r,o[l]),u=h.sphereIntersect(a,this.coordinateSystem.getGeoide().getRadius());if(u<0)return null;var c=h.computePoint(u);o[l]=this.coordinateSystem.from3DToGeo(c),t&&(o[l]=t(o[l]))}var d=new s;return d.computeFromCoordinates(o),d},c.prototype.getLonLatFromPixel=function(t,e){var i=n.createFromPixel(this.renderContext,t,e),r=h.call(this,i,this.coordinateSystem);return u.call(this,i,r,this.coordinateSystem)},c.prototype.getPixelFromLonLat=function(t,e){var i=vec3.create();return this.coordinateSystem.get3DFromWorld([t,e],i),this.renderContext.getPixelFrom3D(i[0],i[1],i[2])},c.prototype.render=function(){throw"render Not implemented"},c.prototype.setCoordinateSystem=function(t){this.coordinateSystem=t,this.tileManager.tileConfig.coordinateSystem=t,this.dispose(),this.tileManager.level0Tiles=this.tileManager.tiling.generateLevelZeroTiles(this.tileManager.tileConfig,this.tileManager.tilePool)},c.prototype.getCoordinateSystem=function(){return this.coordinateSystem},c.prototype.getRenderStats=function(){return"# rendered tiles : "+this.tileManager.tilesToRender.length},c.prototype.getRenderContext=function(){return this.renderContext},c.prototype.setRenderContext=function(t){this.renderContext=t},c.prototype.getTileManager=function(){return this.tileManager},c.prototype.isEnabled=function(){return this.isEnable},c.prototype.enable=function(){this.isEnable=!0},c.prototype.disable=function(){this.isEnable=!1},c}),r("Globe/Planet",["../Tiling/Tile","../Utils/Event","../Utils/Utils","./AbstractGlobe","../Utils/Constants"],function(t,e,i,r,n){var s=function(t){r.prototype.constructor.call(this,n.GLOBE.Planet,t),this.sky=!1};return i.inherits(r,s),s.prototype.setBaseImagery=function(t){this.baseImagery!==t&&(this.baseImagery&&(this.removeLayer(this.baseImagery),this.baseImagery=null),t&&(t._overlay=!1,t.background=!0,this.addLayer(t),this.baseImagery=t,t.setVisible(!0)),this.tileManager.setImageryProvider(t))},s.prototype.setBaseElevation=function(t){this.tileManager.elevationProvider&&this.removeLayer(this.tileManager.elevationProvider),this.tileManager.setElevationProvider(t),t&&(t._overlay=!1,this.addLayer(t))},s.prototype.getElevation=function(e,i){var r=this.tileManager.tiling;this.baseImagery&&(r=this.baseImagery.tiling);var n=this.tileManager.level0Tiles[r.lonlat2LevelZeroIndex(e,i)];return t.State&&n&&n.state===t.State.LOADED?n.getElevation(e,i):0},s.prototype.render=function(){if(this.isEnabled()){if(!this.coordinateSystem.isFlat())for(var t=0;t<this.preRenderers.length;t++)this.preRenderers[t].preRender();this.tileManager.render()}},s}),r("Globe/Sky",["../Tiling/TileManager","../Tiling/TilePool","../Utils/Utils","./AbstractGlobe","../Utils/Constants"],function(t,e,i,r,n){var s=function(i){r.prototype.constructor.call(this,n.GLOBE.Sky,i),this.sky=!0,this.tilePool=new e(this.renderContext),this.tileManagers={Equatorial:this.tileManager,Galactic:new t(this,i)},this.renderContext.requestFrame()};return i.inherits(r,s),s.prototype.dispose=function(){for(var t in this.tileManagers)this.tileManagers.hasOwnProperty(t)&&(this.tileManagers[t].tilePool.disposeAll(),this.tileManagers[t].reset())},s.prototype.setBaseImagery=function(t){this.baseImagery!==t&&(this.baseImagery&&(this.removeLayer(this.baseImagery),this.tileManagers[this.baseImagery.tiling.coordinateSystem.getGeoideName()].setImageryProvider(null),this.baseImagery=null),t&&(t._overlay=!1,t.background=!0,this.addLayer(t),this.tileManagers[t.tiling.coordinateSystem.getGeoideName()].setImageryProvider(t),this.baseImagery=t,t.setVisible(!0)))},s.prototype.render=function(){this.isEnabled()&&(this.tileManagers[n.CRS.Galactic].render(),this.tileManagers[n.CRS.Equatorial].render())},s}),r("Globe/GlobeFactory",["./Planet","./Sky","../Utils/Constants"],function(t,e,i){return{create:function(r,n){var s;switch(r){case i.GLOBE.Planet:s=new t(n);break;case i.GLOBE.Sky:s=new e(n);break;default:throw RangeError("The type "+r+" is not allowed, A valid type is included in the list GLOBE","GlobeFactory.js")}return s}}}),r("Navigation/GoogleMouseNavigationHandler",[],function(){var t=function(t){var e=null,i=-1,r=-1,n=-1,s=!1,o=!1,a=0,l=0,h=null,u=null,c=0,d=function(t){e.ctx.publish("startNavigation");var i,r,n;if(i="undefined"==typeof t.wheelDelta?t.detail:-t.wheelDelta/120,e.inertia||(n=e.ctx.getRenderContext().getXYRelativeToCanvas(t),r=e.ctx.getLonLatFromPixel(n[0],n[1])),e.zoom(i),e.stopAnimations(),e.inertia)e.inertia.launch("zoom",i<0?-1:1);else if(r){var s=e.ctx.getPixelFromLonLat(r[0],r[1]),o=n[0]-s[0],a=Math.round(e.ctx.getRenderContext().getCanvas().width/e.ctx.getRenderContext().getCanvas().height);a=a<1?1:a,o*=a;var l=n[1]-s[1];e.pan(o,l)}return t.preventDefault&&t.preventDefault(),t.returnValue=!1,e.ctx.publish("endNavigation"),e.ctx.getRenderContext().requestFrame(),!1},p=function(t){if(i=t.button,e.stopAnimations(),r=t.clientX,n=t.clientY,a=0,l=0,1===t.button)e.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABeUlEQVR42u2XS07DMBCGbaCCQstzy4YDcAGWCAE3YI3omsN0XcSaGxSEWHIBDsCGLY9SykM80m/CFLkhIBycVpVi6ZetUez/S2x5JtYMudkCYJQBbGJ+pBoIgMybQKUoijrW2hnGr+jNFyILQM+8jHkLc0Nv6OeIPflC+AJ8M++1rBA+AD+a/wfCB2Bczdtp5gmIqkK8hwSQt69gcNu3gJ6BRGyB7kG/QlAAOe3rSD5zFeO6cwj3ibVRC52hTmgA2YJJVUUgML5wAFbVXN78RRV0C+TZMVUZLWJ86QCsELsxn3v/oQp6CN02hZYwvnIAloldo2efhQqAAqAAGKl7IL4JpQDpWyA9F8iVHfwmjHMBZnd/yIbzJodcEGdDtInJ0S/1wA7DE5NDNozrATSLtjE7SKmI9hg20b3JoR74qogUYgvThnMIa8SOHfPgFVEaxAbmh5jvMj71Nc8CkISYRmvoHD36mmcFcCFKOhbDgf0XuHOH9mcUrHUBoVXvIfh2krcAAAAASUVORK5CYII=), auto";else{var o=e.ctx.getRenderContext().getXYRelativeToCanvas(t);h=e.ctx.getLonLatFromPixel(o[0],o[1]),0===t.button?e.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAZUlEQVR42sSTQQrAMAgEHcn/v7w9tYgNNsGW7kkI2TgbRZJ15NbU+waAAFV11MiXz0yq2sxMEiVCDDcHLeky8nQAUDJnM88IuyGOGf/n3wjcQ1zhf+xgxSS+PkXY7aQ9yvy+jccAMs9AI/bwo38AAAAASUVORK5CYII=), auto":e.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABeUlEQVR42u2XS07DMBCGbaCCQstzy4YDcAGWCAE3YI3omsN0XcSaGxSEWHIBDsCGLY9SykM80m/CFLkhIBycVpVi6ZetUez/S2x5JtYMudkCYJQBbGJ+pBoIgMybQKUoijrW2hnGr+jNFyILQM+8jHkLc0Nv6OeIPflC+AJ8M++1rBA+AD+a/wfCB2Bczdtp5gmIqkK8hwSQt69gcNu3gJ6BRGyB7kG/QlAAOe3rSD5zFeO6cwj3ibVRC52hTmgA2YJJVUUgML5wAFbVXN78RRV0C+TZMVUZLWJ86QCsELsxn3v/oQp6CN02hZYwvnIAloldo2efhQqAAqAAGKl7IL4JpQDpWyA9F8iVHfwmjHMBZnd/yIbzJodcEGdDtInJ0S/1wA7DE5NDNozrATSLtjE7SKmI9hg20b3JoR74qogUYgvThnMIa8SOHfPgFVEaxAbmh5jvMj71Nc8CkISYRmvoHD36mmcFcCFKOhbDgf0XuHOH9mcUrHUBoVXvIfh2krcAAAAASUVORK5CYII=), auto"}return s=!0,!1},f=function(t){return i=-1,!e.inertia||0===a&&0===l||(0===t.button?u?e.inertia.launch("rotate",u,0):e.inertia.launch("pan",a,l):1===t.button&&e.inertia.launch("rotate",-a,-l)),e.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAjElEQVR42pyRQRLAIAwCoePD8vT8jB7aONHRVuWagBuku2MmMxMAuDtnO2VmMDNJAgCQVOz0YSWbR4ZQnuWQC4cK2pLRSEoSJIHkp/nd0RFBnFMJUnkgiaAYGXrxmdeCfg2NmWxLXDWG2d15veUdhdRv7EO2A3YV+E3AKUVDsBKSXx+esEvC3dZ73QMAeuphLLn/cTIAAAAASUVORK5CYII=), auto",h=null,c=0,o&&e.ctx.publish("endNavigation"),s=!1,o=!1,!1},g=function(t){if(!(i<0)&&(a=t.clientX-r,l=t.clientY-n,0!==a||0!==l)){var d,p,f,g=!1;if(0===i)s&&(e.ctx.publish("startNavigation"),s=!1,o=!0),p=e.ctx.getRenderContext().getXYRelativeToCanvas(t),h&&(u=null,d=e.ctx.getLonLatFromPixel(p[0],p[1]),d&&(f=e.ctx.getPixelFromLonLat(h[0],h[1]),a=p[0]-f[0],l=p[1]-f[1],e.pan(a,l))),h&&d||(u=Math.abs(a)>Math.abs(l)?p[1]>e.ctx.getRenderContext().getCanvas().height/2?-a:a:p[0]>e.ctx.getRenderContext().getCanvas().width/2?l:-l,e.rotate(u,0),p=e.ctx.getRenderContext().getXYRelativeToCanvas(t),h=e.ctx.getLonLatFromPixel(p[0],p[1]),h&&(u=null)),e.ctx.getRenderContext().requestFrame(),g=!0;else if(1===i)e.rotate(-a,-l),e.ctx.getRenderContext().requestFrame(),g=!0;else{if(c++,c%3===0&&c>1){if(e.ctx.publish("startNavigation"),e.zoom(-l/10),l>0&&l>a&&h){p=[e.ctx.getRenderContext().getCanvas().clientLeft+e.ctx.getRenderContext().getCanvas().clientWidth/2,e.ctx.getRenderContext().getCanvas().clientTop+e.ctx.getRenderContext().getCanvas().clientHeight/2],f=e.ctx.getPixelFromLonLat(h[0],h[1]);var m=p[0]-f[0];m=10*m/100;var v=p[1]-f[1];v=10*v/100,e.pan(m,v)}e.stopAnimations(),e.ctx.publish("endNavigation"),e.ctx.getRenderContext().requestFrame()}g=!0}return r=t.clientX,n=t.clientY,g}},m=function(t){if(0===t.button){var i=e.ctx.getRenderContext().getXYRelativeToCanvas(t),r=e.ctx.getLonLatFromPixel(i[0],i[1]);r&&e.zoomTo(r)}},v=function(t){return t.preventDefault(),!1};this.install=function(t){e=t;var i=e.getRenderContext.getCanvas;i.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAjElEQVR42pyRQRLAIAwCoePD8vT8jB7aONHRVuWagBuku2MmMxMAuDtnO2VmMDNJAgCQVOz0YSWbR4ZQnuWQC4cK2pLRSEoSJIHkp/nd0RFBnFMJUnkgiaAYGXrxmdeCfg2NmWxLXDWG2d15veUdhdRv7EO2A3YV+E3AKUVDsBKSXx+esEvC3dZ73QMAeuphLLn/cTIAAAAASUVORK5CYII=), auto",
i.addEventListener("mousedown",p),i.addEventListener("mouseup",f),i.addEventListener("mousemove",g),i.addEventListener("contextmenu",v),i.addEventListener("dblclick",m),i.addEventListener("DOMMouseScroll",d),i.addEventListener("mousewheel",d)},this.uninstall=function(){var t=e.getRenderContext().getCanvas();t.style.cursor="auto",t.removeEventListener("mousedown",p),t.removeEventListener("mouseup",f),t.removeEventListener("mousemove",g),t.removeEventListener("contextmenu",v),t.removeEventListener("dblclick",m),t.removeEventListener("DOMMouseScroll",d),t.removeEventListener("mousewheel",d)}};return t}),r("Navigation/KeyboardNavigationHandler",[],function(){var t=function(t){var e=null,i=this;this.panFactor=10,this.zoomFactor=1,t&&(t.panFactor&&"number"==typeof t.panFactor&&(this.panFactor=t.panFactor),t.zoomFactor&&"number"==typeof t.zoomFactor&&(this.zoomFactor=t.zoomFactor));var r=function(t){return this.focus(),!1},n=function(t){switch(t.keyCode){case 32:e.stopAnimations();break;case 187:case 61:case 107:e.zoom(-i.zoomFactor);break;case 189:case 54:case 109:e.zoom(i.zoomFactor);break;case 81:case 37:t.shiftKey?e.rotate(i.panFactor,0):e.pan(i.panFactor,0);break;case 90:case 38:t.shiftKey?e.rotate(0,i.panFactor):e.pan(0,i.panFactor);break;case 68:case 39:t.shiftKey?e.rotate(-i.panFactor,0):e.pan(-i.panFactor,0);break;case 83:case 40:t.shiftKey?e.rotate(0,-i.panFactor):e.pan(0,-i.panFactor)}};this.install=function(i){if(e=i,t&&t.installOnDocument)document.addEventListener("keydown",n);else{var s=e.renderContext.canvas;s.addEventListener("keydown",n),s.tabIndex="0",s.addEventListener("mousedown",r)}},this.uninstall=function(){if(t&&t.installOnDocument)document.removeEventListener("keydown",n);else{var i=e.renderContext.canvas;i.removeEventListener("keydown",n),i.removeEventListener("mousedown",r)}}};return t}),r("Navigation/MouseNavigationHandler",[],function(){var t=function(t){var e=null,i=-1,r=-1,n=-1,s=0,o=0,a=t&&t.panButton||0,l=t&&t.rotateButton||1,h=t&&t.zoomOptions?t.zoomOptions:{},u=function(t){var i;return i=void 0===t.wheelDelta?t.detail:-t.wheelDelta/120,e.zoom(i),e.stopAnimations(),e.inertia&&e.inertia.launch("zoom",i<0?-1:1),t.preventDefault&&t.preventDefault(),t.returnValue=!1,!1},c=function(t){return document.addEventListener("mouseup",d),i=t.button,e.stopAnimations(),t.button!==a&&t.button!==l||(r=t.clientX,n=t.clientY,s=0,o=0,!1)},d=function(t){return i=-1,document.removeEventListener("mouseup",d),!e.inertia||0===s&&0===o||(t.button===a&&e.inertia.launch("pan",s,o),t.button===l&&e.inertia.launch("rotate",s,o)),t.button!==a&&t.button!==l||(t.preventDefault(),!1)},p=function(t){if(!(i<0)&&(s=t.clientX-r,o=t.clientY-n,0!==s||0!==o)){var h=!1;return i===a?(e.pan(s,o),h=!0):i===l&&(e.rotate(s,o),h=!0),r=t.clientX,n=t.clientY,h}},f=function(t){if(0===t.button){var i,r;i=e.ctx.getRenderContext().getXYRelativeToCanvas(t),r=e.ctx.getLonLatFromPixel(i[0],i[1]),r&&e.zoomTo(r,h)}};this.install=function(i){e=i;var r=e.renderContext.canvas;r.addEventListener("mousedown",c),r.addEventListener("mousemove",p),t&&t.zoomOnDblClick&&r.addEventListener("dblclick",f),r.addEventListener("DOMMouseScroll",u),r.addEventListener("mousewheel",u),r.addEventListener("dragstart",function(t){return t.preventDefault(),!1}),2===l&&r.addEventListener("contextmenu",function(t){return t.preventDefault(),!1},!1)},this.uninstall=function(){var i=e.renderContext.canvas;i.removeEventListener("mousedown",c),i.removeEventListener("mousemove",p),t&&t.zoomOnDblClick&&i.removeEventListener("dblclick",f),i.removeEventListener("DOMMouseScroll",u),i.removeEventListener("mousewheel",u)}};return t}),r("Navigation/TouchNavigationHandler",[],function(){var t={PAN:0,ROTATE:1,TILT:2,ZOOM:3},e=function(e){var i,r,n,s,o,a,l,h=null,u=[],c=[0,0,0,0],d=300,p=!(!e||!e.hasOwnProperty("inversed"))&&e.inversed,f=function(t,e){var i=e.clientY-t.clientY,r=e.clientX-t.clientX;return 180*Math.atan2(i,r)/Math.PI},g=function(t,e){return t.length>=2&&e.length>=2?f(e[1],e[0])-f(t[1],t[0]):0},m=function(t){if(r=t.touches,u=t.touches,c=[0,0,0,0],h.stopAnimations(),s=0,o=0,2===t.touches.length){var e=t.touches[0].clientX-t.touches[1].clientX,a=t.touches[0].clientY-t.touches[1].clientY;i=Math.sqrt(e*e+a*a),console.log("Finger distance : "+i),n=g(u,t.touches)}return t.preventDefault&&t.preventDefault(),t.returnValue=!1,!1},v=function(e){s=e.touches[0].clientX-r[0].clientX,o=e.touches[0].clientY-r[0].clientY;var a,d,f,m,v;if(1===e.touches.length)h.pan(s,o),c[t.PAN]++;else{var y=(e.touches[0].clientY-r[0].clientY)*(e.touches[1].clientY-r[1].clientY)>0;y?(h.rotate(0,-o),c[t.TILT]++):(f=g(u,e.touches),a=f-n,n=f,p&&(a*=-1),l=10*a,h.rotate(l,0),c[t.ROTATE]++),a=e.touches[0].clientX-e.touches[1].clientX,d=e.touches[0].clientY-e.touches[1].clientY,m=Math.sqrt(a*a+d*d),v=m-i;var b;b=p?m/i:i/m,0!==i&&(h.zoom(.025*v,b),c[t.ZOOM]++),h.getRenderContext().requestFrame(),i=m}return r=e.touches,e.preventDefault&&e.preventDefault(),e.returnValue=!1,!1},y=function(i){if(e&&e.zoomOnDblClick&&0===i.touches.length&&0===s&&0===o){var n=Date.now();if(n-a<d){var l=h.ctx.getLonLatFromPixel(r[0].clientX,r[0].clientY);l&&h.zoomTo(l)}a=n}if(r=i.touches,h.inertia&&(0!==s||0!==o)){var u=c.indexOf(Math.max.apply(this,c));u===t.PAN?h.inertia.launch("pan",s,o):u===t.ROTATE?console.log("Rotate not implemented in navigation"):u===t.TILT&&console.log("Tilt not implemented in navigation")}return i.preventDefault&&i.preventDefault(),i.returnValue=!1,!1};this.install=function(t){h=t;var e=h.renderContext.canvas;e.addEventListener("touchstart",m,!1),e.addEventListener("touchend",y,!1),e.addEventListener("touchmove",v,!1)},this.uninstall=function(){var t=h.renderContext.canvas;t.removeEventListener("touchstart",m,!1),t.removeEventListener("touchend",y,!1),t.removeEventListener("touchmove",v,!1)}};return e}),r("Navigation/NavigationHandlerFactory",["../Utils/Constants","./GoogleMouseNavigationHandler","./KeyboardNavigationHandler","./MouseNavigationHandler","./TouchNavigationHandler"],function(t,e,i,r,n){return{create:function(s,o){var a;switch(s){case t.HANDLER.GoogleMouse:a=new e(o);break;case t.HANDLER.Keyboard:a=new i(o);break;case t.HANDLER.Mouse:a=new r(o);break;case t.HANDLER.Touch:a=new n(o);break;default:throw RangeError("The type "+s+" is not allowed, A valid type is included in the list Constants.HANDLER","NavigationHandlerFactory.js")}return a}}}),r("Animation/AbstractAnimation",[],function(){var t=function(){this.startTime=-1,this.pauseTime=-1,this.renderContext=null};return t.prototype.getRenderContext=function(){return this.renderContext},t.prototype._unregisterActive=function(){var t=this.renderContext.activeAnimations.indexOf(this);t>=0&&this.renderContext.activeAnimations.splice(t,1)},t.prototype.getStatus=function(){return this.startTime===-1?"STOPPED":this.pauseTime===-1?"RUNNING":"PAUSED"},t.prototype.start=function(){if(this.renderContext&&(this.startTime===-1||this.pauseTime!==-1)){var t=Date.now();this.startTime===-1?this.startTime=t:(this.startTime+=t-this.pauseTime,this.pauseTime=-1),this.renderContext.activeAnimations.push(this),this.renderContext.requestFrame()}},t.prototype.pause=function(){this.renderContext&&this.startTime!==-1&&this.pauseTime===-1&&(this.pauseTime=Date.now(),this._unregisterActive(this))},t.prototype.stop=function(){this.startTime=-1,this.pauseTime=-1,this.onstop&&this.onstop(),this._unregisterActive(this)},t}),r("Animation/SegmentedAnimation",["../Utils/Utils","./AbstractAnimation","../Utils/Numeric"],function(t,e,i){var r=function(t){e.prototype.constructor.call(this),this.segments=[],this.duration=t.duration,this.valueSetter=t.valueSetter};t.inherits(e,r);var n=function(t,e,i,r,n){this.start=t,this.startValue=e,this.end=i,this.endValue=r,this.interpolator=n};return r.prototype.addSegment=function(t,e,i,r,s){for(var o=this.segments.length,a=0;a<o&&this.segments[a].end<=t;)a++;this.segments.splice(a,0,new n(t,e,i,r,s))},r.prototype.update=function(t){var e=i.map01(t,this.startTime,this.startTime+this.duration);if(e>=1){var r=this.segments.length-1;this.valueSetter(this.segments[r].endValue),this.stop()}else{for(var n=this.segments.length,s=0;s<n&&this.segments[s].end<e;)s++;s=Math.min(s,n-1),e=i.map01(e,this.segments[s].start,this.segments[s].end);var o=this.segments[s].interpolator(e,this.segments[s].startValue,this.segments[s].endValue);this.valueSetter(o)}},r}),r("Animation/PathAnimation",["../Utils/Utils","./AbstractAnimation","../Utils/Numeric","../Renderer/glMatrix"],function(t,e,i){var r=function(t){var i,r,n,s,o,a,l,h;for(e.prototype.constructor.call(this),this.globe=t.globe,this.speed=t.speed*this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3,this.nodes=[],i=0;i<t.coords.length;i++)l={position:this.globe.getCoordinateSystem().get3DFromWorld(t.coords[i]),velocity:null,distance:0},this.nodes.push(l),i>0&&(s=this.nodes[i].position[0]-this.nodes[i-1].position[0],o=this.nodes[i].position[1]-this.nodes[i-1].position[1],a=this.nodes[i].position[2]-this.nodes[i-1].position[2],this.nodes[i-1].distance=Math.sqrt(s*s+o*o+a*a));for(i=1;i<t.coords.length-1;i++)r=vec3.subtract(this.nodes[i+1].position,this.nodes[i].position,vec3.create()),n=vec3.subtract(this.nodes[i-1].position,this.nodes[i].position,vec3.create()),vec3.normalize(r),vec3.normalize(n),this.nodes[i].velocity=vec3.subtract(r,n,vec3.create()),vec3.normalize(this.nodes[i].velocity);h=vec3.subtract(this.nodes[1].position,this.nodes[0].position,vec3.create()),vec3.scale(h,3/this.nodes[0].distance),this.nodes[0].velocity=vec3.subtract(h,this.nodes[1].velocity,vec3.create()),vec3.scale(this.nodes[0].velocity,.5),i=t.coords.length-1,h=vec3.subtract(this.nodes[i].position,this.nodes[i-1].position,vec3.create()),vec3.scale(h,3/this.nodes[i-1].distance),this.nodes[i].velocity=vec3.subtract(h,this.nodes[i-1].velocity,vec3.create()),vec3.scale(this.nodes[i].velocity,.5),this.index=0,this.currentDistance=0,this.previousTime=-1,this.centerOffset=-.2,this.altitudeOffset=1e3;var u=this;t.setter?this.valueSetter=t.setter:this.valueSetter=function(e,i){var r,n=vec3.normalize(e,vec3.create());if(t.globe){var s=t.globe.getCoordinateSystem().getWorldFrom3D(e);s[2]=t.globe.getElevation(s[0],s[1])+u.altitudeOffset,r=t.globe.getCoordinateSystem().get3DFromWorld(s)}else r=e,r[2]+=u.altitudeOffset;var o=vec3.normalize(i,vec3.create()),a=vec3.add(r,o,vec3.create());vec3.add(a,vec3.scale(n,u.centerOffset,vec3.create())),mat4.lookAt(r,a,n,u.renderContext.getViewMatrix())}};return t.inherits(e,r),r.prototype.setSpeed=function(t){this.speed=parseFloat(t)*this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3},r.prototype.getSpeed=function(){return this.speed/(this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3)},r.prototype.setAltitudeOffset=function(t){this.altitudeOffset=parseFloat(t)},r.prototype.getAltitudeOffset=function(){return this.altitudeOffset},r.prototype.setDirectionAngle=function(t){this.centerOffset=Math.tan(parseFloat(t)*Math.PI/180)},r.prototype.start=function(){var t=-1;this.pauseTime!==-1&&(t=this.startTime),Animation.prototype.start.call(this),t!==-1?this.previousTime+=this.startTime-t:this.previousTime=-1},r.prototype.update=function(t){for(this.previousTime===-1?(this.index=0,this.currentDistance=0):this.currentDistance+=(t-this.previousTime)*this.speed,this.previousTime=t;this.currentDistance>=this.nodes[this.index].distance&&this.index<this.nodes.length-1;)this.currentDistance-=this.nodes[this.index].distance,this.index=this.index+1;if(this.index<this.nodes.length-1){var e=this.currentDistance/this.nodes[this.index].distance,r=this.nodes[this.index].position,n=this.nodes[this.index+1].position,s=vec3.scale(this.nodes[this.index].velocity,this.nodes[this.index].distance,vec3.create()),o=vec3.scale(this.nodes[this.index+1].velocity,this.nodes[this.index].distance,vec3.create()),a=i.cubicInterpolation(e,r,s,n,o),l=i.cubicInterpolationDerivative(e,r,s,n,o);this.valueSetter(a,l)}else this.index===this.nodes.length-1?this.valueSetter(this.nodes[this.index].position,this.nodes[this.index].velocity):this.stop()},r}),r("Animation/InertiaAnimation",["../Utils/Utils","./AbstractAnimation"],function(t,e){const i=.1,r=.95,n=.95,s=.5;var o=function(t){e.prototype.constructor.call(this),t&&(this.panFactor=t.hasOwnProperty("panFactor")?t.panFactor:r,this.rotateFactor=t.hasOwnProperty("rotateFactor")?t.rotateFactor:n,this.zoomFactor=t.hasOwnProperty("zoomFactor")?t.zoomFactor:s),this.type=null,this.dx=0,this.dy=0,this.navigation=t.nav,this.renderContext=t.nav.getRenderContext()};return t.inherits(e,o),o.prototype.update=function(t){var e=!1;switch(this.type){case"pan":this.navigation.pan(this.dx,this.dy),this.dx*=this.panFactor,this.dy*=this.panFactor,e=Math.abs(this.dx)<i&&Math.abs(this.dy)<i;break;case"rotate":this.navigation.rotate(this.dx,this.dy),this.dx*=this.rotateFactor,this.dy*=this.rotateFactor,e=Math.abs(this.dx)<i&&Math.abs(this.dy)<i;break;case"zoom":this.navigation.zoom(this.dx),this.dx*=this.zoomFactor,e=Math.abs(this.dx)<i}this.navigation.getRenderContext().requestFrame(),e&&this.stop()},o.prototype.launch=function(t,e,i){this.type=t,this.dx=e,this.dy=i,this.start()},o}),r("Animation/InterpolatedAnimation",["../Utils/Utils","./AbstractAnimation"],function(t,e){var i=function(t){e.prototype.constructor.call(this),this.values=[[0,t.startValue],[1,t.endValue]],this.duration=t.duration,this.interpolationFunction=t.interpolationFunction,this.setFunction=t.setFunction};return t.inherits(e,i),i.prototype.addValue=function(t,e){for(var i=this.values.length,r=0;r<i&&this.values[r][0]<t;)r++;this.values.splice(r,0,[t,e])},i.prototype.start=function(){Animation.prototype.start.call(this),this.setFunction(this.startValue)},i.prototype.stop=function(){Animation.prototype.stop.call(this),this.setFunction(this.endValue)},i.prototype.update=function(t){var e=Numeric.map01(t,this.startTime,this.startTime+this.duration);if(e>=1)return void this.stop();for(var i=this.values.length,r=0;r<i&&this.values[r][0]<e;)r++;r=Math.min(r,i-1);var n=Math.max(0,r-1);e=Numeric.map01(e,this.values[n][0],this.values[r][0]);var s=this.interpolationFunction(e,this.values[n][1],this.values[r][1]);this.setFunction(s)},i}),r("Animation/AnimationFactory",["../Utils/Constants","./SegmentedAnimation","./PathAnimation","./InertiaAnimation","./InterpolatedAnimation"],function(t,e,i,r,n){return{create:function(s,o){var a;switch(s){case t.ANIMATION.Inertia:a=new r(o);break;case t.ANIMATION.Interpolated:a=new n(o);break;case t.ANIMATION.Path:a=new i(o);break;case t.ANIMATION.Segmented:a=new e(o);break;default:throw RangeError("The type "+s+" is not allowed, A valid type is included in the list Constants.ANIMATION","AnimationFactory.js")}return a}}}),r("Navigation/AbstractNavigation",["../Utils/Utils","../Utils/Event","../Navigation/NavigationHandlerFactory","../Animation/AnimationFactory","../Utils/Numeric","../Utils/Constants","../Renderer/glMatrix"],function(t,e,i,r,n,s){function o(t){var e;if(t.inertia){var i=t.inertiaAnimation||{};i.nav=this,e=r.create(s.ANIMATION.Inertia,i)}else e=null;return e}function a(t){var e;return e=t.handlers?t.handlers:l.call(this,t)}function l(t){var e=[i.create(s.HANDLER.Mouse,t?t.mouse:null),i.create(s.HANDLER.Keyboard,t?t.keyboard:null)];return t.isMobile&&e.push(i.create(s.HANDLER.Touch,t?t.touch:null)),e}var h=function(t,i,r){e.prototype.constructor.call(this),this.type=t,this.ctx=i,this.renderContext=this.ctx.getRenderContext(),this.options=r||{},this.handlers=a.call(this,this.options),this.inertia=o.call(this,this.options),this.zoomToAnimation=null,this.start()};return t.inherits(e,h),h.prototype.getType=function(){return this.type},h.prototype.getOptions=function(){return this.options},h.prototype.start=function(){for(var t=0;t<this.handlers.length;t++)this.handlers[t].install(this)},h.prototype.stop=function(){for(var t=0;t<this.handlers.length;t++)this.handlers[t].uninstall()},h.prototype.stopAnimations=function(){this.inertia&&this.inertia.stop(),this.zoomToAnimation&&(this.zoomToAnimation.stop(),this.zoomToAnimation=null)},h.prototype.getFov=function(){var t=this.renderContext.getCanvas().width/this.renderContext.getCanvas().height;return[t*this.renderContext.getFov(),this.renderContext.getFov()]},h.prototype.moveUpTo=function(t,e){throw"moveUpTo not implemented"},h.prototype.getCenter=function(){return this.ctx.getLonLatFromPixel(.5*this.renderContext.getCanvas().width,.5*this.renderContext.getCanvas().height)},h.prototype.rotate=function(t,e){throw"rotate is not implemented"},h.prototype.pan=function(t,e){throw"pan is not implemented"},h.prototype.zoom=function(t,e){throw"zoom is not implemented"},h.prototype.zoomTo=function(t,e){throw"zoomTo is not implemented"},h.prototype.computeViewMatrix=function(){throw"computeViewMatrix not implemented"},h.prototype.toViewMatrix=function(t,e,i,o){var a=this,l=this.renderContext.getViewMatrix(),h=mat4.toMat3(l),u=quat4.fromRotationMatrix(h),c=mat4.toMat3(t),d=quat4.fromRotationMatrix(c),p=e||45;i=i||1e3;var f=[u,[l[12],l[13],l[14]],a.getRenderContext().getFov()],g=[d,[t[12],t[13],t[14]],p],m=r.create(s.ANIMATION.Segmented,{duration:i,valueSetter:function(t){var e=quat4.toMat4(t[0]),i=mat4.transpose(e);i[12]=t[1][0],i[13]=t[1][1],i[14]=t[1][2],a.renderContext.setViewMatrix(i),a.renderContext.setFov(t[2]),a.renderContext.requestFrame()}});m.addSegment(0,f,1,g,function(t,e,i){var r=n.easeOutQuad(t),s=quat4.create();quat4.slerp(e[0],i[0],r,s);var o=vec3.create();vec3.lerp(e[1],i[1],r,o);var a=n.lerp(r,e[2],i[2]);return[s,o,a]}),m.onstop=function(){o&&o()},this.ctx.addAnimation(m),m.start()},h.prototype.getRenderContext=function(){return this.renderContext},h.prototype.setRenderContext=function(t){this.renderContext=t},h}),r("Navigation/PlanetNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/glMatrix"],function(t,e,i,r,n){function s(t){t&&(this.geoCenter[0]=t[0],this.geoCenter[1]=t[1],this.distance=3===t.length?t[2]*this.ctx.getCoordinateSystem().getGeoide().getHeightScale():this.distance,this.distance<this.minDistance&&(this.minDistance=this.distance),this.distance>this.maxDistance&&(this.maxDistance=this.distance))}const o=1e3;var a=function(t,r){i.prototype.constructor.call(this,e.NAVIGATION.PlanetNavigation,t,r),this.minDistance=this.options.minDistance||0,this.maxDistance=this.options.maxDistance||3*this.ctx.getCoordinateSystem().getGeoide().getRadius()/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.minDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.maxDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.geoCenter=[0,0,0],this.heading=0,this.tilt=90,this.distance=this.maxDistance,this.inverseViewMatrix=mat4.create();var n=!this.options.hasOwnProperty("updateViewMatrix")||this.options.updateViewMatrix;s.call(this,this.options.initTarget),n&&this.computeViewMatrix()};return t.inherits(i,a),a.prototype.save=function(){return{geoCenter:this.geoCenter,heading:this.heading,tilt:this.tilt,distance:this.distance}},a.prototype.restore=function(t){this.geoCenter=t.geoCenter,this.heading=t.heading,this.tilt=t.tilt,this.distance=t.distance,this.computeViewMatrix()},a.prototype.zoomTo=function(t,i){var s=this,o=i&&i.distance?i.distance:this.distance/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),a=i&&i.duration?i.duration:5e3,l=i&&i.tilt?i.tilt:90,h=[this.geoCenter[0],this.geoCenter[1],this.distance,this.tilt],u=[t[0],t[1],o*this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),l];this.zoomToAnimation=new r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){s.geoCenter[0]=t[0],s.geoCenter[1]=t[1],s.distance=t[2],s.tilt=t[3],s.computeViewMatrix()}});var c=this.ctx.getCoordinateSystem().get3DFromWorld(this.geoCenter),d=this.ctx.getCoordinateSystem().get3DFromWorld(t),p=vec3.subtract(c,d),f=vec3.length(p),g=this.ctx.getRenderContext().canvas,m=Math.min(n.toRadian(45),n.toRadian(45*g.width/g.height)),v=1.1*(f/2/Math.tan(m/2));if(v>this.distance){var y=[.5*h[0]+.5*u[0],.5*h[1]+.5*u[1],v,l];this.zoomToAnimation.addSegment(0,h,.5,y,function(t,e,i){var r=n.easeInQuad(t),s=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2]),n.lerp(t,e[3],i[3])]}),this.zoomToAnimation.addSegment(.5,y,1,u,function(t,e,i){var r=n.easeOutQuad(t),s=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2]),n.lerp(t,e[3],i[3])]})}else this.zoomToAnimation.addSegment(0,h,1,u,function(t,e,i){var r=n.easeOutQuad(t),s=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2]),n.lerp(t,e[3],i[3])]});var b=this;this.zoomToAnimation.onstop=function(){i&&i.callback&&i.callback(),b.zoomToAnimation=null},this.ctx.addAnimation(this.zoomToAnimation),this.zoomToAnimation.start()},a.prototype.applyLocalRotation=function(t){mat4.rotate(t,this.heading*Math.PI/180,[0,0,1]),mat4.rotate(t,(90-this.tilt)*Math.PI/180,[1,0,0])},a.prototype.computeViewMatrix=function(){this.computeInverseViewMatrix(),mat4.inverse(this.inverseViewMatrix,this.renderContext.viewMatrix),this.ctx.publish("modifiedNavigation"),this.renderContext.requestFrame()},a.prototype.computeInverseViewMatrix=function(){this.ctx.getCoordinateSystem().getLHVTransform(this.geoCenter,this.inverseViewMatrix),this.applyLocalRotation(this.inverseViewMatrix),mat4.translate(this.inverseViewMatrix,[0,0,this.distance])},a.prototype.zoom=function(t,e){var i=this.distance;e?this.distance*=e:this.distance*=1+.1*t,this.distance>this.maxDistance&&(this.distance=this.maxDistance),this.distance<this.minDistance&&(this.distance=this.minDistance),this.computeViewMatrix(),this.hasCollision()&&(this.distance=i,this.computeViewMatrix())},a.prototype.hasCollision=function(){var t=[this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]],e=vec3.create();this.ctx.getCoordinateSystem().getWorldFrom3D(t,e);var i=this.ctx.getElevation(e[0],e[1]);return e[2]<i+o},a.prototype.pan=function(t,e){var i=vec3.create();vec3.set(this.geoCenter,i);var r=mat4.create(),n=this.ctx.getCoordinateSystem();n.getLocalTransform(this.geoCenter,r);var s=vec3.create(),o=vec3.create([0,1,0]);n.getUpVector(r,s),mat4.multiplyVec3(r,o,o),this.applyLocalRotation(r);var a=vec3.create(),l=vec3.create();n.getSideVector(r,a),n.getFrontVector(r,l),vec3.cross(s,a,l),vec3.cross(l,s,a),vec3.normalize(a,a),vec3.normalize(l,l),t/=this.renderContext.getCanvas().width,e/=this.renderContext.getCanvas().height;var h=vec3.create();n.get3DFromWorld(this.geoCenter,h),vec3.scale(a,t*this.distance,a),vec3.scale(l,e*this.distance,l),vec3.subtract(h,a,h),vec3.add(h,l,h),vec3.normalize(h),vec3.scale(h,n.getGeoide().getRadius()),n.getWorldFrom3D(h,this.geoCenter);var u=vec3.create([0,1,0]);n.getLocalTransform(this.geoCenter,r),mat4.multiplyVec3(r,u,u),vec3.dot(o,u)<0&&(this.heading=(this.heading+180)%360),this.computeViewMatrix(),this.hasCollision()&&(this.geoCenter=i,this.computeViewMatrix())},a.prototype.rotate=function(t,e){var i=this.heading,r=this.tilt;this.heading+=.1*t,this.tilt+=.1*e,this.computeViewMatrix(),this.hasCollision()&&(this.heading=i,this.tilt=r,this.computeViewMatrix())},a.prototype.getDistance=function(){return this.distance*this.ctx.getCoordinateSystem().getGeoide().getRealPlanetRadius()},a}),r("Navigation/AstroNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(t,e,i,r,n,s){function o(t){t&&(this.up=t)}function a(t){t&&(this.minFov>t?this.minFov=t:this.maxFov<t&&(this.maxFov=t),this.renderContext.setFov(t),this._clampFov())}function l(t){t&&this.ctx.getCoordinateSystem().get3DFromWorld(t,this.center3d)}var h=function(t,r){i.prototype.constructor.call(this,e.NAVIGATION.AstroNavigation,t,r),this.minFov=this.options.minFov||.001,this.maxFov=this.options.maxFov||100,this.center3d=[1,0,0],this.up=[0,0,1],l.call(this,this.options.initTarget),a.call(this,this.options.initFov),o.call(this,this.options.up),this.computeViewMatrix()};return t.inherits(i,h),h.prototype.zoomTo=function(t,i){var s=this,o=i&&i.fov?i.fov:2,a=i&&i.duration?i.duration:2e3,l=[],h=25;this.ctx.getCoordinateSystem().getWorldFrom3D(this.center3d,l);var u=[l[0],l[1],this.renderContext.getFov()],c=[t[0],t[1],o];Math.abs(t[0]-l[0])>180&&(l[0]<t[0]?u[0]+=360:c[0]+=360);var d=r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){var e=s.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);s.center3d[0]=e[0],s.center3d[1]=e[1],s.center3d[2]=e[2],s.ctx.getRenderContext().setFov(t[2]),s.computeViewMatrix()}}),p=this.ctx.getCoordinateSystem().get3DFromWorld(t);if(h>this.renderContext.getFov()&&this.renderContext.getWorldFrustum().containsSphere(p,.005)<0){var f=[.5*u[0]+.5*c[0],.5*u[1]+.5*c[1],h];d.addSegment(0,u,.5,f,function(t,e,i){var r=n.easeInQuad(t),s=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2])]}),d.addSegment(.5,f,1,c,function(t,e,i){var r=n.easeOutQuad(t),s=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2])]})}else d.addSegment(0,u,1,c,function(t,e,i){var r=n.easeOutQuad(t),s=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2])]});d.onstop=function(){i&&i.callback&&i.callback(),s.zoomToAnimation=null},this.ctx.addAnimation(d),d.start(),this.zoomToAnimation=d},h.prototype.moveTo=function(t,i,s){var o=this,a=i||5e3,l=[];this.ctx.getCoordinateSystem().getWorldFrom3D(this.center3d,l);var h=[l[0],l[1]],u=[t[0],t[1]];Math.abs(t[0]-l[0])>180&&(l[0]<t[0]?h[0]+=360:u[0]+=360);var c=r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){var e=o.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);o.center3d[0]=e[0],o.center3d[1]=e[1],o.center3d[2]=e[2],o.computeViewMatrix()}});c.addSegment(0,h,1,u,function(t,e,i){var r=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1])]}),c.onstop=function(){s&&s()},this.ctx.addAnimation(c),c.start()},h.prototype.moveUpTo=function(t,i){var s=[],o=[];this.ctx.getCoordinateSystem().getWorldFrom3D(this.up,s),this.ctx.getCoordinateSystem().getWorldFrom3D(t,o);var a=i||1e3,l=this,h=r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){var e=l.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);l.up[0]=e[0],l.up[1]=e[1],l.up[2]=e[2],l.computeViewMatrix()}});h.addSegment(0,s,1,o,function(t,e,i){var r=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1])]}),this.ctx.addAnimation(h),h.start()},h.prototype.computeViewMatrix=function(){vec3.normalize(this.center3d);var t=this.renderContext.getViewMatrix();mat4.lookAt([0,0,0],this.center3d,this.up,t),this.up=[t[1],t[5],t[9]],this.ctx.publish("modifiedNavigation"),this.renderContext.requestFrame()},h.prototype.zoom=function(t,e){e?this.renderContext.setFov(1*this.renderContext.getFov()/e):this.renderContext.setFov(this.renderContext.getFov()*(1+.1*t)),this._clampFov(),this.computeViewMatrix()},h.prototype.pan=function(t,e){var i=this.renderContext.getCanvas().width/2,r=this.renderContext.getCanvas().height/2,n=s.createFromPixel(this.renderContext,i-t,r-e);this.center3d=n.computePoint(n.sphereIntersect([0,0,0],this.ctx.getCoordinateSystem().getGeoide().getRadius())),this.computeViewMatrix()},h.prototype.rotate=function(t,e){var i=.1*t*Math.PI/180,r=quat4.fromAngleAxis(i,this.center3d);quat4.multiplyVec3(r,this.up),this.computeViewMatrix()},h.prototype._clampFov=function(){this.renderContext.getFov()>this.maxFov&&this.renderContext.setFov(this.maxFov),this.renderContext.getFov()<this.minFov&&this.renderContext.setFov(this.minFov)},h}),r("Navigation/FlatNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(t,e,i,r,n,s){function o(t){if(t){var e=this.ctx.getCoordinateSystem().get3DFromWorld(t);this.center[0]=e[0],this.center[1]=e[1],this.distance=3===t.length?t[2]*this.ctx.getCoordinateSystem().getGeoide().getHeightScale():this.distance,this.distance<this.minDistance&&(this.minDistance=this.distance),this.distance>this.maxDistance&&(this.maxDistance=this.distance)}}var a=function(t,r){i.prototype.constructor.call(this,e.NAVIGATION.FlatNavigation,t,r),this.minDistance=this.options.minDistance||6e4,this.maxDistance=this.options.maxDistance||5*this.ctx.getCoordinateSystem().getGeoide().getRadius()/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.minDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.maxDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.center=[0,0,0],this.distance=this.maxDistance,this.up=[0,1,0],o.call(this,this.options.initTarget),this.computeViewMatrix()};return t.inherits(i,a),a.prototype.save=function(){return{center:this.center,distance:this.distance,up:this.up}},a.prototype.restore=function(t){this.center=t.center,this.distance=t.distance,this.up=t.up,this.computeViewMatrix()},a.prototype.computeViewMatrix=function(){var t=[],e=this.renderContext.getViewMatrix();t=[this.center[0],this.center[1],this.distance],mat4.lookAt(t,this.center,this.up,e),this.up=[e[1],e[5],e[9]],this.ctx.publish("modifiedNavigation"),this.renderContext.requestFrame()},a.prototype.zoomTo=function(t,i){var s=this,o=i&&i.distance?i.distance:this.distance/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),a=i&&i.duration?i.duration:5e3,l=this.ctx.getCoordinateSystem().get3DFromWorld(t),h=[this.center[0],this.center[1],this.distance],u=[l[0],l[1],o*this.ctx.getCoordinateSystem().getGeoide().getHeightScale()];this.zoomToAnimation=r.create(e.ANIMATION.Segmented,{duration:a,valueSetter:function(t){s.center[0]=t[0],s.center[1]=t[1],s.distance=t[2],s.computeViewMatrix()}});var c=this.center,d=l,p=vec3.subtract(c,d),f=vec3.length(p),g=this.ctx.getRenderContext().getCanvas(),m=Math.min(n.toRadian(45),n.toRadian(45*g.width/g.height)),v=1.1*(f/2/Math.tan(m/2));if(v>this.distance){var y=[.5*h[0]+.5*u[0],.5*h[1]+.5*u[1],v];this.zoomToAnimation.addSegment(0,h,.5,y,function(t,e,i){var r=n.easeInQuad(t),s=n.easeOutQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2])]}),this.zoomToAnimation.addSegment(.5,y,1,u,function(t,e,i){var r=n.easeOutQuad(t),s=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2])]})}else this.zoomToAnimation.addSegment(0,h,1,u,function(t,e,i){var r=n.easeOutQuad(t),s=n.easeInQuad(t);return[n.lerp(r,e[0],i[0]),n.lerp(r,e[1],i[1]),n.lerp(s,e[2],i[2])]});var b=this;this.zoomToAnimation.onstop=function(){i&&i.callback&&i.callback(),b.zoomToAnimation=null},this.ctx.addAnimation(this.zoomToAnimation),this.zoomToAnimation.start()},a.prototype.zoom=function(t,e){var i=this.distance;e?this.distance*=e:this.distance*=1+.1*t,this.distance>this.maxDistance&&(this.distance=i),this.distance<this.minDistance&&(this.distance=i),this.computeViewMatrix()},a.prototype.pan=function(t,e){var i=this.renderContext.getCanvas().width/2,r=this.renderContext.getCanvas().height/2,n=this.ctx.getLonLatFromPixel(0,r);null===n&&t>0&&(t=0);var o=this.ctx.getLonLatFromPixel(this.renderContext.getCanvas().width,r);null===o&&t<0&&(t=0);var a=this.ctx.getLonLatFromPixel(i,0);null===a&&e>0&&(e=0);var l=this.ctx.getLonLatFromPixel(i,this.renderContext.getCanvas().height);if(null===l&&e<0&&(e=0),0!==t||0!==e){var h=s.createFromPixel(this.renderContext,i-t,r-e);this.center=h.computePoint(h.planeIntersect([0,0,0],[0,0,1])),this.computeViewMatrix()}},a.prototype.rotate=function(t,e){var i=.1*-t*Math.PI/180,r=quat4.fromAngleAxis(i,[0,0,1]);quat4.multiplyVec3(r,this.up),this.computeViewMatrix()},a.prototype.getDistance=function(){return this.distance*this.ctx.getCoordinateSystem().getGeoide().getRealPlanetRadius()},a}),r("Navigation/NavigationFactory",["./PlanetNavigation","./AstroNavigation","./FlatNavigation","../Utils/Constants"],function(t,e,i,r){return{create:function(n,s,o){
var a;switch(n){case r.NAVIGATION.AstroNavigation:a=new e(s,o);break;case r.NAVIGATION.PlanetNavigation:a=new t(s,o);break;case r.NAVIGATION.FlatNavigation:a=new i(s,o);break;default:throw new RangeError("The type "+n+" is not allowed, A valid type is included in the list NAVIGATION","NavigationFactory.js")}return a}}}),r("Context/PlanetContext",["jquery","underscore-min","../Utils/Utils","./AbstractContext","../Utils/Constants","../Globe/GlobeFactory","../Navigation/NavigationFactory","../Services/ServiceFactory"],function(t,e,i,r,n,s,o,a){function l(t,e){var i;return i=t?n.NAVIGATION.FlatNavigation:n.NAVIGATION.PlanetNavigation,o.create(i,this,e)}function h(t){var e=this;return{tileErrorTreshold:t.tileErrorTreshold||3,continuousRendering:t.continuousRendering||!1,renderContext:t.renderContext,canvas:this.canvas,coordinateSystem:t.coordinateSystem,shadersPath:this.mizarConfiguration.mizarAPIUrl+"shaders/",lighting:!1,backgroundColor:[0,0,0,1],minFar:0,defaultColor:[200,200,200,255],renderTileWithoutTexture:!0,publishEvent:function(t,i){e.publish(t,i)}}}function u(t){var e;return e=t.isFlat()?t.getWorldFrom3D(this.navigation.center):this.navigation.geoCenter}function c(t){var e={};return e.inertia=!!t.hasOwnProperty("inertia")&&t.inertia,t.hasOwnProperty("mouse")&&(e.mouse=t.mouse),e}function d(t,e,i,r){t.isFlat()?(this.navigation=o.create(n.NAVIGATION.FlatNavigation,this,r),this.navigation.center=t.get3DFromWorld(e)):(this.navigation=o.create(n.NAVIGATION.PlanetNavigation,this,r),this.navigation.geoCenter=e),this.navigation.distance=i*t.getGeoide().getHeightScale()}var p=function(t,e){r.prototype.constructor.call(this,t,n.CONTEXT.Planet,e);this.components={posTracker:!0,elevTracker:!0,compassDiv:!1};var i=h.call(this,e);try{this.globe=s.create(n.GLOBE.Planet,i),this.initGlobeEvents(this.globe),this.planetLayer=e.planetLayer,this.planetLayer&&(this.globe.addLayer(this.planetLayer),this.layers=this.layers.concat(this.planetLayer.layers),this.layers=this.layers.concat(this.planetLayer.baseImageries)),this.navigation=l.call(this,this.getCoordinateSystem().isFlat(),e.navigation),a.create(n.SERVICE.PickingManager).init(this)}catch(t){this._showUpError(this,t)}};return i.inherits(r,p),p.prototype.setCompassVisible=function(t,e){},p.prototype.setBaseElevation=function(t){this.globe.setBaseElevation(t),this.elevationTracker.setScaleLayer(t)},p.prototype.setCoordinateSystem=function(e){if(e.getType()!==this.getMode())throw"incompatible coordinate reference system with Planet context";var i,r,n=this;t(n.canvas.parentElement).find("#loading").show(),i=u.call(this,this.globe.getCoordinateSystem()),r=this.navigation.distance/this.globe.getCoordinateSystem().getGeoide().getHeightScale(),this.globe.setCoordinateSystem(e),this.navigation.stop();var s=c.call(this,this.navigation.getOptions());try{d.call(this,e,i,r,s)}catch(t){this._showUpError(this,t)}this.navigation.computeViewMatrix(),this.publish("modifiedCrs",e)},p.prototype.destroy=function(){this.hide(),this.elevationTracker&&this.elevationTracker.detach(),this.positionTracker&&this.positionTracker.detach(),this.planetLayer.setVisible(!1),this.planetLayer._detach(),this.removeAllLayers(),this.globe.destroy(),this.globe=null,this.layers=null,this.visibleLayers=null},p}),r("Gui/CompassCore",["jquery","../Utils/Constants"],function(t,e){function i(t){var i=[0,0,1],r=a.getCoordinateSystem(),n=[];r.from3DToGeo(i,n,!1),n=r.convert(n,r.getGeoideName(),e.CRS.Equatorial),r.fromGeoTo3D(n,i,!1),a.getNavigation().moveUpTo(i)}function r(){var t=[],i=a.getCoordinateSystem();i.from3DToGeo(a.getNavigation().center3d,t,!1),t=i.convert(t,e.CRS.Equatorial,i.getGeoideName());var r=[];i.getLHVTransform(t,r);var n=[],o=[r[4],r[5],r[6]],l=[r[8],r[9],r[10]],h=vec3.create(a.getNavigation().up);i.from3DToGeo(h,n,!1),n=i.convert(n,e.CRS.Equatorial,i.getGeoideName()),i.fromGeoTo3D(n,h,!1),vec3.normalize(h);var u=vec3.dot(h,o)/(vec3.length(h)*vec3.length(o)),c=Math.acos(u);if(!isNaN(c)){var d,p=180*c/Math.PI;vec3.cross(h,o,n),d=vec3.dot(n,[l[0],l[1],l[2]]),d<0&&(p*=-1);var f=s.getElementById("NorthText");f.setAttribute("transform","rotate("+p+" 40 40)")}}function n(){a.unsubscribe("modifiedNavigation",r),document.getElementById(o).innerHTML=""}var s,o=null,a=null;return{init:function(t){o=t.element,a=t.ctx,s=t.svgDoc},updateNorth:r,_alignWithNorth:i,remove:n}}),r("Gui/Compass",["jquery","./CompassCore"],function(t,e){var i,r=null,n=null,s=function(s){if(r=s.element,n=s.ctx,null===document.getElementById(r))return void console.log("Warning, the div specified ("+r+") do not exist");document.getElementById(r).innerHTML='<div id="objectCompass"></div>',t.get("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjw/eG1sLXN0eWxlc2hlZXQgdHlwZT0idGV4dC9jc3MiIGhyZWY9ImNvbXBhc3MuY3NzIj8+PHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgd2lkdGg9IjUyMCIKICAgaGVpZ2h0PSI1MjAiCiAgIGlkPSJzdmcyIgogICB2ZXJzaW9uPSIxLjEiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguMSByOTc2MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iY29tcGFzc05vcnRoMi5zdmciCiAgIHZpZXdCb3g9Ii0yMjAgLTIyMCA1MjAgNTIwIj4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE0NSI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGUgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGRlZnMKICAgICBpZD0iZGVmczQzIj4KICAgIDxyYWRpYWxHcmFkaWVudAogICAgICAgaWQ9ImdyYWQxIgogICAgICAgY3g9IjAiCiAgICAgICBjeT0iMCIKICAgICAgIHI9IjIwNyIKICAgICAgIGZ4PSIwIgogICAgICAgZnk9IjAiCiAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICAgIDxzdG9wCiAgICAgICAgIG9mZnNldD0iMC43NSIKICAgICAgICAgaWQ9InN0b3A2IgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTowIiAvPgogICAgICA8c3RvcAogICAgICAgICBvZmZzZXQ9IjAuOTQ5OTk5OTkiCiAgICAgICAgIGlkPSJzdG9wOCIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmOTkwMDtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3AKICAgICAgICAgb2Zmc2V0PSIxMDAlIgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjpyZ2IoMjU1LCAyNTUsIDI1NSk7c3RvcC1vcGFjaXR5OjAiCiAgICAgICAgIGlkPSJzdG9wMTAiIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50PgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEyODAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTAwMCIKICAgICBpZD0ibmFtZWR2aWV3NDEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjAuNDEzMTgxODMiCiAgICAgaW5rc2NhcGU6Y3g9IjEwMy43NDIwNiIKICAgICBpbmtzY2FwZTpjeT0iNDguNTQ5MDc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9IkVhc3QiCiAgICAgc2hvd2d1aWRlcz0idHJ1ZSIKICAgICBpbmtzY2FwZTpndWlkZS1iYm94PSJ0cnVlIj4KICAgIDxpbmtzY2FwZTpncmlkCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBpZD0iZ3JpZDMwMTAiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiCiAgICAgICBzbmFwdmlzaWJsZWdyaWRsaW5lc29ubHk9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPGcKICAgICBpZD0iT3V0ZXJDaXJjbGUiCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMS4xNDI4MTM4LDAsMCwxLjEwNTc4OCwwLjMwODI3MzYsNC42MTQ3ODQpIj4KICAgIDxnCiAgICAgICBpZD0iZzMyNjciCiAgICAgICBzdHlsZT0ib3BhY2l0eTowLjYiPgogICAgICA8Y2lyY2xlCiAgICAgICAgIHNvZGlwb2RpOnJ5PSIyMDciCiAgICAgICAgIHNvZGlwb2RpOnJ4PSIyMDciCiAgICAgICAgIHNvZGlwb2RpOmN5PSIwIgogICAgICAgICBzb2RpcG9kaTpjeD0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIGN4PSIwIgogICAgICAgICBkPSJtIDIwNywwIGMgMCwxMTQuMzIyOTQgLTkyLjY3NzA2LDIwNyAtMjA3LDIwNyAtMTE0LjMyMjk0LDAgLTIwNywtOTIuNjc3MDYgLTIwNywtMjA3IDAsLTExNC4zMjI5NCA5Mi42NzcwNiwtMjA3IDIwNywtMjA3IDExNC4zMjI5NCwwIDIwNyw5Mi42NzcwNiAyMDcsMjA3IHoiCiAgICAgICAgIGlkPSJjaXJjbGUyNCIKICAgICAgICAgcj0iMjA3IgogICAgICAgICBzdHlsZT0ib3BhY2l0eTowLjc1O2ZpbGw6dXJsKCNncmFkMSkiCiAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMTA1MjI3OSwwLDAsMS4xMDUyMjc5LDM0LDMyKSIgLz4KICAgIDwvZz4KICAgIDxnCiAgICAgICBpZD0iZzE4IgogICAgICAgc3R5bGU9InN0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxMCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuOTY1NTg4OTksMCwwLDAuOTcxMzI0MTUsMzQsMzIpIj4KICAgICAgPGNpcmNsZQogICAgICAgICByPSIyMTEiCiAgICAgICAgIGlkPSJjaXJjbGUyMCIKICAgICAgICAgZD0ibSAyMTEsMCBjIDAsMTE2LjUzMjA4IC05NC40Njc5MiwyMTEgLTIxMSwyMTEgLTExNi41MzIwOCwwIC0yMTEsLTk0LjQ2NzkyIC0yMTEsLTIxMSAwLC0xMTYuNTMyMDggOTQuNDY3OTIsLTIxMSAyMTEsLTIxMSAxMTYuNTMyMDgsMCAyMTEsOTQuNDY3OTIgMjExLDIxMSB6IgogICAgICAgICBjeD0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgc29kaXBvZGk6cng9IjIxMSIKICAgICAgICAgc29kaXBvZGk6cnk9IjIxMSIgLz4KICAgIDwvZz4KICA8L2c+CiAgPGcKICAgICBpZD0iU291dGgiCiAgICAgY2xhc3M9ImFycm93IgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM5LjU3ODM4MywzNi45NzA0MzUpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ciCiAgICAgICBkPSJNIDM5LjQxNiw5NS4xNiBDIDMzLjY1LDEwMy45NSAzMC43NiwxMTAuNSAyOC45MywxMTcuMTggMTUuMjQsMTEzLjQzIDEzLjU0LDEyNy4xNSAyMy4wNCwxMzEgMTMuNzEsMTQ1LjggNy44NCwxNzMuOTMgMCwyMTIgTCAwLDEwMyBhIDEwMywxMDMgMCAwIDAgMzkuNDE2LC03Ljg0IHoiIC8+CiAgICA8dXNlCiAgICAgICBoZWlnaHQ9IjQ0MCIKICAgICAgIHdpZHRoPSI0NDAiCiAgICAgICB5PSIwIgogICAgICAgeD0iMCIKICAgICAgIGlkPSJzb3V0aCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwxLDIsMCkiCiAgICAgICB4bGluazpocmVmPSIjSGFsZkFycm93IiAvPgogIDwvZz4KICA8ZwogICAgIGlkPSJFYXN0IgogICAgIGNsYXNzPSJhcnJvdyIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLDEsLTEsMCwzOC44MDYyMSwzNy4yMjA0MjkpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ctNiIKICAgICAgIGQ9Ik0gMzkuNDE2LDk1LjE2IEMgMzMuNjUsMTAzLjk1IDMwLjc2LDExMC41IDI4LjkzLDExNy4xOCAxNS4yNCwxMTMuNDMgMTMuNTQsMTI3LjE1IDIzLjA0LDEzMSAxMy43MSwxNDUuOCA3Ljg0LDE3My45MyAwLDIxMiBMIDAsMTAzIGEgMTAzLDEwMyAwIDAgMCAzOS40MTYsLTcuODQgeiIgLz4KICAgIDx1c2UKICAgICAgIGhlaWdodD0iNDQwIgogICAgICAgd2lkdGg9IjQ0MCIKICAgICAgIHk9IjAiCiAgICAgICB4PSIwIgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIKICAgICAgIGlkPSJzb3V0aC01IgogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTEsMCwwLDEsMiwwKSIKICAgICAgIHhsaW5rOmhyZWY9IiNIYWxmQXJyb3ctNiIgLz4KICA8L2c+CiAgPGcKICAgICBpZD0iTm9ydGgiCiAgICAgY2xhc3M9ImFycm93IgogICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwtMSw0MS45MDI3OCw0My43ODMzNzYpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ctNi0wIgogICAgICAgZD0iTSAzOS40MTYsOTUuMTYgQyAzMy42NSwxMDMuOTUgMzAuNzYsMTEwLjUgMjguOTMsMTE3LjE4IDE1LjI0LDExMy40MyAxMy41NCwxMjcuMTUgMjMuMDQsMTMxIDEzLjcxLDE0NS44IDcuODQsMTczLjkzIDAsMjEyIEwgMCwxMDMgYSAxMDMsMTAzIDAgMCAwIDM5LjQxNiwtNy44NCB6IiAvPgogICAgPHVzZQogICAgICAgaGVpZ2h0PSI0NDAiCiAgICAgICB3aWR0aD0iNDQwIgogICAgICAgeT0iMCIKICAgICAgIHg9IjAiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmIgogICAgICAgaWQ9InNvdXRoLTUtNiIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwxLDIsMCkiCiAgICAgICB4bGluazpocmVmPSIjSGFsZkFycm93LTYtMCIgLz4KICA8L2c+CiAgPGcKICAgICBpZD0iV2VzdCIKICAgICBjbGFzcz0iYXJyb3ciCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMCwtMSwxLDAsMzcuMzc0NzU4LDM5LjU0NzAyMykiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7c3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjEiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgaWQ9IkhhbGZBcnJvdy02LTAtNSIKICAgICAgIGQ9Ik0gMzkuNDE2LDk1LjE2IEMgMzMuNjUsMTAzLjk1IDMwLjc2LDExMC41IDI4LjkzLDExNy4xOCAxNS4yNCwxMTMuNDMgMTMuNTQsMTI3LjE1IDIzLjA0LDEzMSAxMy43MSwxNDUuOCA3Ljg0LDE3My45MyAwLDIxMiBMIDAsMTAzIGEgMTAzLDEwMyAwIDAgMCAzOS40MTYsLTcuODQgeiIgLz4KICAgIDx1c2UKICAgICAgIGhlaWdodD0iNDQwIgogICAgICAgd2lkdGg9IjQ0MCIKICAgICAgIHk9IjAiCiAgICAgICB4PSIwIgogICAgICAgaWQ9InNvdXRoLTUtNi0yIgogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTEsMCwwLDEsMiwwKSIKICAgICAgIHhsaW5rOmhyZWY9IiNIYWxmQXJyb3ctNi0wLTUiIC8+CiAgPC9nPgogIDx0ZXh0CiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjkwcHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpib2xkO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpzdGFydDtsaW5lLWhlaWdodDoxMjkuOTk5OTk1MjMlO2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiNmZjdmMmE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7Zm9udC1mYW1pbHk6VGltZXMgTmV3IFJvbWFuOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246J1RpbWVzIE5ldyBSb21hbiwgQm9sZCciCiAgICAgeD0iMTkuMjU0ODc1IgogICAgIHk9Ii0xNjMuMDY2NzYiCiAgICAgaWQ9Ik5vcnRoVGV4dCIKICAgICBzb2RpcG9kaTpsaW5lc3BhY2luZz0iMTMwJSIKICAgICB0cmFuc2Zvcm09InNjYWxlKDEuMDA4MzY2NSwwLjk5MTcwMjkyKSI+PHRzcGFuCiAgICAgICBzb2RpcG9kaTpyb2xlPSJsaW5lIgogICAgICAgaWQ9InRzcGFuMzAyNCIKICAgICAgIHg9IjE5LjI1NDg3NSIKICAgICAgIHk9Ii0xNjMuMDY2NzYiCiAgICAgICBzdHlsZT0iZm9udC1zaXplOjgwcHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpib2xkO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpzdGFydDtsaW5lLWhlaWdodDoxMjkuOTk5OTk1MjMlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiNmZjdmMmE7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjFweDtmb250LWZhbWlseTpUaW1lcyBOZXcgUm9tYW47LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonVGltZXMgTmV3IFJvbWFuLCBCb2xkJyI+TjwvdHNwYW4+PC90ZXh0PgogIDxnCiAgICAgaWQ9IklubmVyQ2lyY2xlIgogICAgIHN0eWxlPSJvcGFjaXR5OjAuNiIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzOS4yNjA3MjYsNDEuMjEwMTIxKSI+CiAgICA8ZwogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6OCIKICAgICAgIGlkPSJnNyI+CiAgICAgIDxjaXJjbGUKICAgICAgICAgc29kaXBvZGk6cng9Ijc1IgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIGN4PSIwIgogICAgICAgICBkPSJNIDc1LDAgQyA3NSw0MS40MjEzNTYgNDEuNDIxMzU2LDc1IDAsNzUgLTQxLjQyMTM1Niw3NSAtNzUsNDEuNDIxMzU2IC03NSwwIGMgMCwtNDEuNDIxMzU2IDMzLjU3ODY0NCwtNzUgNzUsLTc1IDQxLjQyMTM1NiwwIDc1LDMzLjU3ODY0NCA3NSw3NSB6IgogICAgICAgICBpZD0iY2lyY2xlOSIKICAgICAgICAgcj0iNzUiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBzb2RpcG9kaTpyeT0iNzUiIC8+CiAgICA8L2c+CiAgICA8ZwogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzFiMWIxYjtzdHJva2Utd2lkdGg6MSIKICAgICAgIGlkPSJnMTEiPgogICAgICA8Y2lyY2xlCiAgICAgICAgIHNvZGlwb2RpOnJ5PSI3MSIKICAgICAgICAgc29kaXBvZGk6cng9IjcxIgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgc29kaXBvZGk6Y3g9IjAiCiAgICAgICAgIGN5PSIwIgogICAgICAgICBjeD0iMCIKICAgICAgICAgZD0iTSA3MSwwIEMgNzEsMzkuMjEyMjE3IDM5LjIxMjIxNyw3MSAwLDcxIC0zOS4yMTIyMTcsNzEgLTcxLDM5LjIxMjIxNyAtNzEsMCBjIDAsLTM5LjIxMjIxNyAzMS43ODc3ODMsLTcxIDcxLC03MSAzOS4yMTIyMTcsMCA3MSwzMS43ODc3ODMgNzEsNzEgeiIKICAgICAgICAgaWQ9ImNpcmNsZTEzIgogICAgICAgICByPSI3MSIgLz4KICAgICAgPGNpcmNsZQogICAgICAgICBzb2RpcG9kaTpyeT0iNzkiCiAgICAgICAgIHNvZGlwb2RpOnJ4PSI3OSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjAiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBjeT0iMCIKICAgICAgICAgY3g9IjAiCiAgICAgICAgIGQ9Ik0gNzksMCBDIDc5LDQzLjYzMDQ5NSA0My42MzA0OTUsNzkgMCw3OSAtNDMuNjMwNDk1LDc5IC03OSw0My42MzA0OTUgLTc5LDAgYyAwLC00My42MzA0OTUgMzUuMzY5NTA1LC03OSA3OSwtNzkgNDMuNjMwNDk1LDAgNzksMzUuMzY5NTA1IDc5LDc5IHoiCiAgICAgICAgIGlkPSJjaXJjbGUxNSIKICAgICAgICAgcj0iNzkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K",function(a){i=document.importNode(a.documentElement,!0),i.height.baseVal.value=100,i.width.baseVal.value=100,t("#objectCompass").append(i),s.svgDoc=i,e.init(s),o(),n.publish("modifiedNavigation"),t("#"+r).css("display","block")},"xml");var o=function(){var t=i.getElementById("East"),r=i.getElementById("West"),o=i.getElementById("South"),a=i.getElementById("North"),l=i.getElementById("NorthText"),h=i.getElementById("OuterCircle"),u=s.panFactor?s.panFactor:30,c=-1,d=-1,p=0,f=0,g=!1,m=h.ownerSVGElement.clientWidth/2,v=function(t){t.preventDefault(),t.type.search("touch")>=0&&(t.layerX=t.changedTouches[0].clientX,t.layerY=t.changedTouches[0].clientY),g=!0,c=t.layerX-m,d=t.layerY-m,p=0,f=0};i.addEventListener("mousedown",v);var y=function(t){if(t.preventDefault(),t.type.search("touch")>=0&&(t.layerX=t.changedTouches[0].clientX,t.layerY=t.changedTouches[0].clientY),g){var i=c*(t.layerY-m)-d*(t.layerX-m);n.getNavigation().rotate(i,0),c=t.layerX-m,d=t.layerY-m,e.updateNorth()}};i.addEventListener("mousemove",y);var b=function(t){t.preventDefault(),g=!1};i.addEventListener("mouseup",b),t.addEventListener("click",function(){n.getNavigation().pan(u,0),e.updateNorth()}),r.addEventListener("click",function(){n.getNavigation().pan(-u,0),e.updateNorth()}),a.addEventListener("click",function(){n.getNavigation().pan(0,u),e.updateNorth()}),o.addEventListener("click",function(){n.getNavigation().pan(0,-u),e.updateNorth()}),l.addEventListener("click",e._alignWithNorth),s.isMobile&&(i.addEventListener("touchstart",v),i.addEventListener("touchup",b),i.addEventListener("touchmove",y),l.addEventListener("touchstart",e._alignWithNorth)),n.subscribe("modifiedNavigation",e.updateNorth),n.subscribe("modifiedCrs",e.updateNorth)}};return s.prototype.remove=e.remove,s}),r("Context/SkyContext",["underscore-min","../Utils/Utils","./AbstractContext","../Globe/GlobeFactory","../Navigation/NavigationFactory","../Services/ServiceFactory","../Gui/Compass","../Utils/Constants"],function(t,e,i,r,n,s,o,a){function l(t){var e=this,i={canvas:this.canvas,tileErrorTreshold:t.tileErrorTreshold||1.5,continuousRendering:t.continuousRendering||!0,renderTileWithoutTexture:!1,radius:t.radius||10,minFar:t.minFar||15,coordinateSystem:t.coordinateSystem,lighting:!1,backgroundColor:[0,0,0,1],defaultColor:[200,200,200,255],shadersPath:this.mizarConfiguration.mizarAPIUrl+"shaders/",publishEvent:function(t,i){e.publish(t,i)}};return t.renderContext&&(i.renderContext=t.renderContext),i}var h=function(t,e){i.prototype.constructor.call(this,t,a.CONTEXT.Sky,e);this.components={posTracker:!0,elevTracker:!1,compassDiv:!0};var o=l.call(this,e);try{this.globe=r.create(a.GLOBE.Sky,o),this.initGlobeEvents(this.globe),this.navigation=n.create(a.NAVIGATION.AstroNavigation,this,e.navigation?e.navigation:e),s.create(a.SERVICE.PickingManager).init(this),this.setCompassVisible(e.compass&&this.components.compassDiv?e.compass:"compassDiv",!0)}catch(t){this._showUpError(this,t)}};return e.inherits(i,h),h.prototype.setCompassVisible=function(t,e){e?this.compass=new o({element:t,ctx:this}):this.compass&&this.compass.remove(),this.setComponentVisibility(t,e)},h.prototype.setCoordinateSystem=function(t){if(t.getType()!==this.getMode())throw"incompatible coordinate reference system with Sky context";this.globe.setCoordinateSystem(t),this.publish("modifiedCrs",t)},h.prototype.destroy=function(){this.hide(),this.compass.setCompassVisible(!1),this.elevationTracker&&this.elevationTracker.detach(),this.positionTracker&&this.positionTracker.detach(),this.removeAllLayers(),this.globe.destroy(),this.globe=null,this.layers=null,this.visibleLayers=null},h}),r("Context/ContextFactory",["../Utils/Constants","./PlanetContext","./SkyContext"],function(t,e,i){return{create:function(r,n,s){var o;switch(r){case t.CONTEXT.Planet:o=new e(n,s);break;case t.CONTEXT.Sky:o=new i(n,s);break;default:throw RangeError("The type "+r+" is not allowed, A valid type is included in the list Constants.CONTEXT","ContextFactory.js")}return o}}}),r("Provider/AbstractProvider",["jquery"],function(t){var e=function(t){this.options=t};return e.prototype.loadFiles=function(t,e){},e.prototype.handleFeatures=function(t){},e}),r("Provider/ConstellationProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Utils","../Utils/Constants"],function(t,e,i,r,n){function s(t){for(var e=a.split("\n"),i=l.split("\n"),r=0;r<i.length;r++){var s=i[r].replace("  "," ");s=s.split(" ");var o=parseFloat(s[0]),h=parseFloat(s[1]),c=s[2];s[3];if(o*=15,!u[c])for(var d=0;d<e.length;d++){s=e[d].split(";");var p=s[0];if(p===c){var f=s[1];u[c]={coord:[],name:f,x:0,y:0,z:0,nbStars:0};break}}var g=[o,h],m=[];t.globe.getCoordinateSystem().get3DFromWorldInCrs(g,n.CRS.Equatorial,m),u[c].x+=m[0],u[c].y+=m[1],u[c].z+=m[2],u[c].nbStars++,u[c].coord.push(g)}}function o(){console.error("Failed to load files")}var a,l,h,u={},c=function(t){e.prototype.constructor.call(this,t),h=this};return r.inherits(e,c),c.prototype.loadFiles=function(e,i){var r=e;if(!i.nameUrl||!i.catalogueUrl)return console.error("Not valid options"),!1;var n={type:"GET",url:i.nameUrl,success:function(t){a=t},error:function(t,e,i){console.error(t.responseText)}},u={type:"GET",url:i.catalogueUrl,success:function(t){l=t},error:function(t,e,i){console.error(t.responseText)}};t.when(t.ajax(n),t.ajax(u)).then(function(){s(r),h.handleFeatures(r)},o)},c.prototype.handleFeatures=function(t){var e=[],r=[];for(var s in u)if(u.hasOwnProperty(s)){var o=u[s];o.coord.push(o.coord[0]);var a={geometry:{type:n.GEOMETRY.Polygon,gid:"constellationShape_"+o.name,coordinates:[o.coord],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:o.name}};r.push(a);var l=[];t.globe.getCoordinateSystem().getWorldFrom3D([o.x/o.nbStars,o.y/o.nbStars,o.z/o.nbStars],l);var h={geometry:{type:n.GEOMETRY.Point,gid:"constellationName_"+o.name,coordinates:[l[0],l[1]],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:o.name,style:new i({textColor:"#083BA8",fillColor:[1,1,1,1],label:o.name})}};e.push(h)}var c={type:"FeatureCollection",features:r},d={type:"FeatureCollection",features:e};t.addFeatureCollection(c),t.addFeatureCollection(d)},c}),r("Provider/OpenSearchProvider",["jquery","./AbstractProvider","../Parser/JsonProcessor"],function(t,e,i){var r,n=function(t){r=this,e.prototype.constructor.call(this,t)};return n.prototype.loadFiles=function(e,i,n){t.ajax({type:"GET",url:i.url+"startIndex="+n+"&count=500",success:function(t){r.handleFeatures(e,i,n,t)},error:function(t,e,i){console.error(t.responseText)}})},n.prototype.handleFeatures=function(t,e,n,s){i.handleFeatureCollection(t,s),t.addFeatureCollection(s),n+s.features.length<s.totalResults&&r.loadFiles(t,e.url,n+s.features.length)},n}),r("Provider/PlanetProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Constants"],function(t,e,i,r){function n(t,e,i){var r,n=t.toFixed(i),s=n.length,o="";for(r=0;r<e-s;r++)o+=" ";for(r=0;r<s;r++)o+=n.charAt(r);return o}function s(t,e,s,o){var a;return a=new i(e===r.GEOMETRY.Point?{iconUrl:t.style.iconUrl,strokeColor:i.fromStringToColor(o.color),fillColor:i.fromStringToColor(o.color)}:{label:s,strokeColor:i.fromStringToColor(o.color),fillColor:i.fromStringToColor(o.color)}),{geometry:{type:r.GEOMETRY.Point,gid:"planet"+e+"_"+s,coordinates:[o.ra,o.dec],crs:{type:"name",properties:{name:r.CRS.Equatorial}}},properties:{name:s,distance:n(o.rvec,9,6)+" AU",style:a}}}function o(){this.ra=parseFloat("0"),this.dec=parseFloat("0"),this.rvec=parseFloat("0")}function a(t,e,i,r,n){var s=r+n/60;return 367*t-Math.floor(7*(t+Math.floor((e+9)/12))/4)+Math.floor(275*e/9)+i-730531.5+s/24}function l(){this.color="",this.a=parseFloat("0"),this.e=parseFloat("0"),this.i=parseFloat("0"),this.O=parseFloat("0"),this.w=parseFloat("0"),this.L=parseFloat("0")}function h(t){var e;return e=t>=0?Math.floor(t):Math.ceil(t)}function u(t){var e=t/(2*Math.PI),i=2*Math.PI*(e-h(e));return i<0&&(i=2*Math.PI+i),i}function c(t,e){var i,r,n=t+e*Math.sin(t)*(1+e*Math.cos(t));do r=n,n=r-(r-e*Math.sin(r)-t)/(1-e*Math.cos(r));while(Math.abs(n-r)>b);return i=2*Math.atan(Math.sqrt((1+e)/(1-e))*Math.tan(.5*n)),i<0&&(i+=2*Math.PI),i}function d(t,e,i){var r=i/36525;switch(e){case 0:t.color="rgb(170,150,170)",t.a=.38709893+6.6e-7*r,t.e=.20563069+2527e-8*r,t.i=(7.00487-23.51*r/3600)*y,t.O=(48.33167-446.3*r/3600)*y,t.w=(77.45645+573.57*r/3600)*y,t.L=u((252.25084+538101628.29*r/3600)*y);break;case 1:t.color="rgb(245,222,179)",t.a=.72333199+9.2e-7*r,t.e=.00677323-4938e-8*r,t.i=(3.39471-2.86*r/3600)*y,t.O=(76.68069-996.89*r/3600)*y,t.w=(131.53298-108.8*r/3600)*y,t.L=u((181.97973+210664136.06*r/3600)*y);break;case 2:t.color="rgb(255,193,37)",t.a=1.00000011-5e-8*r,t.e=.01671022-3804e-8*r,t.i=(5e-5-46.94*r/3600)*y,t.O=(-11.26064-18228.25*r/3600)*y,t.w=(102.94719+1198.28*r/3600)*y,t.L=u((100.46435+129597740.63*r/3600)*y);break;case 3:t.color="rgb(255,50,50)",t.a=1.52366231-7221e-8*r,t.e=.09341233+11902e-8*r,t.i=(1.85061-25.47*r/3600)*y,t.O=(49.57854-1020.19*r/3600)*y,t.w=(336.04084+1560.78*r/3600)*y,t.L=u((355.45332+68905103.78*r/3600)*y);break;case 4:t.color="rgb(255,150,150)",t.a=5.20336301+60737e-8*r,t.e=.04839266-1288e-7*r,t.i=(1.3053-4.15*r/3600)*y,t.O=(100.55615+1217.17*r/3600)*y,t.w=(14.75385+839.93*r/3600)*y,t.L=u((34.40438+10925078.35*r/3600)*y);break;case 5:t.color="rgb(200,150,150)",t.a=9.53707032-.0030153*r,t.e=.0541506-36762e-8*r,t.i=(2.48446+6.11*r/3600)*y,t.O=(113.71504-1591.05*r/3600)*y,t.w=(92.43194-1948.89*r/3600)*y,t.L=u((49.94432+4401052.95*r/3600)*y);break;case 6:t.color="rgb(130,150,255)",t.a=19.19126393+.00152025*r,t.e=.04716771-1915e-7*r,t.i=(.76986-2.09*r/3600)*y,t.O=(74.22988-1681.4*r/3600)*y,t.w=(170.96424+1312.56*r/3600)*y,t.L=u((313.23218+1542547.79*r/3600)*y);break;case 7:t.color="rgb(100,100,255)",t.a=30.06896348-.00125196*r,t.e=.00858587+251e-7*r,t.i=(1.76917-3.64*r/3600)*y,t.O=(131.72169-151.25*r/3600)*y,t.w=(44.97135-844.43*r/3600)*y,t.L=u((304.88003+786449.21*r/3600)*y);break;case 8:t.color="rgb(100,100,255)",t.a=39.48168677-76912e-8*r,t.e=.24880766+6465e-8*r,t.i=(17.14175+11.07*r/3600)*y,t.O=(110.30347-37.33*r/3600)*y,t.w=(224.06676-132.25*r/3600)*y,t.L=u((238.92881+522747.9*r/3600)*y);break;default:throw"function mean_elements() failed!"}}function p(t,e,i){var r=new l;d(r,e,i);var n=r.a,s=r.e,o=r.i,a=r.O,h=r.w,p=r.L,f=new l;d(f,2,i);var g=f.a,m=f.e,b=f.w,x=f.L,_=u(x-b),w=c(_,m),C=g*(1-m*m)/(1+m*Math.cos(w)),T=C*Math.cos(w+b),A=C*Math.sin(w+b),I=0,S=u(p-h),M=c(S,r.e),k=n*(1-s*s)/(1+s*Math.cos(M)),E=k*(Math.cos(a)*Math.cos(M+h-a)-Math.sin(a)*Math.sin(M+h-a)*Math.cos(o)),P=k*(Math.sin(a)*Math.cos(M+h-a)+Math.cos(a)*Math.sin(M+h-a)*Math.cos(o)),R=k*(Math.sin(M+h-a)*Math.sin(o));2===e&&(E=0,P=0,R=0);var D=E-T,N=P-A,L=R-I,F=23.439281*y,O=D,B=N*Math.cos(F)-L*Math.sin(F),U=N*Math.sin(F)+L*Math.cos(F);t.ra=u(Math.atan2(B,O))*v,t.dec=Math.atan(U/Math.sqrt(O*O+B*B))*v,t.rvec=Math.sqrt(O*O+B*B+U*U),t.color=r.color}var f,g,m,v=180/Math.PI,y=Math.PI/180,b=1e-12,x=new Array("Mercury","Venus","Sun","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto"),_=function(t){for(var e=[],i=new Date,n=i.getUTCFullYear(),l=i.getUTCMonth()+1,h=i.getUTCDate(),u=i.getUTCHours(),c=i.getUTCMinutes(),d=i.getUTCSeconds(),f=a(n,l,h,u,c+d/60),g=new o,v=0;v<9;v++){p(g,v,f);var y=s(t,"Label",x[v],g);e.push(y);var b=s(t,r.GEOMETRY.Point,x[v],g);e.push(b)}m={type:"FeatureCollection",features:e},t.addFeatureCollection(m)},w=function(t){e.prototype.constructor.call(this,t),f=this};return w.prototype.loadFiles=function(t,e){g=e.interval?e.interval:6e4,f.handleFeatures(t)},w.prototype.handleFeatures=function(t){_(t),setInterval(function(){t.removeFeatureCollection(m),_(t)},g)},w}),r("Provider/StarProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Utils","../Utils/Constants"],function(t,e,i,r,n){function s(){console.error("Failed to load files")}var o,a,l,h=function(t){e.prototype.constructor.call(this,t),l=this};return r.inherits(e,h),h.prototype.loadFiles=function(e,i){if(!i.nameUrl||!i.catalogueUrl)return console.error("Not valid options"),null;var r={type:"GET",url:i.nameUrl,success:function(t){o=t},error:function(t,e,i){console.error(t.responseText)}},n={type:"GET",url:i.catalogueUrl,success:function(t){a=t},error:function(t,e,i){console.error(t.responseText)}};t.proxy(t.when(t.ajax(r),t.ajax(n)).then(function(){l.handleFeatures(e)},s))},h.prototype.handleFeatures=function(t){var e=o.slice(o.indexOf("897;Acamar"),o.indexOf("1231;Zaurak")+11),r=e.split("\n");e=a.slice(a.indexOf("001."),a.indexOf("4.98;K3Ibv")+10);for(var s=e.split("\n"),l=[],h=0;h<r.length;h++)for(var u=r[h].split(";"),c=parseInt(u[0],10),d=u[1],p=0;p<s.length;p++)if(u=s[p].split(";"),parseInt(u[2],10)===c){var f=u[6],g=u[7],m=[];t.globe.getCoordinateSystem().getDecimalDegFromSexagesimal([f,g],m);var v={geometry:{type:n.GEOMETRY.Point,gid:"star_"+d,coordinates:[m[0],m[1]],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:d,style:new i({label:d,fillColor:[1,1,1,1]})}};l.push(v)}var y={type:"FeatureCollection",features:l};t.addFeatureCollection(y)},h}),r("Provider/CraterProvider",["jquery","./AbstractProvider","../Utils/Utils","../Renderer/FeatureStyle"],function(t,e,i,r){var n,s,o=function(t){e.prototype.constructor.call(this,t),n=this};return i.inherits(e,o),o.prototype.loadFiles=function(e,i){t.ajax({type:"GET",url:i.url,success:function(t){s=t,n.handleFeatures(e)},error:function(t,e,i){console.error(t.responseText)}})},o.prototype.handleFeatures=function(t){for(var e=s.crs,i=s.features,n=0;n<i.length;n++){var o=i[n];o.geometry.crs=e;var a=o.properties.name;o.properties.style=new r({label:a,fillColor:[1,1,1,1],pointMaxSize:20})}t.addFeatureCollection(s)},o}),r("Provider/ProviderFactory",["./ConstellationProvider","./OpenSearchProvider","./PlanetProvider","./StarProvider","./CraterProvider","../Utils/Constants"],function(t,e,i,r,n,s){return{create:function(o,a){var l;switch(o){case s.PROVIDER.Constellation:l=new t(a);break;case s.PROVIDER.Crater:l=new n(a);break;case s.PROVIDER.OpenSearch:l=new e(a);break;case s.PROVIDER.Planet:l=new i(a);break;case s.PROVIDER.Star:l=new r(a);break;default:throw"unable to create the provider "+o}return l}}}),r("Utils/Stats",[],function(){var t=function(t,e){this.type=null,t.getRenderContext().stats=this,this.context=t;var i=e?e.element:void 0;i&&("string"==typeof i?(this.element=document.getElementById(i),this.type="dom"):(this.element=i,this.type="jquery")),this.showFPS=this.context.globe.continuousRendering,this.verbose=!(!e||!e.verbose)&&e.verbose,this.numFrames=0;var r=this;window.setInterval(function(){r.print()},1e3)};return t.prototype.start=function(t){this[t]=Date.now()},t.prototype.end=function(t){var e=Date.now()-this[t],i=this["max_"+t]||-1;i<e&&(i=e);var r=this["sum_"+t]||0;r+=e,this[t]=e,this["max_"+t]=i,this["sum_"+t]=r,"globalRenderTime"===t&&this.numFrames++},t.prototype.print=function(){if(this.numFrames>0){var t="";this.showFPS&&(t+="FPS : "+this.numFrames+"<br>"),t+="Average render time : "+(this.sum_globalRenderTime/this.numFrames).toFixed(2)+" ms",this.verbose&&(t+="<br>Average traverse tiles time : "+(this.sum_traverseTime/this.numFrames).toFixed(2)+" ms",t+="<br>Average render tiles time : "+(this.sum_renderTime/this.numFrames).toFixed(2)+" ms",t+="<br>Average generate tiles time : "+(this.sum_generateTime/this.numFrames).toFixed(2)+" ms",t+="<br>Average request tiles time : "+(this.sum_requestTime/this.numFrames).toFixed(2)+" ms",t+="<br>Max render time : "+this.max_globalRenderTime+" ms",t+="<br>Max traverse tiles time : "+this.max_traverseTime+" ms",t+="<br>Max render tiles time : "+this.max_renderTime+" ms",t+="<br>Max generate tiles time : "+this.max_generateTime+" ms",t+="<br>Max request tiles time : "+this.max_requestTime+" ms"),this.element&&("dom"===this.type?this.element.innerHTML=t:"jquery"===this.type&&this.element.html(t)),this.sum_globalRenderTime=0,this.sum_traverseTime=0,this.sum_renderTime=0,this.sum_generateTime=0,this.sum_requestTime=0,this.max_globalRenderTime=0,this.max_traverseTime=0,this.max_renderTime=0,this.max_generateTime=0,this.max_requestTime=0,this.numFrames=0}},t}),r("Mizar",["jquery","underscore-min","./Context/ContextFactory","./Navigation/NavigationFactory","./Layer/LayerFactory","./Crs/CoordinateSystemFactory","./Animation/AnimationFactory","./Utils/UtilityFactory","./Services/ServiceFactory","./Provider/ProviderFactory","./Utils/Utils","./Utils/Event","./Utils/Stats","./Utils/Constants","./Gui/dialog/ErrorDialog","./Layer/HipsMetadata"],function(t,e,i,r,n,s,o,a,l,h,u,c,d,p,f,g){
function m(t,i,r){var n=e.find(t,function(t){return t.src.indexOf(i)!==-1});return n&&(n=n.src.split("/").slice(0,r).join("/")+"/"),n}function v(){var t=document.getElementsByTagName("script");return m.call(this,t,L,-1)||m.call(this,t,F,-2)}function y(t){if("undefined"==typeof t)throw new ReferenceError("No option found","Mizar.js");if("undefined"==typeof t.canvas)throw new ReferenceError("Canvas not defined","Mizar.js")}function b(t){var e=v(),i={canvas:"string"==typeof t.canvas?document.getElementById(t.canvas):t.canvas};return t.hasOwnProperty("configuration")?i.configuration=t.configuration:i.configuration={},i.configuration.mizarAPIUrl=e,t.hasOwnProperty("skyContext")&&(i.skyContext=t.skyContext),t.hasOwnProperty("planetContext")&&(i.planetContext=t.planetContext),i}function x(){var t=this;this.activatedContext.hide(),this.setActivatedContext(O.CONTEXT.Sky),this.planetContext.navigation.toViewMatrix(this._oldVM,this._oldFov,2e3,function(){t.activatedContext.showAdditionalLayers(),t.activatedContext.getRenderContext().tileErrorTreshold=1.5,t.publish("mizarMode:toggle",t.activatedContext),t.planetContext.destroy(),t.activatedContext.show(),t.activatedContext.refresh(),t.activatedContext.getPositionTracker().attachTo(t.activatedContext.globe)})}function _(e,i){var r=this,n=t.extend({},i);if(n.planetLayer=e,n.coordinateSystem=e.coordinateSystem,n.renderContext=this.getRenderContext(),this.activatedContext.hide(),this.activatedContext.hideAdditionalLayers(),this.createContext(O.CONTEXT.Planet,n),this._oldVM=this.renderContext.getViewMatrix(),this._oldFov=this.renderContext.getFov(),this.activatedContext.getCoordinateSystem().isFlat())this.activatedContext.show(),this.activatedContext.refresh(),this.publish("mizarMode:toggle",r.activatedContext);else{var s=mat4.create();this.activatedContext.getNavigation().computeInverseViewMatrix(),mat4.inverse(this.activatedContext.getNavigation().inverseViewMatrix,s),this.activatedContext.getNavigation().toViewMatrix(s,90,2e3,function(){r.activatedContext.show(),r.activatedContext.refresh(),r.publish("mizarMode:toggle",r.activatedContext)})}}function w(){void 0!==this.activatedContext._atmosphereLayer&&null!==this.activatedContext._atmosphereLayer.globe&&(this.activatedContext._saveAtmosphereVisible=this.activatedContext._atmosphereLayer.visible,this.activatedContext._atmosphereLayer.setVisible(!1),this.render())}function C(){void 0!==this.activatedContext._atmosphereLayer&&null!==this.activatedContext._atmosphereLayer.globe&&(this.activatedContext._atmosphereLayer.setVisible(this.activatedContext._saveAtmosphereVisible),this.render())}function T(){C.call(this),this.skyContext.enable(),this.setCrs({geoideName:this.getCrs().getGeoideName()}),this.planetContext.navigation.zoom(0)}function A(){w.call(this),this.skyContext.disable(),I.call(this,this.activatedContext.navigation.getCenter())}function I(t){null!==t&&90-Math.abs(t[1])<=N?this.setCrs({geoideName:this.getCrs().getGeoideName(),projectionName:O.PROJECTION.Azimuth,pole:Math.sign(t[1])>0?"north":"south"}):this.setCrs({geoideName:this.getCrs().getGeoideName(),projectionName:O.PROJECTION.Plate})}function S(){if(this.activatedContext.getMode()===O.CONTEXT.Sky)throw"Not implemented"}function M(t){var e=[];return t.hips_service_url&&e.push(t.hips_service_url),t.hips_service_url_1&&e.push(t.hips_service_url_1),t.hips_service_url_2&&e.push(t.hips_service_url_2),e}function k(e,i){if(0===e.length)return i(void 0);var r=e.shift();t.ajax({type:"GET",url:r+"/properties",dataType:"text"}).done(function(t,e,n){if(200===n.status)return i(r)}).error(function(){k(e,i)})}function E(i,r){"undefined"!=typeof r&&r.hasOwnProperty("registry")&&r.registry.hasOwnProperty("hips")&&t.ajax({type:"GET",url:r.registry.hips,context:i,dataType:"json"}).done(function(r){e.each(r,function(e){var r=M(e);k(r,function(r){return"undefined"==typeof r?void console.log("Cannot add layer "+e.obs_title+" no mirror available"):void t.proxy(R,i)(e,r)})},i)})}function P(t){var e;switch(t){case void 0:e=this.getActivatedContext();break;case O.CONTEXT.Sky:e=this.getSkyContext();break;case O.CONTEXT.Planet:e=this.getPlanetContext();break;default:throw new RangeError("The mode "+t+" is not allowed, A valid mode is included in the list CONTEXT","Mizar.js")}return e}function R(t,e){if(!t.hasOwnProperty("hips_status")||null!==!t.hips_status.match("public")){t.hips_service_url=e;try{this.addLayer({type:O.LAYER.Hips,hipsMetadata:new g(t)})}catch(e){f.open("Hips layer "+t.creator_did+" not valid in Hips registry.")}}}const D="1.0.0",N=30,L="Mizar.min",F="Mizar.";var O=function(t){c.prototype.constructor.call(this),y(t),this.options=b(t),this.ContextFactory=i,this.LayerFactory=n,this.AnimationFactory=o,this.ServiceFactory=l,this.UtilityFactory=a,this.ProviderFactory=h,this.skyContext=null,this.planetContext=null,this.activatedContext=null,this.renderContext=null,this.dataProviders={},t.skyContext&&this.createContext(O.CONTEXT.Sky,t.skyContext),t.planetContext&&this.createContext(O.CONTEXT.Planet,t.planetContext)};return O.VERSION=D,O.ANIMATION=p.ANIMATION,O.LAYER=p.LAYER,O.GEOMETRY=p.GEOMETRY,O.NAVIGATION=p.NAVIGATION,O.CONTEXT=p.CONTEXT,O.PROJECTION=p.PROJECTION,O.CRS=p.CRS,O.SERVICE=p.SERVICE,O.UTILITY=p.UTILITY,O.PROVIDER=p.PROVIDER,u.inherits(c,O),O.prototype.getSkyContext=function(){return this.skyContext},O.prototype.getPlanetContext=function(){return this.planetContext},O.prototype.getActivatedContext=function(){return this.activatedContext},O.prototype.setActivatedContext=function(t){switch(t){case O.CONTEXT.Planet:this.activatedContext=this.planetContext;break;case O.CONTEXT.Sky:this.activatedContext=this.skyContext;break;default:throw RangeError("The contextMode "+t+" is not allowed, A valid contextMode is included in the list Constants.CONTEXT","Mizar.js")}this.publish("mizarMode:toggle",this.activatedContext)},O.prototype.getRenderContext=function(){return this.activatedContext.getRenderContext()},O.prototype.getOptions=function(){return this.options},O.prototype.getCrs=function(){return this.activatedContext.getCoordinateSystem()},O.prototype.setCrs=function(t){var e=s.create(t);this.activatedContext.setCoordinateSystem(e)},O.prototype.createContext=function(t,e){switch(e.renderContext=this.renderContext,this.activatedContext=this.ContextFactory.create(t,this.getOptions(),e),t){case O.CONTEXT.Sky:this.skyContext=this.activatedContext,E(this,this.getOptions().configuration);break;case O.CONTEXT.Planet:this.planetContext=this.activatedContext;break;default:throw new RangeError("Unknown contextMode '"+t+"'","Mizar.js")}this.renderContext=this.activatedContext.getRenderContext(),this.publish("mizarMode:toggle",this.activatedContext)},O.prototype.toggleDimension=function(){S.call(this),this.getCrs().isFlat()?T.call(this):A.call(this),this.render()},O.prototype.toggleContext=function(t,e,i){var r=this.getActivatedContext().getMode()===O.CONTEXT.Sky?O.CONTEXT.Planet:O.CONTEXT.Sky,n=this;r===O.CONTEXT.Sky?x.call(this):_.call(this,t,e),i&&i.call(n)},O.prototype.getSkyLayers=function(){return this.getSkyContext().getLayers()},O.prototype.getPlanetLayers=function(){return this.getPlanetContext().getLayers()},O.prototype.getLayers=function(t){return P.call(this,t).getLayers()},O.prototype.getAllLayers=function(){return e.union(this.getSkyLayers(),this.getPlanetLayers())},O.prototype.getLayerByID=function(t,e){return P.call(this,e).getLayerByID(t)},O.prototype.getLayerByName=function(t,e){return P.call(this,e).getLayerByName(t)},O.prototype.addLayer=function(t,e){var i;return e?(i=this.LayerFactory.create(t),this.getActivatedContext()._fillDataProvider(i,t),e.layers.push(i)):i=this.getActivatedContext().addLayer(t),i.ID},O.prototype.removeLayer=function(t,e){var i=P.call(this,e).removeLayer(t);return"undefined"!=typeof i},O.prototype.setBackgroundLayer=function(t,e){var i=P.call(this,e).setBackgroundLayer(t);return"undefined"!=typeof i},O.prototype.setBackgroundLayerByID=function(t,e){var i=P.call(this,e).setBackgroundLayerByID(t);return"undefined"!=typeof i},O.prototype.setBaseElevation=function(t,e){var i=this.getLayerByName(t,e);return P.call(this,e).setBaseElevation(i)},O.prototype.searchOnLayerDescription=function(t,i){var r=this.getLayers(i);return e.filter(r,function(e){return String(e.name).indexOf(t)>=0||String(e.description||"").indexOf(t)>=0})},O.prototype.searchSkyLayer=function(t){var i=this.getSkyLayers();return e.filter(i,function(e){return String(e.name).indexOf(t)>=0||String(e.description||"").indexOf(t)>=0})},O.prototype.searchPlanetLayer=function(t){var i=this.getPlanetLayers();return e.filter(i,function(e){return String(e.name).indexOf(t)>=0||String(e.description||"").indexOf(t)>=0})},O.prototype.registerNoStandardDataProvider=function(t,e,i){P.call(this,i).registerNoStandardDataProvider(t,e)},O.prototype.getServiceByName=function(t,e){return l.create(t,e)},O.prototype.createStats=function(t){this.skyContext?this.Stats=new d(this.skyContext,t):this.planetContext?this.Stats=new d(this.planetContext,t):console.log("No context")},O.prototype.render=function(){this.getRenderContext().frame()},O.prototype.dispose=function(){this.planetContext&&this.planetContext.dispose(),this.skyContext&&this.skyContext.dispose()},O.prototype.destroy=function(){this.planetContext&&this.planetContext.destroy(),this.skyContext&&this.skyContext.destroy(),this.activatedContext=null,this.renderContext=null,this.ContextFactory=null,this.LayerFactory=null,this.AnimationFactory=null,this.ServiceFactory=null,this.UtilityFactory=null},window.Mizar=O,O}),e("Mizar")});